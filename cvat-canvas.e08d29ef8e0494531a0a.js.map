{"version":3,"file":"cvat-canvas.e08d29ef8e0494531a0a.js","mappings":"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","sources":["webpack://canvas/./src/scss/canvas.scss","webpack://canvas/../node_modules/css-loader/dist/runtime/api.js","webpack://canvas/../node_modules/css-loader/dist/runtime/getUrl.js","webpack://canvas/../node_modules/css-loader/dist/runtime/sourceMaps.js","webpack://canvas/../node_modules/fabric/dist/fabric.js","webpack://canvas/../node_modules/polylabel/polylabel.js","webpack://canvas/./src/scss/canvas.scss?743a","webpack://canvas/../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js","webpack://canvas/../node_modules/svg.draggable.js/dist/svg.draggable.js","webpack://canvas/../node_modules/svg.draw.js/dist/svg.draw.js","webpack://canvas/../node_modules/svg.js/dist/svg.js","webpack://canvas/../node_modules/svg.resize.js/dist/svg.resize.js","webpack://canvas/../node_modules/svg.select.js/dist/svg.select.js","webpack://canvas/../node_modules/tinyqueue/index.js","webpack://canvas/webpack/bootstrap","webpack://canvas/webpack/runtime/compat get default export","webpack://canvas/webpack/runtime/define property getters","webpack://canvas/webpack/runtime/hasOwnProperty shorthand","webpack://canvas/webpack/runtime/make namespace object","webpack://canvas/webpack/runtime/jsonp chunk loading","webpack://canvas/webpack/runtime/nonce","webpack://canvas/./src/typescript/consts.ts","webpack://canvas/./src/typescript/master.ts","webpack://canvas/./src/typescript/canvasModel.ts","webpack://canvas/./src/typescript/canvasController.ts","webpack://canvas/./src/typescript/cuboid.ts","webpack://canvas/./src/typescript/shared.ts","webpack://canvas/./src/typescript/svg.patch.ts","webpack://canvas/./src/typescript/crosshair.ts","webpack://canvas/./src/typescript/drawHandler.ts","webpack://canvas/./src/typescript/masksHandler.ts","webpack://canvas/./src/typescript/editHandler.ts","webpack://canvas/./src/typescript/mergeHandler.ts","webpack://canvas/./src/typescript/splitHandler.ts","webpack://canvas/./src/typescript/groupHandler.ts","webpack://canvas/./src/typescript/regionSelector.ts","webpack://canvas/./src/typescript/zoomHandler.ts","webpack://canvas/./src/typescript/interactionHandler.ts","webpack://canvas/./src/typescript/autoborderHandler.ts","webpack://canvas/./src/typescript/canvasView.ts","webpack://canvas/./src/typescript/canvas.ts"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/api.js\";\nimport ___CSS_LOADER_GET_URL_IMPORT___ from \"../../../node_modules/css-loader/dist/runtime/getUrl.js\";\nvar ___CSS_LOADER_URL_IMPORT_0___ = new URL(\"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAxMCAxMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEgMUw5IDlNMSA5TDkgMSIgc3Ryb2tlPSJibGFjayIvPgo8L3N2Zz4K\", import.meta.url);\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\nvar ___CSS_LOADER_URL_REPLACEMENT_0___ = ___CSS_LOADER_GET_URL_IMPORT___(___CSS_LOADER_URL_IMPORT_0___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".cvat_canvas_hidden{display:none}.cvat_canvas_shape,.cvat_canvas_interact_intermediate_shape{stroke-opacity:1}g.cvat_canvas_shape>circle,g.cvat_canvas_interact_intermediate_shape>circle{fill-opacity:1}polyline.cvat_canvas_shape,polyline.cvat_canvas_interact_intermediate_shape{fill-opacity:0}.cvat_shape_action_opacity,.cvat_canvas_shape_splitting,polyline.cvat_canvas_shape_splitting,polyline.cvat_canvas_shape_merging,.cvat_canvas_shape_merging,polyline.cvat_canvas_shape_grouping,.cvat_canvas_shape_region_selection,.cvat_canvas_shape_grouping{fill-opacity:.5;stroke-opacity:1}polyline.cvat_shape_action_opacity,polyline.cvat_canvas_shape_splitting,polyline.cvat_canvas_shape_merging,polyline.cvat_canvas_shape_grouping,polyline.cvat_canvas_shape_region_selection{fill-opacity:0}.cvat_shape_drawing_opacity,.cvat_canvas_shape_drawing{stroke-opacity:1}polyline.cvat_shape_drawing_opacity,polyline.cvat_canvas_shape_drawing{fill-opacity:0}.cvat_shape_action_dasharray,.cvat_canvas_zoom_selection,.cvat_canvas_shape_splitting,polyline.cvat_canvas_shape_splitting,polyline.cvat_canvas_shape_merging,.cvat_canvas_shape_merging,polyline.cvat_canvas_shape_grouping,.cvat_canvas_shape_region_selection,.cvat_canvas_shape_grouping{stroke-dasharray:4 1 2 3}.cvat_canvas_text{font-weight:bold;fill:#fff;cursor:default;font-family:Calibri,Candara,Segoe,\\\"Segoe UI\\\",Optima,Arial,sans-serif;text-shadow:0 0 4px #000;-webkit-user-select:none;-moz-user-select:none;user-select:none;pointer-events:none}.cvat_canvas_text_description{fill:#ff0;font-style:oblique 40deg}.cvat_canvas_crosshair{stroke:red}.cvat_canvas_threshold{stroke:red}.cvat_canvas_shape_grouping{fill:#8b008b}image.cvat_canvas_shape_grouping{visibility:hidden}.cvat_canvas_shape_region_selection{fill:#fff;stroke:#fff}.cvat_canvas_issue_region{stroke-width:0}circle.cvat_canvas_issue_region{opacity:1 !important}polyline.cvat_canvas_shape_grouping{stroke:#8b008b}.cvat_canvas_shape_merging{fill:blue}.cvat_canvas_shape_merging>circle[data-node-id]{fill:blue}polyline.cvat_canvas_shape_merging{stroke:blue}polyline.cvat_canvas_shape_splitting{stroke:#1e90ff}.cvat_canvas_shape_splitting{fill:#1e90ff}.cvat_canvas_shape_drawing{fill:#fff}.cvat_canvas_zoom_selection{stroke:#096dd9;fill-opacity:0}.cvat_canvas_shape_occluded{stroke-dasharray:5}.cvat_canvas_ground_truth{stroke-dasharray:1}.cvat_canvas_conflicted{stroke:#ff4800;fill:#ff4800}.cvat_canvas_conflicted rect,.cvat_canvas_conflicted ellipse,.cvat_canvas_conflicted polygon,.cvat_canvas_conflicted polyline,.cvat_canvas_conflicted line{fill:#ff4800;stroke:#ff4800}.cvat_canvas_conflicted circle{fill:#ff4800}.cvat_canvas_warned{stroke:#ff7301;fill:#ff7301}.cvat_canvas_warned rect,.cvat_canvas_warned ellipse,.cvat_canvas_warned polygon,.cvat_canvas_warned polyline,.cvat_canvas_warned line{fill:#ff7301;stroke:#ff7301}.cvat_canvas_warned circle{fill:#ff7301}.cvat_canvas_shape_occluded_point,g.cvat_canvas_shape_occluded>circle,circle.cvat_canvas_shape_occluded{stroke-dasharray:1 !important}.cvat_canvas_shape_occluded_point,g.cvat_canvas_shape_occluded>circle,circle.cvat_canvas_shape_occluded{stroke:#fff}g.cvat_canvas_shape_occluded>rect{stroke-dasharray:5}.svg_select_points_rot{fill:#fff}.cvat_canvas_shape .svg_select_points,.cvat_canvas_interact_intermediate_shape .svg_select_points,.cvat_canvas_shape .cvat_canvas_cuboid_projections,.cvat_canvas_interact_intermediate_shape .cvat_canvas_cuboid_projections{stroke-dasharray:none}.cvat_canvas_autoborder_point{opacity:.55}.cvat_canvas_autoborder_point:hover{opacity:1;fill:red}.cvat_canvas_autoborder_point:active{opacity:.55;fill:red}.cvat_canvas_autoborder_point_direction{fill:#8a2be2}.cvat_canvas_removable_interaction_point{cursor:url(\" + ___CSS_LOADER_URL_REPLACEMENT_0___ + \") 10 10,auto}.cvat_canvas_interact_intermediate_shape_point{pointer-events:none}.svg_select_boundingRect{opacity:0;pointer-events:none}.svg_select_points_lb:hover,.svg_select_points_rt:hover{cursor:nesw-resize}.svg_select_points_lt:hover,.svg_select_points_rb:hover{cursor:nwse-resize}.svg_select_points_l:hover,.svg_select_points_r:hover,.svg_select_points_ew:hover{cursor:ew-resize}.svg_select_points_t:hover,.svg_select_points_b:hover{cursor:ns-resize}.cvat_canvas_shape_draggable:hover{cursor:move}.cvat_canvas_first_poly_point{fill:#d3d3d3}.cvat_canvas_poly_direction{fill:#d3d3d3;stroke:#000}.cvat_canvas_poly_direction:hover{fill:#000;stroke:#d3d3d3}.cvat_canvas_poly_direction:active{fill:#d3d3d3;stroke:#000}.cvat_canvas_skeleton_wrapping_rect{transform:none !important}.cvat_canvas_shape>.cvat_canvas_skeleton_wrapping_rect,.cvat_canvas_interact_intermediate_shape>.cvat_canvas_skeleton_wrapping_rect{visibility:hidden}.cvat_canvas_shape.cvat_canvas_shape_activated>.cvat_canvas_skeleton_wrapping_rect,.cvat_canvas_shape_activated.cvat_canvas_interact_intermediate_shape>.cvat_canvas_skeleton_wrapping_rect{visibility:initial}.cvat_canvas_pixelized,#cvat_canvas_bitmap{image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-o-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:optimize-contrast;image-rendering:crisp-edges;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor}.cvat_canvas_removed_image{filter:saturate(0) brightness(1.2) contrast(0.75) !important}#cvat_canvas_wrapper{width:calc(100% - 10px);height:calc(100% - 10px);margin:5px;border-radius:5px;background-color:inherit;overflow:hidden;position:relative}.cvat-canvas-highlight-enabled svg>rect:not(.cvat_canvas_issue_region):not(.cvat_canvas_conflicted):not(.cvat_canvas_warned),.cvat-canvas-highlight-enabled svg>ellipse:not(.cvat_canvas_issue_region):not(.cvat_canvas_conflicted):not(.cvat_canvas_warned),.cvat-canvas-highlight-enabled svg>polygon:not(.cvat_canvas_issue_region):not(.cvat_canvas_conflicted):not(.cvat_canvas_warned),.cvat-canvas-highlight-enabled svg>polyline:not(.cvat_canvas_issue_region):not(.cvat_canvas_conflicted):not(.cvat_canvas_warned),.cvat-canvas-highlight-enabled svg>line:not(.cvat_canvas_issue_region):not(.cvat_canvas_conflicted):not(.cvat_canvas_warned){fill:gray;stroke:gray}.cvat-canvas-highlight-enabled svg>circle:not(.cvat_canvas_issue_region):not(.cvat_canvas_conflicted):not(.cvat_canvas_warned){fill:gray}.cvat-canvas-highlight-enabled svg>g:not(.cvat_canvas_issue_region):not(.cvat_canvas_conflicted):not(.cvat_canvas_warned) rect,.cvat-canvas-highlight-enabled svg>g:not(.cvat_canvas_issue_region):not(.cvat_canvas_conflicted):not(.cvat_canvas_warned) ellipse,.cvat-canvas-highlight-enabled svg>g:not(.cvat_canvas_issue_region):not(.cvat_canvas_conflicted):not(.cvat_canvas_warned) polygon,.cvat-canvas-highlight-enabled svg>g:not(.cvat_canvas_issue_region):not(.cvat_canvas_conflicted):not(.cvat_canvas_warned) polyline,.cvat-canvas-highlight-enabled svg>g:not(.cvat_canvas_issue_region):not(.cvat_canvas_conflicted):not(.cvat_canvas_warned) line{fill:gray;stroke:gray}.cvat-canvas-highlight-enabled svg>g:not(.cvat_canvas_issue_region):not(.cvat_canvas_conflicted):not(.cvat_canvas_warned) circle{fill:gray}#cvat_canvas_text_content{text-rendering:optimizeSpeed;position:absolute;z-index:3;pointer-events:none;width:100%;height:100%}#cvat_canvas_background{position:absolute;z-index:0;background-repeat:no-repeat;width:100%;height:100%;box-shadow:2px 2px 5px 0 rgba(0,0,0,.75)}#cvat_canvas_bitmap{pointer-events:none;position:absolute;z-index:4;background:#000;width:100%;height:100%;box-shadow:2px 2px 5px 0 rgba(0,0,0,.75)}#cvat_canvas_grid{position:absolute;z-index:2;pointer-events:none;width:100%;height:100%}#cvat_canvas_grid_pattern{opacity:1;stroke:#fff}#cvat_canvas_content{filter:contrast(120%) saturate(150%);position:absolute;z-index:2;outline:10px solid #000;width:100%;height:100%}.cvat_masks_canvas_wrapper{z-index:3;display:none}#cvat_canvas_attachment_board{position:absolute;z-index:4;pointer-events:none;width:100%;height:100%;-webkit-user-select:none;-moz-user-select:none;user-select:none}@keyframes loadingAnimation{0%{stroke-dashoffset:1;stroke:#09c}50%{stroke-dashoffset:100;stroke:#f44}100%{stroke-dashoffset:300;stroke:#09c}}.cvat_canvas_shape_darken{fill:#838383;stroke:#838383}\", \"\",{\"version\":3,\"sources\":[\"webpack://./src/scss/canvas.scss\"],\"names\":[],\"mappings\":\"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\",\"sourcesContent\":[\"// Copyright (C) 2020-2022 Intel Corporation\\n// Copyright (C) 2022-2023 CVAT.ai Corporation\\n//\\n// SPDX-License-Identifier: MIT\\n\\n.cvat_canvas_hidden {\\n    display: none;\\n}\\n\\n.cvat_canvas_shape {\\n    stroke-opacity: 1;\\n}\\n\\ng.cvat_canvas_shape {\\n    > circle {\\n        fill-opacity: 1;\\n    }\\n}\\n\\npolyline.cvat_canvas_shape {\\n    fill-opacity: 0;\\n}\\n\\n.cvat_shape_action_opacity {\\n    fill-opacity: 0.5;\\n    stroke-opacity: 1;\\n}\\n\\npolyline.cvat_shape_action_opacity {\\n    fill-opacity: 0;\\n}\\n\\n.cvat_shape_drawing_opacity {\\n    stroke-opacity: 1;\\n}\\n\\npolyline.cvat_shape_drawing_opacity {\\n    fill-opacity: 0;\\n}\\n\\n.cvat_shape_action_dasharray {\\n    stroke-dasharray: 4 1 2 3;\\n}\\n\\n.cvat_canvas_text {\\n    font-weight: bold;\\n    fill: white;\\n    cursor: default;\\n    font-family: Calibri, Candara, Segoe, 'Segoe UI', Optima, Arial, sans-serif;\\n    text-shadow: 0 0 4px black;\\n    user-select: none;\\n    pointer-events: none;\\n}\\n\\n.cvat_canvas_text_description {\\n    fill: yellow;\\n    font-style: oblique 40deg;\\n}\\n\\n.cvat_canvas_crosshair {\\n    stroke: red;\\n}\\n\\n.cvat_canvas_threshold {\\n    stroke: red;\\n}\\n\\n.cvat_canvas_shape_grouping {\\n    @extend .cvat_shape_action_dasharray;\\n    @extend .cvat_shape_action_opacity;\\n\\n    fill: darkmagenta;\\n}\\n\\nimage.cvat_canvas_shape_grouping {\\n    visibility: hidden;\\n}\\n\\n.cvat_canvas_shape_region_selection {\\n    @extend .cvat_shape_action_dasharray;\\n    @extend .cvat_shape_action_opacity;\\n\\n    fill: white;\\n    stroke: white;\\n}\\n\\n.cvat_canvas_issue_region {\\n    stroke-width: 0;\\n}\\n\\ncircle.cvat_canvas_issue_region {\\n    opacity: 1 !important;\\n}\\n\\npolyline.cvat_canvas_shape_grouping {\\n    @extend .cvat_shape_action_dasharray;\\n    @extend .cvat_shape_action_opacity;\\n\\n    stroke: darkmagenta;\\n}\\n\\n.cvat_canvas_shape_merging {\\n    @extend .cvat_shape_action_dasharray;\\n    @extend .cvat_shape_action_opacity;\\n\\n    fill: blue;\\n\\n    > circle[data-node-id] {\\n        fill: blue;\\n    }\\n}\\n\\npolyline.cvat_canvas_shape_merging {\\n    @extend .cvat_shape_action_dasharray;\\n    @extend .cvat_shape_action_opacity;\\n\\n    stroke: blue;\\n}\\n\\npolyline.cvat_canvas_shape_splitting {\\n    @extend .cvat_shape_action_dasharray;\\n    @extend .cvat_shape_action_opacity;\\n\\n    stroke: dodgerblue;\\n}\\n\\n.cvat_canvas_shape_splitting {\\n    @extend .cvat_shape_action_dasharray;\\n    @extend .cvat_shape_action_opacity;\\n\\n    fill: dodgerblue;\\n}\\n\\n.cvat_canvas_shape_drawing {\\n    @extend .cvat_shape_drawing_opacity;\\n\\n    fill: white;\\n}\\n\\n.cvat_canvas_zoom_selection {\\n    @extend .cvat_shape_action_dasharray;\\n\\n    stroke: #096dd9;\\n    fill-opacity: 0;\\n}\\n\\n.cvat_canvas_shape_occluded {\\n    stroke-dasharray: 5;\\n}\\n\\n.cvat_canvas_ground_truth {\\n    stroke-dasharray: 1;\\n}\\n\\n.cvat_canvas_conflicted {\\n    stroke: #ff4800;\\n    fill: #ff4800;\\n\\n    rect,\\n    ellipse,\\n    polygon,\\n    polyline,\\n    line {\\n        fill: #ff4800;\\n        stroke: #ff4800;\\n    }\\n\\n    circle {\\n        fill: #ff4800;\\n    }\\n}\\n\\n.cvat_canvas_warned {\\n    stroke: #ff7301;\\n    fill: #ff7301;\\n\\n    rect,\\n    ellipse,\\n    polygon,\\n    polyline,\\n    line {\\n        fill: #ff7301;\\n        stroke: #ff7301;\\n    }\\n\\n    circle {\\n        fill: #ff7301;\\n    }\\n}\\n\\n.cvat_canvas_shape_occluded_point {\\n    stroke-dasharray: 1 !important;\\n    stroke: white;\\n}\\n\\ncircle.cvat_canvas_shape_occluded {\\n    @extend .cvat_canvas_shape_occluded_point;\\n}\\n\\ng.cvat_canvas_shape_occluded {\\n    > rect {\\n        stroke-dasharray: 5;\\n    }\\n\\n    > circle {\\n        @extend .cvat_canvas_shape_occluded_point;\\n    }\\n}\\n\\n.svg_select_points_rot {\\n    fill: white;\\n}\\n\\n.cvat_canvas_shape .svg_select_points,\\n.cvat_canvas_shape .cvat_canvas_cuboid_projections {\\n    stroke-dasharray: none;\\n}\\n\\n.cvat_canvas_autoborder_point {\\n    opacity: 0.55;\\n}\\n\\n.cvat_canvas_autoborder_point:hover {\\n    opacity: 1;\\n    fill: red;\\n}\\n\\n.cvat_canvas_autoborder_point:active {\\n    opacity: 0.55;\\n    fill: red;\\n}\\n\\n.cvat_canvas_autoborder_point_direction {\\n    fill: blueviolet;\\n}\\n\\n.cvat_canvas_interact_intermediate_shape {\\n    @extend .cvat_canvas_shape;\\n}\\n\\n.cvat_canvas_removable_interaction_point {\\n    cursor:\\n        url(\\n            'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAxMCAxMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEgMUw5IDlNMSA5TDkgMSIgc3Ryb2tlPSJibGFjayIvPgo8L3N2Zz4K'\\n        ) 10 10,\\n        auto;\\n}\\n\\n.cvat_canvas_interact_intermediate_shape_point {\\n    pointer-events: none;\\n}\\n\\n.svg_select_boundingRect {\\n    opacity: 0;\\n    pointer-events: none;\\n}\\n\\n.svg_select_points_lb:hover,\\n.svg_select_points_rt:hover {\\n    cursor: nesw-resize;\\n}\\n\\n.svg_select_points_lt:hover,\\n.svg_select_points_rb:hover {\\n    cursor: nwse-resize;\\n}\\n\\n.svg_select_points_l:hover,\\n.svg_select_points_r:hover,\\n.svg_select_points_ew:hover {\\n    cursor: ew-resize;\\n}\\n\\n.svg_select_points_t:hover,\\n.svg_select_points_b:hover {\\n    cursor: ns-resize;\\n}\\n\\n.cvat_canvas_shape_draggable:hover {\\n    cursor: move;\\n}\\n\\n.cvat_canvas_first_poly_point {\\n    fill: lightgray;\\n}\\n\\n.cvat_canvas_poly_direction {\\n    fill: lightgray;\\n    stroke: black;\\n\\n    &:hover {\\n        fill: black;\\n        stroke: lightgray;\\n    }\\n\\n    &:active {\\n        fill: lightgray;\\n        stroke: black;\\n    }\\n}\\n\\n.cvat_canvas_skeleton_wrapping_rect {\\n    // wrapping rect must not apply transform attribute from selectize.js\\n    // otherwise it rotated twice, because we apply the same rotation value to parent element (skeleton itself)\\n    transform: none !important;\\n}\\n\\n.cvat_canvas_shape > .cvat_canvas_skeleton_wrapping_rect {\\n    visibility: hidden;\\n}\\n\\n.cvat_canvas_shape.cvat_canvas_shape_activated > .cvat_canvas_skeleton_wrapping_rect {\\n    visibility: initial;\\n}\\n\\n.cvat_canvas_pixelized {\\n    image-rendering: optimizeSpeed;             /* Legal fallback */\\n    image-rendering: -moz-crisp-edges;          /* Firefox        */\\n    image-rendering: -o-crisp-edges;            /* Opera          */\\n    image-rendering: -webkit-optimize-contrast; /* Safari         */\\n    image-rendering: optimize-contrast;         /* CSS3 Proposed  */\\n    image-rendering: crisp-edges;               /* CSS4 Proposed  */\\n    image-rendering: pixelated;                 /* CSS4 Proposed  */\\n    -ms-interpolation-mode: nearest-neighbor;   /* IE8+           */\\n}\\n\\n.cvat_canvas_removed_image {\\n    filter: saturate(0) brightness(1.2) contrast(0.75) !important;\\n}\\n\\n#cvat_canvas_wrapper {\\n    width: calc(100% - 10px);\\n    height: calc(100% - 10px);\\n    margin: 5px;\\n    border-radius: 5px;\\n    background-color: inherit;\\n    overflow: hidden;\\n    position: relative;\\n}\\n\\n.cvat-canvas-highlight-enabled {\\n    svg {\\n        >rect:not(.cvat_canvas_issue_region,.cvat_canvas_conflicted,.cvat_canvas_warned),\\n        >ellipse:not(.cvat_canvas_issue_region,.cvat_canvas_conflicted,.cvat_canvas_warned),\\n        >polygon:not(.cvat_canvas_issue_region,.cvat_canvas_conflicted,.cvat_canvas_warned),\\n        >polyline:not(.cvat_canvas_issue_region,.cvat_canvas_conflicted,.cvat_canvas_warned),\\n        >line:not(.cvat_canvas_issue_region,.cvat_canvas_conflicted,.cvat_canvas_warned) {\\n            fill: gray;\\n            stroke: gray;\\n        }\\n\\n        >circle:not(.cvat_canvas_issue_region,.cvat_canvas_conflicted,.cvat_canvas_warned) {\\n            fill: gray;\\n        }\\n\\n        >g:not(.cvat_canvas_issue_region,.cvat_canvas_conflicted,.cvat_canvas_warned) {\\n            rect,\\n            ellipse,\\n            polygon,\\n            polyline,\\n            line {\\n                fill: gray;\\n                stroke: gray;\\n            }\\n\\n            circle {\\n                fill: gray;\\n            }\\n        }\\n    }\\n}\\n\\n#cvat_canvas_text_content {\\n    text-rendering: optimizeSpeed;\\n    position: absolute;\\n    z-index: 3;\\n    pointer-events: none;\\n    width: 100%;\\n    height: 100%;\\n}\\n\\n#cvat_canvas_background {\\n    position: absolute;\\n    z-index: 0;\\n    background-repeat: no-repeat;\\n    width: 100%;\\n    height: 100%;\\n    box-shadow: 2px 2px 5px 0 rgba(0, 0, 0, 0.75);\\n}\\n\\n#cvat_canvas_bitmap {\\n    @extend .cvat_canvas_pixelized;\\n\\n    pointer-events: none;\\n    position: absolute;\\n    z-index: 4;\\n    background: black;\\n    width: 100%;\\n    height: 100%;\\n    box-shadow: 2px 2px 5px 0 rgba(0, 0, 0, 0.75);\\n}\\n\\n#cvat_canvas_grid {\\n    position: absolute;\\n    z-index: 2;\\n    pointer-events: none;\\n    width: 100%;\\n    height: 100%;\\n}\\n\\n#cvat_canvas_grid_pattern {\\n    opacity: 1;\\n    stroke: white;\\n}\\n\\n#cvat_canvas_content {\\n    filter: contrast(120%) saturate(150%);\\n    position: absolute;\\n    z-index: 2;\\n    outline: 10px solid black;\\n    width: 100%;\\n    height: 100%;\\n}\\n\\n.cvat_masks_canvas_wrapper {\\n    z-index: 3;\\n    display: none;\\n}\\n\\n#cvat_canvas_attachment_board {\\n    position: absolute;\\n    z-index: 4;\\n    pointer-events: none;\\n    width: 100%;\\n    height: 100%;\\n    user-select: none;\\n}\\n\\n@keyframes loadingAnimation {\\n    0% {\\n        stroke-dashoffset: 1;\\n        stroke: #09c;\\n    }\\n\\n    50% {\\n        stroke-dashoffset: 100;\\n        stroke: #f44;\\n    }\\n\\n    100% {\\n        stroke-dashoffset: 300;\\n        stroke: #09c;\\n    }\\n}\\n\\n.cvat_canvas_shape_darken {\\n    fill: #838383;\\n    stroke: #838383;\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (url, options) {\n  if (!options) {\n    options = {};\n  }\n  if (!url) {\n    return url;\n  }\n  url = String(url.__esModule ? url.default : url);\n\n  // If url is already wrapped in quotes, remove them\n  if (/^['\"].*['\"]$/.test(url)) {\n    url = url.slice(1, -1);\n  }\n  if (options.hash) {\n    url += options.hash;\n  }\n\n  // Should url be wrapped?\n  // See https://drafts.csswg.org/css-values-3/#urls\n  if (/[\"'() \\t\\n]|(%20)/.test(url) || options.needQuotes) {\n    return \"\\\"\".concat(url.replace(/\"/g, '\\\\\"').replace(/\\n/g, \"\\\\n\"), \"\\\"\");\n  }\n  return url;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n  if (!cssMapping) {\n    return content;\n  }\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    return [content].concat([sourceMapping]).join(\"\\n\");\n  }\n  return [content].join(\"\\n\");\n};","/* build: `node build.js modules=ALL exclude=gestures,accessors,erasing requirejs minifier=uglifyjs` */\n/*! Fabric.js Copyright 2008-2015, Printio (Juriy Zaytsev, Maxim Chernyak) */\n\nvar fabric = fabric || { version: '5.3.0' };\nif (typeof exports !== 'undefined') {\n  exports.fabric = fabric;\n}\n/* _AMD_START_ */\nelse if (typeof define === 'function' && define.amd) {\n  define([], function() { return fabric; });\n}\n/* _AMD_END_ */\nif (typeof document !== 'undefined' && typeof window !== 'undefined') {\n  if (document instanceof (typeof HTMLDocument !== 'undefined' ? HTMLDocument : Document)) {\n    fabric.document = document;\n  }\n  else {\n    fabric.document = document.implementation.createHTMLDocument('');\n  }\n  fabric.window = window;\n}\nelse {\n  // assume we're running under node.js when document/window are not present\n  var jsdom = require('jsdom');\n  var virtualWindow = new jsdom.JSDOM(\n    decodeURIComponent('%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E'),\n    {\n      features: {\n        FetchExternalResources: ['img']\n      },\n      resources: 'usable'\n    }).window;\n  fabric.document = virtualWindow.document;\n  fabric.jsdomImplForWrapper = require('jsdom/lib/jsdom/living/generated/utils').implForWrapper;\n  fabric.nodeCanvas = require('jsdom/lib/jsdom/utils').Canvas;\n  fabric.window = virtualWindow;\n  DOMParser = fabric.window.DOMParser;\n}\n\n/**\n * True when in environment that supports touch events\n * @type boolean\n */\nfabric.isTouchSupported = 'ontouchstart' in fabric.window || 'ontouchstart' in fabric.document ||\n  (fabric.window && fabric.window.navigator && fabric.window.navigator.maxTouchPoints > 0);\n\n/**\n * True when in environment that's probably Node.js\n * @type boolean\n */\nfabric.isLikelyNode = typeof Buffer !== 'undefined' &&\n                      typeof window === 'undefined';\n\n/* _FROM_SVG_START_ */\n/**\n * Attributes parsed from all SVG elements\n * @type array\n */\nfabric.SHARED_ATTRIBUTES = [\n  'display',\n  'transform',\n  'fill', 'fill-opacity', 'fill-rule',\n  'opacity',\n  'stroke', 'stroke-dasharray', 'stroke-linecap', 'stroke-dashoffset',\n  'stroke-linejoin', 'stroke-miterlimit',\n  'stroke-opacity', 'stroke-width',\n  'id', 'paint-order', 'vector-effect',\n  'instantiated_by_use', 'clip-path',\n];\n/* _FROM_SVG_END_ */\n\n/**\n * Pixel per Inch as a default value set to 96. Can be changed for more realistic conversion.\n */\nfabric.DPI = 96;\nfabric.reNum = '(?:[-+]?(?:\\\\d+|\\\\d*\\\\.\\\\d+)(?:[eE][-+]?\\\\d+)?)';\nfabric.commaWsp = '(?:\\\\s+,?\\\\s*|,\\\\s*)';\nfabric.rePathCommand = /([-+]?((\\d+\\.\\d+)|((\\d+)|(\\.\\d+)))(?:[eE][-+]?\\d+)?)/ig;\nfabric.reNonWord = /[ \\n\\.,;!\\?\\-]/;\nfabric.fontPaths = { };\nfabric.iMatrix = [1, 0, 0, 1, 0, 0];\nfabric.svgNS = 'http://www.w3.org/2000/svg';\n\n/**\n * Pixel limit for cache canvases. 1Mpx , 4Mpx should be fine.\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.perfLimitSizeTotal = 2097152;\n\n/**\n * Pixel limit for cache canvases width or height. IE fixes the maximum at 5000\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.maxCacheSideLimit = 4096;\n\n/**\n * Lowest pixel limit for cache canvases, set at 256PX\n * @since 1.7.14\n * @type Number\n * @default\n */\nfabric.minCacheSideLimit = 256;\n\n/**\n * Cache Object for widths of chars in text rendering.\n */\nfabric.charWidthsCache = { };\n\n/**\n * if webgl is enabled and available, textureSize will determine the size\n * of the canvas backend\n * @since 2.0.0\n * @type Number\n * @default\n */\nfabric.textureSize = 2048;\n\n/**\n * When 'true', style information is not retained when copy/pasting text, making\n * pasted text use destination style.\n * Defaults to 'false'.\n * @type Boolean\n * @default\n */\nfabric.disableStyleCopyPaste = false;\n\n/**\n * Enable webgl for filtering picture is available\n * A filtering backend will be initialized, this will both take memory and\n * time since a default 2048x2048 canvas will be created for the gl context\n * @since 2.0.0\n * @type Boolean\n * @default\n */\nfabric.enableGLFiltering = true;\n\n/**\n * Device Pixel Ratio\n * @see https://developer.apple.com/library/safari/documentation/AudioVideo/Conceptual/HTML-canvas-guide/SettingUptheCanvas/SettingUptheCanvas.html\n */\nfabric.devicePixelRatio = fabric.window.devicePixelRatio ||\n                          fabric.window.webkitDevicePixelRatio ||\n                          fabric.window.mozDevicePixelRatio ||\n                          1;\n/**\n * Browser-specific constant to adjust CanvasRenderingContext2D.shadowBlur value,\n * which is unitless and not rendered equally across browsers.\n *\n * Values that work quite well (as of October 2017) are:\n * - Chrome: 1.5\n * - Edge: 1.75\n * - Firefox: 0.9\n * - Safari: 0.95\n *\n * @since 2.0.0\n * @type Number\n * @default 1\n */\nfabric.browserShadowBlurConstant = 1;\n\n/**\n * This object contains the result of arc to bezier conversion for faster retrieving if the same arc needs to be converted again.\n * It was an internal variable, is accessible since version 2.3.4\n */\nfabric.arcToSegmentsCache = { };\n\n/**\n * This object keeps the results of the boundsOfCurve calculation mapped by the joined arguments necessary to calculate it.\n * It does speed up calculation, if you parse and add always the same paths, but in case of heavy usage of freedrawing\n * you do not get any speed benefit and you get a big object in memory.\n * The object was a private variable before, while now is appended to the lib so that you have access to it and you\n * can eventually clear it.\n * It was an internal variable, is accessible since version 2.3.4\n */\nfabric.boundsOfCurveCache = { };\n\n/**\n * If disabled boundsOfCurveCache is not used. For apps that make heavy usage of pencil drawing probably disabling it is better\n * @default true\n */\nfabric.cachesBoundsOfCurve = true;\n\n/**\n * Skip performance testing of setupGLContext and force the use of putImageData that seems to be the one that works best on\n * Chrome + old hardware. if your users are experiencing empty images after filtering you may try to force this to true\n * this has to be set before instantiating the filtering backend ( before filtering the first image )\n * @type Boolean\n * @default false\n */\nfabric.forceGLPutImageData = false;\n\nfabric.initFilterBackend = function() {\n  if (fabric.enableGLFiltering && fabric.isWebglSupported && fabric.isWebglSupported(fabric.textureSize)) {\n    console.log('max texture size: ' + fabric.maxTextureSize);\n    return (new fabric.WebglFilterBackend({ tileSize: fabric.textureSize }));\n  }\n  else if (fabric.Canvas2dFilterBackend) {\n    return (new fabric.Canvas2dFilterBackend());\n  }\n};\n\n\nif (typeof document !== 'undefined' && typeof window !== 'undefined') {\n  // ensure globality even if entire library were function wrapped (as in Meteor.js packaging system)\n  window.fabric = fabric;\n}\n\n\n(function() {\n\n  /**\n   * @private\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  function _removeEventListener(eventName, handler) {\n    if (!this.__eventListeners[eventName]) {\n      return;\n    }\n    var eventListener = this.__eventListeners[eventName];\n    if (handler) {\n      eventListener[eventListener.indexOf(handler)] = false;\n    }\n    else {\n      fabric.util.array.fill(eventListener, false);\n    }\n  }\n\n  /**\n   * Observes specified event\n   * @memberOf fabric.Observable\n   * @alias on\n   * @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})\n   * @param {Function} handler Function that receives a notification when an event of the specified type occurs\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function on(eventName, handler) {\n    if (!this.__eventListeners) {\n      this.__eventListeners = { };\n    }\n    // one object with key/value pairs was passed\n    if (arguments.length === 1) {\n      for (var prop in eventName) {\n        this.on(prop, eventName[prop]);\n      }\n    }\n    else {\n      if (!this.__eventListeners[eventName]) {\n        this.__eventListeners[eventName] = [];\n      }\n      this.__eventListeners[eventName].push(handler);\n    }\n    return this;\n  }\n\n  function _once(eventName, handler) {\n    var _handler = function () {\n      handler.apply(this, arguments);\n      this.off(eventName, _handler);\n    }.bind(this);\n    this.on(eventName, _handler);\n  }\n\n  function once(eventName, handler) {\n    // one object with key/value pairs was passed\n    if (arguments.length === 1) {\n      for (var prop in eventName) {\n        _once.call(this, prop, eventName[prop]);\n      }\n    }\n    else {\n      _once.call(this, eventName, handler);\n    }\n    return this;\n  }\n\n  /**\n   * Stops event observing for a particular event handler. Calling this method\n   * without arguments removes all handlers for all events\n   * @memberOf fabric.Observable\n   * @alias off\n   * @param {String|Object} eventName Event name (eg. 'after:render') or object with key/value pairs (eg. {'after:render': handler, 'selection:cleared': handler})\n   * @param {Function} handler Function to be deleted from EventListeners\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function off(eventName, handler) {\n    if (!this.__eventListeners) {\n      return this;\n    }\n\n    // remove all key/value pairs (event name -> event handler)\n    if (arguments.length === 0) {\n      for (eventName in this.__eventListeners) {\n        _removeEventListener.call(this, eventName);\n      }\n    }\n    // one object with key/value pairs was passed\n    else if (arguments.length === 1 && typeof arguments[0] === 'object') {\n      for (var prop in eventName) {\n        _removeEventListener.call(this, prop, eventName[prop]);\n      }\n    }\n    else {\n      _removeEventListener.call(this, eventName, handler);\n    }\n    return this;\n  }\n\n  /**\n   * Fires event with an optional options object\n   * @memberOf fabric.Observable\n   * @param {String} eventName Event name to fire\n   * @param {Object} [options] Options object\n   * @return {Self} thisArg\n   * @chainable\n   */\n  function fire(eventName, options) {\n    if (!this.__eventListeners) {\n      return this;\n    }\n\n    var listenersForEvent = this.__eventListeners[eventName];\n    if (!listenersForEvent) {\n      return this;\n    }\n\n    for (var i = 0, len = listenersForEvent.length; i < len; i++) {\n      listenersForEvent[i] && listenersForEvent[i].call(this, options || { });\n    }\n    this.__eventListeners[eventName] = listenersForEvent.filter(function(value) {\n      return value !== false;\n    });\n    return this;\n  }\n\n  /**\n   * @namespace fabric.Observable\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#events}\n   * @see {@link http://fabricjs.com/events|Events demo}\n   */\n  fabric.Observable = {\n    fire: fire,\n    on: on,\n    once: once,\n    off: off,\n  };\n})();\n\n\n/**\n * @namespace fabric.Collection\n */\nfabric.Collection = {\n\n  _objects: [],\n\n  /**\n   * Adds objects to collection, Canvas or Group, then renders canvas\n   * (if `renderOnAddRemove` is not `false`).\n   * in case of Group no changes to bounding box are made.\n   * Objects should be instances of (or inherit from) fabric.Object\n   * Use of this function is highly discouraged for groups.\n   * you can add a bunch of objects with the add method but then you NEED\n   * to run a addWithUpdate call for the Group class or position/bbox will be wrong.\n   * @param {...fabric.Object} object Zero or more fabric instances\n   * @return {Self} thisArg\n   * @chainable\n   */\n  add: function () {\n    this._objects.push.apply(this._objects, arguments);\n    if (this._onObjectAdded) {\n      for (var i = 0, length = arguments.length; i < length; i++) {\n        this._onObjectAdded(arguments[i]);\n      }\n    }\n    this.renderOnAddRemove && this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Inserts an object into collection at specified index, then renders canvas (if `renderOnAddRemove` is not `false`)\n   * An object should be an instance of (or inherit from) fabric.Object\n   * Use of this function is highly discouraged for groups.\n   * you can add a bunch of objects with the insertAt method but then you NEED\n   * to run a addWithUpdate call for the Group class or position/bbox will be wrong.\n   * @param {Object} object Object to insert\n   * @param {Number} index Index to insert object at\n   * @param {Boolean} nonSplicing When `true`, no splicing (shifting) of objects occurs\n   * @return {Self} thisArg\n   * @chainable\n   */\n  insertAt: function (object, index, nonSplicing) {\n    var objects = this._objects;\n    if (nonSplicing) {\n      objects[index] = object;\n    }\n    else {\n      objects.splice(index, 0, object);\n    }\n    this._onObjectAdded && this._onObjectAdded(object);\n    this.renderOnAddRemove && this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Removes objects from a collection, then renders canvas (if `renderOnAddRemove` is not `false`)\n   * @param {...fabric.Object} object Zero or more fabric instances\n   * @return {Self} thisArg\n   * @chainable\n   */\n  remove: function() {\n    var objects = this._objects,\n        index, somethingRemoved = false;\n\n    for (var i = 0, length = arguments.length; i < length; i++) {\n      index = objects.indexOf(arguments[i]);\n\n      // only call onObjectRemoved if an object was actually removed\n      if (index !== -1) {\n        somethingRemoved = true;\n        objects.splice(index, 1);\n        this._onObjectRemoved && this._onObjectRemoved(arguments[i]);\n      }\n    }\n\n    this.renderOnAddRemove && somethingRemoved && this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Executes given function for each object in this group\n   * @param {Function} callback\n   *                   Callback invoked with current object as first argument,\n   *                   index - as second and an array of all objects - as third.\n   *                   Callback is invoked in a context of Global Object (e.g. `window`)\n   *                   when no `context` argument is given\n   *\n   * @param {Object} context Context (aka thisObject)\n   * @return {Self} thisArg\n   * @chainable\n   */\n  forEachObject: function(callback, context) {\n    var objects = this.getObjects();\n    for (var i = 0, len = objects.length; i < len; i++) {\n      callback.call(context, objects[i], i, objects);\n    }\n    return this;\n  },\n\n  /**\n   * Returns an array of children objects of this instance\n   * Type parameter introduced in 1.3.10\n   * since 2.3.5 this method return always a COPY of the array;\n   * @param {String} [type] When specified, only objects of this type are returned\n   * @return {Array}\n   */\n  getObjects: function(type) {\n    if (typeof type === 'undefined') {\n      return this._objects.concat();\n    }\n    return this._objects.filter(function(o) {\n      return o.type === type;\n    });\n  },\n\n  /**\n   * Returns object at specified index\n   * @param {Number} index\n   * @return {Self} thisArg\n   */\n  item: function (index) {\n    return this._objects[index];\n  },\n\n  /**\n   * Returns true if collection contains no objects\n   * @return {Boolean} true if collection is empty\n   */\n  isEmpty: function () {\n    return this._objects.length === 0;\n  },\n\n  /**\n   * Returns a size of a collection (i.e: length of an array containing its objects)\n   * @return {Number} Collection size\n   */\n  size: function() {\n    return this._objects.length;\n  },\n\n  /**\n   * Returns true if collection contains an object\n   * @param {Object} object Object to check against\n   * @param {Boolean} [deep=false] `true` to check all descendants, `false` to check only `_objects`\n   * @return {Boolean} `true` if collection contains an object\n   */\n  contains: function (object, deep) {\n    if (this._objects.indexOf(object) > -1) {\n      return true;\n    }\n    else if (deep) {\n      return this._objects.some(function (obj) {\n        return typeof obj.contains === 'function' && obj.contains(object, true);\n      });\n    }\n    return false;\n  },\n\n  /**\n   * Returns number representation of a collection complexity\n   * @return {Number} complexity\n   */\n  complexity: function () {\n    return this._objects.reduce(function (memo, current) {\n      memo += current.complexity ? current.complexity() : 0;\n      return memo;\n    }, 0);\n  }\n};\n\n\n/**\n * @namespace fabric.CommonMethods\n */\nfabric.CommonMethods = {\n\n  /**\n   * Sets object's properties from options\n   * @param {Object} [options] Options object\n   */\n  _setOptions: function(options) {\n    for (var prop in options) {\n      this.set(prop, options[prop]);\n    }\n  },\n\n  /**\n   * @private\n   * @param {Object} [filler] Options object\n   * @param {String} [property] property to set the Gradient to\n   */\n  _initGradient: function(filler, property) {\n    if (filler && filler.colorStops && !(filler instanceof fabric.Gradient)) {\n      this.set(property, new fabric.Gradient(filler));\n    }\n  },\n\n  /**\n   * @private\n   * @param {Object} [filler] Options object\n   * @param {String} [property] property to set the Pattern to\n   * @param {Function} [callback] callback to invoke after pattern load\n   */\n  _initPattern: function(filler, property, callback) {\n    if (filler && filler.source && !(filler instanceof fabric.Pattern)) {\n      this.set(property, new fabric.Pattern(filler, callback));\n    }\n    else {\n      callback && callback();\n    }\n  },\n\n  /**\n   * @private\n   */\n  _setObject: function(obj) {\n    for (var prop in obj) {\n      this._set(prop, obj[prop]);\n    }\n  },\n\n  /**\n   * Sets property to a given value. When changing position/dimension -related properties (left, top, scale, angle, etc.) `set` does not update position of object's borders/controls. If you need to update those, call `setCoords()`.\n   * @param {String|Object} key Property name or object (if object, iterate over the object properties)\n   * @param {Object|Function} value Property value (if function, the value is passed into it and its return value is used as a new one)\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  set: function(key, value) {\n    if (typeof key === 'object') {\n      this._setObject(key);\n    }\n    else {\n      this._set(key, value);\n    }\n    return this;\n  },\n\n  _set: function(key, value) {\n    this[key] = value;\n  },\n\n  /**\n   * Toggles specified property from `true` to `false` or from `false` to `true`\n   * @param {String} property Property to toggle\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  toggle: function(property) {\n    var value = this.get(property);\n    if (typeof value === 'boolean') {\n      this.set(property, !value);\n    }\n    return this;\n  },\n\n  /**\n   * Basic getter\n   * @param {String} property Property name\n   * @return {*} value of a property\n   */\n  get: function(property) {\n    return this[property];\n  }\n};\n\n\n(function(global) {\n\n  var sqrt = Math.sqrt,\n      atan2 = Math.atan2,\n      pow = Math.pow,\n      PiBy180 = Math.PI / 180,\n      PiBy2 = Math.PI / 2;\n\n  /**\n   * @namespace fabric.util\n   */\n  fabric.util = {\n\n    /**\n     * Calculate the cos of an angle, avoiding returning floats for known results\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} angle the angle in radians or in degree\n     * @return {Number}\n     */\n    cos: function(angle) {\n      if (angle === 0) { return 1; }\n      if (angle < 0) {\n        // cos(a) = cos(-a)\n        angle = -angle;\n      }\n      var angleSlice = angle / PiBy2;\n      switch (angleSlice) {\n        case 1: case 3: return 0;\n        case 2: return -1;\n      }\n      return Math.cos(angle);\n    },\n\n    /**\n     * Calculate the sin of an angle, avoiding returning floats for known results\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} angle the angle in radians or in degree\n     * @return {Number}\n     */\n    sin: function(angle) {\n      if (angle === 0) { return 0; }\n      var angleSlice = angle / PiBy2, sign = 1;\n      if (angle < 0) {\n        // sin(-a) = -sin(a)\n        sign = -1;\n      }\n      switch (angleSlice) {\n        case 1: return sign;\n        case 2: return 0;\n        case 3: return -sign;\n      }\n      return Math.sin(angle);\n    },\n\n    /**\n     * Removes value from an array.\n     * Presence of value (and its position in an array) is determined via `Array.prototype.indexOf`\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} array\n     * @param {*} value\n     * @return {Array} original array\n     */\n    removeFromArray: function(array, value) {\n      var idx = array.indexOf(value);\n      if (idx !== -1) {\n        array.splice(idx, 1);\n      }\n      return array;\n    },\n\n    /**\n     * Returns random number between 2 specified ones.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} min lower limit\n     * @param {Number} max upper limit\n     * @return {Number} random value (between min and max)\n     */\n    getRandomInt: function(min, max) {\n      return Math.floor(Math.random() * (max - min + 1)) + min;\n    },\n\n    /**\n     * Transforms degrees to radians.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} degrees value in degrees\n     * @return {Number} value in radians\n     */\n    degreesToRadians: function(degrees) {\n      return degrees * PiBy180;\n    },\n\n    /**\n     * Transforms radians to degrees.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number} radians value in radians\n     * @return {Number} value in degrees\n     */\n    radiansToDegrees: function(radians) {\n      return radians / PiBy180;\n    },\n\n    /**\n     * Rotates `point` around `origin` with `radians`\n     * @static\n     * @memberOf fabric.util\n     * @param {fabric.Point} point The point to rotate\n     * @param {fabric.Point} origin The origin of the rotation\n     * @param {Number} radians The radians of the angle for the rotation\n     * @return {fabric.Point} The new rotated point\n     */\n    rotatePoint: function(point, origin, radians) {\n      var newPoint = new fabric.Point(point.x - origin.x, point.y - origin.y),\n          v = fabric.util.rotateVector(newPoint, radians);\n      return new fabric.Point(v.x, v.y).addEquals(origin);\n    },\n\n    /**\n     * Rotates `vector` with `radians`\n     * @static\n     * @memberOf fabric.util\n     * @param {Object} vector The vector to rotate (x and y)\n     * @param {Number} radians The radians of the angle for the rotation\n     * @return {Object} The new rotated point\n     */\n    rotateVector: function(vector, radians) {\n      var sin = fabric.util.sin(radians),\n          cos = fabric.util.cos(radians),\n          rx = vector.x * cos - vector.y * sin,\n          ry = vector.x * sin + vector.y * cos;\n      return {\n        x: rx,\n        y: ry\n      };\n    },\n\n    /**\n     * Creates a vetor from points represented as a point\n     * @static\n     * @memberOf fabric.util\n     *\n     * @typedef {Object} Point\n     * @property {number} x\n     * @property {number} y\n     *\n     * @param {Point} from\n     * @param {Point} to\n     * @returns {Point} vector\n     */\n    createVector: function (from, to) {\n      return new fabric.Point(to.x - from.x, to.y - from.y);\n    },\n\n    /**\n     * Calculates angle between 2 vectors using dot product\n     * @static\n     * @memberOf fabric.util\n     * @param {Point} a\n     * @param {Point} b\n     * @returns the angle in radian between the vectors\n     */\n    calcAngleBetweenVectors: function (a, b) {\n      return Math.acos((a.x * b.x + a.y * b.y) / (Math.hypot(a.x, a.y) * Math.hypot(b.x, b.y)));\n    },\n\n    /**\n     * @static\n     * @memberOf fabric.util\n     * @param {Point} v\n     * @returns {Point} vector representing the unit vector of pointing to the direction of `v`\n     */\n    getHatVector: function (v) {\n      return new fabric.Point(v.x, v.y).multiply(1 / Math.hypot(v.x, v.y));\n    },\n\n    /**\n     * @static\n     * @memberOf fabric.util\n     * @param {Point} A\n     * @param {Point} B\n     * @param {Point} C\n     * @returns {{ vector: Point, angle: number }} vector representing the bisector of A and A's angle\n     */\n    getBisector: function (A, B, C) {\n      var AB = fabric.util.createVector(A, B), AC = fabric.util.createVector(A, C);\n      var alpha = fabric.util.calcAngleBetweenVectors(AB, AC);\n      //  check if alpha is relative to AB->BC\n      var ro = fabric.util.calcAngleBetweenVectors(fabric.util.rotateVector(AB, alpha), AC);\n      var phi = alpha * (ro === 0 ? 1 : -1) / 2;\n      return {\n        vector: fabric.util.getHatVector(fabric.util.rotateVector(AB, phi)),\n        angle: alpha\n      };\n    },\n\n    /**\n     * Project stroke width on points returning 2 projections for each point as follows:\n     * - `miter`: 2 points corresponding to the outer boundary and the inner boundary of stroke.\n     * - `bevel`: 2 points corresponding to the bevel boundaries, tangent to the bisector.\n     * - `round`: same as `bevel`\n     * Used to calculate object's bounding box\n     * @static\n     * @memberOf fabric.util\n     * @param {Point[]} points\n     * @param {Object} options\n     * @param {number} options.strokeWidth\n     * @param {'miter'|'bevel'|'round'} options.strokeLineJoin\n     * @param {number} options.strokeMiterLimit https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/stroke-miterlimit\n     * @param {boolean} options.strokeUniform\n     * @param {number} options.scaleX\n     * @param {number} options.scaleY\n     * @param {boolean} [openPath] whether the shape is open or not, affects the calculations of the first and last points\n     * @returns {fabric.Point[]} array of size 2n/4n of all suspected points\n     */\n    projectStrokeOnPoints: function (points, options, openPath) {\n      var coords = [], s = options.strokeWidth / 2,\n          strokeUniformScalar = options.strokeUniform ?\n            new fabric.Point(1 / options.scaleX, 1 / options.scaleY) : new fabric.Point(1, 1),\n          getStrokeHatVector = function (v) {\n            var scalar = s / (Math.hypot(v.x, v.y));\n            return new fabric.Point(v.x * scalar * strokeUniformScalar.x, v.y * scalar * strokeUniformScalar.y);\n          };\n      if (points.length <= 1) {return coords;}\n      points.forEach(function (p, index) {\n        var A = new fabric.Point(p.x, p.y), B, C;\n        if (index === 0) {\n          C = points[index + 1];\n          B = openPath ? getStrokeHatVector(fabric.util.createVector(C, A)).addEquals(A) : points[points.length - 1];\n        }\n        else if (index === points.length - 1) {\n          B = points[index - 1];\n          C = openPath ? getStrokeHatVector(fabric.util.createVector(B, A)).addEquals(A) : points[0];\n        }\n        else {\n          B = points[index - 1];\n          C = points[index + 1];\n        }\n        var bisector = fabric.util.getBisector(A, B, C),\n            bisectorVector = bisector.vector,\n            alpha = bisector.angle,\n            scalar,\n            miterVector;\n        if (options.strokeLineJoin === 'miter') {\n          scalar = -s / Math.sin(alpha / 2);\n          miterVector = new fabric.Point(\n            bisectorVector.x * scalar * strokeUniformScalar.x,\n            bisectorVector.y * scalar * strokeUniformScalar.y\n          );\n          if (Math.hypot(miterVector.x, miterVector.y) / s <= options.strokeMiterLimit) {\n            coords.push(A.add(miterVector));\n            coords.push(A.subtract(miterVector));\n            return;\n          }\n        }\n        scalar = -s * Math.SQRT2;\n        miterVector = new fabric.Point(\n          bisectorVector.x * scalar * strokeUniformScalar.x,\n          bisectorVector.y * scalar * strokeUniformScalar.y\n        );\n        coords.push(A.add(miterVector));\n        coords.push(A.subtract(miterVector));\n      });\n      return coords;\n    },\n\n    /**\n     * Apply transform t to point p\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Point} p The point to transform\n     * @param  {Array} t The transform\n     * @param  {Boolean} [ignoreOffset] Indicates that the offset should not be applied\n     * @return {fabric.Point} The transformed point\n     */\n    transformPoint: function(p, t, ignoreOffset) {\n      if (ignoreOffset) {\n        return new fabric.Point(\n          t[0] * p.x + t[2] * p.y,\n          t[1] * p.x + t[3] * p.y\n        );\n      }\n      return new fabric.Point(\n        t[0] * p.x + t[2] * p.y + t[4],\n        t[1] * p.x + t[3] * p.y + t[5]\n      );\n    },\n\n    /**\n     * Returns coordinates of points's bounding rectangle (left, top, width, height)\n     * @param {Array} points 4 points array\n     * @param {Array} [transform] an array of 6 numbers representing a 2x3 transform matrix\n     * @return {Object} Object with left, top, width, height properties\n     */\n    makeBoundingBoxFromPoints: function(points, transform) {\n      if (transform) {\n        for (var i = 0; i < points.length; i++) {\n          points[i] = fabric.util.transformPoint(points[i], transform);\n        }\n      }\n      var xPoints = [points[0].x, points[1].x, points[2].x, points[3].x],\n          minX = fabric.util.array.min(xPoints),\n          maxX = fabric.util.array.max(xPoints),\n          width = maxX - minX,\n          yPoints = [points[0].y, points[1].y, points[2].y, points[3].y],\n          minY = fabric.util.array.min(yPoints),\n          maxY = fabric.util.array.max(yPoints),\n          height = maxY - minY;\n\n      return {\n        left: minX,\n        top: minY,\n        width: width,\n        height: height\n      };\n    },\n\n    /**\n     * Invert transformation t\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} t The transform\n     * @return {Array} The inverted transform\n     */\n    invertTransform: function(t) {\n      var a = 1 / (t[0] * t[3] - t[1] * t[2]),\n          r = [a * t[3], -a * t[1], -a * t[2], a * t[0]],\n          o = fabric.util.transformPoint({ x: t[4], y: t[5] }, r, true);\n      r[4] = -o.x;\n      r[5] = -o.y;\n      return r;\n    },\n\n    /**\n     * A wrapper around Number#toFixed, which contrary to native method returns number, not string.\n     * @static\n     * @memberOf fabric.util\n     * @param {Number|String} number number to operate on\n     * @param {Number} fractionDigits number of fraction digits to \"leave\"\n     * @return {Number}\n     */\n    toFixed: function(number, fractionDigits) {\n      return parseFloat(Number(number).toFixed(fractionDigits));\n    },\n\n    /**\n     * Converts from attribute value to pixel value if applicable.\n     * Returns converted pixels or original value not converted.\n     * @param {Number|String} value number to operate on\n     * @param {Number} fontSize\n     * @return {Number|String}\n     */\n    parseUnit: function(value, fontSize) {\n      var unit = /\\D{0,2}$/.exec(value),\n          number = parseFloat(value);\n      if (!fontSize) {\n        fontSize = fabric.Text.DEFAULT_SVG_FONT_SIZE;\n      }\n      switch (unit[0]) {\n        case 'mm':\n          return number * fabric.DPI / 25.4;\n\n        case 'cm':\n          return number * fabric.DPI / 2.54;\n\n        case 'in':\n          return number * fabric.DPI;\n\n        case 'pt':\n          return number * fabric.DPI / 72; // or * 4 / 3\n\n        case 'pc':\n          return number * fabric.DPI / 72 * 12; // or * 16\n\n        case 'em':\n          return number * fontSize;\n\n        default:\n          return number;\n      }\n    },\n\n    /**\n     * Function which always returns `false`.\n     * @static\n     * @memberOf fabric.util\n     * @return {Boolean}\n     */\n    falseFunction: function() {\n      return false;\n    },\n\n    /**\n     * Returns klass \"Class\" object of given namespace\n     * @memberOf fabric.util\n     * @param {String} type Type of object (eg. 'circle')\n     * @param {String} namespace Namespace to get klass \"Class\" object from\n     * @return {Object} klass \"Class\"\n     */\n    getKlass: function(type, namespace) {\n      // capitalize first letter only\n      type = fabric.util.string.camelize(type.charAt(0).toUpperCase() + type.slice(1));\n      return fabric.util.resolveNamespace(namespace)[type];\n    },\n\n    /**\n     * Returns array of attributes for given svg that fabric parses\n     * @memberOf fabric.util\n     * @param {String} type Type of svg element (eg. 'circle')\n     * @return {Array} string names of supported attributes\n     */\n    getSvgAttributes: function(type) {\n      var attributes = [\n        'instantiated_by_use',\n        'style',\n        'id',\n        'class'\n      ];\n      switch (type) {\n        case 'linearGradient':\n          attributes = attributes.concat(['x1', 'y1', 'x2', 'y2', 'gradientUnits', 'gradientTransform']);\n          break;\n        case 'radialGradient':\n          attributes = attributes.concat(['gradientUnits', 'gradientTransform', 'cx', 'cy', 'r', 'fx', 'fy', 'fr']);\n          break;\n        case 'stop':\n          attributes = attributes.concat(['offset', 'stop-color', 'stop-opacity']);\n          break;\n      }\n      return attributes;\n    },\n\n    /**\n     * Returns object of given namespace\n     * @memberOf fabric.util\n     * @param {String} namespace Namespace string e.g. 'fabric.Image.filter' or 'fabric'\n     * @return {Object} Object for given namespace (default fabric)\n     */\n    resolveNamespace: function(namespace) {\n      if (!namespace) {\n        return fabric;\n      }\n\n      var parts = namespace.split('.'),\n          len = parts.length, i,\n          obj = global || fabric.window;\n\n      for (i = 0; i < len; ++i) {\n        obj = obj[parts[i]];\n      }\n\n      return obj;\n    },\n\n    /**\n     * Loads image element from given url and passes it to a callback\n     * @memberOf fabric.util\n     * @param {String} url URL representing an image\n     * @param {Function} callback Callback; invoked with loaded image\n     * @param {*} [context] Context to invoke callback in\n     * @param {Object} [crossOrigin] crossOrigin value to set image element to\n     */\n    loadImage: function(url, callback, context, crossOrigin) {\n      if (!url) {\n        callback && callback.call(context, url);\n        return;\n      }\n\n      var img = fabric.util.createImage();\n\n      /** @ignore */\n      var onLoadCallback = function () {\n        callback && callback.call(context, img, false);\n        img = img.onload = img.onerror = null;\n      };\n\n      img.onload = onLoadCallback;\n      /** @ignore */\n      img.onerror = function() {\n        fabric.log('Error loading ' + img.src);\n        callback && callback.call(context, null, true);\n        img = img.onload = img.onerror = null;\n      };\n\n      // data-urls appear to be buggy with crossOrigin\n      // https://github.com/kangax/fabric.js/commit/d0abb90f1cd5c5ef9d2a94d3fb21a22330da3e0a#commitcomment-4513767\n      // see https://code.google.com/p/chromium/issues/detail?id=315152\n      //     https://bugzilla.mozilla.org/show_bug.cgi?id=935069\n      // crossOrigin null is the same as not set.\n      if (url.indexOf('data') !== 0 &&\n        crossOrigin !== undefined &&\n        crossOrigin !== null) {\n        img.crossOrigin = crossOrigin;\n      }\n\n      // IE10 / IE11-Fix: SVG contents from data: URI\n      // will only be available if the IMG is present\n      // in the DOM (and visible)\n      if (url.substring(0,14) === 'data:image/svg') {\n        img.onload = null;\n        fabric.util.loadImageInDom(img, onLoadCallback);\n      }\n\n      img.src = url;\n    },\n\n    /**\n     * Attaches SVG image with data: URL to the dom\n     * @memberOf fabric.util\n     * @param {Object} img Image object with data:image/svg src\n     * @param {Function} callback Callback; invoked with loaded image\n     * @return {Object} DOM element (div containing the SVG image)\n     */\n    loadImageInDom: function(img, onLoadCallback) {\n      var div = fabric.document.createElement('div');\n      div.style.width = div.style.height = '1px';\n      div.style.left = div.style.top = '-100%';\n      div.style.position = 'absolute';\n      div.appendChild(img);\n      fabric.document.querySelector('body').appendChild(div);\n      /**\n       * Wrap in function to:\n       *   1. Call existing callback\n       *   2. Cleanup DOM\n       */\n      img.onload = function () {\n        onLoadCallback();\n        div.parentNode.removeChild(div);\n        div = null;\n      };\n    },\n\n    /**\n     * Creates corresponding fabric instances from their object representations\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} objects Objects to enliven\n     * @param {Function} callback Callback to invoke when all objects are created\n     * @param {String} namespace Namespace to get klass \"Class\" object from\n     * @param {Function} reviver Method for further parsing of object elements,\n     * called after each fabric object created.\n     */\n    enlivenObjects: function(objects, callback, namespace, reviver) {\n      objects = objects || [];\n\n      var enlivenedObjects = [],\n          numLoadedObjects = 0,\n          numTotalObjects = objects.length;\n\n      function onLoaded() {\n        if (++numLoadedObjects === numTotalObjects) {\n          callback && callback(enlivenedObjects.filter(function(obj) {\n            // filter out undefined objects (objects that gave error)\n            return obj;\n          }));\n        }\n      }\n\n      if (!numTotalObjects) {\n        callback && callback(enlivenedObjects);\n        return;\n      }\n\n      objects.forEach(function (o, index) {\n        // if sparse array\n        if (!o || !o.type) {\n          onLoaded();\n          return;\n        }\n        var klass = fabric.util.getKlass(o.type, namespace);\n        klass.fromObject(o, function (obj, error) {\n          error || (enlivenedObjects[index] = obj);\n          reviver && reviver(o, obj, error);\n          onLoaded();\n        });\n      });\n    },\n\n    /**\n     * Creates corresponding fabric instances residing in an object, e.g. `clipPath`\n     * @see {@link fabric.Object.ENLIVEN_PROPS}\n     * @param {Object} object\n     * @param {Object} [context] assign enlived props to this object (pass null to skip this)\n     * @param {(objects:fabric.Object[]) => void} callback\n     */\n    enlivenObjectEnlivables: function (object, context, callback) {\n      var enlivenProps = fabric.Object.ENLIVEN_PROPS.filter(function (key) { return !!object[key]; });\n      fabric.util.enlivenObjects(enlivenProps.map(function (key) { return object[key]; }), function (enlivedProps) {\n        var objects = {};\n        enlivenProps.forEach(function (key, index) {\n          objects[key] = enlivedProps[index];\n          context && (context[key] = enlivedProps[index]);\n        });\n        callback && callback(objects);\n      });\n    },\n\n    /**\n     * Create and wait for loading of patterns\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} patterns Objects to enliven\n     * @param {Function} callback Callback to invoke when all objects are created\n     * called after each fabric object created.\n     */\n    enlivenPatterns: function(patterns, callback) {\n      patterns = patterns || [];\n\n      function onLoaded() {\n        if (++numLoadedPatterns === numPatterns) {\n          callback && callback(enlivenedPatterns);\n        }\n      }\n\n      var enlivenedPatterns = [],\n          numLoadedPatterns = 0,\n          numPatterns = patterns.length;\n\n      if (!numPatterns) {\n        callback && callback(enlivenedPatterns);\n        return;\n      }\n\n      patterns.forEach(function (p, index) {\n        if (p && p.source) {\n          new fabric.Pattern(p, function(pattern) {\n            enlivenedPatterns[index] = pattern;\n            onLoaded();\n          });\n        }\n        else {\n          enlivenedPatterns[index] = p;\n          onLoaded();\n        }\n      });\n    },\n\n    /**\n     * Groups SVG elements (usually those retrieved from SVG document)\n     * @static\n     * @memberOf fabric.util\n     * @param {Array} elements SVG elements to group\n     * @param {Object} [options] Options object\n     * @param {String} path Value to set sourcePath to\n     * @return {fabric.Object|fabric.Group}\n     */\n    groupSVGElements: function(elements, options, path) {\n      var object;\n      if (elements && elements.length === 1) {\n        if (typeof path !== 'undefined') {\n          elements[0].sourcePath = path;\n        }\n        return elements[0];\n      }\n      if (options) {\n        if (options.width && options.height) {\n          options.centerPoint = {\n            x: options.width / 2,\n            y: options.height / 2\n          };\n        }\n        else {\n          delete options.width;\n          delete options.height;\n        }\n      }\n      object = new fabric.Group(elements, options);\n      if (typeof path !== 'undefined') {\n        object.sourcePath = path;\n      }\n      return object;\n    },\n\n    /**\n     * Populates an object with properties of another object\n     * @static\n     * @memberOf fabric.util\n     * @param {Object} source Source object\n     * @param {Object} destination Destination object\n     * @return {Array} properties Properties names to include\n     */\n    populateWithProperties: function(source, destination, properties) {\n      if (properties && Array.isArray(properties)) {\n        for (var i = 0, len = properties.length; i < len; i++) {\n          if (properties[i] in source) {\n            destination[properties[i]] = source[properties[i]];\n          }\n        }\n      }\n    },\n\n    /**\n     * Creates canvas element\n     * @static\n     * @memberOf fabric.util\n     * @return {CanvasElement} initialized canvas element\n     */\n    createCanvasElement: function() {\n      return fabric.document.createElement('canvas');\n    },\n\n    /**\n     * Creates a canvas element that is a copy of another and is also painted\n     * @param {CanvasElement} canvas to copy size and content of\n     * @static\n     * @memberOf fabric.util\n     * @return {CanvasElement} initialized canvas element\n     */\n    copyCanvasElement: function(canvas) {\n      var newCanvas = fabric.util.createCanvasElement();\n      newCanvas.width = canvas.width;\n      newCanvas.height = canvas.height;\n      newCanvas.getContext('2d').drawImage(canvas, 0, 0);\n      return newCanvas;\n    },\n\n    /**\n     * since 2.6.0 moved from canvas instance to utility.\n     * @param {CanvasElement} canvasEl to copy size and content of\n     * @param {String} format 'jpeg' or 'png', in some browsers 'webp' is ok too\n     * @param {Number} quality <= 1 and > 0\n     * @static\n     * @memberOf fabric.util\n     * @return {String} data url\n     */\n    toDataURL: function(canvasEl, format, quality) {\n      return canvasEl.toDataURL('image/' + format, quality);\n    },\n\n    /**\n     * Creates image element (works on client and node)\n     * @static\n     * @memberOf fabric.util\n     * @return {HTMLImageElement} HTML image element\n     */\n    createImage: function() {\n      return fabric.document.createElement('img');\n    },\n\n    /**\n     * Multiply matrix A by matrix B to nest transformations\n     * @static\n     * @memberOf fabric.util\n     * @param  {Array} a First transformMatrix\n     * @param  {Array} b Second transformMatrix\n     * @param  {Boolean} is2x2 flag to multiply matrices as 2x2 matrices\n     * @return {Array} The product of the two transform matrices\n     */\n    multiplyTransformMatrices: function(a, b, is2x2) {\n      // Matrix multiply a * b\n      return [\n        a[0] * b[0] + a[2] * b[1],\n        a[1] * b[0] + a[3] * b[1],\n        a[0] * b[2] + a[2] * b[3],\n        a[1] * b[2] + a[3] * b[3],\n        is2x2 ? 0 : a[0] * b[4] + a[2] * b[5] + a[4],\n        is2x2 ? 0 : a[1] * b[4] + a[3] * b[5] + a[5]\n      ];\n    },\n\n    /**\n     * Decomposes standard 2x3 matrix into transform components\n     * @static\n     * @memberOf fabric.util\n     * @param  {Array} a transformMatrix\n     * @return {Object} Components of transform\n     */\n    qrDecompose: function(a) {\n      var angle = atan2(a[1], a[0]),\n          denom = pow(a[0], 2) + pow(a[1], 2),\n          scaleX = sqrt(denom),\n          scaleY = (a[0] * a[3] - a[2] * a[1]) / scaleX,\n          skewX = atan2(a[0] * a[2] + a[1] * a [3], denom);\n      return {\n        angle: angle / PiBy180,\n        scaleX: scaleX,\n        scaleY: scaleY,\n        skewX: skewX / PiBy180,\n        skewY: 0,\n        translateX: a[4],\n        translateY: a[5]\n      };\n    },\n\n    /**\n     * Returns a transform matrix starting from an object of the same kind of\n     * the one returned from qrDecompose, useful also if you want to calculate some\n     * transformations from an object that is not enlived yet\n     * @static\n     * @memberOf fabric.util\n     * @param  {Object} options\n     * @param  {Number} [options.angle] angle in degrees\n     * @return {Number[]} transform matrix\n     */\n    calcRotateMatrix: function(options) {\n      if (!options.angle) {\n        return fabric.iMatrix.concat();\n      }\n      var theta = fabric.util.degreesToRadians(options.angle),\n          cos = fabric.util.cos(theta),\n          sin = fabric.util.sin(theta);\n      return [cos, sin, -sin, cos, 0, 0];\n    },\n\n    /**\n     * Returns a transform matrix starting from an object of the same kind of\n     * the one returned from qrDecompose, useful also if you want to calculate some\n     * transformations from an object that is not enlived yet.\n     * is called DimensionsTransformMatrix because those properties are the one that influence\n     * the size of the resulting box of the object.\n     * @static\n     * @memberOf fabric.util\n     * @param  {Object} options\n     * @param  {Number} [options.scaleX]\n     * @param  {Number} [options.scaleY]\n     * @param  {Boolean} [options.flipX]\n     * @param  {Boolean} [options.flipY]\n     * @param  {Number} [options.skewX]\n     * @param  {Number} [options.skewY]\n     * @return {Number[]} transform matrix\n     */\n    calcDimensionsMatrix: function(options) {\n      var scaleX = typeof options.scaleX === 'undefined' ? 1 : options.scaleX,\n          scaleY = typeof options.scaleY === 'undefined' ? 1 : options.scaleY,\n          scaleMatrix = [\n            options.flipX ? -scaleX : scaleX,\n            0,\n            0,\n            options.flipY ? -scaleY : scaleY,\n            0,\n            0],\n          multiply = fabric.util.multiplyTransformMatrices,\n          degreesToRadians = fabric.util.degreesToRadians;\n      if (options.skewX) {\n        scaleMatrix = multiply(\n          scaleMatrix,\n          [1, 0, Math.tan(degreesToRadians(options.skewX)), 1],\n          true);\n      }\n      if (options.skewY) {\n        scaleMatrix = multiply(\n          scaleMatrix,\n          [1, Math.tan(degreesToRadians(options.skewY)), 0, 1],\n          true);\n      }\n      return scaleMatrix;\n    },\n\n    /**\n     * Returns a transform matrix starting from an object of the same kind of\n     * the one returned from qrDecompose, useful also if you want to calculate some\n     * transformations from an object that is not enlived yet\n     * @static\n     * @memberOf fabric.util\n     * @param  {Object} options\n     * @param  {Number} [options.angle]\n     * @param  {Number} [options.scaleX]\n     * @param  {Number} [options.scaleY]\n     * @param  {Boolean} [options.flipX]\n     * @param  {Boolean} [options.flipY]\n     * @param  {Number} [options.skewX]\n     * @param  {Number} [options.skewX]\n     * @param  {Number} [options.translateX]\n     * @param  {Number} [options.translateY]\n     * @return {Number[]} transform matrix\n     */\n    composeMatrix: function(options) {\n      var matrix = [1, 0, 0, 1, options.translateX || 0, options.translateY || 0],\n          multiply = fabric.util.multiplyTransformMatrices;\n      if (options.angle) {\n        matrix = multiply(matrix, fabric.util.calcRotateMatrix(options));\n      }\n      if (options.scaleX !== 1 || options.scaleY !== 1 ||\n          options.skewX || options.skewY || options.flipX || options.flipY) {\n        matrix = multiply(matrix, fabric.util.calcDimensionsMatrix(options));\n      }\n      return matrix;\n    },\n\n    /**\n     * reset an object transform state to neutral. Top and left are not accounted for\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Object} target object to transform\n     */\n    resetObjectTransform: function (target) {\n      target.scaleX = 1;\n      target.scaleY = 1;\n      target.skewX = 0;\n      target.skewY = 0;\n      target.flipX = false;\n      target.flipY = false;\n      target.rotate(0);\n    },\n\n    /**\n     * Extract Object transform values\n     * @static\n     * @memberOf fabric.util\n     * @param  {fabric.Object} target object to read from\n     * @return {Object} Components of transform\n     */\n    saveObjectTransform: function (target) {\n      return {\n        scaleX: target.scaleX,\n        scaleY: target.scaleY,\n        skewX: target.skewX,\n        skewY: target.skewY,\n        angle: target.angle,\n        left: target.left,\n        flipX: target.flipX,\n        flipY: target.flipY,\n        top: target.top\n      };\n    },\n\n    /**\n     * Returns true if context has transparent pixel\n     * at specified location (taking tolerance into account)\n     * @param {CanvasRenderingContext2D} ctx context\n     * @param {Number} x x coordinate\n     * @param {Number} y y coordinate\n     * @param {Number} tolerance Tolerance\n     */\n    isTransparent: function(ctx, x, y, tolerance) {\n\n      // If tolerance is > 0 adjust start coords to take into account.\n      // If moves off Canvas fix to 0\n      if (tolerance > 0) {\n        if (x > tolerance) {\n          x -= tolerance;\n        }\n        else {\n          x = 0;\n        }\n        if (y > tolerance) {\n          y -= tolerance;\n        }\n        else {\n          y = 0;\n        }\n      }\n\n      var _isTransparent = true, i, temp,\n          imageData = ctx.getImageData(x, y, (tolerance * 2) || 1, (tolerance * 2) || 1),\n          l = imageData.data.length;\n\n      // Split image data - for tolerance > 1, pixelDataSize = 4;\n      for (i = 3; i < l; i += 4) {\n        temp = imageData.data[i];\n        _isTransparent = temp <= 0;\n        if (_isTransparent === false) {\n          break; // Stop if colour found\n        }\n      }\n\n      imageData = null;\n\n      return _isTransparent;\n    },\n\n    /**\n     * Parse preserveAspectRatio attribute from element\n     * @param {string} attribute to be parsed\n     * @return {Object} an object containing align and meetOrSlice attribute\n     */\n    parsePreserveAspectRatioAttribute: function(attribute) {\n      var meetOrSlice = 'meet', alignX = 'Mid', alignY = 'Mid',\n          aspectRatioAttrs = attribute.split(' '), align;\n\n      if (aspectRatioAttrs && aspectRatioAttrs.length) {\n        meetOrSlice = aspectRatioAttrs.pop();\n        if (meetOrSlice !== 'meet' && meetOrSlice !== 'slice') {\n          align = meetOrSlice;\n          meetOrSlice = 'meet';\n        }\n        else if (aspectRatioAttrs.length) {\n          align = aspectRatioAttrs.pop();\n        }\n      }\n      //divide align in alignX and alignY\n      alignX = align !== 'none' ? align.slice(1, 4) : 'none';\n      alignY = align !== 'none' ? align.slice(5, 8) : 'none';\n      return {\n        meetOrSlice: meetOrSlice,\n        alignX: alignX,\n        alignY: alignY\n      };\n    },\n\n    /**\n     * Clear char widths cache for the given font family or all the cache if no\n     * fontFamily is specified.\n     * Use it if you know you are loading fonts in a lazy way and you are not waiting\n     * for custom fonts to load properly when adding text objects to the canvas.\n     * If a text object is added when its own font is not loaded yet, you will get wrong\n     * measurement and so wrong bounding boxes.\n     * After the font cache is cleared, either change the textObject text content or call\n     * initDimensions() to trigger a recalculation\n     * @memberOf fabric.util\n     * @param {String} [fontFamily] font family to clear\n     */\n    clearFabricFontCache: function(fontFamily) {\n      fontFamily = (fontFamily || '').toLowerCase();\n      if (!fontFamily) {\n        fabric.charWidthsCache = { };\n      }\n      else if (fabric.charWidthsCache[fontFamily]) {\n        delete fabric.charWidthsCache[fontFamily];\n      }\n    },\n\n    /**\n     * Given current aspect ratio, determines the max width and height that can\n     * respect the total allowed area for the cache.\n     * @memberOf fabric.util\n     * @param {Number} ar aspect ratio\n     * @param {Number} maximumArea Maximum area you want to achieve\n     * @return {Object.x} Limited dimensions by X\n     * @return {Object.y} Limited dimensions by Y\n     */\n    limitDimsByArea: function(ar, maximumArea) {\n      var roughWidth = Math.sqrt(maximumArea * ar),\n          perfLimitSizeY = Math.floor(maximumArea / roughWidth);\n      return { x: Math.floor(roughWidth), y: perfLimitSizeY };\n    },\n\n    capValue: function(min, value, max) {\n      return Math.max(min, Math.min(value, max));\n    },\n\n    /**\n     * Finds the scale for the object source to fit inside the object destination,\n     * keeping aspect ratio intact.\n     * respect the total allowed area for the cache.\n     * @memberOf fabric.util\n     * @param {Object | fabric.Object} source\n     * @param {Number} source.height natural unscaled height of the object\n     * @param {Number} source.width natural unscaled width of the object\n     * @param {Object | fabric.Object} destination\n     * @param {Number} destination.height natural unscaled height of the object\n     * @param {Number} destination.width natural unscaled width of the object\n     * @return {Number} scale factor to apply to source to fit into destination\n     */\n    findScaleToFit: function(source, destination) {\n      return Math.min(destination.width / source.width, destination.height / source.height);\n    },\n\n    /**\n     * Finds the scale for the object source to cover entirely the object destination,\n     * keeping aspect ratio intact.\n     * respect the total allowed area for the cache.\n     * @memberOf fabric.util\n     * @param {Object | fabric.Object} source\n     * @param {Number} source.height natural unscaled height of the object\n     * @param {Number} source.width natural unscaled width of the object\n     * @param {Object | fabric.Object} destination\n     * @param {Number} destination.height natural unscaled height of the object\n     * @param {Number} destination.width natural unscaled width of the object\n     * @return {Number} scale factor to apply to source to cover destination\n     */\n    findScaleToCover: function(source, destination) {\n      return Math.max(destination.width / source.width, destination.height / source.height);\n    },\n\n    /**\n     * given an array of 6 number returns something like `\"matrix(...numbers)\"`\n     * @memberOf fabric.util\n     * @param {Array} transform an array with 6 numbers\n     * @return {String} transform matrix for svg\n     * @return {Object.y} Limited dimensions by Y\n     */\n    matrixToSVG: function(transform) {\n      return 'matrix(' + transform.map(function(value) {\n        return fabric.util.toFixed(value, fabric.Object.NUM_FRACTION_DIGITS);\n      }).join(' ') + ')';\n    },\n\n    /**\n     * given an object and a transform, apply the inverse transform to the object,\n     * this is equivalent to remove from that object that transformation, so that\n     * added in a space with the removed transform, the object will be the same as before.\n     * Removing from an object a transform that scale by 2 is like scaling it by 1/2.\n     * Removing from an object a transfrom that rotate by 30deg is like rotating by 30deg\n     * in the opposite direction.\n     * This util is used to add objects inside transformed groups or nested groups.\n     * @memberOf fabric.util\n     * @param {fabric.Object} object the object you want to transform\n     * @param {Array} transform the destination transform\n     */\n    removeTransformFromObject: function(object, transform) {\n      var inverted = fabric.util.invertTransform(transform),\n          finalTransform = fabric.util.multiplyTransformMatrices(inverted, object.calcOwnMatrix());\n      fabric.util.applyTransformToObject(object, finalTransform);\n    },\n\n    /**\n     * given an object and a transform, apply the transform to the object.\n     * this is equivalent to change the space where the object is drawn.\n     * Adding to an object a transform that scale by 2 is like scaling it by 2.\n     * This is used when removing an object from an active selection for example.\n     * @memberOf fabric.util\n     * @param {fabric.Object} object the object you want to transform\n     * @param {Array} transform the destination transform\n     */\n    addTransformToObject: function(object, transform) {\n      fabric.util.applyTransformToObject(\n        object,\n        fabric.util.multiplyTransformMatrices(transform, object.calcOwnMatrix())\n      );\n    },\n\n    /**\n     * discard an object transform state and apply the one from the matrix.\n     * @memberOf fabric.util\n     * @param {fabric.Object} object the object you want to transform\n     * @param {Array} transform the destination transform\n     */\n    applyTransformToObject: function(object, transform) {\n      var options = fabric.util.qrDecompose(transform),\n          center = new fabric.Point(options.translateX, options.translateY);\n      object.flipX = false;\n      object.flipY = false;\n      object.set('scaleX', options.scaleX);\n      object.set('scaleY', options.scaleY);\n      object.skewX = options.skewX;\n      object.skewY = options.skewY;\n      object.angle = options.angle;\n      object.setPositionByOrigin(center, 'center', 'center');\n    },\n\n    /**\n     * given a width and height, return the size of the bounding box\n     * that can contains the box with width/height with applied transform\n     * described in options.\n     * Use to calculate the boxes around objects for controls.\n     * @memberOf fabric.util\n     * @param {Number} width\n     * @param {Number} height\n     * @param {Object} options\n     * @param {Number} options.scaleX\n     * @param {Number} options.scaleY\n     * @param {Number} options.skewX\n     * @param {Number} options.skewY\n     * @return {Object.x} width of containing\n     * @return {Object.y} height of containing\n     */\n    sizeAfterTransform: function(width, height, options) {\n      var dimX = width / 2, dimY = height / 2,\n          points = [\n            {\n              x: -dimX,\n              y: -dimY\n            },\n            {\n              x: dimX,\n              y: -dimY\n            },\n            {\n              x: -dimX,\n              y: dimY\n            },\n            {\n              x: dimX,\n              y: dimY\n            }],\n          transformMatrix = fabric.util.calcDimensionsMatrix(options),\n          bbox = fabric.util.makeBoundingBoxFromPoints(points, transformMatrix);\n      return {\n        x: bbox.width,\n        y: bbox.height,\n      };\n    },\n\n    /**\n     * Merges 2 clip paths into one visually equal clip path\n     *\n     * **IMPORTANT**:\\\n     * Does **NOT** clone the arguments, clone them proir if necessary.\n     *\n     * Creates a wrapper (group) that contains one clip path and is clipped by the other so content is kept where both overlap.\n     * Use this method if both the clip paths may have nested clip paths of their own, so assigning one to the other's clip path property is not possible.\n     *\n     * In order to handle the `inverted` property we follow logic described in the following cases:\\\n     * **(1)** both clip paths are inverted - the clip paths pass the inverted prop to the wrapper and loose it themselves.\\\n     * **(2)** one is inverted and the other isn't - the wrapper shouldn't become inverted and the inverted clip path must clip the non inverted one to produce an identical visual effect.\\\n     * **(3)** both clip paths are not inverted - wrapper and clip paths remain unchanged.\n     *\n     * @memberOf fabric.util\n     * @param {fabric.Object} c1\n     * @param {fabric.Object} c2\n     * @returns {fabric.Object} merged clip path\n     */\n    mergeClipPaths: function (c1, c2) {\n      var a = c1, b = c2;\n      if (a.inverted && !b.inverted) {\n        //  case (2)\n        a = c2;\n        b = c1;\n      }\n      //  `b` becomes `a`'s clip path so we transform `b` to `a` coordinate plane\n      fabric.util.applyTransformToObject(\n        b,\n        fabric.util.multiplyTransformMatrices(\n          fabric.util.invertTransform(a.calcTransformMatrix()),\n          b.calcTransformMatrix()\n        )\n      );\n      //  assign the `inverted` prop to the wrapping group\n      var inverted = a.inverted && b.inverted;\n      if (inverted) {\n        //  case (1)\n        a.inverted = b.inverted = false;\n      }\n      return new fabric.Group([a], { clipPath: b, inverted: inverted });\n    },\n\n    /**\n     * @memberOf fabric.util\n     * @param {Object} prevStyle first style to compare\n     * @param {Object} thisStyle second style to compare\n     * @param {boolean} forTextSpans whether to check overline, underline, and line-through properties\n     * @return {boolean} true if the style changed\n     */\n    hasStyleChanged: function(prevStyle, thisStyle, forTextSpans) {\n      forTextSpans = forTextSpans || false;\n      return (prevStyle.fill !== thisStyle.fill ||\n              prevStyle.stroke !== thisStyle.stroke ||\n              prevStyle.strokeWidth !== thisStyle.strokeWidth ||\n              prevStyle.fontSize !== thisStyle.fontSize ||\n              prevStyle.fontFamily !== thisStyle.fontFamily ||\n              prevStyle.fontWeight !== thisStyle.fontWeight ||\n              prevStyle.fontStyle !== thisStyle.fontStyle ||\n              prevStyle.textBackgroundColor !== thisStyle.textBackgroundColor ||\n              prevStyle.deltaY !== thisStyle.deltaY) ||\n              (forTextSpans &&\n                (prevStyle.overline !== thisStyle.overline ||\n                prevStyle.underline !== thisStyle.underline ||\n                prevStyle.linethrough !== thisStyle.linethrough));\n    },\n\n    /**\n     * Returns the array form of a text object's inline styles property with styles grouped in ranges\n     * rather than per character. This format is less verbose, and is better suited for storage\n     * so it is used in serialization (not during runtime).\n     * @memberOf fabric.util\n     * @param {object} styles per character styles for a text object\n     * @param {String} text the text string that the styles are applied to\n     * @return {{start: number, end: number, style: object}[]}\n     */\n    stylesToArray: function(styles, text) {\n      // clone style structure to prevent mutation\n      var styles = fabric.util.object.clone(styles, true),\n          textLines = text.split('\\n'),\n          charIndex = -1, prevStyle = {}, stylesArray = [];\n      //loop through each textLine\n      for (var i = 0; i < textLines.length; i++) {\n        if (!styles[i]) {\n          //no styles exist for this line, so add the line's length to the charIndex total\n          charIndex += textLines[i].length;\n          continue;\n        }\n        //loop through each character of the current line\n        for (var c = 0; c < textLines[i].length; c++) {\n          charIndex++;\n          var thisStyle = styles[i][c];\n          //check if style exists for this character\n          if (thisStyle && Object.keys(thisStyle).length > 0) {\n            var styleChanged = fabric.util.hasStyleChanged(prevStyle, thisStyle, true);\n            if (styleChanged) {\n              stylesArray.push({\n                start: charIndex,\n                end: charIndex + 1,\n                style: thisStyle\n              });\n            }\n            else {\n              //if style is the same as previous character, increase end index\n              stylesArray[stylesArray.length - 1].end++;\n            }\n          }\n          prevStyle = thisStyle || {};\n        }\n      }\n      return stylesArray;\n    },\n\n    /**\n     * Returns the object form of the styles property with styles that are assigned per\n     * character rather than grouped by range. This format is more verbose, and is\n     * only used during runtime (not for serialization/storage)\n     * @memberOf fabric.util\n     * @param {Array} styles the serialized form of a text object's styles\n     * @param {String} text the text string that the styles are applied to\n     * @return {Object}\n     */\n    stylesFromArray: function(styles, text) {\n      if (!Array.isArray(styles)) {\n        return styles;\n      }\n      var textLines = text.split('\\n'),\n          charIndex = -1, styleIndex = 0, stylesObject = {};\n      //loop through each textLine\n      for (var i = 0; i < textLines.length; i++) {\n        //loop through each character of the current line\n        for (var c = 0; c < textLines[i].length; c++) {\n          charIndex++;\n          //check if there's a style collection that includes the current character\n          if (styles[styleIndex]\n            && styles[styleIndex].start <= charIndex\n            && charIndex < styles[styleIndex].end) {\n            //create object for line index if it doesn't exist\n            stylesObject[i] = stylesObject[i] || {};\n            //assign a style at this character's index\n            stylesObject[i][c] = Object.assign({}, styles[styleIndex].style);\n            //if character is at the end of the current style collection, move to the next\n            if (charIndex === styles[styleIndex].end - 1) {\n              styleIndex++;\n            }\n          }\n        }\n      }\n      return stylesObject;\n    }\n  };\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n  var _join = Array.prototype.join,\n      commandLengths = {\n        m: 2,\n        l: 2,\n        h: 1,\n        v: 1,\n        c: 6,\n        s: 4,\n        q: 4,\n        t: 2,\n        a: 7\n      },\n      repeatedCommands = {\n        m: 'l',\n        M: 'L'\n      };\n  function segmentToBezier(th2, th3, cosTh, sinTh, rx, ry, cx1, cy1, mT, fromX, fromY) {\n    var costh2 = fabric.util.cos(th2),\n        sinth2 = fabric.util.sin(th2),\n        costh3 = fabric.util.cos(th3),\n        sinth3 = fabric.util.sin(th3),\n        toX = cosTh * rx * costh3 - sinTh * ry * sinth3 + cx1,\n        toY = sinTh * rx * costh3 + cosTh * ry * sinth3 + cy1,\n        cp1X = fromX + mT * ( -cosTh * rx * sinth2 - sinTh * ry * costh2),\n        cp1Y = fromY + mT * ( -sinTh * rx * sinth2 + cosTh * ry * costh2),\n        cp2X = toX + mT * ( cosTh * rx * sinth3 + sinTh * ry * costh3),\n        cp2Y = toY + mT * ( sinTh * rx * sinth3 - cosTh * ry * costh3);\n\n    return ['C',\n      cp1X, cp1Y,\n      cp2X, cp2Y,\n      toX, toY\n    ];\n  }\n\n  /* Adapted from http://dxr.mozilla.org/mozilla-central/source/content/svg/content/src/nsSVGPathDataParser.cpp\n   * by Andrea Bogazzi code is under MPL. if you don't have a copy of the license you can take it here\n   * http://mozilla.org/MPL/2.0/\n   */\n  function arcToSegments(toX, toY, rx, ry, large, sweep, rotateX) {\n    var PI = Math.PI, th = rotateX * PI / 180,\n        sinTh = fabric.util.sin(th),\n        cosTh = fabric.util.cos(th),\n        fromX = 0, fromY = 0;\n\n    rx = Math.abs(rx);\n    ry = Math.abs(ry);\n\n    var px = -cosTh * toX * 0.5 - sinTh * toY * 0.5,\n        py = -cosTh * toY * 0.5 + sinTh * toX * 0.5,\n        rx2 = rx * rx, ry2 = ry * ry, py2 = py * py, px2 = px * px,\n        pl = rx2 * ry2 - rx2 * py2 - ry2 * px2,\n        root = 0;\n\n    if (pl < 0) {\n      var s = Math.sqrt(1 - pl / (rx2 * ry2));\n      rx *= s;\n      ry *= s;\n    }\n    else {\n      root = (large === sweep ? -1.0 : 1.0) *\n              Math.sqrt( pl / (rx2 * py2 + ry2 * px2));\n    }\n\n    var cx = root * rx * py / ry,\n        cy = -root * ry * px / rx,\n        cx1 = cosTh * cx - sinTh * cy + toX * 0.5,\n        cy1 = sinTh * cx + cosTh * cy + toY * 0.5,\n        mTheta = calcVectorAngle(1, 0, (px - cx) / rx, (py - cy) / ry),\n        dtheta = calcVectorAngle((px - cx) / rx, (py - cy) / ry, (-px - cx) / rx, (-py - cy) / ry);\n\n    if (sweep === 0 && dtheta > 0) {\n      dtheta -= 2 * PI;\n    }\n    else if (sweep === 1 && dtheta < 0) {\n      dtheta += 2 * PI;\n    }\n\n    // Convert into cubic bezier segments <= 90deg\n    var segments = Math.ceil(Math.abs(dtheta / PI * 2)),\n        result = [], mDelta = dtheta / segments,\n        mT = 8 / 3 * Math.sin(mDelta / 4) * Math.sin(mDelta / 4) / Math.sin(mDelta / 2),\n        th3 = mTheta + mDelta;\n\n    for (var i = 0; i < segments; i++) {\n      result[i] = segmentToBezier(mTheta, th3, cosTh, sinTh, rx, ry, cx1, cy1, mT, fromX, fromY);\n      fromX = result[i][5];\n      fromY = result[i][6];\n      mTheta = th3;\n      th3 += mDelta;\n    }\n    return result;\n  }\n\n  /*\n   * Private\n   */\n  function calcVectorAngle(ux, uy, vx, vy) {\n    var ta = Math.atan2(uy, ux),\n        tb = Math.atan2(vy, vx);\n    if (tb >= ta) {\n      return tb - ta;\n    }\n    else {\n      return 2 * Math.PI - (ta - tb);\n    }\n  }\n\n  /**\n   * Calculate bounding box of a beziercurve\n   * @param {Number} x0 starting point\n   * @param {Number} y0\n   * @param {Number} x1 first control point\n   * @param {Number} y1\n   * @param {Number} x2 secondo control point\n   * @param {Number} y2\n   * @param {Number} x3 end of bezier\n   * @param {Number} y3\n   */\n  // taken from http://jsbin.com/ivomiq/56/edit  no credits available for that.\n  // TODO: can we normalize this with the starting points set at 0 and then translated the bbox?\n  function getBoundsOfCurve(x0, y0, x1, y1, x2, y2, x3, y3) {\n    var argsString;\n    if (fabric.cachesBoundsOfCurve) {\n      argsString = _join.call(arguments);\n      if (fabric.boundsOfCurveCache[argsString]) {\n        return fabric.boundsOfCurveCache[argsString];\n      }\n    }\n\n    var sqrt = Math.sqrt,\n        min = Math.min, max = Math.max,\n        abs = Math.abs, tvalues = [],\n        bounds = [[], []],\n        a, b, c, t, t1, t2, b2ac, sqrtb2ac;\n\n    b = 6 * x0 - 12 * x1 + 6 * x2;\n    a = -3 * x0 + 9 * x1 - 9 * x2 + 3 * x3;\n    c = 3 * x1 - 3 * x0;\n\n    for (var i = 0; i < 2; ++i) {\n      if (i > 0) {\n        b = 6 * y0 - 12 * y1 + 6 * y2;\n        a = -3 * y0 + 9 * y1 - 9 * y2 + 3 * y3;\n        c = 3 * y1 - 3 * y0;\n      }\n\n      if (abs(a) < 1e-12) {\n        if (abs(b) < 1e-12) {\n          continue;\n        }\n        t = -c / b;\n        if (0 < t && t < 1) {\n          tvalues.push(t);\n        }\n        continue;\n      }\n      b2ac = b * b - 4 * c * a;\n      if (b2ac < 0) {\n        continue;\n      }\n      sqrtb2ac = sqrt(b2ac);\n      t1 = (-b + sqrtb2ac) / (2 * a);\n      if (0 < t1 && t1 < 1) {\n        tvalues.push(t1);\n      }\n      t2 = (-b - sqrtb2ac) / (2 * a);\n      if (0 < t2 && t2 < 1) {\n        tvalues.push(t2);\n      }\n    }\n\n    var x, y, j = tvalues.length, jlen = j, mt;\n    while (j--) {\n      t = tvalues[j];\n      mt = 1 - t;\n      x = (mt * mt * mt * x0) + (3 * mt * mt * t * x1) + (3 * mt * t * t * x2) + (t * t * t * x3);\n      bounds[0][j] = x;\n\n      y = (mt * mt * mt * y0) + (3 * mt * mt * t * y1) + (3 * mt * t * t * y2) + (t * t * t * y3);\n      bounds[1][j] = y;\n    }\n\n    bounds[0][jlen] = x0;\n    bounds[1][jlen] = y0;\n    bounds[0][jlen + 1] = x3;\n    bounds[1][jlen + 1] = y3;\n    var result = [\n      {\n        x: min.apply(null, bounds[0]),\n        y: min.apply(null, bounds[1])\n      },\n      {\n        x: max.apply(null, bounds[0]),\n        y: max.apply(null, bounds[1])\n      }\n    ];\n    if (fabric.cachesBoundsOfCurve) {\n      fabric.boundsOfCurveCache[argsString] = result;\n    }\n    return result;\n  }\n\n  /**\n   * Converts arc to a bunch of bezier curves\n   * @param {Number} fx starting point x\n   * @param {Number} fy starting point y\n   * @param {Array} coords Arc command\n   */\n  function fromArcToBeziers(fx, fy, coords) {\n    var rx = coords[1],\n        ry = coords[2],\n        rot = coords[3],\n        large = coords[4],\n        sweep = coords[5],\n        tx = coords[6],\n        ty = coords[7],\n        segsNorm = arcToSegments(tx - fx, ty - fy, rx, ry, large, sweep, rot);\n\n    for (var i = 0, len = segsNorm.length; i < len; i++) {\n      segsNorm[i][1] += fx;\n      segsNorm[i][2] += fy;\n      segsNorm[i][3] += fx;\n      segsNorm[i][4] += fy;\n      segsNorm[i][5] += fx;\n      segsNorm[i][6] += fy;\n    }\n    return segsNorm;\n  };\n\n  /**\n   * This function take a parsed SVG path and make it simpler for fabricJS logic.\n   * simplification consist of: only UPPERCASE absolute commands ( relative converted to absolute )\n   * S converted in C, T converted in Q, A converted in C.\n   * @param {Array} path the array of commands of a parsed svg path for fabric.Path\n   * @return {Array} the simplified array of commands of a parsed svg path for fabric.Path\n   */\n  function makePathSimpler(path) {\n    // x and y represent the last point of the path. the previous command point.\n    // we add them to each relative command to make it an absolute comment.\n    // we also swap the v V h H with L, because are easier to transform.\n    var x = 0, y = 0, len = path.length,\n        // x1 and y1 represent the last point of the subpath. the subpath is started with\n        // m or M command. When a z or Z command is drawn, x and y need to be resetted to\n        // the last x1 and y1.\n        x1 = 0, y1 = 0, current, i, converted,\n        // previous will host the letter of the previous command, to handle S and T.\n        // controlX and controlY will host the previous reflected control point\n        destinationPath = [], previous, controlX, controlY;\n    for (i = 0; i < len; ++i) {\n      converted = false;\n      current = path[i].slice(0);\n      switch (current[0]) { // first letter\n        case 'l': // lineto, relative\n          current[0] = 'L';\n          current[1] += x;\n          current[2] += y;\n          // falls through\n        case 'L':\n          x = current[1];\n          y = current[2];\n          break;\n        case 'h': // horizontal lineto, relative\n          current[1] += x;\n          // falls through\n        case 'H':\n          current[0] = 'L';\n          current[2] = y;\n          x = current[1];\n          break;\n        case 'v': // vertical lineto, relative\n          current[1] += y;\n          // falls through\n        case 'V':\n          current[0] = 'L';\n          y = current[1];\n          current[1] = x;\n          current[2] = y;\n          break;\n        case 'm': // moveTo, relative\n          current[0] = 'M';\n          current[1] += x;\n          current[2] += y;\n          // falls through\n        case 'M':\n          x = current[1];\n          y = current[2];\n          x1 = current[1];\n          y1 = current[2];\n          break;\n        case 'c': // bezierCurveTo, relative\n          current[0] = 'C';\n          current[1] += x;\n          current[2] += y;\n          current[3] += x;\n          current[4] += y;\n          current[5] += x;\n          current[6] += y;\n          // falls through\n        case 'C':\n          controlX = current[3];\n          controlY = current[4];\n          x = current[5];\n          y = current[6];\n          break;\n        case 's': // shorthand cubic bezierCurveTo, relative\n          current[0] = 'S';\n          current[1] += x;\n          current[2] += y;\n          current[3] += x;\n          current[4] += y;\n          // falls through\n        case 'S':\n          // would be sScC but since we are swapping sSc for C, we check just that.\n          if (previous === 'C') {\n            // calculate reflection of previous control points\n            controlX = 2 * x - controlX;\n            controlY = 2 * y - controlY;\n          }\n          else {\n            // If there is no previous command or if the previous command was not a C, c, S, or s,\n            // the control point is coincident with the current point\n            controlX = x;\n            controlY = y;\n          }\n          x = current[3];\n          y = current[4];\n          current[0] = 'C';\n          current[5] = current[3];\n          current[6] = current[4];\n          current[3] = current[1];\n          current[4] = current[2];\n          current[1] = controlX;\n          current[2] = controlY;\n          // current[3] and current[4] are NOW the second control point.\n          // we keep it for the next reflection.\n          controlX = current[3];\n          controlY = current[4];\n          break;\n        case 'q': // quadraticCurveTo, relative\n          current[0] = 'Q';\n          current[1] += x;\n          current[2] += y;\n          current[3] += x;\n          current[4] += y;\n          // falls through\n        case 'Q':\n          controlX = current[1];\n          controlY = current[2];\n          x = current[3];\n          y = current[4];\n          break;\n        case 't': // shorthand quadraticCurveTo, relative\n          current[0] = 'T';\n          current[1] += x;\n          current[2] += y;\n          // falls through\n        case 'T':\n          if (previous === 'Q') {\n            // calculate reflection of previous control point\n            controlX = 2 * x - controlX;\n            controlY = 2 * y - controlY;\n          }\n          else {\n            // If there is no previous command or if the previous command was not a Q, q, T or t,\n            // assume the control point is coincident with the current point\n            controlX = x;\n            controlY = y;\n          }\n          current[0] = 'Q';\n          x = current[1];\n          y = current[2];\n          current[1] = controlX;\n          current[2] = controlY;\n          current[3] = x;\n          current[4] = y;\n          break;\n        case 'a':\n          current[0] = 'A';\n          current[6] += x;\n          current[7] += y;\n          // falls through\n        case 'A':\n          converted = true;\n          destinationPath = destinationPath.concat(fromArcToBeziers(x, y, current));\n          x = current[6];\n          y = current[7];\n          break;\n        case 'z':\n        case 'Z':\n          x = x1;\n          y = y1;\n          break;\n        default:\n      }\n      if (!converted) {\n        destinationPath.push(current);\n      }\n      previous = current[0];\n    }\n    return destinationPath;\n  };\n\n  /**\n   * Calc length from point x1,y1 to x2,y2\n   * @param {Number} x1 starting point x\n   * @param {Number} y1 starting point y\n   * @param {Number} x2 starting point x\n   * @param {Number} y2 starting point y\n   * @return {Number} length of segment\n   */\n  function calcLineLength(x1, y1, x2, y2) {\n    return Math.sqrt((x2 - x1) * (x2 - x1) + (y2 - y1) * (y2 - y1));\n  }\n\n  // functions for the Cubic beizer\n  // taken from: https://github.com/konvajs/konva/blob/7.0.5/src/shapes/Path.ts#L350\n  function CB1(t) {\n    return t * t * t;\n  }\n  function CB2(t) {\n    return 3 * t * t * (1 - t);\n  }\n  function CB3(t) {\n    return 3 * t * (1 - t) * (1 - t);\n  }\n  function CB4(t) {\n    return (1 - t) * (1 - t) * (1 - t);\n  }\n\n  function getPointOnCubicBezierIterator(p1x, p1y, p2x, p2y, p3x, p3y, p4x, p4y) {\n    return function(pct) {\n      var c1 = CB1(pct), c2 = CB2(pct), c3 = CB3(pct), c4 = CB4(pct);\n      return {\n        x: p4x * c1 + p3x * c2 + p2x * c3 + p1x * c4,\n        y: p4y * c1 + p3y * c2 + p2y * c3 + p1y * c4\n      };\n    };\n  }\n\n  function getTangentCubicIterator(p1x, p1y, p2x, p2y, p3x, p3y, p4x, p4y) {\n    return function (pct) {\n      var invT = 1 - pct,\n          tangentX = (3 * invT * invT * (p2x - p1x)) + (6 * invT * pct * (p3x - p2x)) +\n          (3 * pct * pct * (p4x - p3x)),\n          tangentY = (3 * invT * invT * (p2y - p1y)) + (6 * invT * pct * (p3y - p2y)) +\n          (3 * pct * pct * (p4y - p3y));\n      return Math.atan2(tangentY, tangentX);\n    };\n  }\n\n  function QB1(t) {\n    return t * t;\n  }\n\n  function QB2(t) {\n    return 2 * t * (1 - t);\n  }\n\n  function QB3(t) {\n    return (1 - t) * (1 - t);\n  }\n\n  function getPointOnQuadraticBezierIterator(p1x, p1y, p2x, p2y, p3x, p3y) {\n    return function(pct) {\n      var c1 = QB1(pct), c2 = QB2(pct), c3 = QB3(pct);\n      return {\n        x: p3x * c1 + p2x * c2 + p1x * c3,\n        y: p3y * c1 + p2y * c2 + p1y * c3\n      };\n    };\n  }\n\n  function getTangentQuadraticIterator(p1x, p1y, p2x, p2y, p3x, p3y) {\n    return function (pct) {\n      var invT = 1 - pct,\n          tangentX = (2 * invT * (p2x - p1x)) + (2 * pct * (p3x - p2x)),\n          tangentY = (2 * invT * (p2y - p1y)) + (2 * pct * (p3y - p2y));\n      return Math.atan2(tangentY, tangentX);\n    };\n  }\n\n\n  // this will run over a path segment ( a cubic or quadratic segment) and approximate it\n  // with 100 segemnts. This will good enough to calculate the length of the curve\n  function pathIterator(iterator, x1, y1) {\n    var tempP = { x: x1, y: y1 }, p, tmpLen = 0, perc;\n    for (perc = 1; perc <= 100; perc += 1) {\n      p = iterator(perc / 100);\n      tmpLen += calcLineLength(tempP.x, tempP.y, p.x, p.y);\n      tempP = p;\n    }\n    return tmpLen;\n  }\n\n  /**\n   * Given a pathInfo, and a distance in pixels, find the percentage from 0 to 1\n   * that correspond to that pixels run over the path.\n   * The percentage will be then used to find the correct point on the canvas for the path.\n   * @param {Array} segInfo fabricJS collection of information on a parsed path\n   * @param {Number} distance from starting point, in pixels.\n   * @return {Object} info object with x and y ( the point on canvas ) and angle, the tangent on that point;\n   */\n  function findPercentageForDistance(segInfo, distance) {\n    var perc = 0, tmpLen = 0, iterator = segInfo.iterator, tempP = { x: segInfo.x, y: segInfo.y },\n        p, nextLen, nextStep = 0.01, angleFinder = segInfo.angleFinder, lastPerc;\n    // nextStep > 0.0001 covers 0.00015625 that 1/64th of 1/100\n    // the path\n    while (tmpLen < distance && nextStep > 0.0001) {\n      p = iterator(perc);\n      lastPerc = perc;\n      nextLen = calcLineLength(tempP.x, tempP.y, p.x, p.y);\n      // compare tmpLen each cycle with distance, decide next perc to test.\n      if ((nextLen + tmpLen) > distance) {\n        // we discard this step and we make smaller steps.\n        perc -= nextStep;\n        nextStep /= 2;\n      }\n      else {\n        tempP = p;\n        perc += nextStep;\n        tmpLen += nextLen;\n      }\n    }\n    p.angle = angleFinder(lastPerc);\n    return p;\n  }\n\n  /**\n   * Run over a parsed and simplifed path and extrac some informations.\n   * informations are length of each command and starting point\n   * @param {Array} path fabricJS parsed path commands\n   * @return {Array} path commands informations\n   */\n  function getPathSegmentsInfo(path) {\n    var totalLength = 0, len = path.length, current,\n        //x2 and y2 are the coords of segment start\n        //x1 and y1 are the coords of the current point\n        x1 = 0, y1 = 0, x2 = 0, y2 = 0, info = [], iterator, tempInfo, angleFinder;\n    for (var i = 0; i < len; i++) {\n      current = path[i];\n      tempInfo = {\n        x: x1,\n        y: y1,\n        command: current[0],\n      };\n      switch (current[0]) { //first letter\n        case 'M':\n          tempInfo.length = 0;\n          x2 = x1 = current[1];\n          y2 = y1 = current[2];\n          break;\n        case 'L':\n          tempInfo.length = calcLineLength(x1, y1, current[1], current[2]);\n          x1 = current[1];\n          y1 = current[2];\n          break;\n        case 'C':\n          iterator = getPointOnCubicBezierIterator(\n            x1,\n            y1,\n            current[1],\n            current[2],\n            current[3],\n            current[4],\n            current[5],\n            current[6]\n          );\n          angleFinder = getTangentCubicIterator(\n            x1,\n            y1,\n            current[1],\n            current[2],\n            current[3],\n            current[4],\n            current[5],\n            current[6]\n          );\n          tempInfo.iterator = iterator;\n          tempInfo.angleFinder = angleFinder;\n          tempInfo.length = pathIterator(iterator, x1, y1);\n          x1 = current[5];\n          y1 = current[6];\n          break;\n        case 'Q':\n          iterator = getPointOnQuadraticBezierIterator(\n            x1,\n            y1,\n            current[1],\n            current[2],\n            current[3],\n            current[4]\n          );\n          angleFinder = getTangentQuadraticIterator(\n            x1,\n            y1,\n            current[1],\n            current[2],\n            current[3],\n            current[4]\n          );\n          tempInfo.iterator = iterator;\n          tempInfo.angleFinder = angleFinder;\n          tempInfo.length = pathIterator(iterator, x1, y1);\n          x1 = current[3];\n          y1 = current[4];\n          break;\n        case 'Z':\n        case 'z':\n          // we add those in order to ease calculations later\n          tempInfo.destX = x2;\n          tempInfo.destY = y2;\n          tempInfo.length = calcLineLength(x1, y1, x2, y2);\n          x1 = x2;\n          y1 = y2;\n          break;\n      }\n      totalLength += tempInfo.length;\n      info.push(tempInfo);\n    }\n    info.push({ length: totalLength, x: x1, y: y1 });\n    return info;\n  }\n\n  function getPointOnPath(path, distance, infos) {\n    if (!infos) {\n      infos = getPathSegmentsInfo(path);\n    }\n    var i = 0;\n    while ((distance - infos[i].length > 0) && i < (infos.length - 2)) {\n      distance -= infos[i].length;\n      i++;\n    }\n    // var distance = infos[infos.length - 1] * perc;\n    var segInfo = infos[i], segPercent = distance / segInfo.length,\n        command = segInfo.command, segment = path[i], info;\n\n    switch (command) {\n      case 'M':\n        return { x: segInfo.x, y: segInfo.y, angle: 0 };\n      case 'Z':\n      case 'z':\n        info = new fabric.Point(segInfo.x, segInfo.y).lerp(\n          new fabric.Point(segInfo.destX, segInfo.destY),\n          segPercent\n        );\n        info.angle = Math.atan2(segInfo.destY - segInfo.y, segInfo.destX - segInfo.x);\n        return info;\n      case 'L':\n        info = new fabric.Point(segInfo.x, segInfo.y).lerp(\n          new fabric.Point(segment[1], segment[2]),\n          segPercent\n        );\n        info.angle = Math.atan2(segment[2] - segInfo.y, segment[1] - segInfo.x);\n        return info;\n      case 'C':\n        return findPercentageForDistance(segInfo, distance);\n      case 'Q':\n        return findPercentageForDistance(segInfo, distance);\n    }\n  }\n\n  /**\n   *\n   * @param {string} pathString\n   * @return {(string|number)[][]} An array of SVG path commands\n   * @example <caption>Usage</caption>\n   * parsePath('M 3 4 Q 3 5 2 1 4 0 Q 9 12 2 1 4 0') === [\n   *   ['M', 3, 4],\n   *   ['Q', 3, 5, 2, 1, 4, 0],\n   *   ['Q', 9, 12, 2, 1, 4, 0],\n   * ];\n   *\n   */\n  function parsePath(pathString) {\n    var result = [],\n        coords = [],\n        currentPath,\n        parsed,\n        re = fabric.rePathCommand,\n        rNumber = '[-+]?(?:\\\\d*\\\\.\\\\d+|\\\\d+\\\\.?)(?:[eE][-+]?\\\\d+)?\\\\s*',\n        rNumberCommaWsp = '(' + rNumber + ')' + fabric.commaWsp,\n        rFlagCommaWsp = '([01])' + fabric.commaWsp + '?',\n        rArcSeq = rNumberCommaWsp + '?' + rNumberCommaWsp + '?' + rNumberCommaWsp + rFlagCommaWsp + rFlagCommaWsp +\n          rNumberCommaWsp + '?(' + rNumber + ')',\n        regArcArgumentSequence = new RegExp(rArcSeq, 'g'),\n        match,\n        coordsStr,\n        // one of commands (m,M,l,L,q,Q,c,C,etc.) followed by non-command characters (i.e. command values)\n        path;\n    if (!pathString || !pathString.match) {\n      return result;\n    }\n    path = pathString.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);\n\n    for (var i = 0, coordsParsed, len = path.length; i < len; i++) {\n      currentPath = path[i];\n\n      coordsStr = currentPath.slice(1).trim();\n      coords.length = 0;\n\n      var command = currentPath.charAt(0);\n      coordsParsed = [command];\n\n      if (command.toLowerCase() === 'a') {\n        // arcs have special flags that apparently don't require spaces so handle special\n        for (var args; (args = regArcArgumentSequence.exec(coordsStr));) {\n          for (var j = 1; j < args.length; j++) {\n            coords.push(args[j]);\n          }\n        }\n      }\n      else {\n        while ((match = re.exec(coordsStr))) {\n          coords.push(match[0]);\n        }\n      }\n\n      for (var j = 0, jlen = coords.length; j < jlen; j++) {\n        parsed = parseFloat(coords[j]);\n        if (!isNaN(parsed)) {\n          coordsParsed.push(parsed);\n        }\n      }\n\n      var commandLength = commandLengths[command.toLowerCase()],\n          repeatedCommand = repeatedCommands[command] || command;\n\n      if (coordsParsed.length - 1 > commandLength) {\n        for (var k = 1, klen = coordsParsed.length; k < klen; k += commandLength) {\n          result.push([command].concat(coordsParsed.slice(k, k + commandLength)));\n          command = repeatedCommand;\n        }\n      }\n      else {\n        result.push(coordsParsed);\n      }\n    }\n\n    return result;\n  };\n\n  /**\n   *\n   * Converts points to a smooth SVG path\n   * @param {{ x: number,y: number }[]} points Array of points\n   * @param {number} [correction] Apply a correction to the path (usually we use `width / 1000`). If value is undefined 0 is used as the correction value.\n   * @return {(string|number)[][]} An array of SVG path commands\n   */\n  function getSmoothPathFromPoints(points, correction) {\n    var path = [], i,\n        p1 = new fabric.Point(points[0].x, points[0].y),\n        p2 = new fabric.Point(points[1].x, points[1].y),\n        len = points.length, multSignX = 1, multSignY = 0, manyPoints = len > 2;\n    correction = correction || 0;\n\n    if (manyPoints) {\n      multSignX = points[2].x < p2.x ? -1 : points[2].x === p2.x ? 0 : 1;\n      multSignY = points[2].y < p2.y ? -1 : points[2].y === p2.y ? 0 : 1;\n    }\n    path.push(['M', p1.x - multSignX * correction, p1.y - multSignY * correction]);\n    for (i = 1; i < len; i++) {\n      if (!p1.eq(p2)) {\n        var midPoint = p1.midPointFrom(p2);\n        // p1 is our bezier control point\n        // midpoint is our endpoint\n        // start point is p(i-1) value.\n        path.push(['Q', p1.x, p1.y, midPoint.x, midPoint.y]);\n      }\n      p1 = points[i];\n      if ((i + 1) < points.length) {\n        p2 = points[i + 1];\n      }\n    }\n    if (manyPoints) {\n      multSignX = p1.x > points[i - 2].x ? 1 : p1.x === points[i - 2].x ? 0 : -1;\n      multSignY = p1.y > points[i - 2].y ? 1 : p1.y === points[i - 2].y ? 0 : -1;\n    }\n    path.push(['L', p1.x + multSignX * correction, p1.y + multSignY * correction]);\n    return path;\n  }\n  /**\n   * Transform a path by transforming each segment.\n   * it has to be a simplified path or it won't work.\n   * WARNING: this depends from pathOffset for correct operation\n   * @param {Array} path fabricJS parsed and simplified path commands\n   * @param {Array} transform matrix that represent the transformation\n   * @param {Object} [pathOffset] the fabric.Path pathOffset\n   * @param {Number} pathOffset.x\n   * @param {Number} pathOffset.y\n   * @returns {Array} the transformed path\n   */\n  function transformPath(path, transform, pathOffset) {\n    if (pathOffset) {\n      transform = fabric.util.multiplyTransformMatrices(\n        transform,\n        [1, 0, 0, 1, -pathOffset.x, -pathOffset.y]\n      );\n    }\n    return path.map(function(pathSegment) {\n      var newSegment = pathSegment.slice(0), point = {};\n      for (var i = 1; i < pathSegment.length - 1; i += 2) {\n        point.x = pathSegment[i];\n        point.y = pathSegment[i + 1];\n        point = fabric.util.transformPoint(point, transform);\n        newSegment[i] = point.x;\n        newSegment[i + 1] = point.y;\n      }\n      return newSegment;\n    });\n  }\n\n  /**\n   * Join path commands to go back to svg format\n   * @param {Array} pathData fabricJS parsed path commands\n   * @return {String} joined path 'M 0 0 L 20 30'\n   */\n  fabric.util.joinPath = function(pathData) {\n    return pathData.map(function (segment) { return segment.join(' '); }).join(' ');\n  };\n  fabric.util.parsePath = parsePath;\n  fabric.util.makePathSimpler = makePathSimpler;\n  fabric.util.getSmoothPathFromPoints = getSmoothPathFromPoints;\n  fabric.util.getPathSegmentsInfo = getPathSegmentsInfo;\n  fabric.util.getBoundsOfCurve = getBoundsOfCurve;\n  fabric.util.getPointOnPath = getPointOnPath;\n  fabric.util.transformPath = transformPath;\n})();\n\n\n(function() {\n\n  var slice = Array.prototype.slice;\n\n  /**\n   * Invokes method on all items in a given array\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} method Name of a method to invoke\n   * @return {Array}\n   */\n  function invoke(array, method) {\n    var args = slice.call(arguments, 2), result = [];\n    for (var i = 0, len = array.length; i < len; i++) {\n      result[i] = args.length ? array[i][method].apply(array[i], args) : array[i][method].call(array[i]);\n    }\n    return result;\n  }\n\n  /**\n   * Finds maximum value in array (not necessarily \"first\" one)\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} byProperty\n   * @return {*}\n   */\n  function max(array, byProperty) {\n    return find(array, byProperty, function(value1, value2) {\n      return value1 >= value2;\n    });\n  }\n\n  /**\n   * Finds minimum value in array (not necessarily \"first\" one)\n   * @memberOf fabric.util.array\n   * @param {Array} array Array to iterate over\n   * @param {String} byProperty\n   * @return {*}\n   */\n  function min(array, byProperty) {\n    return find(array, byProperty, function(value1, value2) {\n      return value1 < value2;\n    });\n  }\n\n  /**\n   * @private\n   */\n  function fill(array, value) {\n    var k = array.length;\n    while (k--) {\n      array[k] = value;\n    }\n    return array;\n  }\n\n  /**\n   * @private\n   */\n  function find(array, byProperty, condition) {\n    if (!array || array.length === 0) {\n      return;\n    }\n\n    var i = array.length - 1,\n        result = byProperty ? array[i][byProperty] : array[i];\n    if (byProperty) {\n      while (i--) {\n        if (condition(array[i][byProperty], result)) {\n          result = array[i][byProperty];\n        }\n      }\n    }\n    else {\n      while (i--) {\n        if (condition(array[i], result)) {\n          result = array[i];\n        }\n      }\n    }\n    return result;\n  }\n\n  /**\n   * @namespace fabric.util.array\n   */\n  fabric.util.array = {\n    fill: fill,\n    invoke: invoke,\n    min: min,\n    max: max\n  };\n\n})();\n\n\n(function() {\n  /**\n   * Copies all enumerable properties of one js object to another\n   * this does not and cannot compete with generic utils.\n   * Does not clone or extend fabric.Object subclasses.\n   * This is mostly for internal use and has extra handling for fabricJS objects\n   * it skips the canvas and group properties in deep cloning.\n   * @memberOf fabric.util.object\n   * @param {Object} destination Where to copy to\n   * @param {Object} source Where to copy from\n   * @param {Boolean} [deep] Whether to extend nested objects\n   * @return {Object}\n   */\n\n  function extend(destination, source, deep) {\n    // JScript DontEnum bug is not taken care of\n    // the deep clone is for internal use, is not meant to avoid\n    // javascript traps or cloning html element or self referenced objects.\n    if (deep) {\n      if (!fabric.isLikelyNode && source instanceof Element) {\n        // avoid cloning deep images, canvases,\n        destination = source;\n      }\n      else if (source instanceof Array) {\n        destination = [];\n        for (var i = 0, len = source.length; i < len; i++) {\n          destination[i] = extend({ }, source[i], deep);\n        }\n      }\n      else if (source && typeof source === 'object') {\n        for (var property in source) {\n          if (property === 'canvas' || property === 'group') {\n            // we do not want to clone this props at all.\n            // we want to keep the keys in the copy\n            destination[property] = null;\n          }\n          else if (source.hasOwnProperty(property)) {\n            destination[property] = extend({ }, source[property], deep);\n          }\n        }\n      }\n      else {\n        // this sounds odd for an extend but is ok for recursive use\n        destination = source;\n      }\n    }\n    else {\n      for (var property in source) {\n        destination[property] = source[property];\n      }\n    }\n    return destination;\n  }\n\n  /**\n   * Creates an empty object and copies all enumerable properties of another object to it\n   * This method is mostly for internal use, and not intended for duplicating shapes in canvas. \n   * @memberOf fabric.util.object\n   * @param {Object} object Object to clone\n   * @param {Boolean} [deep] Whether to clone nested objects\n   * @return {Object}\n   */\n\n  //TODO: this function return an empty object if you try to clone null\n  function clone(object, deep) {\n    return extend({ }, object, deep);\n  }\n\n  /** @namespace fabric.util.object */\n  fabric.util.object = {\n    extend: extend,\n    clone: clone\n  };\n  fabric.util.object.extend(fabric.util, fabric.Observable);\n})();\n\n\n(function() {\n\n  /**\n   * Camelizes a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to camelize\n   * @return {String} Camelized version of a string\n   */\n  function camelize(string) {\n    return string.replace(/-+(.)?/g, function(match, character) {\n      return character ? character.toUpperCase() : '';\n    });\n  }\n\n  /**\n   * Capitalizes a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to capitalize\n   * @param {Boolean} [firstLetterOnly] If true only first letter is capitalized\n   * and other letters stay untouched, if false first letter is capitalized\n   * and other letters are converted to lowercase.\n   * @return {String} Capitalized version of a string\n   */\n  function capitalize(string, firstLetterOnly) {\n    return string.charAt(0).toUpperCase() +\n      (firstLetterOnly ? string.slice(1) : string.slice(1).toLowerCase());\n  }\n\n  /**\n   * Escapes XML in a string\n   * @memberOf fabric.util.string\n   * @param {String} string String to escape\n   * @return {String} Escaped version of a string\n   */\n  function escapeXml(string) {\n    return string.replace(/&/g, '&amp;')\n      .replace(/\"/g, '&quot;')\n      .replace(/'/g, '&apos;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;');\n  }\n\n  /**\n   * Divide a string in the user perceived single units\n   * @memberOf fabric.util.string\n   * @param {String} textstring String to escape\n   * @return {Array} array containing the graphemes\n   */\n  function graphemeSplit(textstring) {\n    var i = 0, chr, graphemes = [];\n    for (i = 0, chr; i < textstring.length; i++) {\n      if ((chr = getWholeChar(textstring, i)) === false) {\n        continue;\n      }\n      graphemes.push(chr);\n    }\n    return graphemes;\n  }\n\n  // taken from mdn in the charAt doc page.\n  function getWholeChar(str, i) {\n    var code = str.charCodeAt(i);\n\n    if (isNaN(code)) {\n      return ''; // Position not found\n    }\n    if (code < 0xD800 || code > 0xDFFF) {\n      return str.charAt(i);\n    }\n\n    // High surrogate (could change last hex to 0xDB7F to treat high private\n    // surrogates as single characters)\n    if (0xD800 <= code && code <= 0xDBFF) {\n      if (str.length <= (i + 1)) {\n        throw 'High surrogate without following low surrogate';\n      }\n      var next = str.charCodeAt(i + 1);\n      if (0xDC00 > next || next > 0xDFFF) {\n        throw 'High surrogate without following low surrogate';\n      }\n      return str.charAt(i) + str.charAt(i + 1);\n    }\n    // Low surrogate (0xDC00 <= code && code <= 0xDFFF)\n    if (i === 0) {\n      throw 'Low surrogate without preceding high surrogate';\n    }\n    var prev = str.charCodeAt(i - 1);\n\n    // (could change last hex to 0xDB7F to treat high private\n    // surrogates as single characters)\n    if (0xD800 > prev || prev > 0xDBFF) {\n      throw 'Low surrogate without preceding high surrogate';\n    }\n    // We can pass over low surrogates now as the second component\n    // in a pair which we have already processed\n    return false;\n  }\n\n\n  /**\n   * String utilities\n   * @namespace fabric.util.string\n   */\n  fabric.util.string = {\n    camelize: camelize,\n    capitalize: capitalize,\n    escapeXml: escapeXml,\n    graphemeSplit: graphemeSplit\n  };\n})();\n\n\n(function() {\n\n  var slice = Array.prototype.slice, emptyFunction = function() { },\n\n      IS_DONTENUM_BUGGY = (function() {\n        for (var p in { toString: 1 }) {\n          if (p === 'toString') {\n            return false;\n          }\n        }\n        return true;\n      })(),\n\n      /** @ignore */\n      addMethods = function(klass, source, parent) {\n        for (var property in source) {\n\n          if (property in klass.prototype &&\n              typeof klass.prototype[property] === 'function' &&\n              (source[property] + '').indexOf('callSuper') > -1) {\n\n            klass.prototype[property] = (function(property) {\n              return function() {\n\n                var superclass = this.constructor.superclass;\n                this.constructor.superclass = parent;\n                var returnValue = source[property].apply(this, arguments);\n                this.constructor.superclass = superclass;\n\n                if (property !== 'initialize') {\n                  return returnValue;\n                }\n              };\n            })(property);\n          }\n          else {\n            klass.prototype[property] = source[property];\n          }\n\n          if (IS_DONTENUM_BUGGY) {\n            if (source.toString !== Object.prototype.toString) {\n              klass.prototype.toString = source.toString;\n            }\n            if (source.valueOf !== Object.prototype.valueOf) {\n              klass.prototype.valueOf = source.valueOf;\n            }\n          }\n        }\n      };\n\n  function Subclass() { }\n\n  function callSuper(methodName) {\n    var parentMethod = null,\n        _this = this;\n\n    // climb prototype chain to find method not equal to callee's method\n    while (_this.constructor.superclass) {\n      var superClassMethod = _this.constructor.superclass.prototype[methodName];\n      if (_this[methodName] !== superClassMethod) {\n        parentMethod = superClassMethod;\n        break;\n      }\n      // eslint-disable-next-line\n      _this = _this.constructor.superclass.prototype;\n    }\n\n    if (!parentMethod) {\n      return console.log('tried to callSuper ' + methodName + ', method not found in prototype chain', this);\n    }\n\n    return (arguments.length > 1)\n      ? parentMethod.apply(this, slice.call(arguments, 1))\n      : parentMethod.call(this);\n  }\n\n  /**\n   * Helper for creation of \"classes\".\n   * @memberOf fabric.util\n   * @param {Function} [parent] optional \"Class\" to inherit from\n   * @param {Object} [properties] Properties shared by all instances of this class\n   *                  (be careful modifying objects defined here as this would affect all instances)\n   */\n  function createClass() {\n    var parent = null,\n        properties = slice.call(arguments, 0);\n\n    if (typeof properties[0] === 'function') {\n      parent = properties.shift();\n    }\n    function klass() {\n      this.initialize.apply(this, arguments);\n    }\n\n    klass.superclass = parent;\n    klass.subclasses = [];\n\n    if (parent) {\n      Subclass.prototype = parent.prototype;\n      klass.prototype = new Subclass();\n      parent.subclasses.push(klass);\n    }\n    for (var i = 0, length = properties.length; i < length; i++) {\n      addMethods(klass, properties[i], parent);\n    }\n    if (!klass.prototype.initialize) {\n      klass.prototype.initialize = emptyFunction;\n    }\n    klass.prototype.constructor = klass;\n    klass.prototype.callSuper = callSuper;\n    return klass;\n  }\n\n  fabric.util.createClass = createClass;\n})();\n\n\n(function () {\n  // since ie11 can use addEventListener but they do not support options, i need to check\n  var couldUseAttachEvent = !!fabric.document.createElement('div').attachEvent,\n      touchEvents = ['touchstart', 'touchmove', 'touchend'];\n  /**\n   * Adds an event listener to an element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  fabric.util.addListener = function(element, eventName, handler, options) {\n    element && element.addEventListener(eventName, handler, couldUseAttachEvent ? false : options);\n  };\n\n  /**\n   * Removes an event listener from an element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {String} eventName\n   * @param {Function} handler\n   */\n  fabric.util.removeListener = function(element, eventName, handler, options) {\n    element && element.removeEventListener(eventName, handler, couldUseAttachEvent ? false : options);\n  };\n\n  function getTouchInfo(event) {\n    var touchProp = event.changedTouches;\n    if (touchProp && touchProp[0]) {\n      return touchProp[0];\n    }\n    return event;\n  }\n\n  fabric.util.getPointer = function(event) {\n    var element = event.target,\n        scroll = fabric.util.getScrollLeftTop(element),\n        _evt = getTouchInfo(event);\n    return {\n      x: _evt.clientX + scroll.left,\n      y: _evt.clientY + scroll.top\n    };\n  };\n\n  fabric.util.isTouchEvent = function(event) {\n    return touchEvents.indexOf(event.type) > -1 || event.pointerType === 'touch';\n  };\n})();\n\n\n(function () {\n\n  /**\n   * Cross-browser wrapper for setting element's style\n   * @memberOf fabric.util\n   * @param {HTMLElement} element\n   * @param {Object} styles\n   * @return {HTMLElement} Element that was passed as a first argument\n   */\n  function setStyle(element, styles) {\n    var elementStyle = element.style;\n    if (!elementStyle) {\n      return element;\n    }\n    if (typeof styles === 'string') {\n      element.style.cssText += ';' + styles;\n      return styles.indexOf('opacity') > -1\n        ? setOpacity(element, styles.match(/opacity:\\s*(\\d?\\.?\\d*)/)[1])\n        : element;\n    }\n    for (var property in styles) {\n      if (property === 'opacity') {\n        setOpacity(element, styles[property]);\n      }\n      else {\n        var normalizedProperty = (property === 'float' || property === 'cssFloat')\n          ? (typeof elementStyle.styleFloat === 'undefined' ? 'cssFloat' : 'styleFloat')\n          : property;\n        elementStyle.setProperty(normalizedProperty, styles[property]);\n      }\n    }\n    return element;\n  }\n\n  var parseEl = fabric.document.createElement('div'),\n      supportsOpacity = typeof parseEl.style.opacity === 'string',\n      supportsFilters = typeof parseEl.style.filter === 'string',\n      reOpacity = /alpha\\s*\\(\\s*opacity\\s*=\\s*([^\\)]+)\\)/,\n\n      /** @ignore */\n      setOpacity = function (element) { return element; };\n\n  if (supportsOpacity) {\n    /** @ignore */\n    setOpacity = function(element, value) {\n      element.style.opacity = value;\n      return element;\n    };\n  }\n  else if (supportsFilters) {\n    /** @ignore */\n    setOpacity = function(element, value) {\n      var es = element.style;\n      if (element.currentStyle && !element.currentStyle.hasLayout) {\n        es.zoom = 1;\n      }\n      if (reOpacity.test(es.filter)) {\n        value = value >= 0.9999 ? '' : ('alpha(opacity=' + (value * 100) + ')');\n        es.filter = es.filter.replace(reOpacity, value);\n      }\n      else {\n        es.filter += ' alpha(opacity=' + (value * 100) + ')';\n      }\n      return element;\n    };\n  }\n\n  fabric.util.setStyle = setStyle;\n\n})();\n\n\n(function() {\n\n  var _slice = Array.prototype.slice;\n\n  /**\n   * Takes id and returns an element with that id (if one exists in a document)\n   * @memberOf fabric.util\n   * @param {String|HTMLElement} id\n   * @return {HTMLElement|null}\n   */\n  function getById(id) {\n    return typeof id === 'string' ? fabric.document.getElementById(id) : id;\n  }\n\n  var sliceCanConvertNodelists,\n      /**\n       * Converts an array-like object (e.g. arguments or NodeList) to an array\n       * @memberOf fabric.util\n       * @param {Object} arrayLike\n       * @return {Array}\n       */\n      toArray = function(arrayLike) {\n        return _slice.call(arrayLike, 0);\n      };\n\n  try {\n    sliceCanConvertNodelists = toArray(fabric.document.childNodes) instanceof Array;\n  }\n  catch (err) { }\n\n  if (!sliceCanConvertNodelists) {\n    toArray = function(arrayLike) {\n      var arr = new Array(arrayLike.length), i = arrayLike.length;\n      while (i--) {\n        arr[i] = arrayLike[i];\n      }\n      return arr;\n    };\n  }\n\n  /**\n   * Creates specified element with specified attributes\n   * @memberOf fabric.util\n   * @param {String} tagName Type of an element to create\n   * @param {Object} [attributes] Attributes to set on an element\n   * @return {HTMLElement} Newly created element\n   */\n  function makeElement(tagName, attributes) {\n    var el = fabric.document.createElement(tagName);\n    for (var prop in attributes) {\n      if (prop === 'class') {\n        el.className = attributes[prop];\n      }\n      else if (prop === 'for') {\n        el.htmlFor = attributes[prop];\n      }\n      else {\n        el.setAttribute(prop, attributes[prop]);\n      }\n    }\n    return el;\n  }\n\n  /**\n   * Adds class to an element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to add class to\n   * @param {String} className Class to add to an element\n   */\n  function addClass(element, className) {\n    if (element && (' ' + element.className + ' ').indexOf(' ' + className + ' ') === -1) {\n      element.className += (element.className ? ' ' : '') + className;\n    }\n  }\n\n  /**\n   * Wraps element with another element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to wrap\n   * @param {HTMLElement|String} wrapper Element to wrap with\n   * @param {Object} [attributes] Attributes to set on a wrapper\n   * @return {HTMLElement} wrapper\n   */\n  function wrapElement(element, wrapper, attributes) {\n    if (typeof wrapper === 'string') {\n      wrapper = makeElement(wrapper, attributes);\n    }\n    if (element.parentNode) {\n      element.parentNode.replaceChild(wrapper, element);\n    }\n    wrapper.appendChild(element);\n    return wrapper;\n  }\n\n  /**\n   * Returns element scroll offsets\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to operate on\n   * @return {Object} Object with left/top values\n   */\n  function getScrollLeftTop(element) {\n\n    var left = 0,\n        top = 0,\n        docElement = fabric.document.documentElement,\n        body = fabric.document.body || {\n          scrollLeft: 0, scrollTop: 0\n        };\n\n    // While loop checks (and then sets element to) .parentNode OR .host\n    //  to account for ShadowDOM. We still want to traverse up out of ShadowDOM,\n    //  but the .parentNode of a root ShadowDOM node will always be null, instead\n    //  it should be accessed through .host. See http://stackoverflow.com/a/24765528/4383938\n    while (element && (element.parentNode || element.host)) {\n\n      // Set element to element parent, or 'host' in case of ShadowDOM\n      element = element.parentNode || element.host;\n\n      if (element === fabric.document) {\n        left = body.scrollLeft || docElement.scrollLeft || 0;\n        top = body.scrollTop ||  docElement.scrollTop || 0;\n      }\n      else {\n        left += element.scrollLeft || 0;\n        top += element.scrollTop || 0;\n      }\n\n      if (element.nodeType === 1 && element.style.position === 'fixed') {\n        break;\n      }\n    }\n\n    return { left: left, top: top };\n  }\n\n  /**\n   * Returns offset for a given element\n   * @function\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to get offset for\n   * @return {Object} Object with \"left\" and \"top\" properties\n   */\n  function getElementOffset(element) {\n    var docElem,\n        doc = element && element.ownerDocument,\n        box = { left: 0, top: 0 },\n        offset = { left: 0, top: 0 },\n        scrollLeftTop,\n        offsetAttributes = {\n          borderLeftWidth: 'left',\n          borderTopWidth:  'top',\n          paddingLeft:     'left',\n          paddingTop:      'top'\n        };\n\n    if (!doc) {\n      return offset;\n    }\n\n    for (var attr in offsetAttributes) {\n      offset[offsetAttributes[attr]] += parseInt(getElementStyle(element, attr), 10) || 0;\n    }\n\n    docElem = doc.documentElement;\n    if ( typeof element.getBoundingClientRect !== 'undefined' ) {\n      box = element.getBoundingClientRect();\n    }\n\n    scrollLeftTop = getScrollLeftTop(element);\n\n    return {\n      left: box.left + scrollLeftTop.left - (docElem.clientLeft || 0) + offset.left,\n      top: box.top + scrollLeftTop.top - (docElem.clientTop || 0)  + offset.top\n    };\n  }\n\n  /**\n   * Returns style attribute value of a given element\n   * @memberOf fabric.util\n   * @param {HTMLElement} element Element to get style attribute for\n   * @param {String} attr Style attribute to get for element\n   * @return {String} Style attribute value of the given element.\n   */\n  var getElementStyle;\n  if (fabric.document.defaultView && fabric.document.defaultView.getComputedStyle) {\n    getElementStyle = function(element, attr) {\n      var style = fabric.document.defaultView.getComputedStyle(element, null);\n      return style ? style[attr] : undefined;\n    };\n  }\n  else {\n    getElementStyle = function(element, attr) {\n      var value = element.style[attr];\n      if (!value && element.currentStyle) {\n        value = element.currentStyle[attr];\n      }\n      return value;\n    };\n  }\n\n  (function () {\n    var style = fabric.document.documentElement.style,\n        selectProp = 'userSelect' in style\n          ? 'userSelect'\n          : 'MozUserSelect' in style\n            ? 'MozUserSelect'\n            : 'WebkitUserSelect' in style\n              ? 'WebkitUserSelect'\n              : 'KhtmlUserSelect' in style\n                ? 'KhtmlUserSelect'\n                : '';\n\n    /**\n     * Makes element unselectable\n     * @memberOf fabric.util\n     * @param {HTMLElement} element Element to make unselectable\n     * @return {HTMLElement} Element that was passed in\n     */\n    function makeElementUnselectable(element) {\n      if (typeof element.onselectstart !== 'undefined') {\n        element.onselectstart = fabric.util.falseFunction;\n      }\n      if (selectProp) {\n        element.style[selectProp] = 'none';\n      }\n      else if (typeof element.unselectable === 'string') {\n        element.unselectable = 'on';\n      }\n      return element;\n    }\n\n    /**\n     * Makes element selectable\n     * @memberOf fabric.util\n     * @param {HTMLElement} element Element to make selectable\n     * @return {HTMLElement} Element that was passed in\n     */\n    function makeElementSelectable(element) {\n      if (typeof element.onselectstart !== 'undefined') {\n        element.onselectstart = null;\n      }\n      if (selectProp) {\n        element.style[selectProp] = '';\n      }\n      else if (typeof element.unselectable === 'string') {\n        element.unselectable = '';\n      }\n      return element;\n    }\n\n    fabric.util.makeElementUnselectable = makeElementUnselectable;\n    fabric.util.makeElementSelectable = makeElementSelectable;\n  })();\n\n  function getNodeCanvas(element) {\n    var impl = fabric.jsdomImplForWrapper(element);\n    return impl._canvas || impl._image;\n  };\n\n  function cleanUpJsdomNode(element) {\n    if (!fabric.isLikelyNode) {\n      return;\n    }\n    var impl = fabric.jsdomImplForWrapper(element);\n    if (impl) {\n      impl._image = null;\n      impl._canvas = null;\n      // unsure if necessary\n      impl._currentSrc = null;\n      impl._attributes = null;\n      impl._classList = null;\n    }\n  }\n\n  function setImageSmoothing(ctx, value) {\n    ctx.imageSmoothingEnabled = ctx.imageSmoothingEnabled || ctx.webkitImageSmoothingEnabled\n      || ctx.mozImageSmoothingEnabled || ctx.msImageSmoothingEnabled || ctx.oImageSmoothingEnabled;\n    ctx.imageSmoothingEnabled = value;\n  }\n\n  /**\n   * setImageSmoothing sets the context imageSmoothingEnabled property.\n   * Used by canvas and by ImageObject.\n   * @memberOf fabric.util\n   * @since 4.0.0\n   * @param {HTMLRenderingContext2D} ctx to set on\n   * @param {Boolean} value true or false\n   */\n  fabric.util.setImageSmoothing = setImageSmoothing;\n  fabric.util.getById = getById;\n  fabric.util.toArray = toArray;\n  fabric.util.addClass = addClass;\n  fabric.util.makeElement = makeElement;\n  fabric.util.wrapElement = wrapElement;\n  fabric.util.getScrollLeftTop = getScrollLeftTop;\n  fabric.util.getElementOffset = getElementOffset;\n  fabric.util.getNodeCanvas = getNodeCanvas;\n  fabric.util.cleanUpJsdomNode = cleanUpJsdomNode;\n\n})();\n\n\n(function() {\n\n  function addParamToUrl(url, param) {\n    return url + (/\\?/.test(url) ? '&' : '?') + param;\n  }\n\n  function emptyFn() { }\n\n  /**\n   * Cross-browser abstraction for sending XMLHttpRequest\n   * @memberOf fabric.util\n   * @param {String} url URL to send XMLHttpRequest to\n   * @param {Object} [options] Options object\n   * @param {String} [options.method=\"GET\"]\n   * @param {String} [options.parameters] parameters to append to url in GET or in body\n   * @param {String} [options.body] body to send with POST or PUT request\n   * @param {Function} options.onComplete Callback to invoke when request is completed\n   * @return {XMLHttpRequest} request\n   */\n  function request(url, options) {\n    options || (options = { });\n\n    var method = options.method ? options.method.toUpperCase() : 'GET',\n        onComplete = options.onComplete || function() { },\n        xhr = new fabric.window.XMLHttpRequest(),\n        body = options.body || options.parameters;\n\n    /** @ignore */\n    xhr.onreadystatechange = function() {\n      if (xhr.readyState === 4) {\n        onComplete(xhr);\n        xhr.onreadystatechange = emptyFn;\n      }\n    };\n\n    if (method === 'GET') {\n      body = null;\n      if (typeof options.parameters === 'string') {\n        url = addParamToUrl(url, options.parameters);\n      }\n    }\n\n    xhr.open(method, url, true);\n\n    if (method === 'POST' || method === 'PUT') {\n      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n    }\n\n    xhr.send(body);\n    return xhr;\n  }\n\n  fabric.util.request = request;\n})();\n\n\n/**\n * Wrapper around `console.log` (when available)\n * @param {*} [values] Values to log\n */\nfabric.log = console.log;\n\n/**\n * Wrapper around `console.warn` (when available)\n * @param {*} [values] Values to log as a warning\n */\nfabric.warn = console.warn;\n\n\n(function () {\n\n  var extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone;\n\n  /**\n   * @typedef {Object} AnimationOptions\n   * Animation of a value or list of values.\n   * When using lists, think of something like this:\n   * fabric.util.animate({\n   *   startValue: [1, 2, 3],\n   *   endValue: [2, 4, 6],\n   *   onChange: function([a, b, c]) {\n   *     canvas.zoomToPoint({x: b, y: c}, a)\n   *     canvas.renderAll()\n   *   }\n   * });\n   * @example\n   * @property {Function} [onChange] Callback; invoked on every value change\n   * @property {Function} [onComplete] Callback; invoked when value change is completed\n   * @example\n   * // Note: startValue, endValue, and byValue must match the type\n   * var animationOptions = { startValue: 0, endValue: 1, byValue: 0.25 }\n   * var animationOptions = { startValue: [0, 1], endValue: [1, 2], byValue: [0.25, 0.25] }\n   * @property {number | number[]} [startValue=0] Starting value\n   * @property {number | number[]} [endValue=100] Ending value\n   * @property {number | number[]} [byValue=100] Value to modify the property by\n   * @property {Function} [easing] Easing function\n   * @property {Number} [duration=500] Duration of change (in ms)\n   * @property {Function} [abort] Additional function with logic. If returns true, animation aborts.\n   *\n   * @typedef {() => void} CancelFunction\n   *\n   * @typedef {Object} AnimationCurrentState\n   * @property {number | number[]} currentValue value in range [`startValue`, `endValue`]\n   * @property {number} completionRate value in range [0, 1]\n   * @property {number} durationRate value in range [0, 1]\n   *\n   * @typedef {(AnimationOptions & AnimationCurrentState & { cancel: CancelFunction }} AnimationContext\n   */\n\n  /**\n   * Array holding all running animations\n   * @memberof fabric\n   * @type {AnimationContext[]}\n   */\n  var RUNNING_ANIMATIONS = [];\n  fabric.util.object.extend(RUNNING_ANIMATIONS, {\n\n    /**\n     * cancel all running animations at the next requestAnimFrame\n     * @returns {AnimationContext[]}\n     */\n    cancelAll: function () {\n      var animations = this.splice(0);\n      animations.forEach(function (animation) {\n        animation.cancel();\n      });\n      return animations;\n    },\n\n    /**\n     * cancel all running animations attached to canvas at the next requestAnimFrame\n     * @param {fabric.Canvas} canvas\n     * @returns {AnimationContext[]}\n     */\n    cancelByCanvas: function (canvas) {\n      if (!canvas) {\n        return [];\n      }\n      var cancelled = this.filter(function (animation) {\n        return typeof animation.target === 'object' && animation.target.canvas === canvas;\n      });\n      cancelled.forEach(function (animation) {\n        animation.cancel();\n      });\n      return cancelled;\n    },\n\n    /**\n     * cancel all running animations for target at the next requestAnimFrame\n     * @param {*} target\n     * @returns {AnimationContext[]}\n     */\n    cancelByTarget: function (target) {\n      var cancelled = this.findAnimationsByTarget(target);\n      cancelled.forEach(function (animation) {\n        animation.cancel();\n      });\n      return cancelled;\n    },\n\n    /**\n     *\n     * @param {CancelFunction} cancelFunc the function returned by animate\n     * @returns {number}\n     */\n    findAnimationIndex: function (cancelFunc) {\n      return this.indexOf(this.findAnimation(cancelFunc));\n    },\n\n    /**\n     *\n     * @param {CancelFunction} cancelFunc the function returned by animate\n     * @returns {AnimationContext | undefined} animation's options object\n     */\n    findAnimation: function (cancelFunc) {\n      return this.find(function (animation) {\n        return animation.cancel === cancelFunc;\n      });\n    },\n\n    /**\n     *\n     * @param {*} target the object that is assigned to the target property of the animation context\n     * @returns {AnimationContext[]} array of animation options object associated with target\n     */\n    findAnimationsByTarget: function (target) {\n      if (!target) {\n        return [];\n      }\n      return this.filter(function (animation) {\n        return animation.target === target;\n      });\n    }\n  });\n\n  function noop() {\n    return false;\n  }\n\n  function defaultEasing(t, b, c, d) {\n    return -c * Math.cos(t / d * (Math.PI / 2)) + c + b;\n  }\n\n  /**\n   * Changes value from one to another within certain period of time, invoking callbacks as value is being changed.\n   * @memberOf fabric.util\n   * @param {AnimationOptions} [options] Animation options\n   * @example\n   * // Note: startValue, endValue, and byValue must match the type\n   * fabric.util.animate({ startValue: 0, endValue: 1, byValue: 0.25 })\n   * fabric.util.animate({ startValue: [0, 1], endValue: [1, 2], byValue: [0.25, 0.25] })\n   * @returns {CancelFunction} cancel function\n   */\n  function animate(options) {\n    options || (options = {});\n    var cancel = false,\n        context,\n        removeFromRegistry = function () {\n          var index = fabric.runningAnimations.indexOf(context);\n          return index > -1 && fabric.runningAnimations.splice(index, 1)[0];\n        };\n\n    context = extend(clone(options), {\n      cancel: function () {\n        cancel = true;\n        return removeFromRegistry();\n      },\n      currentValue: 'startValue' in options ? options.startValue : 0,\n      completionRate: 0,\n      durationRate: 0\n    });\n    fabric.runningAnimations.push(context);\n\n    requestAnimFrame(function(timestamp) {\n      var start = timestamp || +new Date(),\n          duration = options.duration || 500,\n          finish = start + duration, time,\n          onChange = options.onChange || noop,\n          abort = options.abort || noop,\n          onComplete = options.onComplete || noop,\n          easing = options.easing || defaultEasing,\n          isMany = 'startValue' in options ? options.startValue.length > 0 : false,\n          startValue = 'startValue' in options ? options.startValue : 0,\n          endValue = 'endValue' in options ? options.endValue : 100,\n          byValue = options.byValue || (isMany ? startValue.map(function(value, i) {\n            return endValue[i] - startValue[i];\n          }) : endValue - startValue);\n\n      options.onStart && options.onStart();\n\n      (function tick(ticktime) {\n        time = ticktime || +new Date();\n        var currentTime = time > finish ? duration : (time - start),\n            timePerc = currentTime / duration,\n            current = isMany ? startValue.map(function(_value, i) {\n              return easing(currentTime, startValue[i], byValue[i], duration);\n            }) : easing(currentTime, startValue, byValue, duration),\n            valuePerc = isMany ? Math.abs((current[0] - startValue[0]) / byValue[0])\n              : Math.abs((current - startValue) / byValue);\n        //  update context\n        context.currentValue = isMany ? current.slice() : current;\n        context.completionRate = valuePerc;\n        context.durationRate = timePerc;\n        if (cancel) {\n          return;\n        }\n        if (abort(current, valuePerc, timePerc)) {\n          removeFromRegistry();\n          return;\n        }\n        if (time > finish) {\n          //  update context\n          context.currentValue = isMany ? endValue.slice() : endValue;\n          context.completionRate = 1;\n          context.durationRate = 1;\n          //  execute callbacks\n          onChange(isMany ? endValue.slice() : endValue, 1, 1);\n          onComplete(endValue, 1, 1);\n          removeFromRegistry();\n          return;\n        }\n        else {\n          onChange(current, valuePerc, timePerc);\n          requestAnimFrame(tick);\n        }\n      })(start);\n    });\n\n    return context.cancel;\n  }\n\n  var _requestAnimFrame = fabric.window.requestAnimationFrame       ||\n                          fabric.window.webkitRequestAnimationFrame ||\n                          fabric.window.mozRequestAnimationFrame    ||\n                          fabric.window.oRequestAnimationFrame      ||\n                          fabric.window.msRequestAnimationFrame     ||\n                          function(callback) {\n                            return fabric.window.setTimeout(callback, 1000 / 60);\n                          };\n\n  var _cancelAnimFrame = fabric.window.cancelAnimationFrame || fabric.window.clearTimeout;\n\n  /**\n   * requestAnimationFrame polyfill based on http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n   * In order to get a precise start time, `requestAnimFrame` should be called as an entry into the method\n   * @memberOf fabric.util\n   * @param {Function} callback Callback to invoke\n   * @param {DOMElement} element optional Element to associate with animation\n   */\n  function requestAnimFrame() {\n    return _requestAnimFrame.apply(fabric.window, arguments);\n  }\n\n  function cancelAnimFrame() {\n    return _cancelAnimFrame.apply(fabric.window, arguments);\n  }\n\n  fabric.util.animate = animate;\n  fabric.util.requestAnimFrame = requestAnimFrame;\n  fabric.util.cancelAnimFrame = cancelAnimFrame;\n  fabric.runningAnimations = RUNNING_ANIMATIONS;\n})();\n\n\n(function() {\n  // Calculate an in-between color. Returns a \"rgba()\" string.\n  // Credit: Edwin Martin <edwin@bitstorm.org>\n  //         http://www.bitstorm.org/jquery/color-animation/jquery.animate-colors.js\n  function calculateColor(begin, end, pos) {\n    var color = 'rgba('\n        + parseInt((begin[0] + pos * (end[0] - begin[0])), 10) + ','\n        + parseInt((begin[1] + pos * (end[1] - begin[1])), 10) + ','\n        + parseInt((begin[2] + pos * (end[2] - begin[2])), 10);\n\n    color += ',' + (begin && end ? parseFloat(begin[3] + pos * (end[3] - begin[3])) : 1);\n    color += ')';\n    return color;\n  }\n\n  /**\n   * Changes the color from one to another within certain period of time, invoking callbacks as value is being changed.\n   * @memberOf fabric.util\n   * @param {String} fromColor The starting color in hex or rgb(a) format.\n   * @param {String} toColor The starting color in hex or rgb(a) format.\n   * @param {Number} [duration] Duration of change (in ms).\n   * @param {Object} [options] Animation options\n   * @param {Function} [options.onChange] Callback; invoked on every value change\n   * @param {Function} [options.onComplete] Callback; invoked when value change is completed\n   * @param {Function} [options.colorEasing] Easing function. Note that this function only take two arguments (currentTime, duration). Thus the regular animation easing functions cannot be used.\n   * @param {Function} [options.abort] Additional function with logic. If returns true, onComplete is called.\n   * @returns {Function} abort function\n   */\n  function animateColor(fromColor, toColor, duration, options) {\n    var startColor = new fabric.Color(fromColor).getSource(),\n        endColor = new fabric.Color(toColor).getSource(),\n        originalOnComplete = options.onComplete,\n        originalOnChange = options.onChange;\n    options = options || {};\n\n    return fabric.util.animate(fabric.util.object.extend(options, {\n      duration: duration || 500,\n      startValue: startColor,\n      endValue: endColor,\n      byValue: endColor,\n      easing: function (currentTime, startValue, byValue, duration) {\n        var posValue = options.colorEasing\n          ? options.colorEasing(currentTime, duration)\n          : 1 - Math.cos(currentTime / duration * (Math.PI / 2));\n        return calculateColor(startValue, byValue, posValue);\n      },\n      // has to take in account for color restoring;\n      onComplete: function(current, valuePerc, timePerc) {\n        if (originalOnComplete) {\n          return originalOnComplete(\n            calculateColor(endColor, endColor, 0),\n            valuePerc,\n            timePerc\n          );\n        }\n      },\n      onChange: function(current, valuePerc, timePerc) {\n        if (originalOnChange) {\n          if (Array.isArray(current)) {\n            return originalOnChange(\n              calculateColor(current, current, 0),\n              valuePerc,\n              timePerc\n            );\n          }\n          originalOnChange(current, valuePerc, timePerc);\n        }\n      }\n    }));\n  }\n\n  fabric.util.animateColor = animateColor;\n\n})();\n\n\n(function() {\n\n  function normalize(a, c, p, s) {\n    if (a < Math.abs(c)) {\n      a = c;\n      s = p / 4;\n    }\n    else {\n      //handle the 0/0 case:\n      if (c === 0 && a === 0) {\n        s = p / (2 * Math.PI) * Math.asin(1);\n      }\n      else {\n        s = p / (2 * Math.PI) * Math.asin(c / a);\n      }\n    }\n    return { a: a, c: c, p: p, s: s };\n  }\n\n  function elastic(opts, t, d) {\n    return opts.a *\n      Math.pow(2, 10 * (t -= 1)) *\n      Math.sin( (t * d - opts.s) * (2 * Math.PI) / opts.p );\n  }\n\n  /**\n   * Cubic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutCubic(t, b, c, d) {\n    return c * ((t = t / d - 1) * t * t + 1) + b;\n  }\n\n  /**\n   * Cubic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutCubic(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t + b;\n    }\n    return c / 2 * ((t -= 2) * t * t + 2) + b;\n  }\n\n  /**\n   * Quartic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInQuart(t, b, c, d) {\n    return c * (t /= d) * t * t * t + b;\n  }\n\n  /**\n   * Quartic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutQuart(t, b, c, d) {\n    return -c * ((t = t / d - 1) * t * t * t - 1) + b;\n  }\n\n  /**\n   * Quartic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutQuart(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t * t + b;\n    }\n    return -c / 2 * ((t -= 2) * t * t * t - 2) + b;\n  }\n\n  /**\n   * Quintic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInQuint(t, b, c, d) {\n    return c * (t /= d) * t * t * t * t + b;\n  }\n\n  /**\n   * Quintic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutQuint(t, b, c, d) {\n    return c * ((t = t / d - 1) * t * t * t * t + 1) + b;\n  }\n\n  /**\n   * Quintic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutQuint(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * t * t * t * t * t + b;\n    }\n    return c / 2 * ((t -= 2) * t * t * t * t + 2) + b;\n  }\n\n  /**\n   * Sinusoidal easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInSine(t, b, c, d) {\n    return -c * Math.cos(t / d * (Math.PI / 2)) + c + b;\n  }\n\n  /**\n   * Sinusoidal easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutSine(t, b, c, d) {\n    return c * Math.sin(t / d * (Math.PI / 2)) + b;\n  }\n\n  /**\n   * Sinusoidal easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutSine(t, b, c, d) {\n    return -c / 2 * (Math.cos(Math.PI * t / d) - 1) + b;\n  }\n\n  /**\n   * Exponential easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInExpo(t, b, c, d) {\n    return (t === 0) ? b : c * Math.pow(2, 10 * (t / d - 1)) + b;\n  }\n\n  /**\n   * Exponential easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutExpo(t, b, c, d) {\n    return (t === d) ? b + c : c * (-Math.pow(2, -10 * t / d) + 1) + b;\n  }\n\n  /**\n   * Exponential easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutExpo(t, b, c, d) {\n    if (t === 0) {\n      return b;\n    }\n    if (t === d) {\n      return b + c;\n    }\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * Math.pow(2, 10 * (t - 1)) + b;\n    }\n    return c / 2 * (-Math.pow(2, -10 * --t) + 2) + b;\n  }\n\n  /**\n   * Circular easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInCirc(t, b, c, d) {\n    return -c * (Math.sqrt(1 - (t /= d) * t) - 1) + b;\n  }\n\n  /**\n   * Circular easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutCirc(t, b, c, d) {\n    return c * Math.sqrt(1 - (t = t / d - 1) * t) + b;\n  }\n\n  /**\n   * Circular easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutCirc(t, b, c, d) {\n    t /= d / 2;\n    if (t < 1) {\n      return -c / 2 * (Math.sqrt(1 - t * t) - 1) + b;\n    }\n    return c / 2 * (Math.sqrt(1 - (t -= 2) * t) + 1) + b;\n  }\n\n  /**\n   * Elastic easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d;\n    if (t === 1) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * 0.3;\n    }\n    var opts = normalize(a, c, p, s);\n    return -elastic(opts, t, d) + b;\n  }\n\n  /**\n   * Elastic easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d;\n    if (t === 1) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * 0.3;\n    }\n    var opts = normalize(a, c, p, s);\n    return opts.a * Math.pow(2, -10 * t) * Math.sin((t * d - opts.s) * (2 * Math.PI) / opts.p ) + opts.c + b;\n  }\n\n  /**\n   * Elastic easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutElastic(t, b, c, d) {\n    var s = 1.70158, p = 0, a = c;\n    if (t === 0) {\n      return b;\n    }\n    t /= d / 2;\n    if (t === 2) {\n      return b + c;\n    }\n    if (!p) {\n      p = d * (0.3 * 1.5);\n    }\n    var opts = normalize(a, c, p, s);\n    if (t < 1) {\n      return -0.5 * elastic(opts, t, d) + b;\n    }\n    return opts.a * Math.pow(2, -10 * (t -= 1)) *\n      Math.sin((t * d - opts.s) * (2 * Math.PI) / opts.p ) * 0.5 + opts.c + b;\n  }\n\n  /**\n   * Backwards easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    return c * (t /= d) * t * ((s + 1) * t - s) + b;\n  }\n\n  /**\n   * Backwards easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    return c * ((t = t / d - 1) * t * ((s + 1) * t + s) + 1) + b;\n  }\n\n  /**\n   * Backwards easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutBack(t, b, c, d, s) {\n    if (s === undefined) {\n      s = 1.70158;\n    }\n    t /= d / 2;\n    if (t < 1) {\n      return c / 2 * (t * t * (((s *= (1.525)) + 1) * t - s)) + b;\n    }\n    return c / 2 * ((t -= 2) * t * (((s *= (1.525)) + 1) * t + s) + 2) + b;\n  }\n\n  /**\n   * Bouncing easing in\n   * @memberOf fabric.util.ease\n   */\n  function easeInBounce(t, b, c, d) {\n    return c - easeOutBounce (d - t, 0, c, d) + b;\n  }\n\n  /**\n   * Bouncing easing out\n   * @memberOf fabric.util.ease\n   */\n  function easeOutBounce(t, b, c, d) {\n    if ((t /= d) < (1 / 2.75)) {\n      return c * (7.5625 * t * t) + b;\n    }\n    else if (t < (2 / 2.75)) {\n      return c * (7.5625 * (t -= (1.5 / 2.75)) * t + 0.75) + b;\n    }\n    else if (t < (2.5 / 2.75)) {\n      return c * (7.5625 * (t -= (2.25 / 2.75)) * t + 0.9375) + b;\n    }\n    else {\n      return c * (7.5625 * (t -= (2.625 / 2.75)) * t + 0.984375) + b;\n    }\n  }\n\n  /**\n   * Bouncing easing in and out\n   * @memberOf fabric.util.ease\n   */\n  function easeInOutBounce(t, b, c, d) {\n    if (t < d / 2) {\n      return easeInBounce (t * 2, 0, c, d) * 0.5 + b;\n    }\n    return easeOutBounce(t * 2 - d, 0, c, d) * 0.5 + c * 0.5 + b;\n  }\n\n  /**\n   * Easing functions\n   * See <a href=\"http://gizma.com/easing/\">Easing Equations by Robert Penner</a>\n   * @namespace fabric.util.ease\n   */\n  fabric.util.ease = {\n\n    /**\n     * Quadratic easing in\n     * @memberOf fabric.util.ease\n     */\n    easeInQuad: function(t, b, c, d) {\n      return c * (t /= d) * t + b;\n    },\n\n    /**\n     * Quadratic easing out\n     * @memberOf fabric.util.ease\n     */\n    easeOutQuad: function(t, b, c, d) {\n      return -c * (t /= d) * (t - 2) + b;\n    },\n\n    /**\n     * Quadratic easing in and out\n     * @memberOf fabric.util.ease\n     */\n    easeInOutQuad: function(t, b, c, d) {\n      t /= (d / 2);\n      if (t < 1) {\n        return c / 2 * t * t + b;\n      }\n      return -c / 2 * ((--t) * (t - 2) - 1) + b;\n    },\n\n    /**\n     * Cubic easing in\n     * @memberOf fabric.util.ease\n     */\n    easeInCubic: function(t, b, c, d) {\n      return c * (t /= d) * t * t + b;\n    },\n\n    easeOutCubic: easeOutCubic,\n    easeInOutCubic: easeInOutCubic,\n    easeInQuart: easeInQuart,\n    easeOutQuart: easeOutQuart,\n    easeInOutQuart: easeInOutQuart,\n    easeInQuint: easeInQuint,\n    easeOutQuint: easeOutQuint,\n    easeInOutQuint: easeInOutQuint,\n    easeInSine: easeInSine,\n    easeOutSine: easeOutSine,\n    easeInOutSine: easeInOutSine,\n    easeInExpo: easeInExpo,\n    easeOutExpo: easeOutExpo,\n    easeInOutExpo: easeInOutExpo,\n    easeInCirc: easeInCirc,\n    easeOutCirc: easeOutCirc,\n    easeInOutCirc: easeInOutCirc,\n    easeInElastic: easeInElastic,\n    easeOutElastic: easeOutElastic,\n    easeInOutElastic: easeInOutElastic,\n    easeInBack: easeInBack,\n    easeOutBack: easeOutBack,\n    easeInOutBack: easeInOutBack,\n    easeInBounce: easeInBounce,\n    easeOutBounce: easeOutBounce,\n    easeInOutBounce: easeInOutBounce\n  };\n\n})();\n\n\n(function(global) {\n\n  'use strict';\n\n  /**\n   * @name fabric\n   * @namespace\n   */\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      toFixed = fabric.util.toFixed,\n      parseUnit = fabric.util.parseUnit,\n      multiplyTransformMatrices = fabric.util.multiplyTransformMatrices,\n\n      svgValidTagNames = ['path', 'circle', 'polygon', 'polyline', 'ellipse', 'rect', 'line',\n        'image', 'text'],\n      svgViewBoxElements = ['symbol', 'image', 'marker', 'pattern', 'view', 'svg'],\n      svgInvalidAncestors = ['pattern', 'defs', 'symbol', 'metadata', 'clipPath', 'mask', 'desc'],\n      svgValidParents = ['symbol', 'g', 'a', 'svg', 'clipPath', 'defs'],\n\n      attributesMap = {\n        cx:                   'left',\n        x:                    'left',\n        r:                    'radius',\n        cy:                   'top',\n        y:                    'top',\n        display:              'visible',\n        visibility:           'visible',\n        transform:            'transformMatrix',\n        'fill-opacity':       'fillOpacity',\n        'fill-rule':          'fillRule',\n        'font-family':        'fontFamily',\n        'font-size':          'fontSize',\n        'font-style':         'fontStyle',\n        'font-weight':        'fontWeight',\n        'letter-spacing':     'charSpacing',\n        'paint-order':        'paintFirst',\n        'stroke-dasharray':   'strokeDashArray',\n        'stroke-dashoffset':  'strokeDashOffset',\n        'stroke-linecap':     'strokeLineCap',\n        'stroke-linejoin':    'strokeLineJoin',\n        'stroke-miterlimit':  'strokeMiterLimit',\n        'stroke-opacity':     'strokeOpacity',\n        'stroke-width':       'strokeWidth',\n        'text-decoration':    'textDecoration',\n        'text-anchor':        'textAnchor',\n        opacity:              'opacity',\n        'clip-path':          'clipPath',\n        'clip-rule':          'clipRule',\n        'vector-effect':      'strokeUniform',\n        'image-rendering':    'imageSmoothing',\n      },\n\n      colorAttributes = {\n        stroke: 'strokeOpacity',\n        fill:   'fillOpacity'\n      },\n\n      fSize = 'font-size', cPath = 'clip-path';\n\n  fabric.svgValidTagNamesRegEx = getSvgRegex(svgValidTagNames);\n  fabric.svgViewBoxElementsRegEx = getSvgRegex(svgViewBoxElements);\n  fabric.svgInvalidAncestorsRegEx = getSvgRegex(svgInvalidAncestors);\n  fabric.svgValidParentsRegEx = getSvgRegex(svgValidParents);\n\n  fabric.cssRules = { };\n  fabric.gradientDefs = { };\n  fabric.clipPaths = { };\n\n  function normalizeAttr(attr) {\n    // transform attribute names\n    if (attr in attributesMap) {\n      return attributesMap[attr];\n    }\n    return attr;\n  }\n\n  function normalizeValue(attr, value, parentAttributes, fontSize) {\n    var isArray = Array.isArray(value), parsed;\n\n    if ((attr === 'fill' || attr === 'stroke') && value === 'none') {\n      value = '';\n    }\n    else if (attr === 'strokeUniform') {\n      return (value === 'non-scaling-stroke');\n    }\n    else if (attr === 'strokeDashArray') {\n      if (value === 'none') {\n        value = null;\n      }\n      else {\n        value = value.replace(/,/g, ' ').split(/\\s+/).map(parseFloat);\n      }\n    }\n    else if (attr === 'transformMatrix') {\n      if (parentAttributes && parentAttributes.transformMatrix) {\n        value = multiplyTransformMatrices(\n          parentAttributes.transformMatrix, fabric.parseTransformAttribute(value));\n      }\n      else {\n        value = fabric.parseTransformAttribute(value);\n      }\n    }\n    else if (attr === 'visible') {\n      value = value !== 'none' && value !== 'hidden';\n      // display=none on parent element always takes precedence over child element\n      if (parentAttributes && parentAttributes.visible === false) {\n        value = false;\n      }\n    }\n    else if (attr === 'opacity') {\n      value = parseFloat(value);\n      if (parentAttributes && typeof parentAttributes.opacity !== 'undefined') {\n        value *= parentAttributes.opacity;\n      }\n    }\n    else if (attr === 'textAnchor' /* text-anchor */) {\n      value = value === 'start' ? 'left' : value === 'end' ? 'right' : 'center';\n    }\n    else if (attr === 'charSpacing') {\n      // parseUnit returns px and we convert it to em\n      parsed = parseUnit(value, fontSize) / fontSize * 1000;\n    }\n    else if (attr === 'paintFirst') {\n      var fillIndex = value.indexOf('fill');\n      var strokeIndex = value.indexOf('stroke');\n      var value = 'fill';\n      if (fillIndex > -1 && strokeIndex > -1 && strokeIndex < fillIndex) {\n        value = 'stroke';\n      }\n      else if (fillIndex === -1 && strokeIndex > -1) {\n        value = 'stroke';\n      }\n    }\n    else if (attr === 'href' || attr === 'xlink:href' || attr === 'font') {\n      return value;\n    }\n    else if (attr === 'imageSmoothing') {\n      return (value === 'optimizeQuality');\n    }\n    else {\n      parsed = isArray ? value.map(parseUnit) : parseUnit(value, fontSize);\n    }\n\n    return (!isArray && isNaN(parsed) ? value : parsed);\n  }\n\n  /**\n    * @private\n    */\n  function getSvgRegex(arr) {\n    return new RegExp('^(' + arr.join('|') + ')\\\\b', 'i');\n  }\n\n  /**\n   * @private\n   * @param {Object} attributes Array of attributes to parse\n   */\n  function _setStrokeFillOpacity(attributes) {\n    for (var attr in colorAttributes) {\n\n      if (typeof attributes[colorAttributes[attr]] === 'undefined' || attributes[attr] === '') {\n        continue;\n      }\n\n      if (typeof attributes[attr] === 'undefined') {\n        if (!fabric.Object.prototype[attr]) {\n          continue;\n        }\n        attributes[attr] = fabric.Object.prototype[attr];\n      }\n\n      if (attributes[attr].indexOf('url(') === 0) {\n        continue;\n      }\n\n      var color = new fabric.Color(attributes[attr]);\n      attributes[attr] = color.setAlpha(toFixed(color.getAlpha() * attributes[colorAttributes[attr]], 2)).toRgba();\n    }\n    return attributes;\n  }\n\n  /**\n   * @private\n   */\n  function _getMultipleNodes(doc, nodeNames) {\n    var nodeName, nodeArray = [], nodeList, i, len;\n    for (i = 0, len = nodeNames.length; i < len; i++) {\n      nodeName = nodeNames[i];\n      nodeList = doc.getElementsByTagName(nodeName);\n      nodeArray = nodeArray.concat(Array.prototype.slice.call(nodeList));\n    }\n    return nodeArray;\n  }\n\n  /**\n   * Parses \"transform\" attribute, returning an array of values\n   * @static\n   * @function\n   * @memberOf fabric\n   * @param {String} attributeValue String containing attribute value\n   * @return {Array} Array of 6 elements representing transformation matrix\n   */\n  fabric.parseTransformAttribute = (function() {\n    function rotateMatrix(matrix, args) {\n      var cos = fabric.util.cos(args[0]), sin = fabric.util.sin(args[0]),\n          x = 0, y = 0;\n      if (args.length === 3) {\n        x = args[1];\n        y = args[2];\n      }\n\n      matrix[0] = cos;\n      matrix[1] = sin;\n      matrix[2] = -sin;\n      matrix[3] = cos;\n      matrix[4] = x - (cos * x - sin * y);\n      matrix[5] = y - (sin * x + cos * y);\n    }\n\n    function scaleMatrix(matrix, args) {\n      var multiplierX = args[0],\n          multiplierY = (args.length === 2) ? args[1] : args[0];\n\n      matrix[0] = multiplierX;\n      matrix[3] = multiplierY;\n    }\n\n    function skewMatrix(matrix, args, pos) {\n      matrix[pos] = Math.tan(fabric.util.degreesToRadians(args[0]));\n    }\n\n    function translateMatrix(matrix, args) {\n      matrix[4] = args[0];\n      if (args.length === 2) {\n        matrix[5] = args[1];\n      }\n    }\n\n    // identity matrix\n    var iMatrix = fabric.iMatrix,\n\n        // == begin transform regexp\n        number = fabric.reNum,\n\n        commaWsp = fabric.commaWsp,\n\n        skewX = '(?:(skewX)\\\\s*\\\\(\\\\s*(' + number + ')\\\\s*\\\\))',\n\n        skewY = '(?:(skewY)\\\\s*\\\\(\\\\s*(' + number + ')\\\\s*\\\\))',\n\n        rotate = '(?:(rotate)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + ')' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        scale = '(?:(scale)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        translate = '(?:(translate)\\\\s*\\\\(\\\\s*(' + number + ')(?:' +\n                    commaWsp + '(' + number + '))?\\\\s*\\\\))',\n\n        matrix = '(?:(matrix)\\\\s*\\\\(\\\\s*' +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' + commaWsp +\n                  '(' + number + ')' +\n                  '\\\\s*\\\\))',\n\n        transform = '(?:' +\n                    matrix + '|' +\n                    translate + '|' +\n                    scale + '|' +\n                    rotate + '|' +\n                    skewX + '|' +\n                    skewY +\n                    ')',\n\n        transforms = '(?:' + transform + '(?:' + commaWsp + '*' + transform + ')*' + ')',\n\n        transformList = '^\\\\s*(?:' + transforms + '?)\\\\s*$',\n\n        // http://www.w3.org/TR/SVG/coords.html#TransformAttribute\n        reTransformList = new RegExp(transformList),\n        // == end transform regexp\n\n        reTransform = new RegExp(transform, 'g');\n\n    return function(attributeValue) {\n\n      // start with identity matrix\n      var matrix = iMatrix.concat(),\n          matrices = [];\n\n      // return if no argument was given or\n      // an argument does not match transform attribute regexp\n      if (!attributeValue || (attributeValue && !reTransformList.test(attributeValue))) {\n        return matrix;\n      }\n\n      attributeValue.replace(reTransform, function(match) {\n\n        var m = new RegExp(transform).exec(match).filter(function (match) {\n              // match !== '' && match != null\n              return (!!match);\n            }),\n            operation = m[1],\n            args = m.slice(2).map(parseFloat);\n\n        switch (operation) {\n          case 'translate':\n            translateMatrix(matrix, args);\n            break;\n          case 'rotate':\n            args[0] = fabric.util.degreesToRadians(args[0]);\n            rotateMatrix(matrix, args);\n            break;\n          case 'scale':\n            scaleMatrix(matrix, args);\n            break;\n          case 'skewX':\n            skewMatrix(matrix, args, 2);\n            break;\n          case 'skewY':\n            skewMatrix(matrix, args, 1);\n            break;\n          case 'matrix':\n            matrix = args;\n            break;\n        }\n\n        // snapshot current matrix into matrices array\n        matrices.push(matrix.concat());\n        // reset\n        matrix = iMatrix.concat();\n      });\n\n      var combinedMatrix = matrices[0];\n      while (matrices.length > 1) {\n        matrices.shift();\n        combinedMatrix = fabric.util.multiplyTransformMatrices(combinedMatrix, matrices[0]);\n      }\n      return combinedMatrix;\n    };\n  })();\n\n  /**\n   * @private\n   */\n  function parseStyleString(style, oStyle) {\n    var attr, value;\n    style.replace(/;\\s*$/, '').split(';').forEach(function (chunk) {\n      var pair = chunk.split(':');\n\n      attr = pair[0].trim().toLowerCase();\n      value =  pair[1].trim();\n\n      oStyle[attr] = value;\n    });\n  }\n\n  /**\n   * @private\n   */\n  function parseStyleObject(style, oStyle) {\n    var attr, value;\n    for (var prop in style) {\n      if (typeof style[prop] === 'undefined') {\n        continue;\n      }\n\n      attr = prop.toLowerCase();\n      value = style[prop];\n\n      oStyle[attr] = value;\n    }\n  }\n\n  /**\n   * @private\n   */\n  function getGlobalStylesForElement(element, svgUid) {\n    var styles = { };\n    for (var rule in fabric.cssRules[svgUid]) {\n      if (elementMatchesRule(element, rule.split(' '))) {\n        for (var property in fabric.cssRules[svgUid][rule]) {\n          styles[property] = fabric.cssRules[svgUid][rule][property];\n        }\n      }\n    }\n    return styles;\n  }\n\n  /**\n   * @private\n   */\n  function elementMatchesRule(element, selectors) {\n    var firstMatching, parentMatching = true;\n    //start from rightmost selector.\n    firstMatching = selectorMatches(element, selectors.pop());\n    if (firstMatching && selectors.length) {\n      parentMatching = doesSomeParentMatch(element, selectors);\n    }\n    return firstMatching && parentMatching && (selectors.length === 0);\n  }\n\n  function doesSomeParentMatch(element, selectors) {\n    var selector, parentMatching = true;\n    while (element.parentNode && element.parentNode.nodeType === 1 && selectors.length) {\n      if (parentMatching) {\n        selector = selectors.pop();\n      }\n      element = element.parentNode;\n      parentMatching = selectorMatches(element, selector);\n    }\n    return selectors.length === 0;\n  }\n\n  /**\n   * @private\n   */\n  function selectorMatches(element, selector) {\n    var nodeName = element.nodeName,\n        classNames = element.getAttribute('class'),\n        id = element.getAttribute('id'), matcher, i;\n    // i check if a selector matches slicing away part from it.\n    // if i get empty string i should match\n    matcher = new RegExp('^' + nodeName, 'i');\n    selector = selector.replace(matcher, '');\n    if (id && selector.length) {\n      matcher = new RegExp('#' + id + '(?![a-zA-Z\\\\-]+)', 'i');\n      selector = selector.replace(matcher, '');\n    }\n    if (classNames && selector.length) {\n      classNames = classNames.split(' ');\n      for (i = classNames.length; i--;) {\n        matcher = new RegExp('\\\\.' + classNames[i] + '(?![a-zA-Z\\\\-]+)', 'i');\n        selector = selector.replace(matcher, '');\n      }\n    }\n    return selector.length === 0;\n  }\n\n  /**\n   * @private\n   * to support IE8 missing getElementById on SVGdocument and on node xmlDOM\n   */\n  function elementById(doc, id) {\n    var el;\n    doc.getElementById && (el = doc.getElementById(id));\n    if (el) {\n      return el;\n    }\n    var node, i, len, nodelist = doc.getElementsByTagName('*');\n    for (i = 0, len = nodelist.length; i < len; i++) {\n      node = nodelist[i];\n      if (id === node.getAttribute('id')) {\n        return node;\n      }\n    }\n  }\n\n  /**\n   * @private\n   */\n  function parseUseDirectives(doc) {\n    var nodelist = _getMultipleNodes(doc, ['use', 'svg:use']), i = 0;\n    while (nodelist.length && i < nodelist.length) {\n      var el = nodelist[i],\n          xlinkAttribute = el.getAttribute('xlink:href') || el.getAttribute('href');\n\n      if (xlinkAttribute === null) {\n        return;\n      }\n\n      var xlink = xlinkAttribute.slice(1),\n          x = el.getAttribute('x') || 0,\n          y = el.getAttribute('y') || 0,\n          el2 = elementById(doc, xlink).cloneNode(true),\n          currentTrans = (el2.getAttribute('transform') || '') + ' translate(' + x + ', ' + y + ')',\n          parentNode,\n          oldLength = nodelist.length, attr,\n          j,\n          attrs,\n          len,\n          namespace = fabric.svgNS;\n\n      applyViewboxTransform(el2);\n      if (/^svg$/i.test(el2.nodeName)) {\n        var el3 = el2.ownerDocument.createElementNS(namespace, 'g');\n        for (j = 0, attrs = el2.attributes, len = attrs.length; j < len; j++) {\n          attr = attrs.item(j);\n          el3.setAttributeNS(namespace, attr.nodeName, attr.nodeValue);\n        }\n        // el2.firstChild != null\n        while (el2.firstChild) {\n          el3.appendChild(el2.firstChild);\n        }\n        el2 = el3;\n      }\n\n      for (j = 0, attrs = el.attributes, len = attrs.length; j < len; j++) {\n        attr = attrs.item(j);\n        if (attr.nodeName === 'x' || attr.nodeName === 'y' ||\n          attr.nodeName === 'xlink:href' || attr.nodeName === 'href') {\n          continue;\n        }\n\n        if (attr.nodeName === 'transform') {\n          currentTrans = attr.nodeValue + ' ' + currentTrans;\n        }\n        else {\n          el2.setAttribute(attr.nodeName, attr.nodeValue);\n        }\n      }\n\n      el2.setAttribute('transform', currentTrans);\n      el2.setAttribute('instantiated_by_use', '1');\n      el2.removeAttribute('id');\n      parentNode = el.parentNode;\n      parentNode.replaceChild(el2, el);\n      // some browsers do not shorten nodelist after replaceChild (IE8)\n      if (nodelist.length === oldLength) {\n        i++;\n      }\n    }\n  }\n\n  // http://www.w3.org/TR/SVG/coords.html#ViewBoxAttribute\n  // matches, e.g.: +14.56e-12, etc.\n  var reViewBoxAttrValue = new RegExp(\n    '^' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*,?' +\n    '\\\\s*(' + fabric.reNum + '+)\\\\s*' +\n    '$'\n  );\n\n  /**\n   * Add a <g> element that envelop all child elements and makes the viewbox transformMatrix descend on all elements\n   */\n  function applyViewboxTransform(element) {\n    if (!fabric.svgViewBoxElementsRegEx.test(element.nodeName)) {\n      return {};\n    }\n    var viewBoxAttr = element.getAttribute('viewBox'),\n        scaleX = 1,\n        scaleY = 1,\n        minX = 0,\n        minY = 0,\n        viewBoxWidth, viewBoxHeight, matrix, el,\n        widthAttr = element.getAttribute('width'),\n        heightAttr = element.getAttribute('height'),\n        x = element.getAttribute('x') || 0,\n        y = element.getAttribute('y') || 0,\n        preserveAspectRatio = element.getAttribute('preserveAspectRatio') || '',\n        missingViewBox = (!viewBoxAttr || !(viewBoxAttr = viewBoxAttr.match(reViewBoxAttrValue))),\n        missingDimAttr = (!widthAttr || !heightAttr || widthAttr === '100%' || heightAttr === '100%'),\n        toBeParsed = missingViewBox && missingDimAttr,\n        parsedDim = { }, translateMatrix = '', widthDiff = 0, heightDiff = 0;\n\n    parsedDim.width = 0;\n    parsedDim.height = 0;\n    parsedDim.toBeParsed = toBeParsed;\n\n    if (missingViewBox) {\n      if (((x || y) && element.parentNode && element.parentNode.nodeName !== '#document')) {\n        translateMatrix = ' translate(' + parseUnit(x) + ' ' + parseUnit(y) + ') ';\n        matrix = (element.getAttribute('transform') || '') + translateMatrix;\n        element.setAttribute('transform', matrix);\n        element.removeAttribute('x');\n        element.removeAttribute('y');\n      }\n    }\n\n    if (toBeParsed) {\n      return parsedDim;\n    }\n\n    if (missingViewBox) {\n      parsedDim.width = parseUnit(widthAttr);\n      parsedDim.height = parseUnit(heightAttr);\n      // set a transform for elements that have x y and are inner(only) SVGs\n      return parsedDim;\n    }\n    minX = -parseFloat(viewBoxAttr[1]);\n    minY = -parseFloat(viewBoxAttr[2]);\n    viewBoxWidth = parseFloat(viewBoxAttr[3]);\n    viewBoxHeight = parseFloat(viewBoxAttr[4]);\n    parsedDim.minX = minX;\n    parsedDim.minY = minY;\n    parsedDim.viewBoxWidth = viewBoxWidth;\n    parsedDim.viewBoxHeight = viewBoxHeight;\n    if (!missingDimAttr) {\n      parsedDim.width = parseUnit(widthAttr);\n      parsedDim.height = parseUnit(heightAttr);\n      scaleX = parsedDim.width / viewBoxWidth;\n      scaleY = parsedDim.height / viewBoxHeight;\n    }\n    else {\n      parsedDim.width = viewBoxWidth;\n      parsedDim.height = viewBoxHeight;\n    }\n\n    // default is to preserve aspect ratio\n    preserveAspectRatio = fabric.util.parsePreserveAspectRatioAttribute(preserveAspectRatio);\n    if (preserveAspectRatio.alignX !== 'none') {\n      //translate all container for the effect of Mid, Min, Max\n      if (preserveAspectRatio.meetOrSlice === 'meet') {\n        scaleY = scaleX = (scaleX > scaleY ? scaleY : scaleX);\n        // calculate additional translation to move the viewbox\n      }\n      if (preserveAspectRatio.meetOrSlice === 'slice') {\n        scaleY = scaleX = (scaleX > scaleY ? scaleX : scaleY);\n        // calculate additional translation to move the viewbox\n      }\n      widthDiff = parsedDim.width - viewBoxWidth * scaleX;\n      heightDiff = parsedDim.height - viewBoxHeight * scaleX;\n      if (preserveAspectRatio.alignX === 'Mid') {\n        widthDiff /= 2;\n      }\n      if (preserveAspectRatio.alignY === 'Mid') {\n        heightDiff /= 2;\n      }\n      if (preserveAspectRatio.alignX === 'Min') {\n        widthDiff = 0;\n      }\n      if (preserveAspectRatio.alignY === 'Min') {\n        heightDiff = 0;\n      }\n    }\n\n    if (scaleX === 1 && scaleY === 1 && minX === 0 && minY === 0 && x === 0 && y === 0) {\n      return parsedDim;\n    }\n    if ((x || y) && element.parentNode.nodeName !== '#document') {\n      translateMatrix = ' translate(' + parseUnit(x) + ' ' + parseUnit(y) + ') ';\n    }\n\n    matrix = translateMatrix + ' matrix(' + scaleX +\n                  ' 0' +\n                  ' 0 ' +\n                  scaleY + ' ' +\n                  (minX * scaleX + widthDiff) + ' ' +\n                  (minY * scaleY + heightDiff) + ') ';\n    // seems unused.\n    // parsedDim.viewboxTransform = fabric.parseTransformAttribute(matrix);\n    if (element.nodeName === 'svg') {\n      el = element.ownerDocument.createElementNS(fabric.svgNS, 'g');\n      // element.firstChild != null\n      while (element.firstChild) {\n        el.appendChild(element.firstChild);\n      }\n      element.appendChild(el);\n    }\n    else {\n      el = element;\n      el.removeAttribute('x');\n      el.removeAttribute('y');\n      matrix = el.getAttribute('transform') + matrix;\n    }\n    el.setAttribute('transform', matrix);\n    return parsedDim;\n  }\n\n  function hasAncestorWithNodeName(element, nodeName) {\n    while (element && (element = element.parentNode)) {\n      if (element.nodeName && nodeName.test(element.nodeName.replace('svg:', ''))\n        && !element.getAttribute('instantiated_by_use')) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Parses an SVG document, converts it to an array of corresponding fabric.* instances and passes them to a callback\n   * @static\n   * @function\n   * @memberOf fabric\n   * @param {SVGDocument} doc SVG document to parse\n   * @param {Function} callback Callback to call when parsing is finished;\n   * It's being passed an array of elements (parsed from a document).\n   * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n   * @param {Object} [parsingOptions] options for parsing document\n   * @param {String} [parsingOptions.crossOrigin] crossOrigin settings\n   */\n  fabric.parseSVGDocument = function(doc, callback, reviver, parsingOptions) {\n    if (!doc) {\n      return;\n    }\n\n    parseUseDirectives(doc);\n\n    var svgUid =  fabric.Object.__uid++, i, len,\n        options = applyViewboxTransform(doc),\n        descendants = fabric.util.toArray(doc.getElementsByTagName('*'));\n    options.crossOrigin = parsingOptions && parsingOptions.crossOrigin;\n    options.svgUid = svgUid;\n\n    if (descendants.length === 0 && fabric.isLikelyNode) {\n      // we're likely in node, where \"o3-xml\" library fails to gEBTN(\"*\")\n      // https://github.com/ajaxorg/node-o3-xml/issues/21\n      descendants = doc.selectNodes('//*[name(.)!=\"svg\"]');\n      var arr = [];\n      for (i = 0, len = descendants.length; i < len; i++) {\n        arr[i] = descendants[i];\n      }\n      descendants = arr;\n    }\n\n    var elements = descendants.filter(function(el) {\n      applyViewboxTransform(el);\n      return fabric.svgValidTagNamesRegEx.test(el.nodeName.replace('svg:', '')) &&\n            !hasAncestorWithNodeName(el, fabric.svgInvalidAncestorsRegEx); // http://www.w3.org/TR/SVG/struct.html#DefsElement\n    });\n    if (!elements || (elements && !elements.length)) {\n      callback && callback([], {});\n      return;\n    }\n    var clipPaths = { };\n    descendants.filter(function(el) {\n      return el.nodeName.replace('svg:', '') === 'clipPath';\n    }).forEach(function(el) {\n      var id = el.getAttribute('id');\n      clipPaths[id] = fabric.util.toArray(el.getElementsByTagName('*')).filter(function(el) {\n        return fabric.svgValidTagNamesRegEx.test(el.nodeName.replace('svg:', ''));\n      });\n    });\n    fabric.gradientDefs[svgUid] = fabric.getGradientDefs(doc);\n    fabric.cssRules[svgUid] = fabric.getCSSRules(doc);\n    fabric.clipPaths[svgUid] = clipPaths;\n    // Precedence of rules:   style > class > attribute\n    fabric.parseElements(elements, function(instances, elements) {\n      if (callback) {\n        callback(instances, options, elements, descendants);\n        delete fabric.gradientDefs[svgUid];\n        delete fabric.cssRules[svgUid];\n        delete fabric.clipPaths[svgUid];\n      }\n    }, clone(options), reviver, parsingOptions);\n  };\n\n  function recursivelyParseGradientsXlink(doc, gradient) {\n    var gradientsAttrs = ['gradientTransform', 'x1', 'x2', 'y1', 'y2', 'gradientUnits', 'cx', 'cy', 'r', 'fx', 'fy'],\n        xlinkAttr = 'xlink:href',\n        xLink = gradient.getAttribute(xlinkAttr).slice(1),\n        referencedGradient = elementById(doc, xLink);\n    if (referencedGradient && referencedGradient.getAttribute(xlinkAttr)) {\n      recursivelyParseGradientsXlink(doc, referencedGradient);\n    }\n    gradientsAttrs.forEach(function(attr) {\n      if (referencedGradient && !gradient.hasAttribute(attr) && referencedGradient.hasAttribute(attr)) {\n        gradient.setAttribute(attr, referencedGradient.getAttribute(attr));\n      }\n    });\n    if (!gradient.children.length) {\n      var referenceClone = referencedGradient.cloneNode(true);\n      while (referenceClone.firstChild) {\n        gradient.appendChild(referenceClone.firstChild);\n      }\n    }\n    gradient.removeAttribute(xlinkAttr);\n  }\n\n  var reFontDeclaration = new RegExp(\n    '(normal|italic)?\\\\s*(normal|small-caps)?\\\\s*' +\n    '(normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900)?\\\\s*(' +\n      fabric.reNum +\n    '(?:px|cm|mm|em|pt|pc|in)*)(?:\\\\/(normal|' + fabric.reNum + '))?\\\\s+(.*)');\n\n  extend(fabric, {\n    /**\n     * Parses a short font declaration, building adding its properties to a style object\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {String} value font declaration\n     * @param {Object} oStyle definition\n     */\n    parseFontDeclaration: function(value, oStyle) {\n      var match = value.match(reFontDeclaration);\n\n      if (!match) {\n        return;\n      }\n      var fontStyle = match[1],\n          // font variant is not used\n          // fontVariant = match[2],\n          fontWeight = match[3],\n          fontSize = match[4],\n          lineHeight = match[5],\n          fontFamily = match[6];\n\n      if (fontStyle) {\n        oStyle.fontStyle = fontStyle;\n      }\n      if (fontWeight) {\n        oStyle.fontWeight = isNaN(parseFloat(fontWeight)) ? fontWeight : parseFloat(fontWeight);\n      }\n      if (fontSize) {\n        oStyle.fontSize = parseUnit(fontSize);\n      }\n      if (fontFamily) {\n        oStyle.fontFamily = fontFamily;\n      }\n      if (lineHeight) {\n        oStyle.lineHeight = lineHeight === 'normal' ? 1 : lineHeight;\n      }\n    },\n\n    /**\n     * Parses an SVG document, returning all of the gradient declarations found in it\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {SVGDocument} doc SVG document to parse\n     * @return {Object} Gradient definitions; key corresponds to element id, value -- to gradient definition element\n     */\n    getGradientDefs: function(doc) {\n      var tagArray = [\n            'linearGradient',\n            'radialGradient',\n            'svg:linearGradient',\n            'svg:radialGradient'],\n          elList = _getMultipleNodes(doc, tagArray),\n          el, j = 0, gradientDefs = { };\n      j = elList.length;\n      while (j--) {\n        el = elList[j];\n        if (el.getAttribute('xlink:href')) {\n          recursivelyParseGradientsXlink(doc, el);\n        }\n        gradientDefs[el.getAttribute('id')] = el;\n      }\n      return gradientDefs;\n    },\n\n    /**\n     * Returns an object of attributes' name/value, given element and an array of attribute names;\n     * Parses parent \"g\" nodes recursively upwards.\n     * @static\n     * @memberOf fabric\n     * @param {DOMElement} element Element to parse\n     * @param {Array} attributes Array of attributes to parse\n     * @return {Object} object containing parsed attributes' names/values\n     */\n    parseAttributes: function(element, attributes, svgUid) {\n\n      if (!element) {\n        return;\n      }\n\n      var value,\n          parentAttributes = { },\n          fontSize, parentFontSize;\n\n      if (typeof svgUid === 'undefined') {\n        svgUid = element.getAttribute('svgUid');\n      }\n      // if there's a parent container (`g` or `a` or `symbol` node), parse its attributes recursively upwards\n      if (element.parentNode && fabric.svgValidParentsRegEx.test(element.parentNode.nodeName)) {\n        parentAttributes = fabric.parseAttributes(element.parentNode, attributes, svgUid);\n      }\n\n      var ownAttributes = attributes.reduce(function(memo, attr) {\n        value = element.getAttribute(attr);\n        if (value) { // eslint-disable-line\n          memo[attr] = value;\n        }\n        return memo;\n      }, { });\n      // add values parsed from style, which take precedence over attributes\n      // (see: http://www.w3.org/TR/SVG/styling.html#UsingPresentationAttributes)\n      var cssAttrs = extend(\n        getGlobalStylesForElement(element, svgUid),\n        fabric.parseStyleAttribute(element)\n      );\n      ownAttributes = extend(\n        ownAttributes,\n        cssAttrs\n      );\n      if (cssAttrs[cPath]) {\n        element.setAttribute(cPath, cssAttrs[cPath]);\n      }\n      fontSize = parentFontSize = parentAttributes.fontSize || fabric.Text.DEFAULT_SVG_FONT_SIZE;\n      if (ownAttributes[fSize]) {\n        // looks like the minimum should be 9px when dealing with ems. this is what looks like in browsers.\n        ownAttributes[fSize] = fontSize = parseUnit(ownAttributes[fSize], parentFontSize);\n      }\n\n      var normalizedAttr, normalizedValue, normalizedStyle = {};\n      for (var attr in ownAttributes) {\n        normalizedAttr = normalizeAttr(attr);\n        normalizedValue = normalizeValue(normalizedAttr, ownAttributes[attr], parentAttributes, fontSize);\n        normalizedStyle[normalizedAttr] = normalizedValue;\n      }\n      if (normalizedStyle && normalizedStyle.font) {\n        fabric.parseFontDeclaration(normalizedStyle.font, normalizedStyle);\n      }\n      var mergedAttrs = extend(parentAttributes, normalizedStyle);\n      return fabric.svgValidParentsRegEx.test(element.nodeName) ? mergedAttrs : _setStrokeFillOpacity(mergedAttrs);\n    },\n\n    /**\n     * Transforms an array of svg elements to corresponding fabric.* instances\n     * @static\n     * @memberOf fabric\n     * @param {Array} elements Array of elements to parse\n     * @param {Function} callback Being passed an array of fabric instances (transformed from SVG elements)\n     * @param {Object} [options] Options object\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     */\n    parseElements: function(elements, callback, options, reviver, parsingOptions) {\n      new fabric.ElementsParser(elements, callback, options, reviver, parsingOptions).parse();\n    },\n\n    /**\n     * Parses \"style\" attribute, retuning an object with values\n     * @static\n     * @memberOf fabric\n     * @param {SVGElement} element Element to parse\n     * @return {Object} Objects with values parsed from style attribute of an element\n     */\n    parseStyleAttribute: function(element) {\n      var oStyle = { },\n          style = element.getAttribute('style');\n\n      if (!style) {\n        return oStyle;\n      }\n\n      if (typeof style === 'string') {\n        parseStyleString(style, oStyle);\n      }\n      else {\n        parseStyleObject(style, oStyle);\n      }\n\n      return oStyle;\n    },\n\n    /**\n     * Parses \"points\" attribute, returning an array of values\n     * @static\n     * @memberOf fabric\n     * @param {String} points points attribute string\n     * @return {Array} array of points\n     */\n    parsePointsAttribute: function(points) {\n\n      // points attribute is required and must not be empty\n      if (!points) {\n        return null;\n      }\n\n      // replace commas with whitespace and remove bookending whitespace\n      points = points.replace(/,/g, ' ').trim();\n\n      points = points.split(/\\s+/);\n      var parsedPoints = [], i, len;\n\n      for (i = 0, len = points.length; i < len; i += 2) {\n        parsedPoints.push({\n          x: parseFloat(points[i]),\n          y: parseFloat(points[i + 1])\n        });\n      }\n\n      // odd number of points is an error\n      // if (parsedPoints.length % 2 !== 0) {\n      //   return null;\n      // }\n\n      return parsedPoints;\n    },\n\n    /**\n     * Returns CSS rules for a given SVG document\n     * @static\n     * @function\n     * @memberOf fabric\n     * @param {SVGDocument} doc SVG document to parse\n     * @return {Object} CSS rules of this document\n     */\n    getCSSRules: function(doc) {\n      var styles = doc.getElementsByTagName('style'), i, len,\n          allRules = { }, rules;\n\n      // very crude parsing of style contents\n      for (i = 0, len = styles.length; i < len; i++) {\n        var styleContents = styles[i].textContent;\n\n        // remove comments\n        styleContents = styleContents.replace(/\\/\\*[\\s\\S]*?\\*\\//g, '');\n        if (styleContents.trim() === '') {\n          continue;\n        }\n        // recovers all the rule in this form `body { style code... }`\n        // rules = styleContents.match(/[^{]*\\{[\\s\\S]*?\\}/g);\n        rules = styleContents.split('}');\n        // remove empty rules.\n        rules = rules.filter(function(rule) { return rule.trim(); });\n        // at this point we have hopefully an array of rules `body { style code... `\n        // eslint-disable-next-line no-loop-func\n        rules.forEach(function(rule) {\n\n          var match = rule.split('{'),\n              ruleObj = { }, declaration = match[1].trim(),\n              propertyValuePairs = declaration.split(';').filter(function(pair) { return pair.trim(); });\n\n          for (i = 0, len = propertyValuePairs.length; i < len; i++) {\n            var pair = propertyValuePairs[i].split(':'),\n                property = pair[0].trim(),\n                value = pair[1].trim();\n            ruleObj[property] = value;\n          }\n          rule = match[0].trim();\n          rule.split(',').forEach(function(_rule) {\n            _rule = _rule.replace(/^svg/i, '').trim();\n            if (_rule === '') {\n              return;\n            }\n            if (allRules[_rule]) {\n              fabric.util.object.extend(allRules[_rule], ruleObj);\n            }\n            else {\n              allRules[_rule] = fabric.util.object.clone(ruleObj);\n            }\n          });\n        });\n      }\n      return allRules;\n    },\n\n    /**\n     * Takes url corresponding to an SVG document, and parses it into a set of fabric objects.\n     * Note that SVG is fetched via XMLHttpRequest, so it needs to conform to SOP (Same Origin Policy)\n     * @memberOf fabric\n     * @param {String} url\n     * @param {Function} callback\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     * @param {Object} [options] Object containing options for parsing\n     * @param {String} [options.crossOrigin] crossOrigin crossOrigin setting to use for external resources\n     */\n    loadSVGFromURL: function(url, callback, reviver, options) {\n\n      url = url.replace(/^\\n\\s*/, '').trim();\n      new fabric.util.request(url, {\n        method: 'get',\n        onComplete: onComplete\n      });\n\n      function onComplete(r) {\n\n        var xml = r.responseXML;\n        if (!xml || !xml.documentElement) {\n          callback && callback(null);\n          return false;\n        }\n\n        fabric.parseSVGDocument(xml.documentElement, function (results, _options, elements, allElements) {\n          callback && callback(results, _options, elements, allElements);\n        }, reviver, options);\n      }\n    },\n\n    /**\n     * Takes string corresponding to an SVG document, and parses it into a set of fabric objects\n     * @memberOf fabric\n     * @param {String} string\n     * @param {Function} callback\n     * @param {Function} [reviver] Method for further parsing of SVG elements, called after each fabric object created.\n     * @param {Object} [options] Object containing options for parsing\n     * @param {String} [options.crossOrigin] crossOrigin crossOrigin setting to use for external resources\n     */\n    loadSVGFromString: function(string, callback, reviver, options) {\n      var parser = new fabric.window.DOMParser(),\n          doc = parser.parseFromString(string.trim(), 'text/xml');\n      fabric.parseSVGDocument(doc.documentElement, function (results, _options, elements, allElements) {\n        callback(results, _options, elements, allElements);\n      }, reviver, options);\n    }\n  });\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\nfabric.ElementsParser = function(elements, callback, options, reviver, parsingOptions, doc) {\n  this.elements = elements;\n  this.callback = callback;\n  this.options = options;\n  this.reviver = reviver;\n  this.svgUid = (options && options.svgUid) || 0;\n  this.parsingOptions = parsingOptions;\n  this.regexUrl = /^url\\(['\"]?#([^'\"]+)['\"]?\\)/g;\n  this.doc = doc;\n};\n\n(function(proto) {\n  proto.parse = function() {\n    this.instances = new Array(this.elements.length);\n    this.numElements = this.elements.length;\n    this.createObjects();\n  };\n\n  proto.createObjects = function() {\n    var _this = this;\n    this.elements.forEach(function(element, i) {\n      element.setAttribute('svgUid', _this.svgUid);\n      _this.createObject(element, i);\n    });\n  };\n\n  proto.findTag = function(el) {\n    return fabric[fabric.util.string.capitalize(el.tagName.replace('svg:', ''))];\n  };\n\n  proto.createObject = function(el, index) {\n    var klass = this.findTag(el);\n    if (klass && klass.fromElement) {\n      try {\n        klass.fromElement(el, this.createCallback(index, el), this.options);\n      }\n      catch (err) {\n        fabric.log(err);\n      }\n    }\n    else {\n      this.checkIfDone();\n    }\n  };\n\n  proto.createCallback = function(index, el) {\n    var _this = this;\n    return function(obj) {\n      var _options;\n      _this.resolveGradient(obj, el, 'fill');\n      _this.resolveGradient(obj, el, 'stroke');\n      if (obj instanceof fabric.Image && obj._originalElement) {\n        _options = obj.parsePreserveAspectRatioAttribute(el);\n      }\n      obj._removeTransformMatrix(_options);\n      _this.resolveClipPath(obj, el);\n      _this.reviver && _this.reviver(el, obj);\n      _this.instances[index] = obj;\n      _this.checkIfDone();\n    };\n  };\n\n  proto.extractPropertyDefinition = function(obj, property, storage) {\n    var value = obj[property], regex = this.regexUrl;\n    if (!regex.test(value)) {\n      return;\n    }\n    regex.lastIndex = 0;\n    var id = regex.exec(value)[1];\n    regex.lastIndex = 0;\n    return fabric[storage][this.svgUid][id];\n  };\n\n  proto.resolveGradient = function(obj, el, property) {\n    var gradientDef = this.extractPropertyDefinition(obj, property, 'gradientDefs');\n    if (gradientDef) {\n      var opacityAttr = el.getAttribute(property + '-opacity');\n      var gradient = fabric.Gradient.fromElement(gradientDef, obj, opacityAttr, this.options);\n      obj.set(property, gradient);\n    }\n  };\n\n  proto.createClipPathCallback = function(obj, container) {\n    return function(_newObj) {\n      _newObj._removeTransformMatrix();\n      _newObj.fillRule = _newObj.clipRule;\n      container.push(_newObj);\n    };\n  };\n\n  proto.resolveClipPath = function(obj, usingElement) {\n    var clipPath = this.extractPropertyDefinition(obj, 'clipPath', 'clipPaths'),\n        element, klass, objTransformInv, container, gTransform, options;\n    if (clipPath) {\n      container = [];\n      objTransformInv = fabric.util.invertTransform(obj.calcTransformMatrix());\n      // move the clipPath tag as sibling to the real element that is using it\n      var clipPathTag = clipPath[0].parentNode;\n      var clipPathOwner = usingElement;\n      while (clipPathOwner.parentNode && clipPathOwner.getAttribute('clip-path') !== obj.clipPath) {\n        clipPathOwner = clipPathOwner.parentNode;\n      }\n      clipPathOwner.parentNode.appendChild(clipPathTag);\n      for (var i = 0; i < clipPath.length; i++) {\n        element = clipPath[i];\n        klass = this.findTag(element);\n        klass.fromElement(\n          element,\n          this.createClipPathCallback(obj, container),\n          this.options\n        );\n      }\n      if (container.length === 1) {\n        clipPath = container[0];\n      }\n      else {\n        clipPath = new fabric.Group(container);\n      }\n      gTransform = fabric.util.multiplyTransformMatrices(\n        objTransformInv,\n        clipPath.calcTransformMatrix()\n      );\n      if (clipPath.clipPath) {\n        this.resolveClipPath(clipPath, clipPathOwner);\n      }\n      var options = fabric.util.qrDecompose(gTransform);\n      clipPath.flipX = false;\n      clipPath.flipY = false;\n      clipPath.set('scaleX', options.scaleX);\n      clipPath.set('scaleY', options.scaleY);\n      clipPath.angle = options.angle;\n      clipPath.skewX = options.skewX;\n      clipPath.skewY = 0;\n      clipPath.setPositionByOrigin({ x: options.translateX, y: options.translateY }, 'center', 'center');\n      obj.clipPath = clipPath;\n    }\n    else {\n      // if clip-path does not resolve to any element, delete the property.\n      delete obj.clipPath;\n    }\n  };\n\n  proto.checkIfDone = function() {\n    if (--this.numElements === 0) {\n      this.instances = this.instances.filter(function(el) {\n        // eslint-disable-next-line no-eq-null, eqeqeq\n        return el != null;\n      });\n      this.callback(this.instances, this.elements);\n    }\n  };\n})(fabric.ElementsParser.prototype);\n\n\n(function(global) {\n\n  'use strict';\n\n  /* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Point) {\n    fabric.warn('fabric.Point is already defined');\n    return;\n  }\n\n  fabric.Point = Point;\n\n  /**\n   * Point class\n   * @class fabric.Point\n   * @memberOf fabric\n   * @constructor\n   * @param {Number} x\n   * @param {Number} y\n   * @return {fabric.Point} thisArg\n   */\n  function Point(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n\n  Point.prototype = /** @lends fabric.Point.prototype */ {\n\n    type: 'point',\n\n    constructor: Point,\n\n    /**\n     * Adds another point to this one and returns another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} new Point instance with added values\n     */\n    add: function (that) {\n      return new Point(this.x + that.x, this.y + that.y);\n    },\n\n    /**\n     * Adds another point to this one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    addEquals: function (that) {\n      this.x += that.x;\n      this.y += that.y;\n      return this;\n    },\n\n    /**\n     * Adds value to this point and returns a new one\n     * @param {Number} scalar\n     * @return {fabric.Point} new Point with added value\n     */\n    scalarAdd: function (scalar) {\n      return new Point(this.x + scalar, this.y + scalar);\n    },\n\n    /**\n     * Adds value to this point\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    scalarAddEquals: function (scalar) {\n      this.x += scalar;\n      this.y += scalar;\n      return this;\n    },\n\n    /**\n     * Subtracts another point from this point and returns a new one\n     * @param {fabric.Point} that\n     * @return {fabric.Point} new Point object with subtracted values\n     */\n    subtract: function (that) {\n      return new Point(this.x - that.x, this.y - that.y);\n    },\n\n    /**\n     * Subtracts another point from this point\n     * @param {fabric.Point} that\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    subtractEquals: function (that) {\n      this.x -= that.x;\n      this.y -= that.y;\n      return this;\n    },\n\n    /**\n     * Subtracts value from this point and returns a new one\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    scalarSubtract: function (scalar) {\n      return new Point(this.x - scalar, this.y - scalar);\n    },\n\n    /**\n     * Subtracts value from this point\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    scalarSubtractEquals: function (scalar) {\n      this.x -= scalar;\n      this.y -= scalar;\n      return this;\n    },\n\n    /**\n     * Multiplies this point by a value and returns a new one\n     * TODO: rename in scalarMultiply in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    multiply: function (scalar) {\n      return new Point(this.x * scalar, this.y * scalar);\n    },\n\n    /**\n     * Multiplies this point by a value\n     * TODO: rename in scalarMultiplyEquals in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    multiplyEquals: function (scalar) {\n      this.x *= scalar;\n      this.y *= scalar;\n      return this;\n    },\n\n    /**\n     * Divides this point by a value and returns a new one\n     * TODO: rename in scalarDivide in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point}\n     */\n    divide: function (scalar) {\n      return new Point(this.x / scalar, this.y / scalar);\n    },\n\n    /**\n     * Divides this point by a value\n     * TODO: rename in scalarDivideEquals in 2.0\n     * @param {Number} scalar\n     * @return {fabric.Point} thisArg\n     * @chainable\n     */\n    divideEquals: function (scalar) {\n      this.x /= scalar;\n      this.y /= scalar;\n      return this;\n    },\n\n    /**\n     * Returns true if this point is equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    eq: function (that) {\n      return (this.x === that.x && this.y === that.y);\n    },\n\n    /**\n     * Returns true if this point is less than another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    lt: function (that) {\n      return (this.x < that.x && this.y < that.y);\n    },\n\n    /**\n     * Returns true if this point is less than or equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    lte: function (that) {\n      return (this.x <= that.x && this.y <= that.y);\n    },\n\n    /**\n\n     * Returns true if this point is greater another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    gt: function (that) {\n      return (this.x > that.x && this.y > that.y);\n    },\n\n    /**\n     * Returns true if this point is greater than or equal to another one\n     * @param {fabric.Point} that\n     * @return {Boolean}\n     */\n    gte: function (that) {\n      return (this.x >= that.x && this.y >= that.y);\n    },\n\n    /**\n     * Returns new point which is the result of linear interpolation with this one and another one\n     * @param {fabric.Point} that\n     * @param {Number} t , position of interpolation, between 0 and 1 default 0.5\n     * @return {fabric.Point}\n     */\n    lerp: function (that, t) {\n      if (typeof t === 'undefined') {\n        t = 0.5;\n      }\n      t = Math.max(Math.min(1, t), 0);\n      return new Point(this.x + (that.x - this.x) * t, this.y + (that.y - this.y) * t);\n    },\n\n    /**\n     * Returns distance from this point and another one\n     * @param {fabric.Point} that\n     * @return {Number}\n     */\n    distanceFrom: function (that) {\n      var dx = this.x - that.x,\n          dy = this.y - that.y;\n      return Math.sqrt(dx * dx + dy * dy);\n    },\n\n    /**\n     * Returns the point between this point and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    midPointFrom: function (that) {\n      return this.lerp(that);\n    },\n\n    /**\n     * Returns a new point which is the min of this and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    min: function (that) {\n      return new Point(Math.min(this.x, that.x), Math.min(this.y, that.y));\n    },\n\n    /**\n     * Returns a new point which is the max of this and another one\n     * @param {fabric.Point} that\n     * @return {fabric.Point}\n     */\n    max: function (that) {\n      return new Point(Math.max(this.x, that.x), Math.max(this.y, that.y));\n    },\n\n    /**\n     * Returns string representation of this point\n     * @return {String}\n     */\n    toString: function () {\n      return this.x + ',' + this.y;\n    },\n\n    /**\n     * Sets x/y of this point\n     * @param {Number} x\n     * @param {Number} y\n     * @chainable\n     */\n    setXY: function (x, y) {\n      this.x = x;\n      this.y = y;\n      return this;\n    },\n\n    /**\n     * Sets x of this point\n     * @param {Number} x\n     * @chainable\n     */\n    setX: function (x) {\n      this.x = x;\n      return this;\n    },\n\n    /**\n     * Sets y of this point\n     * @param {Number} y\n     * @chainable\n     */\n    setY: function (y) {\n      this.y = y;\n      return this;\n    },\n\n    /**\n     * Sets x/y of this point from another point\n     * @param {fabric.Point} that\n     * @chainable\n     */\n    setFromPoint: function (that) {\n      this.x = that.x;\n      this.y = that.y;\n      return this;\n    },\n\n    /**\n     * Swaps x/y of this point and another point\n     * @param {fabric.Point} that\n     */\n    swap: function (that) {\n      var x = this.x,\n          y = this.y;\n      this.x = that.x;\n      this.y = that.y;\n      that.x = x;\n      that.y = y;\n    },\n\n    /**\n     * return a cloned instance of the point\n     * @return {fabric.Point}\n     */\n    clone: function () {\n      return new Point(this.x, this.y);\n    }\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  /* Adaptation of work of Kevin Lindsey (kevin@kevlindev.com) */\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Intersection) {\n    fabric.warn('fabric.Intersection is already defined');\n    return;\n  }\n\n  /**\n   * Intersection class\n   * @class fabric.Intersection\n   * @memberOf fabric\n   * @constructor\n   */\n  function Intersection(status) {\n    this.status = status;\n    this.points = [];\n  }\n\n  fabric.Intersection = Intersection;\n\n  fabric.Intersection.prototype = /** @lends fabric.Intersection.prototype */ {\n\n    constructor: Intersection,\n\n    /**\n     * Appends a point to intersection\n     * @param {fabric.Point} point\n     * @return {fabric.Intersection} thisArg\n     * @chainable\n     */\n    appendPoint: function (point) {\n      this.points.push(point);\n      return this;\n    },\n\n    /**\n     * Appends points to intersection\n     * @param {Array} points\n     * @return {fabric.Intersection} thisArg\n     * @chainable\n     */\n    appendPoints: function (points) {\n      this.points = this.points.concat(points);\n      return this;\n    }\n  };\n\n  /**\n   * Checks if one line intersects another\n   * TODO: rename in intersectSegmentSegment\n   * @static\n   * @param {fabric.Point} a1\n   * @param {fabric.Point} a2\n   * @param {fabric.Point} b1\n   * @param {fabric.Point} b2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectLineLine = function (a1, a2, b1, b2) {\n    var result,\n        uaT = (b2.x - b1.x) * (a1.y - b1.y) - (b2.y - b1.y) * (a1.x - b1.x),\n        ubT = (a2.x - a1.x) * (a1.y - b1.y) - (a2.y - a1.y) * (a1.x - b1.x),\n        uB = (b2.y - b1.y) * (a2.x - a1.x) - (b2.x - b1.x) * (a2.y - a1.y);\n    if (uB !== 0) {\n      var ua = uaT / uB,\n          ub = ubT / uB;\n      if (0 <= ua && ua <= 1 && 0 <= ub && ub <= 1) {\n        result = new Intersection('Intersection');\n        result.appendPoint(new fabric.Point(a1.x + ua * (a2.x - a1.x), a1.y + ua * (a2.y - a1.y)));\n      }\n      else {\n        result = new Intersection();\n      }\n    }\n    else {\n      if (uaT === 0 || ubT === 0) {\n        result = new Intersection('Coincident');\n      }\n      else {\n        result = new Intersection('Parallel');\n      }\n    }\n    return result;\n  };\n\n  /**\n   * Checks if line intersects polygon\n   * TODO: rename in intersectSegmentPolygon\n   * fix detection of coincident\n   * @static\n   * @param {fabric.Point} a1\n   * @param {fabric.Point} a2\n   * @param {Array} points\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectLinePolygon = function(a1, a2, points) {\n    var result = new Intersection(),\n        length = points.length,\n        b1, b2, inter, i;\n\n    for (i = 0; i < length; i++) {\n      b1 = points[i];\n      b2 = points[(i + 1) % length];\n      inter = Intersection.intersectLineLine(a1, a2, b1, b2);\n\n      result.appendPoints(inter.points);\n    }\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n  /**\n   * Checks if polygon intersects another polygon\n   * @static\n   * @param {Array} points1\n   * @param {Array} points2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectPolygonPolygon = function (points1, points2) {\n    var result = new Intersection(),\n        length = points1.length, i;\n\n    for (i = 0; i < length; i++) {\n      var a1 = points1[i],\n          a2 = points1[(i + 1) % length],\n          inter = Intersection.intersectLinePolygon(a1, a2, points2);\n\n      result.appendPoints(inter.points);\n    }\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n  /**\n   * Checks if polygon intersects rectangle\n   * @static\n   * @param {Array} points\n   * @param {fabric.Point} r1\n   * @param {fabric.Point} r2\n   * @return {fabric.Intersection}\n   */\n  fabric.Intersection.intersectPolygonRectangle = function (points, r1, r2) {\n    var min = r1.min(r2),\n        max = r1.max(r2),\n        topRight = new fabric.Point(max.x, min.y),\n        bottomLeft = new fabric.Point(min.x, max.y),\n        inter1 = Intersection.intersectLinePolygon(min, topRight, points),\n        inter2 = Intersection.intersectLinePolygon(topRight, max, points),\n        inter3 = Intersection.intersectLinePolygon(max, bottomLeft, points),\n        inter4 = Intersection.intersectLinePolygon(bottomLeft, min, points),\n        result = new Intersection();\n\n    result.appendPoints(inter1.points);\n    result.appendPoints(inter2.points);\n    result.appendPoints(inter3.points);\n    result.appendPoints(inter4.points);\n\n    if (result.points.length > 0) {\n      result.status = 'Intersection';\n    }\n    return result;\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Color) {\n    fabric.warn('fabric.Color is already defined.');\n    return;\n  }\n\n  /**\n   * Color class\n   * The purpose of {@link fabric.Color} is to abstract and encapsulate common color operations;\n   * {@link fabric.Color} is a constructor and creates instances of {@link fabric.Color} objects.\n   *\n   * @class fabric.Color\n   * @param {String} color optional in hex or rgb(a) or hsl format or from known color list\n   * @return {fabric.Color} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2/#colors}\n   */\n  function Color(color) {\n    if (!color) {\n      this.setSource([0, 0, 0, 1]);\n    }\n    else {\n      this._tryParsingColor(color);\n    }\n  }\n\n  fabric.Color = Color;\n\n  fabric.Color.prototype = /** @lends fabric.Color.prototype */ {\n\n    /**\n     * @private\n     * @param {String|Array} color Color value to parse\n     */\n    _tryParsingColor: function(color) {\n      var source;\n\n      if (color in Color.colorNameMap) {\n        color = Color.colorNameMap[color];\n      }\n\n      if (color === 'transparent') {\n        source = [255, 255, 255, 0];\n      }\n\n      if (!source) {\n        source = Color.sourceFromHex(color);\n      }\n      if (!source) {\n        source = Color.sourceFromRgb(color);\n      }\n      if (!source) {\n        source = Color.sourceFromHsl(color);\n      }\n      if (!source) {\n        //if color is not recognize let's make black as canvas does\n        source = [0, 0, 0, 1];\n      }\n      if (source) {\n        this.setSource(source);\n      }\n    },\n\n    /**\n     * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\n     * @private\n     * @param {Number} r Red color value\n     * @param {Number} g Green color value\n     * @param {Number} b Blue color value\n     * @return {Array} Hsl color\n     */\n    _rgbToHsl: function(r, g, b) {\n      r /= 255; g /= 255; b /= 255;\n\n      var h, s, l,\n          max = fabric.util.array.max([r, g, b]),\n          min = fabric.util.array.min([r, g, b]);\n\n      l = (max + min) / 2;\n\n      if (max === min) {\n        h = s = 0; // achromatic\n      }\n      else {\n        var d = max - min;\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n        switch (max) {\n          case r:\n            h = (g - b) / d + (g < b ? 6 : 0);\n            break;\n          case g:\n            h = (b - r) / d + 2;\n            break;\n          case b:\n            h = (r - g) / d + 4;\n            break;\n        }\n        h /= 6;\n      }\n\n      return [\n        Math.round(h * 360),\n        Math.round(s * 100),\n        Math.round(l * 100)\n      ];\n    },\n\n    /**\n     * Returns source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n     * @return {Array}\n     */\n    getSource: function() {\n      return this._source;\n    },\n\n    /**\n     * Sets source of this color (where source is an array representation; ex: [200, 200, 100, 1])\n     * @param {Array} source\n     */\n    setSource: function(source) {\n      this._source = source;\n    },\n\n    /**\n     * Returns color representation in RGB format\n     * @return {String} ex: rgb(0-255,0-255,0-255)\n     */\n    toRgb: function() {\n      var source = this.getSource();\n      return 'rgb(' + source[0] + ',' + source[1] + ',' + source[2] + ')';\n    },\n\n    /**\n     * Returns color representation in RGBA format\n     * @return {String} ex: rgba(0-255,0-255,0-255,0-1)\n     */\n    toRgba: function() {\n      var source = this.getSource();\n      return 'rgba(' + source[0] + ',' + source[1] + ',' + source[2] + ',' + source[3] + ')';\n    },\n\n    /**\n     * Returns color representation in HSL format\n     * @return {String} ex: hsl(0-360,0%-100%,0%-100%)\n     */\n    toHsl: function() {\n      var source = this.getSource(),\n          hsl = this._rgbToHsl(source[0], source[1], source[2]);\n\n      return 'hsl(' + hsl[0] + ',' + hsl[1] + '%,' + hsl[2] + '%)';\n    },\n\n    /**\n     * Returns color representation in HSLA format\n     * @return {String} ex: hsla(0-360,0%-100%,0%-100%,0-1)\n     */\n    toHsla: function() {\n      var source = this.getSource(),\n          hsl = this._rgbToHsl(source[0], source[1], source[2]);\n\n      return 'hsla(' + hsl[0] + ',' + hsl[1] + '%,' + hsl[2] + '%,' + source[3] + ')';\n    },\n\n    /**\n     * Returns color representation in HEX format\n     * @return {String} ex: FF5555\n     */\n    toHex: function() {\n      var source = this.getSource(), r, g, b;\n\n      r = source[0].toString(16);\n      r = (r.length === 1) ? ('0' + r) : r;\n\n      g = source[1].toString(16);\n      g = (g.length === 1) ? ('0' + g) : g;\n\n      b = source[2].toString(16);\n      b = (b.length === 1) ? ('0' + b) : b;\n\n      return r.toUpperCase() + g.toUpperCase() + b.toUpperCase();\n    },\n\n    /**\n     * Returns color representation in HEXA format\n     * @return {String} ex: FF5555CC\n     */\n    toHexa: function() {\n      var source = this.getSource(), a;\n\n      a = Math.round(source[3] * 255);\n      a = a.toString(16);\n      a = (a.length === 1) ? ('0' + a) : a;\n\n      return this.toHex() + a.toUpperCase();\n    },\n\n    /**\n     * Gets value of alpha channel for this color\n     * @return {Number} 0-1\n     */\n    getAlpha: function() {\n      return this.getSource()[3];\n    },\n\n    /**\n     * Sets value of alpha channel for this color\n     * @param {Number} alpha Alpha value 0-1\n     * @return {fabric.Color} thisArg\n     */\n    setAlpha: function(alpha) {\n      var source = this.getSource();\n      source[3] = alpha;\n      this.setSource(source);\n      return this;\n    },\n\n    /**\n     * Transforms color to its grayscale representation\n     * @return {fabric.Color} thisArg\n     */\n    toGrayscale: function() {\n      var source = this.getSource(),\n          average = parseInt((source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0), 10),\n          currentAlpha = source[3];\n      this.setSource([average, average, average, currentAlpha]);\n      return this;\n    },\n\n    /**\n     * Transforms color to its black and white representation\n     * @param {Number} threshold\n     * @return {fabric.Color} thisArg\n     */\n    toBlackWhite: function(threshold) {\n      var source = this.getSource(),\n          average = (source[0] * 0.3 + source[1] * 0.59 + source[2] * 0.11).toFixed(0),\n          currentAlpha = source[3];\n\n      threshold = threshold || 127;\n\n      average = (Number(average) < Number(threshold)) ? 0 : 255;\n      this.setSource([average, average, average, currentAlpha]);\n      return this;\n    },\n\n    /**\n     * Overlays color with another color\n     * @param {String|fabric.Color} otherColor\n     * @return {fabric.Color} thisArg\n     */\n    overlayWith: function(otherColor) {\n      if (!(otherColor instanceof Color)) {\n        otherColor = new Color(otherColor);\n      }\n\n      var result = [],\n          alpha = this.getAlpha(),\n          otherAlpha = 0.5,\n          source = this.getSource(),\n          otherSource = otherColor.getSource(), i;\n\n      for (i = 0; i < 3; i++) {\n        result.push(Math.round((source[i] * (1 - otherAlpha)) + (otherSource[i] * otherAlpha)));\n      }\n\n      result[3] = alpha;\n      this.setSource(result);\n      return this;\n    }\n  };\n\n  /**\n   * Regex matching color in RGB or RGBA formats (ex: rgb(0, 0, 0), rgba(255, 100, 10, 0.5), rgba( 255 , 100 , 10 , 0.5 ), rgb(1,1,1), rgba(100%, 60%, 10%, 0.5))\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  // eslint-disable-next-line max-len\n  fabric.Color.reRGBa = /^rgba?\\(\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*,\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*,\\s*(\\d{1,3}(?:\\.\\d+)?\\%?)\\s*(?:\\s*,\\s*((?:\\d*\\.?\\d+)?)\\s*)?\\)$/i;\n\n  /**\n   * Regex matching color in HSL or HSLA formats (ex: hsl(200, 80%, 10%), hsla(300, 50%, 80%, 0.5), hsla( 300 , 50% , 80% , 0.5 ))\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  fabric.Color.reHSLa = /^hsla?\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3}\\%)\\s*,\\s*(\\d{1,3}\\%)\\s*(?:\\s*,\\s*(\\d+(?:\\.\\d+)?)\\s*)?\\)$/i;\n\n  /**\n   * Regex matching color in HEX format (ex: #FF5544CC, #FF5555, 010155, aff)\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   */\n  fabric.Color.reHex = /^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i;\n\n  /**\n   * Map of the 148 color names with HEX code\n   * @static\n   * @field\n   * @memberOf fabric.Color\n   * @see: https://www.w3.org/TR/css3-color/#svg-color\n   */\n  fabric.Color.colorNameMap = {\n    aliceblue:            '#F0F8FF',\n    antiquewhite:         '#FAEBD7',\n    aqua:                 '#00FFFF',\n    aquamarine:           '#7FFFD4',\n    azure:                '#F0FFFF',\n    beige:                '#F5F5DC',\n    bisque:               '#FFE4C4',\n    black:                '#000000',\n    blanchedalmond:       '#FFEBCD',\n    blue:                 '#0000FF',\n    blueviolet:           '#8A2BE2',\n    brown:                '#A52A2A',\n    burlywood:            '#DEB887',\n    cadetblue:            '#5F9EA0',\n    chartreuse:           '#7FFF00',\n    chocolate:            '#D2691E',\n    coral:                '#FF7F50',\n    cornflowerblue:       '#6495ED',\n    cornsilk:             '#FFF8DC',\n    crimson:              '#DC143C',\n    cyan:                 '#00FFFF',\n    darkblue:             '#00008B',\n    darkcyan:             '#008B8B',\n    darkgoldenrod:        '#B8860B',\n    darkgray:             '#A9A9A9',\n    darkgrey:             '#A9A9A9',\n    darkgreen:            '#006400',\n    darkkhaki:            '#BDB76B',\n    darkmagenta:          '#8B008B',\n    darkolivegreen:       '#556B2F',\n    darkorange:           '#FF8C00',\n    darkorchid:           '#9932CC',\n    darkred:              '#8B0000',\n    darksalmon:           '#E9967A',\n    darkseagreen:         '#8FBC8F',\n    darkslateblue:        '#483D8B',\n    darkslategray:        '#2F4F4F',\n    darkslategrey:        '#2F4F4F',\n    darkturquoise:        '#00CED1',\n    darkviolet:           '#9400D3',\n    deeppink:             '#FF1493',\n    deepskyblue:          '#00BFFF',\n    dimgray:              '#696969',\n    dimgrey:              '#696969',\n    dodgerblue:           '#1E90FF',\n    firebrick:            '#B22222',\n    floralwhite:          '#FFFAF0',\n    forestgreen:          '#228B22',\n    fuchsia:              '#FF00FF',\n    gainsboro:            '#DCDCDC',\n    ghostwhite:           '#F8F8FF',\n    gold:                 '#FFD700',\n    goldenrod:            '#DAA520',\n    gray:                 '#808080',\n    grey:                 '#808080',\n    green:                '#008000',\n    greenyellow:          '#ADFF2F',\n    honeydew:             '#F0FFF0',\n    hotpink:              '#FF69B4',\n    indianred:            '#CD5C5C',\n    indigo:               '#4B0082',\n    ivory:                '#FFFFF0',\n    khaki:                '#F0E68C',\n    lavender:             '#E6E6FA',\n    lavenderblush:        '#FFF0F5',\n    lawngreen:            '#7CFC00',\n    lemonchiffon:         '#FFFACD',\n    lightblue:            '#ADD8E6',\n    lightcoral:           '#F08080',\n    lightcyan:            '#E0FFFF',\n    lightgoldenrodyellow: '#FAFAD2',\n    lightgray:            '#D3D3D3',\n    lightgrey:            '#D3D3D3',\n    lightgreen:           '#90EE90',\n    lightpink:            '#FFB6C1',\n    lightsalmon:          '#FFA07A',\n    lightseagreen:        '#20B2AA',\n    lightskyblue:         '#87CEFA',\n    lightslategray:       '#778899',\n    lightslategrey:       '#778899',\n    lightsteelblue:       '#B0C4DE',\n    lightyellow:          '#FFFFE0',\n    lime:                 '#00FF00',\n    limegreen:            '#32CD32',\n    linen:                '#FAF0E6',\n    magenta:              '#FF00FF',\n    maroon:               '#800000',\n    mediumaquamarine:     '#66CDAA',\n    mediumblue:           '#0000CD',\n    mediumorchid:         '#BA55D3',\n    mediumpurple:         '#9370DB',\n    mediumseagreen:       '#3CB371',\n    mediumslateblue:      '#7B68EE',\n    mediumspringgreen:    '#00FA9A',\n    mediumturquoise:      '#48D1CC',\n    mediumvioletred:      '#C71585',\n    midnightblue:         '#191970',\n    mintcream:            '#F5FFFA',\n    mistyrose:            '#FFE4E1',\n    moccasin:             '#FFE4B5',\n    navajowhite:          '#FFDEAD',\n    navy:                 '#000080',\n    oldlace:              '#FDF5E6',\n    olive:                '#808000',\n    olivedrab:            '#6B8E23',\n    orange:               '#FFA500',\n    orangered:            '#FF4500',\n    orchid:               '#DA70D6',\n    palegoldenrod:        '#EEE8AA',\n    palegreen:            '#98FB98',\n    paleturquoise:        '#AFEEEE',\n    palevioletred:        '#DB7093',\n    papayawhip:           '#FFEFD5',\n    peachpuff:            '#FFDAB9',\n    peru:                 '#CD853F',\n    pink:                 '#FFC0CB',\n    plum:                 '#DDA0DD',\n    powderblue:           '#B0E0E6',\n    purple:               '#800080',\n    rebeccapurple:        '#663399',\n    red:                  '#FF0000',\n    rosybrown:            '#BC8F8F',\n    royalblue:            '#4169E1',\n    saddlebrown:          '#8B4513',\n    salmon:               '#FA8072',\n    sandybrown:           '#F4A460',\n    seagreen:             '#2E8B57',\n    seashell:             '#FFF5EE',\n    sienna:               '#A0522D',\n    silver:               '#C0C0C0',\n    skyblue:              '#87CEEB',\n    slateblue:            '#6A5ACD',\n    slategray:            '#708090',\n    slategrey:            '#708090',\n    snow:                 '#FFFAFA',\n    springgreen:          '#00FF7F',\n    steelblue:            '#4682B4',\n    tan:                  '#D2B48C',\n    teal:                 '#008080',\n    thistle:              '#D8BFD8',\n    tomato:               '#FF6347',\n    turquoise:            '#40E0D0',\n    violet:               '#EE82EE',\n    wheat:                '#F5DEB3',\n    white:                '#FFFFFF',\n    whitesmoke:           '#F5F5F5',\n    yellow:               '#FFFF00',\n    yellowgreen:          '#9ACD32'\n  };\n\n  /**\n   * @private\n   * @param {Number} p\n   * @param {Number} q\n   * @param {Number} t\n   * @return {Number}\n   */\n  function hue2rgb(p, q, t) {\n    if (t < 0) {\n      t += 1;\n    }\n    if (t > 1) {\n      t -= 1;\n    }\n    if (t < 1 / 6) {\n      return p + (q - p) * 6 * t;\n    }\n    if (t < 1 / 2) {\n      return q;\n    }\n    if (t < 2 / 3) {\n      return p + (q - p) * (2 / 3 - t) * 6;\n    }\n    return p;\n  }\n\n  /**\n   * Returns new color object, when given a color in RGB format\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255)\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromRgb = function(color) {\n    return Color.fromSource(Color.sourceFromRgb(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in RGB or RGBA format\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: rgb(0-255,0-255,0-255), rgb(0%-100%,0%-100%,0%-100%)\n   * @return {Array} source\n   */\n  fabric.Color.sourceFromRgb = function(color) {\n    var match = color.match(Color.reRGBa);\n    if (match) {\n      var r = parseInt(match[1], 10) / (/%$/.test(match[1]) ? 100 : 1) * (/%$/.test(match[1]) ? 255 : 1),\n          g = parseInt(match[2], 10) / (/%$/.test(match[2]) ? 100 : 1) * (/%$/.test(match[2]) ? 255 : 1),\n          b = parseInt(match[3], 10) / (/%$/.test(match[3]) ? 100 : 1) * (/%$/.test(match[3]) ? 255 : 1);\n\n      return [\n        parseInt(r, 10),\n        parseInt(g, 10),\n        parseInt(b, 10),\n        match[4] ? parseFloat(match[4]) : 1\n      ];\n    }\n  };\n\n  /**\n   * Returns new color object, when given a color in RGBA format\n   * @static\n   * @function\n   * @memberOf fabric.Color\n   * @param {String} color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromRgba = Color.fromRgb;\n\n  /**\n   * Returns new color object, when given a color in HSL format\n   * @param {String} color Color value ex: hsl(0-260,0%-100%,0%-100%)\n   * @memberOf fabric.Color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHsl = function(color) {\n    return Color.fromSource(Color.sourceFromHsl(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HSL or HSLA format.\n   * Adapted from <a href=\"https://rawgithub.com/mjijackson/mjijackson.github.com/master/2008/02/rgb-to-hsl-and-rgb-to-hsv-color-model-conversion-algorithms-in-javascript.html\">https://github.com/mjijackson</a>\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: hsl(0-360,0%-100%,0%-100%) or hsla(0-360,0%-100%,0%-100%, 0-1)\n   * @return {Array} source\n   * @see http://http://www.w3.org/TR/css3-color/#hsl-color\n   */\n  fabric.Color.sourceFromHsl = function(color) {\n    var match = color.match(Color.reHSLa);\n    if (!match) {\n      return;\n    }\n\n    var h = (((parseFloat(match[1]) % 360) + 360) % 360) / 360,\n        s = parseFloat(match[2]) / (/%$/.test(match[2]) ? 100 : 1),\n        l = parseFloat(match[3]) / (/%$/.test(match[3]) ? 100 : 1),\n        r, g, b;\n\n    if (s === 0) {\n      r = g = b = l;\n    }\n    else {\n      var q = l <= 0.5 ? l * (s + 1) : l + s - l * s,\n          p = l * 2 - q;\n\n      r = hue2rgb(p, q, h + 1 / 3);\n      g = hue2rgb(p, q, h);\n      b = hue2rgb(p, q, h - 1 / 3);\n    }\n\n    return [\n      Math.round(r * 255),\n      Math.round(g * 255),\n      Math.round(b * 255),\n      match[4] ? parseFloat(match[4]) : 1\n    ];\n  };\n\n  /**\n   * Returns new color object, when given a color in HSLA format\n   * @static\n   * @function\n   * @memberOf fabric.Color\n   * @param {String} color\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHsla = Color.fromHsl;\n\n  /**\n   * Returns new color object, when given a color in HEX format\n   * @static\n   * @memberOf fabric.Color\n   * @param {String} color Color value ex: FF5555\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromHex = function(color) {\n    return Color.fromSource(Color.sourceFromHex(color));\n  };\n\n  /**\n   * Returns array representation (ex: [100, 100, 200, 1]) of a color that's in HEX format\n   * @static\n   * @memberOf fabric.Color\n   * @param {String} color ex: FF5555 or FF5544CC (RGBa)\n   * @return {Array} source\n   */\n  fabric.Color.sourceFromHex = function(color) {\n    if (color.match(Color.reHex)) {\n      var value = color.slice(color.indexOf('#') + 1),\n          isShortNotation = (value.length === 3 || value.length === 4),\n          isRGBa = (value.length === 8 || value.length === 4),\n          r = isShortNotation ? (value.charAt(0) + value.charAt(0)) : value.substring(0, 2),\n          g = isShortNotation ? (value.charAt(1) + value.charAt(1)) : value.substring(2, 4),\n          b = isShortNotation ? (value.charAt(2) + value.charAt(2)) : value.substring(4, 6),\n          a = isRGBa ? (isShortNotation ? (value.charAt(3) + value.charAt(3)) : value.substring(6, 8)) : 'FF';\n\n      return [\n        parseInt(r, 16),\n        parseInt(g, 16),\n        parseInt(b, 16),\n        parseFloat((parseInt(a, 16) / 255).toFixed(2))\n      ];\n    }\n  };\n\n  /**\n   * Returns new color object, when given color in array representation (ex: [200, 100, 100, 0.5])\n   * @static\n   * @memberOf fabric.Color\n   * @param {Array} source\n   * @return {fabric.Color}\n   */\n  fabric.Color.fromSource = function(source) {\n    var oColor = new Color();\n    oColor.setSource(source);\n    return oColor;\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      scaleMap = ['e', 'se', 's', 'sw', 'w', 'nw', 'n', 'ne', 'e'],\n      skewMap = ['ns', 'nesw', 'ew', 'nwse'],\n      controls = {},\n      LEFT = 'left', TOP = 'top', RIGHT = 'right', BOTTOM = 'bottom', CENTER = 'center',\n      opposite = {\n        top: BOTTOM,\n        bottom: TOP,\n        left: RIGHT,\n        right: LEFT,\n        center: CENTER,\n      }, radiansToDegrees = fabric.util.radiansToDegrees,\n      sign = (Math.sign || function(x) { return ((x > 0) - (x < 0)) || +x; });\n\n  /**\n   * Combine control position and object angle to find the control direction compared\n   * to the object center.\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\n   * @param {fabric.Control} control the control class\n   * @return {Number} 0 - 7 a quadrant number\n   */\n  function findCornerQuadrant(fabricObject, control) {\n    var cornerAngle = fabricObject.angle + radiansToDegrees(Math.atan2(control.y, control.x)) + 360;\n    return Math.round((cornerAngle % 360) / 45);\n  }\n\n  function fireEvent(eventName, options) {\n    var target = options.transform.target,\n        canvas = target.canvas,\n        canvasOptions = fabric.util.object.clone(options);\n    canvasOptions.target = target;\n    canvas && canvas.fire('object:' + eventName, canvasOptions);\n    target.fire(eventName, options);\n  }\n\n  /**\n   * Inspect event and fabricObject properties to understand if the scaling action\n   * @param {Event} eventData from the user action\n   * @param {fabric.Object} fabricObject the fabric object about to scale\n   * @return {Boolean} true if scale is proportional\n   */\n  function scaleIsProportional(eventData, fabricObject) {\n    var canvas = fabricObject.canvas, uniScaleKey = canvas.uniScaleKey,\n        uniformIsToggled = eventData[uniScaleKey];\n    return (canvas.uniformScaling && !uniformIsToggled) ||\n    (!canvas.uniformScaling && uniformIsToggled);\n  }\n\n  /**\n   * Checks if transform is centered\n   * @param {Object} transform transform data\n   * @return {Boolean} true if transform is centered\n   */\n  function isTransformCentered(transform) {\n    return transform.originX === CENTER && transform.originY === CENTER;\n  }\n\n  /**\n   * Inspect fabricObject to understand if the current scaling action is allowed\n   * @param {fabric.Object} fabricObject the fabric object about to scale\n   * @param {String} by 'x' or 'y' or ''\n   * @param {Boolean} scaleProportionally true if we are trying to scale proportionally\n   * @return {Boolean} true if scaling is not allowed at current conditions\n   */\n  function scalingIsForbidden(fabricObject, by, scaleProportionally) {\n    var lockX = fabricObject.lockScalingX, lockY = fabricObject.lockScalingY;\n    if (lockX && lockY) {\n      return true;\n    }\n    if (!by && (lockX || lockY) && scaleProportionally) {\n      return true;\n    }\n    if (lockX && by === 'x') {\n      return true;\n    }\n    if (lockY && by === 'y') {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * return the correct cursor style for the scale action\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */\n  function scaleCursorStyleHandler(eventData, control, fabricObject) {\n    var notAllowed = 'not-allowed',\n        scaleProportionally = scaleIsProportional(eventData, fabricObject),\n        by = '';\n    if (control.x !== 0 && control.y === 0) {\n      by = 'x';\n    }\n    else if (control.x === 0 && control.y !== 0) {\n      by = 'y';\n    }\n    if (scalingIsForbidden(fabricObject, by, scaleProportionally)) {\n      return notAllowed;\n    }\n    var n = findCornerQuadrant(fabricObject, control);\n    return scaleMap[n] + '-resize';\n  }\n\n  /**\n   * return the correct cursor style for the skew action\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */\n  function skewCursorStyleHandler(eventData, control, fabricObject) {\n    var notAllowed = 'not-allowed';\n    if (control.x !== 0 && fabricObject.lockSkewingY) {\n      return notAllowed;\n    }\n    if (control.y !== 0 && fabricObject.lockSkewingX) {\n      return notAllowed;\n    }\n    var n = findCornerQuadrant(fabricObject, control) % 4;\n    return skewMap[n] + '-resize';\n  }\n\n  /**\n   * Combine skew and scale style handlers to cover fabric standard use case\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */\n  function scaleSkewCursorStyleHandler(eventData, control, fabricObject) {\n    if (eventData[fabricObject.canvas.altActionKey]) {\n      return controls.skewCursorStyleHandler(eventData, control, fabricObject);\n    }\n    return controls.scaleCursorStyleHandler(eventData, control, fabricObject);\n  }\n\n  /**\n   * Inspect event, control and fabricObject to return the correct action name\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} an action name\n   */\n  function scaleOrSkewActionName(eventData, control, fabricObject) {\n    var isAlternative = eventData[fabricObject.canvas.altActionKey];\n    if (control.x === 0) {\n      // then is scaleY or skewX\n      return isAlternative ? 'skewX' : 'scaleY';\n    }\n    if (control.y === 0) {\n      // then is scaleY or skewX\n      return isAlternative ? 'skewY' : 'scaleX';\n    }\n  }\n\n  /**\n   * Find the correct style for the control that is used for rotation.\n   * this function is very simple and it just take care of not-allowed or standard cursor\n   * @param {Event} eventData the javascript event that is causing the scale\n   * @param {fabric.Control} control the control that is interested in the action\n   * @param {fabric.Object} fabricObject the fabric object that is interested in the action\n   * @return {String} a valid css string for the cursor\n   */\n  function rotationStyleHandler(eventData, control, fabricObject) {\n    if (fabricObject.lockRotation) {\n      return 'not-allowed';\n    }\n    return control.cursorStyle;\n  }\n\n  function commonEventInfo(eventData, transform, x, y) {\n    return {\n      e: eventData,\n      transform: transform,\n      pointer: {\n        x: x,\n        y: y,\n      }\n    };\n  }\n\n  /**\n   * Wrap an action handler with saving/restoring object position on the transform.\n   * this is the code that permits to objects to keep their position while transforming.\n   * @param {Function} actionHandler the function to wrap\n   * @return {Function} a function with an action handler signature\n   */\n  function wrapWithFixedAnchor(actionHandler) {\n    return function(eventData, transform, x, y) {\n      var target = transform.target, centerPoint = target.getCenterPoint(),\n          constraint = target.translateToOriginPoint(centerPoint, transform.originX, transform.originY),\n          actionPerformed = actionHandler(eventData, transform, x, y);\n      target.setPositionByOrigin(constraint, transform.originX, transform.originY);\n      return actionPerformed;\n    };\n  }\n\n  /**\n   * Wrap an action handler with firing an event if the action is performed\n   * @param {Function} actionHandler the function to wrap\n   * @return {Function} a function with an action handler signature\n   */\n  function wrapWithFireEvent(eventName, actionHandler) {\n    return function(eventData, transform, x, y) {\n      var actionPerformed = actionHandler(eventData, transform, x, y);\n      if (actionPerformed) {\n        fireEvent(eventName, commonEventInfo(eventData, transform, x, y));\n      }\n      return actionPerformed;\n    };\n  }\n\n  /**\n   * Transforms a point described by x and y in a distance from the top left corner of the object\n   * bounding box.\n   * @param {Object} transform\n   * @param {String} originX\n   * @param {String} originY\n   * @param {number} x\n   * @param {number} y\n   * @return {Fabric.Point} the normalized point\n   */\n  function getLocalPoint(transform, originX, originY, x, y) {\n    var target = transform.target,\n        control = target.controls[transform.corner],\n        zoom = target.canvas.getZoom(),\n        padding = target.padding / zoom,\n        localPoint = target.toLocalPoint(new fabric.Point(x, y), originX, originY);\n    if (localPoint.x >= padding) {\n      localPoint.x -= padding;\n    }\n    if (localPoint.x <= -padding) {\n      localPoint.x += padding;\n    }\n    if (localPoint.y >= padding) {\n      localPoint.y -= padding;\n    }\n    if (localPoint.y <= padding) {\n      localPoint.y += padding;\n    }\n    localPoint.x -= control.offsetX;\n    localPoint.y -= control.offsetY;\n    return localPoint;\n  }\n\n  /**\n   * Detect if the fabric object is flipped on one side.\n   * @param {fabric.Object} target\n   * @return {Boolean} true if one flip, but not two.\n   */\n  function targetHasOneFlip(target) {\n    return target.flipX !== target.flipY;\n  }\n\n  /**\n   * Utility function to compensate the scale factor when skew is applied on both axes\n   * @private\n   */\n  function compensateScaleForSkew(target, oppositeSkew, scaleToCompensate, axis, reference) {\n    if (target[oppositeSkew] !== 0) {\n      var newDim = target._getTransformedDimensions()[axis];\n      var newValue = reference / newDim * target[scaleToCompensate];\n      target.set(scaleToCompensate, newValue);\n    }\n  }\n\n  /**\n   * Action handler for skewing on the X axis\n   * @private\n   */\n  function skewObjectX(eventData, transform, x, y) {\n    var target = transform.target,\n        // find how big the object would be, if there was no skewX. takes in account scaling\n        dimNoSkew = target._getTransformedDimensions(0, target.skewY),\n        localPoint = getLocalPoint(transform, transform.originX, transform.originY, x, y),\n        // the mouse is in the center of the object, and we want it to stay there.\n        // so the object will grow twice as much as the mouse.\n        // this makes the skew growth to localPoint * 2 - dimNoSkew.\n        totalSkewSize = Math.abs(localPoint.x * 2) - dimNoSkew.x,\n        currentSkew = target.skewX, newSkew;\n    if (totalSkewSize < 2) {\n      // let's make it easy to go back to position 0.\n      newSkew = 0;\n    }\n    else {\n      newSkew = radiansToDegrees(\n        Math.atan2((totalSkewSize / target.scaleX), (dimNoSkew.y / target.scaleY))\n      );\n      // now we have to find the sign of the skew.\n      // it mostly depend on the origin of transformation.\n      if (transform.originX === LEFT && transform.originY === BOTTOM) {\n        newSkew = -newSkew;\n      }\n      if (transform.originX === RIGHT && transform.originY === TOP) {\n        newSkew = -newSkew;\n      }\n      if (targetHasOneFlip(target)) {\n        newSkew = -newSkew;\n      }\n    }\n    var hasSkewed = currentSkew !== newSkew;\n    if (hasSkewed) {\n      var dimBeforeSkewing = target._getTransformedDimensions().y;\n      target.set('skewX', newSkew);\n      compensateScaleForSkew(target, 'skewY', 'scaleY', 'y', dimBeforeSkewing);\n    }\n    return hasSkewed;\n  }\n\n  /**\n   * Action handler for skewing on the Y axis\n   * @private\n   */\n  function skewObjectY(eventData, transform, x, y) {\n    var target = transform.target,\n        // find how big the object would be, if there was no skewX. takes in account scaling\n        dimNoSkew = target._getTransformedDimensions(target.skewX, 0),\n        localPoint = getLocalPoint(transform, transform.originX, transform.originY, x, y),\n        // the mouse is in the center of the object, and we want it to stay there.\n        // so the object will grow twice as much as the mouse.\n        // this makes the skew growth to localPoint * 2 - dimNoSkew.\n        totalSkewSize = Math.abs(localPoint.y * 2) - dimNoSkew.y,\n        currentSkew = target.skewY, newSkew;\n    if (totalSkewSize < 2) {\n      // let's make it easy to go back to position 0.\n      newSkew = 0;\n    }\n    else {\n      newSkew = radiansToDegrees(\n        Math.atan2((totalSkewSize / target.scaleY), (dimNoSkew.x / target.scaleX))\n      );\n      // now we have to find the sign of the skew.\n      // it mostly depend on the origin of transformation.\n      if (transform.originX === LEFT && transform.originY === BOTTOM) {\n        newSkew = -newSkew;\n      }\n      if (transform.originX === RIGHT && transform.originY === TOP) {\n        newSkew = -newSkew;\n      }\n      if (targetHasOneFlip(target)) {\n        newSkew = -newSkew;\n      }\n    }\n    var hasSkewed = currentSkew !== newSkew;\n    if (hasSkewed) {\n      var dimBeforeSkewing = target._getTransformedDimensions().x;\n      target.set('skewY', newSkew);\n      compensateScaleForSkew(target, 'skewX', 'scaleX', 'x', dimBeforeSkewing);\n    }\n    return hasSkewed;\n  }\n\n  /**\n   * Wrapped Action handler for skewing on the Y axis, takes care of the\n   * skew direction and determine the correct transform origin for the anchor point\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function skewHandlerX(eventData, transform, x, y) {\n    // step1 figure out and change transform origin.\n    // if skewX > 0 and originY bottom we anchor on right\n    // if skewX > 0 and originY top we anchor on left\n    // if skewX < 0 and originY bottom we anchor on left\n    // if skewX < 0 and originY top we anchor on right\n    // if skewX is 0, we look for mouse position to understand where are we going.\n    var target = transform.target, currentSkew = target.skewX, originX, originY = transform.originY;\n    if (target.lockSkewingX) {\n      return false;\n    }\n    if (currentSkew === 0) {\n      var localPointFromCenter = getLocalPoint(transform, CENTER, CENTER, x, y);\n      if (localPointFromCenter.x > 0) {\n        // we are pulling right, anchor left;\n        originX = LEFT;\n      }\n      else {\n        // we are pulling right, anchor right\n        originX = RIGHT;\n      }\n    }\n    else {\n      if (currentSkew > 0) {\n        originX = originY === TOP ? LEFT : RIGHT;\n      }\n      if (currentSkew < 0) {\n        originX = originY === TOP ? RIGHT : LEFT;\n      }\n      // is the object flipped on one side only? swap the origin.\n      if (targetHasOneFlip(target)) {\n        originX = originX === LEFT ? RIGHT : LEFT;\n      }\n    }\n\n    // once we have the origin, we find the anchor point\n    transform.originX = originX;\n    var finalHandler = wrapWithFireEvent('skewing', wrapWithFixedAnchor(skewObjectX));\n    return finalHandler(eventData, transform, x, y);\n  }\n\n  /**\n   * Wrapped Action handler for skewing on the Y axis, takes care of the\n   * skew direction and determine the correct transform origin for the anchor point\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function skewHandlerY(eventData, transform, x, y) {\n    // step1 figure out and change transform origin.\n    // if skewY > 0 and originX left we anchor on top\n    // if skewY > 0 and originX right we anchor on bottom\n    // if skewY < 0 and originX left we anchor on bottom\n    // if skewY < 0 and originX right we anchor on top\n    // if skewY is 0, we look for mouse position to understand where are we going.\n    var target = transform.target, currentSkew = target.skewY, originY, originX = transform.originX;\n    if (target.lockSkewingY) {\n      return false;\n    }\n    if (currentSkew === 0) {\n      var localPointFromCenter = getLocalPoint(transform, CENTER, CENTER, x, y);\n      if (localPointFromCenter.y > 0) {\n        // we are pulling down, anchor up;\n        originY = TOP;\n      }\n      else {\n        // we are pulling up, anchor down\n        originY = BOTTOM;\n      }\n    }\n    else {\n      if (currentSkew > 0) {\n        originY = originX === LEFT ? TOP : BOTTOM;\n      }\n      if (currentSkew < 0) {\n        originY = originX === LEFT ? BOTTOM : TOP;\n      }\n      // is the object flipped on one side only? swap the origin.\n      if (targetHasOneFlip(target)) {\n        originY = originY === TOP ? BOTTOM : TOP;\n      }\n    }\n\n    // once we have the origin, we find the anchor point\n    transform.originY = originY;\n    var finalHandler = wrapWithFireEvent('skewing', wrapWithFixedAnchor(skewObjectY));\n    return finalHandler(eventData, transform, x, y);\n  }\n\n  /**\n   * Action handler for rotation and snapping, without anchor point.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   * @private\n   */\n  function rotationWithSnapping(eventData, transform, x, y) {\n    var t = transform,\n        target = t.target,\n        pivotPoint = target.translateToOriginPoint(target.getCenterPoint(), t.originX, t.originY);\n\n    if (target.lockRotation) {\n      return false;\n    }\n\n    var lastAngle = Math.atan2(t.ey - pivotPoint.y, t.ex - pivotPoint.x),\n        curAngle = Math.atan2(y - pivotPoint.y, x - pivotPoint.x),\n        angle = radiansToDegrees(curAngle - lastAngle + t.theta),\n        hasRotated = true;\n\n    if (target.snapAngle > 0) {\n      var snapAngle  = target.snapAngle,\n          snapThreshold  = target.snapThreshold || snapAngle,\n          rightAngleLocked = Math.ceil(angle / snapAngle) * snapAngle,\n          leftAngleLocked = Math.floor(angle / snapAngle) * snapAngle;\n\n      if (Math.abs(angle - leftAngleLocked) < snapThreshold) {\n        angle = leftAngleLocked;\n      }\n      else if (Math.abs(angle - rightAngleLocked) < snapThreshold) {\n        angle = rightAngleLocked;\n      }\n    }\n\n    // normalize angle to positive value\n    if (angle < 0) {\n      angle = 360 + angle;\n    }\n    angle %= 360;\n\n    hasRotated = target.angle !== angle;\n    target.angle = angle;\n    return hasRotated;\n  }\n\n  /**\n   * Basic scaling logic, reused with different constrain for scaling X,Y, freely or equally.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @param {Object} options additional information for scaling\n   * @param {String} options.by 'x', 'y', 'equally' or '' to indicate type of scaling\n   * @return {Boolean} true if some change happened\n   * @private\n   */\n  function scaleObject(eventData, transform, x, y, options) {\n    options = options || {};\n    var target = transform.target,\n        lockScalingX = target.lockScalingX, lockScalingY = target.lockScalingY,\n        by = options.by, newPoint, scaleX, scaleY, dim,\n        scaleProportionally = scaleIsProportional(eventData, target),\n        forbidScaling = scalingIsForbidden(target, by, scaleProportionally),\n        signX, signY, gestureScale = transform.gestureScale;\n\n    if (forbidScaling) {\n      return false;\n    }\n    if (gestureScale) {\n      scaleX = transform.scaleX * gestureScale;\n      scaleY = transform.scaleY * gestureScale;\n    }\n    else {\n      newPoint = getLocalPoint(transform, transform.originX, transform.originY, x, y);\n      // use of sign: We use sign to detect change of direction of an action. sign usually change when\n      // we cross the origin point with the mouse. So a scale flip for example. There is an issue when scaling\n      // by center and scaling using one middle control ( default: mr, mt, ml, mb), the mouse movement can easily\n      // cross many time the origin point and flip the object. so we need a way to filter out the noise.\n      // This ternary here should be ok to filter out X scaling when we want Y only and vice versa.\n      signX = by !== 'y' ? sign(newPoint.x) : 1;\n      signY = by !== 'x' ? sign(newPoint.y) : 1;\n      if (!transform.signX) {\n        transform.signX = signX;\n      }\n      if (!transform.signY) {\n        transform.signY = signY;\n      }\n\n      if (target.lockScalingFlip &&\n        (transform.signX !== signX || transform.signY !== signY)\n      ) {\n        return false;\n      }\n\n      dim = target._getTransformedDimensions();\n      // missing detection of flip and logic to switch the origin\n      if (scaleProportionally && !by) {\n        // uniform scaling\n        var distance = Math.abs(newPoint.x) + Math.abs(newPoint.y),\n            original = transform.original,\n            originalDistance = Math.abs(dim.x * original.scaleX / target.scaleX) +\n              Math.abs(dim.y * original.scaleY / target.scaleY),\n            scale = distance / originalDistance;\n        scaleX = original.scaleX * scale;\n        scaleY = original.scaleY * scale;\n      }\n      else {\n        scaleX = Math.abs(newPoint.x * target.scaleX / dim.x);\n        scaleY = Math.abs(newPoint.y * target.scaleY / dim.y);\n      }\n      // if we are scaling by center, we need to double the scale\n      if (isTransformCentered(transform)) {\n        scaleX *= 2;\n        scaleY *= 2;\n      }\n      if (transform.signX !== signX && by !== 'y') {\n        transform.originX = opposite[transform.originX];\n        scaleX *= -1;\n        transform.signX = signX;\n      }\n      if (transform.signY !== signY && by !== 'x') {\n        transform.originY = opposite[transform.originY];\n        scaleY *= -1;\n        transform.signY = signY;\n      }\n    }\n    // minScale is taken are in the setter.\n    var oldScaleX = target.scaleX, oldScaleY = target.scaleY;\n    if (!by) {\n      !lockScalingX && target.set('scaleX', scaleX);\n      !lockScalingY && target.set('scaleY', scaleY);\n    }\n    else {\n      // forbidden cases already handled on top here.\n      by === 'x' && target.set('scaleX', scaleX);\n      by === 'y' && target.set('scaleY', scaleY);\n    }\n    return oldScaleX !== target.scaleX || oldScaleY !== target.scaleY;\n  }\n\n  /**\n   * Generic scaling logic, to scale from corners either equally or freely.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scaleObjectFromCorner(eventData, transform, x, y) {\n    return scaleObject(eventData, transform, x, y);\n  }\n\n  /**\n   * Scaling logic for the X axis.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scaleObjectX(eventData, transform, x, y) {\n    return scaleObject(eventData, transform, x, y , { by: 'x' });\n  }\n\n  /**\n   * Scaling logic for the Y axis.\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scaleObjectY(eventData, transform, x, y) {\n    return scaleObject(eventData, transform, x, y , { by: 'y' });\n  }\n\n  /**\n   * Composed action handler to either scale Y or skew X\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scalingYOrSkewingX(eventData, transform, x, y) {\n    // ok some safety needed here.\n    if (eventData[transform.target.canvas.altActionKey]) {\n      return controls.skewHandlerX(eventData, transform, x, y);\n    }\n    return controls.scalingY(eventData, transform, x, y);\n  }\n\n  /**\n   * Composed action handler to either scale X or skew Y\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function scalingXOrSkewingY(eventData, transform, x, y) {\n    // ok some safety needed here.\n    if (eventData[transform.target.canvas.altActionKey]) {\n      return controls.skewHandlerY(eventData, transform, x, y);\n    }\n    return controls.scalingX(eventData, transform, x, y);\n  }\n\n  /**\n   * Action handler to change textbox width\n   * Needs to be wrapped with `wrapWithFixedAnchor` to be effective\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if some change happened\n   */\n  function changeWidth(eventData, transform, x, y) {\n    var target = transform.target, localPoint = getLocalPoint(transform, transform.originX, transform.originY, x, y),\n        strokePadding = target.strokeWidth / (target.strokeUniform ? target.scaleX : 1),\n        multiplier = isTransformCentered(transform) ? 2 : 1,\n        oldWidth = target.width,\n        newWidth = Math.abs(localPoint.x * multiplier / target.scaleX) - strokePadding;\n    target.set('width', Math.max(newWidth, 0));\n    return oldWidth !== newWidth;\n  }\n\n  /**\n   * Action handler\n   * @private\n   * @param {Event} eventData javascript event that is doing the transform\n   * @param {Object} transform javascript object containing a series of information around the current transform\n   * @param {number} x current mouse x position, canvas normalized\n   * @param {number} y current mouse y position, canvas normalized\n   * @return {Boolean} true if the translation occurred\n   */\n  function dragHandler(eventData, transform, x, y) {\n    var target = transform.target,\n        newLeft = x - transform.offsetX,\n        newTop = y - transform.offsetY,\n        moveX = !target.get('lockMovementX') && target.left !== newLeft,\n        moveY = !target.get('lockMovementY') && target.top !== newTop;\n    moveX && target.set('left', newLeft);\n    moveY && target.set('top', newTop);\n    if (moveX || moveY) {\n      fireEvent('moving', commonEventInfo(eventData, transform, x, y));\n    }\n    return moveX || moveY;\n  }\n\n  controls.scaleCursorStyleHandler = scaleCursorStyleHandler;\n  controls.skewCursorStyleHandler = skewCursorStyleHandler;\n  controls.scaleSkewCursorStyleHandler = scaleSkewCursorStyleHandler;\n  controls.rotationWithSnapping = wrapWithFireEvent('rotating', wrapWithFixedAnchor(rotationWithSnapping));\n  controls.scalingEqually = wrapWithFireEvent('scaling', wrapWithFixedAnchor( scaleObjectFromCorner));\n  controls.scalingX = wrapWithFireEvent('scaling', wrapWithFixedAnchor(scaleObjectX));\n  controls.scalingY = wrapWithFireEvent('scaling', wrapWithFixedAnchor(scaleObjectY));\n  controls.scalingYOrSkewingX = scalingYOrSkewingX;\n  controls.scalingXOrSkewingY = scalingXOrSkewingY;\n  controls.changeWidth = wrapWithFireEvent('resizing', wrapWithFixedAnchor(changeWidth));\n  controls.skewHandlerX = skewHandlerX;\n  controls.skewHandlerY = skewHandlerY;\n  controls.dragHandler = dragHandler;\n  controls.scaleOrSkewActionName = scaleOrSkewActionName;\n  controls.rotationStyleHandler = rotationStyleHandler;\n  controls.fireEvent = fireEvent;\n  controls.wrapWithFixedAnchor = wrapWithFixedAnchor;\n  controls.wrapWithFireEvent = wrapWithFireEvent;\n  controls.getLocalPoint = getLocalPoint;\n  fabric.controlsUtils = controls;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      degreesToRadians = fabric.util.degreesToRadians,\n      controls = fabric.controlsUtils;\n\n  /**\n   * Render a round control, as per fabric features.\n   * This function is written to respect object properties like transparentCorners, cornerSize\n   * cornerColor, cornerStrokeColor\n   * plus the addition of offsetY and offsetX.\n   * @param {CanvasRenderingContext2D} ctx context to render on\n   * @param {Number} left x coordinate where the control center should be\n   * @param {Number} top y coordinate where the control center should be\n   * @param {Object} styleOverride override for fabric.Object controls style\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\n   */\n  function renderCircleControl (ctx, left, top, styleOverride, fabricObject) {\n    styleOverride = styleOverride || {};\n    var xSize = this.sizeX || styleOverride.cornerSize || fabricObject.cornerSize,\n        ySize = this.sizeY || styleOverride.cornerSize || fabricObject.cornerSize,\n        transparentCorners = typeof styleOverride.transparentCorners !== 'undefined' ?\n          styleOverride.transparentCorners : fabricObject.transparentCorners,\n        methodName = transparentCorners ? 'stroke' : 'fill',\n        stroke = !transparentCorners && (styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor),\n        myLeft = left,\n        myTop = top, size;\n    ctx.save();\n    ctx.fillStyle = styleOverride.cornerColor || fabricObject.cornerColor;\n    ctx.strokeStyle = styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor;\n    // as soon as fabric react v5, remove ie11, use proper ellipse code.\n    if (xSize > ySize) {\n      size = xSize;\n      ctx.scale(1.0, ySize / xSize);\n      myTop = top * xSize / ySize;\n    }\n    else if (ySize > xSize) {\n      size = ySize;\n      ctx.scale(xSize / ySize, 1.0);\n      myLeft = left * ySize / xSize;\n    }\n    else {\n      size = xSize;\n    }\n    // this is still wrong\n    ctx.lineWidth = 1;\n    ctx.beginPath();\n    ctx.arc(myLeft, myTop, size / 2, 0, 2 * Math.PI, false);\n    ctx[methodName]();\n    if (stroke) {\n      ctx.stroke();\n    }\n    ctx.restore();\n  }\n\n  /**\n   * Render a square control, as per fabric features.\n   * This function is written to respect object properties like transparentCorners, cornerSize\n   * cornerColor, cornerStrokeColor\n   * plus the addition of offsetY and offsetX.\n   * @param {CanvasRenderingContext2D} ctx context to render on\n   * @param {Number} left x coordinate where the control center should be\n   * @param {Number} top y coordinate where the control center should be\n   * @param {Object} styleOverride override for fabric.Object controls style\n   * @param {fabric.Object} fabricObject the fabric object for which we are rendering controls\n   */\n  function renderSquareControl(ctx, left, top, styleOverride, fabricObject) {\n    styleOverride = styleOverride || {};\n    var xSize = this.sizeX || styleOverride.cornerSize || fabricObject.cornerSize,\n        ySize = this.sizeY || styleOverride.cornerSize || fabricObject.cornerSize,\n        transparentCorners = typeof styleOverride.transparentCorners !== 'undefined' ?\n          styleOverride.transparentCorners : fabricObject.transparentCorners,\n        methodName = transparentCorners ? 'stroke' : 'fill',\n        stroke = !transparentCorners && (\n          styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor\n        ), xSizeBy2 = xSize / 2, ySizeBy2 = ySize / 2;\n    ctx.save();\n    ctx.fillStyle = styleOverride.cornerColor || fabricObject.cornerColor;\n    ctx.strokeStyle = styleOverride.cornerStrokeColor || fabricObject.cornerStrokeColor;\n    // this is still wrong\n    ctx.lineWidth = 1;\n    ctx.translate(left, top);\n    ctx.rotate(degreesToRadians(fabricObject.angle));\n    // this does not work, and fixed with ( && ) does not make sense.\n    // to have real transparent corners we need the controls on upperCanvas\n    // transparentCorners || ctx.clearRect(-xSizeBy2, -ySizeBy2, xSize, ySize);\n    ctx[methodName + 'Rect'](-xSizeBy2, -ySizeBy2, xSize, ySize);\n    if (stroke) {\n      ctx.strokeRect(-xSizeBy2, -ySizeBy2, xSize, ySize);\n    }\n    ctx.restore();\n  }\n\n  controls.renderCircleControl = renderCircleControl;\n  controls.renderSquareControl = renderSquareControl;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  function Control(options) {\n    for (var i in options) {\n      this[i] = options[i];\n    }\n  }\n\n  fabric.Control = Control;\n\n  fabric.Control.prototype = /** @lends fabric.Control.prototype */ {\n\n    /**\n     * keep track of control visibility.\n     * mainly for backward compatibility.\n     * if you do not want to see a control, you can remove it\n     * from the controlset.\n     * @type {Boolean}\n     * @default true\n     */\n    visible: true,\n\n    /**\n     * Name of the action that the control will likely execute.\n     * This is optional. FabricJS uses to identify what the user is doing for some\n     * extra optimizations. If you are writing a custom control and you want to know\n     * somewhere else in the code what is going on, you can use this string here.\n     * you can also provide a custom getActionName if your control run multiple actions\n     * depending on some external state.\n     * default to scale since is the most common, used on 4 corners by default\n     * @type {String}\n     * @default 'scale'\n     */\n    actionName: 'scale',\n\n    /**\n     * Drawing angle of the control.\n     * NOT used for now, but name marked as needed for internal logic\n     * example: to reuse the same drawing function for different rotated controls\n     * @type {Number}\n     * @default 0\n     */\n    angle: 0,\n\n    /**\n     * Relative position of the control. X\n     * 0,0 is the center of the Object, while -0.5 (left) or 0.5 (right) are the extremities\n     * of the bounding box.\n     * @type {Number}\n     * @default 0\n     */\n    x: 0,\n\n    /**\n     * Relative position of the control. Y\n     * 0,0 is the center of the Object, while -0.5 (top) or 0.5 (bottom) are the extremities\n     * of the bounding box.\n     * @type {Number}\n     * @default 0\n     */\n    y: 0,\n\n    /**\n     * Horizontal offset of the control from the defined position. In pixels\n     * Positive offset moves the control to the right, negative to the left.\n     * It used when you want to have position of control that does not scale with\n     * the bounding box. Example: rotation control is placed at x:0, y: 0.5 on\n     * the boundindbox, with an offset of 30 pixels vertically. Those 30 pixels will\n     * stay 30 pixels no matter how the object is big. Another example is having 2\n     * controls in the corner, that stay in the same position when the object scale.\n     * of the bounding box.\n     * @type {Number}\n     * @default 0\n     */\n    offsetX: 0,\n\n    /**\n     * Vertical offset of the control from the defined position. In pixels\n     * Positive offset moves the control to the bottom, negative to the top.\n     * @type {Number}\n     * @default 0\n     */\n    offsetY: 0,\n\n    /**\n     * Sets the length of the control. If null, defaults to object's cornerSize.\n     * Expects both sizeX and sizeY to be set when set.\n     * @type {?Number}\n     * @default null\n     */\n    sizeX: null,\n\n    /**\n     * Sets the height of the control. If null, defaults to object's cornerSize.\n     * Expects both sizeX and sizeY to be set when set.\n     * @type {?Number}\n     * @default null\n     */\n    sizeY: null,\n\n    /**\n     * Sets the length of the touch area of the control. If null, defaults to object's touchCornerSize.\n     * Expects both touchSizeX and touchSizeY to be set when set.\n     * @type {?Number}\n     * @default null\n     */\n    touchSizeX: null,\n\n    /**\n     * Sets the height of the touch area of the control. If null, defaults to object's touchCornerSize.\n     * Expects both touchSizeX and touchSizeY to be set when set.\n     * @type {?Number}\n     * @default null\n     */\n    touchSizeY: null,\n\n    /**\n     * Css cursor style to display when the control is hovered.\n     * if the method `cursorStyleHandler` is provided, this property is ignored.\n     * @type {String}\n     * @default 'crosshair'\n     */\n    cursorStyle: 'crosshair',\n\n    /**\n     * If controls has an offsetY or offsetX, draw a line that connects\n     * the control to the bounding box\n     * @type {Boolean}\n     * @default false\n     */\n    withConnection: false,\n\n    /**\n     * The control actionHandler, provide one to handle action ( control being moved )\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {Number} x x position of the cursor\n     * @param {Number} y y position of the cursor\n     * @return {Boolean} true if the action/event modified the object\n     */\n    actionHandler: function(/* eventData, transformData, x, y */) { },\n\n    /**\n     * The control handler for mouse down, provide one to handle mouse down on control\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {Number} x x position of the cursor\n     * @param {Number} y y position of the cursor\n     * @return {Boolean} true if the action/event modified the object\n     */\n    mouseDownHandler: function(/* eventData, transformData, x, y */) { },\n\n    /**\n     * The control mouseUpHandler, provide one to handle an effect on mouse up.\n     * @param {Event} eventData the native mouse event\n     * @param {Object} transformData properties of the current transform\n     * @param {Number} x x position of the cursor\n     * @param {Number} y y position of the cursor\n     * @return {Boolean} true if the action/event modified the object\n     */\n    mouseUpHandler: function(/* eventData, transformData, x, y */) { },\n\n    /**\n     * Returns control actionHandler\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Object} fabricObject on which the control is displayed\n     * @param {fabric.Control} control control for which the action handler is being asked\n     * @return {Function} the action handler\n     */\n    getActionHandler: function(/* eventData, fabricObject, control */) {\n      return this.actionHandler;\n    },\n\n    /**\n     * Returns control mouseDown handler\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Object} fabricObject on which the control is displayed\n     * @param {fabric.Control} control control for which the action handler is being asked\n     * @return {Function} the action handler\n     */\n    getMouseDownHandler: function(/* eventData, fabricObject, control */) {\n      return this.mouseDownHandler;\n    },\n\n    /**\n     * Returns control mouseUp handler\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Object} fabricObject on which the control is displayed\n     * @param {fabric.Control} control control for which the action handler is being asked\n     * @return {Function} the action handler\n     */\n    getMouseUpHandler: function(/* eventData, fabricObject, control */) {\n      return this.mouseUpHandler;\n    },\n\n    /**\n     * Returns control cursorStyle for css using cursorStyle. If you need a more elaborate\n     * function you can pass one in the constructor\n     * the cursorStyle property\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Control} control the current control ( likely this)\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {String}\n     */\n    cursorStyleHandler: function(eventData, control /* fabricObject */) {\n      return control.cursorStyle;\n    },\n\n    /**\n     * Returns the action name. The basic implementation just return the actionName property.\n     * @param {Event} eventData the native mouse event\n     * @param {fabric.Control} control the current control ( likely this)\n     * @param {fabric.Object} object on which the control is displayed\n     * @return {String}\n     */\n    getActionName: function(eventData, control /* fabricObject */) {\n      return control.actionName;\n    },\n\n    /**\n     * Returns controls visibility\n     * @param {fabric.Object} object on which the control is displayed\n     * @param {String} controlKey key where the control is memorized on the\n     * @return {Boolean}\n     */\n    getVisibility: function(fabricObject, controlKey) {\n      var objectVisibility = fabricObject._controlsVisibility;\n      if (objectVisibility && typeof objectVisibility[controlKey] !== 'undefined') {\n        return objectVisibility[controlKey];\n      }\n      return this.visible;\n    },\n\n    /**\n     * Sets controls visibility\n     * @param {Boolean} visibility for the object\n     * @return {Void}\n     */\n    setVisibility: function(visibility /* name, fabricObject */) {\n      this.visible = visibility;\n    },\n\n\n    positionHandler: function(dim, finalMatrix /*, fabricObject, currentControl */) {\n      var point = fabric.util.transformPoint({\n        x: this.x * dim.x + this.offsetX,\n        y: this.y * dim.y + this.offsetY }, finalMatrix);\n      return point;\n    },\n\n    /**\n     * Returns the coords for this control based on object values.\n     * @param {Number} objectAngle angle from the fabric object holding the control\n     * @param {Number} objectCornerSize cornerSize from the fabric object holding the control (or touchCornerSize if\n     *   isTouch is true)\n     * @param {Number} centerX x coordinate where the control center should be\n     * @param {Number} centerY y coordinate where the control center should be\n     * @param {boolean} isTouch true if touch corner, false if normal corner\n     */\n    calcCornerCoords: function(objectAngle, objectCornerSize, centerX, centerY, isTouch) {\n      var cosHalfOffset,\n          sinHalfOffset,\n          cosHalfOffsetComp,\n          sinHalfOffsetComp,\n          xSize = (isTouch) ? this.touchSizeX : this.sizeX,\n          ySize = (isTouch) ? this.touchSizeY : this.sizeY;\n      if (xSize && ySize && xSize !== ySize) {\n        // handle rectangular corners\n        var controlTriangleAngle = Math.atan2(ySize, xSize);\n        var cornerHypotenuse = Math.sqrt(xSize * xSize + ySize * ySize) / 2;\n        var newTheta = controlTriangleAngle - fabric.util.degreesToRadians(objectAngle);\n        var newThetaComp = Math.PI / 2 - controlTriangleAngle - fabric.util.degreesToRadians(objectAngle);\n        cosHalfOffset = cornerHypotenuse * fabric.util.cos(newTheta);\n        sinHalfOffset = cornerHypotenuse * fabric.util.sin(newTheta);\n        // use complementary angle for two corners\n        cosHalfOffsetComp = cornerHypotenuse * fabric.util.cos(newThetaComp);\n        sinHalfOffsetComp = cornerHypotenuse * fabric.util.sin(newThetaComp);\n      }\n      else {\n        // handle square corners\n        // use default object corner size unless size is defined\n        var cornerSize = (xSize && ySize) ? xSize : objectCornerSize;\n        /* 0.7071067812 stands for sqrt(2)/2 */\n        cornerHypotenuse = cornerSize * 0.7071067812;\n        // complementary angles are equal since they're both 45 degrees\n        var newTheta = fabric.util.degreesToRadians(45 - objectAngle);\n        cosHalfOffset = cosHalfOffsetComp = cornerHypotenuse * fabric.util.cos(newTheta);\n        sinHalfOffset = sinHalfOffsetComp = cornerHypotenuse * fabric.util.sin(newTheta);\n      }\n\n      return {\n        tl: {\n          x: centerX - sinHalfOffsetComp,\n          y: centerY - cosHalfOffsetComp,\n        },\n        tr: {\n          x: centerX + cosHalfOffset,\n          y: centerY - sinHalfOffset,\n        },\n        bl: {\n          x: centerX - cosHalfOffset,\n          y: centerY + sinHalfOffset,\n        },\n        br: {\n          x: centerX + sinHalfOffsetComp,\n          y: centerY + cosHalfOffsetComp,\n        },\n      };\n    },\n\n    /**\n    * Render function for the control.\n    * When this function runs the context is unscaled. unrotate. Just retina scaled.\n    * all the functions will have to translate to the point left,top before starting Drawing\n    * if they want to draw a control where the position is detected.\n    * left and top are the result of the positionHandler function\n    * @param {RenderingContext2D} ctx the context where the control will be drawn\n    * @param {Number} left position of the canvas where we are about to render the control.\n    * @param {Number} top position of the canvas where we are about to render the control.\n    * @param {Object} styleOverride\n    * @param {fabric.Object} fabricObject the object where the control is about to be rendered\n    */\n    render: function(ctx, left, top, styleOverride, fabricObject) {\n      styleOverride = styleOverride || {};\n      switch (styleOverride.cornerStyle || fabricObject.cornerStyle) {\n        case 'circle':\n          fabric.controlsUtils.renderCircleControl.call(this, ctx, left, top, styleOverride, fabricObject);\n          break;\n        default:\n          fabric.controlsUtils.renderSquareControl.call(this, ctx, left, top, styleOverride, fabricObject);\n      }\n    },\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  /* _FROM_SVG_START_ */\n  function getColorStop(el, multiplier) {\n    var style = el.getAttribute('style'),\n        offset = el.getAttribute('offset') || 0,\n        color, colorAlpha, opacity, i;\n\n    // convert percents to absolute values\n    offset = parseFloat(offset) / (/%$/.test(offset) ? 100 : 1);\n    offset = offset < 0 ? 0 : offset > 1 ? 1 : offset;\n    if (style) {\n      var keyValuePairs = style.split(/\\s*;\\s*/);\n\n      if (keyValuePairs[keyValuePairs.length - 1] === '') {\n        keyValuePairs.pop();\n      }\n\n      for (i = keyValuePairs.length; i--; ) {\n\n        var split = keyValuePairs[i].split(/\\s*:\\s*/),\n            key = split[0].trim(),\n            value = split[1].trim();\n\n        if (key === 'stop-color') {\n          color = value;\n        }\n        else if (key === 'stop-opacity') {\n          opacity = value;\n        }\n      }\n    }\n\n    if (!color) {\n      color = el.getAttribute('stop-color') || 'rgb(0,0,0)';\n    }\n    if (!opacity) {\n      opacity = el.getAttribute('stop-opacity');\n    }\n\n    color = new fabric.Color(color);\n    colorAlpha = color.getAlpha();\n    opacity = isNaN(parseFloat(opacity)) ? 1 : parseFloat(opacity);\n    opacity *= colorAlpha * multiplier;\n\n    return {\n      offset: offset,\n      color: color.toRgb(),\n      opacity: opacity\n    };\n  }\n\n  function getLinearCoords(el) {\n    return {\n      x1: el.getAttribute('x1') || 0,\n      y1: el.getAttribute('y1') || 0,\n      x2: el.getAttribute('x2') || '100%',\n      y2: el.getAttribute('y2') || 0\n    };\n  }\n\n  function getRadialCoords(el) {\n    return {\n      x1: el.getAttribute('fx') || el.getAttribute('cx') || '50%',\n      y1: el.getAttribute('fy') || el.getAttribute('cy') || '50%',\n      r1: 0,\n      x2: el.getAttribute('cx') || '50%',\n      y2: el.getAttribute('cy') || '50%',\n      r2: el.getAttribute('r') || '50%'\n    };\n  }\n  /* _FROM_SVG_END_ */\n\n  var clone = fabric.util.object.clone;\n\n  /**\n   * Gradient class\n   * @class fabric.Gradient\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#gradients}\n   * @see {@link fabric.Gradient#initialize} for constructor definition\n   */\n  fabric.Gradient = fabric.util.createClass(/** @lends fabric.Gradient.prototype */ {\n\n    /**\n     * Horizontal offset for aligning gradients coming from SVG when outside pathgroups\n     * @type Number\n     * @default 0\n     */\n    offsetX: 0,\n\n    /**\n     * Vertical offset for aligning gradients coming from SVG when outside pathgroups\n     * @type Number\n     * @default 0\n     */\n    offsetY: 0,\n\n    /**\n     * A transform matrix to apply to the gradient before painting.\n     * Imported from svg gradients, is not applied with the current transform in the center.\n     * Before this transform is applied, the origin point is at the top left corner of the object\n     * plus the addition of offsetY and offsetX.\n     * @type Number[]\n     * @default null\n     */\n    gradientTransform: null,\n\n    /**\n     * coordinates units for coords.\n     * If `pixels`, the number of coords are in the same unit of width / height.\n     * If set as `percentage` the coords are still a number, but 1 means 100% of width\n     * for the X and 100% of the height for the y. It can be bigger than 1 and negative.\n     * allowed values pixels or percentage.\n     * @type String\n     * @default 'pixels'\n     */\n    gradientUnits: 'pixels',\n\n    /**\n     * Gradient type linear or radial\n     * @type String\n     * @default 'pixels'\n     */\n    type: 'linear',\n\n    /**\n     * Constructor\n     * @param {Object} options Options object with type, coords, gradientUnits and colorStops\n     * @param {Object} [options.type] gradient type linear or radial\n     * @param {Object} [options.gradientUnits] gradient units\n     * @param {Object} [options.offsetX] SVG import compatibility\n     * @param {Object} [options.offsetY] SVG import compatibility\n     * @param {Object[]} options.colorStops contains the colorstops.\n     * @param {Object} options.coords contains the coords of the gradient\n     * @param {Number} [options.coords.x1] X coordiante of the first point for linear or of the focal point for radial\n     * @param {Number} [options.coords.y1] Y coordiante of the first point for linear or of the focal point for radial\n     * @param {Number} [options.coords.x2] X coordiante of the second point for linear or of the center point for radial\n     * @param {Number} [options.coords.y2] Y coordiante of the second point for linear or of the center point for radial\n     * @param {Number} [options.coords.r1] only for radial gradient, radius of the inner circle\n     * @param {Number} [options.coords.r2] only for radial gradient, radius of the external circle\n     * @return {fabric.Gradient} thisArg\n     */\n    initialize: function(options) {\n      options || (options = { });\n      options.coords || (options.coords = { });\n\n      var coords, _this = this;\n\n      // sets everything, then coords and colorstops get sets again\n      Object.keys(options).forEach(function(option) {\n        _this[option] = options[option];\n      });\n\n      if (this.id) {\n        this.id += '_' + fabric.Object.__uid++;\n      }\n      else {\n        this.id = fabric.Object.__uid++;\n      }\n\n      coords = {\n        x1: options.coords.x1 || 0,\n        y1: options.coords.y1 || 0,\n        x2: options.coords.x2 || 0,\n        y2: options.coords.y2 || 0\n      };\n\n      if (this.type === 'radial') {\n        coords.r1 = options.coords.r1 || 0;\n        coords.r2 = options.coords.r2 || 0;\n      }\n\n      this.coords = coords;\n      this.colorStops = options.colorStops.slice();\n    },\n\n    /**\n     * Adds another colorStop\n     * @param {Object} colorStop Object with offset and color\n     * @return {fabric.Gradient} thisArg\n     */\n    addColorStop: function(colorStops) {\n      for (var position in colorStops) {\n        var color = new fabric.Color(colorStops[position]);\n        this.colorStops.push({\n          offset: parseFloat(position),\n          color: color.toRgb(),\n          opacity: color.getAlpha()\n        });\n      }\n      return this;\n    },\n\n    /**\n     * Returns object representation of a gradient\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object}\n     */\n    toObject: function(propertiesToInclude) {\n      var object = {\n        type: this.type,\n        coords: this.coords,\n        colorStops: this.colorStops,\n        offsetX: this.offsetX,\n        offsetY: this.offsetY,\n        gradientUnits: this.gradientUnits,\n        gradientTransform: this.gradientTransform ? this.gradientTransform.concat() : this.gradientTransform\n      };\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n\n      return object;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of an gradient\n     * @param {Object} object Object to create a gradient for\n     * @return {String} SVG representation of an gradient (linear/radial)\n     */\n    toSVG: function(object, options) {\n      var coords = clone(this.coords, true), i, len, options = options || {},\n          markup, commonAttributes, colorStops = clone(this.colorStops, true),\n          needsSwap = coords.r1 > coords.r2,\n          transform = this.gradientTransform ? this.gradientTransform.concat() : fabric.iMatrix.concat(),\n          offsetX = -this.offsetX, offsetY = -this.offsetY,\n          withViewport = !!options.additionalTransform,\n          gradientUnits = this.gradientUnits === 'pixels' ? 'userSpaceOnUse' : 'objectBoundingBox';\n      // colorStops must be sorted ascending\n      colorStops.sort(function(a, b) {\n        return a.offset - b.offset;\n      });\n\n      if (gradientUnits === 'objectBoundingBox') {\n        offsetX /= object.width;\n        offsetY /= object.height;\n      }\n      else {\n        offsetX += object.width / 2;\n        offsetY += object.height / 2;\n      }\n      if (object.type === 'path' && this.gradientUnits !== 'percentage') {\n        offsetX -= object.pathOffset.x;\n        offsetY -= object.pathOffset.y;\n      }\n\n\n      transform[4] -= offsetX;\n      transform[5] -= offsetY;\n\n      commonAttributes = 'id=\"SVGID_' + this.id +\n                     '\" gradientUnits=\"' + gradientUnits + '\"';\n      commonAttributes += ' gradientTransform=\"' + (withViewport ?\n        options.additionalTransform + ' ' : '') + fabric.util.matrixToSVG(transform) + '\" ';\n\n      if (this.type === 'linear') {\n        markup = [\n          '<linearGradient ',\n          commonAttributes,\n          ' x1=\"', coords.x1,\n          '\" y1=\"', coords.y1,\n          '\" x2=\"', coords.x2,\n          '\" y2=\"', coords.y2,\n          '\">\\n'\n        ];\n      }\n      else if (this.type === 'radial') {\n        // svg radial gradient has just 1 radius. the biggest.\n        markup = [\n          '<radialGradient ',\n          commonAttributes,\n          ' cx=\"', needsSwap ? coords.x1 : coords.x2,\n          '\" cy=\"', needsSwap ? coords.y1 : coords.y2,\n          '\" r=\"', needsSwap ? coords.r1 : coords.r2,\n          '\" fx=\"', needsSwap ? coords.x2 : coords.x1,\n          '\" fy=\"', needsSwap ? coords.y2 : coords.y1,\n          '\">\\n'\n        ];\n      }\n\n      if (this.type === 'radial') {\n        if (needsSwap) {\n          // svg goes from internal to external radius. if radius are inverted, swap color stops.\n          colorStops = colorStops.concat();\n          colorStops.reverse();\n          for (i = 0, len = colorStops.length; i < len; i++) {\n            colorStops[i].offset = 1 - colorStops[i].offset;\n          }\n        }\n        var minRadius = Math.min(coords.r1, coords.r2);\n        if (minRadius > 0) {\n          // i have to shift all colorStops and add new one in 0.\n          var maxRadius = Math.max(coords.r1, coords.r2),\n              percentageShift = minRadius / maxRadius;\n          for (i = 0, len = colorStops.length; i < len; i++) {\n            colorStops[i].offset += percentageShift * (1 - colorStops[i].offset);\n          }\n        }\n      }\n\n      for (i = 0, len = colorStops.length; i < len; i++) {\n        var colorStop = colorStops[i];\n        markup.push(\n          '<stop ',\n          'offset=\"', (colorStop.offset * 100) + '%',\n          '\" style=\"stop-color:', colorStop.color,\n          (typeof colorStop.opacity !== 'undefined' ? ';stop-opacity: ' + colorStop.opacity : ';'),\n          '\"/>\\n'\n        );\n      }\n\n      markup.push((this.type === 'linear' ? '</linearGradient>\\n' : '</radialGradient>\\n'));\n\n      return markup.join('');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns an instance of CanvasGradient\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @return {CanvasGradient}\n     */\n    toLive: function(ctx) {\n      var gradient, coords = fabric.util.object.clone(this.coords), i, len;\n\n      if (!this.type) {\n        return;\n      }\n\n      if (this.type === 'linear') {\n        gradient = ctx.createLinearGradient(\n          coords.x1, coords.y1, coords.x2, coords.y2);\n      }\n      else if (this.type === 'radial') {\n        gradient = ctx.createRadialGradient(\n          coords.x1, coords.y1, coords.r1, coords.x2, coords.y2, coords.r2);\n      }\n\n      for (i = 0, len = this.colorStops.length; i < len; i++) {\n        var color = this.colorStops[i].color,\n            opacity = this.colorStops[i].opacity,\n            offset = this.colorStops[i].offset;\n\n        if (typeof opacity !== 'undefined') {\n          color = new fabric.Color(color).setAlpha(opacity).toRgba();\n        }\n        gradient.addColorStop(offset, color);\n      }\n\n      return gradient;\n    }\n  });\n\n  fabric.util.object.extend(fabric.Gradient, {\n\n    /* _FROM_SVG_START_ */\n    /**\n     * Returns {@link fabric.Gradient} instance from an SVG element\n     * @static\n     * @memberOf fabric.Gradient\n     * @param {SVGGradientElement} el SVG gradient element\n     * @param {fabric.Object} instance\n     * @param {String} opacityAttr A fill-opacity or stroke-opacity attribute to multiply to each stop's opacity.\n     * @param {Object} svgOptions an object containing the size of the SVG in order to parse correctly gradients\n     * that uses gradientUnits as 'userSpaceOnUse' and percentages.\n     * @param {Object.number} viewBoxWidth width part of the viewBox attribute on svg\n     * @param {Object.number} viewBoxHeight height part of the viewBox attribute on svg\n     * @param {Object.number} width width part of the svg tag if viewBox is not specified\n     * @param {Object.number} height height part of the svg tag if viewBox is not specified\n     * @return {fabric.Gradient} Gradient instance\n     * @see http://www.w3.org/TR/SVG/pservers.html#LinearGradientElement\n     * @see http://www.w3.org/TR/SVG/pservers.html#RadialGradientElement\n     */\n    fromElement: function(el, instance, opacityAttr, svgOptions) {\n      /**\n       *  @example:\n       *\n       *  <linearGradient id=\"linearGrad1\">\n       *    <stop offset=\"0%\" stop-color=\"white\"/>\n       *    <stop offset=\"100%\" stop-color=\"black\"/>\n       *  </linearGradient>\n       *\n       *  OR\n       *\n       *  <linearGradient id=\"linearGrad2\">\n       *    <stop offset=\"0\" style=\"stop-color:rgb(255,255,255)\"/>\n       *    <stop offset=\"1\" style=\"stop-color:rgb(0,0,0)\"/>\n       *  </linearGradient>\n       *\n       *  OR\n       *\n       *  <radialGradient id=\"radialGrad1\">\n       *    <stop offset=\"0%\" stop-color=\"white\" stop-opacity=\"1\" />\n       *    <stop offset=\"50%\" stop-color=\"black\" stop-opacity=\"0.5\" />\n       *    <stop offset=\"100%\" stop-color=\"white\" stop-opacity=\"1\" />\n       *  </radialGradient>\n       *\n       *  OR\n       *\n       *  <radialGradient id=\"radialGrad2\">\n       *    <stop offset=\"0\" stop-color=\"rgb(255,255,255)\" />\n       *    <stop offset=\"0.5\" stop-color=\"rgb(0,0,0)\" />\n       *    <stop offset=\"1\" stop-color=\"rgb(255,255,255)\" />\n       *  </radialGradient>\n       *\n       */\n\n      var multiplier = parseFloat(opacityAttr) / (/%$/.test(opacityAttr) ? 100 : 1);\n      multiplier = multiplier < 0 ? 0 : multiplier > 1 ? 1 : multiplier;\n      if (isNaN(multiplier)) {\n        multiplier = 1;\n      }\n\n      var colorStopEls = el.getElementsByTagName('stop'),\n          type,\n          gradientUnits = el.getAttribute('gradientUnits') === 'userSpaceOnUse' ?\n            'pixels' : 'percentage',\n          gradientTransform = el.getAttribute('gradientTransform') || '',\n          colorStops = [],\n          coords, i, offsetX = 0, offsetY = 0,\n          transformMatrix;\n      if (el.nodeName === 'linearGradient' || el.nodeName === 'LINEARGRADIENT') {\n        type = 'linear';\n        coords = getLinearCoords(el);\n      }\n      else {\n        type = 'radial';\n        coords = getRadialCoords(el);\n      }\n\n      for (i = colorStopEls.length; i--; ) {\n        colorStops.push(getColorStop(colorStopEls[i], multiplier));\n      }\n\n      transformMatrix = fabric.parseTransformAttribute(gradientTransform);\n\n      __convertPercentUnitsToValues(instance, coords, svgOptions, gradientUnits);\n\n      if (gradientUnits === 'pixels') {\n        offsetX = -instance.left;\n        offsetY = -instance.top;\n      }\n\n      var gradient = new fabric.Gradient({\n        id: el.getAttribute('id'),\n        type: type,\n        coords: coords,\n        colorStops: colorStops,\n        gradientUnits: gradientUnits,\n        gradientTransform: transformMatrix,\n        offsetX: offsetX,\n        offsetY: offsetY,\n      });\n\n      return gradient;\n    }\n    /* _FROM_SVG_END_ */\n  });\n\n  /**\n   * @private\n   */\n  function __convertPercentUnitsToValues(instance, options, svgOptions, gradientUnits) {\n    var propValue, finalValue;\n    Object.keys(options).forEach(function(prop) {\n      propValue = options[prop];\n      if (propValue === 'Infinity') {\n        finalValue = 1;\n      }\n      else if (propValue === '-Infinity') {\n        finalValue = 0;\n      }\n      else {\n        finalValue = parseFloat(options[prop], 10);\n        if (typeof propValue === 'string' && /^(\\d+\\.\\d+)%|(\\d+)%$/.test(propValue)) {\n          finalValue *= 0.01;\n          if (gradientUnits === 'pixels') {\n            // then we need to fix those percentages here in svg parsing\n            if (prop === 'x1' || prop === 'x2' || prop === 'r2') {\n              finalValue *= svgOptions.viewBoxWidth || svgOptions.width;\n            }\n            if (prop === 'y1' || prop === 'y2') {\n              finalValue *= svgOptions.viewBoxHeight || svgOptions.height;\n            }\n          }\n        }\n      }\n      options[prop] = finalValue;\n    });\n  }\n})();\n\n\n(function() {\n\n  'use strict';\n\n  var toFixed = fabric.util.toFixed;\n\n  /**\n   * Pattern class\n   * @class fabric.Pattern\n   * @see {@link http://fabricjs.com/patterns|Pattern demo}\n   * @see {@link http://fabricjs.com/dynamic-patterns|DynamicPattern demo}\n   * @see {@link fabric.Pattern#initialize} for constructor definition\n   */\n\n\n  fabric.Pattern = fabric.util.createClass(/** @lends fabric.Pattern.prototype */ {\n\n    /**\n     * Repeat property of a pattern (one of repeat, repeat-x, repeat-y or no-repeat)\n     * @type String\n     * @default\n     */\n    repeat: 'repeat',\n\n    /**\n     * Pattern horizontal offset from object's left/top corner\n     * @type Number\n     * @default\n     */\n    offsetX: 0,\n\n    /**\n     * Pattern vertical offset from object's left/top corner\n     * @type Number\n     * @default\n     */\n    offsetY: 0,\n\n    /**\n     * crossOrigin value (one of \"\", \"anonymous\", \"use-credentials\")\n     * @see https://developer.mozilla.org/en-US/docs/HTML/CORS_settings_attributes\n     * @type String\n     * @default\n     */\n    crossOrigin: '',\n\n    /**\n     * transform matrix to change the pattern, imported from svgs.\n     * @type Array\n     * @default\n     */\n    patternTransform: null,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @param {Function} [callback] function to invoke after callback init.\n     * @return {fabric.Pattern} thisArg\n     */\n    initialize: function(options, callback) {\n      options || (options = { });\n\n      this.id = fabric.Object.__uid++;\n      this.setOptions(options);\n      if (!options.source || (options.source && typeof options.source !== 'string')) {\n        callback && callback(this);\n        return;\n      }\n      else {\n        // img src string\n        var _this = this;\n        this.source = fabric.util.createImage();\n        fabric.util.loadImage(options.source, function(img, isError) {\n          _this.source = img;\n          callback && callback(_this, isError);\n        }, null, this.crossOrigin);\n      }\n    },\n\n    /**\n     * Returns object representation of a pattern\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of a pattern instance\n     */\n    toObject: function(propertiesToInclude) {\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n          source, object;\n\n      // <img> element\n      if (typeof this.source.src === 'string') {\n        source = this.source.src;\n      }\n      // <canvas> element\n      else if (typeof this.source === 'object' && this.source.toDataURL) {\n        source = this.source.toDataURL();\n      }\n\n      object = {\n        type: 'pattern',\n        source: source,\n        repeat: this.repeat,\n        crossOrigin: this.crossOrigin,\n        offsetX: toFixed(this.offsetX, NUM_FRACTION_DIGITS),\n        offsetY: toFixed(this.offsetY, NUM_FRACTION_DIGITS),\n        patternTransform: this.patternTransform ? this.patternTransform.concat() : null\n      };\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n\n      return object;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of a pattern\n     * @param {fabric.Object} object\n     * @return {String} SVG representation of a pattern\n     */\n    toSVG: function(object) {\n      var patternSource = typeof this.source === 'function' ? this.source() : this.source,\n          patternWidth = patternSource.width / object.width,\n          patternHeight = patternSource.height / object.height,\n          patternOffsetX = this.offsetX / object.width,\n          patternOffsetY = this.offsetY / object.height,\n          patternImgSrc = '';\n      if (this.repeat === 'repeat-x' || this.repeat === 'no-repeat') {\n        patternHeight = 1;\n        if (patternOffsetY) {\n          patternHeight += Math.abs(patternOffsetY);\n        }\n      }\n      if (this.repeat === 'repeat-y' || this.repeat === 'no-repeat') {\n        patternWidth = 1;\n        if (patternOffsetX) {\n          patternWidth += Math.abs(patternOffsetX);\n        }\n\n      }\n      if (patternSource.src) {\n        patternImgSrc = patternSource.src;\n      }\n      else if (patternSource.toDataURL) {\n        patternImgSrc = patternSource.toDataURL();\n      }\n\n      return '<pattern id=\"SVGID_' + this.id +\n                    '\" x=\"' + patternOffsetX +\n                    '\" y=\"' + patternOffsetY +\n                    '\" width=\"' + patternWidth +\n                    '\" height=\"' + patternHeight + '\">\\n' +\n               '<image x=\"0\" y=\"0\"' +\n                      ' width=\"' + patternSource.width +\n                      '\" height=\"' + patternSource.height +\n                      '\" xlink:href=\"' + patternImgSrc +\n               '\"></image>\\n' +\n             '</pattern>\\n';\n    },\n    /* _TO_SVG_END_ */\n\n    setOptions: function(options) {\n      for (var prop in options) {\n        this[prop] = options[prop];\n      }\n    },\n\n    /**\n     * Returns an instance of CanvasPattern\n     * @param {CanvasRenderingContext2D} ctx Context to create pattern\n     * @return {CanvasPattern}\n     */\n    toLive: function(ctx) {\n      var source = this.source;\n      // if the image failed to load, return, and allow rest to continue loading\n      if (!source) {\n        return '';\n      }\n\n      // if an image\n      if (typeof source.src !== 'undefined') {\n        if (!source.complete) {\n          return '';\n        }\n        if (source.naturalWidth === 0 || source.naturalHeight === 0) {\n          return '';\n        }\n      }\n      return ctx.createPattern(source, this.repeat);\n    }\n  });\n})();\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      toFixed = fabric.util.toFixed;\n\n  if (fabric.Shadow) {\n    fabric.warn('fabric.Shadow is already defined.');\n    return;\n  }\n\n  /**\n   * Shadow class\n   * @class fabric.Shadow\n   * @see {@link http://fabricjs.com/shadows|Shadow demo}\n   * @see {@link fabric.Shadow#initialize} for constructor definition\n   */\n  fabric.Shadow = fabric.util.createClass(/** @lends fabric.Shadow.prototype */ {\n\n    /**\n     * Shadow color\n     * @type String\n     * @default\n     */\n    color: 'rgb(0,0,0)',\n\n    /**\n     * Shadow blur\n     * @type Number\n     */\n    blur: 0,\n\n    /**\n     * Shadow horizontal offset\n     * @type Number\n     * @default\n     */\n    offsetX: 0,\n\n    /**\n     * Shadow vertical offset\n     * @type Number\n     * @default\n     */\n    offsetY: 0,\n\n    /**\n     * Whether the shadow should affect stroke operations\n     * @type Boolean\n     * @default\n     */\n    affectStroke: false,\n\n    /**\n     * Indicates whether toObject should include default values\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues: true,\n\n    /**\n     * When `false`, the shadow will scale with the object.\n     * When `true`, the shadow's offsetX, offsetY, and blur will not be affected by the object's scale.\n     * default to false\n     * @type Boolean\n     * @default\n     */\n    nonScaling: false,\n\n    /**\n     * Constructor\n     * @param {Object|String} [options] Options object with any of color, blur, offsetX, offsetY properties or string (e.g. \"rgba(0,0,0,0.2) 2px 2px 10px\")\n     * @return {fabric.Shadow} thisArg\n     */\n    initialize: function(options) {\n\n      if (typeof options === 'string') {\n        options = this._parseShadow(options);\n      }\n\n      for (var prop in options) {\n        this[prop] = options[prop];\n      }\n\n      this.id = fabric.Object.__uid++;\n    },\n\n    /**\n     * @private\n     * @param {String} shadow Shadow value to parse\n     * @return {Object} Shadow object with color, offsetX, offsetY and blur\n     */\n    _parseShadow: function(shadow) {\n      var shadowStr = shadow.trim(),\n          offsetsAndBlur = fabric.Shadow.reOffsetsAndBlur.exec(shadowStr) || [],\n          color = shadowStr.replace(fabric.Shadow.reOffsetsAndBlur, '') || 'rgb(0,0,0)';\n\n      return {\n        color: color.trim(),\n        offsetX: parseFloat(offsetsAndBlur[1], 10) || 0,\n        offsetY: parseFloat(offsetsAndBlur[2], 10) || 0,\n        blur: parseFloat(offsetsAndBlur[3], 10) || 0\n      };\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @see http://www.w3.org/TR/css-text-decor-3/#text-shadow\n     * @return {String} Returns CSS3 text-shadow declaration\n     */\n    toString: function() {\n      return [this.offsetX, this.offsetY, this.blur, this.color].join('px ');\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns SVG representation of a shadow\n     * @param {fabric.Object} object\n     * @return {String} SVG representation of a shadow\n     */\n    toSVG: function(object) {\n      var fBoxX = 40, fBoxY = 40, NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n          offset = fabric.util.rotateVector(\n            { x: this.offsetX, y: this.offsetY },\n            fabric.util.degreesToRadians(-object.angle)),\n          BLUR_BOX = 20, color = new fabric.Color(this.color);\n\n      if (object.width && object.height) {\n        //http://www.w3.org/TR/SVG/filters.html#FilterEffectsRegion\n        // we add some extra space to filter box to contain the blur ( 20 )\n        fBoxX = toFixed((Math.abs(offset.x) + this.blur) / object.width, NUM_FRACTION_DIGITS) * 100 + BLUR_BOX;\n        fBoxY = toFixed((Math.abs(offset.y) + this.blur) / object.height, NUM_FRACTION_DIGITS) * 100 + BLUR_BOX;\n      }\n      if (object.flipX) {\n        offset.x *= -1;\n      }\n      if (object.flipY) {\n        offset.y *= -1;\n      }\n\n      return (\n        '<filter id=\"SVGID_' + this.id + '\" y=\"-' + fBoxY + '%\" height=\"' + (100 + 2 * fBoxY) + '%\" ' +\n          'x=\"-' + fBoxX + '%\" width=\"' + (100 + 2 * fBoxX) + '%\" ' + '>\\n' +\n          '\\t<feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"' +\n            toFixed(this.blur ? this.blur / 2 : 0, NUM_FRACTION_DIGITS) + '\"></feGaussianBlur>\\n' +\n          '\\t<feOffset dx=\"' + toFixed(offset.x, NUM_FRACTION_DIGITS) +\n          '\" dy=\"' + toFixed(offset.y, NUM_FRACTION_DIGITS) + '\" result=\"oBlur\" ></feOffset>\\n' +\n          '\\t<feFlood flood-color=\"' + color.toRgb() + '\" flood-opacity=\"' + color.getAlpha() + '\"/>\\n' +\n          '\\t<feComposite in2=\"oBlur\" operator=\"in\" />\\n' +\n          '\\t<feMerge>\\n' +\n            '\\t\\t<feMergeNode></feMergeNode>\\n' +\n            '\\t\\t<feMergeNode in=\"SourceGraphic\"></feMergeNode>\\n' +\n          '\\t</feMerge>\\n' +\n        '</filter>\\n');\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns object representation of a shadow\n     * @return {Object} Object representation of a shadow instance\n     */\n    toObject: function() {\n      if (this.includeDefaultValues) {\n        return {\n          color: this.color,\n          blur: this.blur,\n          offsetX: this.offsetX,\n          offsetY: this.offsetY,\n          affectStroke: this.affectStroke,\n          nonScaling: this.nonScaling\n        };\n      }\n      var obj = { }, proto = fabric.Shadow.prototype;\n\n      ['color', 'blur', 'offsetX', 'offsetY', 'affectStroke', 'nonScaling'].forEach(function(prop) {\n        if (this[prop] !== proto[prop]) {\n          obj[prop] = this[prop];\n        }\n      }, this);\n\n      return obj;\n    }\n  });\n\n  /**\n   * Regex matching shadow offsetX, offsetY and blur (ex: \"2px 2px 10px rgba(0,0,0,0.2)\", \"rgb(0,255,0) 2px 2px\")\n   * @static\n   * @field\n   * @memberOf fabric.Shadow\n   */\n  // eslint-disable-next-line max-len\n  fabric.Shadow.reOffsetsAndBlur = /(?:\\s|^)(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?(-?\\d+(?:\\.\\d*)?(?:px)?(?:\\s?|$))?(\\d+(?:\\.\\d*)?(?:px)?)?(?:\\s?|$)(?:$|\\s)/;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function () {\n\n  'use strict';\n\n  if (fabric.StaticCanvas) {\n    fabric.warn('fabric.StaticCanvas is already defined.');\n    return;\n  }\n\n  // aliases for faster resolution\n  var extend = fabric.util.object.extend,\n      getElementOffset = fabric.util.getElementOffset,\n      removeFromArray = fabric.util.removeFromArray,\n      toFixed = fabric.util.toFixed,\n      transformPoint = fabric.util.transformPoint,\n      invertTransform = fabric.util.invertTransform,\n      getNodeCanvas = fabric.util.getNodeCanvas,\n      createCanvasElement = fabric.util.createCanvasElement,\n\n      CANVAS_INIT_ERROR = new Error('Could not initialize `canvas` element');\n\n  /**\n   * Static canvas class\n   * @class fabric.StaticCanvas\n   * @mixes fabric.Collection\n   * @mixes fabric.Observable\n   * @see {@link http://fabricjs.com/static_canvas|StaticCanvas demo}\n   * @see {@link fabric.StaticCanvas#initialize} for constructor definition\n   * @fires before:render\n   * @fires after:render\n   * @fires canvas:cleared\n   * @fires object:added\n   * @fires object:removed\n   */\n  fabric.StaticCanvas = fabric.util.createClass(fabric.CommonMethods, /** @lends fabric.StaticCanvas.prototype */ {\n\n    /**\n     * Constructor\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(el, options) {\n      options || (options = { });\n      this.renderAndResetBound = this.renderAndReset.bind(this);\n      this.requestRenderAllBound = this.requestRenderAll.bind(this);\n      this._initStatic(el, options);\n    },\n\n    /**\n     * Background color of canvas instance.\n     * Should be set via {@link fabric.StaticCanvas#setBackgroundColor}.\n     * @type {(String|fabric.Pattern)}\n     * @default\n     */\n    backgroundColor: '',\n\n    /**\n     * Background image of canvas instance.\n     * since 2.4.0 image caching is active, please when putting an image as background, add to the\n     * canvas property a reference to the canvas it is on. Otherwise the image cannot detect the zoom\n     * vale. As an alternative you can disable image objectCaching\n     * @type fabric.Image\n     * @default\n     */\n    backgroundImage: null,\n\n    /**\n     * Overlay color of canvas instance.\n     * Should be set via {@link fabric.StaticCanvas#setOverlayColor}\n     * @since 1.3.9\n     * @type {(String|fabric.Pattern)}\n     * @default\n     */\n    overlayColor: '',\n\n    /**\n     * Overlay image of canvas instance.\n     * since 2.4.0 image caching is active, please when putting an image as overlay, add to the\n     * canvas property a reference to the canvas it is on. Otherwise the image cannot detect the zoom\n     * vale. As an alternative you can disable image objectCaching\n     * @type fabric.Image\n     * @default\n     */\n    overlayImage: null,\n\n    /**\n     * Indicates whether toObject/toDatalessObject should include default values\n     * if set to false, takes precedence over the object value.\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues: true,\n\n    /**\n     * Indicates whether objects' state should be saved\n     * @type Boolean\n     * @default\n     */\n    stateful: false,\n\n    /**\n     * Indicates whether {@link fabric.Collection.add}, {@link fabric.Collection.insertAt} and {@link fabric.Collection.remove},\n     * {@link fabric.StaticCanvas.moveTo}, {@link fabric.StaticCanvas.clear} and many more, should also re-render canvas.\n     * Disabling this option will not give a performance boost when adding/removing a lot of objects to/from canvas at once\n     * since the renders are quequed and executed one per frame.\n     * Disabling is suggested anyway and managing the renders of the app manually is not a big effort ( canvas.requestRenderAll() )\n     * Left default to true to do not break documentation and old app, fiddles.\n     * @type Boolean\n     * @default\n     */\n    renderOnAddRemove: true,\n\n    /**\n     * Indicates whether object controls (borders/controls) are rendered above overlay image\n     * @type Boolean\n     * @default\n     */\n    controlsAboveOverlay: false,\n\n    /**\n     * Indicates whether the browser can be scrolled when using a touchscreen and dragging on the canvas\n     * @type Boolean\n     * @default\n     */\n    allowTouchScrolling: false,\n\n    /**\n     * Indicates whether this canvas will use image smoothing, this is on by default in browsers\n     * @type Boolean\n     * @default\n     */\n    imageSmoothingEnabled: true,\n\n    /**\n     * The transformation (a Canvas 2D API transform matrix) which focuses the viewport\n     * @type Array\n     * @example <caption>Default transform</caption>\n     * canvas.viewportTransform = [1, 0, 0, 1, 0, 0];\n     * @example <caption>Scale by 70% and translate toward bottom-right by 50, without skewing</caption>\n     * canvas.viewportTransform = [0.7, 0, 0, 0.7, 50, 50];\n     * @default\n     */\n    viewportTransform: fabric.iMatrix.concat(),\n\n    /**\n     * if set to false background image is not affected by viewport transform\n     * @since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    backgroundVpt: true,\n\n    /**\n     * if set to false overlya image is not affected by viewport transform\n     * @since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    overlayVpt: true,\n\n    /**\n     * When true, canvas is scaled by devicePixelRatio for better rendering on retina screens\n     * @type Boolean\n     * @default\n     */\n    enableRetinaScaling: true,\n\n    /**\n     * Describe canvas element extension over design\n     * properties are tl,tr,bl,br.\n     * if canvas is not zoomed/panned those points are the four corner of canvas\n     * if canvas is viewportTransformed you those points indicate the extension\n     * of canvas element in plain untrasformed coordinates\n     * The coordinates get updated with @method calcViewportBoundaries.\n     * @memberOf fabric.StaticCanvas.prototype\n     */\n    vptCoords: { },\n\n    /**\n     * Based on vptCoords and object.aCoords, skip rendering of objects that\n     * are not included in current viewport.\n     * May greatly help in applications with crowded canvas and use of zoom/pan\n     * If One of the corner of the bounding box of the object is on the canvas\n     * the objects get rendered.\n     * @memberOf fabric.StaticCanvas.prototype\n     * @type Boolean\n     * @default\n     */\n    skipOffscreen: true,\n\n    /**\n     * a fabricObject that, without stroke define a clipping area with their shape. filled in black\n     * the clipPath object gets used when the canvas has rendered, and the context is placed in the\n     * top left corner of the canvas.\n     * clipPath will clip away controls, if you do not want this to happen use controlsAboveOverlay = true\n     * @type fabric.Object\n     */\n    clipPath: undefined,\n\n    /**\n     * @private\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     */\n    _initStatic: function(el, options) {\n      var cb = this.requestRenderAllBound;\n      this._objects = [];\n      this._createLowerCanvas(el);\n      this._initOptions(options);\n      // only initialize retina scaling once\n      if (!this.interactive) {\n        this._initRetinaScaling();\n      }\n\n      if (options.overlayImage) {\n        this.setOverlayImage(options.overlayImage, cb);\n      }\n      if (options.backgroundImage) {\n        this.setBackgroundImage(options.backgroundImage, cb);\n      }\n      if (options.backgroundColor) {\n        this.setBackgroundColor(options.backgroundColor, cb);\n      }\n      if (options.overlayColor) {\n        this.setOverlayColor(options.overlayColor, cb);\n      }\n      this.calcOffset();\n    },\n\n    /**\n     * @private\n     */\n    _isRetinaScaling: function() {\n      return (fabric.devicePixelRatio > 1 && this.enableRetinaScaling);\n    },\n\n    /**\n     * @private\n     * @return {Number} retinaScaling if applied, otherwise 1;\n     */\n    getRetinaScaling: function() {\n      return this._isRetinaScaling() ? Math.max(1, fabric.devicePixelRatio) : 1;\n    },\n\n    /**\n     * @private\n     */\n    _initRetinaScaling: function() {\n      if (!this._isRetinaScaling()) {\n        return;\n      }\n      var scaleRatio = fabric.devicePixelRatio;\n      this.__initRetinaScaling(scaleRatio, this.lowerCanvasEl, this.contextContainer);\n      if (this.upperCanvasEl) {\n        this.__initRetinaScaling(scaleRatio, this.upperCanvasEl, this.contextTop);\n      }\n    },\n\n    __initRetinaScaling: function(scaleRatio, canvas, context) {\n      canvas.setAttribute('width', this.width * scaleRatio);\n      canvas.setAttribute('height', this.height * scaleRatio);\n      context.scale(scaleRatio, scaleRatio);\n    },\n\n\n    /**\n     * Calculates canvas element offset relative to the document\n     * This method is also attached as \"resize\" event handler of window\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    calcOffset: function () {\n      this._offset = getElementOffset(this.lowerCanvasEl);\n      return this;\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#overlayImage|overlay image} for this canvas\n     * @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set overlay to\n     * @param {Function} callback callback to invoke when image is loaded and set as an overlay\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|overlay image}.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/MnzHT/|jsFiddle demo}\n     * @example <caption>Normal overlayImage with left/top = 0</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   // Needed to position overlayImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>overlayImage with different properties</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>Stretched overlayImage #1 - width/height correspond to canvas width/height</caption>\n     * fabric.Image.fromURL('http://fabricjs.com/assets/jail_cell_bars.png', function(img, isError) {\n     *    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});\n     *    canvas.setOverlayImage(img, canvas.renderAll.bind(canvas));\n     * });\n     * @example <caption>Stretched overlayImage #2 - width/height correspond to canvas width/height</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   width: canvas.width,\n     *   height: canvas.height,\n     *   // Needed to position overlayImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>overlayImage loaded from cross-origin</caption>\n     * canvas.setOverlayImage('http://fabricjs.com/assets/jail_cell_bars.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top',\n     *   crossOrigin: 'anonymous'\n     * });\n     */\n    setOverlayImage: function (image, callback, options) {\n      return this.__setBgOverlayImage('overlayImage', image, callback, options);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#backgroundImage|background image} for this canvas\n     * @param {(fabric.Image|String)} image fabric.Image instance or URL of an image to set background to\n     * @param {Function} callback Callback to invoke when image is loaded and set as background\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|background image}.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/djnr8o7a/28/|jsFiddle demo}\n     * @example <caption>Normal backgroundImage with left/top = 0</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   // Needed to position backgroundImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>backgroundImage with different properties</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>Stretched backgroundImage #1 - width/height correspond to canvas width/height</caption>\n     * fabric.Image.fromURL('http://fabricjs.com/assets/honey_im_subtle.png', function(img, isError) {\n     *    img.set({width: canvas.width, height: canvas.height, originX: 'left', originY: 'top'});\n     *    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));\n     * });\n     * @example <caption>Stretched backgroundImage #2 - width/height correspond to canvas width/height</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   width: canvas.width,\n     *   height: canvas.height,\n     *   // Needed to position backgroundImage at 0/0\n     *   originX: 'left',\n     *   originY: 'top'\n     * });\n     * @example <caption>backgroundImage loaded from cross-origin</caption>\n     * canvas.setBackgroundImage('http://fabricjs.com/assets/honey_im_subtle.png', canvas.renderAll.bind(canvas), {\n     *   opacity: 0.5,\n     *   angle: 45,\n     *   left: 400,\n     *   top: 400,\n     *   originX: 'left',\n     *   originY: 'top',\n     *   crossOrigin: 'anonymous'\n     * });\n     */\n    // TODO: fix stretched examples\n    setBackgroundImage: function (image, callback, options) {\n      return this.__setBgOverlayImage('backgroundImage', image, callback, options);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#overlayColor|foreground color} for this canvas\n     * @param {(String|fabric.Pattern)} overlayColor Color or pattern to set foreground color to\n     * @param {Function} callback Callback to invoke when foreground color is set\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/pB55h/|jsFiddle demo}\n     * @example <caption>Normal overlayColor - color value</caption>\n     * canvas.setOverlayColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as overlayColor</caption>\n     * canvas.setOverlayColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png'\n     * }, canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as overlayColor with repeat and offset</caption>\n     * canvas.setOverlayColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\n     *   repeat: 'repeat',\n     *   offsetX: 200,\n     *   offsetY: 100\n     * }, canvas.renderAll.bind(canvas));\n     */\n    setOverlayColor: function(overlayColor, callback) {\n      return this.__setBgOverlayColor('overlayColor', overlayColor, callback);\n    },\n\n    /**\n     * Sets {@link fabric.StaticCanvas#backgroundColor|background color} for this canvas\n     * @param {(String|fabric.Pattern)} backgroundColor Color or pattern to set background color to\n     * @param {Function} callback Callback to invoke when background color is set\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     * @see {@link http://jsfiddle.net/fabricjs/hXzvk/|jsFiddle demo}\n     * @example <caption>Normal backgroundColor - color value</caption>\n     * canvas.setBackgroundColor('rgba(255, 73, 64, 0.6)', canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as backgroundColor</caption>\n     * canvas.setBackgroundColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png'\n     * }, canvas.renderAll.bind(canvas));\n     * @example <caption>fabric.Pattern used as backgroundColor with repeat and offset</caption>\n     * canvas.setBackgroundColor({\n     *   source: 'http://fabricjs.com/assets/escheresque_ste.png',\n     *   repeat: 'repeat',\n     *   offsetX: 200,\n     *   offsetY: 100\n     * }, canvas.renderAll.bind(canvas));\n     */\n    setBackgroundColor: function(backgroundColor, callback) {\n      return this.__setBgOverlayColor('backgroundColor', backgroundColor, callback);\n    },\n\n    /**\n     * @private\n     * @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundImage|backgroundImage}\n     * or {@link fabric.StaticCanvas#overlayImage|overlayImage})\n     * @param {(fabric.Image|String|null)} image fabric.Image instance, URL of an image or null to set background or overlay to\n     * @param {Function} callback Callback to invoke when image is loaded and set as background or overlay. The first argument is the created image, the second argument is a flag indicating whether an error occurred or not.\n     * @param {Object} [options] Optional options to set for the {@link fabric.Image|image}.\n     */\n    __setBgOverlayImage: function(property, image, callback, options) {\n      if (typeof image === 'string') {\n        fabric.util.loadImage(image, function(img, isError) {\n          if (img) {\n            var instance = new fabric.Image(img, options);\n            this[property] = instance;\n            instance.canvas = this;\n          }\n          callback && callback(img, isError);\n        }, this, options && options.crossOrigin);\n      }\n      else {\n        options && image.setOptions(options);\n        this[property] = image;\n        image && (image.canvas = this);\n        callback && callback(image, false);\n      }\n\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {String} property Property to set ({@link fabric.StaticCanvas#backgroundColor|backgroundColor}\n     * or {@link fabric.StaticCanvas#overlayColor|overlayColor})\n     * @param {(Object|String|null)} color Object with pattern information, color value or null\n     * @param {Function} [callback] Callback is invoked when color is set\n     */\n    __setBgOverlayColor: function(property, color, callback) {\n      this[property] = color;\n      this._initGradient(color, property);\n      this._initPattern(color, property, callback);\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _createCanvasElement: function() {\n      var element = createCanvasElement();\n      if (!element) {\n        throw CANVAS_INIT_ERROR;\n      }\n      if (!element.style) {\n        element.style = { };\n      }\n      if (typeof element.getContext === 'undefined') {\n        throw CANVAS_INIT_ERROR;\n      }\n      return element;\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options object\n     */\n    _initOptions: function (options) {\n      var lowerCanvasEl = this.lowerCanvasEl;\n      this._setOptions(options);\n\n      this.width = this.width || parseInt(lowerCanvasEl.width, 10) || 0;\n      this.height = this.height || parseInt(lowerCanvasEl.height, 10) || 0;\n\n      if (!this.lowerCanvasEl.style) {\n        return;\n      }\n\n      lowerCanvasEl.width = this.width;\n      lowerCanvasEl.height = this.height;\n\n      lowerCanvasEl.style.width = this.width + 'px';\n      lowerCanvasEl.style.height = this.height + 'px';\n\n      this.viewportTransform = this.viewportTransform.slice();\n    },\n\n    /**\n     * Creates a bottom canvas\n     * @private\n     * @param {HTMLElement} [canvasEl]\n     */\n    _createLowerCanvas: function (canvasEl) {\n      // canvasEl === 'HTMLCanvasElement' does not work on jsdom/node\n      if (canvasEl && canvasEl.getContext) {\n        this.lowerCanvasEl = canvasEl;\n      }\n      else {\n        this.lowerCanvasEl = fabric.util.getById(canvasEl) || this._createCanvasElement();\n      }\n\n      fabric.util.addClass(this.lowerCanvasEl, 'lower-canvas');\n      this._originalCanvasStyle = this.lowerCanvasEl.style;\n      if (this.interactive) {\n        this._applyCanvasStyle(this.lowerCanvasEl);\n      }\n\n      this.contextContainer = this.lowerCanvasEl.getContext('2d');\n    },\n\n    /**\n     * Returns canvas width (in px)\n     * @return {Number}\n     */\n    getWidth: function () {\n      return this.width;\n    },\n\n    /**\n     * Returns canvas height (in px)\n     * @return {Number}\n     */\n    getHeight: function () {\n      return this.height;\n    },\n\n    /**\n     * Sets width of this canvas instance\n     * @param {Number|String} value                         Value to set width to\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setWidth: function (value, options) {\n      return this.setDimensions({ width: value }, options);\n    },\n\n    /**\n     * Sets height of this canvas instance\n     * @param {Number|String} value                         Value to set height to\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setHeight: function (value, options) {\n      return this.setDimensions({ height: value }, options);\n    },\n\n    /**\n     * Sets dimensions (width, height) of this canvas instance. when options.cssOnly flag active you should also supply the unit of measure (px/%/em)\n     * @param {Object}        dimensions                    Object with width/height properties\n     * @param {Number|String} [dimensions.width]            Width of canvas element\n     * @param {Number|String} [dimensions.height]           Height of canvas element\n     * @param {Object}        [options]                     Options object\n     * @param {Boolean}       [options.backstoreOnly=false] Set the given dimensions only as canvas backstore dimensions\n     * @param {Boolean}       [options.cssOnly=false]       Set the given dimensions only as css dimensions\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setDimensions: function (dimensions, options) {\n      var cssValue;\n\n      options = options || {};\n\n      for (var prop in dimensions) {\n        cssValue = dimensions[prop];\n\n        if (!options.cssOnly) {\n          this._setBackstoreDimension(prop, dimensions[prop]);\n          cssValue += 'px';\n          this.hasLostContext = true;\n        }\n\n        if (!options.backstoreOnly) {\n          this._setCssDimension(prop, cssValue);\n        }\n      }\n      if (this._isCurrentlyDrawing) {\n        this.freeDrawingBrush && this.freeDrawingBrush._setBrushStyles(this.contextTop);\n      }\n      this._initRetinaScaling();\n      this.calcOffset();\n\n      if (!options.cssOnly) {\n        this.requestRenderAll();\n      }\n\n      return this;\n    },\n\n    /**\n     * Helper for setting width/height\n     * @private\n     * @param {String} prop property (width|height)\n     * @param {Number} value value to set property to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    _setBackstoreDimension: function (prop, value) {\n      this.lowerCanvasEl[prop] = value;\n\n      if (this.upperCanvasEl) {\n        this.upperCanvasEl[prop] = value;\n      }\n\n      if (this.cacheCanvasEl) {\n        this.cacheCanvasEl[prop] = value;\n      }\n\n      this[prop] = value;\n\n      return this;\n    },\n\n    /**\n     * Helper for setting css width/height\n     * @private\n     * @param {String} prop property (width|height)\n     * @param {String} value value to set property to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    _setCssDimension: function (prop, value) {\n      this.lowerCanvasEl.style[prop] = value;\n\n      if (this.upperCanvasEl) {\n        this.upperCanvasEl.style[prop] = value;\n      }\n\n      if (this.wrapperEl) {\n        this.wrapperEl.style[prop] = value;\n      }\n\n      return this;\n    },\n\n    /**\n     * Returns canvas zoom level\n     * @return {Number}\n     */\n    getZoom: function () {\n      return this.viewportTransform[0];\n    },\n\n    /**\n     * Sets viewport transformation of this canvas instance\n     * @param {Array} vpt a Canvas 2D API transform matrix\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setViewportTransform: function (vpt) {\n      var activeObject = this._activeObject,\n          backgroundObject = this.backgroundImage,\n          overlayObject = this.overlayImage,\n          object, i, len;\n      this.viewportTransform = vpt;\n      for (i = 0, len = this._objects.length; i < len; i++) {\n        object = this._objects[i];\n        object.group || object.setCoords(true);\n      }\n      if (activeObject) {\n        activeObject.setCoords();\n      }\n      if (backgroundObject) {\n        backgroundObject.setCoords(true);\n      }\n      if (overlayObject) {\n        overlayObject.setCoords(true);\n      }\n      this.calcViewportBoundaries();\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Sets zoom level of this canvas instance, the zoom centered around point\n     * meaning that following zoom to point with the same point will have the visual\n     * effect of the zoom originating from that point. The point won't move.\n     * It has nothing to do with canvas center or visual center of the viewport.\n     * @param {fabric.Point} point to zoom with respect to\n     * @param {Number} value to set zoom to, less than 1 zooms out\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    zoomToPoint: function (point, value) {\n      // TODO: just change the scale, preserve other transformations\n      var before = point, vpt = this.viewportTransform.slice(0);\n      point = transformPoint(point, invertTransform(this.viewportTransform));\n      vpt[0] = value;\n      vpt[3] = value;\n      var after = transformPoint(point, vpt);\n      vpt[4] += before.x - after.x;\n      vpt[5] += before.y - after.y;\n      return this.setViewportTransform(vpt);\n    },\n\n    /**\n     * Sets zoom level of this canvas instance\n     * @param {Number} value to set zoom to, less than 1 zooms out\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    setZoom: function (value) {\n      this.zoomToPoint(new fabric.Point(0, 0), value);\n      return this;\n    },\n\n    /**\n     * Pan viewport so as to place point at top left corner of canvas\n     * @param {fabric.Point} point to move to\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    absolutePan: function (point) {\n      var vpt = this.viewportTransform.slice(0);\n      vpt[4] = -point.x;\n      vpt[5] = -point.y;\n      return this.setViewportTransform(vpt);\n    },\n\n    /**\n     * Pans viewpoint relatively\n     * @param {fabric.Point} point (position vector) to move by\n     * @return {fabric.Canvas} instance\n     * @chainable true\n     */\n    relativePan: function (point) {\n      return this.absolutePan(new fabric.Point(\n        -point.x - this.viewportTransform[4],\n        -point.y - this.viewportTransform[5]\n      ));\n    },\n\n    /**\n     * Returns &lt;canvas> element corresponding to this instance\n     * @return {HTMLCanvasElement}\n     */\n    getElement: function () {\n      return this.lowerCanvasEl;\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was added\n     */\n    _onObjectAdded: function(obj) {\n      this.stateful && obj.setupState();\n      obj._set('canvas', this);\n      obj.setCoords();\n      this.fire('object:added', { target: obj });\n      obj.fire('added');\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was removed\n     */\n    _onObjectRemoved: function(obj) {\n      this.fire('object:removed', { target: obj });\n      obj.fire('removed');\n      delete obj.canvas;\n    },\n\n    /**\n     * Clears specified context of canvas element\n     * @param {CanvasRenderingContext2D} ctx Context to clear\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clearContext: function(ctx) {\n      ctx.clearRect(0, 0, this.width, this.height);\n      return this;\n    },\n\n    /**\n     * Returns context of canvas where objects are drawn\n     * @return {CanvasRenderingContext2D}\n     */\n    getContext: function () {\n      return this.contextContainer;\n    },\n\n    /**\n     * Clears all contexts (background, main, top) of an instance\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clear: function () {\n      this.remove.apply(this, this.getObjects());\n      this.backgroundImage = null;\n      this.overlayImage = null;\n      this.backgroundColor = '';\n      this.overlayColor = '';\n      if (this._hasITextHandlers) {\n        this.off('mouse:up', this._mouseUpITextHandler);\n        this._iTextInstances = null;\n        this._hasITextHandlers = false;\n      }\n      this.clearContext(this.contextContainer);\n      this.fire('canvas:cleared');\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Renders the canvas\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderAll: function () {\n      var canvasToDrawOn = this.contextContainer;\n      this.renderCanvas(canvasToDrawOn, this._objects);\n      return this;\n    },\n\n    /**\n     * Function created to be instance bound at initialization\n     * used in requestAnimationFrame rendering\n     * Let the fabricJS call it. If you call it manually you could have more\n     * animationFrame stacking on to of each other\n     * for an imperative rendering, use canvas.renderAll\n     * @private\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderAndReset: function() {\n      this.isRendering = 0;\n      this.renderAll();\n    },\n\n    /**\n     * Append a renderAll request to next animation frame.\n     * unless one is already in progress, in that case nothing is done\n     * a boolean flag will avoid appending more.\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    requestRenderAll: function () {\n      if (!this.isRendering) {\n        this.isRendering = fabric.util.requestAnimFrame(this.renderAndResetBound);\n      }\n      return this;\n    },\n\n    /**\n     * Calculate the position of the 4 corner of canvas with current viewportTransform.\n     * helps to determinate when an object is in the current rendering viewport using\n     * object absolute coordinates ( aCoords )\n     * @return {Object} points.tl\n     * @chainable\n     */\n    calcViewportBoundaries: function() {\n      var points = { }, width = this.width, height = this.height,\n          iVpt = invertTransform(this.viewportTransform);\n      points.tl = transformPoint({ x: 0, y: 0 }, iVpt);\n      points.br = transformPoint({ x: width, y: height }, iVpt);\n      points.tr = new fabric.Point(points.br.x, points.tl.y);\n      points.bl = new fabric.Point(points.tl.x, points.br.y);\n      this.vptCoords = points;\n      return points;\n    },\n\n    cancelRequestedRender: function() {\n      if (this.isRendering) {\n        fabric.util.cancelAnimFrame(this.isRendering);\n        this.isRendering = 0;\n      }\n    },\n\n    /**\n     * Renders background, objects, overlay and controls.\n     * @param {CanvasRenderingContext2D} ctx\n     * @param {Array} objects to render\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderCanvas: function(ctx, objects) {\n      var v = this.viewportTransform, path = this.clipPath;\n      this.cancelRequestedRender();\n      this.calcViewportBoundaries();\n      this.clearContext(ctx);\n      fabric.util.setImageSmoothing(ctx, this.imageSmoothingEnabled);\n      this.fire('before:render', { ctx: ctx, });\n      this._renderBackground(ctx);\n\n      ctx.save();\n      //apply viewport transform once for all rendering process\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      this._renderObjects(ctx, objects);\n      ctx.restore();\n      if (!this.controlsAboveOverlay && this.interactive) {\n        this.drawControls(ctx);\n      }\n      if (path) {\n        path.canvas = this;\n        // needed to setup a couple of variables\n        path.shouldCache();\n        path._transformDone = true;\n        path.renderCache({ forClipping: true });\n        this.drawClipPathOnCanvas(ctx);\n      }\n      this._renderOverlay(ctx);\n      if (this.controlsAboveOverlay && this.interactive) {\n        this.drawControls(ctx);\n      }\n      this.fire('after:render', { ctx: ctx, });\n    },\n\n    /**\n     * Paint the cached clipPath on the lowerCanvasEl\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawClipPathOnCanvas: function(ctx) {\n      var v = this.viewportTransform, path = this.clipPath;\n      ctx.save();\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      // DEBUG: uncomment this line, comment the following\n      // ctx.globalAlpha = 0.4;\n      ctx.globalCompositeOperation = 'destination-in';\n      path.transform(ctx);\n      ctx.scale(1 / path.zoomX, 1 / path.zoomY);\n      ctx.drawImage(path._cacheCanvas, -path.cacheTranslationX, -path.cacheTranslationY);\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Array} objects to render\n     */\n    _renderObjects: function(ctx, objects) {\n      var i, len;\n      for (i = 0, len = objects.length; i < len; ++i) {\n        objects[i] && objects[i].render(ctx);\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {string} property 'background' or 'overlay'\n     */\n    _renderBackgroundOrOverlay: function(ctx, property) {\n      var fill = this[property + 'Color'], object = this[property + 'Image'],\n          v = this.viewportTransform, needsVpt = this[property + 'Vpt'];\n      if (!fill && !object) {\n        return;\n      }\n      if (fill) {\n        ctx.save();\n        ctx.beginPath();\n        ctx.moveTo(0, 0);\n        ctx.lineTo(this.width, 0);\n        ctx.lineTo(this.width, this.height);\n        ctx.lineTo(0, this.height);\n        ctx.closePath();\n        ctx.fillStyle = fill.toLive\n          ? fill.toLive(ctx, this)\n          : fill;\n        if (needsVpt) {\n          ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n        }\n        ctx.transform(1, 0, 0, 1, fill.offsetX || 0, fill.offsetY || 0);\n        var m = fill.gradientTransform || fill.patternTransform;\n        m && ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n        ctx.fill();\n        ctx.restore();\n      }\n      if (object) {\n        ctx.save();\n        if (needsVpt) {\n          ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n        }\n        object.render(ctx);\n        ctx.restore();\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderBackground: function(ctx) {\n      this._renderBackgroundOrOverlay(ctx, 'background');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderOverlay: function(ctx) {\n      this._renderBackgroundOrOverlay(ctx, 'overlay');\n    },\n\n    /**\n     * Returns coordinates of a center of canvas.\n     * Returned value is an object with top and left properties\n     * @return {Object} object with \"top\" and \"left\" number values\n     * @deprecated migrate to `getCenterPoint`\n     */\n    getCenter: function () {\n      return {\n        top: this.height / 2,\n        left: this.width / 2\n      };\n    },\n\n    /**\n     * Returns coordinates of a center of canvas.\n     * @return {fabric.Point} \n     */\n    getCenterPoint: function () {\n      return new fabric.Point(this.width / 2, this.height / 2);\n    },\n\n    /**\n     * Centers object horizontally in the canvas\n     * @param {fabric.Object} object Object to center horizontally\n     * @return {fabric.Canvas} thisArg\n     */\n    centerObjectH: function (object) {\n      return this._centerObject(object, new fabric.Point(this.getCenterPoint().x, object.getCenterPoint().y));\n    },\n\n    /**\n     * Centers object vertically in the canvas\n     * @param {fabric.Object} object Object to center vertically\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    centerObjectV: function (object) {\n      return this._centerObject(object, new fabric.Point(object.getCenterPoint().x, this.getCenterPoint().y));\n    },\n\n    /**\n     * Centers object vertically and horizontally in the canvas\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    centerObject: function(object) {\n      var center = this.getCenterPoint();\n      return this._centerObject(object, center);\n    },\n\n    /**\n     * Centers object vertically and horizontally in the viewport\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObject: function(object) {\n      var vpCenter = this.getVpCenter();\n      return this._centerObject(object, vpCenter);\n    },\n\n    /**\n     * Centers object horizontally in the viewport, object.top is unchanged\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObjectH: function(object) {\n      var vpCenter = this.getVpCenter();\n      this._centerObject(object, new fabric.Point(vpCenter.x, object.getCenterPoint().y));\n      return this;\n    },\n\n    /**\n     * Centers object Vertically in the viewport, object.top is unchanged\n     * @param {fabric.Object} object Object to center vertically and horizontally\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    viewportCenterObjectV: function(object) {\n      var vpCenter = this.getVpCenter();\n\n      return this._centerObject(object, new fabric.Point(object.getCenterPoint().x, vpCenter.y));\n    },\n\n    /**\n     * Calculate the point in canvas that correspond to the center of actual viewport.\n     * @return {fabric.Point} vpCenter, viewport center\n     * @chainable\n     */\n    getVpCenter: function() {\n      var center = this.getCenterPoint(),\n          iVpt = invertTransform(this.viewportTransform);\n      return transformPoint(center, iVpt);\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} object Object to center\n     * @param {fabric.Point} center Center point\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    _centerObject: function(object, center) {\n      object.setPositionByOrigin(center, 'center', 'center');\n      object.setCoords();\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Returns dataless JSON representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {String} json string\n     */\n    toDatalessJSON: function (propertiesToInclude) {\n      return this.toDatalessObject(propertiesToInclude);\n    },\n\n    /**\n     * Returns object representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function (propertiesToInclude) {\n      return this._toObjectMethod('toObject', propertiesToInclude);\n    },\n\n    /**\n     * Returns dataless object representation of canvas\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function (propertiesToInclude) {\n      return this._toObjectMethod('toDatalessObject', propertiesToInclude);\n    },\n\n    /**\n     * @private\n     */\n    _toObjectMethod: function (methodName, propertiesToInclude) {\n\n      var clipPath = this.clipPath, data = {\n        version: fabric.version,\n        objects: this._toObjects(methodName, propertiesToInclude),\n      };\n      if (clipPath && !clipPath.excludeFromExport) {\n        data.clipPath = this._toObject(this.clipPath, methodName, propertiesToInclude);\n      }\n      extend(data, this.__serializeBgOverlay(methodName, propertiesToInclude));\n\n      fabric.util.populateWithProperties(this, data, propertiesToInclude);\n\n      return data;\n    },\n\n    /**\n     * @private\n     */\n    _toObjects: function(methodName, propertiesToInclude) {\n      return this._objects.filter(function(object) {\n        return !object.excludeFromExport;\n      }).map(function(instance) {\n        return this._toObject(instance, methodName, propertiesToInclude);\n      }, this);\n    },\n\n    /**\n     * @private\n     */\n    _toObject: function(instance, methodName, propertiesToInclude) {\n      var originalValue;\n\n      if (!this.includeDefaultValues) {\n        originalValue = instance.includeDefaultValues;\n        instance.includeDefaultValues = false;\n      }\n\n      var object = instance[methodName](propertiesToInclude);\n      if (!this.includeDefaultValues) {\n        instance.includeDefaultValues = originalValue;\n      }\n      return object;\n    },\n\n    /**\n     * @private\n     */\n    __serializeBgOverlay: function(methodName, propertiesToInclude) {\n      var data = {}, bgImage = this.backgroundImage, overlayImage = this.overlayImage,\n          bgColor = this.backgroundColor, overlayColor = this.overlayColor;\n\n      if (bgColor && bgColor.toObject) {\n        if (!bgColor.excludeFromExport) {\n          data.background = bgColor.toObject(propertiesToInclude);\n        }\n      }\n      else if (bgColor) {\n        data.background = bgColor;\n      }\n\n      if (overlayColor && overlayColor.toObject) {\n        if (!overlayColor.excludeFromExport) {\n          data.overlay = overlayColor.toObject(propertiesToInclude);\n        }\n      }\n      else if (overlayColor) {\n        data.overlay = overlayColor;\n      }\n\n      if (bgImage && !bgImage.excludeFromExport) {\n        data.backgroundImage = this._toObject(bgImage, methodName, propertiesToInclude);\n      }\n      if (overlayImage && !overlayImage.excludeFromExport) {\n        data.overlayImage = this._toObject(overlayImage, methodName, propertiesToInclude);\n      }\n\n      return data;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * When true, getSvgTransform() will apply the StaticCanvas.viewportTransform to the SVG transformation. When true,\n     * a zoomed canvas will then produce zoomed SVG output.\n     * @type Boolean\n     * @default\n     */\n    svgViewportTransformation: true,\n\n    /**\n     * Returns SVG representation of canvas\n     * @function\n     * @param {Object} [options] Options object for SVG output\n     * @param {Boolean} [options.suppressPreamble=false] If true xml tag is not included\n     * @param {Object} [options.viewBox] SVG viewbox object\n     * @param {Number} [options.viewBox.x] x-coordinate of viewbox\n     * @param {Number} [options.viewBox.y] y-coordinate of viewbox\n     * @param {Number} [options.viewBox.width] Width of viewbox\n     * @param {Number} [options.viewBox.height] Height of viewbox\n     * @param {String} [options.encoding=UTF-8] Encoding of SVG output\n     * @param {String} [options.width] desired width of svg with or without units\n     * @param {String} [options.height] desired height of svg with or without units\n     * @param {Function} [reviver] Method for further parsing of svg elements, called after each fabric object converted into svg representation.\n     * @return {String} SVG string\n     * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#serialization}\n     * @see {@link http://jsfiddle.net/fabricjs/jQ3ZZ/|jsFiddle demo}\n     * @example <caption>Normal SVG output</caption>\n     * var svg = canvas.toSVG();\n     * @example <caption>SVG output without preamble (without &lt;?xml ../>)</caption>\n     * var svg = canvas.toSVG({suppressPreamble: true});\n     * @example <caption>SVG output with viewBox attribute</caption>\n     * var svg = canvas.toSVG({\n     *   viewBox: {\n     *     x: 100,\n     *     y: 100,\n     *     width: 200,\n     *     height: 300\n     *   }\n     * });\n     * @example <caption>SVG output with different encoding (default: UTF-8)</caption>\n     * var svg = canvas.toSVG({encoding: 'ISO-8859-1'});\n     * @example <caption>Modify SVG output with reviver function</caption>\n     * var svg = canvas.toSVG(null, function(svg) {\n     *   return svg.replace('stroke-dasharray: ; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; ', '');\n     * });\n     */\n    toSVG: function(options, reviver) {\n      options || (options = { });\n      options.reviver = reviver;\n      var markup = [];\n\n      this._setSVGPreamble(markup, options);\n      this._setSVGHeader(markup, options);\n      if (this.clipPath) {\n        markup.push('<g clip-path=\"url(#' + this.clipPath.clipPathId + ')\" >\\n');\n      }\n      this._setSVGBgOverlayColor(markup, 'background');\n      this._setSVGBgOverlayImage(markup, 'backgroundImage', reviver);\n      this._setSVGObjects(markup, reviver);\n      if (this.clipPath) {\n        markup.push('</g>\\n');\n      }\n      this._setSVGBgOverlayColor(markup, 'overlay');\n      this._setSVGBgOverlayImage(markup, 'overlayImage', reviver);\n\n      markup.push('</svg>');\n\n      return markup.join('');\n    },\n\n    /**\n     * @private\n     */\n    _setSVGPreamble: function(markup, options) {\n      if (options.suppressPreamble) {\n        return;\n      }\n      markup.push(\n        '<?xml version=\"1.0\" encoding=\"', (options.encoding || 'UTF-8'), '\" standalone=\"no\" ?>\\n',\n        '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" ',\n        '\"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\\n'\n      );\n    },\n\n    /**\n     * @private\n     */\n    _setSVGHeader: function(markup, options) {\n      var width = options.width || this.width,\n          height = options.height || this.height,\n          vpt, viewBox = 'viewBox=\"0 0 ' + this.width + ' ' + this.height + '\" ',\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n\n      if (options.viewBox) {\n        viewBox = 'viewBox=\"' +\n                options.viewBox.x + ' ' +\n                options.viewBox.y + ' ' +\n                options.viewBox.width + ' ' +\n                options.viewBox.height + '\" ';\n      }\n      else {\n        if (this.svgViewportTransformation) {\n          vpt = this.viewportTransform;\n          viewBox = 'viewBox=\"' +\n                  toFixed(-vpt[4] / vpt[0], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(-vpt[5] / vpt[3], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(this.width / vpt[0], NUM_FRACTION_DIGITS) + ' ' +\n                  toFixed(this.height / vpt[3], NUM_FRACTION_DIGITS) + '\" ';\n        }\n      }\n\n      markup.push(\n        '<svg ',\n        'xmlns=\"http://www.w3.org/2000/svg\" ',\n        'xmlns:xlink=\"http://www.w3.org/1999/xlink\" ',\n        'version=\"1.1\" ',\n        'width=\"', width, '\" ',\n        'height=\"', height, '\" ',\n        viewBox,\n        'xml:space=\"preserve\">\\n',\n        '<desc>Created with Fabric.js ', fabric.version, '</desc>\\n',\n        '<defs>\\n',\n        this.createSVGFontFacesMarkup(),\n        this.createSVGRefElementsMarkup(),\n        this.createSVGClipPathMarkup(options),\n        '</defs>\\n'\n      );\n    },\n\n    createSVGClipPathMarkup: function(options) {\n      var clipPath = this.clipPath;\n      if (clipPath) {\n        clipPath.clipPathId = 'CLIPPATH_' + fabric.Object.__uid++;\n        return  '<clipPath id=\"' + clipPath.clipPathId + '\" >\\n' +\n          this.clipPath.toClipPathSVG(options.reviver) +\n          '</clipPath>\\n';\n      }\n      return '';\n    },\n\n    /**\n     * Creates markup containing SVG referenced elements like patterns, gradients etc.\n     * @return {String}\n     */\n    createSVGRefElementsMarkup: function() {\n      var _this = this,\n          markup = ['background', 'overlay'].map(function(prop) {\n            var fill = _this[prop + 'Color'];\n            if (fill && fill.toLive) {\n              var shouldTransform = _this[prop + 'Vpt'], vpt = _this.viewportTransform,\n                  object = {\n                    width: _this.width / (shouldTransform ? vpt[0] : 1),\n                    height: _this.height / (shouldTransform ? vpt[3] : 1)\n                  };\n              return fill.toSVG(\n                object,\n                { additionalTransform: shouldTransform ? fabric.util.matrixToSVG(vpt) : '' }\n              );\n            }\n          });\n      return markup.join('');\n    },\n\n    /**\n     * Creates markup containing SVG font faces,\n     * font URLs for font faces must be collected by developers\n     * and are not extracted from the DOM by fabricjs\n     * @param {Array} objects Array of fabric objects\n     * @return {String}\n     */\n    createSVGFontFacesMarkup: function() {\n      var markup = '', fontList = { }, obj, fontFamily,\n          style, row, rowIndex, _char, charIndex, i, len,\n          fontPaths = fabric.fontPaths, objects = [];\n\n      this._objects.forEach(function add(object) {\n        objects.push(object);\n        if (object._objects) {\n          object._objects.forEach(add);\n        }\n      });\n\n      for (i = 0, len = objects.length; i < len; i++) {\n        obj = objects[i];\n        fontFamily = obj.fontFamily;\n        if (obj.type.indexOf('text') === -1 || fontList[fontFamily] || !fontPaths[fontFamily]) {\n          continue;\n        }\n        fontList[fontFamily] = true;\n        if (!obj.styles) {\n          continue;\n        }\n        style = obj.styles;\n        for (rowIndex in style) {\n          row = style[rowIndex];\n          for (charIndex in row) {\n            _char = row[charIndex];\n            fontFamily = _char.fontFamily;\n            if (!fontList[fontFamily] && fontPaths[fontFamily]) {\n              fontList[fontFamily] = true;\n            }\n          }\n        }\n      }\n\n      for (var j in fontList) {\n        markup += [\n          '\\t\\t@font-face {\\n',\n          '\\t\\t\\tfont-family: \\'', j, '\\';\\n',\n          '\\t\\t\\tsrc: url(\\'', fontPaths[j], '\\');\\n',\n          '\\t\\t}\\n'\n        ].join('');\n      }\n\n      if (markup) {\n        markup = [\n          '\\t<style type=\"text/css\">',\n          '<![CDATA[\\n',\n          markup,\n          ']]>',\n          '</style>\\n'\n        ].join('');\n      }\n\n      return markup;\n    },\n\n    /**\n     * @private\n     */\n    _setSVGObjects: function(markup, reviver) {\n      var instance, i, len, objects = this._objects;\n      for (i = 0, len = objects.length; i < len; i++) {\n        instance = objects[i];\n        if (instance.excludeFromExport) {\n          continue;\n        }\n        this._setSVGObject(markup, instance, reviver);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGObject: function(markup, instance, reviver) {\n      markup.push(instance.toSVG(reviver));\n    },\n\n    /**\n     * @private\n     */\n    _setSVGBgOverlayImage: function(markup, property, reviver) {\n      if (this[property] && !this[property].excludeFromExport && this[property].toSVG) {\n        markup.push(this[property].toSVG(reviver));\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGBgOverlayColor: function(markup, property) {\n      var filler = this[property + 'Color'], vpt = this.viewportTransform, finalWidth = this.width,\n          finalHeight = this.height;\n      if (!filler) {\n        return;\n      }\n      if (filler.toLive) {\n        var repeat = filler.repeat, iVpt = fabric.util.invertTransform(vpt), shouldInvert = this[property + 'Vpt'],\n            additionalTransform = shouldInvert ? fabric.util.matrixToSVG(iVpt) : '';\n        markup.push(\n          '<rect transform=\"' + additionalTransform + ' translate(', finalWidth / 2, ',', finalHeight / 2, ')\"',\n          ' x=\"', filler.offsetX - finalWidth / 2,\n          '\" y=\"', filler.offsetY - finalHeight / 2, '\" ',\n          'width=\"',\n          (repeat === 'repeat-y' || repeat === 'no-repeat'\n            ? filler.source.width\n            : finalWidth ),\n          '\" height=\"',\n          (repeat === 'repeat-x' || repeat === 'no-repeat'\n            ? filler.source.height\n            : finalHeight),\n          '\" fill=\"url(#SVGID_' + filler.id + ')\"',\n          '></rect>\\n'\n        );\n      }\n      else {\n        markup.push(\n          '<rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" ',\n          'fill=\"', filler, '\"',\n          '></rect>\\n'\n        );\n      }\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Moves an object or the objects of a multiple selection\n     * to the bottom of the stack of drawn objects\n     * @param {fabric.Object} object Object to send to back\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    sendToBack: function (object) {\n      if (!object) {\n        return this;\n      }\n      var activeSelection = this._activeObject,\n          i, obj, objs;\n      if (object === activeSelection && object.type === 'activeSelection') {\n        objs = activeSelection._objects;\n        for (i = objs.length; i--;) {\n          obj = objs[i];\n          removeFromArray(this._objects, obj);\n          this._objects.unshift(obj);\n        }\n      }\n      else {\n        removeFromArray(this._objects, object);\n        this._objects.unshift(object);\n      }\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Moves an object or the objects of a multiple selection\n     * to the top of the stack of drawn objects\n     * @param {fabric.Object} object Object to send\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    bringToFront: function (object) {\n      if (!object) {\n        return this;\n      }\n      var activeSelection = this._activeObject,\n          i, obj, objs;\n      if (object === activeSelection && object.type === 'activeSelection') {\n        objs = activeSelection._objects;\n        for (i = 0; i < objs.length; i++) {\n          obj = objs[i];\n          removeFromArray(this._objects, obj);\n          this._objects.push(obj);\n        }\n      }\n      else {\n        removeFromArray(this._objects, object);\n        this._objects.push(object);\n      }\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * Moves an object or a selection down in stack of drawn objects\n     * An optional parameter, intersecting allows to move the object in behind\n     * the first intersecting object. Where intersection is calculated with\n     * bounding box. If no intersection is found, there will not be change in the\n     * stack.\n     * @param {fabric.Object} object Object to send\n     * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    sendBackwards: function (object, intersecting) {\n      if (!object) {\n        return this;\n      }\n      var activeSelection = this._activeObject,\n          i, obj, idx, newIdx, objs, objsMoved = 0;\n\n      if (object === activeSelection && object.type === 'activeSelection') {\n        objs = activeSelection._objects;\n        for (i = 0; i < objs.length; i++) {\n          obj = objs[i];\n          idx = this._objects.indexOf(obj);\n          if (idx > 0 + objsMoved) {\n            newIdx = idx - 1;\n            removeFromArray(this._objects, obj);\n            this._objects.splice(newIdx, 0, obj);\n          }\n          objsMoved++;\n        }\n      }\n      else {\n        idx = this._objects.indexOf(object);\n        if (idx !== 0) {\n          // if object is not on the bottom of stack\n          newIdx = this._findNewLowerIndex(object, idx, intersecting);\n          removeFromArray(this._objects, object);\n          this._objects.splice(newIdx, 0, object);\n        }\n      }\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _findNewLowerIndex: function(object, idx, intersecting) {\n      var newIdx, i;\n\n      if (intersecting) {\n        newIdx = idx;\n\n        // traverse down the stack looking for the nearest intersecting object\n        for (i = idx - 1; i >= 0; --i) {\n\n          var isIntersecting = object.intersectsWithObject(this._objects[i]) ||\n                               object.isContainedWithinObject(this._objects[i]) ||\n                               this._objects[i].isContainedWithinObject(object);\n\n          if (isIntersecting) {\n            newIdx = i;\n            break;\n          }\n        }\n      }\n      else {\n        newIdx = idx - 1;\n      }\n\n      return newIdx;\n    },\n\n    /**\n     * Moves an object or a selection up in stack of drawn objects\n     * An optional parameter, intersecting allows to move the object in front\n     * of the first intersecting object. Where intersection is calculated with\n     * bounding box. If no intersection is found, there will not be change in the\n     * stack.\n     * @param {fabric.Object} object Object to send\n     * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    bringForward: function (object, intersecting) {\n      if (!object) {\n        return this;\n      }\n      var activeSelection = this._activeObject,\n          i, obj, idx, newIdx, objs, objsMoved = 0;\n\n      if (object === activeSelection && object.type === 'activeSelection') {\n        objs = activeSelection._objects;\n        for (i = objs.length; i--;) {\n          obj = objs[i];\n          idx = this._objects.indexOf(obj);\n          if (idx < this._objects.length - 1 - objsMoved) {\n            newIdx = idx + 1;\n            removeFromArray(this._objects, obj);\n            this._objects.splice(newIdx, 0, obj);\n          }\n          objsMoved++;\n        }\n      }\n      else {\n        idx = this._objects.indexOf(object);\n        if (idx !== this._objects.length - 1) {\n          // if object is not on top of stack (last item in an array)\n          newIdx = this._findNewUpperIndex(object, idx, intersecting);\n          removeFromArray(this._objects, object);\n          this._objects.splice(newIdx, 0, object);\n        }\n      }\n      this.renderOnAddRemove && this.requestRenderAll();\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _findNewUpperIndex: function(object, idx, intersecting) {\n      var newIdx, i, len;\n\n      if (intersecting) {\n        newIdx = idx;\n\n        // traverse up the stack looking for the nearest intersecting object\n        for (i = idx + 1, len = this._objects.length; i < len; ++i) {\n\n          var isIntersecting = object.intersectsWithObject(this._objects[i]) ||\n                               object.isContainedWithinObject(this._objects[i]) ||\n                               this._objects[i].isContainedWithinObject(object);\n\n          if (isIntersecting) {\n            newIdx = i;\n            break;\n          }\n        }\n      }\n      else {\n        newIdx = idx + 1;\n      }\n\n      return newIdx;\n    },\n\n    /**\n     * Moves an object to specified level in stack of drawn objects\n     * @param {fabric.Object} object Object to send\n     * @param {Number} index Position to move to\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    moveTo: function (object, index) {\n      removeFromArray(this._objects, object);\n      this._objects.splice(index, 0, object);\n      return this.renderOnAddRemove && this.requestRenderAll();\n    },\n\n    /**\n     * Clears a canvas element and dispose objects\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    dispose: function () {\n      // cancel eventually ongoing renders\n      if (this.isRendering) {\n        fabric.util.cancelAnimFrame(this.isRendering);\n        this.isRendering = 0;\n      }\n      this.forEachObject(function(object) {\n        object.dispose && object.dispose();\n      });\n      this._objects = [];\n      if (this.backgroundImage && this.backgroundImage.dispose) {\n        this.backgroundImage.dispose();\n      }\n      this.backgroundImage = null;\n      if (this.overlayImage && this.overlayImage.dispose) {\n        this.overlayImage.dispose();\n      }\n      this.overlayImage = null;\n      this._iTextInstances = null;\n      this.contextContainer = null;\n      // restore canvas style\n      this.lowerCanvasEl.classList.remove('lower-canvas');\n      fabric.util.setStyle(this.lowerCanvasEl, this._originalCanvasStyle);\n      delete this._originalCanvasStyle;\n      // restore canvas size to original size in case retina scaling was applied\n      this.lowerCanvasEl.setAttribute('width', this.width);\n      this.lowerCanvasEl.setAttribute('height', this.height);\n      fabric.util.cleanUpJsdomNode(this.lowerCanvasEl);\n      this.lowerCanvasEl = undefined;\n      return this;\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @return {String} string representation of an instance\n     */\n    toString: function () {\n      return '#<fabric.Canvas (' + this.complexity() + '): ' +\n               '{ objects: ' + this._objects.length + ' }>';\n    }\n  });\n\n  extend(fabric.StaticCanvas.prototype, fabric.Observable);\n  extend(fabric.StaticCanvas.prototype, fabric.Collection);\n  extend(fabric.StaticCanvas.prototype, fabric.DataURLExporter);\n\n  extend(fabric.StaticCanvas, /** @lends fabric.StaticCanvas */ {\n\n    /**\n     * @static\n     * @type String\n     * @default\n     */\n    EMPTY_JSON: '{\"objects\": [], \"background\": \"white\"}',\n\n    /**\n     * Provides a way to check support of some of the canvas methods\n     * (either those of HTMLCanvasElement itself, or rendering context)\n     *\n     * @param {String} methodName Method to check support for;\n     *                            Could be one of \"setLineDash\"\n     * @return {Boolean | null} `true` if method is supported (or at least exists),\n     *                          `null` if canvas element or context can not be initialized\n     */\n    supports: function (methodName) {\n      var el = createCanvasElement();\n\n      if (!el || !el.getContext) {\n        return null;\n      }\n\n      var ctx = el.getContext('2d');\n      if (!ctx) {\n        return null;\n      }\n\n      switch (methodName) {\n\n        case 'setLineDash':\n          return typeof ctx.setLineDash !== 'undefined';\n\n        default:\n          return null;\n      }\n    }\n  });\n\n  /**\n   * Returns Object representation of canvas\n   * this alias is provided because if you call JSON.stringify on an instance,\n   * the toJSON object will be invoked if it exists.\n   * Having a toJSON method means you can do JSON.stringify(myCanvas)\n   * @function\n   * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n   * @return {Object} JSON compatible object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#serialization}\n   * @see {@link http://jsfiddle.net/fabricjs/pec86/|jsFiddle demo}\n   * @example <caption>JSON without additional properties</caption>\n   * var json = canvas.toJSON();\n   * @example <caption>JSON with additional properties included</caption>\n   * var json = canvas.toJSON(['lockMovementX', 'lockMovementY', 'lockRotation', 'lockScalingX', 'lockScalingY']);\n   * @example <caption>JSON without default values</caption>\n   * canvas.includeDefaultValues = false;\n   * var json = canvas.toJSON();\n   */\n  fabric.StaticCanvas.prototype.toJSON = fabric.StaticCanvas.prototype.toObject;\n\n  if (fabric.isLikelyNode) {\n    fabric.StaticCanvas.prototype.createPNGStream = function() {\n      var impl = getNodeCanvas(this.lowerCanvasEl);\n      return impl && impl.createPNGStream();\n    };\n    fabric.StaticCanvas.prototype.createJPEGStream = function(opts) {\n      var impl = getNodeCanvas(this.lowerCanvasEl);\n      return impl && impl.createJPEGStream(opts);\n    };\n  }\n})();\n\n\n/**\n * BaseBrush class\n * @class fabric.BaseBrush\n * @see {@link http://fabricjs.com/freedrawing|Freedrawing demo}\n */\nfabric.BaseBrush = fabric.util.createClass(/** @lends fabric.BaseBrush.prototype */ {\n\n  /**\n   * Color of a brush\n   * @type String\n   * @default\n   */\n  color: 'rgb(0, 0, 0)',\n\n  /**\n   * Width of a brush, has to be a Number, no string literals\n   * @type Number\n   * @default\n   */\n  width: 1,\n\n  /**\n   * Shadow object representing shadow of this shape.\n   * <b>Backwards incompatibility note:</b> This property replaces \"shadowColor\" (String), \"shadowOffsetX\" (Number),\n   * \"shadowOffsetY\" (Number) and \"shadowBlur\" (Number) since v1.2.12\n   * @type fabric.Shadow\n   * @default\n   */\n  shadow: null,\n\n  /**\n   * Line endings style of a brush (one of \"butt\", \"round\", \"square\")\n   * @type String\n   * @default\n   */\n  strokeLineCap: 'round',\n\n  /**\n   * Corner style of a brush (one of \"bevel\", \"round\", \"miter\")\n   * @type String\n   * @default\n   */\n  strokeLineJoin: 'round',\n\n  /**\n   * Maximum miter length (used for strokeLineJoin = \"miter\") of a brush's\n   * @type Number\n   * @default\n   */\n  strokeMiterLimit:         10,\n\n  /**\n   * Stroke Dash Array.\n   * @type Array\n   * @default\n   */\n  strokeDashArray: null,\n\n  /**\n   * When `true`, the free drawing is limited to the whiteboard size. Default to false.\n   * @type Boolean\n   * @default false\n  */\n\n  limitedToCanvasSize: false,\n\n\n  /**\n   * Sets brush styles\n   * @private\n   * @param {CanvasRenderingContext2D} ctx\n   */\n  _setBrushStyles: function (ctx) {\n    ctx.strokeStyle = this.color;\n    ctx.lineWidth = this.width;\n    ctx.lineCap = this.strokeLineCap;\n    ctx.miterLimit = this.strokeMiterLimit;\n    ctx.lineJoin = this.strokeLineJoin;\n    ctx.setLineDash(this.strokeDashArray || []);\n  },\n\n  /**\n   * Sets the transformation on given context\n   * @param {RenderingContext2d} ctx context to render on\n   * @private\n   */\n  _saveAndTransform: function(ctx) {\n    var v = this.canvas.viewportTransform;\n    ctx.save();\n    ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n  },\n\n  /**\n   * Sets brush shadow styles\n   * @private\n   */\n  _setShadow: function() {\n    if (!this.shadow) {\n      return;\n    }\n\n    var canvas = this.canvas,\n        shadow = this.shadow,\n        ctx = canvas.contextTop,\n        zoom = canvas.getZoom();\n    if (canvas && canvas._isRetinaScaling()) {\n      zoom *= fabric.devicePixelRatio;\n    }\n\n    ctx.shadowColor = shadow.color;\n    ctx.shadowBlur = shadow.blur * zoom;\n    ctx.shadowOffsetX = shadow.offsetX * zoom;\n    ctx.shadowOffsetY = shadow.offsetY * zoom;\n  },\n\n  needsFullRender: function() {\n    var color = new fabric.Color(this.color);\n    return color.getAlpha() < 1 || !!this.shadow;\n  },\n\n  /**\n   * Removes brush shadow styles\n   * @private\n   */\n  _resetShadow: function() {\n    var ctx = this.canvas.contextTop;\n\n    ctx.shadowColor = '';\n    ctx.shadowBlur = ctx.shadowOffsetX = ctx.shadowOffsetY = 0;\n  },\n\n  /**\n   * Check is pointer is outside canvas boundaries\n   * @param {Object} pointer\n   * @private\n  */\n  _isOutSideCanvas: function(pointer) {\n    return pointer.x < 0 || pointer.x > this.canvas.getWidth() || pointer.y < 0 || pointer.y > this.canvas.getHeight();\n  }\n});\n\n\n(function() {\n  /**\n   * PencilBrush class\n   * @class fabric.PencilBrush\n   * @extends fabric.BaseBrush\n   */\n  fabric.PencilBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.PencilBrush.prototype */ {\n\n    /**\n     * Discard points that are less than `decimate` pixel distant from each other\n     * @type Number\n     * @default 0.4\n     */\n    decimate: 0.4,\n\n    /**\n     * Draws a straight line between last recorded point to current pointer\n     * Used for `shift` functionality\n     *\n     * @type boolean\n     * @default false\n     */\n    drawStraightLine: false,\n\n    /**\n     * The event modifier key that makes the brush draw a straight line.\n     * If `null` or 'none' or any other string that is not a modifier key the feature is disabled.\n     * @type {'altKey' | 'shiftKey' | 'ctrlKey' | 'none' | undefined | null}\n     */\n    straightLineKey: 'shiftKey',\n\n    /**\n     * Constructor\n     * @param {fabric.Canvas} canvas\n     * @return {fabric.PencilBrush} Instance of a pencil brush\n     */\n    initialize: function(canvas) {\n      this.canvas = canvas;\n      this._points = [];\n    },\n\n    needsFullRender: function () {\n      return this.callSuper('needsFullRender') || this._hasStraightLine;\n    },\n\n    /**\n     * Invoked inside on mouse down and mouse move\n     * @param {Object} pointer\n     */\n    _drawSegment: function (ctx, p1, p2) {\n      var midPoint = p1.midPointFrom(p2);\n      ctx.quadraticCurveTo(p1.x, p1.y, midPoint.x, midPoint.y);\n      return midPoint;\n    },\n\n    /**\n     * Invoked on mouse down\n     * @param {Object} pointer\n     */\n    onMouseDown: function(pointer, options) {\n      if (!this.canvas._isMainEvent(options.e)) {\n        return;\n      }\n      this.drawStraightLine = options.e[this.straightLineKey];\n      this._prepareForDrawing(pointer);\n      // capture coordinates immediately\n      // this allows to draw dots (when movement never occurs)\n      this._captureDrawingPath(pointer);\n      this._render();\n    },\n\n    /**\n     * Invoked on mouse move\n     * @param {Object} pointer\n     */\n    onMouseMove: function(pointer, options) {\n      if (!this.canvas._isMainEvent(options.e)) {\n        return;\n      }\n      this.drawStraightLine = options.e[this.straightLineKey];\n      if (this.limitedToCanvasSize === true && this._isOutSideCanvas(pointer)) {\n        return;\n      }\n      if (this._captureDrawingPath(pointer) && this._points.length > 1) {\n        if (this.needsFullRender()) {\n          // redraw curve\n          // clear top canvas\n          this.canvas.clearContext(this.canvas.contextTop);\n          this._render();\n        }\n        else {\n          var points = this._points, length = points.length, ctx = this.canvas.contextTop;\n          // draw the curve update\n          this._saveAndTransform(ctx);\n          if (this.oldEnd) {\n            ctx.beginPath();\n            ctx.moveTo(this.oldEnd.x, this.oldEnd.y);\n          }\n          this.oldEnd = this._drawSegment(ctx, points[length - 2], points[length - 1], true);\n          ctx.stroke();\n          ctx.restore();\n        }\n      }\n    },\n\n    /**\n     * Invoked on mouse up\n     */\n    onMouseUp: function(options) {\n      if (!this.canvas._isMainEvent(options.e)) {\n        return true;\n      }\n      this.drawStraightLine = false;\n      this.oldEnd = undefined;\n      this._finalizeAndAddPath();\n      return false;\n    },\n\n    /**\n     * @private\n     * @param {Object} pointer Actual mouse position related to the canvas.\n     */\n    _prepareForDrawing: function(pointer) {\n\n      var p = new fabric.Point(pointer.x, pointer.y);\n\n      this._reset();\n      this._addPoint(p);\n      this.canvas.contextTop.moveTo(p.x, p.y);\n    },\n\n    /**\n     * @private\n     * @param {fabric.Point} point Point to be added to points array\n     */\n    _addPoint: function(point) {\n      if (this._points.length > 1 && point.eq(this._points[this._points.length - 1])) {\n        return false;\n      }\n      if (this.drawStraightLine && this._points.length > 1) {\n        this._hasStraightLine = true;\n        this._points.pop();\n      }\n      this._points.push(point);\n      return true;\n    },\n\n    /**\n     * Clear points array and set contextTop canvas style.\n     * @private\n     */\n    _reset: function() {\n      this._points = [];\n      this._setBrushStyles(this.canvas.contextTop);\n      this._setShadow();\n      this._hasStraightLine = false;\n    },\n\n    /**\n     * @private\n     * @param {Object} pointer Actual mouse position related to the canvas.\n     */\n    _captureDrawingPath: function(pointer) {\n      var pointerPoint = new fabric.Point(pointer.x, pointer.y);\n      return this._addPoint(pointerPoint);\n    },\n\n    /**\n     * Draw a smooth path on the topCanvas using quadraticCurveTo\n     * @private\n     * @param {CanvasRenderingContext2D} [ctx]\n     */\n    _render: function(ctx) {\n      var i, len,\n          p1 = this._points[0],\n          p2 = this._points[1];\n      ctx = ctx || this.canvas.contextTop;\n      this._saveAndTransform(ctx);\n      ctx.beginPath();\n      //if we only have 2 points in the path and they are the same\n      //it means that the user only clicked the canvas without moving the mouse\n      //then we should be drawing a dot. A path isn't drawn between two identical dots\n      //that's why we set them apart a bit\n      if (this._points.length === 2 && p1.x === p2.x && p1.y === p2.y) {\n        var width = this.width / 1000;\n        p1 = new fabric.Point(p1.x, p1.y);\n        p2 = new fabric.Point(p2.x, p2.y);\n        p1.x -= width;\n        p2.x += width;\n      }\n      ctx.moveTo(p1.x, p1.y);\n\n      for (i = 1, len = this._points.length; i < len; i++) {\n        // we pick the point between pi + 1 & pi + 2 as the\n        // end point and p1 as our control point.\n        this._drawSegment(ctx, p1, p2);\n        p1 = this._points[i];\n        p2 = this._points[i + 1];\n      }\n      // Draw last line as a straight line while\n      // we wait for the next point to be able to calculate\n      // the bezier control point\n      ctx.lineTo(p1.x, p1.y);\n      ctx.stroke();\n      ctx.restore();\n    },\n\n    /**\n     * Converts points to SVG path\n     * @param {Array} points Array of points\n     * @return {(string|number)[][]} SVG path commands\n     */\n    convertPointsToSVGPath: function (points) {\n      var correction = this.width / 1000;\n      return fabric.util.getSmoothPathFromPoints(points, correction);\n    },\n\n    /**\n     * @private\n     * @param {(string|number)[][]} pathData SVG path commands\n     * @returns {boolean}\n     */\n    _isEmptySVGPath: function (pathData) {\n      var pathString = fabric.util.joinPath(pathData);\n      return pathString === 'M 0 0 Q 0 0 0 0 L 0 0';\n    },\n\n    /**\n     * Creates fabric.Path object to add on canvas\n     * @param {(string|number)[][]} pathData Path data\n     * @return {fabric.Path} Path to add on canvas\n     */\n    createPath: function(pathData) {\n      var path = new fabric.Path(pathData, {\n        fill: null,\n        stroke: this.color,\n        strokeWidth: this.width,\n        strokeLineCap: this.strokeLineCap,\n        strokeMiterLimit: this.strokeMiterLimit,\n        strokeLineJoin: this.strokeLineJoin,\n        strokeDashArray: this.strokeDashArray,\n      });\n      if (this.shadow) {\n        this.shadow.affectStroke = true;\n        path.shadow = new fabric.Shadow(this.shadow);\n      }\n\n      return path;\n    },\n\n    /**\n     * Decimate points array with the decimate value\n     */\n    decimatePoints: function(points, distance) {\n      if (points.length <= 2) {\n        return points;\n      }\n      var zoom = this.canvas.getZoom(), adjustedDistance = Math.pow(distance / zoom, 2),\n          i, l = points.length - 1, lastPoint = points[0], newPoints = [lastPoint],\n          cDistance;\n      for (i = 1; i < l - 1; i++) {\n        cDistance = Math.pow(lastPoint.x - points[i].x, 2) + Math.pow(lastPoint.y - points[i].y, 2);\n        if (cDistance >= adjustedDistance) {\n          lastPoint = points[i];\n          newPoints.push(lastPoint);\n        }\n      }\n      /**\n       * Add the last point from the original line to the end of the array.\n       * This ensures decimate doesn't delete the last point on the line, and ensures the line is > 1 point.\n       */\n      newPoints.push(points[l]);\n      return newPoints;\n    },\n\n    /**\n     * On mouseup after drawing the path on contextTop canvas\n     * we use the points captured to create an new fabric path object\n     * and add it to the fabric canvas.\n     */\n    _finalizeAndAddPath: function() {\n      var ctx = this.canvas.contextTop;\n      ctx.closePath();\n      if (this.decimate) {\n        this._points = this.decimatePoints(this._points, this.decimate);\n      }\n      var pathData = this.convertPointsToSVGPath(this._points);\n      if (this._isEmptySVGPath(pathData)) {\n        // do not create 0 width/height paths, as they are\n        // rendered inconsistently across browsers\n        // Firefox 4, for example, renders a dot,\n        // whereas Chrome 10 renders nothing\n        this.canvas.requestRenderAll();\n        return;\n      }\n\n      var path = this.createPath(pathData);\n      this.canvas.clearContext(this.canvas.contextTop);\n      this.canvas.fire('before:path:created', { path: path });\n      this.canvas.add(path);\n      this.canvas.requestRenderAll();\n      path.setCoords();\n      this._resetShadow();\n\n\n      // fire event 'path' created\n      this.canvas.fire('path:created', { path: path });\n    }\n  });\n})();\n\n\n/**\n * CircleBrush class\n * @class fabric.CircleBrush\n */\nfabric.CircleBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.CircleBrush.prototype */ {\n\n  /**\n   * Width of a brush\n   * @type Number\n   * @default\n   */\n  width: 10,\n\n  /**\n   * Constructor\n   * @param {fabric.Canvas} canvas\n   * @return {fabric.CircleBrush} Instance of a circle brush\n   */\n  initialize: function(canvas) {\n    this.canvas = canvas;\n    this.points = [];\n  },\n\n  /**\n   * Invoked inside on mouse down and mouse move\n   * @param {Object} pointer\n   */\n  drawDot: function(pointer) {\n    var point = this.addPoint(pointer),\n        ctx = this.canvas.contextTop;\n    this._saveAndTransform(ctx);\n    this.dot(ctx, point);\n    ctx.restore();\n  },\n\n  dot: function(ctx, point) {\n    ctx.fillStyle = point.fill;\n    ctx.beginPath();\n    ctx.arc(point.x, point.y, point.radius, 0, Math.PI * 2, false);\n    ctx.closePath();\n    ctx.fill();\n  },\n\n  /**\n   * Invoked on mouse down\n   */\n  onMouseDown: function(pointer) {\n    this.points.length = 0;\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._setShadow();\n    this.drawDot(pointer);\n  },\n\n  /**\n   * Render the full state of the brush\n   * @private\n   */\n  _render: function() {\n    var ctx  = this.canvas.contextTop, i, len,\n        points = this.points;\n    this._saveAndTransform(ctx);\n    for (i = 0, len = points.length; i < len; i++) {\n      this.dot(ctx, points[i]);\n    }\n    ctx.restore();\n  },\n\n  /**\n   * Invoked on mouse move\n   * @param {Object} pointer\n   */\n  onMouseMove: function(pointer) {\n    if (this.limitedToCanvasSize === true && this._isOutSideCanvas(pointer)) {\n      return;\n    }\n    if (this.needsFullRender()) {\n      this.canvas.clearContext(this.canvas.contextTop);\n      this.addPoint(pointer);\n      this._render();\n    }\n    else {\n      this.drawDot(pointer);\n    }\n  },\n\n  /**\n   * Invoked on mouse up\n   */\n  onMouseUp: function() {\n    var originalRenderOnAddRemove = this.canvas.renderOnAddRemove, i, len;\n    this.canvas.renderOnAddRemove = false;\n\n    var circles = [];\n\n    for (i = 0, len = this.points.length; i < len; i++) {\n      var point = this.points[i],\n          circle = new fabric.Circle({\n            radius: point.radius,\n            left: point.x,\n            top: point.y,\n            originX: 'center',\n            originY: 'center',\n            fill: point.fill\n          });\n\n      this.shadow && (circle.shadow = new fabric.Shadow(this.shadow));\n\n      circles.push(circle);\n    }\n    var group = new fabric.Group(circles);\n    group.canvas = this.canvas;\n\n    this.canvas.fire('before:path:created', { path: group });\n    this.canvas.add(group);\n    this.canvas.fire('path:created', { path: group });\n\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._resetShadow();\n    this.canvas.renderOnAddRemove = originalRenderOnAddRemove;\n    this.canvas.requestRenderAll();\n  },\n\n  /**\n   * @param {Object} pointer\n   * @return {fabric.Point} Just added pointer point\n   */\n  addPoint: function(pointer) {\n    var pointerPoint = new fabric.Point(pointer.x, pointer.y),\n\n        circleRadius = fabric.util.getRandomInt(\n          Math.max(0, this.width - 20), this.width + 20) / 2,\n\n        circleColor = new fabric.Color(this.color)\n          .setAlpha(fabric.util.getRandomInt(0, 100) / 100)\n          .toRgba();\n\n    pointerPoint.radius = circleRadius;\n    pointerPoint.fill = circleColor;\n\n    this.points.push(pointerPoint);\n\n    return pointerPoint;\n  }\n});\n\n\n/**\n * SprayBrush class\n * @class fabric.SprayBrush\n */\nfabric.SprayBrush = fabric.util.createClass( fabric.BaseBrush, /** @lends fabric.SprayBrush.prototype */ {\n\n  /**\n   * Width of a spray\n   * @type Number\n   * @default\n   */\n  width:              10,\n\n  /**\n   * Density of a spray (number of dots per chunk)\n   * @type Number\n   * @default\n   */\n  density:            20,\n\n  /**\n   * Width of spray dots\n   * @type Number\n   * @default\n   */\n  dotWidth:           1,\n\n  /**\n   * Width variance of spray dots\n   * @type Number\n   * @default\n   */\n  dotWidthVariance:   1,\n\n  /**\n   * Whether opacity of a dot should be random\n   * @type Boolean\n   * @default\n   */\n  randomOpacity:        false,\n\n  /**\n   * Whether overlapping dots (rectangles) should be removed (for performance reasons)\n   * @type Boolean\n   * @default\n   */\n  optimizeOverlapping:  true,\n\n  /**\n   * Constructor\n   * @param {fabric.Canvas} canvas\n   * @return {fabric.SprayBrush} Instance of a spray brush\n   */\n  initialize: function(canvas) {\n    this.canvas = canvas;\n    this.sprayChunks = [];\n  },\n\n  /**\n   * Invoked on mouse down\n   * @param {Object} pointer\n   */\n  onMouseDown: function(pointer) {\n    this.sprayChunks.length = 0;\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._setShadow();\n\n    this.addSprayChunk(pointer);\n    this.render(this.sprayChunkPoints);\n  },\n\n  /**\n   * Invoked on mouse move\n   * @param {Object} pointer\n   */\n  onMouseMove: function(pointer) {\n    if (this.limitedToCanvasSize === true && this._isOutSideCanvas(pointer)) {\n      return;\n    }\n    this.addSprayChunk(pointer);\n    this.render(this.sprayChunkPoints);\n  },\n\n  /**\n   * Invoked on mouse up\n   */\n  onMouseUp: function() {\n    var originalRenderOnAddRemove = this.canvas.renderOnAddRemove;\n    this.canvas.renderOnAddRemove = false;\n\n    var rects = [];\n\n    for (var i = 0, ilen = this.sprayChunks.length; i < ilen; i++) {\n      var sprayChunk = this.sprayChunks[i];\n\n      for (var j = 0, jlen = sprayChunk.length; j < jlen; j++) {\n\n        var rect = new fabric.Rect({\n          width: sprayChunk[j].width,\n          height: sprayChunk[j].width,\n          left: sprayChunk[j].x + 1,\n          top: sprayChunk[j].y + 1,\n          originX: 'center',\n          originY: 'center',\n          fill: this.color\n        });\n        rects.push(rect);\n      }\n    }\n\n    if (this.optimizeOverlapping) {\n      rects = this._getOptimizedRects(rects);\n    }\n\n    var group = new fabric.Group(rects);\n    this.shadow && group.set('shadow', new fabric.Shadow(this.shadow));\n    this.canvas.fire('before:path:created', { path: group });\n    this.canvas.add(group);\n    this.canvas.fire('path:created', { path: group });\n\n    this.canvas.clearContext(this.canvas.contextTop);\n    this._resetShadow();\n    this.canvas.renderOnAddRemove = originalRenderOnAddRemove;\n    this.canvas.requestRenderAll();\n  },\n\n  /**\n   * @private\n   * @param {Array} rects\n   */\n  _getOptimizedRects: function(rects) {\n\n    // avoid creating duplicate rects at the same coordinates\n    var uniqueRects = { }, key, i, len;\n\n    for (i = 0, len = rects.length; i < len; i++) {\n      key = rects[i].left + '' + rects[i].top;\n      if (!uniqueRects[key]) {\n        uniqueRects[key] = rects[i];\n      }\n    }\n    var uniqueRectsArray = [];\n    for (key in uniqueRects) {\n      uniqueRectsArray.push(uniqueRects[key]);\n    }\n\n    return uniqueRectsArray;\n  },\n\n  /**\n   * Render new chunk of spray brush\n   */\n  render: function(sprayChunk) {\n    var ctx = this.canvas.contextTop, i, len;\n    ctx.fillStyle = this.color;\n\n    this._saveAndTransform(ctx);\n\n    for (i = 0, len = sprayChunk.length; i < len; i++) {\n      var point = sprayChunk[i];\n      if (typeof point.opacity !== 'undefined') {\n        ctx.globalAlpha = point.opacity;\n      }\n      ctx.fillRect(point.x, point.y, point.width, point.width);\n    }\n    ctx.restore();\n  },\n\n  /**\n   * Render all spray chunks\n   */\n  _render: function() {\n    var ctx = this.canvas.contextTop, i, ilen;\n    ctx.fillStyle = this.color;\n\n    this._saveAndTransform(ctx);\n\n    for (i = 0, ilen = this.sprayChunks.length; i < ilen; i++) {\n      this.render(this.sprayChunks[i]);\n    }\n    ctx.restore();\n  },\n\n  /**\n   * @param {Object} pointer\n   */\n  addSprayChunk: function(pointer) {\n    this.sprayChunkPoints = [];\n\n    var x, y, width, radius = this.width / 2, i;\n\n    for (i = 0; i < this.density; i++) {\n\n      x = fabric.util.getRandomInt(pointer.x - radius, pointer.x + radius);\n      y = fabric.util.getRandomInt(pointer.y - radius, pointer.y + radius);\n\n      if (this.dotWidthVariance) {\n        width = fabric.util.getRandomInt(\n          // bottom clamp width to 1\n          Math.max(1, this.dotWidth - this.dotWidthVariance),\n          this.dotWidth + this.dotWidthVariance);\n      }\n      else {\n        width = this.dotWidth;\n      }\n\n      var point = new fabric.Point(x, y);\n      point.width = width;\n\n      if (this.randomOpacity) {\n        point.opacity = fabric.util.getRandomInt(0, 100) / 100;\n      }\n\n      this.sprayChunkPoints.push(point);\n    }\n\n    this.sprayChunks.push(this.sprayChunkPoints);\n  }\n});\n\n\n/**\n * PatternBrush class\n * @class fabric.PatternBrush\n * @extends fabric.BaseBrush\n */\nfabric.PatternBrush = fabric.util.createClass(fabric.PencilBrush, /** @lends fabric.PatternBrush.prototype */ {\n\n  getPatternSrc: function() {\n\n    var dotWidth = 20,\n        dotDistance = 5,\n        patternCanvas = fabric.util.createCanvasElement(),\n        patternCtx = patternCanvas.getContext('2d');\n\n    patternCanvas.width = patternCanvas.height = dotWidth + dotDistance;\n\n    patternCtx.fillStyle = this.color;\n    patternCtx.beginPath();\n    patternCtx.arc(dotWidth / 2, dotWidth / 2, dotWidth / 2, 0, Math.PI * 2, false);\n    patternCtx.closePath();\n    patternCtx.fill();\n\n    return patternCanvas;\n  },\n\n  getPatternSrcFunction: function() {\n    return String(this.getPatternSrc).replace('this.color', '\"' + this.color + '\"');\n  },\n\n  /**\n   * Creates \"pattern\" instance property\n   * @param {CanvasRenderingContext2D} ctx\n   */\n  getPattern: function(ctx) {\n    return ctx.createPattern(this.source || this.getPatternSrc(), 'repeat');\n  },\n\n  /**\n   * Sets brush styles\n   * @param {CanvasRenderingContext2D} ctx\n   */\n  _setBrushStyles: function(ctx) {\n    this.callSuper('_setBrushStyles', ctx);\n    ctx.strokeStyle = this.getPattern(ctx);\n  },\n\n  /**\n   * Creates path\n   */\n  createPath: function(pathData) {\n    var path = this.callSuper('createPath', pathData),\n        topLeft = path._getLeftTopCoords().scalarAdd(path.strokeWidth / 2);\n\n    path.stroke = new fabric.Pattern({\n      source: this.source || this.getPatternSrcFunction(),\n      offsetX: -topLeft.x,\n      offsetY: -topLeft.y\n    });\n    return path;\n  }\n});\n\n\n(function() {\n\n  var getPointer = fabric.util.getPointer,\n      degreesToRadians = fabric.util.degreesToRadians,\n      isTouchEvent = fabric.util.isTouchEvent;\n\n  /**\n   * Canvas class\n   * @class fabric.Canvas\n   * @extends fabric.StaticCanvas\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#canvas}\n   * @see {@link fabric.Canvas#initialize} for constructor definition\n   *\n   * @fires object:modified at the end of a transform or any change when statefull is true\n   * @fires object:rotating while an object is being rotated from the control\n   * @fires object:scaling while an object is being scaled by controls\n   * @fires object:moving while an object is being dragged\n   * @fires object:skewing while an object is being skewed from the controls\n   *\n   * @fires before:transform before a transform is is started\n   * @fires before:selection:cleared\n   * @fires selection:cleared\n   * @fires selection:updated\n   * @fires selection:created\n   *\n   * @fires path:created after a drawing operation ends and the path is added\n   * @fires mouse:down\n   * @fires mouse:move\n   * @fires mouse:up\n   * @fires mouse:down:before  on mouse down, before the inner fabric logic runs\n   * @fires mouse:move:before on mouse move, before the inner fabric logic runs\n   * @fires mouse:up:before on mouse up, before the inner fabric logic runs\n   * @fires mouse:over\n   * @fires mouse:out\n   * @fires mouse:dblclick whenever a native dbl click event fires on the canvas.\n   *\n   * @fires dragover\n   * @fires dragenter\n   * @fires dragleave\n   * @fires drop:before before drop event. same native event. This is added to handle edge cases\n   * @fires drop\n   * @fires after:render at the end of the render process, receives the context in the callback\n   * @fires before:render at start the render process, receives the context in the callback\n   *\n   */\n  fabric.Canvas = fabric.util.createClass(fabric.StaticCanvas, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * Constructor\n     * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(el, options) {\n      options || (options = { });\n      this.renderAndResetBound = this.renderAndReset.bind(this);\n      this.requestRenderAllBound = this.requestRenderAll.bind(this);\n      this._initStatic(el, options);\n      this._initInteractive();\n      this._createCacheCanvas();\n    },\n\n    /**\n     * When true, objects can be transformed by one side (unproportionally)\n     * when dragged on the corners that normally would not do that.\n     * @type Boolean\n     * @default\n     * @since fabric 4.0 // changed name and default value\n     */\n    uniformScaling:      true,\n\n    /**\n     * Indicates which key switches uniform scaling.\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled.\n     * totally wrong named. this sounds like `uniform scaling`\n     * if Canvas.uniformScaling is true, pressing this will set it to false\n     * and viceversa.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    uniScaleKey:           'shiftKey',\n\n    /**\n     * When true, objects use center point as the origin of scale transformation.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredScaling:        false,\n\n    /**\n     * When true, objects use center point as the origin of rotate transformation.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredRotation:       false,\n\n    /**\n     * Indicates which key enable centered Transform\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    centeredKey:           'altKey',\n\n    /**\n     * Indicates which key enable alternate action on corner\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled feature disabled.\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    altActionKey:           'shiftKey',\n\n    /**\n     * Indicates that canvas is interactive. This property should not be changed.\n     * @type Boolean\n     * @default\n     */\n    interactive:            true,\n\n    /**\n     * Indicates whether group selection should be enabled\n     * @type Boolean\n     * @default\n     */\n    selection:              true,\n\n    /**\n     * Indicates which key or keys enable multiple click selection\n     * Pass value as a string or array of strings\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * If `null` or empty or containing any other string that is not a modifier key\n     * feature is disabled.\n     * @since 1.6.2\n     * @type String|Array\n     * @default\n     */\n    selectionKey:           'shiftKey',\n\n    /**\n     * Indicates which key enable alternative selection\n     * in case of target overlapping with active object\n     * values: 'altKey', 'shiftKey', 'ctrlKey'.\n     * For a series of reason that come from the general expectations on how\n     * things should work, this feature works only for preserveObjectStacking true.\n     * If `null` or 'none' or any other string that is not a modifier key\n     * feature is disabled.\n     * @since 1.6.5\n     * @type null|String\n     * @default\n     */\n    altSelectionKey:           null,\n\n    /**\n     * Color of selection\n     * @type String\n     * @default\n     */\n    selectionColor:         'rgba(100, 100, 255, 0.3)', // blue\n\n    /**\n     * Default dash array pattern\n     * If not empty the selection border is dashed\n     * @type Array\n     */\n    selectionDashArray:     [],\n\n    /**\n     * Color of the border of selection (usually slightly darker than color of selection itself)\n     * @type String\n     * @default\n     */\n    selectionBorderColor:   'rgba(255, 255, 255, 0.3)',\n\n    /**\n     * Width of a line used in object/group selection\n     * @type Number\n     * @default\n     */\n    selectionLineWidth:     1,\n\n    /**\n     * Select only shapes that are fully contained in the dragged selection rectangle.\n     * @type Boolean\n     * @default\n     */\n    selectionFullyContained: false,\n\n    /**\n     * Default cursor value used when hovering over an object on canvas\n     * @type String\n     * @default\n     */\n    hoverCursor:            'move',\n\n    /**\n     * Default cursor value used when moving an object on canvas\n     * @type String\n     * @default\n     */\n    moveCursor:             'move',\n\n    /**\n     * Default cursor value used for the entire canvas\n     * @type String\n     * @default\n     */\n    defaultCursor:          'default',\n\n    /**\n     * Cursor value used during free drawing\n     * @type String\n     * @default\n     */\n    freeDrawingCursor:      'crosshair',\n\n    /**\n     * Cursor value used for disabled elements ( corners with disabled action )\n     * @type String\n     * @since 2.0.0\n     * @default\n     */\n    notAllowedCursor:         'not-allowed',\n\n    /**\n     * Default element class that's given to wrapper (div) element of canvas\n     * @type String\n     * @default\n     */\n    containerClass:         'canvas-container',\n\n    /**\n     * When true, object detection happens on per-pixel basis rather than on per-bounding-box\n     * @type Boolean\n     * @default\n     */\n    perPixelTargetFind:     false,\n\n    /**\n     * Number of pixels around target pixel to tolerate (consider active) during object detection\n     * @type Number\n     * @default\n     */\n    targetFindTolerance:    0,\n\n    /**\n     * When true, target detection is skipped. Target detection will return always undefined.\n     * click selection won't work anymore, events will fire with no targets.\n     * if something is selected before setting it to true, it will be deselected at the first click.\n     * area selection will still work. check the `selection` property too.\n     * if you deactivate both, you should look into staticCanvas.\n     * @type Boolean\n     * @default\n     */\n    skipTargetFind:         false,\n\n    /**\n     * When true, mouse events on canvas (mousedown/mousemove/mouseup) result in free drawing.\n     * After mousedown, mousemove creates a shape,\n     * and then mouseup finalizes it and adds an instance of `fabric.Path` onto canvas.\n     * @tutorial {@link http://fabricjs.com/fabric-intro-part-4#free_drawing}\n     * @type Boolean\n     * @default\n     */\n    isDrawingMode:          false,\n\n    /**\n     * Indicates whether objects should remain in current stack position when selected.\n     * When false objects are brought to top and rendered as part of the selection group\n     * @type Boolean\n     * @default\n     */\n    preserveObjectStacking: false,\n\n    /**\n     * Indicates the angle that an object will lock to while rotating.\n     * @type Number\n     * @since 1.6.7\n     * @default\n     */\n    snapAngle: 0,\n\n    /**\n     * Indicates the distance from the snapAngle the rotation will lock to the snapAngle.\n     * When `null`, the snapThreshold will default to the snapAngle.\n     * @type null|Number\n     * @since 1.6.7\n     * @default\n     */\n    snapThreshold: null,\n\n    /**\n     * Indicates if the right click on canvas can output the context menu or not\n     * @type Boolean\n     * @since 1.6.5\n     * @default\n     */\n    stopContextMenu: false,\n\n    /**\n     * Indicates if the canvas can fire right click events\n     * @type Boolean\n     * @since 1.6.5\n     * @default\n     */\n    fireRightClick: false,\n\n    /**\n     * Indicates if the canvas can fire middle click events\n     * @type Boolean\n     * @since 1.7.8\n     * @default\n     */\n    fireMiddleClick: false,\n\n    /**\n     * Keep track of the subTargets for Mouse Events\n     * @type fabric.Object[]\n     */\n    targets: [],\n\n    /**\n     * When the option is enabled, PointerEvent is used instead of MouseEvent.\n     * @type Boolean\n     * @default\n     */\n    enablePointerEvents: false,\n\n    /**\n     * Keep track of the hovered target\n     * @type fabric.Object\n     * @private\n     */\n    _hoveredTarget: null,\n\n    /**\n     * hold the list of nested targets hovered\n     * @type fabric.Object[]\n     * @private\n     */\n    _hoveredTargets: [],\n\n    /**\n     * @private\n     */\n    _initInteractive: function() {\n      this._currentTransform = null;\n      this._groupSelector = null;\n      this._initWrapperElement();\n      this._createUpperCanvas();\n      this._initEventListeners();\n\n      this._initRetinaScaling();\n\n      this.freeDrawingBrush = fabric.PencilBrush && new fabric.PencilBrush(this);\n\n      this.calcOffset();\n    },\n\n    /**\n     * Divides objects in two groups, one to render immediately\n     * and one to render as activeGroup.\n     * @return {Array} objects to render immediately and pushes the other in the activeGroup.\n     */\n    _chooseObjectsToRender: function() {\n      var activeObjects = this.getActiveObjects(),\n          object, objsToRender, activeGroupObjects;\n\n      if (activeObjects.length > 0 && !this.preserveObjectStacking) {\n        objsToRender = [];\n        activeGroupObjects = [];\n        for (var i = 0, length = this._objects.length; i < length; i++) {\n          object = this._objects[i];\n          if (activeObjects.indexOf(object) === -1 ) {\n            objsToRender.push(object);\n          }\n          else {\n            activeGroupObjects.push(object);\n          }\n        }\n        if (activeObjects.length > 1) {\n          this._activeObject._objects = activeGroupObjects;\n        }\n        objsToRender.push.apply(objsToRender, activeGroupObjects);\n      }\n      else {\n        objsToRender = this._objects;\n      }\n      return objsToRender;\n    },\n\n    /**\n     * Renders both the top canvas and the secondary container canvas.\n     * @return {fabric.Canvas} instance\n     * @chainable\n     */\n    renderAll: function () {\n      if (this.contextTopDirty && !this._groupSelector && !this.isDrawingMode) {\n        this.clearContext(this.contextTop);\n        this.contextTopDirty = false;\n      }\n      if (this.hasLostContext) {\n        this.renderTopLayer(this.contextTop);\n        this.hasLostContext = false;\n      }\n      var canvasToDrawOn = this.contextContainer;\n      this.renderCanvas(canvasToDrawOn, this._chooseObjectsToRender());\n      return this;\n    },\n\n    renderTopLayer: function(ctx) {\n      ctx.save();\n      if (this.isDrawingMode && this._isCurrentlyDrawing) {\n        this.freeDrawingBrush && this.freeDrawingBrush._render();\n        this.contextTopDirty = true;\n      }\n      // we render the top context - last object\n      if (this.selection && this._groupSelector) {\n        this._drawSelection(ctx);\n        this.contextTopDirty = true;\n      }\n      ctx.restore();\n    },\n\n    /**\n     * Method to render only the top canvas.\n     * Also used to render the group selection box.\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    renderTop: function () {\n      var ctx = this.contextTop;\n      this.clearContext(ctx);\n      this.renderTopLayer(ctx);\n      this.fire('after:render');\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _normalizePointer: function (object, pointer) {\n      var m = object.calcTransformMatrix(),\n          invertedM = fabric.util.invertTransform(m),\n          vptPointer = this.restorePointerVpt(pointer);\n      return fabric.util.transformPoint(vptPointer, invertedM);\n    },\n\n    /**\n     * Returns true if object is transparent at a certain location\n     * @param {fabric.Object} target Object to check\n     * @param {Number} x Left coordinate\n     * @param {Number} y Top coordinate\n     * @return {Boolean}\n     */\n    isTargetTransparent: function (target, x, y) {\n      // in case the target is the activeObject, we cannot execute this optimization\n      // because we need to draw controls too.\n      if (target.shouldCache() && target._cacheCanvas && target !== this._activeObject) {\n        var normalizedPointer = this._normalizePointer(target, {x: x, y: y}),\n            targetRelativeX = Math.max(target.cacheTranslationX + (normalizedPointer.x * target.zoomX), 0),\n            targetRelativeY = Math.max(target.cacheTranslationY + (normalizedPointer.y * target.zoomY), 0);\n\n        var isTransparent = fabric.util.isTransparent(\n          target._cacheContext, Math.round(targetRelativeX), Math.round(targetRelativeY), this.targetFindTolerance);\n\n        return isTransparent;\n      }\n\n      var ctx = this.contextCache,\n          originalColor = target.selectionBackgroundColor, v = this.viewportTransform;\n\n      target.selectionBackgroundColor = '';\n\n      this.clearContext(ctx);\n\n      ctx.save();\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      target.render(ctx);\n      ctx.restore();\n\n      target.selectionBackgroundColor = originalColor;\n\n      var isTransparent = fabric.util.isTransparent(\n        ctx, x, y, this.targetFindTolerance);\n\n      return isTransparent;\n    },\n\n    /**\n     * takes an event and determines if selection key has been pressed\n     * @private\n     * @param {Event} e Event object\n     */\n    _isSelectionKeyPressed: function(e) {\n      var selectionKeyPressed = false;\n\n      if (Array.isArray(this.selectionKey)) {\n        selectionKeyPressed = !!this.selectionKey.find(function(key) { return e[key] === true; });\n      }\n      else {\n        selectionKeyPressed = e[this.selectionKey];\n      }\n\n      return selectionKeyPressed;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _shouldClearSelection: function (e, target) {\n      var activeObjects = this.getActiveObjects(),\n          activeObject = this._activeObject;\n\n      return (\n        !target\n        ||\n        (target &&\n          activeObject &&\n          activeObjects.length > 1 &&\n          activeObjects.indexOf(target) === -1 &&\n          activeObject !== target &&\n          !this._isSelectionKeyPressed(e))\n        ||\n        (target && !target.evented)\n        ||\n        (target &&\n          !target.selectable &&\n          activeObject &&\n          activeObject !== target)\n      );\n    },\n\n    /**\n     * centeredScaling from object can't override centeredScaling from canvas.\n     * this should be fixed, since object setting should take precedence over canvas.\n     * also this should be something that will be migrated in the control properties.\n     * as ability to define the origin of the transformation that the control provide.\n     * @private\n     * @param {fabric.Object} target\n     * @param {String} action\n     * @param {Boolean} altKey\n     */\n    _shouldCenterTransform: function (target, action, altKey) {\n      if (!target) {\n        return;\n      }\n\n      var centerTransform;\n\n      if (action === 'scale' || action === 'scaleX' || action === 'scaleY' || action === 'resizing') {\n        centerTransform = this.centeredScaling || target.centeredScaling;\n      }\n      else if (action === 'rotate') {\n        centerTransform = this.centeredRotation || target.centeredRotation;\n      }\n\n      return centerTransform ? !altKey : altKey;\n    },\n\n    /**\n     * should disappear before release 4.0\n     * @private\n     */\n    _getOriginFromCorner: function(target, corner) {\n      var origin = {\n        x: target.originX,\n        y: target.originY\n      };\n\n      if (corner === 'ml' || corner === 'tl' || corner === 'bl') {\n        origin.x = 'right';\n      }\n      else if (corner === 'mr' || corner === 'tr' || corner === 'br') {\n        origin.x = 'left';\n      }\n\n      if (corner === 'tl' || corner === 'mt' || corner === 'tr') {\n        origin.y = 'bottom';\n      }\n      else if (corner === 'bl' || corner === 'mb' || corner === 'br') {\n        origin.y = 'top';\n      }\n      return origin;\n    },\n\n    /**\n     * @private\n     * @param {Boolean} alreadySelected true if target is already selected\n     * @param {String} corner a string representing the corner ml, mr, tl ...\n     * @param {Event} e Event object\n     * @param {fabric.Object} [target] inserted back to help overriding. Unused\n     */\n    _getActionFromCorner: function(alreadySelected, corner, e, target) {\n      if (!corner || !alreadySelected) {\n        return 'drag';\n      }\n      var control = target.controls[corner];\n      return control.getActionName(e, control, target);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _setupCurrentTransform: function (e, target, alreadySelected) {\n      if (!target) {\n        return;\n      }\n\n      var pointer = this.getPointer(e), corner = target.__corner,\n          control = target.controls[corner],\n          actionHandler = (alreadySelected && corner) ?\n            control.getActionHandler(e, target, control) : fabric.controlsUtils.dragHandler,\n          action = this._getActionFromCorner(alreadySelected, corner, e, target),\n          origin = this._getOriginFromCorner(target, corner),\n          altKey = e[this.centeredKey],\n          transform = {\n            target: target,\n            action: action,\n            actionHandler: actionHandler,\n            corner: corner,\n            scaleX: target.scaleX,\n            scaleY: target.scaleY,\n            skewX: target.skewX,\n            skewY: target.skewY,\n            // used by transation\n            offsetX: pointer.x - target.left,\n            offsetY: pointer.y - target.top,\n            originX: origin.x,\n            originY: origin.y,\n            ex: pointer.x,\n            ey: pointer.y,\n            lastX: pointer.x,\n            lastY: pointer.y,\n            // unsure they are useful anymore.\n            // left: target.left,\n            // top: target.top,\n            theta: degreesToRadians(target.angle),\n            // end of unsure\n            width: target.width * target.scaleX,\n            shiftKey: e.shiftKey,\n            altKey: altKey,\n            original: fabric.util.saveObjectTransform(target),\n          };\n\n      if (this._shouldCenterTransform(target, action, altKey)) {\n        transform.originX = 'center';\n        transform.originY = 'center';\n      }\n      transform.original.originX = origin.x;\n      transform.original.originY = origin.y;\n      this._currentTransform = transform;\n      this._beforeTransform(e);\n    },\n\n    /**\n     * Set the cursor type of the canvas element\n     * @param {String} value Cursor type of the canvas element.\n     * @see http://www.w3.org/TR/css3-ui/#cursor\n     */\n    setCursor: function (value) {\n      this.upperCanvasEl.style.cursor = value;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx to draw the selection on\n     */\n    _drawSelection: function (ctx) {\n      var selector = this._groupSelector,\n          viewportStart = new fabric.Point(selector.ex, selector.ey),\n          start = fabric.util.transformPoint(viewportStart, this.viewportTransform),\n          viewportExtent = new fabric.Point(selector.ex + selector.left, selector.ey + selector.top),\n          extent = fabric.util.transformPoint(viewportExtent, this.viewportTransform),\n          minX = Math.min(start.x, extent.x),\n          minY = Math.min(start.y, extent.y),\n          maxX = Math.max(start.x, extent.x),\n          maxY = Math.max(start.y, extent.y),\n          strokeOffset = this.selectionLineWidth / 2;\n\n      if (this.selectionColor) {\n        ctx.fillStyle = this.selectionColor;\n        ctx.fillRect(minX, minY, maxX - minX, maxY - minY);\n      }\n\n      if (!this.selectionLineWidth || !this.selectionBorderColor) {\n        return;\n      }\n      ctx.lineWidth = this.selectionLineWidth;\n      ctx.strokeStyle = this.selectionBorderColor;\n\n      minX += strokeOffset;\n      minY += strokeOffset;\n      maxX -= strokeOffset;\n      maxY -= strokeOffset;\n      // selection border\n      fabric.Object.prototype._setLineDash.call(this, ctx, this.selectionDashArray);\n      ctx.strokeRect(minX, minY, maxX - minX, maxY - minY);\n    },\n\n    /**\n     * Method that determines what object we are clicking on\n     * the skipGroup parameter is for internal use, is needed for shift+click action\n     * 11/09/2018 TODO: would be cool if findTarget could discern between being a full target\n     * or the outside part of the corner.\n     * @param {Event} e mouse event\n     * @param {Boolean} skipGroup when true, activeGroup is skipped and only objects are traversed through\n     * @return {fabric.Object} the target found\n     */\n    findTarget: function (e, skipGroup) {\n      if (this.skipTargetFind) {\n        return;\n      }\n\n      var ignoreZoom = true,\n          pointer = this.getPointer(e, ignoreZoom),\n          activeObject = this._activeObject,\n          aObjects = this.getActiveObjects(),\n          activeTarget, activeTargetSubs,\n          isTouch = isTouchEvent(e),\n          shouldLookForActive = (aObjects.length > 1 && !skipGroup) || aObjects.length === 1;\n\n      // first check current group (if one exists)\n      // active group does not check sub targets like normal groups.\n      // if active group just exits.\n      this.targets = [];\n\n      // if we hit the corner of an activeObject, let's return that.\n      if (shouldLookForActive && activeObject._findTargetCorner(pointer, isTouch)) {\n        return activeObject;\n      }\n      if (aObjects.length > 1 && !skipGroup && activeObject === this._searchPossibleTargets([activeObject], pointer)) {\n        return activeObject;\n      }\n      if (aObjects.length === 1 &&\n        activeObject === this._searchPossibleTargets([activeObject], pointer)) {\n        if (!this.preserveObjectStacking) {\n          return activeObject;\n        }\n        else {\n          activeTarget = activeObject;\n          activeTargetSubs = this.targets;\n          this.targets = [];\n        }\n      }\n      var target = this._searchPossibleTargets(this._objects, pointer);\n      if (e[this.altSelectionKey] && target && activeTarget && target !== activeTarget) {\n        target = activeTarget;\n        this.targets = activeTargetSubs;\n      }\n      return target;\n    },\n\n    /**\n     * Checks point is inside the object.\n     * @param {Object} [pointer] x,y object of point coordinates we want to check.\n     * @param {fabric.Object} obj Object to test against\n     * @param {Object} [globalPointer] x,y object of point coordinates relative to canvas used to search per pixel target.\n     * @return {Boolean} true if point is contained within an area of given object\n     * @private\n     */\n    _checkTarget: function(pointer, obj, globalPointer) {\n      if (obj &&\n          obj.visible &&\n          obj.evented &&\n          // http://www.geog.ubc.ca/courses/klink/gis.notes/ncgia/u32.html\n          // http://idav.ucdavis.edu/~okreylos/TAship/Spring2000/PointInPolygon.html\n          obj.containsPoint(pointer)\n      ) {\n        if ((this.perPixelTargetFind || obj.perPixelTargetFind) && !obj.isEditing) {\n          var isTransparent = this.isTargetTransparent(obj, globalPointer.x, globalPointer.y);\n          if (!isTransparent) {\n            return true;\n          }\n        }\n        else {\n          return true;\n        }\n      }\n    },\n\n    /**\n     * Function used to search inside objects an object that contains pointer in bounding box or that contains pointerOnCanvas when painted\n     * @param {Array} [objects] objects array to look into\n     * @param {Object} [pointer] x,y object of point coordinates we want to check.\n     * @return {fabric.Object} object that contains pointer\n     * @private\n     */\n    _searchPossibleTargets: function(objects, pointer) {\n      // Cache all targets where their bounding box contains point.\n      var target, i = objects.length, subTarget;\n      // Do not check for currently grouped objects, since we check the parent group itself.\n      // until we call this function specifically to search inside the activeGroup\n      while (i--) {\n        var objToCheck = objects[i];\n        var pointerToUse = objToCheck.group ?\n          this._normalizePointer(objToCheck.group, pointer) : pointer;\n        if (this._checkTarget(pointerToUse, objToCheck, pointer)) {\n          target = objects[i];\n          if (target.subTargetCheck && target instanceof fabric.Group) {\n            subTarget = this._searchPossibleTargets(target._objects, pointer);\n            subTarget && this.targets.push(subTarget);\n          }\n          break;\n        }\n      }\n      return target;\n    },\n\n    /**\n     * Returns pointer coordinates without the effect of the viewport\n     * @param {Object} pointer with \"x\" and \"y\" number values\n     * @return {Object} object with \"x\" and \"y\" number values\n     */\n    restorePointerVpt: function(pointer) {\n      return fabric.util.transformPoint(\n        pointer,\n        fabric.util.invertTransform(this.viewportTransform)\n      );\n    },\n\n    /**\n     * Returns pointer coordinates relative to canvas.\n     * Can return coordinates with or without viewportTransform.\n     * ignoreZoom false gives back coordinates that represent\n     * the point clicked on canvas element.\n     * ignoreZoom true gives back coordinates after being processed\n     * by the viewportTransform ( sort of coordinates of what is displayed\n     * on the canvas where you are clicking.\n     * ignoreZoom true = HTMLElement coordinates relative to top,left\n     * ignoreZoom false, default = fabric space coordinates, the same used for shape position\n     * To interact with your shapes top and left you want to use ignoreZoom true\n     * most of the time, while ignoreZoom false will give you coordinates\n     * compatible with the object.oCoords system.\n     * of the time.\n     * @param {Event} e\n     * @param {Boolean} ignoreZoom\n     * @return {Object} object with \"x\" and \"y\" number values\n     */\n    getPointer: function (e, ignoreZoom) {\n      // return cached values if we are in the event processing chain\n      if (this._absolutePointer && !ignoreZoom) {\n        return this._absolutePointer;\n      }\n      if (this._pointer && ignoreZoom) {\n        return this._pointer;\n      }\n\n      var pointer = getPointer(e),\n          upperCanvasEl = this.upperCanvasEl,\n          bounds = upperCanvasEl.getBoundingClientRect(),\n          boundsWidth = bounds.width || 0,\n          boundsHeight = bounds.height || 0,\n          cssScale;\n\n      if (!boundsWidth || !boundsHeight ) {\n        if ('top' in bounds && 'bottom' in bounds) {\n          boundsHeight = Math.abs( bounds.top - bounds.bottom );\n        }\n        if ('right' in bounds && 'left' in bounds) {\n          boundsWidth = Math.abs( bounds.right - bounds.left );\n        }\n      }\n\n      this.calcOffset();\n      pointer.x = pointer.x - this._offset.left;\n      pointer.y = pointer.y - this._offset.top;\n      if (!ignoreZoom) {\n        pointer = this.restorePointerVpt(pointer);\n      }\n\n      var retinaScaling = this.getRetinaScaling();\n      if (retinaScaling !== 1) {\n        pointer.x /= retinaScaling;\n        pointer.y /= retinaScaling;\n      }\n\n      if (boundsWidth === 0 || boundsHeight === 0) {\n        // If bounds are not available (i.e. not visible), do not apply scale.\n        cssScale = { width: 1, height: 1 };\n      }\n      else {\n        cssScale = {\n          width: upperCanvasEl.width / boundsWidth,\n          height: upperCanvasEl.height / boundsHeight\n        };\n      }\n\n      return {\n        x: pointer.x * cssScale.width,\n        y: pointer.y * cssScale.height\n      };\n    },\n\n    /**\n     * @private\n     * @throws {CANVAS_INIT_ERROR} If canvas can not be initialized\n     */\n    _createUpperCanvas: function () {\n      var lowerCanvasClass = this.lowerCanvasEl.className.replace(/\\s*lower-canvas\\s*/, ''),\n          lowerCanvasEl = this.lowerCanvasEl, upperCanvasEl = this.upperCanvasEl;\n\n      // there is no need to create a new upperCanvas element if we have already one.\n      if (upperCanvasEl) {\n        upperCanvasEl.className = '';\n      }\n      else {\n        upperCanvasEl = this._createCanvasElement();\n        this.upperCanvasEl = upperCanvasEl;\n      }\n      fabric.util.addClass(upperCanvasEl, 'upper-canvas ' + lowerCanvasClass);\n\n      this.wrapperEl.appendChild(upperCanvasEl);\n\n      this._copyCanvasStyle(lowerCanvasEl, upperCanvasEl);\n      this._applyCanvasStyle(upperCanvasEl);\n      this.contextTop = upperCanvasEl.getContext('2d');\n    },\n\n    /**\n     * Returns context of top canvas where interactions are drawn\n     * @returns {CanvasRenderingContext2D}\n     */\n    getTopContext: function () {\n      return this.contextTop;\n    },\n\n    /**\n     * @private\n     */\n    _createCacheCanvas: function () {\n      this.cacheCanvasEl = this._createCanvasElement();\n      this.cacheCanvasEl.setAttribute('width', this.width);\n      this.cacheCanvasEl.setAttribute('height', this.height);\n      this.contextCache = this.cacheCanvasEl.getContext('2d');\n    },\n\n    /**\n     * @private\n     */\n    _initWrapperElement: function () {\n      this.wrapperEl = fabric.util.wrapElement(this.lowerCanvasEl, 'div', {\n        'class': this.containerClass\n      });\n      fabric.util.setStyle(this.wrapperEl, {\n        width: this.width + 'px',\n        height: this.height + 'px',\n        position: 'relative'\n      });\n      fabric.util.makeElementUnselectable(this.wrapperEl);\n    },\n\n    /**\n     * @private\n     * @param {HTMLElement} element canvas element to apply styles on\n     */\n    _applyCanvasStyle: function (element) {\n      var width = this.width || element.width,\n          height = this.height || element.height;\n\n      fabric.util.setStyle(element, {\n        position: 'absolute',\n        width: width + 'px',\n        height: height + 'px',\n        left: 0,\n        top: 0,\n        'touch-action': this.allowTouchScrolling ? 'manipulation' : 'none',\n        '-ms-touch-action': this.allowTouchScrolling ? 'manipulation' : 'none'\n      });\n      element.width = width;\n      element.height = height;\n      fabric.util.makeElementUnselectable(element);\n    },\n\n    /**\n     * Copy the entire inline style from one element (fromEl) to another (toEl)\n     * @private\n     * @param {Element} fromEl Element style is copied from\n     * @param {Element} toEl Element copied style is applied to\n     */\n    _copyCanvasStyle: function (fromEl, toEl) {\n      toEl.style.cssText = fromEl.style.cssText;\n    },\n\n    /**\n     * Returns context of canvas where object selection is drawn\n     * @return {CanvasRenderingContext2D}\n     */\n    getSelectionContext: function() {\n      return this.contextTop;\n    },\n\n    /**\n     * Returns &lt;canvas> element on which object selection is drawn\n     * @return {HTMLCanvasElement}\n     */\n    getSelectionElement: function () {\n      return this.upperCanvasEl;\n    },\n\n    /**\n     * Returns currently active object\n     * @return {fabric.Object} active object\n     */\n    getActiveObject: function () {\n      return this._activeObject;\n    },\n\n    /**\n     * Returns an array with the current selected objects\n     * @return {fabric.Object} active object\n     */\n    getActiveObjects: function () {\n      var active = this._activeObject;\n      if (active) {\n        if (active.type === 'activeSelection' && active._objects) {\n          return active._objects.slice(0);\n        }\n        else {\n          return [active];\n        }\n      }\n      return [];\n    },\n\n    /**\n     * @private\n     * @param {fabric.Object} obj Object that was removed\n     */\n    _onObjectRemoved: function(obj) {\n      // removing active object should fire \"selection:cleared\" events\n      if (obj === this._activeObject) {\n        this.fire('before:selection:cleared', { target: obj });\n        this._discardActiveObject();\n        this.fire('selection:cleared', { target: obj });\n        obj.fire('deselected');\n      }\n      if (obj === this._hoveredTarget){\n        this._hoveredTarget = null;\n        this._hoveredTargets = [];\n      }\n      this.callSuper('_onObjectRemoved', obj);\n    },\n\n    /**\n     * @private\n     * Compares the old activeObject with the current one and fires correct events\n     * @param {fabric.Object} obj old activeObject\n     */\n    _fireSelectionEvents: function(oldObjects, e) {\n      var somethingChanged = false, objects = this.getActiveObjects(),\n          added = [], removed = [];\n      oldObjects.forEach(function(oldObject) {\n        if (objects.indexOf(oldObject) === -1) {\n          somethingChanged = true;\n          oldObject.fire('deselected', {\n            e: e,\n            target: oldObject\n          });\n          removed.push(oldObject);\n        }\n      });\n      objects.forEach(function(object) {\n        if (oldObjects.indexOf(object) === -1) {\n          somethingChanged = true;\n          object.fire('selected', {\n            e: e,\n            target: object\n          });\n          added.push(object);\n        }\n      });\n      if (oldObjects.length > 0 && objects.length > 0) {\n        somethingChanged && this.fire('selection:updated', {\n          e: e,\n          selected: added,\n          deselected: removed,\n        });\n      }\n      else if (objects.length > 0) {\n        this.fire('selection:created', {\n          e: e,\n          selected: added,\n        });\n      }\n      else if (oldObjects.length > 0) {\n        this.fire('selection:cleared', {\n          e: e,\n          deselected: removed,\n        });\n      }\n    },\n\n    /**\n     * Sets given object as the only active object on canvas\n     * @param {fabric.Object} object Object to set as an active one\n     * @param {Event} [e] Event (passed along when firing \"object:selected\")\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    setActiveObject: function (object, e) {\n      var currentActives = this.getActiveObjects();\n      this._setActiveObject(object, e);\n      this._fireSelectionEvents(currentActives, e);\n      return this;\n    },\n\n    /**\n     * This is a private method for now.\n     * This is supposed to be equivalent to setActiveObject but without firing\n     * any event. There is commitment to have this stay this way.\n     * This is the functional part of setActiveObject.\n     * @private\n     * @param {Object} object to set as active\n     * @param {Event} [e] Event (passed along when firing \"object:selected\")\n     * @return {Boolean} true if the selection happened\n     */\n    _setActiveObject: function(object, e) {\n      if (this._activeObject === object) {\n        return false;\n      }\n      if (!this._discardActiveObject(e, object)) {\n        return false;\n      }\n      if (object.onSelect({ e: e })) {\n        return false;\n      }\n      this._activeObject = object;\n      return true;\n    },\n\n    /**\n     * This is a private method for now.\n     * This is supposed to be equivalent to discardActiveObject but without firing\n     * any events. There is commitment to have this stay this way.\n     * This is the functional part of discardActiveObject.\n     * @param {Event} [e] Event (passed along when firing \"object:deselected\")\n     * @param {Object} object to set as active\n     * @return {Boolean} true if the selection happened\n     * @private\n     */\n    _discardActiveObject: function(e, object) {\n      var obj = this._activeObject;\n      if (obj) {\n        // onDeselect return TRUE to cancel selection;\n        if (obj.onDeselect({ e: e, object: object })) {\n          return false;\n        }\n        this._activeObject = null;\n      }\n      return true;\n    },\n\n    /**\n     * Discards currently active object and fire events. If the function is called by fabric\n     * as a consequence of a mouse event, the event is passed as a parameter and\n     * sent to the fire function for the custom events. When used as a method the\n     * e param does not have any application.\n     * @param {event} e\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    discardActiveObject: function (e) {\n      var currentActives = this.getActiveObjects(), activeObject = this.getActiveObject();\n      if (currentActives.length) {\n        this.fire('before:selection:cleared', { target: activeObject, e: e });\n      }\n      this._discardActiveObject(e);\n      this._fireSelectionEvents(currentActives, e);\n      return this;\n    },\n\n    /**\n     * Clears a canvas element and removes all event listeners\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    dispose: function () {\n      var wrapper = this.wrapperEl;\n      this.removeListeners();\n      wrapper.removeChild(this.upperCanvasEl);\n      wrapper.removeChild(this.lowerCanvasEl);\n      this.contextCache = null;\n      this.contextTop = null;\n      ['upperCanvasEl', 'cacheCanvasEl'].forEach((function(element) {\n        fabric.util.cleanUpJsdomNode(this[element]);\n        this[element] = undefined;\n      }).bind(this));\n      if (wrapper.parentNode) {\n        wrapper.parentNode.replaceChild(this.lowerCanvasEl, this.wrapperEl);\n      }\n      delete this.wrapperEl;\n      fabric.StaticCanvas.prototype.dispose.call(this);\n      return this;\n    },\n\n    /**\n     * Clears all contexts (background, main, top) of an instance\n     * @return {fabric.Canvas} thisArg\n     * @chainable\n     */\n    clear: function () {\n      // this.discardActiveGroup();\n      this.discardActiveObject();\n      this.clearContext(this.contextTop);\n      return this.callSuper('clear');\n    },\n\n    /**\n     * Draws objects' controls (borders/controls)\n     * @param {CanvasRenderingContext2D} ctx Context to render controls on\n     */\n    drawControls: function(ctx) {\n      var activeObject = this._activeObject;\n\n      if (activeObject) {\n        activeObject._renderControls(ctx);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _toObject: function(instance, methodName, propertiesToInclude) {\n      //If the object is part of the current selection group, it should\n      //be transformed appropriately\n      //i.e. it should be serialised as it would appear if the selection group\n      //were to be destroyed.\n      var originalProperties = this._realizeGroupTransformOnObject(instance),\n          object = this.callSuper('_toObject', instance, methodName, propertiesToInclude);\n      //Undo the damage we did by changing all of its properties\n      this._unwindGroupTransformOnObject(instance, originalProperties);\n      return object;\n    },\n\n    /**\n     * Realises an object's group transformation on it\n     * @private\n     * @param {fabric.Object} [instance] the object to transform (gets mutated)\n     * @returns the original values of instance which were changed\n     */\n    _realizeGroupTransformOnObject: function(instance) {\n      if (instance.group && instance.group.type === 'activeSelection' && this._activeObject === instance.group) {\n        var layoutProps = ['angle', 'flipX', 'flipY', 'left', 'scaleX', 'scaleY', 'skewX', 'skewY', 'top'];\n        //Copy all the positionally relevant properties across now\n        var originalValues = {};\n        layoutProps.forEach(function(prop) {\n          originalValues[prop] = instance[prop];\n        });\n        fabric.util.addTransformToObject(instance, this._activeObject.calcOwnMatrix());\n        return originalValues;\n      }\n      else {\n        return null;\n      }\n    },\n\n    /**\n     * Restores the changed properties of instance\n     * @private\n     * @param {fabric.Object} [instance] the object to un-transform (gets mutated)\n     * @param {Object} [originalValues] the original values of instance, as returned by _realizeGroupTransformOnObject\n     */\n    _unwindGroupTransformOnObject: function(instance, originalValues) {\n      if (originalValues) {\n        instance.set(originalValues);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setSVGObject: function(markup, instance, reviver) {\n      //If the object is in a selection group, simulate what would happen to that\n      //object when the group is deselected\n      var originalProperties = this._realizeGroupTransformOnObject(instance);\n      this.callSuper('_setSVGObject', markup, instance, reviver);\n      this._unwindGroupTransformOnObject(instance, originalProperties);\n    },\n\n    setViewportTransform: function (vpt) {\n      if (this.renderOnAddRemove && this._activeObject && this._activeObject.isEditing) {\n        this._activeObject.clearContextTop();\n      }\n      fabric.StaticCanvas.prototype.setViewportTransform.call(this, vpt);\n    }\n  });\n\n  // copying static properties manually to work around Opera's bug,\n  // where \"prototype\" property is enumerable and overrides existing prototype\n  for (var prop in fabric.StaticCanvas) {\n    if (prop !== 'prototype') {\n      fabric.Canvas[prop] = fabric.StaticCanvas[prop];\n    }\n  }\n})();\n\n\n(function() {\n\n  var addListener = fabric.util.addListener,\n      removeListener = fabric.util.removeListener,\n      RIGHT_CLICK = 3, MIDDLE_CLICK = 2, LEFT_CLICK = 1,\n      addEventOptions = { passive: false };\n\n  function checkClick(e, value) {\n    return e.button && (e.button === value - 1);\n  }\n\n  fabric.util.object.extend(fabric.Canvas.prototype, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * Contains the id of the touch event that owns the fabric transform\n     * @type Number\n     * @private\n     */\n    mainTouchId: null,\n\n    /**\n     * Adds mouse listeners to canvas\n     * @private\n     */\n    _initEventListeners: function () {\n      // in case we initialized the class twice. This should not happen normally\n      // but in some kind of applications where the canvas element may be changed\n      // this is a workaround to having double listeners.\n      this.removeListeners();\n      this._bindEvents();\n      this.addOrRemove(addListener, 'add');\n    },\n\n    /**\n     * return an event prefix pointer or mouse.\n     * @private\n     */\n    _getEventPrefix: function () {\n      return this.enablePointerEvents ? 'pointer' : 'mouse';\n    },\n\n    addOrRemove: function(functor, eventjsFunctor) {\n      var canvasElement = this.upperCanvasEl,\n          eventTypePrefix = this._getEventPrefix();\n      functor(fabric.window, 'resize', this._onResize);\n      functor(canvasElement, eventTypePrefix + 'down', this._onMouseDown);\n      functor(canvasElement, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n      functor(canvasElement, eventTypePrefix + 'out', this._onMouseOut);\n      functor(canvasElement, eventTypePrefix + 'enter', this._onMouseEnter);\n      functor(canvasElement, 'wheel', this._onMouseWheel);\n      functor(canvasElement, 'contextmenu', this._onContextMenu);\n      functor(canvasElement, 'dblclick', this._onDoubleClick);\n      functor(canvasElement, 'dragover', this._onDragOver);\n      functor(canvasElement, 'dragenter', this._onDragEnter);\n      functor(canvasElement, 'dragleave', this._onDragLeave);\n      functor(canvasElement, 'drop', this._onDrop);\n      if (!this.enablePointerEvents) {\n        functor(canvasElement, 'touchstart', this._onTouchStart, addEventOptions);\n      }\n      if (typeof eventjs !== 'undefined' && eventjsFunctor in eventjs) {\n        eventjs[eventjsFunctor](canvasElement, 'gesture', this._onGesture);\n        eventjs[eventjsFunctor](canvasElement, 'drag', this._onDrag);\n        eventjs[eventjsFunctor](canvasElement, 'orientation', this._onOrientationChange);\n        eventjs[eventjsFunctor](canvasElement, 'shake', this._onShake);\n        eventjs[eventjsFunctor](canvasElement, 'longpress', this._onLongPress);\n      }\n    },\n\n    /**\n     * Removes all event listeners\n     */\n    removeListeners: function() {\n      this.addOrRemove(removeListener, 'remove');\n      // if you dispose on a mouseDown, before mouse up, you need to clean document to...\n      var eventTypePrefix = this._getEventPrefix();\n      removeListener(fabric.document, eventTypePrefix + 'up', this._onMouseUp);\n      removeListener(fabric.document, 'touchend', this._onTouchEnd, addEventOptions);\n      removeListener(fabric.document, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n      removeListener(fabric.document, 'touchmove', this._onMouseMove, addEventOptions);\n    },\n\n    /**\n     * @private\n     */\n    _bindEvents: function() {\n      if (this.eventsBound) {\n        // for any reason we pass here twice we do not want to bind events twice.\n        return;\n      }\n      this._onMouseDown = this._onMouseDown.bind(this);\n      this._onTouchStart = this._onTouchStart.bind(this);\n      this._onMouseMove = this._onMouseMove.bind(this);\n      this._onMouseUp = this._onMouseUp.bind(this);\n      this._onTouchEnd = this._onTouchEnd.bind(this);\n      this._onResize = this._onResize.bind(this);\n      this._onGesture = this._onGesture.bind(this);\n      this._onDrag = this._onDrag.bind(this);\n      this._onShake = this._onShake.bind(this);\n      this._onLongPress = this._onLongPress.bind(this);\n      this._onOrientationChange = this._onOrientationChange.bind(this);\n      this._onMouseWheel = this._onMouseWheel.bind(this);\n      this._onMouseOut = this._onMouseOut.bind(this);\n      this._onMouseEnter = this._onMouseEnter.bind(this);\n      this._onContextMenu = this._onContextMenu.bind(this);\n      this._onDoubleClick = this._onDoubleClick.bind(this);\n      this._onDragOver = this._onDragOver.bind(this);\n      this._onDragEnter = this._simpleEventHandler.bind(this, 'dragenter');\n      this._onDragLeave = this._simpleEventHandler.bind(this, 'dragleave');\n      this._onDrop = this._onDrop.bind(this);\n      this.eventsBound = true;\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js gesture\n     * @param {Event} [self] Inner Event object\n     */\n    _onGesture: function(e, self) {\n      this.__onTransformGesture && this.__onTransformGesture(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js drag\n     * @param {Event} [self] Inner Event object\n     */\n    _onDrag: function(e, self) {\n      this.__onDrag && this.__onDrag(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on wheel event\n     */\n    _onMouseWheel: function(e) {\n      this.__onMouseWheel(e);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseOut: function(e) {\n      var target = this._hoveredTarget;\n      this.fire('mouse:out', { target: target, e: e });\n      this._hoveredTarget = null;\n      target && target.fire('mouseout', { e: e });\n\n      var _this = this;\n      this._hoveredTargets.forEach(function(_target){\n        _this.fire('mouse:out', { target: target, e: e });\n        _target && target.fire('mouseout', { e: e });\n      });\n      this._hoveredTargets = [];\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseenter\n     */\n    _onMouseEnter: function(e) {\n      // This find target and consequent 'mouse:over' is used to\n      // clear old instances on hovered target.\n      // calling findTarget has the side effect of killing target.__corner.\n      // as a short term fix we are not firing this if we are currently transforming.\n      // as a long term fix we need to separate the action of finding a target with the\n      // side effects we added to it.\n      if (!this._currentTransform && !this.findTarget(e)) {\n        this.fire('mouse:over', { target: null, e: e });\n        this._hoveredTarget = null;\n        this._hoveredTargets = [];\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js orientation change\n     * @param {Event} [self] Inner Event object\n     */\n    _onOrientationChange: function(e, self) {\n      this.__onOrientationChange && this.__onOrientationChange(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js shake\n     * @param {Event} [self] Inner Event object\n     */\n    _onShake: function(e, self) {\n      this.__onShake && this.__onShake(e, self);\n    },\n\n    /**\n     * @private\n     * @param {Event} [e] Event object fired on Event.js shake\n     * @param {Event} [self] Inner Event object\n     */\n    _onLongPress: function(e, self) {\n      this.__onLongPress && this.__onLongPress(e, self);\n    },\n\n    /**\n     * prevent default to allow drop event to be fired\n     * @private\n     * @param {Event} [e] Event object fired on Event.js shake\n     */\n    _onDragOver: function(e) {\n      e.preventDefault();\n      var target = this._simpleEventHandler('dragover', e);\n      this._fireEnterLeaveEvents(target, e);\n    },\n\n    /**\n     * `drop:before` is a an event that allow you to schedule logic\n     * before the `drop` event. Prefer `drop` event always, but if you need\n     * to run some drop-disabling logic on an event, since there is no way\n     * to handle event handlers ordering, use `drop:before`\n     * @param {Event} e\n     */\n    _onDrop: function (e) {\n      this._simpleEventHandler('drop:before', e);\n      return this._simpleEventHandler('drop', e);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onContextMenu: function (e) {\n      if (this.stopContextMenu) {\n        e.stopPropagation();\n        e.preventDefault();\n      }\n      return false;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onDoubleClick: function (e) {\n      this._cacheTransformEventData(e);\n      this._handleEvent(e, 'dblclick');\n      this._resetTransformEventData(e);\n    },\n\n    /**\n     * Return a the id of an event.\n     * returns either the pointerId or the identifier or 0 for the mouse event\n     * @private\n     * @param {Event} evt Event object\n     */\n    getPointerId: function(evt) {\n      var changedTouches = evt.changedTouches;\n\n      if (changedTouches) {\n        return changedTouches[0] && changedTouches[0].identifier;\n      }\n\n      if (this.enablePointerEvents) {\n        return evt.pointerId;\n      }\n\n      return -1;\n    },\n\n    /**\n     * Determines if an event has the id of the event that is considered main\n     * @private\n     * @param {evt} event Event object\n     */\n    _isMainEvent: function(evt) {\n      if (evt.isPrimary === true) {\n        return true;\n      }\n      if (evt.isPrimary === false) {\n        return false;\n      }\n      if (evt.type === 'touchend' && evt.touches.length === 0) {\n        return true;\n      }\n      if (evt.changedTouches) {\n        return evt.changedTouches[0].identifier === this.mainTouchId;\n      }\n      return true;\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onTouchStart: function(e) {\n      e.preventDefault();\n      if (this.mainTouchId === null) {\n        this.mainTouchId = this.getPointerId(e);\n      }\n      this.__onMouseDown(e);\n      this._resetTransformEventData();\n      var canvasElement = this.upperCanvasEl,\n          eventTypePrefix = this._getEventPrefix();\n      addListener(fabric.document, 'touchend', this._onTouchEnd, addEventOptions);\n      addListener(fabric.document, 'touchmove', this._onMouseMove, addEventOptions);\n      // Unbind mousedown to prevent double triggers from touch devices\n      removeListener(canvasElement, eventTypePrefix + 'down', this._onMouseDown);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseDown: function (e) {\n      this.__onMouseDown(e);\n      this._resetTransformEventData();\n      var canvasElement = this.upperCanvasEl,\n          eventTypePrefix = this._getEventPrefix();\n      removeListener(canvasElement, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n      addListener(fabric.document, eventTypePrefix + 'up', this._onMouseUp);\n      addListener(fabric.document, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onTouchEnd: function(e) {\n      if (e.touches.length > 0) {\n        // if there are still touches stop here\n        return;\n      }\n      this.__onMouseUp(e);\n      this._resetTransformEventData();\n      this.mainTouchId = null;\n      var eventTypePrefix = this._getEventPrefix();\n      removeListener(fabric.document, 'touchend', this._onTouchEnd, addEventOptions);\n      removeListener(fabric.document, 'touchmove', this._onMouseMove, addEventOptions);\n      var _this = this;\n      if (this._willAddMouseDown) {\n        clearTimeout(this._willAddMouseDown);\n      }\n      this._willAddMouseDown = setTimeout(function() {\n        // Wait 400ms before rebinding mousedown to prevent double triggers\n        // from touch devices\n        addListener(_this.upperCanvasEl, eventTypePrefix + 'down', _this._onMouseDown);\n        _this._willAddMouseDown = 0;\n      }, 400);\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    _onMouseUp: function (e) {\n      this.__onMouseUp(e);\n      this._resetTransformEventData();\n      var canvasElement = this.upperCanvasEl,\n          eventTypePrefix = this._getEventPrefix();\n      if (this._isMainEvent(e)) {\n        removeListener(fabric.document, eventTypePrefix + 'up', this._onMouseUp);\n        removeListener(fabric.document, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n        addListener(canvasElement, eventTypePrefix + 'move', this._onMouseMove, addEventOptions);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    _onMouseMove: function (e) {\n      !this.allowTouchScrolling && e.preventDefault && e.preventDefault();\n      this.__onMouseMove(e);\n    },\n\n    /**\n     * @private\n     */\n    _onResize: function () {\n      this.calcOffset();\n    },\n\n    /**\n     * Decides whether the canvas should be redrawn in mouseup and mousedown events.\n     * @private\n     * @param {Object} target\n     */\n    _shouldRender: function(target) {\n      var activeObject = this._activeObject;\n\n      if (\n        !!activeObject !== !!target ||\n        (activeObject && target && (activeObject !== target))\n      ) {\n        // this covers: switch of target, from target to no target, selection of target\n        // multiSelection with key and mouse\n        return true;\n      }\n      else if (activeObject && activeObject.isEditing) {\n        // if we mouse up/down over a editing textbox a cursor change,\n        // there is no need to re render\n        return false;\n      }\n      return false;\n    },\n\n    /**\n     * Method that defines the actions when mouse is released on canvas.\n     * The method resets the currentTransform parameters, store the image corner\n     * position in the image object and render the canvas on top.\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    __onMouseUp: function (e) {\n      var target, transform = this._currentTransform,\n          groupSelector = this._groupSelector, shouldRender = false,\n          isClick = (!groupSelector || (groupSelector.left === 0 && groupSelector.top === 0));\n      this._cacheTransformEventData(e);\n      target = this._target;\n      this._handleEvent(e, 'up:before');\n      // if right/middle click just fire events and return\n      // target undefined will make the _handleEvent search the target\n      if (checkClick(e, RIGHT_CLICK)) {\n        if (this.fireRightClick) {\n          this._handleEvent(e, 'up', RIGHT_CLICK, isClick);\n        }\n        return;\n      }\n\n      if (checkClick(e, MIDDLE_CLICK)) {\n        if (this.fireMiddleClick) {\n          this._handleEvent(e, 'up', MIDDLE_CLICK, isClick);\n        }\n        this._resetTransformEventData();\n        return;\n      }\n\n      if (this.isDrawingMode && this._isCurrentlyDrawing) {\n        this._onMouseUpInDrawingMode(e);\n        return;\n      }\n\n      if (!this._isMainEvent(e)) {\n        return;\n      }\n      if (transform) {\n        this._finalizeCurrentTransform(e);\n        shouldRender = transform.actionPerformed;\n      }\n      if (!isClick) {\n        var targetWasActive = target === this._activeObject;\n        this._maybeGroupObjects(e);\n        if (!shouldRender) {\n          shouldRender = (\n            this._shouldRender(target) ||\n            (!targetWasActive && target === this._activeObject)\n          );\n        }\n      }\n      var corner, pointer;\n      if (target) {\n        corner = target._findTargetCorner(\n          this.getPointer(e, true),\n          fabric.util.isTouchEvent(e)\n        );\n        if (target.selectable && target !== this._activeObject && target.activeOn === 'up') {\n          this.setActiveObject(target, e);\n          shouldRender = true;\n        }\n        else {\n          var control = target.controls[corner],\n              mouseUpHandler = control && control.getMouseUpHandler(e, target, control);\n          if (mouseUpHandler) {\n            pointer = this.getPointer(e);\n            mouseUpHandler(e, transform, pointer.x, pointer.y);\n          }\n        }\n        target.isMoving = false;\n      }\n      // if we are ending up a transform on a different control or a new object\n      // fire the original mouse up from the corner that started the transform\n      if (transform && (transform.target !== target || transform.corner !== corner)) {\n        var originalControl = transform.target && transform.target.controls[transform.corner],\n            originalMouseUpHandler = originalControl && originalControl.getMouseUpHandler(e, target, control);\n        pointer = pointer || this.getPointer(e);\n        originalMouseUpHandler && originalMouseUpHandler(e, transform, pointer.x, pointer.y);\n      }\n      this._setCursorFromEvent(e, target);\n      this._handleEvent(e, 'up', LEFT_CLICK, isClick);\n      this._groupSelector = null;\n      this._currentTransform = null;\n      // reset the target information about which corner is selected\n      target && (target.__corner = 0);\n      if (shouldRender) {\n        this.requestRenderAll();\n      }\n      else if (!isClick) {\n        this.renderTop();\n      }\n    },\n\n    /**\n     * @private\n     * Handle event firing for target and subtargets\n     * @param {Event} e event from mouse\n     * @param {String} eventType event to fire (up, down or move)\n     * @return {Fabric.Object} target return the the target found, for internal reasons.\n     */\n    _simpleEventHandler: function(eventType, e) {\n      var target = this.findTarget(e),\n          targets = this.targets,\n          options = {\n            e: e,\n            target: target,\n            subTargets: targets,\n          };\n      this.fire(eventType, options);\n      target && target.fire(eventType, options);\n      if (!targets) {\n        return target;\n      }\n      for (var i = 0; i < targets.length; i++) {\n        targets[i].fire(eventType, options);\n      }\n      return target;\n    },\n\n    /**\n     * @private\n     * Handle event firing for target and subtargets\n     * @param {Event} e event from mouse\n     * @param {String} eventType event to fire (up, down or move)\n     * @param {fabric.Object} targetObj receiving event\n     * @param {Number} [button] button used in the event 1 = left, 2 = middle, 3 = right\n     * @param {Boolean} isClick for left button only, indicates that the mouse up happened without move.\n     */\n    _handleEvent: function(e, eventType, button, isClick) {\n      var target = this._target,\n          targets = this.targets || [],\n          options = {\n            e: e,\n            target: target,\n            subTargets: targets,\n            button: button || LEFT_CLICK,\n            isClick: isClick || false,\n            pointer: this._pointer,\n            absolutePointer: this._absolutePointer,\n            transform: this._currentTransform\n          };\n      if (eventType === 'up') {\n        options.currentTarget = this.findTarget(e);\n        options.currentSubTargets = this.targets;\n      }\n      this.fire('mouse:' + eventType, options);\n      target && target.fire('mouse' + eventType, options);\n      for (var i = 0; i < targets.length; i++) {\n        targets[i].fire('mouse' + eventType, options);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e send the mouse event that generate the finalize down, so it can be used in the event\n     */\n    _finalizeCurrentTransform: function(e) {\n\n      var transform = this._currentTransform,\n          target = transform.target,\n          options = {\n            e: e,\n            target: target,\n            transform: transform,\n            action: transform.action,\n          };\n\n      if (target._scaling) {\n        target._scaling = false;\n      }\n\n      target.setCoords();\n\n      if (transform.actionPerformed || (this.stateful && target.hasStateChanged())) {\n        this._fire('modified', options);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    _onMouseDownInDrawingMode: function(e) {\n      this._isCurrentlyDrawing = true;\n      if (this.getActiveObject()) {\n        this.discardActiveObject(e).requestRenderAll();\n      }\n      var pointer = this.getPointer(e);\n      this.freeDrawingBrush.onMouseDown(pointer, { e: e, pointer: pointer });\n      this._handleEvent(e, 'down');\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    _onMouseMoveInDrawingMode: function(e) {\n      if (this._isCurrentlyDrawing) {\n        var pointer = this.getPointer(e);\n        this.freeDrawingBrush.onMouseMove(pointer, { e: e, pointer: pointer });\n      }\n      this.setCursor(this.freeDrawingCursor);\n      this._handleEvent(e, 'move');\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object fired on mouseup\n     */\n    _onMouseUpInDrawingMode: function(e) {\n      var pointer = this.getPointer(e);\n      this._isCurrentlyDrawing = this.freeDrawingBrush.onMouseUp({ e: e, pointer: pointer });\n      this._handleEvent(e, 'up');\n    },\n\n    /**\n     * Method that defines the actions when mouse is clicked on canvas.\n     * The method inits the currentTransform parameters and renders all the\n     * canvas so the current image can be placed on the top canvas and the rest\n     * in on the container one.\n     * @private\n     * @param {Event} e Event object fired on mousedown\n     */\n    __onMouseDown: function (e) {\n      this._cacheTransformEventData(e);\n      this._handleEvent(e, 'down:before');\n      var target = this._target;\n      // if right click just fire events\n      if (checkClick(e, RIGHT_CLICK)) {\n        if (this.fireRightClick) {\n          this._handleEvent(e, 'down', RIGHT_CLICK);\n        }\n        return;\n      }\n\n      if (checkClick(e, MIDDLE_CLICK)) {\n        if (this.fireMiddleClick) {\n          this._handleEvent(e, 'down', MIDDLE_CLICK);\n        }\n        return;\n      }\n\n      if (this.isDrawingMode) {\n        this._onMouseDownInDrawingMode(e);\n        return;\n      }\n\n      if (!this._isMainEvent(e)) {\n        return;\n      }\n\n      // ignore if some object is being transformed at this moment\n      if (this._currentTransform) {\n        return;\n      }\n\n      var pointer = this._pointer;\n      // save pointer for check in __onMouseUp event\n      this._previousPointer = pointer;\n      var shouldRender = this._shouldRender(target),\n          shouldGroup = this._shouldGroup(e, target);\n      if (this._shouldClearSelection(e, target)) {\n        this.discardActiveObject(e);\n      }\n      else if (shouldGroup) {\n        this._handleGrouping(e, target);\n        target = this._activeObject;\n      }\n\n      if (this.selection && (!target ||\n        (!target.selectable && !target.isEditing && target !== this._activeObject))) {\n        this._groupSelector = {\n          ex: this._absolutePointer.x,\n          ey: this._absolutePointer.y,\n          top: 0,\n          left: 0\n        };\n      }\n\n      if (target) {\n        var alreadySelected = target === this._activeObject;\n        if (target.selectable && target.activeOn === 'down') {\n          this.setActiveObject(target, e);\n        }\n        var corner = target._findTargetCorner(\n          this.getPointer(e, true),\n          fabric.util.isTouchEvent(e)\n        );\n        target.__corner = corner;\n        if (target === this._activeObject && (corner || !shouldGroup)) {\n          this._setupCurrentTransform(e, target, alreadySelected);\n          var control = target.controls[corner],\n              pointer = this.getPointer(e),\n              mouseDownHandler = control && control.getMouseDownHandler(e, target, control);\n          if (mouseDownHandler) {\n            mouseDownHandler(e, this._currentTransform, pointer.x, pointer.y);\n          }\n        }\n      }\n      this._handleEvent(e, 'down');\n      // we must renderAll so that we update the visuals\n      (shouldRender || shouldGroup) && this.requestRenderAll();\n    },\n\n    /**\n     * reset cache form common information needed during event processing\n     * @private\n     */\n    _resetTransformEventData: function() {\n      this._target = null;\n      this._pointer = null;\n      this._absolutePointer = null;\n    },\n\n    /**\n     * Cache common information needed during event processing\n     * @private\n     * @param {Event} e Event object fired on event\n     */\n    _cacheTransformEventData: function(e) {\n      // reset in order to avoid stale caching\n      this._resetTransformEventData();\n      this._pointer = this.getPointer(e, true);\n      this._absolutePointer = this.restorePointerVpt(this._pointer);\n      this._target = this._currentTransform ? this._currentTransform.target : this.findTarget(e) || null;\n    },\n\n    /**\n     * @private\n     */\n    _beforeTransform: function(e) {\n      var t = this._currentTransform;\n      this.stateful && t.target.saveState();\n      this.fire('before:transform', {\n        e: e,\n        transform: t,\n      });\n    },\n\n    /**\n     * Method that defines the actions when mouse is hovering the canvas.\n     * The currentTransform parameter will define whether the user is rotating/scaling/translating\n     * an image or neither of them (only hovering). A group selection is also possible and would cancel\n     * all any other type of action.\n     * In case of an image transformation only the top canvas will be rendered.\n     * @private\n     * @param {Event} e Event object fired on mousemove\n     */\n    __onMouseMove: function (e) {\n      this._handleEvent(e, 'move:before');\n      this._cacheTransformEventData(e);\n      var target, pointer;\n\n      if (this.isDrawingMode) {\n        this._onMouseMoveInDrawingMode(e);\n        return;\n      }\n\n      if (!this._isMainEvent(e)) {\n        return;\n      }\n\n      var groupSelector = this._groupSelector;\n\n      // We initially clicked in an empty area, so we draw a box for multiple selection\n      if (groupSelector) {\n        pointer = this._absolutePointer;\n\n        groupSelector.left = pointer.x - groupSelector.ex;\n        groupSelector.top = pointer.y - groupSelector.ey;\n\n        this.renderTop();\n      }\n      else if (!this._currentTransform) {\n        target = this.findTarget(e) || null;\n        this._setCursorFromEvent(e, target);\n        this._fireOverOutEvents(target, e);\n      }\n      else {\n        this._transformObject(e);\n      }\n      this._handleEvent(e, 'move');\n      this._resetTransformEventData();\n    },\n\n    /**\n     * Manage the mouseout, mouseover events for the fabric object on the canvas\n     * @param {Fabric.Object} target the target where the target from the mousemove event\n     * @param {Event} e Event object fired on mousemove\n     * @private\n     */\n    _fireOverOutEvents: function(target, e) {\n      var _hoveredTarget = this._hoveredTarget,\n          _hoveredTargets = this._hoveredTargets, targets = this.targets,\n          length = Math.max(_hoveredTargets.length, targets.length);\n\n      this.fireSyntheticInOutEvents(target, e, {\n        oldTarget: _hoveredTarget,\n        evtOut: 'mouseout',\n        canvasEvtOut: 'mouse:out',\n        evtIn: 'mouseover',\n        canvasEvtIn: 'mouse:over',\n      });\n      for (var i = 0; i < length; i++){\n        this.fireSyntheticInOutEvents(targets[i], e, {\n          oldTarget: _hoveredTargets[i],\n          evtOut: 'mouseout',\n          evtIn: 'mouseover',\n        });\n      }\n      this._hoveredTarget = target;\n      this._hoveredTargets = this.targets.concat();\n    },\n\n    /**\n     * Manage the dragEnter, dragLeave events for the fabric objects on the canvas\n     * @param {Fabric.Object} target the target where the target from the onDrag event\n     * @param {Event} e Event object fired on ondrag\n     * @private\n     */\n    _fireEnterLeaveEvents: function(target, e) {\n      var _draggedoverTarget = this._draggedoverTarget,\n          _hoveredTargets = this._hoveredTargets, targets = this.targets,\n          length = Math.max(_hoveredTargets.length, targets.length);\n\n      this.fireSyntheticInOutEvents(target, e, {\n        oldTarget: _draggedoverTarget,\n        evtOut: 'dragleave',\n        evtIn: 'dragenter',\n      });\n      for (var i = 0; i < length; i++) {\n        this.fireSyntheticInOutEvents(targets[i], e, {\n          oldTarget: _hoveredTargets[i],\n          evtOut: 'dragleave',\n          evtIn: 'dragenter',\n        });\n      }\n      this._draggedoverTarget = target;\n    },\n\n    /**\n     * Manage the synthetic in/out events for the fabric objects on the canvas\n     * @param {Fabric.Object} target the target where the target from the supported events\n     * @param {Event} e Event object fired\n     * @param {Object} config configuration for the function to work\n     * @param {String} config.targetName property on the canvas where the old target is stored\n     * @param {String} [config.canvasEvtOut] name of the event to fire at canvas level for out\n     * @param {String} config.evtOut name of the event to fire for out\n     * @param {String} [config.canvasEvtIn] name of the event to fire at canvas level for in\n     * @param {String} config.evtIn name of the event to fire for in\n     * @private\n     */\n    fireSyntheticInOutEvents: function(target, e, config) {\n      var inOpt, outOpt, oldTarget = config.oldTarget, outFires, inFires,\n          targetChanged = oldTarget !== target, canvasEvtIn = config.canvasEvtIn, canvasEvtOut = config.canvasEvtOut;\n      if (targetChanged) {\n        inOpt = { e: e, target: target, previousTarget: oldTarget };\n        outOpt = { e: e, target: oldTarget, nextTarget: target };\n      }\n      inFires = target && targetChanged;\n      outFires = oldTarget && targetChanged;\n      if (outFires) {\n        canvasEvtOut && this.fire(canvasEvtOut, outOpt);\n        oldTarget.fire(config.evtOut, outOpt);\n      }\n      if (inFires) {\n        canvasEvtIn && this.fire(canvasEvtIn, inOpt);\n        target.fire(config.evtIn, inOpt);\n      }\n    },\n\n    /**\n     * Method that defines actions when an Event Mouse Wheel\n     * @param {Event} e Event object fired on mouseup\n     */\n    __onMouseWheel: function(e) {\n      this._cacheTransformEventData(e);\n      this._handleEvent(e, 'wheel');\n      this._resetTransformEventData();\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event fired on mousemove\n     */\n    _transformObject: function(e) {\n      var pointer = this.getPointer(e),\n          transform = this._currentTransform;\n\n      transform.reset = false;\n      transform.shiftKey = e.shiftKey;\n      transform.altKey = e[this.centeredKey];\n\n      this._performTransformAction(e, transform, pointer);\n      transform.actionPerformed && this.requestRenderAll();\n    },\n\n    /**\n     * @private\n     */\n    _performTransformAction: function(e, transform, pointer) {\n      var x = pointer.x,\n          y = pointer.y,\n          action = transform.action,\n          actionPerformed = false,\n          actionHandler = transform.actionHandler;\n          // this object could be created from the function in the control handlers\n\n\n      if (actionHandler) {\n        actionPerformed = actionHandler(e, transform, x, y);\n      }\n      if (action === 'drag' && actionPerformed) {\n        transform.target.isMoving = true;\n        this.setCursor(transform.target.moveCursor || this.moveCursor);\n      }\n      transform.actionPerformed = transform.actionPerformed || actionPerformed;\n    },\n\n    /**\n     * @private\n     */\n    _fire: fabric.controlsUtils.fireEvent,\n\n    /**\n     * Sets the cursor depending on where the canvas is being hovered.\n     * Note: very buggy in Opera\n     * @param {Event} e Event object\n     * @param {Object} target Object that the mouse is hovering, if so.\n     */\n    _setCursorFromEvent: function (e, target) {\n      if (!target) {\n        this.setCursor(this.defaultCursor);\n        return false;\n      }\n      var hoverCursor = target.hoverCursor || this.hoverCursor,\n          activeSelection = this._activeObject && this._activeObject.type === 'activeSelection' ?\n            this._activeObject : null,\n          // only show proper corner when group selection is not active\n          corner = (!activeSelection || !activeSelection.contains(target))\n          // here we call findTargetCorner always with undefined for the touch parameter.\n          // we assume that if you are using a cursor you do not need to interact with\n          // the bigger touch area.\n                    && target._findTargetCorner(this.getPointer(e, true));\n\n      if (!corner) {\n        if (target.subTargetCheck){\n          // hoverCursor should come from top-most subTarget,\n          // so we walk the array backwards\n          this.targets.concat().reverse().map(function(_target){\n            hoverCursor = _target.hoverCursor || hoverCursor;\n          });\n        }\n        this.setCursor(hoverCursor);\n      }\n      else {\n        this.setCursor(this.getCornerCursor(corner, target, e));\n      }\n    },\n\n    /**\n     * @private\n     */\n    getCornerCursor: function(corner, target, e) {\n      var control = target.controls[corner];\n      return control.cursorStyleHandler(e, control, target);\n    }\n  });\n})();\n\n\n(function() {\n\n  var min = Math.min,\n      max = Math.max;\n\n  fabric.util.object.extend(fabric.Canvas.prototype, /** @lends fabric.Canvas.prototype */ {\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     * @return {Boolean}\n     */\n    _shouldGroup: function(e, target) {\n      var activeObject = this._activeObject;\n      return activeObject && this._isSelectionKeyPressed(e) && target && target.selectable && this.selection &&\n            (activeObject !== target || activeObject.type === 'activeSelection') && !target.onSelect({ e: e });\n    },\n\n    /**\n     * @private\n     * @param {Event} e Event object\n     * @param {fabric.Object} target\n     */\n    _handleGrouping: function (e, target) {\n      var activeObject = this._activeObject;\n      // avoid multi select when shift click on a corner\n      if (activeObject.__corner) {\n        return;\n      }\n      if (target === activeObject) {\n        // if it's a group, find target again, using activeGroup objects\n        target = this.findTarget(e, true);\n        // if even object is not found or we are on activeObjectCorner, bail out\n        if (!target || !target.selectable) {\n          return;\n        }\n      }\n      if (activeObject && activeObject.type === 'activeSelection') {\n        this._updateActiveSelection(target, e);\n      }\n      else {\n        this._createActiveSelection(target, e);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _updateActiveSelection: function(target, e) {\n      var activeSelection = this._activeObject,\n          currentActiveObjects = activeSelection._objects.slice(0);\n      if (activeSelection.contains(target)) {\n        activeSelection.removeWithUpdate(target);\n        this._hoveredTarget = target;\n        this._hoveredTargets = this.targets.concat();\n        if (activeSelection.size() === 1) {\n          // activate last remaining object\n          this._setActiveObject(activeSelection.item(0), e);\n        }\n      }\n      else {\n        activeSelection.addWithUpdate(target);\n        this._hoveredTarget = activeSelection;\n        this._hoveredTargets = this.targets.concat();\n      }\n      this._fireSelectionEvents(currentActiveObjects, e);\n    },\n\n    /**\n     * @private\n     */\n    _createActiveSelection: function(target, e) {\n      var currentActives = this.getActiveObjects(), group = this._createGroup(target);\n      this._hoveredTarget = group;\n      // ISSUE 4115: should we consider subTargets here?\n      // this._hoveredTargets = [];\n      // this._hoveredTargets = this.targets.concat();\n      this._setActiveObject(group, e);\n      this._fireSelectionEvents(currentActives, e);\n    },\n\n    /**\n     * @private\n     * @param {Object} target\n     */\n    _createGroup: function(target) {\n      var objects = this._objects,\n          isActiveLower = objects.indexOf(this._activeObject) < objects.indexOf(target),\n          groupObjects = isActiveLower\n            ? [this._activeObject, target]\n            : [target, this._activeObject];\n      this._activeObject.isEditing && this._activeObject.exitEditing();\n      return new fabric.ActiveSelection(groupObjects, {\n        canvas: this\n      });\n    },\n\n    /**\n     * @private\n     * @param {Event} e mouse event\n     */\n    _groupSelectedObjects: function (e) {\n\n      var group = this._collectObjects(e),\n          aGroup;\n\n      // do not create group for 1 element only\n      if (group.length === 1) {\n        this.setActiveObject(group[0], e);\n      }\n      else if (group.length > 1) {\n        aGroup = new fabric.ActiveSelection(group.reverse(), {\n          canvas: this\n        });\n        this.setActiveObject(aGroup, e);\n      }\n    },\n\n    /**\n     * @private\n     */\n    _collectObjects: function(e) {\n      var group = [],\n          currentObject,\n          x1 = this._groupSelector.ex,\n          y1 = this._groupSelector.ey,\n          x2 = x1 + this._groupSelector.left,\n          y2 = y1 + this._groupSelector.top,\n          selectionX1Y1 = new fabric.Point(min(x1, x2), min(y1, y2)),\n          selectionX2Y2 = new fabric.Point(max(x1, x2), max(y1, y2)),\n          allowIntersect = !this.selectionFullyContained,\n          isClick = x1 === x2 && y1 === y2;\n      // we iterate reverse order to collect top first in case of click.\n      for (var i = this._objects.length; i--; ) {\n        currentObject = this._objects[i];\n\n        if (!currentObject || !currentObject.selectable || !currentObject.visible) {\n          continue;\n        }\n\n        if ((allowIntersect && currentObject.intersectsWithRect(selectionX1Y1, selectionX2Y2, true)) ||\n            currentObject.isContainedWithinRect(selectionX1Y1, selectionX2Y2, true) ||\n            (allowIntersect && currentObject.containsPoint(selectionX1Y1, null, true)) ||\n            (allowIntersect && currentObject.containsPoint(selectionX2Y2, null, true))\n        ) {\n          group.push(currentObject);\n          // only add one object if it's a click\n          if (isClick) {\n            break;\n          }\n        }\n      }\n\n      if (group.length > 1) {\n        group = group.filter(function(object) {\n          return !object.onSelect({ e: e });\n        });\n      }\n\n      return group;\n    },\n\n    /**\n     * @private\n     */\n    _maybeGroupObjects: function(e) {\n      if (this.selection && this._groupSelector) {\n        this._groupSelectedObjects(e);\n      }\n      this.setCursor(this.defaultCursor);\n      // clear selection and current transformation\n      this._groupSelector = null;\n    }\n  });\n\n})();\n\n\n(function () {\n  fabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n    /**\n     * Exports canvas element to a dataurl image. Note that when multiplier is used, cropping is scaled appropriately\n     * @param {Object} [options] Options object\n     * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n     * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n     * @param {Number} [options.multiplier=1] Multiplier to scale by, to have consistent\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 2.0.0\n     * @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format\n     * @see {@link http://jsfiddle.net/fabricjs/NfZVb/|jsFiddle demo}\n     * @example <caption>Generate jpeg dataURL with lower quality</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'jpeg',\n     *   quality: 0.8\n     * });\n     * @example <caption>Generate cropped png dataURL (clipping of canvas)</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'png',\n     *   left: 100,\n     *   top: 100,\n     *   width: 200,\n     *   height: 200\n     * });\n     * @example <caption>Generate double scaled png dataURL</caption>\n     * var dataURL = canvas.toDataURL({\n     *   format: 'png',\n     *   multiplier: 2\n     * });\n     */\n    toDataURL: function (options) {\n      options || (options = { });\n\n      var format = options.format || 'png',\n          quality = options.quality || 1,\n          multiplier = (options.multiplier || 1) * (options.enableRetinaScaling ? this.getRetinaScaling() : 1),\n          canvasEl = this.toCanvasElement(multiplier, options);\n      return fabric.util.toDataURL(canvasEl, format, quality);\n    },\n\n    /**\n     * Create a new HTMLCanvas element painted with the current canvas content.\n     * No need to resize the actual one or repaint it.\n     * Will transfer object ownership to a new canvas, paint it, and set everything back.\n     * This is an intermediary step used to get to a dataUrl but also it is useful to\n     * create quick image copies of a canvas without passing for the dataUrl string\n     * @param {Number} [multiplier] a zoom factor.\n     * @param {Object} [cropping] Cropping informations\n     * @param {Number} [cropping.left] Cropping left offset.\n     * @param {Number} [cropping.top] Cropping top offset.\n     * @param {Number} [cropping.width] Cropping width.\n     * @param {Number} [cropping.height] Cropping height.\n     */\n    toCanvasElement: function(multiplier, cropping) {\n      multiplier = multiplier || 1;\n      cropping = cropping || { };\n      var scaledWidth = (cropping.width || this.width) * multiplier,\n          scaledHeight = (cropping.height || this.height) * multiplier,\n          zoom = this.getZoom(),\n          originalWidth = this.width,\n          originalHeight = this.height,\n          newZoom = zoom * multiplier,\n          vp = this.viewportTransform,\n          translateX = (vp[4] - (cropping.left || 0)) * multiplier,\n          translateY = (vp[5] - (cropping.top || 0)) * multiplier,\n          originalInteractive = this.interactive,\n          newVp = [newZoom, 0, 0, newZoom, translateX, translateY],\n          originalRetina = this.enableRetinaScaling,\n          canvasEl = fabric.util.createCanvasElement(),\n          originalContextTop = this.contextTop;\n      canvasEl.width = scaledWidth;\n      canvasEl.height = scaledHeight;\n      this.contextTop = null;\n      this.enableRetinaScaling = false;\n      this.interactive = false;\n      this.viewportTransform = newVp;\n      this.width = scaledWidth;\n      this.height = scaledHeight;\n      this.calcViewportBoundaries();\n      this.renderCanvas(canvasEl.getContext('2d'), this._objects);\n      this.viewportTransform = vp;\n      this.width = originalWidth;\n      this.height = originalHeight;\n      this.calcViewportBoundaries();\n      this.interactive = originalInteractive;\n      this.enableRetinaScaling = originalRetina;\n      this.contextTop = originalContextTop;\n      return canvasEl;\n    },\n  });\n\n})();\n\n\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n  /**\n   * Populates canvas with data from the specified JSON.\n   * JSON format must conform to the one of {@link fabric.Canvas#toJSON}\n   * @param {String|Object} json JSON string or object\n   * @param {Function} callback Callback, invoked when json is parsed\n   *                            and corresponding objects (e.g: {@link fabric.Image})\n   *                            are initialized\n   * @param {Function} [reviver] Method for further parsing of JSON elements, called after each fabric object created.\n   * @return {fabric.Canvas} instance\n   * @chainable\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#deserialization}\n   * @see {@link http://jsfiddle.net/fabricjs/fmgXt/|jsFiddle demo}\n   * @example <caption>loadFromJSON</caption>\n   * canvas.loadFromJSON(json, canvas.renderAll.bind(canvas));\n   * @example <caption>loadFromJSON with reviver</caption>\n   * canvas.loadFromJSON(json, canvas.renderAll.bind(canvas), function(o, object) {\n   *   // `o` = json object\n   *   // `object` = fabric.Object instance\n   *   // ... do some stuff ...\n   * });\n   */\n  loadFromJSON: function (json, callback, reviver) {\n    if (!json) {\n      return;\n    }\n\n    // serialize if it wasn't already\n    var serialized = (typeof json === 'string')\n      ? JSON.parse(json)\n      : fabric.util.object.clone(json);\n\n    var _this = this,\n        clipPath = serialized.clipPath,\n        renderOnAddRemove = this.renderOnAddRemove;\n\n    this.renderOnAddRemove = false;\n\n    delete serialized.clipPath;\n\n    this._enlivenObjects(serialized.objects, function (enlivenedObjects) {\n      _this.clear();\n      _this._setBgOverlay(serialized, function () {\n        if (clipPath) {\n          _this._enlivenObjects([clipPath], function (enlivenedCanvasClip) {\n            _this.clipPath = enlivenedCanvasClip[0];\n            _this.__setupCanvas.call(_this, serialized, enlivenedObjects, renderOnAddRemove, callback);\n          });\n        }\n        else {\n          _this.__setupCanvas.call(_this, serialized, enlivenedObjects, renderOnAddRemove, callback);\n        }\n      });\n    }, reviver);\n    return this;\n  },\n\n  /**\n   * @private\n   * @param {Object} serialized Object with background and overlay information\n   * @param {Array} restored canvas objects\n   * @param {Function} cached renderOnAddRemove callback\n   * @param {Function} callback Invoked after all background and overlay images/patterns loaded\n   */\n  __setupCanvas: function(serialized, enlivenedObjects, renderOnAddRemove, callback) {\n    var _this = this;\n    enlivenedObjects.forEach(function(obj, index) {\n      // we splice the array just in case some custom classes restored from JSON\n      // will add more object to canvas at canvas init.\n      _this.insertAt(obj, index);\n    });\n    this.renderOnAddRemove = renderOnAddRemove;\n    // remove parts i cannot set as options\n    delete serialized.objects;\n    delete serialized.backgroundImage;\n    delete serialized.overlayImage;\n    delete serialized.background;\n    delete serialized.overlay;\n    // this._initOptions does too many things to just\n    // call it. Normally loading an Object from JSON\n    // create the Object instance. Here the Canvas is\n    // already an instance and we are just loading things over it\n    this._setOptions(serialized);\n    this.renderAll();\n    callback && callback();\n  },\n\n  /**\n   * @private\n   * @param {Object} serialized Object with background and overlay information\n   * @param {Function} callback Invoked after all background and overlay images/patterns loaded\n   */\n  _setBgOverlay: function(serialized, callback) {\n    var loaded = {\n      backgroundColor: false,\n      overlayColor: false,\n      backgroundImage: false,\n      overlayImage: false\n    };\n\n    if (!serialized.backgroundImage && !serialized.overlayImage && !serialized.background && !serialized.overlay) {\n      callback && callback();\n      return;\n    }\n\n    var cbIfLoaded = function () {\n      if (loaded.backgroundImage && loaded.overlayImage && loaded.backgroundColor && loaded.overlayColor) {\n        callback && callback();\n      }\n    };\n\n    this.__setBgOverlay('backgroundImage', serialized.backgroundImage, loaded, cbIfLoaded);\n    this.__setBgOverlay('overlayImage', serialized.overlayImage, loaded, cbIfLoaded);\n    this.__setBgOverlay('backgroundColor', serialized.background, loaded, cbIfLoaded);\n    this.__setBgOverlay('overlayColor', serialized.overlay, loaded, cbIfLoaded);\n  },\n\n  /**\n   * @private\n   * @param {String} property Property to set (backgroundImage, overlayImage, backgroundColor, overlayColor)\n   * @param {(Object|String)} value Value to set\n   * @param {Object} loaded Set loaded property to true if property is set\n   * @param {Object} callback Callback function to invoke after property is set\n   */\n  __setBgOverlay: function(property, value, loaded, callback) {\n    var _this = this;\n\n    if (!value) {\n      loaded[property] = true;\n      callback && callback();\n      return;\n    }\n\n    if (property === 'backgroundImage' || property === 'overlayImage') {\n      fabric.util.enlivenObjects([value], function(enlivedObject){\n        _this[property] = enlivedObject[0];\n        loaded[property] = true;\n        callback && callback();\n      });\n    }\n    else {\n      this['set' + fabric.util.string.capitalize(property, true)](value, function() {\n        loaded[property] = true;\n        callback && callback();\n      });\n    }\n  },\n\n  /**\n   * @private\n   * @param {Array} objects\n   * @param {Function} callback\n   * @param {Function} [reviver]\n   */\n  _enlivenObjects: function (objects, callback, reviver) {\n    if (!objects || objects.length === 0) {\n      callback && callback([]);\n      return;\n    }\n\n    fabric.util.enlivenObjects(objects, function(enlivenedObjects) {\n      callback && callback(enlivenedObjects);\n    }, null, reviver);\n  },\n\n  /**\n   * @private\n   * @param {String} format\n   * @param {Function} callback\n   */\n  _toDataURL: function (format, callback) {\n    this.clone(function (clone) {\n      callback(clone.toDataURL(format));\n    });\n  },\n\n  /**\n   * @private\n   * @param {String} format\n   * @param {Number} multiplier\n   * @param {Function} callback\n   */\n  _toDataURLWithMultiplier: function (format, multiplier, callback) {\n    this.clone(function (clone) {\n      callback(clone.toDataURLWithMultiplier(format, multiplier));\n    });\n  },\n\n  /**\n   * Clones canvas instance\n   * @param {Object} [callback] Receives cloned instance as a first argument\n   * @param {Array} [properties] Array of properties to include in the cloned canvas and children\n   */\n  clone: function (callback, properties) {\n    var data = JSON.stringify(this.toJSON(properties));\n    this.cloneWithoutData(function(clone) {\n      clone.loadFromJSON(data, function() {\n        callback && callback(clone);\n      });\n    });\n  },\n\n  /**\n   * Clones canvas instance without cloning existing data.\n   * This essentially copies canvas dimensions, clipping properties, etc.\n   * but leaves data empty (so that you can populate it with your own)\n   * @param {Object} [callback] Receives cloned instance as a first argument\n   */\n  cloneWithoutData: function(callback) {\n    var el = fabric.util.createCanvasElement();\n\n    el.width = this.width;\n    el.height = this.height;\n\n    var clone = new fabric.Canvas(el);\n    if (this.backgroundImage) {\n      clone.setBackgroundImage(this.backgroundImage.src, function() {\n        clone.renderAll();\n        callback && callback(clone);\n      });\n      clone.backgroundImageOpacity = this.backgroundImageOpacity;\n      clone.backgroundImageStretch = this.backgroundImageStretch;\n    }\n    else {\n      callback && callback(clone);\n    }\n  }\n});\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      toFixed = fabric.util.toFixed,\n      capitalize = fabric.util.string.capitalize,\n      degreesToRadians = fabric.util.degreesToRadians,\n      objectCaching = !fabric.isLikelyNode,\n      ALIASING_LIMIT = 2;\n\n  if (fabric.Object) {\n    return;\n  }\n\n  /**\n   * Root object class from which all 2d shape classes inherit from\n   * @class fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#objects}\n   * @see {@link fabric.Object#initialize} for constructor definition\n   *\n   * @fires added\n   * @fires removed\n   *\n   * @fires selected\n   * @fires deselected\n   * @fires modified\n   * @fires modified\n   * @fires moved\n   * @fires scaled\n   * @fires rotated\n   * @fires skewed\n   *\n   * @fires rotating\n   * @fires scaling\n   * @fires moving\n   * @fires skewing\n   *\n   * @fires mousedown\n   * @fires mouseup\n   * @fires mouseover\n   * @fires mouseout\n   * @fires mousewheel\n   * @fires mousedblclick\n   *\n   * @fires dragover\n   * @fires dragenter\n   * @fires dragleave\n   * @fires drop\n   */\n  fabric.Object = fabric.util.createClass(fabric.CommonMethods, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Type of an object (rect, circle, path, etc.).\n     * Note that this property is meant to be read-only and not meant to be modified.\n     * If you modify, certain parts of Fabric (such as JSON loading) won't work correctly.\n     * @type String\n     * @default\n     */\n    type:                     'object',\n\n    /**\n     * Horizontal origin of transformation of an object (one of \"left\", \"right\", \"center\")\n     * See http://jsfiddle.net/1ow02gea/244/ on how originX/originY affect objects in groups\n     * @type String\n     * @default\n     */\n    originX:                  'left',\n\n    /**\n     * Vertical origin of transformation of an object (one of \"top\", \"bottom\", \"center\")\n     * See http://jsfiddle.net/1ow02gea/244/ on how originX/originY affect objects in groups\n     * @type String\n     * @default\n     */\n    originY:                  'top',\n\n    /**\n     * Top position of an object. Note that by default it's relative to object top. You can change this by setting originY={top/center/bottom}\n     * @type Number\n     * @default\n     */\n    top:                      0,\n\n    /**\n     * Left position of an object. Note that by default it's relative to object left. You can change this by setting originX={left/center/right}\n     * @type Number\n     * @default\n     */\n    left:                     0,\n\n    /**\n     * Object width\n     * @type Number\n     * @default\n     */\n    width:                    0,\n\n    /**\n     * Object height\n     * @type Number\n     * @default\n     */\n    height:                   0,\n\n    /**\n     * Object scale factor (horizontal)\n     * @type Number\n     * @default\n     */\n    scaleX:                   1,\n\n    /**\n     * Object scale factor (vertical)\n     * @type Number\n     * @default\n     */\n    scaleY:                   1,\n\n    /**\n     * When true, an object is rendered as flipped horizontally\n     * @type Boolean\n     * @default\n     */\n    flipX:                    false,\n\n    /**\n     * When true, an object is rendered as flipped vertically\n     * @type Boolean\n     * @default\n     */\n    flipY:                    false,\n\n    /**\n     * Opacity of an object\n     * @type Number\n     * @default\n     */\n    opacity:                  1,\n\n    /**\n     * Angle of rotation of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    angle:                    0,\n\n    /**\n     * Angle of skew on x axes of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    skewX:                    0,\n\n    /**\n     * Angle of skew on y axes of an object (in degrees)\n     * @type Number\n     * @default\n     */\n    skewY:                    0,\n\n    /**\n     * Size of object's controlling corners (in pixels)\n     * @type Number\n     * @default\n     */\n    cornerSize:               13,\n\n    /**\n     * Size of object's controlling corners when touch interaction is detected\n     * @type Number\n     * @default\n     */\n    touchCornerSize:               24,\n\n    /**\n     * When true, object's controlling corners are rendered as transparent inside (i.e. stroke instead of fill)\n     * @type Boolean\n     * @default\n     */\n    transparentCorners:       true,\n\n    /**\n     * Default cursor value used when hovering over this object on canvas\n     * @type String\n     * @default\n     */\n    hoverCursor:              null,\n\n    /**\n     * Default cursor value used when moving this object on canvas\n     * @type String\n     * @default\n     */\n    moveCursor:               null,\n\n    /**\n     * Padding between object and its controlling borders (in pixels)\n     * @type Number\n     * @default\n     */\n    padding:                  0,\n\n    /**\n     * Color of controlling borders of an object (when it's active)\n     * @type String\n     * @default\n     */\n    borderColor:              'rgb(178,204,255)',\n\n    /**\n     * Array specifying dash pattern of an object's borders (hasBorder must be true)\n     * @since 1.6.2\n     * @type Array\n     */\n    borderDashArray:          null,\n\n    /**\n     * Color of controlling corners of an object (when it's active)\n     * @type String\n     * @default\n     */\n    cornerColor:              'rgb(178,204,255)',\n\n    /**\n     * Color of controlling corners of an object (when it's active and transparentCorners false)\n     * @since 1.6.2\n     * @type String\n     * @default\n     */\n    cornerStrokeColor:        null,\n\n    /**\n     * Specify style of control, 'rect' or 'circle'\n     * @since 1.6.2\n     * @type String\n     */\n    cornerStyle:          'rect',\n\n    /**\n     * Array specifying dash pattern of an object's control (hasBorder must be true)\n     * @since 1.6.2\n     * @type Array\n     */\n    cornerDashArray:          null,\n\n    /**\n     * When true, this object will use center point as the origin of transformation\n     * when being scaled via the controls.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredScaling:          false,\n\n    /**\n     * When true, this object will use center point as the origin of transformation\n     * when being rotated via the controls.\n     * <b>Backwards incompatibility note:</b> This property replaces \"centerTransform\" (Boolean).\n     * @since 1.3.4\n     * @type Boolean\n     * @default\n     */\n    centeredRotation:         true,\n\n    /**\n     * Color of object's fill\n     * takes css colors https://www.w3.org/TR/css-color-3/\n     * @type String\n     * @default\n     */\n    fill:                     'rgb(0,0,0)',\n\n    /**\n     * Fill rule used to fill an object\n     * accepted values are nonzero, evenodd\n     * <b>Backwards incompatibility note:</b> This property was used for setting globalCompositeOperation until v1.4.12 (use `fabric.Object#globalCompositeOperation` instead)\n     * @type String\n     * @default\n     */\n    fillRule:                 'nonzero',\n\n    /**\n     * Composite rule used for canvas globalCompositeOperation\n     * @type String\n     * @default\n     */\n    globalCompositeOperation: 'source-over',\n\n    /**\n     * Background color of an object.\n     * takes css colors https://www.w3.org/TR/css-color-3/\n     * @type String\n     * @default\n     */\n    backgroundColor:          '',\n\n    /**\n     * Selection Background color of an object. colored layer behind the object when it is active.\n     * does not mix good with globalCompositeOperation methods.\n     * @type String\n     * @default\n     */\n    selectionBackgroundColor:          '',\n\n    /**\n     * When defined, an object is rendered via stroke and this property specifies its color\n     * takes css colors https://www.w3.org/TR/css-color-3/\n     * @type String\n     * @default\n     */\n    stroke:                   null,\n\n    /**\n     * Width of a stroke used to render this object\n     * @type Number\n     * @default\n     */\n    strokeWidth:              1,\n\n    /**\n     * Array specifying dash pattern of an object's stroke (stroke must be defined)\n     * @type Array\n     */\n    strokeDashArray:          null,\n\n    /**\n     * Line offset of an object's stroke\n     * @type Number\n     * @default\n     */\n    strokeDashOffset: 0,\n\n    /**\n     * Line endings style of an object's stroke (one of \"butt\", \"round\", \"square\")\n     * @type String\n     * @default\n     */\n    strokeLineCap:            'butt',\n\n    /**\n     * Corner style of an object's stroke (one of \"bevel\", \"round\", \"miter\")\n     * @type String\n     * @default\n     */\n    strokeLineJoin:           'miter',\n\n    /**\n     * Maximum miter length (used for strokeLineJoin = \"miter\") of an object's stroke\n     * @type Number\n     * @default\n     */\n    strokeMiterLimit:         4,\n\n    /**\n     * Shadow object representing shadow of this shape\n     * @type fabric.Shadow\n     * @default\n     */\n    shadow:                   null,\n\n    /**\n     * Opacity of object's controlling borders when object is active and moving\n     * @type Number\n     * @default\n     */\n    borderOpacityWhenMoving:  0.4,\n\n    /**\n     * Scale factor of object's controlling borders\n     * bigger number will make a thicker border\n     * border is 1, so this is basically a border thickness\n     * since there is no way to change the border itself.\n     * @type Number\n     * @default\n     */\n    borderScaleFactor:        1,\n\n    /**\n     * Minimum allowed scale value of an object\n     * @type Number\n     * @default\n     */\n    minScaleLimit:            0,\n\n    /**\n     * When set to `false`, an object can not be selected for modification (using either point-click-based or group-based selection).\n     * But events still fire on it.\n     * @type Boolean\n     * @default\n     */\n    selectable:               true,\n\n    /**\n     * When set to `false`, an object can not be a target of events. All events propagate through it. Introduced in v1.3.4\n     * @type Boolean\n     * @default\n     */\n    evented:                  true,\n\n    /**\n     * When set to `false`, an object is not rendered on canvas\n     * @type Boolean\n     * @default\n     */\n    visible:                  true,\n\n    /**\n     * When set to `false`, object's controls are not displayed and can not be used to manipulate object\n     * @type Boolean\n     * @default\n     */\n    hasControls:              true,\n\n    /**\n     * When set to `false`, object's controlling borders are not rendered\n     * @type Boolean\n     * @default\n     */\n    hasBorders:               true,\n\n    /**\n     * When set to `true`, objects are \"found\" on canvas on per-pixel basis rather than according to bounding box\n     * @type Boolean\n     * @default\n     */\n    perPixelTargetFind:       false,\n\n    /**\n     * When `false`, default object's values are not included in its serialization\n     * @type Boolean\n     * @default\n     */\n    includeDefaultValues:     true,\n\n    /**\n     * When `true`, object horizontal movement is locked\n     * @type Boolean\n     * @default\n     */\n    lockMovementX:            false,\n\n    /**\n     * When `true`, object vertical movement is locked\n     * @type Boolean\n     * @default\n     */\n    lockMovementY:            false,\n\n    /**\n     * When `true`, object rotation is locked\n     * @type Boolean\n     * @default\n     */\n    lockRotation:             false,\n\n    /**\n     * When `true`, object horizontal scaling is locked\n     * @type Boolean\n     * @default\n     */\n    lockScalingX:             false,\n\n    /**\n     * When `true`, object vertical scaling is locked\n     * @type Boolean\n     * @default\n     */\n    lockScalingY:             false,\n\n    /**\n     * When `true`, object horizontal skewing is locked\n     * @type Boolean\n     * @default\n     */\n    lockSkewingX:             false,\n\n    /**\n     * When `true`, object vertical skewing is locked\n     * @type Boolean\n     * @default\n     */\n    lockSkewingY:             false,\n\n    /**\n     * When `true`, object cannot be flipped by scaling into negative values\n     * @type Boolean\n     * @default\n     */\n    lockScalingFlip:          false,\n\n    /**\n     * When `true`, object is not exported in OBJECT/JSON\n     * @since 1.6.3\n     * @type Boolean\n     * @default\n     */\n    excludeFromExport:        false,\n\n    /**\n     * When `true`, object is cached on an additional canvas.\n     * When `false`, object is not cached unless necessary ( clipPath )\n     * default to true\n     * @since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    objectCaching:            objectCaching,\n\n    /**\n     * When `true`, object properties are checked for cache invalidation. In some particular\n     * situation you may want this to be disabled ( spray brush, very big, groups)\n     * or if your application does not allow you to modify properties for groups child you want\n     * to disable it for groups.\n     * default to false\n     * since 1.7.0\n     * @type Boolean\n     * @default false\n     */\n    statefullCache:            false,\n\n    /**\n     * When `true`, cache does not get updated during scaling. The picture will get blocky if scaled\n     * too much and will be redrawn with correct details at the end of scaling.\n     * this setting is performance and application dependant.\n     * default to true\n     * since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    noScaleCache:              true,\n\n    /**\n     * When `false`, the stoke width will scale with the object.\n     * When `true`, the stroke will always match the exact pixel size entered for stroke width.\n     * this Property does not work on Text classes or drawing call that uses strokeText,fillText methods\n     * default to false\n     * @since 2.6.0\n     * @type Boolean\n     * @default false\n     * @type Boolean\n     * @default false\n     */\n    strokeUniform:              false,\n\n    /**\n     * When set to `true`, object's cache will be rerendered next render call.\n     * since 1.7.0\n     * @type Boolean\n     * @default true\n     */\n    dirty:                true,\n\n    /**\n     * keeps the value of the last hovered corner during mouse move.\n     * 0 is no corner, or 'mt', 'ml', 'mtr' etc..\n     * It should be private, but there is no harm in using it as\n     * a read-only property.\n     * @type number|string|any\n     * @default 0\n     */\n    __corner: 0,\n\n    /**\n     * Determines if the fill or the stroke is drawn first (one of \"fill\" or \"stroke\")\n     * @type String\n     * @default\n     */\n    paintFirst:           'fill',\n\n    /**\n     * When 'down', object is set to active on mousedown/touchstart\n     * When 'up', object is set to active on mouseup/touchend\n     * Experimental. Let's see if this breaks anything before supporting officially\n     * @private\n     * since 4.4.0\n     * @type String\n     * @default 'down'\n     */\n    activeOn:           'down',\n\n    /**\n     * List of properties to consider when checking if state\n     * of an object is changed (fabric.Object#hasStateChanged)\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: (\n      'top left width height scaleX scaleY flipX flipY originX originY transformMatrix ' +\n      'stroke strokeWidth strokeDashArray strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit ' +\n      'angle opacity fill globalCompositeOperation shadow visible backgroundColor ' +\n      'skewX skewY fillRule paintFirst clipPath strokeUniform'\n    ).split(' '),\n\n    /**\n     * List of properties to consider when checking if cache needs refresh\n     * Those properties are checked by statefullCache ON ( or lazy mode if we want ) or from single\n     * calls to Object.set(key, value). If the key is in this list, the object is marked as dirty\n     * and refreshed at the next render\n     * @type Array\n     */\n    cacheProperties: (\n      'fill stroke strokeWidth strokeDashArray width height paintFirst strokeUniform' +\n      ' strokeLineCap strokeDashOffset strokeLineJoin strokeMiterLimit backgroundColor clipPath'\n    ).split(' '),\n\n    /**\n     * List of properties to consider for animating colors.\n     * @type Array\n     */\n    colorProperties: (\n      'fill stroke backgroundColor'\n    ).split(' '),\n\n    /**\n     * a fabricObject that, without stroke define a clipping area with their shape. filled in black\n     * the clipPath object gets used when the object has rendered, and the context is placed in the center\n     * of the object cacheCanvas.\n     * If you want 0,0 of a clipPath to align with an object center, use clipPath.originX/Y to 'center'\n     * @type fabric.Object\n     */\n    clipPath: undefined,\n\n    /**\n     * Meaningful ONLY when the object is used as clipPath.\n     * if true, the clipPath will make the object clip to the outside of the clipPath\n     * since 2.4.0\n     * @type boolean\n     * @default false\n     */\n    inverted: false,\n\n    /**\n     * Meaningful ONLY when the object is used as clipPath.\n     * if true, the clipPath will have its top and left relative to canvas, and will\n     * not be influenced by the object transform. This will make the clipPath relative\n     * to the canvas, but clipping just a particular object.\n     * WARNING this is beta, this feature may change or be renamed.\n     * since 2.4.0\n     * @type boolean\n     * @default false\n     */\n    absolutePositioned: false,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      if (options) {\n        this.setOptions(options);\n      }\n    },\n\n    /**\n     * Create a the canvas used to keep the cached copy of the object\n     * @private\n     */\n    _createCacheCanvas: function() {\n      this._cacheProperties = {};\n      this._cacheCanvas = fabric.util.createCanvasElement();\n      this._cacheContext = this._cacheCanvas.getContext('2d');\n      this._updateCacheCanvas();\n      // if canvas gets created, is empty, so dirty.\n      this.dirty = true;\n    },\n\n    /**\n     * Limit the cache dimensions so that X * Y do not cross fabric.perfLimitSizeTotal\n     * and each side do not cross fabric.cacheSideLimit\n     * those numbers are configurable so that you can get as much detail as you want\n     * making bargain with performances.\n     * @param {Object} dims\n     * @param {Object} dims.width width of canvas\n     * @param {Object} dims.height height of canvas\n     * @param {Object} dims.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @param {Object} dims.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _limitCacheSize: function(dims) {\n      var perfLimitSizeTotal = fabric.perfLimitSizeTotal,\n          width = dims.width, height = dims.height,\n          max = fabric.maxCacheSideLimit, min = fabric.minCacheSideLimit;\n      if (width <= max && height <= max && width * height <= perfLimitSizeTotal) {\n        if (width < min) {\n          dims.width = min;\n        }\n        if (height < min) {\n          dims.height = min;\n        }\n        return dims;\n      }\n      var ar = width / height, limitedDims = fabric.util.limitDimsByArea(ar, perfLimitSizeTotal),\n          capValue = fabric.util.capValue,\n          x = capValue(min, limitedDims.x, max),\n          y = capValue(min, limitedDims.y, max);\n      if (width > x) {\n        dims.zoomX /= width / x;\n        dims.width = x;\n        dims.capped = true;\n      }\n      if (height > y) {\n        dims.zoomY /= height / y;\n        dims.height = y;\n        dims.capped = true;\n      }\n      return dims;\n    },\n\n    /**\n     * Return the dimension and the zoom level needed to create a cache canvas\n     * big enough to host the object to be cached.\n     * @private\n     * @return {Object}.x width of object to be cached\n     * @return {Object}.y height of object to be cached\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _getCacheCanvasDimensions: function() {\n      var objectScale = this.getTotalObjectScaling(),\n          // caculate dimensions without skewing\n          dim = this._getTransformedDimensions(0, 0),\n          neededX = dim.x * objectScale.scaleX / this.scaleX,\n          neededY = dim.y * objectScale.scaleY / this.scaleY;\n      return {\n        // for sure this ALIASING_LIMIT is slightly creating problem\n        // in situation in which the cache canvas gets an upper limit\n        // also objectScale contains already scaleX and scaleY\n        width: neededX + ALIASING_LIMIT,\n        height: neededY + ALIASING_LIMIT,\n        zoomX: objectScale.scaleX,\n        zoomY: objectScale.scaleY,\n        x: neededX,\n        y: neededY\n      };\n    },\n\n    /**\n     * Update width and height of the canvas for cache\n     * returns true or false if canvas needed resize.\n     * @private\n     * @return {Boolean} true if the canvas has been resized\n     */\n    _updateCacheCanvas: function() {\n      var targetCanvas = this.canvas;\n      if (this.noScaleCache && targetCanvas && targetCanvas._currentTransform) {\n        var target = targetCanvas._currentTransform.target,\n            action = targetCanvas._currentTransform.action;\n        if (this === target && action.slice && action.slice(0, 5) === 'scale') {\n          return false;\n        }\n      }\n      var canvas = this._cacheCanvas,\n          dims = this._limitCacheSize(this._getCacheCanvasDimensions()),\n          minCacheSize = fabric.minCacheSideLimit,\n          width = dims.width, height = dims.height, drawingWidth, drawingHeight,\n          zoomX = dims.zoomX, zoomY = dims.zoomY,\n          dimensionsChanged = width !== this.cacheWidth || height !== this.cacheHeight,\n          zoomChanged = this.zoomX !== zoomX || this.zoomY !== zoomY,\n          shouldRedraw = dimensionsChanged || zoomChanged,\n          additionalWidth = 0, additionalHeight = 0, shouldResizeCanvas = false;\n      if (dimensionsChanged) {\n        var canvasWidth = this._cacheCanvas.width,\n            canvasHeight = this._cacheCanvas.height,\n            sizeGrowing = width > canvasWidth || height > canvasHeight,\n            sizeShrinking = (width < canvasWidth * 0.9 || height < canvasHeight * 0.9) &&\n              canvasWidth > minCacheSize && canvasHeight > minCacheSize;\n        shouldResizeCanvas = sizeGrowing || sizeShrinking;\n        if (sizeGrowing && !dims.capped && (width > minCacheSize || height > minCacheSize)) {\n          additionalWidth = width * 0.1;\n          additionalHeight = height * 0.1;\n        }\n      }\n      if (this instanceof fabric.Text && this.path) {\n        shouldRedraw = true;\n        shouldResizeCanvas = true;\n        additionalWidth += this.getHeightOfLine(0) * this.zoomX;\n        additionalHeight += this.getHeightOfLine(0) * this.zoomY;\n      }\n      if (shouldRedraw) {\n        if (shouldResizeCanvas) {\n          canvas.width = Math.ceil(width + additionalWidth);\n          canvas.height = Math.ceil(height + additionalHeight);\n        }\n        else {\n          this._cacheContext.setTransform(1, 0, 0, 1, 0, 0);\n          this._cacheContext.clearRect(0, 0, canvas.width, canvas.height);\n        }\n        drawingWidth = dims.x / 2;\n        drawingHeight = dims.y / 2;\n        this.cacheTranslationX = Math.round(canvas.width / 2 - drawingWidth) + drawingWidth;\n        this.cacheTranslationY = Math.round(canvas.height / 2 - drawingHeight) + drawingHeight;\n        this.cacheWidth = width;\n        this.cacheHeight = height;\n        this._cacheContext.translate(this.cacheTranslationX, this.cacheTranslationY);\n        this._cacheContext.scale(zoomX, zoomY);\n        this.zoomX = zoomX;\n        this.zoomY = zoomY;\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Sets object's properties from options\n     * @param {Object} [options] Options object\n     */\n    setOptions: function(options) {\n      this._setOptions(options);\n      this._initGradient(options.fill, 'fill');\n      this._initGradient(options.stroke, 'stroke');\n      this._initPattern(options.fill, 'fill');\n      this._initPattern(options.stroke, 'stroke');\n    },\n\n    /**\n     * Transforms context when rendering an object\n     * @param {CanvasRenderingContext2D} ctx Context\n     */\n    transform: function(ctx) {\n      var needFullTransform = (this.group && !this.group._transformDone) ||\n         (this.group && this.canvas && ctx === this.canvas.contextTop);\n      var m = this.calcTransformMatrix(!needFullTransform);\n      ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n    },\n\n    /**\n     * Returns an object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS,\n\n          object = {\n            type:                     this.type,\n            version:                  fabric.version,\n            originX:                  this.originX,\n            originY:                  this.originY,\n            left:                     toFixed(this.left, NUM_FRACTION_DIGITS),\n            top:                      toFixed(this.top, NUM_FRACTION_DIGITS),\n            width:                    toFixed(this.width, NUM_FRACTION_DIGITS),\n            height:                   toFixed(this.height, NUM_FRACTION_DIGITS),\n            fill:                     (this.fill && this.fill.toObject) ? this.fill.toObject() : this.fill,\n            stroke:                   (this.stroke && this.stroke.toObject) ? this.stroke.toObject() : this.stroke,\n            strokeWidth:              toFixed(this.strokeWidth, NUM_FRACTION_DIGITS),\n            strokeDashArray:          this.strokeDashArray ? this.strokeDashArray.concat() : this.strokeDashArray,\n            strokeLineCap:            this.strokeLineCap,\n            strokeDashOffset:         this.strokeDashOffset,\n            strokeLineJoin:           this.strokeLineJoin,\n            strokeUniform:            this.strokeUniform,\n            strokeMiterLimit:         toFixed(this.strokeMiterLimit, NUM_FRACTION_DIGITS),\n            scaleX:                   toFixed(this.scaleX, NUM_FRACTION_DIGITS),\n            scaleY:                   toFixed(this.scaleY, NUM_FRACTION_DIGITS),\n            angle:                    toFixed(this.angle, NUM_FRACTION_DIGITS),\n            flipX:                    this.flipX,\n            flipY:                    this.flipY,\n            opacity:                  toFixed(this.opacity, NUM_FRACTION_DIGITS),\n            shadow:                   (this.shadow && this.shadow.toObject) ? this.shadow.toObject() : this.shadow,\n            visible:                  this.visible,\n            backgroundColor:          this.backgroundColor,\n            fillRule:                 this.fillRule,\n            paintFirst:               this.paintFirst,\n            globalCompositeOperation: this.globalCompositeOperation,\n            skewX:                    toFixed(this.skewX, NUM_FRACTION_DIGITS),\n            skewY:                    toFixed(this.skewY, NUM_FRACTION_DIGITS),\n          };\n\n      if (this.clipPath && !this.clipPath.excludeFromExport) {\n        object.clipPath = this.clipPath.toObject(propertiesToInclude);\n        object.clipPath.inverted = this.clipPath.inverted;\n        object.clipPath.absolutePositioned = this.clipPath.absolutePositioned;\n      }\n\n      fabric.util.populateWithProperties(this, object, propertiesToInclude);\n      if (!this.includeDefaultValues) {\n        object = this._removeDefaultValues(object);\n      }\n\n      return object;\n    },\n\n    /**\n     * Returns (dataless) object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      // will be overwritten by subclasses\n      return this.toObject(propertiesToInclude);\n    },\n\n    /**\n     * @private\n     * @param {Object} object\n     */\n    _removeDefaultValues: function(object) {\n      var prototype = fabric.util.getKlass(object.type).prototype,\n          stateProperties = prototype.stateProperties;\n      stateProperties.forEach(function(prop) {\n        if (prop === 'left' || prop === 'top') {\n          return;\n        }\n        if (object[prop] === prototype[prop]) {\n          delete object[prop];\n        }\n        // basically a check for [] === []\n        if (Array.isArray(object[prop]) && Array.isArray(prototype[prop])\n          && object[prop].length === 0 && prototype[prop].length === 0) {\n          delete object[prop];\n        }\n      });\n\n      return object;\n    },\n\n    /**\n     * Returns a string representation of an instance\n     * @return {String}\n     */\n    toString: function() {\n      return '#<fabric.' + capitalize(this.type) + '>';\n    },\n\n    /**\n     * Return the object scale factor counting also the group scaling\n     * @return {Object} object with scaleX and scaleY properties\n     */\n    getObjectScaling: function() {\n      // if the object is a top level one, on the canvas, we go for simple aritmetic\n      // otherwise the complex method with angles will return approximations and decimals\n      // and will likely kill the cache when not needed\n      // https://github.com/fabricjs/fabric.js/issues/7157\n      if (!this.group) {\n        return {\n          scaleX: this.scaleX,\n          scaleY: this.scaleY,\n        };\n      }\n      // if we are inside a group total zoom calculation is complex, we defer to generic matrices\n      var options = fabric.util.qrDecompose(this.calcTransformMatrix());\n      return { scaleX: Math.abs(options.scaleX), scaleY: Math.abs(options.scaleY) };\n    },\n\n    /**\n     * Return the object scale factor counting also the group scaling, zoom and retina\n     * @return {Object} object with scaleX and scaleY properties\n     */\n    getTotalObjectScaling: function() {\n      var scale = this.getObjectScaling(), scaleX = scale.scaleX, scaleY = scale.scaleY;\n      if (this.canvas) {\n        var zoom = this.canvas.getZoom();\n        var retina = this.canvas.getRetinaScaling();\n        scaleX *= zoom * retina;\n        scaleY *= zoom * retina;\n      }\n      return { scaleX: scaleX, scaleY: scaleY };\n    },\n\n    /**\n     * Return the object opacity counting also the group property\n     * @return {Number}\n     */\n    getObjectOpacity: function() {\n      var opacity = this.opacity;\n      if (this.group) {\n        opacity *= this.group.getObjectOpacity();\n      }\n      return opacity;\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Object} thisArg\n     */\n    _set: function(key, value) {\n      var shouldConstrainValue = (key === 'scaleX' || key === 'scaleY'),\n          isChanged = this[key] !== value, groupNeedsUpdate = false;\n\n      if (shouldConstrainValue) {\n        value = this._constrainScale(value);\n      }\n      if (key === 'scaleX' && value < 0) {\n        this.flipX = !this.flipX;\n        value *= -1;\n      }\n      else if (key === 'scaleY' && value < 0) {\n        this.flipY = !this.flipY;\n        value *= -1;\n      }\n      else if (key === 'shadow' && value && !(value instanceof fabric.Shadow)) {\n        value = new fabric.Shadow(value);\n      }\n      else if (key === 'dirty' && this.group) {\n        this.group.set('dirty', value);\n      }\n\n      this[key] = value;\n\n      if (isChanged) {\n        groupNeedsUpdate = this.group && this.group.isOnACache();\n        if (this.cacheProperties.indexOf(key) > -1) {\n          this.dirty = true;\n          groupNeedsUpdate && this.group.set('dirty', true);\n        }\n        else if (groupNeedsUpdate && this.stateProperties.indexOf(key) > -1) {\n          this.group.set('dirty', true);\n        }\n      }\n      return this;\n    },\n\n    /**\n     * This callback function is called by the parent group of an object every\n     * time a non-delegated property changes on the group. It is passed the key\n     * and value as parameters. Not adding in this function's signature to avoid\n     * Travis build error about unused variables.\n     */\n    setOnGroup: function() {\n      // implemented by sub-classes, as needed.\n    },\n\n    /**\n     * Retrieves viewportTransform from Object's canvas if possible\n     * @method getViewportTransform\n     * @memberOf fabric.Object.prototype\n     * @return {Array}\n     */\n    getViewportTransform: function() {\n      if (this.canvas && this.canvas.viewportTransform) {\n        return this.canvas.viewportTransform;\n      }\n      return fabric.iMatrix.concat();\n    },\n\n    /*\n     * @private\n     * return if the object would be visible in rendering\n     * @memberOf fabric.Object.prototype\n     * @return {Boolean}\n     */\n    isNotVisible: function() {\n      return this.opacity === 0 ||\n        (!this.width && !this.height && this.strokeWidth === 0) ||\n        !this.visible;\n    },\n\n    /**\n     * Renders an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    render: function(ctx) {\n      // do not render if width/height are zeros or object is not visible\n      if (this.isNotVisible()) {\n        return;\n      }\n      if (this.canvas && this.canvas.skipOffscreen && !this.group && !this.isOnScreen()) {\n        return;\n      }\n      ctx.save();\n      this._setupCompositeOperation(ctx);\n      this.drawSelectionBackground(ctx);\n      this.transform(ctx);\n      this._setOpacity(ctx);\n      this._setShadow(ctx, this);\n      if (this.shouldCache()) {\n        this.renderCache();\n        this.drawCacheOnCanvas(ctx);\n      }\n      else {\n        this._removeCacheCanvas();\n        this.dirty = false;\n        this.drawObject(ctx);\n        if (this.objectCaching && this.statefullCache) {\n          this.saveState({ propertySet: 'cacheProperties' });\n        }\n      }\n      ctx.restore();\n    },\n\n    renderCache: function(options) {\n      options = options || {};\n      if (!this._cacheCanvas || !this._cacheContext) {\n        this._createCacheCanvas();\n      }\n      if (this.isCacheDirty()) {\n        this.statefullCache && this.saveState({ propertySet: 'cacheProperties' });\n        this.drawObject(this._cacheContext, options.forClipping);\n        this.dirty = false;\n      }\n    },\n\n    /**\n     * Remove cacheCanvas and its dimensions from the objects\n     */\n    _removeCacheCanvas: function() {\n      this._cacheCanvas = null;\n      this._cacheContext = null;\n      this.cacheWidth = 0;\n      this.cacheHeight = 0;\n    },\n\n    /**\n     * return true if the object will draw a stroke\n     * Does not consider text styles. This is just a shortcut used at rendering time\n     * We want it to be an approximation and be fast.\n     * wrote to avoid extra caching, it has to return true when stroke happens,\n     * can guess when it will not happen at 100% chance, does not matter if it misses\n     * some use case where the stroke is invisible.\n     * @since 3.0.0\n     * @returns Boolean\n     */\n    hasStroke: function() {\n      return this.stroke && this.stroke !== 'transparent' && this.strokeWidth !== 0;\n    },\n\n    /**\n     * return true if the object will draw a fill\n     * Does not consider text styles. This is just a shortcut used at rendering time\n     * We want it to be an approximation and be fast.\n     * wrote to avoid extra caching, it has to return true when fill happens,\n     * can guess when it will not happen at 100% chance, does not matter if it misses\n     * some use case where the fill is invisible.\n     * @since 3.0.0\n     * @returns Boolean\n     */\n    hasFill: function() {\n      return this.fill && this.fill !== 'transparent';\n    },\n\n    /**\n     * When set to `true`, force the object to have its own cache, even if it is inside a group\n     * it may be needed when your object behave in a particular way on the cache and always needs\n     * its own isolated canvas to render correctly.\n     * Created to be overridden\n     * since 1.7.12\n     * @returns Boolean\n     */\n    needsItsOwnCache: function() {\n      if (this.paintFirst === 'stroke' &&\n        this.hasFill() && this.hasStroke() && typeof this.shadow === 'object') {\n        return true;\n      }\n      if (this.clipPath) {\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Decide if the object should cache or not. Create its own cache level\n     * objectCaching is a global flag, wins over everything\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * Read as: cache if is needed, or if the feature is enabled but we are not already caching.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      this.ownCaching = this.needsItsOwnCache() || (\n        this.objectCaching &&\n        (!this.group || !this.group.isOnACache())\n      );\n      return this.ownCaching;\n    },\n\n    /**\n     * Check if this object or a child object will cast a shadow\n     * used by Group.shouldCache to know if child has a shadow recursively\n     * @return {Boolean}\n     */\n    willDrawShadow: function() {\n      return !!this.shadow && (this.shadow.offsetX !== 0 || this.shadow.offsetY !== 0);\n    },\n\n    /**\n     * Execute the drawing operation for an object clipPath\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {fabric.Object} clipPath\n     */\n    drawClipPathOnCache: function(ctx, clipPath) {\n      ctx.save();\n      // DEBUG: uncomment this line, comment the following\n      // ctx.globalAlpha = 0.4\n      if (clipPath.inverted) {\n        ctx.globalCompositeOperation = 'destination-out';\n      }\n      else {\n        ctx.globalCompositeOperation = 'destination-in';\n      }\n      //ctx.scale(1 / 2, 1 / 2);\n      if (clipPath.absolutePositioned) {\n        var m = fabric.util.invertTransform(this.calcTransformMatrix());\n        ctx.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n      }\n      clipPath.transform(ctx);\n      ctx.scale(1 / clipPath.zoomX, 1 / clipPath.zoomY);\n      ctx.drawImage(clipPath._cacheCanvas, -clipPath.cacheTranslationX, -clipPath.cacheTranslationY);\n      ctx.restore();\n    },\n\n    /**\n     * Execute the drawing operation for an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawObject: function(ctx, forClipping) {\n      var originalFill = this.fill, originalStroke = this.stroke;\n      if (forClipping) {\n        this.fill = 'black';\n        this.stroke = '';\n        this._setClippingProperties(ctx);\n      }\n      else {\n        this._renderBackground(ctx);\n      }\n      this._render(ctx);\n      this._drawClipPath(ctx, this.clipPath);\n      this.fill = originalFill;\n      this.stroke = originalStroke;\n    },\n\n    /**\n     * Prepare clipPath state and cache and draw it on instance's cache\n     * @param {CanvasRenderingContext2D} ctx\n     * @param {fabric.Object} clipPath\n     */\n    _drawClipPath: function (ctx, clipPath) {\n      if (!clipPath) { return; }\n      // needed to setup a couple of variables\n      // path canvas gets overridden with this one.\n      // TODO find a better solution?\n      clipPath.canvas = this.canvas;\n      clipPath.shouldCache();\n      clipPath._transformDone = true;\n      clipPath.renderCache({ forClipping: true });\n      this.drawClipPathOnCache(ctx, clipPath);\n    },\n\n    /**\n     * Paint the cached copy of the object on the target context.\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawCacheOnCanvas: function(ctx) {\n      ctx.scale(1 / this.zoomX, 1 / this.zoomY);\n      ctx.drawImage(this._cacheCanvas, -this.cacheTranslationX, -this.cacheTranslationY);\n    },\n\n    /**\n     * Check if cache is dirty\n     * @param {Boolean} skipCanvas skip canvas checks because this object is painted\n     * on parent canvas.\n     */\n    isCacheDirty: function(skipCanvas) {\n      if (this.isNotVisible()) {\n        return false;\n      }\n      if (this._cacheCanvas && this._cacheContext && !skipCanvas && this._updateCacheCanvas()) {\n        // in this case the context is already cleared.\n        return true;\n      }\n      else {\n        if (this.dirty ||\n          (this.clipPath && this.clipPath.absolutePositioned) ||\n          (this.statefullCache && this.hasStateChanged('cacheProperties'))\n        ) {\n          if (this._cacheCanvas && this._cacheContext && !skipCanvas) {\n            var width = this.cacheWidth / this.zoomX;\n            var height = this.cacheHeight / this.zoomY;\n            this._cacheContext.clearRect(-width / 2, -height / 2, width, height);\n          }\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Draws a background for the object big as its untransformed dimensions\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderBackground: function(ctx) {\n      if (!this.backgroundColor) {\n        return;\n      }\n      var dim = this._getNonTransformedDimensions();\n      ctx.fillStyle = this.backgroundColor;\n\n      ctx.fillRect(\n        -dim.x / 2,\n        -dim.y / 2,\n        dim.x,\n        dim.y\n      );\n      // if there is background color no other shadows\n      // should be casted\n      this._removeShadow(ctx);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _setOpacity: function(ctx) {\n      if (this.group && !this.group._transformDone) {\n        ctx.globalAlpha = this.getObjectOpacity();\n      }\n      else {\n        ctx.globalAlpha *= this.opacity;\n      }\n    },\n\n    _setStrokeStyles: function(ctx, decl) {\n      var stroke = decl.stroke;\n      if (stroke) {\n        ctx.lineWidth = decl.strokeWidth;\n        ctx.lineCap = decl.strokeLineCap;\n        ctx.lineDashOffset = decl.strokeDashOffset;\n        ctx.lineJoin = decl.strokeLineJoin;\n        ctx.miterLimit = decl.strokeMiterLimit;\n        if (stroke.toLive) {\n          if (stroke.gradientUnits === 'percentage' || stroke.gradientTransform || stroke.patternTransform) {\n            // need to transform gradient in a pattern.\n            // this is a slow process. If you are hitting this codepath, and the object\n            // is not using caching, you should consider switching it on.\n            // we need a canvas as big as the current object caching canvas.\n            this._applyPatternForTransformedGradient(ctx, stroke);\n          }\n          else {\n            // is a simple gradient or pattern\n            ctx.strokeStyle = stroke.toLive(ctx, this);\n            this._applyPatternGradientTransform(ctx, stroke);\n          }\n        }\n        else {\n          // is a color\n          ctx.strokeStyle = decl.stroke;\n        }\n      }\n    },\n\n    _setFillStyles: function(ctx, decl) {\n      var fill = decl.fill;\n      if (fill) {\n        if (fill.toLive) {\n          ctx.fillStyle = fill.toLive(ctx, this);\n          this._applyPatternGradientTransform(ctx, decl.fill);\n        }\n        else {\n          ctx.fillStyle = fill;\n        }\n      }\n    },\n\n    _setClippingProperties: function(ctx) {\n      ctx.globalAlpha = 1;\n      ctx.strokeStyle = 'transparent';\n      ctx.fillStyle = '#000000';\n    },\n\n    /**\n     * @private\n     * Sets line dash\n     * @param {CanvasRenderingContext2D} ctx Context to set the dash line on\n     * @param {Array} dashArray array representing dashes\n     */\n    _setLineDash: function(ctx, dashArray) {\n      if (!dashArray || dashArray.length === 0) {\n        return;\n      }\n      // Spec requires the concatenation of two copies the dash list when the number of elements is odd\n      if (1 & dashArray.length) {\n        dashArray.push.apply(dashArray, dashArray);\n      }\n      ctx.setLineDash(dashArray);\n    },\n\n    /**\n     * Renders controls and borders for the object\n     * the context here is not transformed\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} [styleOverride] properties to override the object style\n     */\n    _renderControls: function(ctx, styleOverride) {\n      var vpt = this.getViewportTransform(),\n          matrix = this.calcTransformMatrix(),\n          options, drawBorders, drawControls;\n      styleOverride = styleOverride || { };\n      drawBorders = typeof styleOverride.hasBorders !== 'undefined' ? styleOverride.hasBorders : this.hasBorders;\n      drawControls = typeof styleOverride.hasControls !== 'undefined' ? styleOverride.hasControls : this.hasControls;\n      matrix = fabric.util.multiplyTransformMatrices(vpt, matrix);\n      options = fabric.util.qrDecompose(matrix);\n      ctx.save();\n      ctx.translate(options.translateX, options.translateY);\n      ctx.lineWidth = 1 * this.borderScaleFactor;\n      if (!this.group) {\n        ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;\n      }\n      if (this.flipX) {\n        options.angle -= 180;\n      }\n      ctx.rotate(degreesToRadians(this.group ? options.angle : this.angle));\n      if (styleOverride.forActiveSelection || this.group) {\n        drawBorders && this.drawBordersInGroup(ctx, options, styleOverride);\n      }\n      else {\n        drawBorders && this.drawBorders(ctx, styleOverride);\n      }\n      drawControls && this.drawControls(ctx, styleOverride);\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _setShadow: function(ctx) {\n      if (!this.shadow) {\n        return;\n      }\n\n      var shadow = this.shadow, canvas = this.canvas, scaling,\n          multX = (canvas && canvas.viewportTransform[0]) || 1,\n          multY = (canvas && canvas.viewportTransform[3]) || 1;\n      if (shadow.nonScaling) {\n        scaling = { scaleX: 1, scaleY: 1 };\n      }\n      else {\n        scaling = this.getObjectScaling();\n      }\n      if (canvas && canvas._isRetinaScaling()) {\n        multX *= fabric.devicePixelRatio;\n        multY *= fabric.devicePixelRatio;\n      }\n      ctx.shadowColor = shadow.color;\n      ctx.shadowBlur = shadow.blur * fabric.browserShadowBlurConstant *\n        (multX + multY) * (scaling.scaleX + scaling.scaleY) / 4;\n      ctx.shadowOffsetX = shadow.offsetX * multX * scaling.scaleX;\n      ctx.shadowOffsetY = shadow.offsetY * multY * scaling.scaleY;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _removeShadow: function(ctx) {\n      if (!this.shadow) {\n        return;\n      }\n\n      ctx.shadowColor = '';\n      ctx.shadowBlur = ctx.shadowOffsetX = ctx.shadowOffsetY = 0;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} filler fabric.Pattern or fabric.Gradient\n     * @return {Object} offset.offsetX offset for text rendering\n     * @return {Object} offset.offsetY offset for text rendering\n     */\n    _applyPatternGradientTransform: function(ctx, filler) {\n      if (!filler || !filler.toLive) {\n        return { offsetX: 0, offsetY: 0 };\n      }\n      var t = filler.gradientTransform || filler.patternTransform;\n      var offsetX = -this.width / 2 + filler.offsetX || 0,\n          offsetY = -this.height / 2 + filler.offsetY || 0;\n\n      if (filler.gradientUnits === 'percentage') {\n        ctx.transform(this.width, 0, 0, this.height, offsetX, offsetY);\n      }\n      else {\n        ctx.transform(1, 0, 0, 1, offsetX, offsetY);\n      }\n      if (t) {\n        ctx.transform(t[0], t[1], t[2], t[3], t[4], t[5]);\n      }\n      return { offsetX: offsetX, offsetY: offsetY };\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderPaintInOrder: function(ctx) {\n      if (this.paintFirst === 'stroke') {\n        this._renderStroke(ctx);\n        this._renderFill(ctx);\n      }\n      else {\n        this._renderFill(ctx);\n        this._renderStroke(ctx);\n      }\n    },\n\n    /**\n     * @private\n     * function that actually render something on the context.\n     * empty here to allow Obects to work on tests to benchmark fabric functionalites\n     * not related to rendering\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(/* ctx */) {\n\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderFill: function(ctx) {\n      if (!this.fill) {\n        return;\n      }\n\n      ctx.save();\n      this._setFillStyles(ctx, this);\n      if (this.fillRule === 'evenodd') {\n        ctx.fill('evenodd');\n      }\n      else {\n        ctx.fill();\n      }\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderStroke: function(ctx) {\n      if (!this.stroke || this.strokeWidth === 0) {\n        return;\n      }\n\n      if (this.shadow && !this.shadow.affectStroke) {\n        this._removeShadow(ctx);\n      }\n\n      ctx.save();\n      if (this.strokeUniform && this.group) {\n        var scaling = this.getObjectScaling();\n        ctx.scale(1 / scaling.scaleX, 1 / scaling.scaleY);\n      }\n      else if (this.strokeUniform) {\n        ctx.scale(1 / this.scaleX, 1 / this.scaleY);\n      }\n      this._setLineDash(ctx, this.strokeDashArray);\n      this._setStrokeStyles(ctx, this);\n      ctx.stroke();\n      ctx.restore();\n    },\n\n    /**\n     * This function try to patch the missing gradientTransform on canvas gradients.\n     * transforming a context to transform the gradient, is going to transform the stroke too.\n     * we want to transform the gradient but not the stroke operation, so we create\n     * a transformed gradient on a pattern and then we use the pattern instead of the gradient.\n     * this method has drwabacks: is slow, is in low resolution, needs a patch for when the size\n     * is limited.\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {fabric.Gradient} filler a fabric gradient instance\n     */\n    _applyPatternForTransformedGradient: function(ctx, filler) {\n      var dims = this._limitCacheSize(this._getCacheCanvasDimensions()),\n          pCanvas = fabric.util.createCanvasElement(), pCtx, retinaScaling = this.canvas.getRetinaScaling(),\n          width = dims.x / this.scaleX / retinaScaling, height = dims.y / this.scaleY / retinaScaling;\n      pCanvas.width = width;\n      pCanvas.height = height;\n      pCtx = pCanvas.getContext('2d');\n      pCtx.beginPath(); pCtx.moveTo(0, 0); pCtx.lineTo(width, 0); pCtx.lineTo(width, height);\n      pCtx.lineTo(0, height); pCtx.closePath();\n      pCtx.translate(width / 2, height / 2);\n      pCtx.scale(\n        dims.zoomX / this.scaleX / retinaScaling,\n        dims.zoomY / this.scaleY / retinaScaling\n      );\n      this._applyPatternGradientTransform(pCtx, filler);\n      pCtx.fillStyle = filler.toLive(ctx);\n      pCtx.fill();\n      ctx.translate(-this.width / 2 - this.strokeWidth / 2, -this.height / 2 - this.strokeWidth / 2);\n      ctx.scale(\n        retinaScaling * this.scaleX / dims.zoomX,\n        retinaScaling * this.scaleY / dims.zoomY\n      );\n      ctx.strokeStyle = pCtx.createPattern(pCanvas, 'no-repeat');\n    },\n\n    /**\n     * This function is an helper for svg import. it returns the center of the object in the svg\n     * untransformed coordinates\n     * @private\n     * @return {Object} center point from element coordinates\n     */\n    _findCenterFromElement: function() {\n      return { x: this.left + this.width / 2, y: this.top + this.height / 2 };\n    },\n\n    /**\n     * This function is an helper for svg import. it decompose the transformMatrix\n     * and assign properties to object.\n     * untransformed coordinates\n     * @private\n     * @chainable\n     */\n    _assignTransformMatrixProps: function() {\n      if (this.transformMatrix) {\n        var options = fabric.util.qrDecompose(this.transformMatrix);\n        this.flipX = false;\n        this.flipY = false;\n        this.set('scaleX', options.scaleX);\n        this.set('scaleY', options.scaleY);\n        this.angle = options.angle;\n        this.skewX = options.skewX;\n        this.skewY = 0;\n      }\n    },\n\n    /**\n     * This function is an helper for svg import. it removes the transform matrix\n     * and set to object properties that fabricjs can handle\n     * @private\n     * @param {Object} preserveAspectRatioOptions\n     * @return {thisArg}\n     */\n    _removeTransformMatrix: function(preserveAspectRatioOptions) {\n      var center = this._findCenterFromElement();\n      if (this.transformMatrix) {\n        this._assignTransformMatrixProps();\n        center = fabric.util.transformPoint(center, this.transformMatrix);\n      }\n      this.transformMatrix = null;\n      if (preserveAspectRatioOptions) {\n        this.scaleX *= preserveAspectRatioOptions.scaleX;\n        this.scaleY *= preserveAspectRatioOptions.scaleY;\n        this.cropX = preserveAspectRatioOptions.cropX;\n        this.cropY = preserveAspectRatioOptions.cropY;\n        center.x += preserveAspectRatioOptions.offsetLeft;\n        center.y += preserveAspectRatioOptions.offsetTop;\n        this.width = preserveAspectRatioOptions.width;\n        this.height = preserveAspectRatioOptions.height;\n      }\n      this.setPositionByOrigin(center, 'center', 'center');\n    },\n\n    /**\n     * Clones an instance, using a callback method will work for every object.\n     * @param {Function} callback Callback is invoked with a clone as a first argument\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     */\n    clone: function(callback, propertiesToInclude) {\n      var objectForm = this.toObject(propertiesToInclude);\n      if (this.constructor.fromObject) {\n        this.constructor.fromObject(objectForm, callback);\n      }\n      else {\n        fabric.Object._fromObject('Object', objectForm, callback);\n      }\n    },\n\n    /**\n     * Creates an instance of fabric.Image out of an object\n     * makes use of toCanvasElement.\n     * Once this method was based on toDataUrl and loadImage, so it also had a quality\n     * and format option. toCanvasElement is faster and produce no loss of quality.\n     * If you need to get a real Jpeg or Png from an object, using toDataURL is the right way to do it.\n     * toCanvasElement and then toBlob from the obtained canvas is also a good option.\n     * This method is sync now, but still support the callback because we did not want to break.\n     * When fabricJS 5.0 will be planned, this will probably be changed to not have a callback.\n     * @param {Function} callback callback, invoked with an instance as a first argument\n     * @param {Object} [options] for clone as image, passed to toDataURL\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\n     * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\n     * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\n     * @return {fabric.Object} thisArg\n     */\n    cloneAsImage: function(callback, options) {\n      var canvasEl = this.toCanvasElement(options);\n      if (callback) {\n        callback(new fabric.Image(canvasEl));\n      }\n      return this;\n    },\n\n    /**\n     * Converts an object into a HTMLCanvas element\n     * @param {Object} options Options object\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\n     * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\n     * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\n     * @return {HTMLCanvasElement} Returns DOM element <canvas> with the fabric.Object\n     */\n    toCanvasElement: function(options) {\n      options || (options = { });\n\n      var utils = fabric.util, origParams = utils.saveObjectTransform(this),\n          originalGroup = this.group,\n          originalShadow = this.shadow, abs = Math.abs,\n          multiplier = (options.multiplier || 1) * (options.enableRetinaScaling ? fabric.devicePixelRatio : 1);\n      delete this.group;\n      if (options.withoutTransform) {\n        utils.resetObjectTransform(this);\n      }\n      if (options.withoutShadow) {\n        this.shadow = null;\n      }\n\n      var el = fabric.util.createCanvasElement(),\n          // skip canvas zoom and calculate with setCoords now.\n          boundingRect = this.getBoundingRect(true, true),\n          shadow = this.shadow, scaling,\n          shadowOffset = { x: 0, y: 0 }, shadowBlur,\n          width, height;\n\n      if (shadow) {\n        shadowBlur = shadow.blur;\n        if (shadow.nonScaling) {\n          scaling = { scaleX: 1, scaleY: 1 };\n        }\n        else {\n          scaling = this.getObjectScaling();\n        }\n        // consider non scaling shadow.\n        shadowOffset.x = 2 * Math.round(abs(shadow.offsetX) + shadowBlur) * (abs(scaling.scaleX));\n        shadowOffset.y = 2 * Math.round(abs(shadow.offsetY) + shadowBlur) * (abs(scaling.scaleY));\n      }\n      width = boundingRect.width + shadowOffset.x;\n      height = boundingRect.height + shadowOffset.y;\n      // if the current width/height is not an integer\n      // we need to make it so.\n      el.width = Math.ceil(width);\n      el.height = Math.ceil(height);\n      var canvas = new fabric.StaticCanvas(el, {\n        enableRetinaScaling: false,\n        renderOnAddRemove: false,\n        skipOffscreen: false,\n      });\n      if (options.format === 'jpeg') {\n        canvas.backgroundColor = '#fff';\n      }\n      this.setPositionByOrigin(new fabric.Point(canvas.width / 2, canvas.height / 2), 'center', 'center');\n\n      var originalCanvas = this.canvas;\n      canvas.add(this);\n      var canvasEl = canvas.toCanvasElement(multiplier || 1, options);\n      this.shadow = originalShadow;\n      this.set('canvas', originalCanvas);\n      if (originalGroup) {\n        this.group = originalGroup;\n      }\n      this.set(origParams).setCoords();\n      // canvas.dispose will call image.dispose that will nullify the elements\n      // since this canvas is a simple element for the process, we remove references\n      // to objects in this way in order to avoid object trashing.\n      canvas._objects = [];\n      canvas.dispose();\n      canvas = null;\n\n      return canvasEl;\n    },\n\n    /**\n     * Converts an object into a data-url-like string\n     * @param {Object} options Options object\n     * @param {String} [options.format=png] The format of the output image. Either \"jpeg\" or \"png\"\n     * @param {Number} [options.quality=1] Quality level (0..1). Only used for jpeg.\n     * @param {Number} [options.multiplier=1] Multiplier to scale by\n     * @param {Number} [options.left] Cropping left offset. Introduced in v1.2.14\n     * @param {Number} [options.top] Cropping top offset. Introduced in v1.2.14\n     * @param {Number} [options.width] Cropping width. Introduced in v1.2.14\n     * @param {Number} [options.height] Cropping height. Introduced in v1.2.14\n     * @param {Boolean} [options.enableRetinaScaling] Enable retina scaling for clone image. Introduce in 1.6.4\n     * @param {Boolean} [options.withoutTransform] Remove current object transform ( no scale , no angle, no flip, no skew ). Introduced in 2.3.4\n     * @param {Boolean} [options.withoutShadow] Remove current object shadow. Introduced in 2.4.2\n     * @return {String} Returns a data: URL containing a representation of the object in the format specified by options.format\n     */\n    toDataURL: function(options) {\n      options || (options = { });\n      return fabric.util.toDataURL(this.toCanvasElement(options), options.format || 'png', options.quality || 1);\n    },\n\n    /**\n     * Returns true if specified type is identical to the type of an instance\n     * @param {String} type Type to check against\n     * @return {Boolean}\n     */\n    isType: function(type) {\n      return arguments.length > 1 ? Array.from(arguments).includes(this.type) : this.type === type;\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity of this instance (is 1 unless subclassed)\n     */\n    complexity: function() {\n      return 1;\n    },\n\n    /**\n     * Returns a JSON representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} JSON\n     */\n    toJSON: function(propertiesToInclude) {\n      // delegate, not alias\n      return this.toObject(propertiesToInclude);\n    },\n\n    /**\n     * Sets \"angle\" of an instance with centered rotation\n     * @param {Number} angle Angle value (in degrees)\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    rotate: function(angle) {\n      var shouldCenterOrigin = (this.originX !== 'center' || this.originY !== 'center') && this.centeredRotation;\n\n      if (shouldCenterOrigin) {\n        this._setOriginToCenter();\n      }\n\n      this.set('angle', angle);\n\n      if (shouldCenterOrigin) {\n        this._resetOrigin();\n      }\n\n      return this;\n    },\n\n    /**\n     * Centers object horizontally on canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    centerH: function () {\n      this.canvas && this.canvas.centerObjectH(this);\n      return this;\n    },\n\n    /**\n     * Centers object horizontally on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenterH: function () {\n      this.canvas && this.canvas.viewportCenterObjectH(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically on canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    centerV: function () {\n      this.canvas && this.canvas.centerObjectV(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenterV: function () {\n      this.canvas && this.canvas.viewportCenterObjectV(this);\n      return this;\n    },\n\n    /**\n     * Centers object vertically and horizontally on canvas to which is was added last\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    center: function () {\n      this.canvas && this.canvas.centerObject(this);\n      return this;\n    },\n\n    /**\n     * Centers object on current viewport of canvas to which it was added last.\n     * You might need to call `setCoords` on an object after centering, to update controls area.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    viewportCenter: function () {\n      this.canvas && this.canvas.viewportCenterObject(this);\n      return this;\n    },\n\n    /**\n     * Returns coordinates of a pointer relative to an object\n     * @param {Event} e Event to operate upon\n     * @param {Object} [pointer] Pointer to operate upon (instead of event)\n     * @return {Object} Coordinates of a pointer (x, y)\n     */\n    getLocalPointer: function(e, pointer) {\n      pointer = pointer || this.canvas.getPointer(e);\n      var pClicked = new fabric.Point(pointer.x, pointer.y),\n          objectLeftTop = this._getLeftTopCoords();\n      if (this.angle) {\n        pClicked = fabric.util.rotatePoint(\n          pClicked, objectLeftTop, degreesToRadians(-this.angle));\n      }\n      return {\n        x: pClicked.x - objectLeftTop.x,\n        y: pClicked.y - objectLeftTop.y\n      };\n    },\n\n    /**\n     * Sets canvas globalCompositeOperation for specific object\n     * custom composition operation for the particular object can be specified using globalCompositeOperation property\n     * @param {CanvasRenderingContext2D} ctx Rendering canvas context\n     */\n    _setupCompositeOperation: function (ctx) {\n      if (this.globalCompositeOperation) {\n        ctx.globalCompositeOperation = this.globalCompositeOperation;\n      }\n    },\n\n    /**\n     * cancel instance's running animations\n     * override if necessary to dispose artifacts such as `clipPath`\n     */\n    dispose: function () {\n      if (fabric.runningAnimations) {\n        fabric.runningAnimations.cancelByTarget(this);\n      }\n    }\n  });\n\n  fabric.util.createAccessors && fabric.util.createAccessors(fabric.Object);\n\n  extend(fabric.Object.prototype, fabric.Observable);\n\n  /**\n   * Defines the number of fraction digits to use when serializing object values.\n   * You can use it to increase/decrease precision of such values like left, top, scaleX, scaleY, etc.\n   * @static\n   * @memberOf fabric.Object\n   * @constant\n   * @type Number\n   */\n  fabric.Object.NUM_FRACTION_DIGITS = 2;\n\n  /**\n   * Defines which properties should be enlivened from the object passed to {@link fabric.Object._fromObject}\n   * @static\n   * @memberOf fabric.Object\n   * @constant\n   * @type string[]\n   */\n  fabric.Object.ENLIVEN_PROPS = ['clipPath'];\n\n  fabric.Object._fromObject = function(className, object, callback, extraParam) {\n    var klass = fabric[className];\n    object = clone(object, true);\n    fabric.util.enlivenPatterns([object.fill, object.stroke], function(patterns) {\n      if (typeof patterns[0] !== 'undefined') {\n        object.fill = patterns[0];\n      }\n      if (typeof patterns[1] !== 'undefined') {\n        object.stroke = patterns[1];\n      }\n      fabric.util.enlivenObjectEnlivables(object, object, function () {\n        var instance = extraParam ? new klass(object[extraParam], object) : new klass(object);\n        callback && callback(instance);\n      });\n    });\n  };\n\n  /**\n   * Unique id used internally when creating SVG elements\n   * @static\n   * @memberOf fabric.Object\n   * @type Number\n   */\n  fabric.Object.__uid = 0;\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  var degreesToRadians = fabric.util.degreesToRadians,\n      originXOffset = {\n        left: -0.5,\n        center: 0,\n        right: 0.5\n      },\n      originYOffset = {\n        top: -0.5,\n        center: 0,\n        bottom: 0.5\n      };\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Translates the coordinates from a set of origin to another (based on the object's dimensions)\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @param {String} fromOriginX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} fromOriginY Vertical origin: 'top', 'center' or 'bottom'\n     * @param {String} toOriginX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} toOriginY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToGivenOrigin: function(point, fromOriginX, fromOriginY, toOriginX, toOriginY) {\n      var x = point.x,\n          y = point.y,\n          offsetX, offsetY, dim;\n\n      if (typeof fromOriginX === 'string') {\n        fromOriginX = originXOffset[fromOriginX];\n      }\n      else {\n        fromOriginX -= 0.5;\n      }\n\n      if (typeof toOriginX === 'string') {\n        toOriginX = originXOffset[toOriginX];\n      }\n      else {\n        toOriginX -= 0.5;\n      }\n\n      offsetX = toOriginX - fromOriginX;\n\n      if (typeof fromOriginY === 'string') {\n        fromOriginY = originYOffset[fromOriginY];\n      }\n      else {\n        fromOriginY -= 0.5;\n      }\n\n      if (typeof toOriginY === 'string') {\n        toOriginY = originYOffset[toOriginY];\n      }\n      else {\n        toOriginY -= 0.5;\n      }\n\n      offsetY = toOriginY - fromOriginY;\n\n      if (offsetX || offsetY) {\n        dim = this._getTransformedDimensions();\n        x = point.x + offsetX * dim.x;\n        y = point.y + offsetY * dim.y;\n      }\n\n      return new fabric.Point(x, y);\n    },\n\n    /**\n     * Translates the coordinates from origin to center coordinates (based on the object's dimensions)\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToCenterPoint: function(point, originX, originY) {\n      var p = this.translateToGivenOrigin(point, originX, originY, 'center', 'center');\n      if (this.angle) {\n        return fabric.util.rotatePoint(p, point, degreesToRadians(this.angle));\n      }\n      return p;\n    },\n\n    /**\n     * Translates the coordinates from center to origin coordinates (based on the object's dimensions)\n     * @param {fabric.Point} center The point which corresponds to center of the object\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    translateToOriginPoint: function(center, originX, originY) {\n      var p = this.translateToGivenOrigin(center, 'center', 'center', originX, originY);\n      if (this.angle) {\n        return fabric.util.rotatePoint(p, center, degreesToRadians(this.angle));\n      }\n      return p;\n    },\n\n    /**\n     * Returns the real center coordinates of the object\n     * @return {fabric.Point}\n     */\n    getCenterPoint: function() {\n      var leftTop = new fabric.Point(this.left, this.top);\n      return this.translateToCenterPoint(leftTop, this.originX, this.originY);\n    },\n\n    /**\n     * Returns the coordinates of the object based on center coordinates\n     * @param {fabric.Point} point The point which corresponds to the originX and originY params\n     * @return {fabric.Point}\n     */\n    // getOriginPoint: function(center) {\n    //   return this.translateToOriginPoint(center, this.originX, this.originY);\n    // },\n\n    /**\n     * Returns the coordinates of the object as if it has a different origin\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    getPointByOrigin: function(originX, originY) {\n      var center = this.getCenterPoint();\n      return this.translateToOriginPoint(center, originX, originY);\n    },\n\n    /**\n     * Returns the point in local coordinates\n     * @param {fabric.Point} point The point relative to the global coordinate system\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {fabric.Point}\n     */\n    toLocalPoint: function(point, originX, originY) {\n      var center = this.getCenterPoint(),\n          p, p2;\n\n      if (typeof originX !== 'undefined' && typeof originY !== 'undefined' ) {\n        p = this.translateToGivenOrigin(center, 'center', 'center', originX, originY);\n      }\n      else {\n        p = new fabric.Point(this.left, this.top);\n      }\n\n      p2 = new fabric.Point(point.x, point.y);\n      if (this.angle) {\n        p2 = fabric.util.rotatePoint(p2, center, -degreesToRadians(this.angle));\n      }\n      return p2.subtractEquals(p);\n    },\n\n    /**\n     * Returns the point in global coordinates\n     * @param {fabric.Point} The point relative to the local coordinate system\n     * @return {fabric.Point}\n     */\n    // toGlobalPoint: function(point) {\n    //   return fabric.util.rotatePoint(point, this.getCenterPoint(), degreesToRadians(this.angle)).addEquals(new fabric.Point(this.left, this.top));\n    // },\n\n    /**\n     * Sets the position of the object taking into consideration the object's origin\n     * @param {fabric.Point} pos The new position of the object\n     * @param {String} originX Horizontal origin: 'left', 'center' or 'right'\n     * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'\n     * @return {void}\n     */\n    setPositionByOrigin: function(pos, originX, originY) {\n      var center = this.translateToCenterPoint(pos, originX, originY),\n          position = this.translateToOriginPoint(center, this.originX, this.originY);\n      this.set('left', position.x);\n      this.set('top', position.y);\n    },\n\n    /**\n     * @param {String} to One of 'left', 'center', 'right'\n     */\n    adjustPosition: function(to) {\n      var angle = degreesToRadians(this.angle),\n          hypotFull = this.getScaledWidth(),\n          xFull = fabric.util.cos(angle) * hypotFull,\n          yFull = fabric.util.sin(angle) * hypotFull,\n          offsetFrom, offsetTo;\n\n      //TODO: this function does not consider mixed situation like top, center.\n      if (typeof this.originX === 'string') {\n        offsetFrom = originXOffset[this.originX];\n      }\n      else {\n        offsetFrom = this.originX - 0.5;\n      }\n      if (typeof to === 'string') {\n        offsetTo = originXOffset[to];\n      }\n      else {\n        offsetTo = to - 0.5;\n      }\n      this.left += xFull * (offsetTo - offsetFrom);\n      this.top += yFull * (offsetTo - offsetFrom);\n      this.setCoords();\n      this.originX = to;\n    },\n\n    /**\n     * Sets the origin/position of the object to it's center point\n     * @private\n     * @return {void}\n     */\n    _setOriginToCenter: function() {\n      this._originalOriginX = this.originX;\n      this._originalOriginY = this.originY;\n\n      var center = this.getCenterPoint();\n\n      this.originX = 'center';\n      this.originY = 'center';\n\n      this.left = center.x;\n      this.top = center.y;\n    },\n\n    /**\n     * Resets the origin/position of the object to it's original origin\n     * @private\n     * @return {void}\n     */\n    _resetOrigin: function() {\n      var originPoint = this.translateToOriginPoint(\n        this.getCenterPoint(),\n        this._originalOriginX,\n        this._originalOriginY);\n\n      this.originX = this._originalOriginX;\n      this.originY = this._originalOriginY;\n\n      this.left = originPoint.x;\n      this.top = originPoint.y;\n\n      this._originalOriginX = null;\n      this._originalOriginY = null;\n    },\n\n    /**\n     * @private\n     */\n    _getLeftTopCoords: function() {\n      return this.translateToOriginPoint(this.getCenterPoint(), 'left', 'top');\n    },\n  });\n\n})();\n\n\n(function() {\n\n  function arrayFromCoords(coords) {\n    return [\n      new fabric.Point(coords.tl.x, coords.tl.y),\n      new fabric.Point(coords.tr.x, coords.tr.y),\n      new fabric.Point(coords.br.x, coords.br.y),\n      new fabric.Point(coords.bl.x, coords.bl.y)\n    ];\n  }\n\n  var util = fabric.util,\n      degreesToRadians = util.degreesToRadians,\n      multiplyMatrices = util.multiplyTransformMatrices,\n      transformPoint = util.transformPoint;\n\n  util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Describe object's corner position in canvas element coordinates.\n     * properties are depending on control keys and padding the main controls.\n     * each property is an object with x, y and corner.\n     * The `corner` property contains in a similar manner the 4 points of the\n     * interactive area of the corner.\n     * The coordinates depends from the controls positionHandler and are used\n     * to draw and locate controls\n     * @memberOf fabric.Object.prototype\n     */\n    oCoords: null,\n\n    /**\n     * Describe object's corner position in canvas object absolute coordinates\n     * properties are tl,tr,bl,br and describe the four main corner.\n     * each property is an object with x, y, instance of Fabric.Point.\n     * The coordinates depends from this properties: width, height, scaleX, scaleY\n     * skewX, skewY, angle, strokeWidth, top, left.\n     * Those coordinates are useful to understand where an object is. They get updated\n     * with oCoords but they do not need to be updated when zoom or panning change.\n     * The coordinates get updated with @method setCoords.\n     * You can calculate them without updating with @method calcACoords();\n     * @memberOf fabric.Object.prototype\n     */\n    aCoords: null,\n\n    /**\n     * Describe object's corner position in canvas element coordinates.\n     * includes padding. Used of object detection.\n     * set and refreshed with setCoords.\n     * @memberOf fabric.Object.prototype\n     */\n    lineCoords: null,\n\n    /**\n     * storage for object transform matrix\n     */\n    ownMatrixCache: null,\n\n    /**\n     * storage for object full transform matrix\n     */\n    matrixCache: null,\n\n    /**\n     * custom controls interface\n     * controls are added by default_controls.js\n     */\n    controls: { },\n\n    /**\n     * return correct set of coordinates for intersection\n     * this will return either aCoords or lineCoords.\n     * @param {Boolean} absolute will return aCoords if true or lineCoords\n     * @return {Object} {tl, tr, br, bl} points\n     */\n    _getCoords: function(absolute, calculate) {\n      if (calculate) {\n        return (absolute ? this.calcACoords() : this.calcLineCoords());\n      }\n      if (!this.aCoords || !this.lineCoords) {\n        this.setCoords(true);\n      }\n      return (absolute ? this.aCoords : this.lineCoords);\n    },\n\n    /**\n     * return correct set of coordinates for intersection\n     * this will return either aCoords or lineCoords.\n     * The coords are returned in an array.\n     * @return {Array} [tl, tr, br, bl] of points\n     */\n    getCoords: function(absolute, calculate) {\n      return arrayFromCoords(this._getCoords(absolute, calculate));\n    },\n\n    /**\n     * Checks if object intersects with an area formed by 2 points\n     * @param {Object} pointTL top-left point of area\n     * @param {Object} pointBR bottom-right point of area\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object intersects with an area formed by 2 points\n     */\n    intersectsWithRect: function(pointTL, pointBR, absolute, calculate) {\n      var coords = this.getCoords(absolute, calculate),\n          intersection = fabric.Intersection.intersectPolygonRectangle(\n            coords,\n            pointTL,\n            pointBR\n          );\n      return intersection.status === 'Intersection';\n    },\n\n    /**\n     * Checks if object intersects with another object\n     * @param {Object} other Object to test\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object intersects with another object\n     */\n    intersectsWithObject: function(other, absolute, calculate) {\n      var intersection = fabric.Intersection.intersectPolygonPolygon(\n        this.getCoords(absolute, calculate),\n        other.getCoords(absolute, calculate)\n      );\n\n      return intersection.status === 'Intersection'\n        || other.isContainedWithinObject(this, absolute, calculate)\n        || this.isContainedWithinObject(other, absolute, calculate);\n    },\n\n    /**\n     * Checks if object is fully contained within area of another object\n     * @param {Object} other Object to test\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is fully contained within area of another object\n     */\n    isContainedWithinObject: function(other, absolute, calculate) {\n      var points = this.getCoords(absolute, calculate),\n          otherCoords = absolute ? other.aCoords : other.lineCoords,\n          i = 0, lines = other._getImageLines(otherCoords);\n      for (; i < 4; i++) {\n        if (!other.containsPoint(points[i], lines)) {\n          return false;\n        }\n      }\n      return true;\n    },\n\n    /**\n     * Checks if object is fully contained within area formed by 2 points\n     * @param {Object} pointTL top-left point of area\n     * @param {Object} pointBR bottom-right point of area\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is fully contained within area formed by 2 points\n     */\n    isContainedWithinRect: function(pointTL, pointBR, absolute, calculate) {\n      var boundingRect = this.getBoundingRect(absolute, calculate);\n\n      return (\n        boundingRect.left >= pointTL.x &&\n        boundingRect.left + boundingRect.width <= pointBR.x &&\n        boundingRect.top >= pointTL.y &&\n        boundingRect.top + boundingRect.height <= pointBR.y\n      );\n    },\n\n    /**\n     * Checks if point is inside the object\n     * @param {fabric.Point} point Point to check against\n     * @param {Object} [lines] object returned from @method _getImageLines\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if point is inside the object\n     */\n    containsPoint: function(point, lines, absolute, calculate) {\n      var coords = this._getCoords(absolute, calculate),\n          lines = lines || this._getImageLines(coords),\n          xPoints = this._findCrossPoints(point, lines);\n      // if xPoints is odd then point is inside the object\n      return (xPoints !== 0 && xPoints % 2 === 1);\n    },\n\n    /**\n     * Checks if object is contained within the canvas with current viewportTransform\n     * the check is done stopping at first point that appears on screen\n     * @param {Boolean} [calculate] use coordinates of current position instead of .aCoords\n     * @return {Boolean} true if object is fully or partially contained within canvas\n     */\n    isOnScreen: function(calculate) {\n      if (!this.canvas) {\n        return false;\n      }\n      var pointTL = this.canvas.vptCoords.tl, pointBR = this.canvas.vptCoords.br;\n      var points = this.getCoords(true, calculate);\n      // if some point is on screen, the object is on screen.\n      if (points.some(function(point) {\n        return point.x <= pointBR.x && point.x >= pointTL.x &&\n        point.y <= pointBR.y && point.y >= pointTL.y;\n      })) {\n        return true;\n      }\n      // no points on screen, check intersection with absolute coordinates\n      if (this.intersectsWithRect(pointTL, pointBR, true, calculate)) {\n        return true;\n      }\n      return this._containsCenterOfCanvas(pointTL, pointBR, calculate);\n    },\n\n    /**\n     * Checks if the object contains the midpoint between canvas extremities\n     * Does not make sense outside the context of isOnScreen and isPartiallyOnScreen\n     * @private\n     * @param {Fabric.Point} pointTL Top Left point\n     * @param {Fabric.Point} pointBR Top Right point\n     * @param {Boolean} calculate use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if the object contains the point\n     */\n    _containsCenterOfCanvas: function(pointTL, pointBR, calculate) {\n      // worst case scenario the object is so big that contains the screen\n      var centerPoint = { x: (pointTL.x + pointBR.x) / 2, y: (pointTL.y + pointBR.y) / 2 };\n      if (this.containsPoint(centerPoint, null, true, calculate)) {\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Checks if object is partially contained within the canvas with current viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords\n     * @return {Boolean} true if object is partially contained within canvas\n     */\n    isPartiallyOnScreen: function(calculate) {\n      if (!this.canvas) {\n        return false;\n      }\n      var pointTL = this.canvas.vptCoords.tl, pointBR = this.canvas.vptCoords.br;\n      if (this.intersectsWithRect(pointTL, pointBR, true, calculate)) {\n        return true;\n      }\n      var allPointsAreOutside = this.getCoords(true, calculate).every(function(point) {\n        return (point.x >= pointBR.x || point.x <= pointTL.x) &&\n        (point.y >= pointBR.y || point.y <= pointTL.y);\n      });\n      return allPointsAreOutside && this._containsCenterOfCanvas(pointTL, pointBR, calculate);\n    },\n\n    /**\n     * Method that returns an object with the object edges in it, given the coordinates of the corners\n     * @private\n     * @param {Object} oCoords Coordinates of the object corners\n     */\n    _getImageLines: function(oCoords) {\n\n      var lines = {\n        topline: {\n          o: oCoords.tl,\n          d: oCoords.tr\n        },\n        rightline: {\n          o: oCoords.tr,\n          d: oCoords.br\n        },\n        bottomline: {\n          o: oCoords.br,\n          d: oCoords.bl\n        },\n        leftline: {\n          o: oCoords.bl,\n          d: oCoords.tl\n        }\n      };\n\n      // // debugging\n      // if (this.canvas.contextTop) {\n      //   this.canvas.contextTop.fillRect(lines.bottomline.d.x, lines.bottomline.d.y, 2, 2);\n      //   this.canvas.contextTop.fillRect(lines.bottomline.o.x, lines.bottomline.o.y, 2, 2);\n      //\n      //   this.canvas.contextTop.fillRect(lines.leftline.d.x, lines.leftline.d.y, 2, 2);\n      //   this.canvas.contextTop.fillRect(lines.leftline.o.x, lines.leftline.o.y, 2, 2);\n      //\n      //   this.canvas.contextTop.fillRect(lines.topline.d.x, lines.topline.d.y, 2, 2);\n      //   this.canvas.contextTop.fillRect(lines.topline.o.x, lines.topline.o.y, 2, 2);\n      //\n      //   this.canvas.contextTop.fillRect(lines.rightline.d.x, lines.rightline.d.y, 2, 2);\n      //   this.canvas.contextTop.fillRect(lines.rightline.o.x, lines.rightline.o.y, 2, 2);\n      // }\n\n      return lines;\n    },\n\n    /**\n     * Helper method to determine how many cross points are between the 4 object edges\n     * and the horizontal line determined by a point on canvas\n     * @private\n     * @param {fabric.Point} point Point to check\n     * @param {Object} lines Coordinates of the object being evaluated\n     */\n    // remove yi, not used but left code here just in case.\n    _findCrossPoints: function(point, lines) {\n      var b1, b2, a1, a2, xi, // yi,\n          xcount = 0,\n          iLine;\n\n      for (var lineKey in lines) {\n        iLine = lines[lineKey];\n        // optimisation 1: line below point. no cross\n        if ((iLine.o.y < point.y) && (iLine.d.y < point.y)) {\n          continue;\n        }\n        // optimisation 2: line above point. no cross\n        if ((iLine.o.y >= point.y) && (iLine.d.y >= point.y)) {\n          continue;\n        }\n        // optimisation 3: vertical line case\n        if ((iLine.o.x === iLine.d.x) && (iLine.o.x >= point.x)) {\n          xi = iLine.o.x;\n          // yi = point.y;\n        }\n        // calculate the intersection point\n        else {\n          b1 = 0;\n          b2 = (iLine.d.y - iLine.o.y) / (iLine.d.x - iLine.o.x);\n          a1 = point.y - b1 * point.x;\n          a2 = iLine.o.y - b2 * iLine.o.x;\n\n          xi = -(a1 - a2) / (b1 - b2);\n          // yi = a1 + b1 * xi;\n        }\n        // dont count xi < point.x cases\n        if (xi >= point.x) {\n          xcount += 1;\n        }\n        // optimisation 4: specific for square images\n        if (xcount === 2) {\n          break;\n        }\n      }\n      return xcount;\n    },\n\n    /**\n     * Returns coordinates of object's bounding rectangle (left, top, width, height)\n     * the box is intended as aligned to axis of canvas.\n     * @param {Boolean} [absolute] use coordinates without viewportTransform\n     * @param {Boolean} [calculate] use coordinates of current position instead of .oCoords / .aCoords\n     * @return {Object} Object with left, top, width, height properties\n     */\n    getBoundingRect: function(absolute, calculate) {\n      var coords = this.getCoords(absolute, calculate);\n      return util.makeBoundingBoxFromPoints(coords);\n    },\n\n    /**\n     * Returns width of an object's bounding box counting transformations\n     * before 2.0 it was named getWidth();\n     * @return {Number} width value\n     */\n    getScaledWidth: function() {\n      return this._getTransformedDimensions().x;\n    },\n\n    /**\n     * Returns height of an object bounding box counting transformations\n     * before 2.0 it was named getHeight();\n     * @return {Number} height value\n     */\n    getScaledHeight: function() {\n      return this._getTransformedDimensions().y;\n    },\n\n    /**\n     * Makes sure the scale is valid and modifies it if necessary\n     * @private\n     * @param {Number} value\n     * @return {Number}\n     */\n    _constrainScale: function(value) {\n      if (Math.abs(value) < this.minScaleLimit) {\n        if (value < 0) {\n          return -this.minScaleLimit;\n        }\n        else {\n          return this.minScaleLimit;\n        }\n      }\n      else if (value === 0) {\n        return 0.0001;\n      }\n      return value;\n    },\n\n    /**\n     * Scales an object (equally by x and y)\n     * @param {Number} value Scale factor\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scale: function(value) {\n      this._set('scaleX', value);\n      this._set('scaleY', value);\n      return this.setCoords();\n    },\n\n    /**\n     * Scales an object to a given width, with respect to bounding box (scaling by x/y equally)\n     * @param {Number} value New width value\n     * @param {Boolean} absolute ignore viewport\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scaleToWidth: function(value, absolute) {\n      // adjust to bounding rect factor so that rotated shapes would fit as well\n      var boundingRectFactor = this.getBoundingRect(absolute).width / this.getScaledWidth();\n      return this.scale(value / this.width / boundingRectFactor);\n    },\n\n    /**\n     * Scales an object to a given height, with respect to bounding box (scaling by x/y equally)\n     * @param {Number} value New height value\n     * @param {Boolean} absolute ignore viewport\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    scaleToHeight: function(value, absolute) {\n      // adjust to bounding rect factor so that rotated shapes would fit as well\n      var boundingRectFactor = this.getBoundingRect(absolute).height / this.getScaledHeight();\n      return this.scale(value / this.height / boundingRectFactor);\n    },\n\n    calcLineCoords: function() {\n      var vpt = this.getViewportTransform(),\n          padding = this.padding, angle = degreesToRadians(this.angle),\n          cos = util.cos(angle), sin = util.sin(angle),\n          cosP = cos * padding, sinP = sin * padding, cosPSinP = cosP + sinP,\n          cosPMinusSinP = cosP - sinP, aCoords = this.calcACoords();\n\n      var lineCoords = {\n        tl: transformPoint(aCoords.tl, vpt),\n        tr: transformPoint(aCoords.tr, vpt),\n        bl: transformPoint(aCoords.bl, vpt),\n        br: transformPoint(aCoords.br, vpt),\n      };\n\n      if (padding) {\n        lineCoords.tl.x -= cosPMinusSinP;\n        lineCoords.tl.y -= cosPSinP;\n        lineCoords.tr.x += cosPSinP;\n        lineCoords.tr.y -= cosPMinusSinP;\n        lineCoords.bl.x -= cosPSinP;\n        lineCoords.bl.y += cosPMinusSinP;\n        lineCoords.br.x += cosPMinusSinP;\n        lineCoords.br.y += cosPSinP;\n      }\n\n      return lineCoords;\n    },\n\n    calcOCoords: function() {\n      var rotateMatrix = this._calcRotateMatrix(),\n          translateMatrix = this._calcTranslateMatrix(),\n          vpt = this.getViewportTransform(),\n          startMatrix = multiplyMatrices(vpt, translateMatrix),\n          finalMatrix = multiplyMatrices(startMatrix, rotateMatrix),\n          finalMatrix = multiplyMatrices(finalMatrix, [1 / vpt[0], 0, 0, 1 / vpt[3], 0, 0]),\n          dim = this._calculateCurrentDimensions(),\n          coords = {};\n      this.forEachControl(function(control, key, fabricObject) {\n        coords[key] = control.positionHandler(dim, finalMatrix, fabricObject);\n      });\n\n      // debug code\n      // var canvas = this.canvas;\n      // setTimeout(function() {\n      //   canvas.contextTop.clearRect(0, 0, 700, 700);\n      //   canvas.contextTop.fillStyle = 'green';\n      //   Object.keys(coords).forEach(function(key) {\n      //     var control = coords[key];\n      //     canvas.contextTop.fillRect(control.x, control.y, 3, 3);\n      //   });\n      // }, 50);\n      return coords;\n    },\n\n    calcACoords: function() {\n      var rotateMatrix = this._calcRotateMatrix(),\n          translateMatrix = this._calcTranslateMatrix(),\n          finalMatrix = multiplyMatrices(translateMatrix, rotateMatrix),\n          dim = this._getTransformedDimensions(),\n          w = dim.x / 2, h = dim.y / 2;\n      return {\n        // corners\n        tl: transformPoint({ x: -w, y: -h }, finalMatrix),\n        tr: transformPoint({ x: w, y: -h }, finalMatrix),\n        bl: transformPoint({ x: -w, y: h }, finalMatrix),\n        br: transformPoint({ x: w, y: h }, finalMatrix)\n      };\n    },\n\n    /**\n     * Sets corner and controls position coordinates based on current angle, width and height, left and top.\n     * oCoords are used to find the corners\n     * aCoords are used to quickly find an object on the canvas\n     * lineCoords are used to quickly find object during pointer events.\n     * See {@link https://github.com/fabricjs/fabric.js/wiki/When-to-call-setCoords} and {@link http://fabricjs.com/fabric-gotchas}\n     *\n     * @param {Boolean} [skipCorners] skip calculation of oCoords.\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setCoords: function(skipCorners) {\n      this.aCoords = this.calcACoords();\n      // in case we are in a group, for how the inner group target check works,\n      // lineCoords are exactly aCoords. Since the vpt gets absorbed by the normalized pointer.\n      this.lineCoords = this.group ? this.aCoords : this.calcLineCoords();\n      if (skipCorners) {\n        return this;\n      }\n      // set coordinates of the draggable boxes in the corners used to scale/rotate the image\n      this.oCoords = this.calcOCoords();\n      this._setCornerCoords && this._setCornerCoords();\n      return this;\n    },\n\n    /**\n     * calculate rotation matrix of an object\n     * @return {Array} rotation matrix for the object\n     */\n    _calcRotateMatrix: function() {\n      return util.calcRotateMatrix(this);\n    },\n\n    /**\n     * calculate the translation matrix for an object transform\n     * @return {Array} rotation matrix for the object\n     */\n    _calcTranslateMatrix: function() {\n      var center = this.getCenterPoint();\n      return [1, 0, 0, 1, center.x, center.y];\n    },\n\n    transformMatrixKey: function(skipGroup) {\n      var sep = '_', prefix = '';\n      if (!skipGroup && this.group) {\n        prefix = this.group.transformMatrixKey(skipGroup) + sep;\n      };\n      return prefix + this.top + sep + this.left + sep + this.scaleX + sep + this.scaleY +\n        sep + this.skewX + sep + this.skewY + sep + this.angle + sep + this.originX + sep + this.originY +\n        sep + this.width + sep + this.height + sep + this.strokeWidth + this.flipX + this.flipY;\n    },\n\n    /**\n     * calculate transform matrix that represents the current transformations from the\n     * object's properties.\n     * @param {Boolean} [skipGroup] return transform matrix for object not counting parent transformations\n     * There are some situation in which this is useful to avoid the fake rotation.\n     * @return {Array} transform matrix for the object\n     */\n    calcTransformMatrix: function(skipGroup) {\n      var matrix = this.calcOwnMatrix();\n      if (skipGroup || !this.group) {\n        return matrix;\n      }\n      var key = this.transformMatrixKey(skipGroup), cache = this.matrixCache || (this.matrixCache = {});\n      if (cache.key === key) {\n        return cache.value;\n      }\n      if (this.group) {\n        matrix = multiplyMatrices(this.group.calcTransformMatrix(false), matrix);\n      }\n      cache.key = key;\n      cache.value = matrix;\n      return matrix;\n    },\n\n    /**\n     * calculate transform matrix that represents the current transformations from the\n     * object's properties, this matrix does not include the group transformation\n     * @return {Array} transform matrix for the object\n     */\n    calcOwnMatrix: function() {\n      var key = this.transformMatrixKey(true), cache = this.ownMatrixCache || (this.ownMatrixCache = {});\n      if (cache.key === key) {\n        return cache.value;\n      }\n      var tMatrix = this._calcTranslateMatrix(),\n          options = {\n            angle: this.angle,\n            translateX: tMatrix[4],\n            translateY: tMatrix[5],\n            scaleX: this.scaleX,\n            scaleY: this.scaleY,\n            skewX: this.skewX,\n            skewY: this.skewY,\n            flipX: this.flipX,\n            flipY: this.flipY,\n          };\n      cache.key = key;\n      cache.value = util.composeMatrix(options);\n      return cache.value;\n    },\n\n    /*\n     * Calculate object dimensions from its properties\n     * @private\n     * @return {Object} .x width dimension\n     * @return {Object} .y height dimension\n     */\n    _getNonTransformedDimensions: function() {\n      var strokeWidth = this.strokeWidth,\n          w = this.width + strokeWidth,\n          h = this.height + strokeWidth;\n      return { x: w, y: h };\n    },\n\n    /*\n     * Calculate object bounding box dimensions from its properties scale, skew.\n     * @param {Number} skewX, a value to override current skewX\n     * @param {Number} skewY, a value to override current skewY\n     * @private\n     * @return {Object} .x width dimension\n     * @return {Object} .y height dimension\n     */\n    _getTransformedDimensions: function(skewX, skewY) {\n      if (typeof skewX === 'undefined') {\n        skewX = this.skewX;\n      }\n      if (typeof skewY === 'undefined') {\n        skewY = this.skewY;\n      }\n      var dimensions, dimX, dimY,\n          noSkew = skewX === 0 && skewY === 0;\n\n      if (this.strokeUniform) {\n        dimX = this.width;\n        dimY = this.height;\n      }\n      else {\n        dimensions = this._getNonTransformedDimensions();\n        dimX = dimensions.x;\n        dimY = dimensions.y;\n      }\n      if (noSkew) {\n        return this._finalizeDimensions(dimX * this.scaleX, dimY * this.scaleY);\n      }\n      var bbox = util.sizeAfterTransform(dimX, dimY, {\n        scaleX: this.scaleX,\n        scaleY: this.scaleY,\n        skewX: skewX,\n        skewY: skewY,\n      });\n      return this._finalizeDimensions(bbox.x, bbox.y);\n    },\n\n    /*\n     * Calculate object bounding box dimensions from its properties scale, skew.\n     * @param Number width width of the bbox\n     * @param Number height height of the bbox\n     * @private\n     * @return {Object} .x finalized width dimension\n     * @return {Object} .y finalized height dimension\n     */\n    _finalizeDimensions: function(width, height) {\n      return this.strokeUniform ?\n        { x: width + this.strokeWidth, y: height + this.strokeWidth }\n        :\n        { x: width, y: height };\n    },\n\n    /*\n     * Calculate object dimensions for controls box, including padding and canvas zoom.\n     * and active selection\n     * private\n     */\n    _calculateCurrentDimensions: function()  {\n      var vpt = this.getViewportTransform(),\n          dim = this._getTransformedDimensions(),\n          p = transformPoint(dim, vpt, true);\n      return p.scalarAdd(2 * this.padding);\n    },\n  });\n})();\n\n\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n  /**\n   * Moves an object to the bottom of the stack of drawn objects\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  sendToBack: function() {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.sendToBack.call(this.group, this);\n    }\n    else if (this.canvas) {\n      this.canvas.sendToBack(this);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object to the top of the stack of drawn objects\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  bringToFront: function() {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.bringToFront.call(this.group, this);\n    }\n    else if (this.canvas) {\n      this.canvas.bringToFront(this);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object down in stack of drawn objects\n   * @param {Boolean} [intersecting] If `true`, send object behind next lower intersecting object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  sendBackwards: function(intersecting) {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.sendBackwards.call(this.group, this, intersecting);\n    }\n    else if (this.canvas) {\n      this.canvas.sendBackwards(this, intersecting);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object up in stack of drawn objects\n   * @param {Boolean} [intersecting] If `true`, send object in front of next upper intersecting object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  bringForward: function(intersecting) {\n    if (this.group) {\n      fabric.StaticCanvas.prototype.bringForward.call(this.group, this, intersecting);\n    }\n    else if (this.canvas) {\n      this.canvas.bringForward(this, intersecting);\n    }\n    return this;\n  },\n\n  /**\n   * Moves an object to specified level in stack of drawn objects\n   * @param {Number} index New position of object\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  moveTo: function(index) {\n    if (this.group && this.group.type !== 'activeSelection') {\n      fabric.StaticCanvas.prototype.moveTo.call(this.group, this, index);\n    }\n    else if (this.canvas) {\n      this.canvas.moveTo(this, index);\n    }\n    return this;\n  }\n});\n\n\n/* _TO_SVG_START_ */\n(function() {\n  function getSvgColorString(prop, value) {\n    if (!value) {\n      return prop + ': none; ';\n    }\n    else if (value.toLive) {\n      return prop + ': url(#SVGID_' + value.id + '); ';\n    }\n    else {\n      var color = new fabric.Color(value),\n          str = prop + ': ' + color.toRgb() + '; ',\n          opacity = color.getAlpha();\n      if (opacity !== 1) {\n        //change the color in rgb + opacity\n        str += prop + '-opacity: ' + opacity.toString() + '; ';\n      }\n      return str;\n    }\n  }\n\n  var toFixed = fabric.util.toFixed;\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n    /**\n     * Returns styles-string for svg-export\n     * @param {Boolean} skipShadow a boolean to skip shadow filter output\n     * @return {String}\n     */\n    getSvgStyles: function(skipShadow) {\n\n      var fillRule = this.fillRule ? this.fillRule : 'nonzero',\n          strokeWidth = this.strokeWidth ? this.strokeWidth : '0',\n          strokeDashArray = this.strokeDashArray ? this.strokeDashArray.join(' ') : 'none',\n          strokeDashOffset = this.strokeDashOffset ? this.strokeDashOffset : '0',\n          strokeLineCap = this.strokeLineCap ? this.strokeLineCap : 'butt',\n          strokeLineJoin = this.strokeLineJoin ? this.strokeLineJoin : 'miter',\n          strokeMiterLimit = this.strokeMiterLimit ? this.strokeMiterLimit : '4',\n          opacity = typeof this.opacity !== 'undefined' ? this.opacity : '1',\n          visibility = this.visible ? '' : ' visibility: hidden;',\n          filter = skipShadow ? '' : this.getSvgFilter(),\n          fill = getSvgColorString('fill', this.fill),\n          stroke = getSvgColorString('stroke', this.stroke);\n\n      return [\n        stroke,\n        'stroke-width: ', strokeWidth, '; ',\n        'stroke-dasharray: ', strokeDashArray, '; ',\n        'stroke-linecap: ', strokeLineCap, '; ',\n        'stroke-dashoffset: ', strokeDashOffset, '; ',\n        'stroke-linejoin: ', strokeLineJoin, '; ',\n        'stroke-miterlimit: ', strokeMiterLimit, '; ',\n        fill,\n        'fill-rule: ', fillRule, '; ',\n        'opacity: ', opacity, ';',\n        filter,\n        visibility\n      ].join('');\n    },\n\n    /**\n     * Returns styles-string for svg-export\n     * @param {Object} style the object from which to retrieve style properties\n     * @param {Boolean} useWhiteSpace a boolean to include an additional attribute in the style.\n     * @return {String}\n     */\n    getSvgSpanStyles: function(style, useWhiteSpace) {\n      var term = '; ';\n      var fontFamily = style.fontFamily ?\n        'font-family: ' + (((style.fontFamily.indexOf('\\'') === -1 && style.fontFamily.indexOf('\"') === -1) ?\n          '\\'' + style.fontFamily  + '\\'' : style.fontFamily)) + term : '';\n      var strokeWidth = style.strokeWidth ? 'stroke-width: ' + style.strokeWidth + term : '',\n          fontFamily = fontFamily,\n          fontSize = style.fontSize ? 'font-size: ' + style.fontSize + 'px' + term : '',\n          fontStyle = style.fontStyle ? 'font-style: ' + style.fontStyle + term : '',\n          fontWeight = style.fontWeight ? 'font-weight: ' + style.fontWeight + term : '',\n          fill = style.fill ? getSvgColorString('fill', style.fill) : '',\n          stroke = style.stroke ? getSvgColorString('stroke', style.stroke) : '',\n          textDecoration = this.getSvgTextDecoration(style),\n          deltaY = style.deltaY ? 'baseline-shift: ' + (-style.deltaY) + '; ' : '';\n      if (textDecoration) {\n        textDecoration = 'text-decoration: ' + textDecoration + term;\n      }\n\n      return [\n        stroke,\n        strokeWidth,\n        fontFamily,\n        fontSize,\n        fontStyle,\n        fontWeight,\n        textDecoration,\n        fill,\n        deltaY,\n        useWhiteSpace ? 'white-space: pre; ' : ''\n      ].join('');\n    },\n\n    /**\n     * Returns text-decoration property for svg-export\n     * @param {Object} style the object from which to retrieve style properties\n     * @return {String}\n     */\n    getSvgTextDecoration: function(style) {\n      return ['overline', 'underline', 'line-through'].filter(function(decoration) {\n        return style[decoration.replace('-', '')];\n      }).join(' ');\n    },\n\n    /**\n     * Returns filter for svg shadow\n     * @return {String}\n     */\n    getSvgFilter: function() {\n      return this.shadow ? 'filter: url(#SVGID_' + this.shadow.id + ');' : '';\n    },\n\n    /**\n     * Returns id attribute for svg output\n     * @return {String}\n     */\n    getSvgCommons: function() {\n      return [\n        this.id ? 'id=\"' + this.id + '\" ' : '',\n        this.clipPath ? 'clip-path=\"url(#' + this.clipPath.clipPathId + ')\" ' : '',\n      ].join('');\n    },\n\n    /**\n     * Returns transform-string for svg-export\n     * @param {Boolean} use the full transform or the single object one.\n     * @return {String}\n     */\n    getSvgTransform: function(full, additionalTransform) {\n      var transform = full ? this.calcTransformMatrix() : this.calcOwnMatrix(),\n          svgTransform = 'transform=\"' + fabric.util.matrixToSVG(transform);\n      return svgTransform +\n        (additionalTransform || '') + '\" ';\n    },\n\n    _setSVGBg: function(textBgRects) {\n      if (this.backgroundColor) {\n        var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n        textBgRects.push(\n          '\\t\\t<rect ',\n          this._getFillAttributes(this.backgroundColor),\n          ' x=\"',\n          toFixed(-this.width / 2, NUM_FRACTION_DIGITS),\n          '\" y=\"',\n          toFixed(-this.height / 2, NUM_FRACTION_DIGITS),\n          '\" width=\"',\n          toFixed(this.width, NUM_FRACTION_DIGITS),\n          '\" height=\"',\n          toFixed(this.height, NUM_FRACTION_DIGITS),\n          '\"></rect>\\n');\n      }\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      return this._createBaseSVGMarkup(this._toSVG(reviver), { reviver: reviver });\n    },\n\n    /**\n     * Returns svg clipPath representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toClipPathSVG: function(reviver) {\n      return '\\t' + this._createBaseClipPathSVGMarkup(this._toSVG(reviver), { reviver: reviver });\n    },\n\n    /**\n     * @private\n     */\n    _createBaseClipPathSVGMarkup: function(objectMarkup, options) {\n      options = options || {};\n      var reviver = options.reviver,\n          additionalTransform = options.additionalTransform || '',\n          commonPieces = [\n            this.getSvgTransform(true, additionalTransform),\n            this.getSvgCommons(),\n          ].join(''),\n          // insert commons in the markup, style and svgCommons\n          index = objectMarkup.indexOf('COMMON_PARTS');\n      objectMarkup[index] = commonPieces;\n      return reviver ? reviver(objectMarkup.join('')) : objectMarkup.join('');\n    },\n\n    /**\n     * @private\n     */\n    _createBaseSVGMarkup: function(objectMarkup, options) {\n      options = options || {};\n      var noStyle = options.noStyle,\n          reviver = options.reviver,\n          styleInfo = noStyle ? '' : 'style=\"' + this.getSvgStyles() + '\" ',\n          shadowInfo = options.withShadow ? 'style=\"' + this.getSvgFilter() + '\" ' : '',\n          clipPath = this.clipPath,\n          vectorEffect = this.strokeUniform ? 'vector-effect=\"non-scaling-stroke\" ' : '',\n          absoluteClipPath = clipPath && clipPath.absolutePositioned,\n          stroke = this.stroke, fill = this.fill, shadow = this.shadow,\n          commonPieces, markup = [], clipPathMarkup,\n          // insert commons in the markup, style and svgCommons\n          index = objectMarkup.indexOf('COMMON_PARTS'),\n          additionalTransform = options.additionalTransform;\n      if (clipPath) {\n        clipPath.clipPathId = 'CLIPPATH_' + fabric.Object.__uid++;\n        clipPathMarkup = '<clipPath id=\"' + clipPath.clipPathId + '\" >\\n' +\n          clipPath.toClipPathSVG(reviver) +\n          '</clipPath>\\n';\n      }\n      if (absoluteClipPath) {\n        markup.push(\n          '<g ', shadowInfo, this.getSvgCommons(), ' >\\n'\n        );\n      }\n      markup.push(\n        '<g ',\n        this.getSvgTransform(false),\n        !absoluteClipPath ? shadowInfo + this.getSvgCommons() : '',\n        ' >\\n'\n      );\n      commonPieces = [\n        styleInfo,\n        vectorEffect,\n        noStyle ? '' : this.addPaintOrder(), ' ',\n        additionalTransform ? 'transform=\"' + additionalTransform + '\" ' : '',\n      ].join('');\n      objectMarkup[index] = commonPieces;\n      if (fill && fill.toLive) {\n        markup.push(fill.toSVG(this));\n      }\n      if (stroke && stroke.toLive) {\n        markup.push(stroke.toSVG(this));\n      }\n      if (shadow) {\n        markup.push(shadow.toSVG(this));\n      }\n      if (clipPath) {\n        markup.push(clipPathMarkup);\n      }\n      markup.push(objectMarkup.join(''));\n      markup.push('</g>\\n');\n      absoluteClipPath && markup.push('</g>\\n');\n      return reviver ? reviver(markup.join('')) : markup.join('');\n    },\n\n    addPaintOrder: function() {\n      return this.paintFirst !== 'fill' ? ' paint-order=\"' + this.paintFirst + '\" ' : '';\n    }\n  });\n})();\n/* _TO_SVG_END_ */\n\n\n(function() {\n\n  var extend = fabric.util.object.extend,\n      originalSet = 'stateProperties';\n\n  /*\n    Depends on `stateProperties`\n  */\n  function saveProps(origin, destination, props) {\n    var tmpObj = { }, deep = true;\n    props.forEach(function(prop) {\n      tmpObj[prop] = origin[prop];\n    });\n\n    extend(origin[destination], tmpObj, deep);\n  }\n\n  function _isEqual(origValue, currentValue, firstPass) {\n    if (origValue === currentValue) {\n      // if the objects are identical, return\n      return true;\n    }\n    else if (Array.isArray(origValue)) {\n      if (!Array.isArray(currentValue) || origValue.length !== currentValue.length) {\n        return false;\n      }\n      for (var i = 0, len = origValue.length; i < len; i++) {\n        if (!_isEqual(origValue[i], currentValue[i])) {\n          return false;\n        }\n      }\n      return true;\n    }\n    else if (origValue && typeof origValue === 'object') {\n      var keys = Object.keys(origValue), key;\n      if (!currentValue ||\n          typeof currentValue !== 'object' ||\n          (!firstPass && keys.length !== Object.keys(currentValue).length)\n      ) {\n        return false;\n      }\n      for (var i = 0, len = keys.length; i < len; i++) {\n        key = keys[i];\n        // since clipPath is in the statefull cache list and the clipPath objects\n        // would be iterated as an object, this would lead to possible infinite recursion\n        // we do not want to compare those.\n        if (key === 'canvas' || key === 'group') {\n          continue;\n        }\n        if (!_isEqual(origValue[key], currentValue[key])) {\n          return false;\n        }\n      }\n      return true;\n    }\n  }\n\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n    /**\n     * Returns true if object state (one of its state properties) was changed\n     * @param {String} [propertySet] optional name for the set of property we want to save\n     * @return {Boolean} true if instance' state has changed since `{@link fabric.Object#saveState}` was called\n     */\n    hasStateChanged: function(propertySet) {\n      propertySet = propertySet || originalSet;\n      var dashedPropertySet = '_' + propertySet;\n      if (Object.keys(this[dashedPropertySet]).length < this[propertySet].length) {\n        return true;\n      }\n      return !_isEqual(this[dashedPropertySet], this, true);\n    },\n\n    /**\n     * Saves state of an object\n     * @param {Object} [options] Object with additional `stateProperties` array to include when saving state\n     * @return {fabric.Object} thisArg\n     */\n    saveState: function(options) {\n      var propertySet = options && options.propertySet || originalSet,\n          destination = '_' + propertySet;\n      if (!this[destination]) {\n        return this.setupState(options);\n      }\n      saveProps(this, destination, this[propertySet]);\n      if (options && options.stateProperties) {\n        saveProps(this, destination, options.stateProperties);\n      }\n      return this;\n    },\n\n    /**\n     * Setups state of an object\n     * @param {Object} [options] Object with additional `stateProperties` array to include when saving state\n     * @return {fabric.Object} thisArg\n     */\n    setupState: function(options) {\n      options = options || { };\n      var propertySet = options.propertySet || originalSet;\n      options.propertySet = propertySet;\n      this['_' + propertySet] = { };\n      this.saveState(options);\n      return this;\n    }\n  });\n})();\n\n\n(function() {\n\n  var degreesToRadians = fabric.util.degreesToRadians;\n\n  fabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n    /**\n     * Determines which corner has been clicked\n     * @private\n     * @param {Object} pointer The pointer indicating the mouse position\n     * @return {String|Boolean} corner code (tl, tr, bl, br, etc.), or false if nothing is found\n     */\n    _findTargetCorner: function(pointer, forTouch) {\n      // objects in group, anykind, are not self modificable,\n      // must not return an hovered corner.\n      if (!this.hasControls || this.group || (!this.canvas || this.canvas._activeObject !== this)) {\n        return false;\n      }\n\n      var ex = pointer.x,\n          ey = pointer.y,\n          xPoints,\n          lines, keys = Object.keys(this.oCoords),\n          j = keys.length - 1, i;\n      this.__corner = 0;\n\n      // cycle in reverse order so we pick first the one on top\n      for (; j >= 0; j--) {\n        i = keys[j];\n        if (!this.isControlVisible(i)) {\n          continue;\n        }\n\n        lines = this._getImageLines(forTouch ? this.oCoords[i].touchCorner : this.oCoords[i].corner);\n        // // debugging\n        //\n        // this.canvas.contextTop.fillRect(lines.bottomline.d.x, lines.bottomline.d.y, 2, 2);\n        // this.canvas.contextTop.fillRect(lines.bottomline.o.x, lines.bottomline.o.y, 2, 2);\n        //\n        // this.canvas.contextTop.fillRect(lines.leftline.d.x, lines.leftline.d.y, 2, 2);\n        // this.canvas.contextTop.fillRect(lines.leftline.o.x, lines.leftline.o.y, 2, 2);\n        //\n        // this.canvas.contextTop.fillRect(lines.topline.d.x, lines.topline.d.y, 2, 2);\n        // this.canvas.contextTop.fillRect(lines.topline.o.x, lines.topline.o.y, 2, 2);\n        //\n        // this.canvas.contextTop.fillRect(lines.rightline.d.x, lines.rightline.d.y, 2, 2);\n        // this.canvas.contextTop.fillRect(lines.rightline.o.x, lines.rightline.o.y, 2, 2);\n\n        xPoints = this._findCrossPoints({ x: ex, y: ey }, lines);\n        if (xPoints !== 0 && xPoints % 2 === 1) {\n          this.__corner = i;\n          return i;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Calls a function for each control. The function gets called,\n     * with the control, the object that is calling the iterator and the control's key\n     * @param {Function} fn function to iterate over the controls over\n     */\n    forEachControl: function(fn) {\n      for (var i in this.controls) {\n        fn(this.controls[i], i, this);\n      };\n    },\n\n    /**\n     * Sets the coordinates of the draggable boxes in the corners of\n     * the image used to scale/rotate it.\n     * note: if we would switch to ROUND corner area, all of this would disappear.\n     * everything would resolve to a single point and a pythagorean theorem for the distance\n     * @private\n     */\n    _setCornerCoords: function() {\n      var coords = this.oCoords;\n\n      for (var control in coords) {\n        var controlObject = this.controls[control];\n        coords[control].corner = controlObject.calcCornerCoords(\n          this.angle, this.cornerSize, coords[control].x, coords[control].y, false);\n        coords[control].touchCorner = controlObject.calcCornerCoords(\n          this.angle, this.touchCornerSize, coords[control].x, coords[control].y, true);\n      }\n    },\n\n    /**\n     * Draws a colored layer behind the object, inside its selection borders.\n     * Requires public options: padding, selectionBackgroundColor\n     * this function is called when the context is transformed\n     * has checks to be skipped when the object is on a staticCanvas\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawSelectionBackground: function(ctx) {\n      if (!this.selectionBackgroundColor ||\n        (this.canvas && !this.canvas.interactive) ||\n        (this.canvas && this.canvas._activeObject !== this)\n      ) {\n        return this;\n      }\n      ctx.save();\n      var center = this.getCenterPoint(), wh = this._calculateCurrentDimensions(),\n          vpt = this.canvas.viewportTransform;\n      ctx.translate(center.x, center.y);\n      ctx.scale(1 / vpt[0], 1 / vpt[3]);\n      ctx.rotate(degreesToRadians(this.angle));\n      ctx.fillStyle = this.selectionBackgroundColor;\n      ctx.fillRect(-wh.x / 2, -wh.y / 2, wh.x, wh.y);\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws borders of an object's bounding box.\n     * Requires public properties: width, height\n     * Requires public options: padding, borderColor\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @param {Object} styleOverride object to override the object style\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawBorders: function(ctx, styleOverride) {\n      styleOverride = styleOverride || {};\n      var wh = this._calculateCurrentDimensions(),\n          strokeWidth = this.borderScaleFactor,\n          width = wh.x + strokeWidth,\n          height = wh.y + strokeWidth,\n          hasControls = typeof styleOverride.hasControls !== 'undefined' ?\n            styleOverride.hasControls : this.hasControls,\n          shouldStroke = false;\n\n      ctx.save();\n      ctx.strokeStyle = styleOverride.borderColor || this.borderColor;\n      this._setLineDash(ctx, styleOverride.borderDashArray || this.borderDashArray);\n\n      ctx.strokeRect(\n        -width / 2,\n        -height / 2,\n        width,\n        height\n      );\n\n      if (hasControls) {\n        ctx.beginPath();\n        this.forEachControl(function(control, key, fabricObject) {\n          // in this moment, the ctx is centered on the object.\n          // width and height of the above function are the size of the bbox.\n          if (control.withConnection && control.getVisibility(fabricObject, key)) {\n            // reset movement for each control\n            shouldStroke = true;\n            ctx.moveTo(control.x * width, control.y * height);\n            ctx.lineTo(\n              control.x * width + control.offsetX,\n              control.y * height + control.offsetY\n            );\n          }\n        });\n        if (shouldStroke) {\n          ctx.stroke();\n        }\n      }\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws borders of an object's bounding box when it is inside a group.\n     * Requires public properties: width, height\n     * Requires public options: padding, borderColor\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @param {object} options object representing current object parameters\n     * @param {Object} styleOverride object to override the object style\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawBordersInGroup: function(ctx, options, styleOverride) {\n      styleOverride = styleOverride || {};\n      var bbox = fabric.util.sizeAfterTransform(this.width, this.height, options),\n          strokeWidth = this.strokeWidth,\n          strokeUniform = this.strokeUniform,\n          borderScaleFactor = this.borderScaleFactor,\n          width =\n            bbox.x + strokeWidth * (strokeUniform ? this.canvas.getZoom() : options.scaleX) + borderScaleFactor,\n          height =\n            bbox.y + strokeWidth * (strokeUniform ? this.canvas.getZoom() : options.scaleY) + borderScaleFactor;\n      ctx.save();\n      this._setLineDash(ctx, styleOverride.borderDashArray || this.borderDashArray);\n      ctx.strokeStyle = styleOverride.borderColor || this.borderColor;\n      ctx.strokeRect(\n        -width / 2,\n        -height / 2,\n        width,\n        height\n      );\n\n      ctx.restore();\n      return this;\n    },\n\n    /**\n     * Draws corners of an object's bounding box.\n     * Requires public properties: width, height\n     * Requires public options: cornerSize, padding\n     * @param {CanvasRenderingContext2D} ctx Context to draw on\n     * @param {Object} styleOverride object to override the object style\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    drawControls: function(ctx, styleOverride) {\n      styleOverride = styleOverride || {};\n      ctx.save();\n      var retinaScaling = this.canvas.getRetinaScaling(), matrix, p;\n      ctx.setTransform(retinaScaling, 0, 0, retinaScaling, 0, 0);\n      ctx.strokeStyle = ctx.fillStyle = styleOverride.cornerColor || this.cornerColor;\n      if (!this.transparentCorners) {\n        ctx.strokeStyle = styleOverride.cornerStrokeColor || this.cornerStrokeColor;\n      }\n      this._setLineDash(ctx, styleOverride.cornerDashArray || this.cornerDashArray);\n      this.setCoords();\n      if (this.group) {\n        // fabricJS does not really support drawing controls inside groups,\n        // this piece of code here helps having at least the control in places.\n        // If an application needs to show some objects as selected because of some UI state\n        // can still call Object._renderControls() on any object they desire, independently of groups.\n        // using no padding, circular controls and hiding the rotating cursor is higly suggested,\n        matrix = this.group.calcTransformMatrix();\n      }\n      this.forEachControl(function(control, key, fabricObject) {\n        p = fabricObject.oCoords[key];\n        if (control.getVisibility(fabricObject, key)) {\n          if (matrix) {\n            p = fabric.util.transformPoint(p, matrix);\n          }\n          control.render(ctx, p.x, p.y, styleOverride, fabricObject);\n        }\n      });\n      ctx.restore();\n\n      return this;\n    },\n\n    /**\n     * Returns true if the specified control is visible, false otherwise.\n     * @param {String} controlKey The key of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.\n     * @returns {Boolean} true if the specified control is visible, false otherwise\n     */\n    isControlVisible: function(controlKey) {\n      return this.controls[controlKey] && this.controls[controlKey].getVisibility(this, controlKey);\n    },\n\n    /**\n     * Sets the visibility of the specified control.\n     * @param {String} controlKey The key of the control. Possible values are 'tl', 'tr', 'br', 'bl', 'ml', 'mt', 'mr', 'mb', 'mtr'.\n     * @param {Boolean} visible true to set the specified control visible, false otherwise\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setControlVisible: function(controlKey, visible) {\n      if (!this._controlsVisibility) {\n        this._controlsVisibility = {};\n      }\n      this._controlsVisibility[controlKey] = visible;\n      return this;\n    },\n\n    /**\n     * Sets the visibility state of object controls.\n     * @param {Object} [options] Options object\n     * @param {Boolean} [options.bl] true to enable the bottom-left control, false to disable it\n     * @param {Boolean} [options.br] true to enable the bottom-right control, false to disable it\n     * @param {Boolean} [options.mb] true to enable the middle-bottom control, false to disable it\n     * @param {Boolean} [options.ml] true to enable the middle-left control, false to disable it\n     * @param {Boolean} [options.mr] true to enable the middle-right control, false to disable it\n     * @param {Boolean} [options.mt] true to enable the middle-top control, false to disable it\n     * @param {Boolean} [options.tl] true to enable the top-left control, false to disable it\n     * @param {Boolean} [options.tr] true to enable the top-right control, false to disable it\n     * @param {Boolean} [options.mtr] true to enable the middle-top-rotate control, false to disable it\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    setControlsVisibility: function(options) {\n      options || (options = { });\n\n      for (var p in options) {\n        this.setControlVisible(p, options[p]);\n      }\n      return this;\n    },\n\n\n    /**\n     * This callback function is called every time _discardActiveObject or _setActiveObject\n     * try to to deselect this object. If the function returns true, the process is cancelled\n     * @param {Object} [options] options sent from the upper functions\n     * @param {Event} [options.e] event if the process is generated by an event\n     */\n    onDeselect: function() {\n      // implemented by sub-classes, as needed.\n    },\n\n\n    /**\n     * This callback function is called every time _discardActiveObject or _setActiveObject\n     * try to to select this object. If the function returns true, the process is cancelled\n     * @param {Object} [options] options sent from the upper functions\n     * @param {Event} [options.e] event if the process is generated by an event\n     */\n    onSelect: function() {\n      // implemented by sub-classes, as needed.\n    }\n  });\n})();\n\n\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n  /**\n   * Animation duration (in ms) for fx* methods\n   * @type Number\n   * @default\n   */\n  FX_DURATION: 500,\n\n  /**\n   * Centers object horizontally with animation.\n   * @param {fabric.Object} object Object to center\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.AnimationContext} context\n   */\n  fxCenterObjectH: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    return fabric.util.animate({\n      target: this,\n      startValue: object.left,\n      endValue: this.getCenterPoint().x,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('left', value);\n        _this.requestRenderAll();\n        onChange();\n      },\n      onComplete: function() {\n        object.setCoords();\n        onComplete();\n      }\n    });\n  },\n\n  /**\n   * Centers object vertically with animation.\n   * @param {fabric.Object} object Object to center\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.AnimationContext} context\n   */\n  fxCenterObjectV: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    return fabric.util.animate({\n      target: this,\n      startValue: object.top,\n      endValue: this.getCenterPoint().y,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('top', value);\n        _this.requestRenderAll();\n        onChange();\n      },\n      onComplete: function() {\n        object.setCoords();\n        onComplete();\n      }\n    });\n  },\n\n  /**\n   * Same as `fabric.Canvas#remove` but animated\n   * @param {fabric.Object} object Object to remove\n   * @param {Object} [callbacks] Callbacks object with optional \"onComplete\" and/or \"onChange\" properties\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.AnimationContext} context\n   */\n  fxRemove: function (object, callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    return fabric.util.animate({\n      target: this,\n      startValue: object.opacity,\n      endValue: 0,\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        object.set('opacity', value);\n        _this.requestRenderAll();\n        onChange();\n      },\n      onComplete: function () {\n        _this.remove(object);\n        onComplete();\n      }\n    });\n  }\n});\n\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n  /**\n   * Animates object's properties\n   * @param {String|Object} property Property to animate (if string) or properties to animate (if object)\n   * @param {Number|Object} value Value to animate property to (if string was given first) or options object\n   * @return {fabric.Object} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#animation}\n   * @return {fabric.AnimationContext | fabric.AnimationContext[]} animation context (or an array if passed multiple properties)\n   *\n   * As object  multiple properties\n   *\n   * object.animate({ left: ..., top: ... });\n   * object.animate({ left: ..., top: ... }, { duration: ... });\n   *\n   * As string  one property\n   *\n   * object.animate('left', ...);\n   * object.animate('left', { duration: ... });\n   *\n   */\n  animate: function () {\n    if (arguments[0] && typeof arguments[0] === 'object') {\n      var propsToAnimate = [], prop, skipCallbacks, out = [];\n      for (prop in arguments[0]) {\n        propsToAnimate.push(prop);\n      }\n      for (var i = 0, len = propsToAnimate.length; i < len; i++) {\n        prop = propsToAnimate[i];\n        skipCallbacks = i !== len - 1;\n        out.push(this._animate(prop, arguments[0][prop], arguments[1], skipCallbacks));\n      }\n      return out;\n    }\n    else {\n      return this._animate.apply(this, arguments);\n    }\n  },\n\n  /**\n   * @private\n   * @param {String} property Property to animate\n   * @param {String} to Value to animate to\n   * @param {Object} [options] Options object\n   * @param {Boolean} [skipCallbacks] When true, callbacks like onchange and oncomplete are not invoked\n   */\n  _animate: function(property, to, options, skipCallbacks) {\n    var _this = this, propPair;\n\n    to = to.toString();\n\n    if (!options) {\n      options = { };\n    }\n    else {\n      options = fabric.util.object.clone(options);\n    }\n\n    if (~property.indexOf('.')) {\n      propPair = property.split('.');\n    }\n\n    var propIsColor =\n      _this.colorProperties.indexOf(property) > -1 ||\n      (propPair && _this.colorProperties.indexOf(propPair[1]) > -1);\n\n    var currentValue = propPair\n      ? this.get(propPair[0])[propPair[1]]\n      : this.get(property);\n\n    if (!('from' in options)) {\n      options.from = currentValue;\n    }\n\n    if (!propIsColor) {\n      if (~to.indexOf('=')) {\n        to = currentValue + parseFloat(to.replace('=', ''));\n      }\n      else {\n        to = parseFloat(to);\n      }\n    }\n\n    var _options = {\n      target: this,\n      startValue: options.from,\n      endValue: to,\n      byValue: options.by,\n      easing: options.easing,\n      duration: options.duration,\n      abort: options.abort && function(value, valueProgress, timeProgress) {\n        return options.abort.call(_this, value, valueProgress, timeProgress);\n      },\n      onChange: function (value, valueProgress, timeProgress) {\n        if (propPair) {\n          _this[propPair[0]][propPair[1]] = value;\n        }\n        else {\n          _this.set(property, value);\n        }\n        if (skipCallbacks) {\n          return;\n        }\n        options.onChange && options.onChange(value, valueProgress, timeProgress);\n      },\n      onComplete: function (value, valueProgress, timeProgress) {\n        if (skipCallbacks) {\n          return;\n        }\n\n        _this.setCoords();\n        options.onComplete && options.onComplete(value, valueProgress, timeProgress);\n      }\n    };\n\n    if (propIsColor) {\n      return fabric.util.animateColor(_options.startValue, _options.endValue, _options.duration, _options);\n    }\n    else {\n      return fabric.util.animate(_options);\n    }\n  }\n});\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      coordProps = { x1: 1, x2: 1, y1: 1, y2: 1 };\n\n  if (fabric.Line) {\n    fabric.warn('fabric.Line is already defined');\n    return;\n  }\n\n  /**\n   * Line class\n   * @class fabric.Line\n   * @extends fabric.Object\n   * @see {@link fabric.Line#initialize} for constructor definition\n   */\n  fabric.Line = fabric.util.createClass(fabric.Object, /** @lends fabric.Line.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'line',\n\n    /**\n     * x value or first line edge\n     * @type Number\n     * @default\n     */\n    x1: 0,\n\n    /**\n     * y value or first line edge\n     * @type Number\n     * @default\n     */\n    y1: 0,\n\n    /**\n     * x value or second line edge\n     * @type Number\n     * @default\n     */\n    x2: 0,\n\n    /**\n     * y value or second line edge\n     * @type Number\n     * @default\n     */\n    y2: 0,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('x1', 'x2', 'y1', 'y2'),\n\n    /**\n     * Constructor\n     * @param {Array} [points] Array of points\n     * @param {Object} [options] Options object\n     * @return {fabric.Line} thisArg\n     */\n    initialize: function(points, options) {\n      if (!points) {\n        points = [0, 0, 0, 0];\n      }\n\n      this.callSuper('initialize', options);\n\n      this.set('x1', points[0]);\n      this.set('y1', points[1]);\n      this.set('x2', points[2]);\n      this.set('y2', points[3]);\n\n      this._setWidthHeight(options);\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options\n     */\n    _setWidthHeight: function(options) {\n      options || (options = { });\n\n      this.width = Math.abs(this.x2 - this.x1);\n      this.height = Math.abs(this.y2 - this.y1);\n\n      this.left = 'left' in options\n        ? options.left\n        : this._getLeftToOriginX();\n\n      this.top = 'top' in options\n        ? options.top\n        : this._getTopToOriginY();\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n      if (typeof coordProps[key] !== 'undefined') {\n        this._setWidthHeight();\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     * @return {Number} leftToOriginX Distance from left edge of canvas to originX of Line.\n     */\n    _getLeftToOriginX: makeEdgeToOriginGetter(\n      { // property names\n        origin: 'originX',\n        axis1: 'x1',\n        axis2: 'x2',\n        dimension: 'width'\n      },\n      { // possible values of origin\n        nearest: 'left',\n        center: 'center',\n        farthest: 'right'\n      }\n    ),\n\n    /**\n     * @private\n     * @return {Number} topToOriginY Distance from top edge of canvas to originY of Line.\n     */\n    _getTopToOriginY: makeEdgeToOriginGetter(\n      { // property names\n        origin: 'originY',\n        axis1: 'y1',\n        axis2: 'y2',\n        dimension: 'height'\n      },\n      { // possible values of origin\n        nearest: 'top',\n        center: 'center',\n        farthest: 'bottom'\n      }\n    ),\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      ctx.beginPath();\n\n\n      var p = this.calcLinePoints();\n      ctx.moveTo(p.x1, p.y1);\n      ctx.lineTo(p.x2, p.y2);\n\n      ctx.lineWidth = this.strokeWidth;\n\n      // TODO: test this\n      // make sure setting \"fill\" changes color of a line\n      // (by copying fillStyle to strokeStyle, since line is stroked, not filled)\n      var origStrokeStyle = ctx.strokeStyle;\n      ctx.strokeStyle = this.stroke || ctx.fillStyle;\n      this.stroke && this._renderStroke(ctx);\n      ctx.strokeStyle = origStrokeStyle;\n    },\n\n    /**\n     * This function is an helper for svg import. it returns the center of the object in the svg\n     * untransformed coordinates\n     * @private\n     * @return {Object} center point from element coordinates\n     */\n    _findCenterFromElement: function() {\n      return {\n        x: (this.x1 + this.x2) / 2,\n        y: (this.y1 + this.y2) / 2,\n      };\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return extend(this.callSuper('toObject', propertiesToInclude), this.calcLinePoints());\n    },\n\n    /*\n     * Calculate object dimensions from its properties\n     * @private\n     */\n    _getNonTransformedDimensions: function() {\n      var dim = this.callSuper('_getNonTransformedDimensions');\n      if (this.strokeLineCap === 'butt') {\n        if (this.width === 0) {\n          dim.y -= this.strokeWidth;\n        }\n        if (this.height === 0) {\n          dim.x -= this.strokeWidth;\n        }\n      }\n      return dim;\n    },\n\n    /**\n     * Recalculates line points given width and height\n     * @private\n     */\n    calcLinePoints: function() {\n      var xMult = this.x1 <= this.x2 ? -1 : 1,\n          yMult = this.y1 <= this.y2 ? -1 : 1,\n          x1 = (xMult * this.width * 0.5),\n          y1 = (yMult * this.height * 0.5),\n          x2 = (xMult * this.width * -0.5),\n          y2 = (yMult * this.height * -0.5);\n\n      return {\n        x1: x1,\n        x2: x2,\n        y1: y1,\n        y2: y2\n      };\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var p = this.calcLinePoints();\n      return [\n        '<line ', 'COMMON_PARTS',\n        'x1=\"', p.x1,\n        '\" y1=\"', p.y1,\n        '\" x2=\"', p.x2,\n        '\" y2=\"', p.y2,\n        '\" />\\n'\n      ];\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Line.fromElement})\n   * @static\n   * @memberOf fabric.Line\n   * @see http://www.w3.org/TR/SVG/shapes.html#LineElement\n   */\n  fabric.Line.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('x1 y1 x2 y2'.split(' '));\n\n  /**\n   * Returns fabric.Line instance from an SVG element\n   * @static\n   * @memberOf fabric.Line\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @param {Function} [callback] callback function invoked after parsing\n   */\n  fabric.Line.fromElement = function(element, callback, options) {\n    options = options || { };\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Line.ATTRIBUTE_NAMES),\n        points = [\n          parsedAttributes.x1 || 0,\n          parsedAttributes.y1 || 0,\n          parsedAttributes.x2 || 0,\n          parsedAttributes.y2 || 0\n        ];\n    callback(new fabric.Line(points, extend(parsedAttributes, options)));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Line instance from an object representation\n   * @static\n   * @memberOf fabric.Line\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   */\n  fabric.Line.fromObject = function(object, callback) {\n    function _callback(instance) {\n      delete instance.points;\n      callback && callback(instance);\n    };\n    var options = clone(object, true);\n    options.points = [object.x1, object.y1, object.x2, object.y2];\n    fabric.Object._fromObject('Line', options, _callback, 'points');\n  };\n\n  /**\n   * Produces a function that calculates distance from canvas edge to Line origin.\n   */\n  function makeEdgeToOriginGetter(propertyNames, originValues) {\n    var origin = propertyNames.origin,\n        axis1 = propertyNames.axis1,\n        axis2 = propertyNames.axis2,\n        dimension = propertyNames.dimension,\n        nearest = originValues.nearest,\n        center = originValues.center,\n        farthest = originValues.farthest;\n\n    return function() {\n      switch (this.get(origin)) {\n        case nearest:\n          return Math.min(this.get(axis1), this.get(axis2));\n        case center:\n          return Math.min(this.get(axis1), this.get(axis2)) + (0.5 * this.get(dimension));\n        case farthest:\n          return Math.max(this.get(axis1), this.get(axis2));\n      }\n    };\n\n  }\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      degreesToRadians = fabric.util.degreesToRadians;\n\n  if (fabric.Circle) {\n    fabric.warn('fabric.Circle is already defined.');\n    return;\n  }\n\n  /**\n   * Circle class\n   * @class fabric.Circle\n   * @extends fabric.Object\n   * @see {@link fabric.Circle#initialize} for constructor definition\n   */\n  fabric.Circle = fabric.util.createClass(fabric.Object, /** @lends fabric.Circle.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'circle',\n\n    /**\n     * Radius of this circle\n     * @type Number\n     * @default\n     */\n    radius: 0,\n\n    /**\n     * degrees of start of the circle.\n     * probably will change to degrees in next major version\n     * @type Number 0 - 359\n     * @default 0\n     */\n    startAngle: 0,\n\n    /**\n     * End angle of the circle\n     * probably will change to degrees in next major version\n     * @type Number 1 - 360\n     * @default 360\n     */\n    endAngle: 360,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('radius', 'startAngle', 'endAngle'),\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Circle} thisArg\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n\n      if (key === 'radius') {\n        this.setRadius(value);\n      }\n\n      return this;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['radius', 'startAngle', 'endAngle'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var svgString, x = 0, y = 0,\n          angle = (this.endAngle - this.startAngle) % 360;\n\n      if (angle === 0) {\n        svgString = [\n          '<circle ', 'COMMON_PARTS',\n          'cx=\"' + x + '\" cy=\"' + y + '\" ',\n          'r=\"', this.radius,\n          '\" />\\n'\n        ];\n      }\n      else {\n        var start = degreesToRadians(this.startAngle),\n            end = degreesToRadians(this.endAngle),\n            radius = this.radius,\n            startX = fabric.util.cos(start) * radius,\n            startY = fabric.util.sin(start) * radius,\n            endX = fabric.util.cos(end) * radius,\n            endY = fabric.util.sin(end) * radius,\n            largeFlag = angle > 180 ? '1' : '0';\n        svgString = [\n          '<path d=\"M ' + startX + ' ' + startY,\n          ' A ' + radius + ' ' + radius,\n          ' 0 ', +largeFlag + ' 1', ' ' + endX + ' ' + endY,\n          '\" ', 'COMMON_PARTS', ' />\\n'\n        ];\n      }\n      return svgString;\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render on\n     */\n    _render: function(ctx) {\n      ctx.beginPath();\n      ctx.arc(\n        0,\n        0,\n        this.radius,\n        degreesToRadians(this.startAngle),\n        degreesToRadians(this.endAngle),\n        false\n      );\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * Returns horizontal radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRadiusX: function() {\n      return this.get('radius') * this.get('scaleX');\n    },\n\n    /**\n     * Returns vertical radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRadiusY: function() {\n      return this.get('radius') * this.get('scaleY');\n    },\n\n    /**\n     * Sets radius of an object (and updates width accordingly)\n     * @return {fabric.Circle} thisArg\n     */\n    setRadius: function(value) {\n      this.radius = value;\n      return this.set('width', value * 2).set('height', value * 2);\n    },\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Circle.fromElement})\n   * @static\n   * @memberOf fabric.Circle\n   * @see: http://www.w3.org/TR/SVG/shapes.html#CircleElement\n   */\n  fabric.Circle.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('cx cy r'.split(' '));\n\n  /**\n   * Returns {@link fabric.Circle} instance from an SVG element\n   * @static\n   * @memberOf fabric.Circle\n   * @param {SVGElement} element Element to parse\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   * @param {Object} [options] Options object\n   * @throws {Error} If value of `r` attribute is missing or invalid\n   */\n  fabric.Circle.fromElement = function(element, callback) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Circle.ATTRIBUTE_NAMES);\n\n    if (!isValidRadius(parsedAttributes)) {\n      throw new Error('value of `r` attribute is required and can not be negative');\n    }\n\n    parsedAttributes.left = (parsedAttributes.left || 0) - parsedAttributes.radius;\n    parsedAttributes.top = (parsedAttributes.top || 0) - parsedAttributes.radius;\n    callback(new fabric.Circle(parsedAttributes));\n  };\n\n  /**\n   * @private\n   */\n  function isValidRadius(attributes) {\n    return (('radius' in attributes) && (attributes.radius >= 0));\n  }\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Circle} instance from an object representation\n   * @static\n   * @memberOf fabric.Circle\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @return {void}\n   */\n  fabric.Circle.fromObject = function(object, callback) {\n    fabric.Object._fromObject('Circle', object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.Triangle) {\n    fabric.warn('fabric.Triangle is already defined');\n    return;\n  }\n\n  /**\n   * Triangle class\n   * @class fabric.Triangle\n   * @extends fabric.Object\n   * @return {fabric.Triangle} thisArg\n   * @see {@link fabric.Triangle#initialize} for constructor definition\n   */\n  fabric.Triangle = fabric.util.createClass(fabric.Object, /** @lends fabric.Triangle.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'triangle',\n\n    /**\n     * Width is set to 100 to compensate the old initialize code that was setting it to 100\n     * @type Number\n     * @default\n     */\n    width: 100,\n\n    /**\n     * Height is set to 100 to compensate the old initialize code that was setting it to 100\n     * @type Number\n     * @default\n     */\n    height: 100,\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2;\n\n      ctx.beginPath();\n      ctx.moveTo(-widthBy2, heightBy2);\n      ctx.lineTo(0, -heightBy2);\n      ctx.lineTo(widthBy2, heightBy2);\n      ctx.closePath();\n\n      this._renderPaintInOrder(ctx);\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var widthBy2 = this.width / 2,\n          heightBy2 = this.height / 2,\n          points = [\n            -widthBy2 + ' ' + heightBy2,\n            '0 ' + -heightBy2,\n            widthBy2 + ' ' + heightBy2\n          ].join(',');\n      return [\n        '<polygon ', 'COMMON_PARTS',\n        'points=\"', points,\n        '\" />'\n      ];\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /**\n   * Returns {@link fabric.Triangle} instance from an object representation\n   * @static\n   * @memberOf fabric.Triangle\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   */\n  fabric.Triangle.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Triangle', object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      piBy2   = Math.PI * 2;\n\n  if (fabric.Ellipse) {\n    fabric.warn('fabric.Ellipse is already defined.');\n    return;\n  }\n\n  /**\n   * Ellipse class\n   * @class fabric.Ellipse\n   * @extends fabric.Object\n   * @return {fabric.Ellipse} thisArg\n   * @see {@link fabric.Ellipse#initialize} for constructor definition\n   */\n  fabric.Ellipse = fabric.util.createClass(fabric.Object, /** @lends fabric.Ellipse.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'ellipse',\n\n    /**\n     * Horizontal radius\n     * @type Number\n     * @default\n     */\n    rx:   0,\n\n    /**\n     * Vertical radius\n     * @type Number\n     * @default\n     */\n    ry:   0,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('rx', 'ry'),\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @return {fabric.Ellipse} thisArg\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      this.set('rx', options && options.rx || 0);\n      this.set('ry', options && options.ry || 0);\n    },\n\n    /**\n     * @private\n     * @param {String} key\n     * @param {*} value\n     * @return {fabric.Ellipse} thisArg\n     */\n    _set: function(key, value) {\n      this.callSuper('_set', key, value);\n      switch (key) {\n\n        case 'rx':\n          this.rx = value;\n          this.set('width', value * 2);\n          break;\n\n        case 'ry':\n          this.ry = value;\n          this.set('height', value * 2);\n          break;\n\n      }\n      return this;\n    },\n\n    /**\n     * Returns horizontal radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRx: function() {\n      return this.get('rx') * this.get('scaleX');\n    },\n\n    /**\n     * Returns Vertical radius of an object (according to how an object is scaled)\n     * @return {Number}\n     */\n    getRy: function() {\n      return this.get('ry') * this.get('scaleY');\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['rx', 'ry'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      return [\n        '<ellipse ', 'COMMON_PARTS',\n        'cx=\"0\" cy=\"0\" ',\n        'rx=\"', this.rx,\n        '\" ry=\"', this.ry,\n        '\" />\\n'\n      ];\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render on\n     */\n    _render: function(ctx) {\n      ctx.beginPath();\n      ctx.save();\n      ctx.transform(1, 0, 0, this.ry / this.rx, 0, 0);\n      ctx.arc(\n        0,\n        0,\n        this.rx,\n        0,\n        piBy2,\n        false);\n      ctx.restore();\n      this._renderPaintInOrder(ctx);\n    },\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Ellipse.fromElement})\n   * @static\n   * @memberOf fabric.Ellipse\n   * @see http://www.w3.org/TR/SVG/shapes.html#EllipseElement\n   */\n  fabric.Ellipse.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('cx cy rx ry'.split(' '));\n\n  /**\n   * Returns {@link fabric.Ellipse} instance from an SVG element\n   * @static\n   * @memberOf fabric.Ellipse\n   * @param {SVGElement} element Element to parse\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   * @return {fabric.Ellipse}\n   */\n  fabric.Ellipse.fromElement = function(element, callback) {\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Ellipse.ATTRIBUTE_NAMES);\n\n    parsedAttributes.left = (parsedAttributes.left || 0) - parsedAttributes.rx;\n    parsedAttributes.top = (parsedAttributes.top || 0) - parsedAttributes.ry;\n    callback(new fabric.Ellipse(parsedAttributes));\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Ellipse} instance from an object representation\n   * @static\n   * @memberOf fabric.Ellipse\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as first argument\n   * @return {void}\n   */\n  fabric.Ellipse.fromObject = function(object, callback) {\n    fabric.Object._fromObject('Ellipse', object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend;\n\n  if (fabric.Rect) {\n    fabric.warn('fabric.Rect is already defined');\n    return;\n  }\n\n  /**\n   * Rectangle class\n   * @class fabric.Rect\n   * @extends fabric.Object\n   * @return {fabric.Rect} thisArg\n   * @see {@link fabric.Rect#initialize} for constructor definition\n   */\n  fabric.Rect = fabric.util.createClass(fabric.Object, /** @lends fabric.Rect.prototype */ {\n\n    /**\n     * List of properties to consider when checking if state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: fabric.Object.prototype.stateProperties.concat('rx', 'ry'),\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'rect',\n\n    /**\n     * Horizontal border radius\n     * @type Number\n     * @default\n     */\n    rx:   0,\n\n    /**\n     * Vertical border radius\n     * @type Number\n     * @default\n     */\n    ry:   0,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('rx', 'ry'),\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      this._initRxRy();\n    },\n\n    /**\n     * Initializes rx/ry attributes\n     * @private\n     */\n    _initRxRy: function() {\n      if (this.rx && !this.ry) {\n        this.ry = this.rx;\n      }\n      else if (this.ry && !this.rx) {\n        this.rx = this.ry;\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n\n      // 1x1 case (used in spray brush) optimization was removed because\n      // with caching and higher zoom level this makes more damage than help\n\n      var rx = this.rx ? Math.min(this.rx, this.width / 2) : 0,\n          ry = this.ry ? Math.min(this.ry, this.height / 2) : 0,\n          w = this.width,\n          h = this.height,\n          x = -this.width / 2,\n          y = -this.height / 2,\n          isRounded = rx !== 0 || ry !== 0,\n          /* \"magic number\" for bezier approximations of arcs (http://itc.ktu.lt/itc354/Riskus354.pdf) */\n          k = 1 - 0.5522847498;\n      ctx.beginPath();\n\n      ctx.moveTo(x + rx, y);\n\n      ctx.lineTo(x + w - rx, y);\n      isRounded && ctx.bezierCurveTo(x + w - k * rx, y, x + w, y + k * ry, x + w, y + ry);\n\n      ctx.lineTo(x + w, y + h - ry);\n      isRounded && ctx.bezierCurveTo(x + w, y + h - k * ry, x + w - k * rx, y + h, x + w - rx, y + h);\n\n      ctx.lineTo(x + rx, y + h);\n      isRounded && ctx.bezierCurveTo(x + k * rx, y + h, x, y + h - k * ry, x, y + h - ry);\n\n      ctx.lineTo(x, y + ry);\n      isRounded && ctx.bezierCurveTo(x, y + k * ry, x + k * rx, y, x + rx, y);\n\n      ctx.closePath();\n\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['rx', 'ry'].concat(propertiesToInclude));\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var x = -this.width / 2, y = -this.height / 2;\n      return [\n        '<rect ', 'COMMON_PARTS',\n        'x=\"', x, '\" y=\"', y,\n        '\" rx=\"', this.rx, '\" ry=\"', this.ry,\n        '\" width=\"', this.width, '\" height=\"', this.height,\n        '\" />\\n'\n      ];\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Rect.fromElement`)\n   * @static\n   * @memberOf fabric.Rect\n   * @see: http://www.w3.org/TR/SVG/shapes.html#RectElement\n   */\n  fabric.Rect.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat('x y rx ry width height'.split(' '));\n\n  /**\n   * Returns {@link fabric.Rect} instance from an SVG element\n   * @static\n   * @memberOf fabric.Rect\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Rect.fromElement = function(element, callback, options) {\n    if (!element) {\n      return callback(null);\n    }\n    options = options || { };\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Rect.ATTRIBUTE_NAMES);\n    parsedAttributes.left = parsedAttributes.left || 0;\n    parsedAttributes.top  = parsedAttributes.top  || 0;\n    parsedAttributes.height  = parsedAttributes.height || 0;\n    parsedAttributes.width  = parsedAttributes.width || 0;\n    var rect = new fabric.Rect(extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes));\n    rect.visible = rect.visible && rect.width > 0 && rect.height > 0;\n    callback(rect);\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns {@link fabric.Rect} instance from an object representation\n   * @static\n   * @memberOf fabric.Rect\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Rect instance is created\n   */\n  fabric.Rect.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Rect', object, callback);\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      min = fabric.util.array.min,\n      max = fabric.util.array.max,\n      toFixed = fabric.util.toFixed,\n      projectStrokeOnPoints = fabric.util.projectStrokeOnPoints;\n\n  if (fabric.Polyline) {\n    fabric.warn('fabric.Polyline is already defined');\n    return;\n  }\n\n  /**\n   * Polyline class\n   * @class fabric.Polyline\n   * @extends fabric.Object\n   * @see {@link fabric.Polyline#initialize} for constructor definition\n   */\n  fabric.Polyline = fabric.util.createClass(fabric.Object, /** @lends fabric.Polyline.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'polyline',\n\n    /**\n     * Points array\n     * @type Array\n     * @default\n     */\n    points: null,\n\n    /**\n     * WARNING: Feature in progress\n     * Calculate the exact bounding box taking in account strokeWidth on acute angles\n     * this will be turned to true by default on fabric 6.0\n     * maybe will be left in as an optimization since calculations may be slow\n     * @deprecated\n     * @type Boolean\n     * @default false\n     */\n    exactBoundingBox: false,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('points'),\n\n    /**\n     * Constructor\n     * @param {Array} points Array of points (where each point is an object with x and y)\n     * @param {Object} [options] Options object\n     * @return {fabric.Polyline} thisArg\n     * @example\n     * var poly = new fabric.Polyline([\n     *     { x: 10, y: 10 },\n     *     { x: 50, y: 30 },\n     *     { x: 40, y: 70 },\n     *     { x: 60, y: 50 },\n     *     { x: 100, y: 150 },\n     *     { x: 40, y: 100 }\n     *   ], {\n     *   stroke: 'red',\n     *   left: 100,\n     *   top: 100\n     * });\n     */\n    initialize: function(points, options) {\n      options = options || {};\n      this.points = points || [];\n      this.callSuper('initialize', options);\n      this._setPositionDimensions(options);\n    },\n\n    /**\n     * @private\n     */\n    _projectStrokeOnPoints: function () {\n      return projectStrokeOnPoints(this.points, this, true);\n    },\n\n    _setPositionDimensions: function(options) {\n      var calcDim = this._calcDimensions(options), correctLeftTop,\n          correctSize = this.exactBoundingBox ? this.strokeWidth : 0;\n      this.width = calcDim.width - correctSize;\n      this.height = calcDim.height - correctSize;\n      if (!options.fromSVG) {\n        correctLeftTop = this.translateToGivenOrigin(\n          {\n            // this looks bad, but is one way to keep it optional for now.\n            x: calcDim.left - this.strokeWidth / 2 + correctSize / 2,\n            y: calcDim.top - this.strokeWidth / 2 + correctSize / 2\n          },\n          'left',\n          'top',\n          this.originX,\n          this.originY\n        );\n      }\n      if (typeof options.left === 'undefined') {\n        this.left = options.fromSVG ? calcDim.left : correctLeftTop.x;\n      }\n      if (typeof options.top === 'undefined') {\n        this.top = options.fromSVG ? calcDim.top : correctLeftTop.y;\n      }\n      this.pathOffset = {\n        x: calcDim.left + this.width / 2 + correctSize / 2,\n        y: calcDim.top + this.height / 2 + correctSize / 2\n      };\n    },\n\n    /**\n     * Calculate the polygon min and max point from points array,\n     * returning an object with left, top, width, height to measure the\n     * polygon size\n     * @return {Object} object.left X coordinate of the polygon leftmost point\n     * @return {Object} object.top Y coordinate of the polygon topmost point\n     * @return {Object} object.width distance between X coordinates of the polygon leftmost and rightmost point\n     * @return {Object} object.height distance between Y coordinates of the polygon topmost and bottommost point\n     * @private\n     */\n    _calcDimensions: function() {\n\n      var points = this.exactBoundingBox ? this._projectStrokeOnPoints() : this.points,\n          minX = min(points, 'x') || 0,\n          minY = min(points, 'y') || 0,\n          maxX = max(points, 'x') || 0,\n          maxY = max(points, 'y') || 0,\n          width = (maxX - minX),\n          height = (maxY - minY);\n\n      return {\n        left: minX,\n        top: minY,\n        width: width,\n        height: height,\n      };\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return extend(this.callSuper('toObject', propertiesToInclude), {\n        points: this.points.concat()\n      });\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var points = [], diffX = this.pathOffset.x, diffY = this.pathOffset.y,\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n\n      for (var i = 0, len = this.points.length; i < len; i++) {\n        points.push(\n          toFixed(this.points[i].x - diffX, NUM_FRACTION_DIGITS), ',',\n          toFixed(this.points[i].y - diffY, NUM_FRACTION_DIGITS), ' '\n        );\n      }\n      return [\n        '<' + this.type + ' ', 'COMMON_PARTS',\n        'points=\"', points.join(''),\n        '\" />\\n'\n      ];\n    },\n    /* _TO_SVG_END_ */\n\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    commonRender: function(ctx) {\n      var point, len = this.points.length,\n          x = this.pathOffset.x,\n          y = this.pathOffset.y;\n\n      if (!len || isNaN(this.points[len - 1].y)) {\n        // do not draw if no points or odd points\n        // NaN comes from parseFloat of a empty string in parser\n        return false;\n      }\n      ctx.beginPath();\n      ctx.moveTo(this.points[0].x - x, this.points[0].y - y);\n      for (var i = 0; i < len; i++) {\n        point = this.points[i];\n        ctx.lineTo(point.x - x, point.y - y);\n      }\n      return true;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      if (!this.commonRender(ctx)) {\n        return;\n      }\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity of this instance\n     */\n    complexity: function() {\n      return this.get('points').length;\n    }\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Polyline.fromElement})\n   * @static\n   * @memberOf fabric.Polyline\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolylineElement\n   */\n  fabric.Polyline.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat();\n\n  /**\n   * Returns fabric.Polyline instance from an SVG element\n   * @static\n   * @memberOf fabric.Polyline\n   * @param {SVGElement} element Element to parser\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Polyline.fromElementGenerator = function(_class) {\n    return function(element, callback, options) {\n      if (!element) {\n        return callback(null);\n      }\n      options || (options = { });\n\n      var points = fabric.parsePointsAttribute(element.getAttribute('points')),\n          parsedAttributes = fabric.parseAttributes(element, fabric[_class].ATTRIBUTE_NAMES);\n      parsedAttributes.fromSVG = true;\n      callback(new fabric[_class](points, extend(parsedAttributes, options)));\n    };\n  };\n\n  fabric.Polyline.fromElement = fabric.Polyline.fromElementGenerator('Polyline');\n\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Polyline instance from an object representation\n   * @static\n   * @memberOf fabric.Polyline\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   */\n  fabric.Polyline.fromObject = function(object, callback) {\n    return fabric.Object._fromObject('Polyline', object, callback, 'points');\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = {}),\n      projectStrokeOnPoints = fabric.util.projectStrokeOnPoints;\n\n  if (fabric.Polygon) {\n    fabric.warn('fabric.Polygon is already defined');\n    return;\n  }\n\n  /**\n   * Polygon class\n   * @class fabric.Polygon\n   * @extends fabric.Polyline\n   * @see {@link fabric.Polygon#initialize} for constructor definition\n   */\n  fabric.Polygon = fabric.util.createClass(fabric.Polyline, /** @lends fabric.Polygon.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'polygon',\n\n    /**\n     * @private\n     */\n    _projectStrokeOnPoints: function () {\n      return projectStrokeOnPoints(this.points, this);\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      if (!this.commonRender(ctx)) {\n        return;\n      }\n      ctx.closePath();\n      this._renderPaintInOrder(ctx);\n    },\n\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Polygon.fromElement`)\n   * @static\n   * @memberOf fabric.Polygon\n   * @see: http://www.w3.org/TR/SVG/shapes.html#PolygonElement\n   */\n  fabric.Polygon.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat();\n\n  /**\n   * Returns {@link fabric.Polygon} instance from an SVG element\n   * @static\n   * @memberOf fabric.Polygon\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Polygon.fromElement = fabric.Polyline.fromElementGenerator('Polygon');\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Polygon instance from an object representation\n   * @static\n   * @memberOf fabric.Polygon\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   * @return {void}\n   */\n  fabric.Polygon.fromObject = function(object, callback) {\n    fabric.Object._fromObject('Polygon', object, callback, 'points');\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      min = fabric.util.array.min,\n      max = fabric.util.array.max,\n      extend = fabric.util.object.extend,\n      clone = fabric.util.object.clone,\n      toFixed = fabric.util.toFixed;\n\n  if (fabric.Path) {\n    fabric.warn('fabric.Path is already defined');\n    return;\n  }\n\n  /**\n   * Path class\n   * @class fabric.Path\n   * @extends fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#path_and_pathgroup}\n   * @see {@link fabric.Path#initialize} for constructor definition\n   */\n  fabric.Path = fabric.util.createClass(fabric.Object, /** @lends fabric.Path.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'path',\n\n    /**\n     * Array of path points\n     * @type Array\n     * @default\n     */\n    path: null,\n\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('path', 'fillRule'),\n\n    stateProperties: fabric.Object.prototype.stateProperties.concat('path'),\n\n    /**\n     * Constructor\n     * @param {Array|String} path Path data (sequence of coordinates and corresponding \"command\" tokens)\n     * @param {Object} [options] Options object\n     * @return {fabric.Path} thisArg\n     */\n    initialize: function (path, options) {\n      options = clone(options || {});\n      delete options.path;\n      this.callSuper('initialize', options);\n      this._setPath(path || [], options);\n    },\n\n    /**\n    * @private\n    * @param {Array|String} path Path data (sequence of coordinates and corresponding \"command\" tokens)\n    * @param {Object} [options] Options object\n    */\n    _setPath: function (path, options) {\n      this.path = fabric.util.makePathSimpler(\n        Array.isArray(path) ? path : fabric.util.parsePath(path)\n      );\n\n      fabric.Polyline.prototype._setPositionDimensions.call(this, options || {});\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render path on\n     */\n    _renderPathCommands: function(ctx) {\n      var current, // current instruction\n          subpathStartX = 0,\n          subpathStartY = 0,\n          x = 0, // current x\n          y = 0, // current y\n          controlX = 0, // current control point x\n          controlY = 0, // current control point y\n          l = -this.pathOffset.x,\n          t = -this.pathOffset.y;\n\n      ctx.beginPath();\n\n      for (var i = 0, len = this.path.length; i < len; ++i) {\n\n        current = this.path[i];\n\n        switch (current[0]) { // first letter\n\n          case 'L': // lineto, absolute\n            x = current[1];\n            y = current[2];\n            ctx.lineTo(x + l, y + t);\n            break;\n\n          case 'M': // moveTo, absolute\n            x = current[1];\n            y = current[2];\n            subpathStartX = x;\n            subpathStartY = y;\n            ctx.moveTo(x + l, y + t);\n            break;\n\n          case 'C': // bezierCurveTo, absolute\n            x = current[5];\n            y = current[6];\n            controlX = current[3];\n            controlY = current[4];\n            ctx.bezierCurveTo(\n              current[1] + l,\n              current[2] + t,\n              controlX + l,\n              controlY + t,\n              x + l,\n              y + t\n            );\n            break;\n\n          case 'Q': // quadraticCurveTo, absolute\n            ctx.quadraticCurveTo(\n              current[1] + l,\n              current[2] + t,\n              current[3] + l,\n              current[4] + t\n            );\n            x = current[3];\n            y = current[4];\n            controlX = current[1];\n            controlY = current[2];\n            break;\n\n          case 'z':\n          case 'Z':\n            x = subpathStartX;\n            y = subpathStartY;\n            ctx.closePath();\n            break;\n        }\n      }\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx context to render path on\n     */\n    _render: function(ctx) {\n      this._renderPathCommands(ctx);\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} string representation of an instance\n     */\n    toString: function() {\n      return '#<fabric.Path (' + this.complexity() +\n        '): { \"top\": ' + this.top + ', \"left\": ' + this.left + ' }>';\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return extend(this.callSuper('toObject', propertiesToInclude), {\n        path: this.path.map(function(item) { return item.slice(); }),\n      });\n    },\n\n    /**\n     * Returns dataless object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      var o = this.toObject(['sourcePath'].concat(propertiesToInclude));\n      if (o.sourcePath) {\n        delete o.path;\n      }\n      return o;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var path = fabric.util.joinPath(this.path);\n      return [\n        '<path ', 'COMMON_PARTS',\n        'd=\"', path,\n        '\" stroke-linecap=\"round\" ',\n        '/>\\n'\n      ];\n    },\n\n    _getOffsetTransform: function() {\n      var digits = fabric.Object.NUM_FRACTION_DIGITS;\n      return ' translate(' + toFixed(-this.pathOffset.x, digits) + ', ' +\n          toFixed(-this.pathOffset.y, digits) + ')';\n    },\n\n    /**\n     * Returns svg clipPath representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toClipPathSVG: function(reviver) {\n      var additionalTransform = this._getOffsetTransform();\n      return '\\t' + this._createBaseClipPathSVGMarkup(\n        this._toSVG(), { reviver: reviver, additionalTransform: additionalTransform }\n      );\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      var additionalTransform = this._getOffsetTransform();\n      return this._createBaseSVGMarkup(this._toSVG(), { reviver: reviver, additionalTransform: additionalTransform  });\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns number representation of an instance complexity\n     * @return {Number} complexity of this instance\n     */\n    complexity: function() {\n      return this.path.length;\n    },\n\n    /**\n     * @private\n     */\n    _calcDimensions: function() {\n\n      var aX = [],\n          aY = [],\n          current, // current instruction\n          subpathStartX = 0,\n          subpathStartY = 0,\n          x = 0, // current x\n          y = 0, // current y\n          bounds;\n\n      for (var i = 0, len = this.path.length; i < len; ++i) {\n\n        current = this.path[i];\n\n        switch (current[0]) { // first letter\n\n          case 'L': // lineto, absolute\n            x = current[1];\n            y = current[2];\n            bounds = [];\n            break;\n\n          case 'M': // moveTo, absolute\n            x = current[1];\n            y = current[2];\n            subpathStartX = x;\n            subpathStartY = y;\n            bounds = [];\n            break;\n\n          case 'C': // bezierCurveTo, absolute\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              current[1],\n              current[2],\n              current[3],\n              current[4],\n              current[5],\n              current[6]\n            );\n            x = current[5];\n            y = current[6];\n            break;\n\n          case 'Q': // quadraticCurveTo, absolute\n            bounds = fabric.util.getBoundsOfCurve(x, y,\n              current[1],\n              current[2],\n              current[1],\n              current[2],\n              current[3],\n              current[4]\n            );\n            x = current[3];\n            y = current[4];\n            break;\n\n          case 'z':\n          case 'Z':\n            x = subpathStartX;\n            y = subpathStartY;\n            break;\n        }\n        bounds.forEach(function (point) {\n          aX.push(point.x);\n          aY.push(point.y);\n        });\n        aX.push(x);\n        aY.push(y);\n      }\n\n      var minX = min(aX) || 0,\n          minY = min(aY) || 0,\n          maxX = max(aX) || 0,\n          maxY = max(aY) || 0,\n          deltaX = maxX - minX,\n          deltaY = maxY - minY;\n\n      return {\n        left: minX,\n        top: minY,\n        width: deltaX,\n        height: deltaY\n      };\n    }\n  });\n\n  /**\n   * Creates an instance of fabric.Path from an object\n   * @static\n   * @memberOf fabric.Path\n   * @param {Object} object\n   * @param {Function} [callback] Callback to invoke when an fabric.Path instance is created\n   */\n  fabric.Path.fromObject = function(object, callback) {\n    if (typeof object.sourcePath === 'string') {\n      var pathUrl = object.sourcePath;\n      fabric.loadSVGFromURL(pathUrl, function (elements) {\n        var path = elements[0];\n        path.setOptions(object);\n        if (object.clipPath) {\n          fabric.util.enlivenObjects([object.clipPath], function(elivenedObjects) {\n            path.clipPath = elivenedObjects[0];\n            callback && callback(path);\n          });\n        }\n        else {\n          callback && callback(path);\n        }\n      });\n    }\n    else {\n      fabric.Object._fromObject('Path', object, callback, 'path');\n    }\n  };\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by `fabric.Path.fromElement`)\n   * @static\n   * @memberOf fabric.Path\n   * @see http://www.w3.org/TR/SVG/paths.html#PathElement\n   */\n  fabric.Path.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(['d']);\n\n  /**\n   * Creates an instance of fabric.Path from an SVG <path> element\n   * @static\n   * @memberOf fabric.Path\n   * @param {SVGElement} element to parse\n   * @param {Function} callback Callback to invoke when an fabric.Path instance is created\n   * @param {Object} [options] Options object\n   * @param {Function} [callback] Options callback invoked after parsing is finished\n   */\n  fabric.Path.fromElement = function(element, callback, options) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Path.ATTRIBUTE_NAMES);\n    parsedAttributes.fromSVG = true;\n    callback(new fabric.Path(parsedAttributes.d, extend(parsedAttributes, options)));\n  };\n  /* _FROM_SVG_END_ */\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      min = fabric.util.array.min,\n      max = fabric.util.array.max;\n\n  if (fabric.Group) {\n    return;\n  }\n\n  /**\n   * Group class\n   * @class fabric.Group\n   * @extends fabric.Object\n   * @mixes fabric.Collection\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#groups}\n   * @see {@link fabric.Group#initialize} for constructor definition\n   */\n  fabric.Group = fabric.util.createClass(fabric.Object, fabric.Collection, /** @lends fabric.Group.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'group',\n\n    /**\n     * Width of stroke\n     * @type Number\n     * @default\n     */\n    strokeWidth: 0,\n\n    /**\n     * Indicates if click, mouseover, mouseout events & hoverCursor should also check for subtargets\n     * @type Boolean\n     * @default\n     */\n    subTargetCheck: false,\n\n    /**\n     * Groups are container, do not render anything on theyr own, ence no cache properties\n     * @type Array\n     * @default\n     */\n    cacheProperties: [],\n\n    /**\n     * setOnGroup is a method used for TextBox that is no more used since 2.0.0 The behavior is still\n     * available setting this boolean to true.\n     * @type Boolean\n     * @since 2.0.0\n     * @default\n     */\n    useSetOnGroup: false,\n\n    /**\n     * Constructor\n     * @param {Object} objects Group objects\n     * @param {Object} [options] Options object\n     * @param {Boolean} [isAlreadyGrouped] if true, objects have been grouped already.\n     * @return {Object} thisArg\n     */\n    initialize: function(objects, options, isAlreadyGrouped) {\n      options = options || {};\n      this._objects = [];\n      // if objects enclosed in a group have been grouped already,\n      // we cannot change properties of objects.\n      // Thus we need to set options to group without objects,\n      isAlreadyGrouped && this.callSuper('initialize', options);\n      this._objects = objects || [];\n      for (var i = this._objects.length; i--; ) {\n        this._objects[i].group = this;\n      }\n\n      if (!isAlreadyGrouped) {\n        var center = options && options.centerPoint;\n        // we want to set origins before calculating the bounding box.\n        // so that the topleft can be set with that in mind.\n        // if specific top and left are passed, are overwritten later\n        // with the callSuper('initialize', options)\n        if (options.originX !== undefined) {\n          this.originX = options.originX;\n        }\n        if (options.originY !== undefined) {\n          this.originY = options.originY;\n        }\n        // if coming from svg i do not want to calc bounds.\n        // i assume width and height are passed along options\n        center || this._calcBounds();\n        this._updateObjectsCoords(center);\n        delete options.centerPoint;\n        this.callSuper('initialize', options);\n      }\n      else {\n        this._updateObjectsACoords();\n      }\n\n      this.setCoords();\n    },\n\n    /**\n     * @private\n     */\n    _updateObjectsACoords: function() {\n      var skipControls = true;\n      for (var i = this._objects.length; i--; ){\n        this._objects[i].setCoords(skipControls);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Boolean} [skipCoordsChange] if true, coordinates of objects enclosed in a group do not change\n     */\n    _updateObjectsCoords: function(center) {\n      var center = center || this.getCenterPoint();\n      for (var i = this._objects.length; i--; ){\n        this._updateObjectCoords(this._objects[i], center);\n      }\n    },\n\n    /**\n     * @private\n     * @param {Object} object\n     * @param {fabric.Point} center, current center of group.\n     */\n    _updateObjectCoords: function(object, center) {\n      var objectLeft = object.left,\n          objectTop = object.top,\n          skipControls = true;\n\n      object.set({\n        left: objectLeft - center.x,\n        top: objectTop - center.y\n      });\n      object.group = this;\n      object.setCoords(skipControls);\n    },\n\n    /**\n     * Returns string represenation of a group\n     * @return {String}\n     */\n    toString: function() {\n      return '#<fabric.Group: (' + this.complexity() + ')>';\n    },\n\n    /**\n     * Adds an object to a group; Then recalculates group's dimension, position.\n     * @param {Object} object\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    addWithUpdate: function(object) {\n      var nested = !!this.group;\n      this._restoreObjectsState();\n      fabric.util.resetObjectTransform(this);\n      if (object) {\n        if (nested) {\n          // if this group is inside another group, we need to pre transform the object\n          fabric.util.removeTransformFromObject(object, this.group.calcTransformMatrix());\n        }\n        this._objects.push(object);\n        object.group = this;\n        object._set('canvas', this.canvas);\n      }\n      this._calcBounds();\n      this._updateObjectsCoords();\n      this.dirty = true;\n      if (nested) {\n        this.group.addWithUpdate();\n      }\n      else {\n        this.setCoords();\n      }\n      return this;\n    },\n\n    /**\n     * Removes an object from a group; Then recalculates group's dimension, position.\n     * @param {Object} object\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    removeWithUpdate: function(object) {\n      this._restoreObjectsState();\n      fabric.util.resetObjectTransform(this);\n\n      this.remove(object);\n      this._calcBounds();\n      this._updateObjectsCoords();\n      this.setCoords();\n      this.dirty = true;\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _onObjectAdded: function(object) {\n      this.dirty = true;\n      object.group = this;\n      object._set('canvas', this.canvas);\n    },\n\n    /**\n     * @private\n     */\n    _onObjectRemoved: function(object) {\n      this.dirty = true;\n      delete object.group;\n    },\n\n    /**\n     * @private\n     */\n    _set: function(key, value) {\n      var i = this._objects.length;\n      if (this.useSetOnGroup) {\n        while (i--) {\n          this._objects[i].setOnGroup(key, value);\n        }\n      }\n      if (key === 'canvas') {\n        while (i--) {\n          this._objects[i]._set(key, value);\n        }\n      }\n      fabric.Object.prototype._set.call(this, key, value);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var _includeDefaultValues = this.includeDefaultValues;\n      var objsToObject = this._objects\n        .filter(function (obj) {\n          return !obj.excludeFromExport;\n        })\n        .map(function (obj) {\n          var originalDefaults = obj.includeDefaultValues;\n          obj.includeDefaultValues = _includeDefaultValues;\n          var _obj = obj.toObject(propertiesToInclude);\n          obj.includeDefaultValues = originalDefaults;\n          return _obj;\n        });\n      var obj = fabric.Object.prototype.toObject.call(this, propertiesToInclude);\n      obj.objects = objsToObject;\n      return obj;\n    },\n\n    /**\n     * Returns object representation of an instance, in dataless mode.\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toDatalessObject: function(propertiesToInclude) {\n      var objsToObject, sourcePath = this.sourcePath;\n      if (sourcePath) {\n        objsToObject = sourcePath;\n      }\n      else {\n        var _includeDefaultValues = this.includeDefaultValues;\n        objsToObject = this._objects.map(function(obj) {\n          var originalDefaults = obj.includeDefaultValues;\n          obj.includeDefaultValues = _includeDefaultValues;\n          var _obj = obj.toDatalessObject(propertiesToInclude);\n          obj.includeDefaultValues = originalDefaults;\n          return _obj;\n        });\n      }\n      var obj = fabric.Object.prototype.toDatalessObject.call(this, propertiesToInclude);\n      obj.objects = objsToObject;\n      return obj;\n    },\n\n    /**\n     * Renders instance on a given context\n     * @param {CanvasRenderingContext2D} ctx context to render instance on\n     */\n    render: function(ctx) {\n      this._transformDone = true;\n      this.callSuper('render', ctx);\n      this._transformDone = false;\n    },\n\n    /**\n     * Decide if the object should cache or not. Create its own cache level\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group is already cached.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      var ownCache = fabric.Object.prototype.shouldCache.call(this);\n      if (ownCache) {\n        for (var i = 0, len = this._objects.length; i < len; i++) {\n          if (this._objects[i].willDrawShadow()) {\n            this.ownCaching = false;\n            return false;\n          }\n        }\n      }\n      return ownCache;\n    },\n\n    /**\n     * Check if this object or a child object will cast a shadow\n     * @return {Boolean}\n     */\n    willDrawShadow: function() {\n      if (fabric.Object.prototype.willDrawShadow.call(this)) {\n        return true;\n      }\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        if (this._objects[i].willDrawShadow()) {\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Check if this group or its parent group are caching, recursively up\n     * @return {Boolean}\n     */\n    isOnACache: function() {\n      return this.ownCaching || (this.group && this.group.isOnACache());\n    },\n\n    /**\n     * Execute the drawing operation for an object on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawObject: function(ctx) {\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        this._objects[i].render(ctx);\n      }\n      this._drawClipPath(ctx, this.clipPath);\n    },\n\n    /**\n     * Check if cache is dirty\n     */\n    isCacheDirty: function(skipCanvas) {\n      if (this.callSuper('isCacheDirty', skipCanvas)) {\n        return true;\n      }\n      if (!this.statefullCache) {\n        return false;\n      }\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        if (this._objects[i].isCacheDirty(true)) {\n          if (this._cacheCanvas) {\n            // if this group has not a cache canvas there is nothing to clean\n            var x = this.cacheWidth / this.zoomX, y = this.cacheHeight / this.zoomY;\n            this._cacheContext.clearRect(-x / 2, -y / 2, x, y);\n          }\n          return true;\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Restores original state of each of group objects (original state is that which was before group was created).\n     * if the nested boolean is true, the original state will be restored just for the\n     * first group and not for all the group chain\n     * @private\n     * @param {Boolean} nested tell the function to restore object state up to the parent group and not more\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    _restoreObjectsState: function() {\n      var groupMatrix = this.calcOwnMatrix();\n      this._objects.forEach(function(object) {\n        // instead of using _this = this;\n        fabric.util.addTransformToObject(object, groupMatrix);\n        delete object.group;\n        object.setCoords();\n      });\n      return this;\n    },\n\n    /**\n     * Destroys a group (restoring state of its objects)\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    destroy: function() {\n      // when group is destroyed objects needs to get a repaint to be eventually\n      // displayed on canvas.\n      this._objects.forEach(function(object) {\n        object.set('dirty', true);\n      });\n      return this._restoreObjectsState();\n    },\n\n    dispose: function () {\n      this.callSuper('dispose');\n      this.forEachObject(function (object) {\n        object.dispose && object.dispose();\n      });\n      this._objects = [];\n    },\n\n    /**\n     * make a group an active selection, remove the group from canvas\n     * the group has to be on canvas for this to work.\n     * @return {fabric.ActiveSelection} thisArg\n     * @chainable\n     */\n    toActiveSelection: function() {\n      if (!this.canvas) {\n        return;\n      }\n      var objects = this._objects, canvas = this.canvas;\n      this._objects = [];\n      var options = this.toObject();\n      delete options.objects;\n      var activeSelection = new fabric.ActiveSelection([]);\n      activeSelection.set(options);\n      activeSelection.type = 'activeSelection';\n      canvas.remove(this);\n      objects.forEach(function(object) {\n        object.group = activeSelection;\n        object.dirty = true;\n        canvas.add(object);\n      });\n      activeSelection.canvas = canvas;\n      activeSelection._objects = objects;\n      canvas._activeObject = activeSelection;\n      activeSelection.setCoords();\n      return activeSelection;\n    },\n\n    /**\n     * Destroys a group (restoring state of its objects)\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    ungroupOnCanvas: function() {\n      return this._restoreObjectsState();\n    },\n\n    /**\n     * Sets coordinates of all objects inside group\n     * @return {fabric.Group} thisArg\n     * @chainable\n     */\n    setObjectsCoords: function() {\n      var skipControls = true;\n      this.forEachObject(function(object) {\n        object.setCoords(skipControls);\n      });\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _calcBounds: function(onlyWidthHeight) {\n      var aX = [],\n          aY = [],\n          o, prop, coords,\n          props = ['tr', 'br', 'bl', 'tl'],\n          i = 0, iLen = this._objects.length,\n          j, jLen = props.length;\n\n      for ( ; i < iLen; ++i) {\n        o = this._objects[i];\n        coords = o.calcACoords();\n        for (j = 0; j < jLen; j++) {\n          prop = props[j];\n          aX.push(coords[prop].x);\n          aY.push(coords[prop].y);\n        }\n        o.aCoords = coords;\n      }\n\n      this._getBounds(aX, aY, onlyWidthHeight);\n    },\n\n    /**\n     * @private\n     */\n    _getBounds: function(aX, aY, onlyWidthHeight) {\n      var minXY = new fabric.Point(min(aX), min(aY)),\n          maxXY = new fabric.Point(max(aX), max(aY)),\n          top = minXY.y || 0, left = minXY.x || 0,\n          width = (maxXY.x - minXY.x) || 0,\n          height = (maxXY.y - minXY.y) || 0;\n      this.width = width;\n      this.height = height;\n      if (!onlyWidthHeight) {\n        // the bounding box always finds the topleft most corner.\n        // whatever is the group origin, we set up here the left/top position.\n        this.setPositionByOrigin({ x: left, y: top }, 'left', 'top');\n      }\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    _toSVG: function(reviver) {\n      var svgString = ['<g ', 'COMMON_PARTS', ' >\\n'];\n\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        svgString.push('\\t\\t', this._objects[i].toSVG(reviver));\n      }\n      svgString.push('</g>\\n');\n      return svgString;\n    },\n\n    /**\n     * Returns styles-string for svg-export, specific version for group\n     * @return {String}\n     */\n    getSvgStyles: function() {\n      var opacity = typeof this.opacity !== 'undefined' && this.opacity !== 1 ?\n            'opacity: ' + this.opacity + ';' : '',\n          visibility = this.visible ? '' : ' visibility: hidden;';\n      return [\n        opacity,\n        this.getSvgFilter(),\n        visibility\n      ].join('');\n    },\n\n    /**\n     * Returns svg clipPath representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toClipPathSVG: function(reviver) {\n      var svgString = [];\n\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        svgString.push('\\t', this._objects[i].toClipPathSVG(reviver));\n      }\n\n      return this._createBaseClipPathSVGMarkup(svgString, { reviver: reviver });\n    },\n    /* _TO_SVG_END_ */\n  });\n\n  /**\n   * Returns {@link fabric.Group} instance from an object representation\n   * @static\n   * @memberOf fabric.Group\n   * @param {Object} object Object to create a group from\n   * @param {Function} [callback] Callback to invoke when an group instance is created\n   */\n  fabric.Group.fromObject = function(object, callback) {\n    var objects = object.objects,\n        options = fabric.util.object.clone(object, true);\n    delete options.objects;\n    if (typeof objects === 'string') {\n      // it has to be an url or something went wrong.\n      fabric.loadSVGFromURL(objects, function (elements) {\n        var group = fabric.util.groupSVGElements(elements, object, objects);\n        var clipPath = options.clipPath;\n        delete options.clipPath;\n        group.set(options);\n        if (clipPath) {\n          fabric.util.enlivenObjects([clipPath], function(elivenedObjects) {\n            group.clipPath = elivenedObjects[0];\n            callback && callback(group);\n          });\n        }\n        else {\n          callback && callback(group);\n        }\n      });\n      return;\n    }\n    fabric.util.enlivenObjects(objects, function (enlivenedObjects) {\n      fabric.util.enlivenObjectEnlivables(object, options, function () {\n        callback && callback(new fabric.Group(enlivenedObjects, options, true));\n      });\n    });\n  };\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { });\n\n  if (fabric.ActiveSelection) {\n    return;\n  }\n\n  /**\n   * Group class\n   * @class fabric.ActiveSelection\n   * @extends fabric.Group\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-3#groups}\n   * @see {@link fabric.ActiveSelection#initialize} for constructor definition\n   */\n  fabric.ActiveSelection = fabric.util.createClass(fabric.Group, /** @lends fabric.ActiveSelection.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'activeSelection',\n\n    /**\n     * Constructor\n     * @param {Object} objects ActiveSelection objects\n     * @param {Object} [options] Options object\n     * @return {Object} thisArg\n     */\n    initialize: function(objects, options) {\n      options = options || {};\n      this._objects = objects || [];\n      for (var i = this._objects.length; i--; ) {\n        this._objects[i].group = this;\n      }\n\n      if (options.originX) {\n        this.originX = options.originX;\n      }\n      if (options.originY) {\n        this.originY = options.originY;\n      }\n      this._calcBounds();\n      this._updateObjectsCoords();\n      fabric.Object.prototype.initialize.call(this, options);\n      this.setCoords();\n    },\n\n    /**\n     * Change te activeSelection to a normal group,\n     * High level function that automatically adds it to canvas as\n     * active object. no events fired.\n     * @since 2.0.0\n     * @return {fabric.Group}\n     */\n    toGroup: function() {\n      var objects = this._objects.concat();\n      this._objects = [];\n      var options = fabric.Object.prototype.toObject.call(this);\n      var newGroup = new fabric.Group([]);\n      delete options.type;\n      newGroup.set(options);\n      objects.forEach(function(object) {\n        object.canvas.remove(object);\n        object.group = newGroup;\n      });\n      newGroup._objects = objects;\n      if (!this.canvas) {\n        return newGroup;\n      }\n      var canvas = this.canvas;\n      canvas.add(newGroup);\n      canvas._activeObject = newGroup;\n      newGroup.setCoords();\n      return newGroup;\n    },\n\n    /**\n     * If returns true, deselection is cancelled.\n     * @since 2.0.0\n     * @return {Boolean} [cancel]\n     */\n    onDeselect: function() {\n      this.destroy();\n      return false;\n    },\n\n    /**\n     * Returns string representation of a group\n     * @return {String}\n     */\n    toString: function() {\n      return '#<fabric.ActiveSelection: (' + this.complexity() + ')>';\n    },\n\n    /**\n     * Decide if the object should cache or not. Create its own cache level\n     * objectCaching is a global flag, wins over everything\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      return false;\n    },\n\n    /**\n     * Check if this group or its parent group are caching, recursively up\n     * @return {Boolean}\n     */\n    isOnACache: function() {\n      return false;\n    },\n\n    /**\n     * Renders controls and borders for the object\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} [styleOverride] properties to override the object style\n     * @param {Object} [childrenOverride] properties to override the children overrides\n     */\n    _renderControls: function(ctx, styleOverride, childrenOverride) {\n      ctx.save();\n      ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;\n      this.callSuper('_renderControls', ctx, styleOverride);\n      childrenOverride = childrenOverride || { };\n      if (typeof childrenOverride.hasControls === 'undefined') {\n        childrenOverride.hasControls = false;\n      }\n      childrenOverride.forActiveSelection = true;\n      for (var i = 0, len = this._objects.length; i < len; i++) {\n        this._objects[i]._renderControls(ctx, childrenOverride);\n      }\n      ctx.restore();\n    },\n  });\n\n  /**\n   * Returns {@link fabric.ActiveSelection} instance from an object representation\n   * @static\n   * @memberOf fabric.ActiveSelection\n   * @param {Object} object Object to create a group from\n   * @param {Function} [callback] Callback to invoke when an ActiveSelection instance is created\n   */\n  fabric.ActiveSelection.fromObject = function(object, callback) {\n    fabric.util.enlivenObjects(object.objects, function(enlivenedObjects) {\n      delete object.objects;\n      callback && callback(new fabric.ActiveSelection(enlivenedObjects, object, true));\n    });\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var extend = fabric.util.object.extend;\n\n  if (!global.fabric) {\n    global.fabric = { };\n  }\n\n  if (global.fabric.Image) {\n    fabric.warn('fabric.Image is already defined.');\n    return;\n  }\n\n  /**\n   * Image class\n   * @class fabric.Image\n   * @extends fabric.Object\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-1#images}\n   * @see {@link fabric.Image#initialize} for constructor definition\n   */\n  fabric.Image = fabric.util.createClass(fabric.Object, /** @lends fabric.Image.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'image',\n\n    /**\n     * Width of a stroke.\n     * For image quality a stroke multiple of 2 gives better results.\n     * @type Number\n     * @default\n     */\n    strokeWidth: 0,\n\n    /**\n     * When calling {@link fabric.Image.getSrc}, return value from element src with `element.getAttribute('src')`.\n     * This allows for relative urls as image src.\n     * @since 2.7.0\n     * @type Boolean\n     * @default\n     */\n    srcFromAttribute: false,\n\n    /**\n     * private\n     * contains last value of scaleX to detect\n     * if the Image got resized after the last Render\n     * @type Number\n     */\n    _lastScaleX: 1,\n\n    /**\n     * private\n     * contains last value of scaleY to detect\n     * if the Image got resized after the last Render\n     * @type Number\n     */\n    _lastScaleY: 1,\n\n    /**\n     * private\n     * contains last value of scaling applied by the apply filter chain\n     * @type Number\n     */\n    _filterScalingX: 1,\n\n    /**\n     * private\n     * contains last value of scaling applied by the apply filter chain\n     * @type Number\n     */\n    _filterScalingY: 1,\n\n    /**\n     * minimum scale factor under which any resizeFilter is triggered to resize the image\n     * 0 will disable the automatic resize. 1 will trigger automatically always.\n     * number bigger than 1 are not implemented yet.\n     * @type Number\n     */\n    minimumScaleTrigger: 0.5,\n\n    /**\n     * List of properties to consider when checking if\n     * state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: fabric.Object.prototype.stateProperties.concat('cropX', 'cropY'),\n\n    /**\n     * List of properties to consider when checking if cache needs refresh\n     * Those properties are checked by statefullCache ON ( or lazy mode if we want ) or from single\n     * calls to Object.set(key, value). If the key is in this list, the object is marked as dirty\n     * and refreshed at the next render\n     * @type Array\n     */\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat('cropX', 'cropY'),\n\n    /**\n     * key used to retrieve the texture representing this image\n     * @since 2.0.0\n     * @type String\n     * @default\n     */\n    cacheKey: '',\n\n    /**\n     * Image crop in pixels from original image size.\n     * @since 2.0.0\n     * @type Number\n     * @default\n     */\n    cropX: 0,\n\n    /**\n     * Image crop in pixels from original image size.\n     * @since 2.0.0\n     * @type Number\n     * @default\n     */\n    cropY: 0,\n\n    /**\n     * Indicates whether this canvas will use image smoothing when painting this image.\n     * Also influence if the cacheCanvas for this image uses imageSmoothing\n     * @since 4.0.0-beta.11\n     * @type Boolean\n     * @default\n     */\n    imageSmoothing: true,\n\n    /**\n     * Constructor\n     * Image can be initialized with any canvas drawable or a string.\n     * The string should be a url and will be loaded as an image.\n     * Canvas and Image element work out of the box, while videos require extra code to work.\n     * Please check video element events for seeking.\n     * @param {HTMLImageElement | HTMLCanvasElement | HTMLVideoElement | String} element Image element\n     * @param {Object} [options] Options object\n     * @param {function} [callback] callback function to call after eventual filters applied.\n     * @return {fabric.Image} thisArg\n     */\n    initialize: function(element, options) {\n      options || (options = { });\n      this.filters = [];\n      this.cacheKey = 'texture' + fabric.Object.__uid++;\n      this.callSuper('initialize', options);\n      this._initElement(element, options);\n    },\n\n    /**\n     * Returns image element which this instance if based on\n     * @return {HTMLImageElement} Image element\n     */\n    getElement: function() {\n      return this._element || {};\n    },\n\n    /**\n     * Sets image element for this instance to a specified one.\n     * If filters defined they are applied to new image.\n     * You might need to call `canvas.renderAll` and `object.setCoords` after replacing, to render new image and update controls area.\n     * @param {HTMLImageElement} element\n     * @param {Object} [options] Options object\n     * @return {fabric.Image} thisArg\n     * @chainable\n     */\n    setElement: function(element, options) {\n      this.removeTexture(this.cacheKey);\n      this.removeTexture(this.cacheKey + '_filtered');\n      this._element = element;\n      this._originalElement = element;\n      this._initConfig(options);\n      if (this.filters.length !== 0) {\n        this.applyFilters();\n      }\n      // resizeFilters work on the already filtered copy.\n      // we need to apply resizeFilters AFTER normal filters.\n      // applyResizeFilters is run more often than normal filters\n      // and is triggered by user interactions rather than dev code\n      if (this.resizeFilter) {\n        this.applyResizeFilters();\n      }\n      return this;\n    },\n\n    /**\n     * Delete a single texture if in webgl mode\n     */\n    removeTexture: function(key) {\n      var backend = fabric.filterBackend;\n      if (backend && backend.evictCachesForKey) {\n        backend.evictCachesForKey(key);\n      }\n    },\n\n    /**\n     * Delete textures, reference to elements and eventually JSDOM cleanup\n     */\n    dispose: function () {\n      this.callSuper('dispose');\n      this.removeTexture(this.cacheKey);\n      this.removeTexture(this.cacheKey + '_filtered');\n      this._cacheContext = undefined;\n      ['_originalElement', '_element', '_filteredEl', '_cacheCanvas'].forEach((function(element) {\n        fabric.util.cleanUpJsdomNode(this[element]);\n        this[element] = undefined;\n      }).bind(this));\n    },\n\n    /**\n     * Get the crossOrigin value (of the corresponding image element)\n     */\n    getCrossOrigin: function() {\n      return this._originalElement && (this._originalElement.crossOrigin || null);\n    },\n\n    /**\n     * Returns original size of an image\n     * @return {Object} Object with \"width\" and \"height\" properties\n     */\n    getOriginalSize: function() {\n      var element = this.getElement();\n      return {\n        width: element.naturalWidth || element.width,\n        height: element.naturalHeight || element.height\n      };\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _stroke: function(ctx) {\n      if (!this.stroke || this.strokeWidth === 0) {\n        return;\n      }\n      var w = this.width / 2, h = this.height / 2;\n      ctx.beginPath();\n      ctx.moveTo(-w, -h);\n      ctx.lineTo(w, -h);\n      ctx.lineTo(w, h);\n      ctx.lineTo(-w, h);\n      ctx.lineTo(-w, -h);\n      ctx.closePath();\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var filters = [];\n\n      this.filters.forEach(function(filterObj) {\n        if (filterObj) {\n          filters.push(filterObj.toObject());\n        }\n      });\n      var object = extend(\n        this.callSuper(\n          'toObject',\n          ['cropX', 'cropY'].concat(propertiesToInclude)\n        ), {\n          src: this.getSrc(),\n          crossOrigin: this.getCrossOrigin(),\n          filters: filters,\n        });\n      if (this.resizeFilter) {\n        object.resizeFilter = this.resizeFilter.toObject();\n      }\n      return object;\n    },\n\n    /**\n     * Returns true if an image has crop applied, inspecting values of cropX,cropY,width,height.\n     * @return {Boolean}\n     */\n    hasCrop: function() {\n      return this.cropX || this.cropY || this.width < this._element.width || this.height < this._element.height;\n    },\n\n    /* _TO_SVG_START_ */\n    /**\n     * Returns svg representation of an instance\n     * @return {Array} an array of strings with the specific svg representation\n     * of the instance\n     */\n    _toSVG: function() {\n      var svgString = [], imageMarkup = [], strokeSvg, element = this._element,\n          x = -this.width / 2, y = -this.height / 2, clipPath = '', imageRendering = '';\n      if (!element) {\n        return [];\n      }\n      if (this.hasCrop()) {\n        var clipPathId = fabric.Object.__uid++;\n        svgString.push(\n          '<clipPath id=\"imageCrop_' + clipPathId + '\">\\n',\n          '\\t<rect x=\"' + x + '\" y=\"' + y + '\" width=\"' + this.width + '\" height=\"' + this.height + '\" />\\n',\n          '</clipPath>\\n'\n        );\n        clipPath = ' clip-path=\"url(#imageCrop_' + clipPathId + ')\" ';\n      }\n      if (!this.imageSmoothing) {\n        imageRendering = '\" image-rendering=\"optimizeSpeed';\n      }\n      imageMarkup.push('\\t<image ', 'COMMON_PARTS', 'xlink:href=\"', this.getSvgSrc(true),\n        '\" x=\"', x - this.cropX, '\" y=\"', y - this.cropY,\n        // we're essentially moving origin of transformation from top/left corner to the center of the shape\n        // by wrapping it in container <g> element with actual transformation, then offsetting object to the top/left\n        // so that object's center aligns with container's left/top\n        '\" width=\"', element.width || element.naturalWidth,\n        '\" height=\"', element.height || element.height,\n        imageRendering,\n        '\"', clipPath,\n        '></image>\\n');\n\n      if (this.stroke || this.strokeDashArray) {\n        var origFill = this.fill;\n        this.fill = null;\n        strokeSvg = [\n          '\\t<rect ',\n          'x=\"', x, '\" y=\"', y,\n          '\" width=\"', this.width, '\" height=\"', this.height,\n          '\" style=\"', this.getSvgStyles(),\n          '\"/>\\n'\n        ];\n        this.fill = origFill;\n      }\n      if (this.paintFirst !== 'fill') {\n        svgString = svgString.concat(strokeSvg, imageMarkup);\n      }\n      else {\n        svgString = svgString.concat(imageMarkup, strokeSvg);\n      }\n      return svgString;\n    },\n    /* _TO_SVG_END_ */\n\n    /**\n     * Returns source of an image\n     * @param {Boolean} filtered indicates if the src is needed for svg\n     * @return {String} Source of an image\n     */\n    getSrc: function(filtered) {\n      var element = filtered ? this._element : this._originalElement;\n      if (element) {\n        if (element.toDataURL) {\n          return element.toDataURL();\n        }\n\n        if (this.srcFromAttribute) {\n          return element.getAttribute('src');\n        }\n        else {\n          return element.src;\n        }\n      }\n      else {\n        return this.src || '';\n      }\n    },\n\n    /**\n     * Sets source of an image\n     * @param {String} src Source string (URL)\n     * @param {Function} [callback] Callback is invoked when image has been loaded (and all filters have been applied)\n     * @param {Object} [options] Options object\n     * @param {String} [options.crossOrigin] crossOrigin value (one of \"\", \"anonymous\", \"use-credentials\")\n     * @see https://developer.mozilla.org/en-US/docs/HTML/CORS_settings_attributes\n     * @return {fabric.Image} thisArg\n     * @chainable\n     */\n    setSrc: function(src, callback, options) {\n      fabric.util.loadImage(src, function(img, isError) {\n        this.setElement(img, options);\n        this._setWidthHeight();\n        callback && callback(this, isError);\n      }, this, options && options.crossOrigin);\n      return this;\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} String representation of an instance\n     */\n    toString: function() {\n      return '#<fabric.Image: { src: \"' + this.getSrc() + '\" }>';\n    },\n\n    applyResizeFilters: function() {\n      var filter = this.resizeFilter,\n          minimumScale = this.minimumScaleTrigger,\n          objectScale = this.getTotalObjectScaling(),\n          scaleX = objectScale.scaleX,\n          scaleY = objectScale.scaleY,\n          elementToFilter = this._filteredEl || this._originalElement;\n      if (this.group) {\n        this.set('dirty', true);\n      }\n      if (!filter || (scaleX > minimumScale && scaleY > minimumScale)) {\n        this._element = elementToFilter;\n        this._filterScalingX = 1;\n        this._filterScalingY = 1;\n        this._lastScaleX = scaleX;\n        this._lastScaleY = scaleY;\n        return;\n      }\n      if (!fabric.filterBackend) {\n        fabric.filterBackend = fabric.initFilterBackend();\n      }\n      var canvasEl = fabric.util.createCanvasElement(),\n          cacheKey = this._filteredEl ? (this.cacheKey + '_filtered') : this.cacheKey,\n          sourceWidth = elementToFilter.width, sourceHeight = elementToFilter.height;\n      canvasEl.width = sourceWidth;\n      canvasEl.height = sourceHeight;\n      this._element = canvasEl;\n      this._lastScaleX = filter.scaleX = scaleX;\n      this._lastScaleY = filter.scaleY = scaleY;\n      fabric.filterBackend.applyFilters(\n        [filter], elementToFilter, sourceWidth, sourceHeight, this._element, cacheKey);\n      this._filterScalingX = canvasEl.width / this._originalElement.width;\n      this._filterScalingY = canvasEl.height / this._originalElement.height;\n    },\n\n    /**\n     * Applies filters assigned to this image (from \"filters\" array) or from filter param\n     * @method applyFilters\n     * @param {Array} filters to be applied\n     * @param {Boolean} forResizing specify if the filter operation is a resize operation\n     * @return {thisArg} return the fabric.Image object\n     * @chainable\n     */\n    applyFilters: function(filters) {\n\n      filters = filters || this.filters || [];\n      filters = filters.filter(function(filter) { return filter && !filter.isNeutralState(); });\n      this.set('dirty', true);\n\n      // needs to clear out or WEBGL will not resize correctly\n      this.removeTexture(this.cacheKey + '_filtered');\n\n      if (filters.length === 0) {\n        this._element = this._originalElement;\n        this._filteredEl = null;\n        this._filterScalingX = 1;\n        this._filterScalingY = 1;\n        return this;\n      }\n\n      var imgElement = this._originalElement,\n          sourceWidth = imgElement.naturalWidth || imgElement.width,\n          sourceHeight = imgElement.naturalHeight || imgElement.height;\n\n      if (this._element === this._originalElement) {\n        // if the element is the same we need to create a new element\n        var canvasEl = fabric.util.createCanvasElement();\n        canvasEl.width = sourceWidth;\n        canvasEl.height = sourceHeight;\n        this._element = canvasEl;\n        this._filteredEl = canvasEl;\n      }\n      else {\n        // clear the existing element to get new filter data\n        // also dereference the eventual resized _element\n        this._element = this._filteredEl;\n        this._filteredEl.getContext('2d').clearRect(0, 0, sourceWidth, sourceHeight);\n        // we also need to resize again at next renderAll, so remove saved _lastScaleX/Y\n        this._lastScaleX = 1;\n        this._lastScaleY = 1;\n      }\n      if (!fabric.filterBackend) {\n        fabric.filterBackend = fabric.initFilterBackend();\n      }\n      fabric.filterBackend.applyFilters(\n        filters, this._originalElement, sourceWidth, sourceHeight, this._element, this.cacheKey);\n      if (this._originalElement.width !== this._element.width ||\n        this._originalElement.height !== this._element.height) {\n        this._filterScalingX = this._element.width / this._originalElement.width;\n        this._filterScalingY = this._element.height / this._originalElement.height;\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      fabric.util.setImageSmoothing(ctx, this.imageSmoothing);\n      if (this.isMoving !== true && this.resizeFilter && this._needsResize()) {\n        this.applyResizeFilters();\n      }\n      this._stroke(ctx);\n      this._renderPaintInOrder(ctx);\n    },\n\n    /**\n     * Paint the cached copy of the object on the target context.\n     * it will set the imageSmoothing for the draw operation\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    drawCacheOnCanvas: function(ctx) {\n      fabric.util.setImageSmoothing(ctx, this.imageSmoothing);\n      fabric.Object.prototype.drawCacheOnCanvas.call(this, ctx);\n    },\n\n    /**\n     * Decide if the object should cache or not. Create its own cache level\n     * needsItsOwnCache should be used when the object drawing method requires\n     * a cache step. None of the fabric classes requires it.\n     * Generally you do not cache objects in groups because the group outside is cached.\n     * This is the special image version where we would like to avoid caching where possible.\n     * Essentially images do not benefit from caching. They may require caching, and in that\n     * case we do it. Also caching an image usually ends in a loss of details.\n     * A full performance audit should be done.\n     * @return {Boolean}\n     */\n    shouldCache: function() {\n      return this.needsItsOwnCache();\n    },\n\n    _renderFill: function(ctx) {\n      var elementToDraw = this._element;\n      if (!elementToDraw) {\n        return;\n      }\n      var scaleX = this._filterScalingX, scaleY = this._filterScalingY,\n          w = this.width, h = this.height, min = Math.min, max = Math.max,\n          // crop values cannot be lesser than 0.\n          cropX = max(this.cropX, 0), cropY = max(this.cropY, 0),\n          elWidth = elementToDraw.naturalWidth || elementToDraw.width,\n          elHeight = elementToDraw.naturalHeight || elementToDraw.height,\n          sX = cropX * scaleX,\n          sY = cropY * scaleY,\n          // the width height cannot exceed element width/height, starting from the crop offset.\n          sW = min(w * scaleX, elWidth - sX),\n          sH = min(h * scaleY, elHeight - sY),\n          x = -w / 2, y = -h / 2,\n          maxDestW = min(w, elWidth / scaleX - cropX),\n          maxDestH = min(h, elHeight / scaleY - cropY);\n\n      elementToDraw && ctx.drawImage(elementToDraw, sX, sY, sW, sH, x, y, maxDestW, maxDestH);\n    },\n\n    /**\n     * needed to check if image needs resize\n     * @private\n     */\n    _needsResize: function() {\n      var scale = this.getTotalObjectScaling();\n      return (scale.scaleX !== this._lastScaleX || scale.scaleY !== this._lastScaleY);\n    },\n\n    /**\n     * @private\n     */\n    _resetWidthHeight: function() {\n      this.set(this.getOriginalSize());\n    },\n\n    /**\n     * The Image class's initialization method. This method is automatically\n     * called by the constructor.\n     * @private\n     * @param {HTMLImageElement|String} element The element representing the image\n     * @param {Object} [options] Options object\n     */\n    _initElement: function(element, options) {\n      this.setElement(fabric.util.getById(element), options);\n      fabric.util.addClass(this.getElement(), fabric.Image.CSS_CANVAS);\n    },\n\n    /**\n     * @private\n     * @param {Object} [options] Options object\n     */\n    _initConfig: function(options) {\n      options || (options = { });\n      this.setOptions(options);\n      this._setWidthHeight(options);\n    },\n\n    /**\n     * @private\n     * @param {Array} filters to be initialized\n     * @param {Function} callback Callback to invoke when all fabric.Image.filters instances are created\n     */\n    _initFilters: function(filters, callback) {\n      if (filters && filters.length) {\n        fabric.util.enlivenObjects(filters, function(enlivenedObjects) {\n          callback && callback(enlivenedObjects);\n        }, 'fabric.Image.filters');\n      }\n      else {\n        callback && callback();\n      }\n    },\n\n    /**\n     * @private\n     * Set the width and the height of the image object, using the element or the\n     * options.\n     * @param {Object} [options] Object with width/height properties\n     */\n    _setWidthHeight: function(options) {\n      options || (options = { });\n      var el = this.getElement();\n      this.width = options.width || el.naturalWidth || el.width || 0;\n      this.height = options.height || el.naturalHeight || el.height || 0;\n    },\n\n    /**\n     * Calculate offset for center and scale factor for the image in order to respect\n     * the preserveAspectRatio attribute\n     * @private\n     * @return {Object}\n     */\n    parsePreserveAspectRatioAttribute: function() {\n      var pAR = fabric.util.parsePreserveAspectRatioAttribute(this.preserveAspectRatio || ''),\n          rWidth = this._element.width, rHeight = this._element.height,\n          scaleX = 1, scaleY = 1, offsetLeft = 0, offsetTop = 0, cropX = 0, cropY = 0,\n          offset, pWidth = this.width, pHeight = this.height, parsedAttributes = { width: pWidth, height: pHeight };\n      if (pAR && (pAR.alignX !== 'none' || pAR.alignY !== 'none')) {\n        if (pAR.meetOrSlice === 'meet') {\n          scaleX = scaleY = fabric.util.findScaleToFit(this._element, parsedAttributes);\n          offset = (pWidth - rWidth * scaleX) / 2;\n          if (pAR.alignX === 'Min') {\n            offsetLeft = -offset;\n          }\n          if (pAR.alignX === 'Max') {\n            offsetLeft = offset;\n          }\n          offset = (pHeight - rHeight * scaleY) / 2;\n          if (pAR.alignY === 'Min') {\n            offsetTop = -offset;\n          }\n          if (pAR.alignY === 'Max') {\n            offsetTop = offset;\n          }\n        }\n        if (pAR.meetOrSlice === 'slice') {\n          scaleX = scaleY = fabric.util.findScaleToCover(this._element, parsedAttributes);\n          offset = rWidth - pWidth / scaleX;\n          if (pAR.alignX === 'Mid') {\n            cropX = offset / 2;\n          }\n          if (pAR.alignX === 'Max') {\n            cropX = offset;\n          }\n          offset = rHeight - pHeight / scaleY;\n          if (pAR.alignY === 'Mid') {\n            cropY = offset / 2;\n          }\n          if (pAR.alignY === 'Max') {\n            cropY = offset;\n          }\n          rWidth = pWidth / scaleX;\n          rHeight = pHeight / scaleY;\n        }\n      }\n      else {\n        scaleX = pWidth / rWidth;\n        scaleY = pHeight / rHeight;\n      }\n      return {\n        width: rWidth,\n        height: rHeight,\n        scaleX: scaleX,\n        scaleY: scaleY,\n        offsetLeft: offsetLeft,\n        offsetTop: offsetTop,\n        cropX: cropX,\n        cropY: cropY\n      };\n    }\n  });\n\n  /**\n   * Default CSS class name for canvas\n   * @static\n   * @type String\n   * @default\n   */\n  fabric.Image.CSS_CANVAS = 'canvas-img';\n\n  /**\n   * Alias for getSrc\n   * @static\n   */\n  fabric.Image.prototype.getSvgSrc = fabric.Image.prototype.getSrc;\n\n  /**\n   * Creates an instance of fabric.Image from its object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} callback Callback to invoke when an image instance is created\n   */\n  fabric.Image.fromObject = function(_object, callback) {\n    var object = fabric.util.object.clone(_object);\n    fabric.util.loadImage(object.src, function(img, isError) {\n      if (isError) {\n        callback && callback(null, true);\n        return;\n      }\n      fabric.Image.prototype._initFilters.call(object, object.filters, function(filters) {\n        object.filters = filters || [];\n        fabric.Image.prototype._initFilters.call(object, [object.resizeFilter], function(resizeFilters) {\n          object.resizeFilter = resizeFilters[0];\n          fabric.util.enlivenObjectEnlivables(object, object, function () {\n            var image = new fabric.Image(img, object);\n            callback(image, false);\n          });\n        });\n      });\n    }, null, object.crossOrigin);\n  };\n\n  /**\n   * Creates an instance of fabric.Image from an URL string\n   * @static\n   * @param {String} url URL to create an image from\n   * @param {Function} [callback] Callback to invoke when image is created (newly created image is passed as a first argument). Second argument is a boolean indicating if an error occurred or not.\n   * @param {Object} [imgOptions] Options object\n   */\n  fabric.Image.fromURL = function(url, callback, imgOptions) {\n    fabric.util.loadImage(url, function(img, isError) {\n      callback && callback(new fabric.Image(img, imgOptions), isError);\n    }, null, imgOptions && imgOptions.crossOrigin);\n  };\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Image.fromElement})\n   * @static\n   * @see {@link http://www.w3.org/TR/SVG/struct.html#ImageElement}\n   */\n  fabric.Image.ATTRIBUTE_NAMES =\n    fabric.SHARED_ATTRIBUTES.concat(\n      'x y width height preserveAspectRatio xlink:href crossOrigin image-rendering'.split(' ')\n    );\n\n  /**\n   * Returns {@link fabric.Image} instance from an SVG element\n   * @static\n   * @param {SVGElement} element Element to parse\n   * @param {Object} [options] Options object\n   * @param {Function} callback Callback to execute when fabric.Image object is created\n   * @return {fabric.Image} Instance of fabric.Image\n   */\n  fabric.Image.fromElement = function(element, callback, options) {\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Image.ATTRIBUTE_NAMES);\n    fabric.Image.fromURL(parsedAttributes['xlink:href'], callback,\n      extend((options ? fabric.util.object.clone(options) : { }), parsedAttributes));\n  };\n  /* _FROM_SVG_END_ */\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\nfabric.util.object.extend(fabric.Object.prototype, /** @lends fabric.Object.prototype */ {\n\n  /**\n   * @private\n   * @return {Number} angle value\n   */\n  _getAngleValueForStraighten: function() {\n    var angle = this.angle % 360;\n    if (angle > 0) {\n      return Math.round((angle - 1) / 90) * 90;\n    }\n    return Math.round(angle / 90) * 90;\n  },\n\n  /**\n   * Straightens an object (rotating it from current angle to one of 0, 90, 180, 270, etc. depending on which is closer)\n   * @return {fabric.Object} thisArg\n   * @chainable\n   */\n  straighten: function() {\n    return this.rotate(this._getAngleValueForStraighten());\n  },\n\n  /**\n   * Same as {@link fabric.Object.prototype.straighten} but with animation\n   * @param {Object} callbacks Object with callback functions\n   * @param {Function} [callbacks.onComplete] Invoked on completion\n   * @param {Function} [callbacks.onChange] Invoked on every step of animation\n   * @return {fabric.Object} thisArg\n   */\n  fxStraighten: function(callbacks) {\n    callbacks = callbacks || { };\n\n    var empty = function() { },\n        onComplete = callbacks.onComplete || empty,\n        onChange = callbacks.onChange || empty,\n        _this = this;\n\n    return fabric.util.animate({\n      target: this,\n      startValue: this.get('angle'),\n      endValue: this._getAngleValueForStraighten(),\n      duration: this.FX_DURATION,\n      onChange: function(value) {\n        _this.rotate(value);\n        onChange();\n      },\n      onComplete: function() {\n        _this.setCoords();\n        onComplete();\n      },\n    });\n  }\n});\n\nfabric.util.object.extend(fabric.StaticCanvas.prototype, /** @lends fabric.StaticCanvas.prototype */ {\n\n  /**\n   * Straightens object, then rerenders canvas\n   * @param {fabric.Object} object Object to straighten\n   * @return {fabric.Canvas} thisArg\n   * @chainable\n   */\n  straightenObject: function (object) {\n    object.straighten();\n    this.requestRenderAll();\n    return this;\n  },\n\n  /**\n   * Same as {@link fabric.Canvas.prototype.straightenObject}, but animated\n   * @param {fabric.Object} object Object to straighten\n   * @return {fabric.Canvas} thisArg\n   */\n  fxStraightenObject: function (object) {\n    return object.fxStraighten({\n      onChange: this.requestRenderAllBound\n    });\n  }\n});\n\n\n(function() {\n\n  'use strict';\n\n  /**\n   * Tests if webgl supports certain precision\n   * @param {WebGL} Canvas WebGL context to test on\n   * @param {String} Precision to test can be any of following: 'lowp', 'mediump', 'highp'\n   * @returns {Boolean} Whether the user's browser WebGL supports given precision.\n   */\n  function testPrecision(gl, precision){\n    var fragmentSource = 'precision ' + precision + ' float;\\nvoid main(){}';\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fragmentShader, fragmentSource);\n    gl.compileShader(fragmentShader);\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * Indicate whether this filtering backend is supported by the user's browser.\n   * @param {Number} tileSize check if the tileSize is supported\n   * @returns {Boolean} Whether the user's browser supports WebGL.\n   */\n  fabric.isWebglSupported = function(tileSize) {\n    if (fabric.isLikelyNode) {\n      return false;\n    }\n    tileSize = tileSize || fabric.WebglFilterBackend.prototype.tileSize;\n    var canvas = document.createElement('canvas');\n    var gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\n    var isSupported = false;\n    // eslint-disable-next-line\n    if (gl) {\n      fabric.maxTextureSize = gl.getParameter(gl.MAX_TEXTURE_SIZE);\n      isSupported = fabric.maxTextureSize >= tileSize;\n      var precisions = ['highp', 'mediump', 'lowp'];\n      for (var i = 0; i < 3; i++){\n        if (testPrecision(gl, precisions[i])){\n          fabric.webGlPrecision = precisions[i];\n          break;\n        };\n      }\n    }\n    this.isSupported = isSupported;\n    return isSupported;\n  };\n\n  fabric.WebglFilterBackend = WebglFilterBackend;\n\n  /**\n   * WebGL filter backend.\n   */\n  function WebglFilterBackend(options) {\n    if (options && options.tileSize) {\n      this.tileSize = options.tileSize;\n    }\n    this.setupGLContext(this.tileSize, this.tileSize);\n    this.captureGPUInfo();\n  };\n\n  WebglFilterBackend.prototype = /** @lends fabric.WebglFilterBackend.prototype */ {\n\n    tileSize: 2048,\n\n    /**\n     * Experimental. This object is a sort of repository of help layers used to avoid\n     * of recreating them during frequent filtering. If you are previewing a filter with\n     * a slider you probably do not want to create help layers every filter step.\n     * in this object there will be appended some canvases, created once, resized sometimes\n     * cleared never. Clearing is left to the developer.\n     **/\n    resources: {\n\n    },\n\n    /**\n     * Setup a WebGL context suitable for filtering, and bind any needed event handlers.\n     */\n    setupGLContext: function(width, height) {\n      this.dispose();\n      this.createWebGLCanvas(width, height);\n      // eslint-disable-next-line\n      this.aPosition = new Float32Array([0, 0, 0, 1, 1, 0, 1, 1]);\n      this.chooseFastestCopyGLTo2DMethod(width, height);\n    },\n\n    /**\n     * Pick a method to copy data from GL context to 2d canvas.  In some browsers using\n     * putImageData is faster than drawImage for that specific operation.\n     */\n    chooseFastestCopyGLTo2DMethod: function(width, height) {\n      var canMeasurePerf = typeof window.performance !== 'undefined', canUseImageData;\n      try {\n        new ImageData(1, 1);\n        canUseImageData = true;\n      }\n      catch (e) {\n        canUseImageData = false;\n      }\n      // eslint-disable-next-line no-undef\n      var canUseArrayBuffer = typeof ArrayBuffer !== 'undefined';\n      // eslint-disable-next-line no-undef\n      var canUseUint8Clamped = typeof Uint8ClampedArray !== 'undefined';\n\n      if (!(canMeasurePerf && canUseImageData && canUseArrayBuffer && canUseUint8Clamped)) {\n        return;\n      }\n\n      var targetCanvas = fabric.util.createCanvasElement();\n      // eslint-disable-next-line no-undef\n      var imageBuffer = new ArrayBuffer(width * height * 4);\n      if (fabric.forceGLPutImageData) {\n        this.imageBuffer = imageBuffer;\n        this.copyGLTo2D = copyGLTo2DPutImageData;\n        return;\n      }\n      var testContext = {\n        imageBuffer: imageBuffer,\n        destinationWidth: width,\n        destinationHeight: height,\n        targetCanvas: targetCanvas\n      };\n      var startTime, drawImageTime, putImageDataTime;\n      targetCanvas.width = width;\n      targetCanvas.height = height;\n\n      startTime = window.performance.now();\n      copyGLTo2DDrawImage.call(testContext, this.gl, testContext);\n      drawImageTime = window.performance.now() - startTime;\n\n      startTime = window.performance.now();\n      copyGLTo2DPutImageData.call(testContext, this.gl, testContext);\n      putImageDataTime = window.performance.now() - startTime;\n\n      if (drawImageTime > putImageDataTime) {\n        this.imageBuffer = imageBuffer;\n        this.copyGLTo2D = copyGLTo2DPutImageData;\n      }\n      else {\n        this.copyGLTo2D = copyGLTo2DDrawImage;\n      }\n    },\n\n    /**\n     * Create a canvas element and associated WebGL context and attaches them as\n     * class properties to the GLFilterBackend class.\n     */\n    createWebGLCanvas: function(width, height) {\n      var canvas = fabric.util.createCanvasElement();\n      canvas.width = width;\n      canvas.height = height;\n      var glOptions = {\n            alpha: true,\n            premultipliedAlpha: false,\n            depth: false,\n            stencil: false,\n            antialias: false\n          },\n          gl = canvas.getContext('webgl', glOptions);\n      if (!gl) {\n        gl = canvas.getContext('experimental-webgl', glOptions);\n      }\n      if (!gl) {\n        return;\n      }\n      gl.clearColor(0, 0, 0, 0);\n      // this canvas can fire webglcontextlost and webglcontextrestored\n      this.canvas = canvas;\n      this.gl = gl;\n    },\n\n    /**\n     * Attempts to apply the requested filters to the source provided, drawing the filtered output\n     * to the provided target canvas.\n     *\n     * @param {Array} filters The filters to apply.\n     * @param {HTMLImageElement|HTMLCanvasElement} source The source to be filtered.\n     * @param {Number} width The width of the source input.\n     * @param {Number} height The height of the source input.\n     * @param {HTMLCanvasElement} targetCanvas The destination for filtered output to be drawn.\n     * @param {String|undefined} cacheKey A key used to cache resources related to the source. If\n     * omitted, caching will be skipped.\n     */\n    applyFilters: function(filters, source, width, height, targetCanvas, cacheKey) {\n      var gl = this.gl;\n      var cachedTexture;\n      if (cacheKey) {\n        cachedTexture = this.getCachedTexture(cacheKey, source);\n      }\n      var pipelineState = {\n        originalWidth: source.width || source.originalWidth,\n        originalHeight: source.height || source.originalHeight,\n        sourceWidth: width,\n        sourceHeight: height,\n        destinationWidth: width,\n        destinationHeight: height,\n        context: gl,\n        sourceTexture: this.createTexture(gl, width, height, !cachedTexture && source),\n        targetTexture: this.createTexture(gl, width, height),\n        originalTexture: cachedTexture ||\n          this.createTexture(gl, width, height, !cachedTexture && source),\n        passes: filters.length,\n        webgl: true,\n        aPosition: this.aPosition,\n        programCache: this.programCache,\n        pass: 0,\n        filterBackend: this,\n        targetCanvas: targetCanvas\n      };\n      var tempFbo = gl.createFramebuffer();\n      gl.bindFramebuffer(gl.FRAMEBUFFER, tempFbo);\n      filters.forEach(function(filter) { filter && filter.applyTo(pipelineState); });\n      resizeCanvasIfNeeded(pipelineState);\n      this.copyGLTo2D(gl, pipelineState);\n      gl.bindTexture(gl.TEXTURE_2D, null);\n      gl.deleteTexture(pipelineState.sourceTexture);\n      gl.deleteTexture(pipelineState.targetTexture);\n      gl.deleteFramebuffer(tempFbo);\n      targetCanvas.getContext('2d').setTransform(1, 0, 0, 1, 0, 0);\n      return pipelineState;\n    },\n\n    /**\n     * Detach event listeners, remove references, and clean up caches.\n     */\n    dispose: function() {\n      if (this.canvas) {\n        this.canvas = null;\n        this.gl = null;\n      }\n      this.clearWebGLCaches();\n    },\n\n    /**\n     * Wipe out WebGL-related caches.\n     */\n    clearWebGLCaches: function() {\n      this.programCache = {};\n      this.textureCache = {};\n    },\n\n    /**\n     * Create a WebGL texture object.\n     *\n     * Accepts specific dimensions to initialize the texture to or a source image.\n     *\n     * @param {WebGLRenderingContext} gl The GL context to use for creating the texture.\n     * @param {Number} width The width to initialize the texture at.\n     * @param {Number} height The height to initialize the texture.\n     * @param {HTMLImageElement|HTMLCanvasElement} textureImageSource A source for the texture data.\n     * @param {Number} filterType gl.NEAREST or gl.LINEAR usually, webgl numeri constants\n     * @returns {WebGLTexture}\n     */\n    createTexture: function(gl, width, height, textureImageSource, filterType) {\n      var texture = gl.createTexture();\n      gl.bindTexture(gl.TEXTURE_2D, texture);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filterType || gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filterType || gl.NEAREST);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n      gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n      if (textureImageSource) {\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, textureImageSource);\n      }\n      else {\n        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n      }\n      return texture;\n    },\n\n    /**\n     * Can be optionally used to get a texture from the cache array\n     *\n     * If an existing texture is not found, a new texture is created and cached.\n     *\n     * @param {String} uniqueId A cache key to use to find an existing texture.\n     * @param {HTMLImageElement|HTMLCanvasElement} textureImageSource A source to use to create the\n     * texture cache entry if one does not already exist.\n     */\n    getCachedTexture: function(uniqueId, textureImageSource) {\n      if (this.textureCache[uniqueId]) {\n        return this.textureCache[uniqueId];\n      }\n      else {\n        var texture = this.createTexture(\n          this.gl, textureImageSource.width, textureImageSource.height, textureImageSource);\n        this.textureCache[uniqueId] = texture;\n        return texture;\n      }\n    },\n\n    /**\n     * Clear out cached resources related to a source image that has been\n     * filtered previously.\n     *\n     * @param {String} cacheKey The cache key provided when the source image was filtered.\n     */\n    evictCachesForKey: function(cacheKey) {\n      if (this.textureCache[cacheKey]) {\n        this.gl.deleteTexture(this.textureCache[cacheKey]);\n        delete this.textureCache[cacheKey];\n      }\n    },\n\n    copyGLTo2D: copyGLTo2DDrawImage,\n\n    /**\n     * Attempt to extract GPU information strings from a WebGL context.\n     *\n     * Useful information when debugging or blacklisting specific GPUs.\n     *\n     * @returns {Object} A GPU info object with renderer and vendor strings.\n     */\n    captureGPUInfo: function() {\n      if (this.gpuInfo) {\n        return this.gpuInfo;\n      }\n      var gl = this.gl, gpuInfo = { renderer: '', vendor: '' };\n      if (!gl) {\n        return gpuInfo;\n      }\n      var ext = gl.getExtension('WEBGL_debug_renderer_info');\n      if (ext) {\n        var renderer = gl.getParameter(ext.UNMASKED_RENDERER_WEBGL);\n        var vendor = gl.getParameter(ext.UNMASKED_VENDOR_WEBGL);\n        if (renderer) {\n          gpuInfo.renderer = renderer.toLowerCase();\n        }\n        if (vendor) {\n          gpuInfo.vendor = vendor.toLowerCase();\n        }\n      }\n      this.gpuInfo = gpuInfo;\n      return gpuInfo;\n    },\n  };\n})();\n\nfunction resizeCanvasIfNeeded(pipelineState) {\n  var targetCanvas = pipelineState.targetCanvas,\n      width = targetCanvas.width, height = targetCanvas.height,\n      dWidth = pipelineState.destinationWidth,\n      dHeight = pipelineState.destinationHeight;\n\n  if (width !== dWidth || height !== dHeight) {\n    targetCanvas.width = dWidth;\n    targetCanvas.height = dHeight;\n  }\n}\n\n/**\n * Copy an input WebGL canvas on to an output 2D canvas.\n *\n * The WebGL canvas is assumed to be upside down, with the top-left pixel of the\n * desired output image appearing in the bottom-left corner of the WebGL canvas.\n *\n * @param {WebGLRenderingContext} sourceContext The WebGL context to copy from.\n * @param {HTMLCanvasElement} targetCanvas The 2D target canvas to copy on to.\n * @param {Object} pipelineState The 2D target canvas to copy on to.\n */\nfunction copyGLTo2DDrawImage(gl, pipelineState) {\n  var glCanvas = gl.canvas, targetCanvas = pipelineState.targetCanvas,\n      ctx = targetCanvas.getContext('2d');\n  ctx.translate(0, targetCanvas.height); // move it down again\n  ctx.scale(1, -1); // vertical flip\n  // where is my image on the big glcanvas?\n  var sourceY = glCanvas.height - targetCanvas.height;\n  ctx.drawImage(glCanvas, 0, sourceY, targetCanvas.width, targetCanvas.height, 0, 0,\n    targetCanvas.width, targetCanvas.height);\n}\n\n/**\n * Copy an input WebGL canvas on to an output 2D canvas using 2d canvas' putImageData\n * API. Measurably faster than using ctx.drawImage in Firefox (version 54 on OSX Sierra).\n *\n * @param {WebGLRenderingContext} sourceContext The WebGL context to copy from.\n * @param {HTMLCanvasElement} targetCanvas The 2D target canvas to copy on to.\n * @param {Object} pipelineState The 2D target canvas to copy on to.\n */\nfunction copyGLTo2DPutImageData(gl, pipelineState) {\n  var targetCanvas = pipelineState.targetCanvas, ctx = targetCanvas.getContext('2d'),\n      dWidth = pipelineState.destinationWidth,\n      dHeight = pipelineState.destinationHeight,\n      numBytes = dWidth * dHeight * 4;\n\n  // eslint-disable-next-line no-undef\n  var u8 = new Uint8Array(this.imageBuffer, 0, numBytes);\n  // eslint-disable-next-line no-undef\n  var u8Clamped = new Uint8ClampedArray(this.imageBuffer, 0, numBytes);\n\n  gl.readPixels(0, 0, dWidth, dHeight, gl.RGBA, gl.UNSIGNED_BYTE, u8);\n  var imgData = new ImageData(u8Clamped, dWidth, dHeight);\n  ctx.putImageData(imgData, 0, 0);\n}\n\n\n(function() {\n\n  'use strict';\n\n  var noop = function() {};\n\n  fabric.Canvas2dFilterBackend = Canvas2dFilterBackend;\n\n  /**\n   * Canvas 2D filter backend.\n   */\n  function Canvas2dFilterBackend() {};\n\n  Canvas2dFilterBackend.prototype = /** @lends fabric.Canvas2dFilterBackend.prototype */ {\n    evictCachesForKey: noop,\n    dispose: noop,\n    clearWebGLCaches: noop,\n\n    /**\n     * Experimental. This object is a sort of repository of help layers used to avoid\n     * of recreating them during frequent filtering. If you are previewing a filter with\n     * a slider you probably do not want to create help layers every filter step.\n     * in this object there will be appended some canvases, created once, resized sometimes\n     * cleared never. Clearing is left to the developer.\n     **/\n    resources: {\n\n    },\n\n    /**\n     * Apply a set of filters against a source image and draw the filtered output\n     * to the provided destination canvas.\n     *\n     * @param {EnhancedFilter} filters The filter to apply.\n     * @param {HTMLImageElement|HTMLCanvasElement} sourceElement The source to be filtered.\n     * @param {Number} sourceWidth The width of the source input.\n     * @param {Number} sourceHeight The height of the source input.\n     * @param {HTMLCanvasElement} targetCanvas The destination for filtered output to be drawn.\n     */\n    applyFilters: function(filters, sourceElement, sourceWidth, sourceHeight, targetCanvas) {\n      var ctx = targetCanvas.getContext('2d');\n      ctx.drawImage(sourceElement, 0, 0, sourceWidth, sourceHeight);\n      var imageData = ctx.getImageData(0, 0, sourceWidth, sourceHeight);\n      var originalImageData = ctx.getImageData(0, 0, sourceWidth, sourceHeight);\n      var pipelineState = {\n        sourceWidth: sourceWidth,\n        sourceHeight: sourceHeight,\n        imageData: imageData,\n        originalEl: sourceElement,\n        originalImageData: originalImageData,\n        canvasEl: targetCanvas,\n        ctx: ctx,\n        filterBackend: this,\n      };\n      filters.forEach(function(filter) { filter.applyTo(pipelineState); });\n      if (pipelineState.imageData.width !== sourceWidth || pipelineState.imageData.height !== sourceHeight) {\n        targetCanvas.width = pipelineState.imageData.width;\n        targetCanvas.height = pipelineState.imageData.height;\n      }\n      ctx.putImageData(pipelineState.imageData, 0, 0);\n      return pipelineState;\n    },\n\n  };\n})();\n\n\n/**\n * @namespace fabric.Image.filters\n * @memberOf fabric.Image\n * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#image_filters}\n * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n */\nfabric.Image = fabric.Image || { };\nfabric.Image.filters = fabric.Image.filters || { };\n\n/**\n * Root filter class from which all filter classes inherit from\n * @class fabric.Image.filters.BaseFilter\n * @memberOf fabric.Image.filters\n */\nfabric.Image.filters.BaseFilter = fabric.util.createClass(/** @lends fabric.Image.filters.BaseFilter.prototype */ {\n\n  /**\n   * Filter type\n   * @param {String} type\n   * @default\n   */\n  type: 'BaseFilter',\n\n  /**\n   * Array of attributes to send with buffers. do not modify\n   * @private\n   */\n\n  vertexSource: 'attribute vec2 aPosition;\\n' +\n    'varying vec2 vTexCoord;\\n' +\n    'void main() {\\n' +\n      'vTexCoord = aPosition;\\n' +\n      'gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\\n' +\n    '}',\n\n  fragmentSource: 'precision highp float;\\n' +\n    'varying vec2 vTexCoord;\\n' +\n    'uniform sampler2D uTexture;\\n' +\n    'void main() {\\n' +\n      'gl_FragColor = texture2D(uTexture, vTexCoord);\\n' +\n    '}',\n\n  /**\n   * Constructor\n   * @param {Object} [options] Options object\n   */\n  initialize: function(options) {\n    if (options) {\n      this.setOptions(options);\n    }\n  },\n\n  /**\n   * Sets filter's properties from options\n   * @param {Object} [options] Options object\n   */\n  setOptions: function(options) {\n    for (var prop in options) {\n      this[prop] = options[prop];\n    }\n  },\n\n  /**\n   * Compile this filter's shader program.\n   *\n   * @param {WebGLRenderingContext} gl The GL canvas context to use for shader compilation.\n   * @param {String} fragmentSource fragmentShader source for compilation\n   * @param {String} vertexSource vertexShader source for compilation\n   */\n  createProgram: function(gl, fragmentSource, vertexSource) {\n    fragmentSource = fragmentSource || this.fragmentSource;\n    vertexSource = vertexSource || this.vertexSource;\n    if (fabric.webGlPrecision !== 'highp'){\n      fragmentSource = fragmentSource.replace(\n        /precision highp float/g,\n        'precision ' + fabric.webGlPrecision + ' float'\n      );\n    }\n    var vertexShader = gl.createShader(gl.VERTEX_SHADER);\n    gl.shaderSource(vertexShader, vertexSource);\n    gl.compileShader(vertexShader);\n    if (!gl.getShaderParameter(vertexShader, gl.COMPILE_STATUS)) {\n      throw new Error(\n        // eslint-disable-next-line prefer-template\n        'Vertex shader compile error for ' + this.type + ': ' +\n        gl.getShaderInfoLog(vertexShader)\n      );\n    }\n\n    var fragmentShader = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fragmentShader, fragmentSource);\n    gl.compileShader(fragmentShader);\n    if (!gl.getShaderParameter(fragmentShader, gl.COMPILE_STATUS)) {\n      throw new Error(\n        // eslint-disable-next-line prefer-template\n        'Fragment shader compile error for ' + this.type + ': ' +\n        gl.getShaderInfoLog(fragmentShader)\n      );\n    }\n\n    var program = gl.createProgram();\n    gl.attachShader(program, vertexShader);\n    gl.attachShader(program, fragmentShader);\n    gl.linkProgram(program);\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n      throw new Error(\n        // eslint-disable-next-line prefer-template\n        'Shader link error for \"${this.type}\" ' +\n        gl.getProgramInfoLog(program)\n      );\n    }\n\n    var attributeLocations = this.getAttributeLocations(gl, program);\n    var uniformLocations = this.getUniformLocations(gl, program) || { };\n    uniformLocations.uStepW = gl.getUniformLocation(program, 'uStepW');\n    uniformLocations.uStepH = gl.getUniformLocation(program, 'uStepH');\n    return {\n      program: program,\n      attributeLocations: attributeLocations,\n      uniformLocations: uniformLocations\n    };\n  },\n\n  /**\n   * Return a map of attribute names to WebGLAttributeLocation objects.\n   *\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n   * @param {WebGLShaderProgram} program The shader program from which to take attribute locations.\n   * @returns {Object} A map of attribute names to attribute locations.\n   */\n  getAttributeLocations: function(gl, program) {\n    return {\n      aPosition: gl.getAttribLocation(program, 'aPosition'),\n    };\n  },\n\n  /**\n   * Return a map of uniform names to WebGLUniformLocation objects.\n   *\n   * Intended to be overridden by subclasses.\n   *\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n   * @param {WebGLShaderProgram} program The shader program from which to take uniform locations.\n   * @returns {Object} A map of uniform names to uniform locations.\n   */\n  getUniformLocations: function (/* gl, program */) {\n    // in case i do not need any special uniform i need to return an empty object\n    return { };\n  },\n\n  /**\n   * Send attribute data from this filter to its shader program on the GPU.\n   *\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n   * @param {Object} attributeLocations A map of shader attribute names to their locations.\n   */\n  sendAttributeData: function(gl, attributeLocations, aPositionData) {\n    var attributeLocation = attributeLocations.aPosition;\n    var buffer = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n    gl.enableVertexAttribArray(attributeLocation);\n    gl.vertexAttribPointer(attributeLocation, 2, gl.FLOAT, false, 0, 0);\n    gl.bufferData(gl.ARRAY_BUFFER, aPositionData, gl.STATIC_DRAW);\n  },\n\n  _setupFrameBuffer: function(options) {\n    var gl = options.context, width, height;\n    if (options.passes > 1) {\n      width = options.destinationWidth;\n      height = options.destinationHeight;\n      if (options.sourceWidth !== width || options.sourceHeight !== height) {\n        gl.deleteTexture(options.targetTexture);\n        options.targetTexture = options.filterBackend.createTexture(gl, width, height);\n      }\n      gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D,\n        options.targetTexture, 0);\n    }\n    else {\n      // draw last filter on canvas and not to framebuffer.\n      gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n      gl.finish();\n    }\n  },\n\n  _swapTextures: function(options) {\n    options.passes--;\n    options.pass++;\n    var temp = options.targetTexture;\n    options.targetTexture = options.sourceTexture;\n    options.sourceTexture = temp;\n  },\n\n  /**\n   * Generic isNeutral implementation for one parameter based filters.\n   * Used only in image applyFilters to discard filters that will not have an effect\n   * on the image\n   * Other filters may need their own version ( ColorMatrix, HueRotation, gamma, ComposedFilter )\n   * @param {Object} options\n   **/\n  isNeutralState: function(/* options */) {\n    var main = this.mainParameter,\n        _class = fabric.Image.filters[this.type].prototype;\n    if (main) {\n      if (Array.isArray(_class[main])) {\n        for (var i = _class[main].length; i--;) {\n          if (this[main][i] !== _class[main][i]) {\n            return false;\n          }\n        }\n        return true;\n      }\n      else {\n        return _class[main] === this[main];\n      }\n    }\n    else {\n      return false;\n    }\n  },\n\n  /**\n   * Apply this filter to the input image data provided.\n   *\n   * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n   *\n   * @param {Object} options\n   * @param {Number} options.passes The number of filters remaining to be executed\n   * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n   * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n   * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n   * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n   * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n   */\n  applyTo: function(options) {\n    if (options.webgl) {\n      this._setupFrameBuffer(options);\n      this.applyToWebGL(options);\n      this._swapTextures(options);\n    }\n    else {\n      this.applyTo2d(options);\n    }\n  },\n\n  /**\n   * Retrieves the cached shader.\n   * @param {Object} options\n   * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n   * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n   */\n  retrieveShader: function(options) {\n    if (!options.programCache.hasOwnProperty(this.type)) {\n      options.programCache[this.type] = this.createProgram(options.context);\n    }\n    return options.programCache[this.type];\n  },\n\n  /**\n   * Apply this filter using webgl.\n   *\n   * @param {Object} options\n   * @param {Number} options.passes The number of filters remaining to be executed\n   * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n   * @param {WebGLTexture} options.originalTexture The texture of the original input image.\n   * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n   * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n   * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n   * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n   */\n  applyToWebGL: function(options) {\n    var gl = options.context;\n    var shader = this.retrieveShader(options);\n    if (options.pass === 0 && options.originalTexture) {\n      gl.bindTexture(gl.TEXTURE_2D, options.originalTexture);\n    }\n    else {\n      gl.bindTexture(gl.TEXTURE_2D, options.sourceTexture);\n    }\n    gl.useProgram(shader.program);\n    this.sendAttributeData(gl, shader.attributeLocations, options.aPosition);\n\n    gl.uniform1f(shader.uniformLocations.uStepW, 1 / options.sourceWidth);\n    gl.uniform1f(shader.uniformLocations.uStepH, 1 / options.sourceHeight);\n\n    this.sendUniformData(gl, shader.uniformLocations);\n    gl.viewport(0, 0, options.destinationWidth, options.destinationHeight);\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n  },\n\n  bindAdditionalTexture: function(gl, texture, textureUnit) {\n    gl.activeTexture(textureUnit);\n    gl.bindTexture(gl.TEXTURE_2D, texture);\n    // reset active texture to 0 as usual\n    gl.activeTexture(gl.TEXTURE0);\n  },\n\n  unbindAdditionalTexture: function(gl, textureUnit) {\n    gl.activeTexture(textureUnit);\n    gl.bindTexture(gl.TEXTURE_2D, null);\n    gl.activeTexture(gl.TEXTURE0);\n  },\n\n  getMainParameter: function() {\n    return this[this.mainParameter];\n  },\n\n  setMainParameter: function(value) {\n    this[this.mainParameter] = value;\n  },\n\n  /**\n   * Send uniform data from this filter to its shader program on the GPU.\n   *\n   * Intended to be overridden by subclasses.\n   *\n   * @param {WebGLRenderingContext} gl The canvas context used to compile the shader program.\n   * @param {Object} uniformLocations A map of shader uniform names to their locations.\n   */\n  sendUniformData: function(/* gl, uniformLocations */) {\n    // Intentionally left blank.  Override me in subclasses.\n  },\n\n  /**\n   * If needed by a 2d filter, this functions can create an helper canvas to be used\n   * remember that options.targetCanvas is available for use till end of chain.\n   */\n  createHelpLayer: function(options) {\n    if (!options.helpLayer) {\n      var helpLayer = document.createElement('canvas');\n      helpLayer.width = options.sourceWidth;\n      helpLayer.height = options.sourceHeight;\n      options.helpLayer = helpLayer;\n    }\n  },\n\n  /**\n   * Returns object representation of an instance\n   * @return {Object} Object representation of an instance\n   */\n  toObject: function() {\n    var object = { type: this.type }, mainP = this.mainParameter;\n    if (mainP) {\n      object[mainP] = this[mainP];\n    }\n    return object;\n  },\n\n  /**\n   * Returns a JSON representation of an instance\n   * @return {Object} JSON\n   */\n  toJSON: function() {\n    // delegate, not alias\n    return this.toObject();\n  }\n});\n\nfabric.Image.filters.BaseFilter.fromObject = function(object, callback) {\n  var filter = new fabric.Image.filters[object.type](object);\n  callback && callback(filter);\n  return filter;\n};\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Color Matrix filter class\n   * @class fabric.Image.filters.ColorMatrix\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.ColorMatrix#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @see {@Link http://www.webwasp.co.uk/tutorials/219/Color_Matrix_Filter.php}\n   * @see {@Link http://phoboslab.org/log/2013/11/fast-image-filters-with-webgl}\n   * @example <caption>Kodachrome filter</caption>\n   * var filter = new fabric.Image.filters.ColorMatrix({\n   *  matrix: [\n       1.1285582396593525, -0.3967382283601348, -0.03992559172921793, 0, 63.72958762196502,\n       -0.16404339962244616, 1.0835251566291304, -0.05498805115633132, 0, 24.732407896706203,\n       -0.16786010706155763, -0.5603416277695248, 1.6014850761964943, 0, 35.62982807460946,\n       0, 0, 0, 1, 0\n      ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.ColorMatrix = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.ColorMatrix.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'ColorMatrix',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'uniform mat4 uColorMatrix;\\n' +\n      'uniform vec4 uConstants;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'color *= uColorMatrix;\\n' +\n        'color += uConstants;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Colormatrix for pixels.\n     * array of 20 floats. Numbers in positions 4, 9, 14, 19 loose meaning\n     * outside the -1, 1 range.\n     * 0.0039215686 is the part of 1 that get translated to 1 in 2d\n     * @param {Array} matrix array of 20 numbers.\n     * @default\n     */\n    matrix: [\n      1, 0, 0, 0, 0,\n      0, 1, 0, 0, 0,\n      0, 0, 1, 0, 0,\n      0, 0, 0, 1, 0\n    ],\n\n    mainParameter: 'matrix',\n\n    /**\n     * Lock the colormatrix on the color part, skipping alpha, mainly for non webgl scenario\n     * to save some calculation\n     * @type Boolean\n     * @default true\n     */\n    colorsOnly: true,\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      // create a new array instead mutating the prototype with push\n      this.matrix = this.matrix.slice(0);\n    },\n\n    /**\n     * Apply the ColorMatrix operation to a Uint8Array representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data,\n          iLen = data.length,\n          m = this.matrix,\n          r, g, b, a, i, colorsOnly = this.colorsOnly;\n\n      for (i = 0; i < iLen; i += 4) {\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n        if (colorsOnly) {\n          data[i] = r * m[0] + g * m[1] + b * m[2] + m[4] * 255;\n          data[i + 1] = r * m[5] + g * m[6] + b * m[7] + m[9] * 255;\n          data[i + 2] = r * m[10] + g * m[11] + b * m[12] + m[14] * 255;\n        }\n        else {\n          a = data[i + 3];\n          data[i] = r * m[0] + g * m[1] + b * m[2] + a * m[3] + m[4] * 255;\n          data[i + 1] = r * m[5] + g * m[6] + b * m[7] + a * m[8] + m[9] * 255;\n          data[i + 2] = r * m[10] + g * m[11] + b * m[12] + a * m[13] + m[14] * 255;\n          data[i + 3] = r * m[15] + g * m[16] + b * m[17] + a * m[18] + m[19] * 255;\n        }\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uColorMatrix: gl.getUniformLocation(program, 'uColorMatrix'),\n        uConstants: gl.getUniformLocation(program, 'uConstants'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var m = this.matrix,\n          matrix = [\n            m[0], m[1], m[2], m[3],\n            m[5], m[6], m[7], m[8],\n            m[10], m[11], m[12], m[13],\n            m[15], m[16], m[17], m[18]\n          ],\n          constants = [m[4], m[9], m[14], m[19]];\n      gl.uniformMatrix4fv(uniformLocations.uColorMatrix, false, matrix);\n      gl.uniform4fv(uniformLocations.uConstants, constants);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] function to invoke after filter creation\n   * @return {fabric.Image.filters.ColorMatrix} Instance of fabric.Image.filters.ColorMatrix\n   */\n  fabric.Image.filters.ColorMatrix.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Brightness filter class\n   * @class fabric.Image.filters.Brightness\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Brightness#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Brightness({\n   *   brightness: 0.05\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Brightness = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Brightness.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Brightness',\n\n    /**\n     * Fragment source for the brightness program\n     */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uBrightness;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'color.rgb += uBrightness;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Brightness value, from -1 to 1.\n     * translated to -255 to 255 for 2d\n     * 0.0039215686 is the part of 1 that get translated to 1 in 2d\n     * @param {Number} brightness\n     * @default\n     */\n    brightness: 0,\n\n    /**\n     * Describe the property that is the filter parameter\n     * @param {String} m\n     * @default\n     */\n    mainParameter: 'brightness',\n\n    /**\n    * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n    *\n    * @param {Object} options\n    * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n    */\n    applyTo2d: function(options) {\n      if (this.brightness === 0) {\n        return;\n      }\n      var imageData = options.imageData,\n          data = imageData.data, i, len = data.length,\n          brightness = Math.round(this.brightness * 255);\n      for (i = 0; i < len; i += 4) {\n        data[i] = data[i] + brightness;\n        data[i + 1] = data[i + 1] + brightness;\n        data[i + 2] = data[i + 2] + brightness;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uBrightness: gl.getUniformLocation(program, 'uBrightness'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uBrightness, this.brightness);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Brightness} Instance of fabric.Image.filters.Brightness\n   */\n  fabric.Image.filters.Brightness.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Adapted from <a href=\"http://www.html5rocks.com/en/tutorials/canvas/imagefilters/\">html5rocks article</a>\n   * @class fabric.Image.filters.Convolute\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Convolute#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example <caption>Sharpen filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 0, -1,  0,\n   *            -1,  5, -1,\n   *             0, -1,  0 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Blur filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 1/9, 1/9, 1/9,\n   *             1/9, 1/9, 1/9,\n   *             1/9, 1/9, 1/9 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Emboss filter</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   matrix: [ 1,   1,  1,\n   *             1, 0.7, -1,\n   *            -1,  -1, -1 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   * @example <caption>Emboss filter with opaqueness</caption>\n   * var filter = new fabric.Image.filters.Convolute({\n   *   opaque: true,\n   *   matrix: [ 1,   1,  1,\n   *             1, 0.7, -1,\n   *            -1,  -1, -1 ]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.Convolute = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Convolute.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Convolute',\n\n    /*\n     * Opaque value (true/false)\n     */\n    opaque: false,\n\n    /*\n     * matrix for the filter, max 9x9\n     */\n    matrix: [0, 0, 0, 0, 1, 0, 0, 0, 0],\n\n    /**\n     * Fragment source for the brightness program\n     */\n    fragmentSource: {\n      Convolute_3_1: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[9];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\n          'for (float h = 0.0; h < 3.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 3.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 1), uStepH * (h - 1));\\n' +\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 3.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      Convolute_3_0: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[9];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\n          'for (float h = 0.0; h < 3.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 3.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 1.0), uStepH * (h - 1.0));\\n' +\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 3.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\n          'gl_FragColor = color;\\n' +\n          'gl_FragColor.a = alpha;\\n' +\n        '}',\n      Convolute_5_1: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[25];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\n          'for (float h = 0.0; h < 5.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 5.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\\n' +\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 5.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      Convolute_5_0: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[25];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\n          'for (float h = 0.0; h < 5.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 5.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 2.0), uStepH * (h - 2.0));\\n' +\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 5.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\n          'gl_FragColor = color;\\n' +\n          'gl_FragColor.a = alpha;\\n' +\n        '}',\n      Convolute_7_1: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[49];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\n          'for (float h = 0.0; h < 7.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 7.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\\n' +\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 7.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      Convolute_7_0: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[49];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\n          'for (float h = 0.0; h < 7.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 7.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 3.0), uStepH * (h - 3.0));\\n' +\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 7.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\n          'gl_FragColor = color;\\n' +\n          'gl_FragColor.a = alpha;\\n' +\n        '}',\n      Convolute_9_1: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[81];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 0);\\n' +\n          'for (float h = 0.0; h < 9.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 9.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\\n' +\n              'color += texture2D(uTexture, vTexCoord + matrixPos) * uMatrix[int(h * 9.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      Convolute_9_0: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform float uMatrix[81];\\n' +\n        'uniform float uStepW;\\n' +\n        'uniform float uStepH;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = vec4(0, 0, 0, 1);\\n' +\n          'for (float h = 0.0; h < 9.0; h+=1.0) {\\n' +\n            'for (float w = 0.0; w < 9.0; w+=1.0) {\\n' +\n              'vec2 matrixPos = vec2(uStepW * (w - 4.0), uStepH * (h - 4.0));\\n' +\n              'color.rgb += texture2D(uTexture, vTexCoord + matrixPos).rgb * uMatrix[int(h * 9.0 + w)];\\n' +\n            '}\\n' +\n          '}\\n' +\n          'float alpha = texture2D(uTexture, vTexCoord).a;\\n' +\n          'gl_FragColor = color;\\n' +\n          'gl_FragColor.a = alpha;\\n' +\n        '}',\n    },\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Convolute.prototype\n     * @param {Object} [options] Options object\n     * @param {Boolean} [options.opaque=false] Opaque value (true/false)\n     * @param {Array} [options.matrix] Filter matrix\n     */\n\n\n    /**\n    * Retrieves the cached shader.\n    * @param {Object} options\n    * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n    * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n    */\n    retrieveShader: function(options) {\n      var size = Math.sqrt(this.matrix.length);\n      var cacheKey = this.type + '_' + size + '_' + (this.opaque ? 1 : 0);\n      var shaderSource = this.fragmentSource[cacheKey];\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    /**\n     * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data,\n          weights = this.matrix,\n          side = Math.round(Math.sqrt(weights.length)),\n          halfSide = Math.floor(side / 2),\n          sw = imageData.width,\n          sh = imageData.height,\n          output = options.ctx.createImageData(sw, sh),\n          dst = output.data,\n          // go through the destination image pixels\n          alphaFac = this.opaque ? 1 : 0,\n          r, g, b, a, dstOff,\n          scx, scy, srcOff, wt,\n          x, y, cx, cy;\n\n      for (y = 0; y < sh; y++) {\n        for (x = 0; x < sw; x++) {\n          dstOff = (y * sw + x) * 4;\n          // calculate the weighed sum of the source image pixels that\n          // fall under the convolution matrix\n          r = 0; g = 0; b = 0; a = 0;\n\n          for (cy = 0; cy < side; cy++) {\n            for (cx = 0; cx < side; cx++) {\n              scy = y + cy - halfSide;\n              scx = x + cx - halfSide;\n\n              // eslint-disable-next-line max-depth\n              if (scy < 0 || scy >= sh || scx < 0 || scx >= sw) {\n                continue;\n              }\n\n              srcOff = (scy * sw + scx) * 4;\n              wt = weights[cy * side + cx];\n\n              r += data[srcOff] * wt;\n              g += data[srcOff + 1] * wt;\n              b += data[srcOff + 2] * wt;\n              // eslint-disable-next-line max-depth\n              if (!alphaFac) {\n                a += data[srcOff + 3] * wt;\n              }\n            }\n          }\n          dst[dstOff] = r;\n          dst[dstOff + 1] = g;\n          dst[dstOff + 2] = b;\n          if (!alphaFac) {\n            dst[dstOff + 3] = a;\n          }\n          else {\n            dst[dstOff + 3] = data[dstOff + 3];\n          }\n        }\n      }\n      options.imageData = output;\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uMatrix: gl.getUniformLocation(program, 'uMatrix'),\n        uOpaque: gl.getUniformLocation(program, 'uOpaque'),\n        uHalfSize: gl.getUniformLocation(program, 'uHalfSize'),\n        uSize: gl.getUniformLocation(program, 'uSize'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1fv(uniformLocations.uMatrix, this.matrix);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        opaque: this.opaque,\n        matrix: this.matrix\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Convolute} Instance of fabric.Image.filters.Convolute\n   */\n  fabric.Image.filters.Convolute.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Grayscale image filter class\n   * @class fabric.Image.filters.Grayscale\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Grayscale();\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Grayscale = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Grayscale.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Grayscale',\n\n    fragmentSource: {\n      average: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n          'float average = (color.r + color.b + color.g) / 3.0;\\n' +\n          'gl_FragColor = vec4(average, average, average, color.a);\\n' +\n        '}',\n      lightness: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform int uMode;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 col = texture2D(uTexture, vTexCoord);\\n' +\n          'float average = (max(max(col.r, col.g),col.b) + min(min(col.r, col.g),col.b)) / 2.0;\\n' +\n          'gl_FragColor = vec4(average, average, average, col.a);\\n' +\n        '}',\n      luminosity: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform int uMode;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 col = texture2D(uTexture, vTexCoord);\\n' +\n          'float average = 0.21 * col.r + 0.72 * col.g + 0.07 * col.b;\\n' +\n          'gl_FragColor = vec4(average, average, average, col.a);\\n' +\n        '}',\n    },\n\n\n    /**\n     * Grayscale mode, between 'average', 'lightness', 'luminosity'\n     * @param {String} type\n     * @default\n     */\n    mode: 'average',\n\n    mainParameter: 'mode',\n\n    /**\n     * Apply the Grayscale operation to a Uint8Array representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data, i,\n          len = data.length, value,\n          mode = this.mode;\n      for (i = 0; i < len; i += 4) {\n        if (mode === 'average') {\n          value = (data[i] + data[i + 1] + data[i + 2]) / 3;\n        }\n        else if (mode === 'lightness') {\n          value = (Math.min(data[i], data[i + 1], data[i + 2]) +\n            Math.max(data[i], data[i + 1], data[i + 2])) / 2;\n        }\n        else if (mode === 'luminosity') {\n          value = 0.21 * data[i] + 0.72 * data[i + 1] + 0.07 * data[i + 2];\n        }\n        data[i] = value;\n        data[i + 1] = value;\n        data[i + 2] = value;\n      }\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function(options) {\n      var cacheKey = this.type + '_' + this.mode;\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        var shaderSource = this.fragmentSource[this.mode];\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uMode: gl.getUniformLocation(program, 'uMode'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      // default average mode.\n      var mode = 1;\n      gl.uniform1i(uniformLocations.uMode, mode);\n    },\n\n    /**\n     * Grayscale filter isNeutralState implementation\n     * The filter is never neutral\n     * on the image\n     **/\n    isNeutralState: function() {\n      return false;\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Grayscale} Instance of fabric.Image.filters.Grayscale\n   */\n  fabric.Image.filters.Grayscale.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Invert filter class\n   * @class fabric.Image.filters.Invert\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Invert();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Invert = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Invert.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Invert',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform int uInvert;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'if (uInvert == 1) {\\n' +\n          'gl_FragColor = vec4(1.0 - color.r,1.0 -color.g,1.0 -color.b,color.a);\\n' +\n        '} else {\\n' +\n          'gl_FragColor = color;\\n' +\n        '}\\n' +\n      '}',\n\n    /**\n     * Filter invert. if false, does nothing\n     * @param {Boolean} invert\n     * @default\n     */\n    invert: true,\n\n    mainParameter: 'invert',\n\n    /**\n     * Apply the Invert operation to a Uint8Array representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data, i,\n          len = data.length;\n      for (i = 0; i < len; i += 4) {\n        data[i] = 255 - data[i];\n        data[i + 1] = 255 - data[i + 1];\n        data[i + 2] = 255 - data[i + 2];\n      }\n    },\n\n    /**\n     * Invert filter isNeutralState implementation\n     * Used only in image applyFilters to discard filters that will not have an effect\n     * on the image\n     * @param {Object} options\n     **/\n    isNeutralState: function() {\n      return !this.invert;\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uInvert: gl.getUniformLocation(program, 'uInvert'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1i(uniformLocations.uInvert, this.invert);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Invert} Instance of fabric.Image.filters.Invert\n   */\n  fabric.Image.filters.Invert.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Noise filter class\n   * @class fabric.Image.filters.Noise\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Noise#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Noise({\n   *   noise: 700\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.Noise = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Noise.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Noise',\n\n    /**\n     * Fragment source for the noise program\n     */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uStepH;\\n' +\n      'uniform float uNoise;\\n' +\n      'uniform float uSeed;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'float rand(vec2 co, float seed, float vScale) {\\n' +\n        'return fract(sin(dot(co.xy * vScale ,vec2(12.9898 , 78.233))) * 43758.5453 * (seed + 0.01) / 2.0);\\n' +\n      '}\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'color.rgb += (0.5 - rand(vTexCoord, uSeed, 0.1 / uStepH)) * uNoise;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Describe the property that is the filter parameter\n     * @param {String} m\n     * @default\n     */\n    mainParameter: 'noise',\n\n    /**\n     * Noise value, from\n     * @param {Number} noise\n     * @default\n     */\n    noise: 0,\n\n    /**\n     * Apply the Brightness operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      if (this.noise === 0) {\n        return;\n      }\n      var imageData = options.imageData,\n          data = imageData.data, i, len = data.length,\n          noise = this.noise, rand;\n\n      for (i = 0, len = data.length; i < len; i += 4) {\n\n        rand = (0.5 - Math.random()) * noise;\n\n        data[i] += rand;\n        data[i + 1] += rand;\n        data[i + 2] += rand;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uNoise: gl.getUniformLocation(program, 'uNoise'),\n        uSeed: gl.getUniformLocation(program, 'uSeed'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uNoise, this.noise / 255);\n      gl.uniform1f(uniformLocations.uSeed, Math.random());\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        noise: this.noise\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Noise} Instance of fabric.Image.filters.Noise\n   */\n  fabric.Image.filters.Noise.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Pixelate filter class\n   * @class fabric.Image.filters.Pixelate\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Pixelate#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Pixelate({\n   *   blocksize: 8\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Pixelate = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Pixelate.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Pixelate',\n\n    blocksize: 4,\n\n    mainParameter: 'blocksize',\n\n    /**\n     * Fragment source for the Pixelate program\n     */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uBlocksize;\\n' +\n      'uniform float uStepW;\\n' +\n      'uniform float uStepH;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'float blockW = uBlocksize * uStepW;\\n' +\n        'float blockH = uBlocksize * uStepW;\\n' +\n        'int posX = int(vTexCoord.x / blockW);\\n' +\n        'int posY = int(vTexCoord.y / blockH);\\n' +\n        'float fposX = float(posX);\\n' +\n        'float fposY = float(posY);\\n' +\n        'vec2 squareCoords = vec2(fposX * blockW, fposY * blockH);\\n' +\n        'vec4 color = texture2D(uTexture, squareCoords);\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Apply the Pixelate operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data,\n          iLen = imageData.height,\n          jLen = imageData.width,\n          index, i, j, r, g, b, a,\n          _i, _j, _iLen, _jLen;\n\n      for (i = 0; i < iLen; i += this.blocksize) {\n        for (j = 0; j < jLen; j += this.blocksize) {\n\n          index = (i * 4) * jLen + (j * 4);\n\n          r = data[index];\n          g = data[index + 1];\n          b = data[index + 2];\n          a = data[index + 3];\n\n          _iLen = Math.min(i + this.blocksize, iLen);\n          _jLen = Math.min(j + this.blocksize, jLen);\n          for (_i = i; _i < _iLen; _i++) {\n            for (_j = j; _j < _jLen; _j++) {\n              index = (_i * 4) * jLen + (_j * 4);\n              data[index] = r;\n              data[index + 1] = g;\n              data[index + 2] = b;\n              data[index + 3] = a;\n            }\n          }\n        }\n      }\n    },\n\n    /**\n     * Indicate when the filter is not gonna apply changes to the image\n     **/\n    isNeutralState: function() {\n      return this.blocksize === 1;\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uBlocksize: gl.getUniformLocation(program, 'uBlocksize'),\n        uStepW: gl.getUniformLocation(program, 'uStepW'),\n        uStepH: gl.getUniformLocation(program, 'uStepH'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uBlocksize, this.blocksize);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Pixelate} Instance of fabric.Image.filters.Pixelate\n   */\n  fabric.Image.filters.Pixelate.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      extend = fabric.util.object.extend,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Remove white filter class\n   * @class fabric.Image.filters.RemoveColor\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.RemoveColor#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.RemoveColor({\n   *   threshold: 0.2,\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.RemoveColor = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.RemoveColor.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'RemoveColor',\n\n    /**\n     * Color to remove, in any format understood by fabric.Color.\n     * @param {String} type\n     * @default\n     */\n    color: '#FFFFFF',\n\n    /**\n     * Fragment source for the brightness program\n     */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform vec4 uLow;\\n' +\n      'uniform vec4 uHigh;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'gl_FragColor = texture2D(uTexture, vTexCoord);\\n' +\n        'if(all(greaterThan(gl_FragColor.rgb,uLow.rgb)) && all(greaterThan(uHigh.rgb,gl_FragColor.rgb))) {\\n' +\n          'gl_FragColor.a = 0.0;\\n' +\n        '}\\n' +\n      '}',\n\n    /**\n     * distance to actual color, as value up or down from each r,g,b\n     * between 0 and 1\n     **/\n    distance: 0.02,\n\n    /**\n     * For color to remove inside distance, use alpha channel for a smoother deletion\n     * NOT IMPLEMENTED YET\n     **/\n    useAlpha: false,\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.RemoveWhite.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.color=#RRGGBB] Threshold value\n     * @param {Number} [options.distance=10] Distance value\n     */\n\n    /**\n     * Applies filter to canvas element\n     * @param {Object} canvasEl Canvas element to apply filter to\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data, i,\n          distance = this.distance * 255,\n          r, g, b,\n          source = new fabric.Color(this.color).getSource(),\n          lowC = [\n            source[0] - distance,\n            source[1] - distance,\n            source[2] - distance,\n          ],\n          highC = [\n            source[0] + distance,\n            source[1] + distance,\n            source[2] + distance,\n          ];\n\n\n      for (i = 0; i < data.length; i += 4) {\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n\n        if (r > lowC[0] &&\n            g > lowC[1] &&\n            b > lowC[2] &&\n            r < highC[0] &&\n            g < highC[1] &&\n            b < highC[2]) {\n          data[i + 3] = 0;\n        }\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uLow: gl.getUniformLocation(program, 'uLow'),\n        uHigh: gl.getUniformLocation(program, 'uHigh'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var source = new fabric.Color(this.color).getSource(),\n          distance = parseFloat(this.distance),\n          lowC = [\n            0 + source[0] / 255 - distance,\n            0 + source[1] / 255 - distance,\n            0 + source[2] / 255 - distance,\n            1\n          ],\n          highC = [\n            source[0] / 255 + distance,\n            source[1] / 255 + distance,\n            source[2] / 255 + distance,\n            1\n          ];\n      gl.uniform4fv(uniformLocations.uLow, lowC);\n      gl.uniform4fv(uniformLocations.uHigh, highC);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return extend(this.callSuper('toObject'), {\n        color: this.color,\n        distance: this.distance\n      });\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.RemoveColor} Instance of fabric.Image.filters.RemoveWhite\n   */\n  fabric.Image.filters.RemoveColor.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  var matrices = {\n    Brownie: [\n      0.59970,0.34553,-0.27082,0,0.186,\n      -0.03770,0.86095,0.15059,0,-0.1449,\n      0.24113,-0.07441,0.44972,0,-0.02965,\n      0,0,0,1,0\n    ],\n    Vintage: [\n      0.62793,0.32021,-0.03965,0,0.03784,\n      0.02578,0.64411,0.03259,0,0.02926,\n      0.04660,-0.08512,0.52416,0,0.02023,\n      0,0,0,1,0\n    ],\n    Kodachrome: [\n      1.12855,-0.39673,-0.03992,0,0.24991,\n      -0.16404,1.08352,-0.05498,0,0.09698,\n      -0.16786,-0.56034,1.60148,0,0.13972,\n      0,0,0,1,0\n    ],\n    Technicolor: [\n      1.91252,-0.85453,-0.09155,0,0.04624,\n      -0.30878,1.76589,-0.10601,0,-0.27589,\n      -0.23110,-0.75018,1.84759,0,0.12137,\n      0,0,0,1,0\n    ],\n    Polaroid: [\n      1.438,-0.062,-0.062,0,0,\n      -0.122,1.378,-0.122,0,0,\n      -0.016,-0.016,1.483,0,0,\n      0,0,0,1,0\n    ],\n    Sepia: [\n      0.393, 0.769, 0.189, 0, 0,\n      0.349, 0.686, 0.168, 0, 0,\n      0.272, 0.534, 0.131, 0, 0,\n      0, 0, 0, 1, 0\n    ],\n    BlackWhite: [\n      1.5, 1.5, 1.5, 0, -1,\n      1.5, 1.5, 1.5, 0, -1,\n      1.5, 1.5, 1.5, 0, -1,\n      0, 0, 0, 1, 0,\n    ]\n  };\n\n  for (var key in matrices) {\n    filters[key] = createClass(filters.ColorMatrix, /** @lends fabric.Image.filters.Sepia.prototype */ {\n\n      /**\n       * Filter type\n       * @param {String} type\n       * @default\n       */\n      type: key,\n\n      /**\n       * Colormatrix for the effect\n       * array of 20 floats. Numbers in positions 4, 9, 14, 19 loose meaning\n       * outside the -1, 1 range.\n       * @param {Array} matrix array of 20 numbers.\n       * @default\n       */\n      matrix: matrices[key],\n\n      /**\n       * Lock the matrix export for this kind of static, parameter less filters.\n       */\n      mainParameter: false,\n      /**\n       * Lock the colormatrix on the color part, skipping alpha\n       */\n      colorsOnly: true,\n\n    });\n    fabric.Image.filters[key].fromObject = fabric.Image.filters.BaseFilter.fromObject;\n  }\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n  'use strict';\n\n  var fabric = global.fabric,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Color Blend filter class\n   * @class fabric.Image.filter.BlendColor\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @example\n   * var filter = new fabric.Image.filters.BlendColor({\n   *  color: '#000',\n   *  mode: 'multiply'\n   * });\n   *\n   * var filter = new fabric.Image.filters.BlendImage({\n   *  image: fabricImageObject,\n   *  mode: 'multiply',\n   *  alpha: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n\n  filters.BlendColor = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Blend.prototype */ {\n    type: 'BlendColor',\n\n    /**\n     * Color to make the blend operation with. default to a reddish color since black or white\n     * gives always strong result.\n     * @type String\n     * @default\n     **/\n    color: '#F95C63',\n\n    /**\n     * Blend mode for the filter: one of multiply, add, diff, screen, subtract,\n     * darken, lighten, overlay, exclusion, tint.\n     * @type String\n     * @default\n     **/\n    mode: 'multiply',\n\n    /**\n     * alpha value. represent the strength of the blend color operation.\n     * @type Number\n     * @default\n     **/\n    alpha: 1,\n\n    /**\n     * Fragment source for the Multiply program\n     */\n    fragmentSource: {\n      multiply: 'gl_FragColor.rgb *= uColor.rgb;\\n',\n      screen: 'gl_FragColor.rgb = 1.0 - (1.0 - gl_FragColor.rgb) * (1.0 - uColor.rgb);\\n',\n      add: 'gl_FragColor.rgb += uColor.rgb;\\n',\n      diff: 'gl_FragColor.rgb = abs(gl_FragColor.rgb - uColor.rgb);\\n',\n      subtract: 'gl_FragColor.rgb -= uColor.rgb;\\n',\n      lighten: 'gl_FragColor.rgb = max(gl_FragColor.rgb, uColor.rgb);\\n',\n      darken: 'gl_FragColor.rgb = min(gl_FragColor.rgb, uColor.rgb);\\n',\n      exclusion: 'gl_FragColor.rgb += uColor.rgb - 2.0 * (uColor.rgb * gl_FragColor.rgb);\\n',\n      overlay: 'if (uColor.r < 0.5) {\\n' +\n          'gl_FragColor.r *= 2.0 * uColor.r;\\n' +\n        '} else {\\n' +\n          'gl_FragColor.r = 1.0 - 2.0 * (1.0 - gl_FragColor.r) * (1.0 - uColor.r);\\n' +\n        '}\\n' +\n        'if (uColor.g < 0.5) {\\n' +\n          'gl_FragColor.g *= 2.0 * uColor.g;\\n' +\n        '} else {\\n' +\n          'gl_FragColor.g = 1.0 - 2.0 * (1.0 - gl_FragColor.g) * (1.0 - uColor.g);\\n' +\n        '}\\n' +\n        'if (uColor.b < 0.5) {\\n' +\n          'gl_FragColor.b *= 2.0 * uColor.b;\\n' +\n        '} else {\\n' +\n          'gl_FragColor.b = 1.0 - 2.0 * (1.0 - gl_FragColor.b) * (1.0 - uColor.b);\\n' +\n        '}\\n',\n      tint: 'gl_FragColor.rgb *= (1.0 - uColor.a);\\n' +\n        'gl_FragColor.rgb += uColor.rgb;\\n',\n    },\n\n    /**\n     * build the fragment source for the filters, joining the common part with\n     * the specific one.\n     * @param {String} mode the mode of the filter, a key of this.fragmentSource\n     * @return {String} the source to be compiled\n     * @private\n     */\n    buildSource: function(mode) {\n      return 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform vec4 uColor;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'void main() {\\n' +\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n          'gl_FragColor = color;\\n' +\n          'if (color.a > 0.0) {\\n' +\n            this.fragmentSource[mode] +\n          '}\\n' +\n        '}';\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function(options) {\n      var cacheKey = this.type + '_' + this.mode, shaderSource;\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        shaderSource = this.buildSource(this.mode);\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    /**\n     * Apply the Blend operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          data = imageData.data, iLen = data.length,\n          tr, tg, tb,\n          r, g, b,\n          source, alpha1 = 1 - this.alpha;\n\n      source = new fabric.Color(this.color).getSource();\n      tr = source[0] * this.alpha;\n      tg = source[1] * this.alpha;\n      tb = source[2] * this.alpha;\n\n      for (var i = 0; i < iLen; i += 4) {\n\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n\n        switch (this.mode) {\n          case 'multiply':\n            data[i] = r * tr / 255;\n            data[i + 1] = g * tg / 255;\n            data[i + 2] = b * tb / 255;\n            break;\n          case 'screen':\n            data[i] = 255 - (255 - r) * (255 - tr) / 255;\n            data[i + 1] = 255 - (255 - g) * (255 - tg) / 255;\n            data[i + 2] = 255 - (255 - b) * (255 - tb) / 255;\n            break;\n          case 'add':\n            data[i] = r + tr;\n            data[i + 1] = g + tg;\n            data[i + 2] = b + tb;\n            break;\n          case 'diff':\n          case 'difference':\n            data[i] = Math.abs(r - tr);\n            data[i + 1] = Math.abs(g - tg);\n            data[i + 2] = Math.abs(b - tb);\n            break;\n          case 'subtract':\n            data[i] = r - tr;\n            data[i + 1] = g - tg;\n            data[i + 2] = b - tb;\n            break;\n          case 'darken':\n            data[i] = Math.min(r, tr);\n            data[i + 1] = Math.min(g, tg);\n            data[i + 2] = Math.min(b, tb);\n            break;\n          case 'lighten':\n            data[i] = Math.max(r, tr);\n            data[i + 1] = Math.max(g, tg);\n            data[i + 2] = Math.max(b, tb);\n            break;\n          case 'overlay':\n            data[i] = tr < 128 ? (2 * r * tr / 255) : (255 - 2 * (255 - r) * (255 - tr) / 255);\n            data[i + 1] = tg < 128 ? (2 * g * tg / 255) : (255 - 2 * (255 - g) * (255 - tg) / 255);\n            data[i + 2] = tb < 128 ? (2 * b * tb / 255) : (255 - 2 * (255 - b) * (255 - tb) / 255);\n            break;\n          case 'exclusion':\n            data[i] = tr + r - ((2 * tr * r) / 255);\n            data[i + 1] = tg + g - ((2 * tg * g) / 255);\n            data[i + 2] = tb + b - ((2 * tb * b) / 255);\n            break;\n          case 'tint':\n            data[i] = tr + r * alpha1;\n            data[i + 1] = tg + g * alpha1;\n            data[i + 2] = tb + b * alpha1;\n        }\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uColor: gl.getUniformLocation(program, 'uColor'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var source = new fabric.Color(this.color).getSource();\n      source[0] = this.alpha * source[0] / 255;\n      source[1] = this.alpha * source[1] / 255;\n      source[2] = this.alpha * source[2] / 255;\n      source[3] = this.alpha;\n      gl.uniform4fv(uniformLocations.uColor, source);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return {\n        type: this.type,\n        color: this.color,\n        mode: this.mode,\n        alpha: this.alpha\n      };\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.BlendColor} Instance of fabric.Image.filters.BlendColor\n   */\n  fabric.Image.filters.BlendColor.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n  'use strict';\n\n  var fabric = global.fabric,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Image Blend filter class\n   * @class fabric.Image.filter.BlendImage\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @example\n   * var filter = new fabric.Image.filters.BlendColor({\n   *  color: '#000',\n   *  mode: 'multiply'\n   * });\n   *\n   * var filter = new fabric.Image.filters.BlendImage({\n   *  image: fabricImageObject,\n   *  mode: 'multiply',\n   *  alpha: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n\n  filters.BlendImage = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.BlendImage.prototype */ {\n    type: 'BlendImage',\n\n    /**\n     * Color to make the blend operation with. default to a reddish color since black or white\n     * gives always strong result.\n     **/\n    image: null,\n\n    /**\n     * Blend mode for the filter (one of \"multiply\", \"mask\")\n     * @type String\n     * @default\n     **/\n    mode: 'multiply',\n\n    /**\n     * alpha value. represent the strength of the blend image operation.\n     * not implemented.\n     **/\n    alpha: 1,\n\n    vertexSource: 'attribute vec2 aPosition;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'varying vec2 vTexCoord2;\\n' +\n      'uniform mat3 uTransformMatrix;\\n' +\n      'void main() {\\n' +\n        'vTexCoord = aPosition;\\n' +\n        'vTexCoord2 = (uTransformMatrix * vec3(aPosition, 1.0)).xy;\\n' +\n        'gl_Position = vec4(aPosition * 2.0 - 1.0, 0.0, 1.0);\\n' +\n      '}',\n\n    /**\n     * Fragment source for the Multiply program\n     */\n    fragmentSource: {\n      multiply: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform sampler2D uImage;\\n' +\n        'uniform vec4 uColor;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'varying vec2 vTexCoord2;\\n' +\n        'void main() {\\n' +\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n          'vec4 color2 = texture2D(uImage, vTexCoord2);\\n' +\n          'color.rgba *= color2.rgba;\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n      mask: 'precision highp float;\\n' +\n        'uniform sampler2D uTexture;\\n' +\n        'uniform sampler2D uImage;\\n' +\n        'uniform vec4 uColor;\\n' +\n        'varying vec2 vTexCoord;\\n' +\n        'varying vec2 vTexCoord2;\\n' +\n        'void main() {\\n' +\n          'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n          'vec4 color2 = texture2D(uImage, vTexCoord2);\\n' +\n          'color.a = color2.a;\\n' +\n          'gl_FragColor = color;\\n' +\n        '}',\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function(options) {\n      var cacheKey = this.type + '_' + this.mode;\n      var shaderSource = this.fragmentSource[this.mode];\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        options.programCache[cacheKey] = this.createProgram(options.context, shaderSource);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    applyToWebGL: function(options) {\n      // load texture to blend.\n      var gl = options.context,\n          texture = this.createTexture(options.filterBackend, this.image);\n      this.bindAdditionalTexture(gl, texture, gl.TEXTURE1);\n      this.callSuper('applyToWebGL', options);\n      this.unbindAdditionalTexture(gl, gl.TEXTURE1);\n    },\n\n    createTexture: function(backend, image) {\n      return backend.getCachedTexture(image.cacheKey, image._element);\n    },\n\n    /**\n     * Calculate a transformMatrix to adapt the image to blend over\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    calculateMatrix: function() {\n      var image = this.image,\n          width = image._element.width,\n          height = image._element.height;\n      return [\n        1 / image.scaleX, 0, 0,\n        0, 1 / image.scaleY, 0,\n        -image.left / width, -image.top / height, 1\n      ];\n    },\n\n    /**\n     * Apply the Blend operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          resources = options.filterBackend.resources,\n          data = imageData.data, iLen = data.length,\n          width = imageData.width,\n          height = imageData.height,\n          tr, tg, tb, ta,\n          r, g, b, a,\n          canvas1, context, image = this.image, blendData;\n\n      if (!resources.blendImage) {\n        resources.blendImage = fabric.util.createCanvasElement();\n      }\n      canvas1 = resources.blendImage;\n      context = canvas1.getContext('2d');\n      if (canvas1.width !== width || canvas1.height !== height) {\n        canvas1.width = width;\n        canvas1.height = height;\n      }\n      else {\n        context.clearRect(0, 0, width, height);\n      }\n      context.setTransform(image.scaleX, 0, 0, image.scaleY, image.left, image.top);\n      context.drawImage(image._element, 0, 0, width, height);\n      blendData = context.getImageData(0, 0, width, height).data;\n      for (var i = 0; i < iLen; i += 4) {\n\n        r = data[i];\n        g = data[i + 1];\n        b = data[i + 2];\n        a = data[i + 3];\n\n        tr = blendData[i];\n        tg = blendData[i + 1];\n        tb = blendData[i + 2];\n        ta = blendData[i + 3];\n\n        switch (this.mode) {\n          case 'multiply':\n            data[i] = r * tr / 255;\n            data[i + 1] = g * tg / 255;\n            data[i + 2] = b * tb / 255;\n            data[i + 3] = a * ta / 255;\n            break;\n          case 'mask':\n            data[i + 3] = ta;\n            break;\n        }\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uTransformMatrix: gl.getUniformLocation(program, 'uTransformMatrix'),\n        uImage: gl.getUniformLocation(program, 'uImage'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var matrix = this.calculateMatrix();\n      gl.uniform1i(uniformLocations.uImage, 1); // texture unit 1.\n      gl.uniformMatrix3fv(uniformLocations.uTransformMatrix, false, matrix);\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return {\n        type: this.type,\n        image: this.image && this.image.toObject(),\n        mode: this.mode,\n        alpha: this.alpha\n      };\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} callback to be invoked after filter creation\n   * @return {fabric.Image.filters.BlendImage} Instance of fabric.Image.filters.BlendImage\n   */\n  fabric.Image.filters.BlendImage.fromObject = function(object, callback) {\n    fabric.Image.fromObject(object.image, function(image) {\n      var options = fabric.util.object.clone(object);\n      options.image = image;\n      callback(new fabric.Image.filters.BlendImage(options));\n    });\n  };\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }), pow = Math.pow, floor = Math.floor,\n      sqrt = Math.sqrt, abs = Math.abs, round = Math.round, sin = Math.sin,\n      ceil = Math.ceil,\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Resize image filter class\n   * @class fabric.Image.filters.Resize\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Resize();\n   * object.filters.push(filter);\n   * object.applyFilters(canvas.renderAll.bind(canvas));\n   */\n  filters.Resize = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Resize.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Resize',\n\n    /**\n     * Resize type\n     * for webgl resizeType is just lanczos, for canvas2d can be:\n     * bilinear, hermite, sliceHack, lanczos.\n     * @param {String} resizeType\n     * @default\n     */\n    resizeType: 'hermite',\n\n    /**\n     * Scale factor for resizing, x axis\n     * @param {Number} scaleX\n     * @default\n     */\n    scaleX: 1,\n\n    /**\n     * Scale factor for resizing, y axis\n     * @param {Number} scaleY\n     * @default\n     */\n    scaleY: 1,\n\n    /**\n     * LanczosLobes parameter for lanczos filter, valid for resizeType lanczos\n     * @param {Number} lanczosLobes\n     * @default\n     */\n    lanczosLobes: 3,\n\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uDelta: gl.getUniformLocation(program, 'uDelta'),\n        uTaps: gl.getUniformLocation(program, 'uTaps'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform2fv(uniformLocations.uDelta, this.horizontal ? [1 / this.width, 0] : [0, 1 / this.height]);\n      gl.uniform1fv(uniformLocations.uTaps, this.taps);\n    },\n\n    /**\n     * Retrieves the cached shader.\n     * @param {Object} options\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    retrieveShader: function(options) {\n      var filterWindow = this.getFilterWindow(), cacheKey = this.type + '_' + filterWindow;\n      if (!options.programCache.hasOwnProperty(cacheKey)) {\n        var fragmentShader = this.generateShader(filterWindow);\n        options.programCache[cacheKey] = this.createProgram(options.context, fragmentShader);\n      }\n      return options.programCache[cacheKey];\n    },\n\n    getFilterWindow: function() {\n      var scale = this.tempScale;\n      return Math.ceil(this.lanczosLobes / scale);\n    },\n\n    getTaps: function() {\n      var lobeFunction = this.lanczosCreate(this.lanczosLobes), scale = this.tempScale,\n          filterWindow = this.getFilterWindow(), taps = new Array(filterWindow);\n      for (var i = 1; i <= filterWindow; i++) {\n        taps[i - 1] = lobeFunction(i * scale);\n      }\n      return taps;\n    },\n\n    /**\n     * Generate vertex and shader sources from the necessary steps numbers\n     * @param {Number} filterWindow\n     */\n    generateShader: function(filterWindow) {\n      var offsets = new Array(filterWindow),\n          fragmentShader = this.fragmentSourceTOP, filterWindow;\n\n      for (var i = 1; i <= filterWindow; i++) {\n        offsets[i - 1] = i + '.0 * uDelta';\n      }\n\n      fragmentShader += 'uniform float uTaps[' + filterWindow + '];\\n';\n      fragmentShader += 'void main() {\\n';\n      fragmentShader += '  vec4 color = texture2D(uTexture, vTexCoord);\\n';\n      fragmentShader += '  float sum = 1.0;\\n';\n\n      offsets.forEach(function(offset, i) {\n        fragmentShader += '  color += texture2D(uTexture, vTexCoord + ' + offset + ') * uTaps[' + i + '];\\n';\n        fragmentShader += '  color += texture2D(uTexture, vTexCoord - ' + offset + ') * uTaps[' + i + '];\\n';\n        fragmentShader += '  sum += 2.0 * uTaps[' + i + '];\\n';\n      });\n      fragmentShader += '  gl_FragColor = color / sum;\\n';\n      fragmentShader += '}';\n      return fragmentShader;\n    },\n\n    fragmentSourceTOP: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform vec2 uDelta;\\n' +\n      'varying vec2 vTexCoord;\\n',\n\n    /**\n     * Apply the resize filter to the image\n     * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n     *\n     * @param {Object} options\n     * @param {Number} options.passes The number of filters remaining to be executed\n     * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n     * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n     * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    applyTo: function(options) {\n      if (options.webgl) {\n        options.passes++;\n        this.width = options.sourceWidth;\n        this.horizontal = true;\n        this.dW = Math.round(this.width * this.scaleX);\n        this.dH = options.sourceHeight;\n        this.tempScale = this.dW / this.width;\n        this.taps = this.getTaps();\n        options.destinationWidth = this.dW;\n        this._setupFrameBuffer(options);\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n        options.sourceWidth = options.destinationWidth;\n\n        this.height = options.sourceHeight;\n        this.horizontal = false;\n        this.dH = Math.round(this.height * this.scaleY);\n        this.tempScale = this.dH / this.height;\n        this.taps = this.getTaps();\n        options.destinationHeight = this.dH;\n        this._setupFrameBuffer(options);\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n        options.sourceHeight = options.destinationHeight;\n      }\n      else {\n        this.applyTo2d(options);\n      }\n    },\n\n    isNeutralState: function() {\n      return this.scaleX === 1 && this.scaleY === 1;\n    },\n\n    lanczosCreate: function(lobes) {\n      return function(x) {\n        if (x >= lobes || x <= -lobes) {\n          return 0.0;\n        }\n        if (x < 1.19209290E-07 && x > -1.19209290E-07) {\n          return 1.0;\n        }\n        x *= Math.PI;\n        var xx = x / lobes;\n        return (sin(x) / x) * sin(xx) / xx;\n      };\n    },\n\n    /**\n     * Applies filter to canvas element\n     * @memberOf fabric.Image.filters.Resize.prototype\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} scaleX\n     * @param {Number} scaleY\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData,\n          scaleX = this.scaleX,\n          scaleY = this.scaleY;\n\n      this.rcpScaleX = 1 / scaleX;\n      this.rcpScaleY = 1 / scaleY;\n\n      var oW = imageData.width, oH = imageData.height,\n          dW = round(oW * scaleX), dH = round(oH * scaleY),\n          newData;\n\n      if (this.resizeType === 'sliceHack') {\n        newData = this.sliceByTwo(options, oW, oH, dW, dH);\n      }\n      else if (this.resizeType === 'hermite') {\n        newData = this.hermiteFastResize(options, oW, oH, dW, dH);\n      }\n      else if (this.resizeType === 'bilinear') {\n        newData = this.bilinearFiltering(options, oW, oH, dW, dH);\n      }\n      else if (this.resizeType === 'lanczos') {\n        newData = this.lanczosResize(options, oW, oH, dW, dH);\n      }\n      options.imageData = newData;\n    },\n\n    /**\n     * Filter sliceByTwo\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    sliceByTwo: function(options, oW, oH, dW, dH) {\n      var imageData = options.imageData,\n          mult = 0.5, doneW = false, doneH = false, stepW = oW * mult,\n          stepH = oH * mult, resources = fabric.filterBackend.resources,\n          tmpCanvas, ctx, sX = 0, sY = 0, dX = oW, dY = 0;\n      if (!resources.sliceByTwo) {\n        resources.sliceByTwo = document.createElement('canvas');\n      }\n      tmpCanvas = resources.sliceByTwo;\n      if (tmpCanvas.width < oW * 1.5 || tmpCanvas.height < oH) {\n        tmpCanvas.width = oW * 1.5;\n        tmpCanvas.height = oH;\n      }\n      ctx = tmpCanvas.getContext('2d');\n      ctx.clearRect(0, 0, oW * 1.5, oH);\n      ctx.putImageData(imageData, 0, 0);\n\n      dW = floor(dW);\n      dH = floor(dH);\n\n      while (!doneW || !doneH) {\n        oW = stepW;\n        oH = stepH;\n        if (dW < floor(stepW * mult)) {\n          stepW = floor(stepW * mult);\n        }\n        else {\n          stepW = dW;\n          doneW = true;\n        }\n        if (dH < floor(stepH * mult)) {\n          stepH = floor(stepH * mult);\n        }\n        else {\n          stepH = dH;\n          doneH = true;\n        }\n        ctx.drawImage(tmpCanvas, sX, sY, oW, oH, dX, dY, stepW, stepH);\n        sX = dX;\n        sY = dY;\n        dY += stepH;\n      }\n      return ctx.getImageData(sX, sY, dW, dH);\n    },\n\n    /**\n     * Filter lanczosResize\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    lanczosResize: function(options, oW, oH, dW, dH) {\n\n      function process(u) {\n        var v, i, weight, idx, a, red, green,\n            blue, alpha, fX, fY;\n        center.x = (u + 0.5) * ratioX;\n        icenter.x = floor(center.x);\n        for (v = 0; v < dH; v++) {\n          center.y = (v + 0.5) * ratioY;\n          icenter.y = floor(center.y);\n          a = 0; red = 0; green = 0; blue = 0; alpha = 0;\n          for (i = icenter.x - range2X; i <= icenter.x + range2X; i++) {\n            if (i < 0 || i >= oW) {\n              continue;\n            }\n            fX = floor(1000 * abs(i - center.x));\n            if (!cacheLanc[fX]) {\n              cacheLanc[fX] = { };\n            }\n            for (var j = icenter.y - range2Y; j <= icenter.y + range2Y; j++) {\n              if (j < 0 || j >= oH) {\n                continue;\n              }\n              fY = floor(1000 * abs(j - center.y));\n              if (!cacheLanc[fX][fY]) {\n                cacheLanc[fX][fY] = lanczos(sqrt(pow(fX * rcpRatioX, 2) + pow(fY * rcpRatioY, 2)) / 1000);\n              }\n              weight = cacheLanc[fX][fY];\n              if (weight > 0) {\n                idx = (j * oW + i) * 4;\n                a += weight;\n                red += weight * srcData[idx];\n                green += weight * srcData[idx + 1];\n                blue += weight * srcData[idx + 2];\n                alpha += weight * srcData[idx + 3];\n              }\n            }\n          }\n          idx = (v * dW + u) * 4;\n          destData[idx] = red / a;\n          destData[idx + 1] = green / a;\n          destData[idx + 2] = blue / a;\n          destData[idx + 3] = alpha / a;\n        }\n\n        if (++u < dW) {\n          return process(u);\n        }\n        else {\n          return destImg;\n        }\n      }\n\n      var srcData = options.imageData.data,\n          destImg = options.ctx.createImageData(dW, dH),\n          destData = destImg.data,\n          lanczos = this.lanczosCreate(this.lanczosLobes),\n          ratioX = this.rcpScaleX, ratioY = this.rcpScaleY,\n          rcpRatioX = 2 / this.rcpScaleX, rcpRatioY = 2 / this.rcpScaleY,\n          range2X = ceil(ratioX * this.lanczosLobes / 2),\n          range2Y = ceil(ratioY * this.lanczosLobes / 2),\n          cacheLanc = { }, center = { }, icenter = { };\n\n      return process(0);\n    },\n\n    /**\n     * bilinearFiltering\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    bilinearFiltering: function(options, oW, oH, dW, dH) {\n      var a, b, c, d, x, y, i, j, xDiff, yDiff, chnl,\n          color, offset = 0, origPix, ratioX = this.rcpScaleX,\n          ratioY = this.rcpScaleY,\n          w4 = 4 * (oW - 1), img = options.imageData,\n          pixels = img.data, destImage = options.ctx.createImageData(dW, dH),\n          destPixels = destImage.data;\n      for (i = 0; i < dH; i++) {\n        for (j = 0; j < dW; j++) {\n          x = floor(ratioX * j);\n          y = floor(ratioY * i);\n          xDiff = ratioX * j - x;\n          yDiff = ratioY * i - y;\n          origPix = 4 * (y * oW + x);\n\n          for (chnl = 0; chnl < 4; chnl++) {\n            a = pixels[origPix + chnl];\n            b = pixels[origPix + 4 + chnl];\n            c = pixels[origPix + w4 + chnl];\n            d = pixels[origPix + w4 + 4 + chnl];\n            color = a * (1 - xDiff) * (1 - yDiff) + b * xDiff * (1 - yDiff) +\n                    c * yDiff * (1 - xDiff) + d * xDiff * yDiff;\n            destPixels[offset++] = color;\n          }\n        }\n      }\n      return destImage;\n    },\n\n    /**\n     * hermiteFastResize\n     * @param {Object} canvasEl Canvas element to apply filter to\n     * @param {Number} oW Original Width\n     * @param {Number} oH Original Height\n     * @param {Number} dW Destination Width\n     * @param {Number} dH Destination Height\n     * @returns {ImageData}\n     */\n    hermiteFastResize: function(options, oW, oH, dW, dH) {\n      var ratioW = this.rcpScaleX, ratioH = this.rcpScaleY,\n          ratioWHalf = ceil(ratioW / 2),\n          ratioHHalf = ceil(ratioH / 2),\n          img = options.imageData, data = img.data,\n          img2 = options.ctx.createImageData(dW, dH), data2 = img2.data;\n      for (var j = 0; j < dH; j++) {\n        for (var i = 0; i < dW; i++) {\n          var x2 = (i + j * dW) * 4, weight = 0, weights = 0, weightsAlpha = 0,\n              gxR = 0, gxG = 0, gxB = 0, gxA = 0, centerY = (j + 0.5) * ratioH;\n          for (var yy = floor(j * ratioH); yy < (j + 1) * ratioH; yy++) {\n            var dy = abs(centerY - (yy + 0.5)) / ratioHHalf,\n                centerX = (i + 0.5) * ratioW, w0 = dy * dy;\n            for (var xx = floor(i * ratioW); xx < (i + 1) * ratioW; xx++) {\n              var dx = abs(centerX - (xx + 0.5)) / ratioWHalf,\n                  w = sqrt(w0 + dx * dx);\n              /* eslint-disable max-depth */\n              if (w > 1 && w < -1) {\n                continue;\n              }\n              //hermite filter\n              weight = 2 * w * w * w - 3 * w * w + 1;\n              if (weight > 0) {\n                dx = 4 * (xx + yy * oW);\n                //alpha\n                gxA += weight * data[dx + 3];\n                weightsAlpha += weight;\n                //colors\n                if (data[dx + 3] < 255) {\n                  weight = weight * data[dx + 3] / 250;\n                }\n                gxR += weight * data[dx];\n                gxG += weight * data[dx + 1];\n                gxB += weight * data[dx + 2];\n                weights += weight;\n              }\n              /* eslint-enable max-depth */\n            }\n          }\n          data2[x2] = gxR / weights;\n          data2[x2 + 1] = gxG / weights;\n          data2[x2 + 2] = gxB / weights;\n          data2[x2 + 3] = gxA / weightsAlpha;\n        }\n      }\n      return img2;\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function() {\n      return {\n        type: this.type,\n        scaleX: this.scaleX,\n        scaleY: this.scaleY,\n        resizeType: this.resizeType,\n        lanczosLobes: this.lanczosLobes\n      };\n    }\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Resize} Instance of fabric.Image.filters.Resize\n   */\n  fabric.Image.filters.Resize.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Contrast filter class\n   * @class fabric.Image.filters.Contrast\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Contrast#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Contrast({\n   *   contrast: 0.25\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Contrast = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Contrast.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Contrast',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uContrast;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'float contrastF = 1.015 * (uContrast + 1.0) / (1.0 * (1.015 - uContrast));\\n' +\n        'color.rgb = contrastF * (color.rgb - 0.5) + 0.5;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * contrast value, range from -1 to 1.\n     * @param {Number} contrast\n     * @default 0\n     */\n    contrast: 0,\n\n    mainParameter: 'contrast',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Contrast.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.contrast=0] Value to contrast the image up (-1...1)\n     */\n\n    /**\n      * Apply the Contrast operation to a Uint8Array representing the pixels of an image.\n      *\n      * @param {Object} options\n      * @param {ImageData} options.imageData The Uint8Array to be filtered.\n      */\n    applyTo2d: function(options) {\n      if (this.contrast === 0) {\n        return;\n      }\n      var imageData = options.imageData, i, len,\n          data = imageData.data, len = data.length,\n          contrast = Math.floor(this.contrast * 255),\n          contrastF = 259 * (contrast + 255) / (255 * (259 - contrast));\n\n      for (i = 0; i < len; i += 4) {\n        data[i] = contrastF * (data[i] - 128) + 128;\n        data[i + 1] = contrastF * (data[i + 1] - 128) + 128;\n        data[i + 2] = contrastF * (data[i + 2] - 128) + 128;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uContrast: gl.getUniformLocation(program, 'uContrast'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uContrast, this.contrast);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Contrast} Instance of fabric.Image.filters.Contrast\n   */\n  fabric.Image.filters.Contrast.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Saturate filter class\n   * @class fabric.Image.filters.Saturation\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Saturation#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Saturation({\n   *   saturation: 1\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Saturation = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Saturation.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Saturation',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uSaturation;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'float rgMax = max(color.r, color.g);\\n' +\n        'float rgbMax = max(rgMax, color.b);\\n' +\n        'color.r += rgbMax != color.r ? (rgbMax - color.r) * uSaturation : 0.00;\\n' +\n        'color.g += rgbMax != color.g ? (rgbMax - color.g) * uSaturation : 0.00;\\n' +\n        'color.b += rgbMax != color.b ? (rgbMax - color.b) * uSaturation : 0.00;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Saturation value, from -1 to 1.\n     * Increases/decreases the color saturation.\n     * A value of 0 has no effect.\n     * \n     * @param {Number} saturation\n     * @default\n     */\n    saturation: 0,\n\n    mainParameter: 'saturation',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Saturate.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.saturate=0] Value to saturate the image (-1...1)\n     */\n\n    /**\n     * Apply the Saturation operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      if (this.saturation === 0) {\n        return;\n      }\n      var imageData = options.imageData,\n          data = imageData.data, len = data.length,\n          adjust = -this.saturation, i, max;\n\n      for (i = 0; i < len; i += 4) {\n        max = Math.max(data[i], data[i + 1], data[i + 2]);\n        data[i] += max !== data[i] ? (max - data[i]) * adjust : 0;\n        data[i + 1] += max !== data[i + 1] ? (max - data[i + 1]) * adjust : 0;\n        data[i + 2] += max !== data[i + 2] ? (max - data[i + 2]) * adjust : 0;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uSaturation: gl.getUniformLocation(program, 'uSaturation'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uSaturation, -this.saturation);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Saturation} Instance of fabric.Image.filters.Saturate\n   */\n  fabric.Image.filters.Saturation.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Vibrance filter class\n   * @class fabric.Image.filters.Vibrance\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Vibrance#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Vibrance({\n   *   vibrance: 1\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Vibrance = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Vibrance.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Vibrance',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform float uVibrance;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'float max = max(color.r, max(color.g, color.b));\\n' +\n        'float avg = (color.r + color.g + color.b) / 3.0;\\n' +\n        'float amt = (abs(max - avg) * 2.0) * uVibrance;\\n' +\n        'color.r += max != color.r ? (max - color.r) * amt : 0.00;\\n' +\n        'color.g += max != color.g ? (max - color.g) * amt : 0.00;\\n' +\n        'color.b += max != color.b ? (max - color.b) * amt : 0.00;\\n' +\n        'gl_FragColor = color;\\n' +\n      '}',\n\n    /**\n     * Vibrance value, from -1 to 1.\n     * Increases/decreases the saturation of more muted colors with less effect on saturated colors.\n     * A value of 0 has no effect.\n     * \n     * @param {Number} vibrance\n     * @default\n     */\n    vibrance: 0,\n\n    mainParameter: 'vibrance',\n\n    /**\n     * Constructor\n     * @memberOf fabric.Image.filters.Vibrance.prototype\n     * @param {Object} [options] Options object\n     * @param {Number} [options.vibrance=0] Vibrance value for the image (between -1 and 1)\n     */\n\n    /**\n     * Apply the Vibrance operation to a Uint8ClampedArray representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8ClampedArray to be filtered.\n     */\n    applyTo2d: function(options) {\n      if (this.vibrance === 0) {\n        return;\n      }\n      var imageData = options.imageData,\n          data = imageData.data, len = data.length,\n          adjust = -this.vibrance, i, max, avg, amt;\n\n      for (i = 0; i < len; i += 4) {\n        max = Math.max(data[i], data[i + 1], data[i + 2]);\n        avg = (data[i] + data[i + 1] + data[i + 2]) / 3;\n        amt = ((Math.abs(max - avg) * 2 / 255) * adjust);\n        data[i] += max !== data[i] ? (max - data[i]) * amt : 0;\n        data[i + 1] += max !== data[i + 1] ? (max - data[i + 1]) * amt : 0;\n        data[i + 2] += max !== data[i + 2] ? (max - data[i + 2]) * amt : 0;\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uVibrance: gl.getUniformLocation(program, 'uVibrance'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform1f(uniformLocations.uVibrance, -this.vibrance);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Vibrance} Instance of fabric.Image.filters.Vibrance\n   */\n  fabric.Image.filters.Vibrance.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Blur filter class\n   * @class fabric.Image.filters.Blur\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Blur#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Blur({\n   *   blur: 0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   * canvas.renderAll();\n   */\n  filters.Blur = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Blur.prototype */ {\n\n    type: 'Blur',\n\n    /*\n'gl_FragColor = vec4(0.0);',\n'gl_FragColor += texture2D(texture, vTexCoord + -7 * uDelta)*0.0044299121055113265;',\n'gl_FragColor += texture2D(texture, vTexCoord + -6 * uDelta)*0.00895781211794;',\n'gl_FragColor += texture2D(texture, vTexCoord + -5 * uDelta)*0.0215963866053;',\n'gl_FragColor += texture2D(texture, vTexCoord + -4 * uDelta)*0.0443683338718;',\n'gl_FragColor += texture2D(texture, vTexCoord + -3 * uDelta)*0.0776744219933;',\n'gl_FragColor += texture2D(texture, vTexCoord + -2 * uDelta)*0.115876621105;',\n'gl_FragColor += texture2D(texture, vTexCoord + -1 * uDelta)*0.147308056121;',\n'gl_FragColor += texture2D(texture, vTexCoord              )*0.159576912161;',\n'gl_FragColor += texture2D(texture, vTexCoord + 1 * uDelta)*0.147308056121;',\n'gl_FragColor += texture2D(texture, vTexCoord + 2 * uDelta)*0.115876621105;',\n'gl_FragColor += texture2D(texture, vTexCoord + 3 * uDelta)*0.0776744219933;',\n'gl_FragColor += texture2D(texture, vTexCoord + 4 * uDelta)*0.0443683338718;',\n'gl_FragColor += texture2D(texture, vTexCoord + 5 * uDelta)*0.0215963866053;',\n'gl_FragColor += texture2D(texture, vTexCoord + 6 * uDelta)*0.00895781211794;',\n'gl_FragColor += texture2D(texture, vTexCoord + 7 * uDelta)*0.0044299121055113265;',\n*/\n\n    /* eslint-disable max-len */\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform vec2 uDelta;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'const float nSamples = 15.0;\\n' +\n      'vec3 v3offset = vec3(12.9898, 78.233, 151.7182);\\n' +\n      'float random(vec3 scale) {\\n' +\n        /* use the fragment position for a different seed per-pixel */\n        'return fract(sin(dot(gl_FragCoord.xyz, scale)) * 43758.5453);\\n' +\n      '}\\n' +\n      'void main() {\\n' +\n        'vec4 color = vec4(0.0);\\n' +\n        'float total = 0.0;\\n' +\n        'float offset = random(v3offset);\\n' +\n        'for (float t = -nSamples; t <= nSamples; t++) {\\n' +\n          'float percent = (t + offset - 0.5) / nSamples;\\n' +\n          'float weight = 1.0 - abs(percent);\\n' +\n          'color += texture2D(uTexture, vTexCoord + uDelta * percent) * weight;\\n' +\n          'total += weight;\\n' +\n        '}\\n' +\n        'gl_FragColor = color / total;\\n' +\n      '}',\n    /* eslint-enable max-len */\n\n    /**\n     * blur value, in percentage of image dimensions.\n     * specific to keep the image blur constant at different resolutions\n     * range between 0 and 1.\n     * @type Number\n     * @default\n     */\n    blur: 0,\n\n    mainParameter: 'blur',\n\n    applyTo: function(options) {\n      if (options.webgl) {\n        // this aspectRatio is used to give the same blur to vertical and horizontal\n        this.aspectRatio = options.sourceWidth / options.sourceHeight;\n        options.passes++;\n        this._setupFrameBuffer(options);\n        this.horizontal = true;\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n        this._setupFrameBuffer(options);\n        this.horizontal = false;\n        this.applyToWebGL(options);\n        this._swapTextures(options);\n      }\n      else {\n        this.applyTo2d(options);\n      }\n    },\n\n    applyTo2d: function(options) {\n      // paint canvasEl with current image data.\n      //options.ctx.putImageData(options.imageData, 0, 0);\n      options.imageData = this.simpleBlur(options);\n    },\n\n    simpleBlur: function(options) {\n      var resources = options.filterBackend.resources, canvas1, canvas2,\n          width = options.imageData.width,\n          height = options.imageData.height;\n\n      if (!resources.blurLayer1) {\n        resources.blurLayer1 = fabric.util.createCanvasElement();\n        resources.blurLayer2 = fabric.util.createCanvasElement();\n      }\n      canvas1 = resources.blurLayer1;\n      canvas2 = resources.blurLayer2;\n      if (canvas1.width !== width || canvas1.height !== height) {\n        canvas2.width = canvas1.width = width;\n        canvas2.height = canvas1.height = height;\n      }\n      var ctx1 = canvas1.getContext('2d'),\n          ctx2 = canvas2.getContext('2d'),\n          nSamples = 15,\n          random, percent, j, i,\n          blur = this.blur * 0.06 * 0.5;\n\n      // load first canvas\n      ctx1.putImageData(options.imageData, 0, 0);\n      ctx2.clearRect(0, 0, width, height);\n\n      for (i = -nSamples; i <= nSamples; i++) {\n        random = (Math.random() - 0.5) / 4;\n        percent = i / nSamples;\n        j = blur * percent * width + random;\n        ctx2.globalAlpha = 1 - Math.abs(percent);\n        ctx2.drawImage(canvas1, j, random);\n        ctx1.drawImage(canvas2, 0, 0);\n        ctx2.globalAlpha = 1;\n        ctx2.clearRect(0, 0, canvas2.width, canvas2.height);\n      }\n      for (i = -nSamples; i <= nSamples; i++) {\n        random = (Math.random() - 0.5) / 4;\n        percent = i / nSamples;\n        j = blur * percent * height + random;\n        ctx2.globalAlpha = 1 - Math.abs(percent);\n        ctx2.drawImage(canvas1, random, j);\n        ctx1.drawImage(canvas2, 0, 0);\n        ctx2.globalAlpha = 1;\n        ctx2.clearRect(0, 0, canvas2.width, canvas2.height);\n      }\n      options.ctx.drawImage(canvas1, 0, 0);\n      var newImageData = options.ctx.getImageData(0, 0, canvas1.width, canvas1.height);\n      ctx1.globalAlpha = 1;\n      ctx1.clearRect(0, 0, canvas1.width, canvas1.height);\n      return newImageData;\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        delta: gl.getUniformLocation(program, 'uDelta'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      var delta = this.chooseRightDelta();\n      gl.uniform2fv(uniformLocations.delta, delta);\n    },\n\n    /**\n     * choose right value of image percentage to blur with\n     * @returns {Array} a numeric array with delta values\n     */\n    chooseRightDelta: function() {\n      var blurScale = 1, delta = [0, 0], blur;\n      if (this.horizontal) {\n        if (this.aspectRatio > 1) {\n          // image is wide, i want to shrink radius horizontal\n          blurScale = 1 / this.aspectRatio;\n        }\n      }\n      else {\n        if (this.aspectRatio < 1) {\n          // image is tall, i want to shrink radius vertical\n          blurScale = this.aspectRatio;\n        }\n      }\n      blur = blurScale * this.blur * 0.12;\n      if (this.horizontal) {\n        delta[0] = blur;\n      }\n      else {\n        delta[1] = blur;\n      }\n      return delta;\n    },\n  });\n\n  /**\n   * Deserialize a JSON definition of a BlurFilter into a concrete instance.\n   */\n  filters.Blur.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * Gamma filter class\n   * @class fabric.Image.filters.Gamma\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.Gamma#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.Gamma({\n   *   gamma: [1, 0.5, 2.1]\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.Gamma = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Gamma.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'Gamma',\n\n    fragmentSource: 'precision highp float;\\n' +\n      'uniform sampler2D uTexture;\\n' +\n      'uniform vec3 uGamma;\\n' +\n      'varying vec2 vTexCoord;\\n' +\n      'void main() {\\n' +\n        'vec4 color = texture2D(uTexture, vTexCoord);\\n' +\n        'vec3 correction = (1.0 / uGamma);\\n' +\n        'color.r = pow(color.r, correction.r);\\n' +\n        'color.g = pow(color.g, correction.g);\\n' +\n        'color.b = pow(color.b, correction.b);\\n' +\n        'gl_FragColor = color;\\n' +\n        'gl_FragColor.rgb *= color.a;\\n' +\n      '}',\n\n    /**\n     * Gamma array value, from 0.01 to 2.2.\n     * @param {Array} gamma\n     * @default\n     */\n    gamma: [1, 1, 1],\n\n    /**\n     * Describe the property that is the filter parameter\n     * @param {String} m\n     * @default\n     */\n    mainParameter: 'gamma',\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      this.gamma = [1, 1, 1];\n      filters.BaseFilter.prototype.initialize.call(this, options);\n    },\n\n    /**\n     * Apply the Gamma operation to a Uint8Array representing the pixels of an image.\n     *\n     * @param {Object} options\n     * @param {ImageData} options.imageData The Uint8Array to be filtered.\n     */\n    applyTo2d: function(options) {\n      var imageData = options.imageData, data = imageData.data,\n          gamma = this.gamma, len = data.length,\n          rInv = 1 / gamma[0], gInv = 1 / gamma[1],\n          bInv = 1 / gamma[2], i;\n\n      if (!this.rVals) {\n        // eslint-disable-next-line\n        this.rVals = new Uint8Array(256);\n        // eslint-disable-next-line\n        this.gVals = new Uint8Array(256);\n        // eslint-disable-next-line\n        this.bVals = new Uint8Array(256);\n      }\n\n      // This is an optimization - pre-compute a look-up table for each color channel\n      // instead of performing these pow calls for each pixel in the image.\n      for (i = 0, len = 256; i < len; i++) {\n        this.rVals[i] = Math.pow(i / 255, rInv) * 255;\n        this.gVals[i] = Math.pow(i / 255, gInv) * 255;\n        this.bVals[i] = Math.pow(i / 255, bInv) * 255;\n      }\n      for (i = 0, len = data.length; i < len; i += 4) {\n        data[i] = this.rVals[data[i]];\n        data[i + 1] = this.gVals[data[i + 1]];\n        data[i + 2] = this.bVals[data[i + 2]];\n      }\n    },\n\n    /**\n     * Return WebGL uniform locations for this filter's shader.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {WebGLShaderProgram} program This filter's compiled shader program.\n     */\n    getUniformLocations: function(gl, program) {\n      return {\n        uGamma: gl.getUniformLocation(program, 'uGamma'),\n      };\n    },\n\n    /**\n     * Send data from this filter to its shader program's uniforms.\n     *\n     * @param {WebGLRenderingContext} gl The GL canvas context used to compile this filter's shader.\n     * @param {Object} uniformLocations A map of string uniform names to WebGLUniformLocation objects\n     */\n    sendUniformData: function(gl, uniformLocations) {\n      gl.uniform3fv(uniformLocations.uGamma, this.gamma);\n    },\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.Gamma} Instance of fabric.Image.filters.Gamma\n   */\n  fabric.Image.filters.Gamma.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * A container class that knows how to apply a sequence of filters to an input image.\n   */\n  filters.Composed = createClass(filters.BaseFilter, /** @lends fabric.Image.filters.Composed.prototype */ {\n\n    type: 'Composed',\n\n    /**\n     * A non sparse array of filters to apply\n     */\n    subFilters: [],\n\n    /**\n     * Constructor\n     * @param {Object} [options] Options object\n     */\n    initialize: function(options) {\n      this.callSuper('initialize', options);\n      // create a new array instead mutating the prototype with push\n      this.subFilters = this.subFilters.slice(0);\n    },\n\n    /**\n     * Apply this container's filters to the input image provided.\n     *\n     * @param {Object} options\n     * @param {Number} options.passes The number of filters remaining to be applied.\n     */\n    applyTo: function(options) {\n      options.passes += this.subFilters.length - 1;\n      this.subFilters.forEach(function(filter) {\n        filter.applyTo(options);\n      });\n    },\n\n    /**\n     * Serialize this filter into JSON.\n     *\n     * @returns {Object} A JSON representation of this filter.\n     */\n    toObject: function() {\n      return fabric.util.object.extend(this.callSuper('toObject'), {\n        subFilters: this.subFilters.map(function(filter) { return filter.toObject(); }),\n      });\n    },\n\n    isNeutralState: function() {\n      return !this.subFilters.some(function(filter) { return !filter.isNeutralState(); });\n    }\n  });\n\n  /**\n   * Deserialize a JSON definition of a ComposedFilter into a concrete instance.\n   */\n  fabric.Image.filters.Composed.fromObject = function(object, callback) {\n    var filters = object.subFilters || [],\n        subFilters = filters.map(function(filter) {\n          return new fabric.Image.filters[filter.type](filter);\n        }),\n        instance = new fabric.Image.filters.Composed({ subFilters: subFilters });\n    callback && callback(instance);\n    return instance;\n  };\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric  = global.fabric || (global.fabric = { }),\n      filters = fabric.Image.filters,\n      createClass = fabric.util.createClass;\n\n  /**\n   * HueRotation filter class\n   * @class fabric.Image.filters.HueRotation\n   * @memberOf fabric.Image.filters\n   * @extends fabric.Image.filters.BaseFilter\n   * @see {@link fabric.Image.filters.HueRotation#initialize} for constructor definition\n   * @see {@link http://fabricjs.com/image-filters|ImageFilters demo}\n   * @example\n   * var filter = new fabric.Image.filters.HueRotation({\n   *   rotation: -0.5\n   * });\n   * object.filters.push(filter);\n   * object.applyFilters();\n   */\n  filters.HueRotation = createClass(filters.ColorMatrix, /** @lends fabric.Image.filters.HueRotation.prototype */ {\n\n    /**\n     * Filter type\n     * @param {String} type\n     * @default\n     */\n    type: 'HueRotation',\n\n    /**\n     * HueRotation value, from -1 to 1.\n     * the unit is radians\n     * @param {Number} myParameter\n     * @default\n     */\n    rotation: 0,\n\n    /**\n     * Describe the property that is the filter parameter\n     * @param {String} m\n     * @default\n     */\n    mainParameter: 'rotation',\n\n    calculateMatrix: function() {\n      var rad = this.rotation * Math.PI, cos = fabric.util.cos(rad), sin = fabric.util.sin(rad),\n          aThird = 1 / 3, aThirdSqtSin = Math.sqrt(aThird) * sin, OneMinusCos = 1 - cos;\n      this.matrix = [\n        1, 0, 0, 0, 0,\n        0, 1, 0, 0, 0,\n        0, 0, 1, 0, 0,\n        0, 0, 0, 1, 0\n      ];\n      this.matrix[0] = cos + OneMinusCos / 3;\n      this.matrix[1] = aThird * OneMinusCos - aThirdSqtSin;\n      this.matrix[2] = aThird * OneMinusCos + aThirdSqtSin;\n      this.matrix[5] = aThird * OneMinusCos + aThirdSqtSin;\n      this.matrix[6] = cos + aThird * OneMinusCos;\n      this.matrix[7] = aThird * OneMinusCos - aThirdSqtSin;\n      this.matrix[10] = aThird * OneMinusCos - aThirdSqtSin;\n      this.matrix[11] = aThird * OneMinusCos + aThirdSqtSin;\n      this.matrix[12] = cos + aThird * OneMinusCos;\n    },\n\n    /**\n     * HueRotation isNeutralState implementation\n     * Used only in image applyFilters to discard filters that will not have an effect\n     * on the image\n     * @param {Object} options\n     **/\n    isNeutralState: function(options) {\n      this.calculateMatrix();\n      return filters.BaseFilter.prototype.isNeutralState.call(this, options);\n    },\n\n    /**\n     * Apply this filter to the input image data provided.\n     *\n     * Determines whether to use WebGL or Canvas2D based on the options.webgl flag.\n     *\n     * @param {Object} options\n     * @param {Number} options.passes The number of filters remaining to be executed\n     * @param {Boolean} options.webgl Whether to use webgl to render the filter.\n     * @param {WebGLTexture} options.sourceTexture The texture setup as the source to be filtered.\n     * @param {WebGLTexture} options.targetTexture The texture where filtered output should be drawn.\n     * @param {WebGLRenderingContext} options.context The GL context used for rendering.\n     * @param {Object} options.programCache A map of compiled shader programs, keyed by filter type.\n     */\n    applyTo: function(options) {\n      this.calculateMatrix();\n      filters.BaseFilter.prototype.applyTo.call(this, options);\n    },\n\n  });\n\n  /**\n   * Returns filter instance from an object representation\n   * @static\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] to be invoked after filter creation\n   * @return {fabric.Image.filters.HueRotation} Instance of fabric.Image.filters.HueRotation\n   */\n  fabric.Image.filters.HueRotation.fromObject = fabric.Image.filters.BaseFilter.fromObject;\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = { }),\n      clone = fabric.util.object.clone;\n\n  if (fabric.Text) {\n    fabric.warn('fabric.Text is already defined');\n    return;\n  }\n\n  var additionalProps =\n    ('fontFamily fontWeight fontSize text underline overline linethrough' +\n    ' textAlign fontStyle lineHeight textBackgroundColor charSpacing styles' +\n    ' direction path pathStartOffset pathSide pathAlign').split(' ');\n\n  /**\n   * Text class\n   * @class fabric.Text\n   * @extends fabric.Object\n   * @return {fabric.Text} thisArg\n   * @tutorial {@link http://fabricjs.com/fabric-intro-part-2#text}\n   * @see {@link fabric.Text#initialize} for constructor definition\n   */\n  fabric.Text = fabric.util.createClass(fabric.Object, /** @lends fabric.Text.prototype */ {\n\n    /**\n     * Properties which when set cause object to change dimensions\n     * @type Array\n     * @private\n     */\n    _dimensionAffectingProps: [\n      'fontSize',\n      'fontWeight',\n      'fontFamily',\n      'fontStyle',\n      'lineHeight',\n      'text',\n      'charSpacing',\n      'textAlign',\n      'styles',\n      'path',\n      'pathStartOffset',\n      'pathSide',\n      'pathAlign'\n    ],\n\n    /**\n     * @private\n     */\n    _reNewline: /\\r?\\n/,\n\n    /**\n     * Use this regular expression to filter for whitespaces that is not a new line.\n     * Mostly used when text is 'justify' aligned.\n     * @private\n     */\n    _reSpacesAndTabs: /[ \\t\\r]/g,\n\n    /**\n     * Use this regular expression to filter for whitespace that is not a new line.\n     * Mostly used when text is 'justify' aligned.\n     * @private\n     */\n    _reSpaceAndTab: /[ \\t\\r]/,\n\n    /**\n     * Use this regular expression to filter consecutive groups of non spaces.\n     * Mostly used when text is 'justify' aligned.\n     * @private\n     */\n    _reWords: /\\S+/g,\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type:                 'text',\n\n    /**\n     * Font size (in pixels)\n     * @type Number\n     * @default\n     */\n    fontSize:             40,\n\n    /**\n     * Font weight (e.g. bold, normal, 400, 600, 800)\n     * @type {(Number|String)}\n     * @default\n     */\n    fontWeight:           'normal',\n\n    /**\n     * Font family\n     * @type String\n     * @default\n     */\n    fontFamily:           'Times New Roman',\n\n    /**\n     * Text decoration underline.\n     * @type Boolean\n     * @default\n     */\n    underline:       false,\n\n    /**\n     * Text decoration overline.\n     * @type Boolean\n     * @default\n     */\n    overline:       false,\n\n    /**\n     * Text decoration linethrough.\n     * @type Boolean\n     * @default\n     */\n    linethrough:       false,\n\n    /**\n     * Text alignment. Possible values: \"left\", \"center\", \"right\", \"justify\",\n     * \"justify-left\", \"justify-center\" or \"justify-right\".\n     * @type String\n     * @default\n     */\n    textAlign:            'left',\n\n    /**\n     * Font style . Possible values: \"\", \"normal\", \"italic\" or \"oblique\".\n     * @type String\n     * @default\n     */\n    fontStyle:            'normal',\n\n    /**\n     * Line height\n     * @type Number\n     * @default\n     */\n    lineHeight:           1.16,\n\n    /**\n     * Superscript schema object (minimum overlap)\n     * @type {Object}\n     * @default\n     */\n    superscript: {\n      size:      0.60, // fontSize factor\n      baseline: -0.35  // baseline-shift factor (upwards)\n    },\n\n    /**\n     * Subscript schema object (minimum overlap)\n     * @type {Object}\n     * @default\n     */\n    subscript: {\n      size:      0.60, // fontSize factor\n      baseline:  0.11  // baseline-shift factor (downwards)\n    },\n\n    /**\n     * Background color of text lines\n     * @type String\n     * @default\n     */\n    textBackgroundColor:  '',\n\n    /**\n     * List of properties to consider when checking if\n     * state of an object is changed ({@link fabric.Object#hasStateChanged})\n     * as well as for history (undo/redo) purposes\n     * @type Array\n     */\n    stateProperties: fabric.Object.prototype.stateProperties.concat(additionalProps),\n\n    /**\n     * List of properties to consider when checking if cache needs refresh\n     * @type Array\n     */\n    cacheProperties: fabric.Object.prototype.cacheProperties.concat(additionalProps),\n\n    /**\n     * When defined, an object is rendered via stroke and this property specifies its color.\n     * <b>Backwards incompatibility note:</b> This property was named \"strokeStyle\" until v1.1.6\n     * @type String\n     * @default\n     */\n    stroke:               null,\n\n    /**\n     * Shadow object representing shadow of this shape.\n     * <b>Backwards incompatibility note:</b> This property was named \"textShadow\" (String) until v1.2.11\n     * @type fabric.Shadow\n     * @default\n     */\n    shadow:               null,\n\n    /**\n     * fabric.Path that the text should follow.\n     * since 4.6.0 the path will be drawn automatically.\n     * if you want to make the path visible, give it a stroke and strokeWidth or fill value\n     * if you want it to be hidden, assign visible = false to the path.\n     * This feature is in BETA, and SVG import/export is not yet supported.\n     * @type fabric.Path\n     * @example\n     * var textPath = new fabric.Text('Text on a path', {\n     *     top: 150,\n     *     left: 150,\n     *     textAlign: 'center',\n     *     charSpacing: -50,\n     *     path: new fabric.Path('M 0 0 C 50 -100 150 -100 200 0', {\n     *         strokeWidth: 1,\n     *         visible: false\n     *     }),\n     *     pathSide: 'left',\n     *     pathStartOffset: 0\n     * });\n     * @default\n     */\n    path:               null,\n\n    /**\n     * Offset amount for text path starting position\n     * Only used when text has a path\n     * @type Number\n     * @default\n     */\n    pathStartOffset:               0,\n\n    /**\n     * Which side of the path the text should be drawn on.\n     * Only used when text has a path\n     * @type {String} 'left|right'\n     * @default\n     */\n    pathSide:               'left',\n\n    /**\n     * How text is aligned to the path. This property determines\n     * the perpendicular position of each character relative to the path.\n     * (one of \"baseline\", \"center\", \"ascender\", \"descender\")\n     * This feature is in BETA, and its behavior may change\n     * @type String\n     * @default\n     */\n    pathAlign:               'baseline',\n\n    /**\n     * @private\n     */\n    _fontSizeFraction: 0.222,\n\n    /**\n     * @private\n     */\n    offsets: {\n      underline: 0.10,\n      linethrough: -0.315,\n      overline: -0.88\n    },\n\n    /**\n     * Text Line proportion to font Size (in pixels)\n     * @type Number\n     * @default\n     */\n    _fontSizeMult:             1.13,\n\n    /**\n     * additional space between characters\n     * expressed in thousands of em unit\n     * @type Number\n     * @default\n     */\n    charSpacing:             0,\n\n    /**\n     * Object containing character styles - top-level properties -> line numbers,\n     * 2nd-level properties - character numbers\n     * @type Object\n     * @default\n     */\n    styles: null,\n\n    /**\n     * Reference to a context to measure text char or couple of chars\n     * the cacheContext of the canvas will be used or a freshly created one if the object is not on canvas\n     * once created it will be referenced on fabric._measuringContext to avoid creating a canvas for every\n     * text object created.\n     * @type {CanvasRenderingContext2D}\n     * @default\n     */\n    _measuringContext: null,\n\n    /**\n     * Baseline shift, styles only, keep at 0 for the main text object\n     * @type {Number}\n     * @default\n     */\n    deltaY: 0,\n\n    /**\n     * WARNING: EXPERIMENTAL. NOT SUPPORTED YET\n     * determine the direction of the text.\n     * This has to be set manually together with textAlign and originX for proper\n     * experience.\n     * some interesting link for the future\n     * https://www.w3.org/International/questions/qa-bidi-unicode-controls\n     * @since 4.5.0\n     * @type {String} 'ltr|rtl'\n     * @default\n     */\n    direction: 'ltr',\n\n    /**\n     * Array of properties that define a style unit (of 'styles').\n     * @type {Array}\n     * @default\n     */\n    _styleProperties: [\n      'stroke',\n      'strokeWidth',\n      'fill',\n      'fontFamily',\n      'fontSize',\n      'fontWeight',\n      'fontStyle',\n      'underline',\n      'overline',\n      'linethrough',\n      'deltaY',\n      'textBackgroundColor',\n    ],\n\n    /**\n     * contains characters bounding boxes\n     */\n    __charBounds: [],\n\n    /**\n     * use this size when measuring text. To avoid IE11 rounding errors\n     * @type {Number}\n     * @default\n     * @readonly\n     * @private\n     */\n    CACHE_FONT_SIZE: 400,\n\n    /**\n     * contains the min text width to avoid getting 0\n     * @type {Number}\n     * @default\n     */\n    MIN_TEXT_WIDTH: 2,\n\n    /**\n     * Constructor\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.Text} thisArg\n     */\n    initialize: function(text, options) {\n      this.styles = options ? (options.styles || { }) : { };\n      this.text = text;\n      this.__skipDimension = true;\n      this.callSuper('initialize', options);\n      if (this.path) {\n        this.setPathInfo();\n      }\n      this.__skipDimension = false;\n      this.initDimensions();\n      this.setCoords();\n      this.setupState({ propertySet: '_dimensionAffectingProps' });\n    },\n\n    /**\n     * If text has a path, it will add the extra information needed\n     * for path and text calculations\n     * @return {fabric.Text} thisArg\n     */\n    setPathInfo: function() {\n      var path = this.path;\n      if (path) {\n        path.segmentsInfo = fabric.util.getPathSegmentsInfo(path.path);\n      }\n    },\n\n    /**\n     * Return a context for measurement of text string.\n     * if created it gets stored for reuse\n     * this is for internal use, please do not use it\n     * @private\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.Text} thisArg\n     */\n    getMeasuringContext: function() {\n      // if we did not return we have to measure something.\n      if (!fabric._measuringContext) {\n        fabric._measuringContext = this.canvas && this.canvas.contextCache ||\n          fabric.util.createCanvasElement().getContext('2d');\n      }\n      return fabric._measuringContext;\n    },\n\n    /**\n     * @private\n     * Divides text into lines of text and lines of graphemes.\n     */\n    _splitText: function() {\n      var newLines = this._splitTextIntoLines(this.text);\n      this.textLines = newLines.lines;\n      this._textLines = newLines.graphemeLines;\n      this._unwrappedTextLines = newLines._unwrappedLines;\n      this._text = newLines.graphemeText;\n      return newLines;\n    },\n\n    /**\n     * Initialize or update text dimensions.\n     * Updates this.width and this.height with the proper values.\n     * Does not return dimensions.\n     */\n    initDimensions: function() {\n      if (this.__skipDimension) {\n        return;\n      }\n      this._splitText();\n      this._clearCache();\n      if (this.path) {\n        this.width = this.path.width;\n        this.height = this.path.height;\n      }\n      else {\n        this.width = this.calcTextWidth() || this.cursorWidth || this.MIN_TEXT_WIDTH;\n        this.height = this.calcTextHeight();\n      }\n      if (this.textAlign.indexOf('justify') !== -1) {\n        // once text is measured we need to make space fatter to make justified text.\n        this.enlargeSpaces();\n      }\n      this.saveState({ propertySet: '_dimensionAffectingProps' });\n    },\n\n    /**\n     * Enlarge space boxes and shift the others\n     */\n    enlargeSpaces: function() {\n      var diffSpace, currentLineWidth, numberOfSpaces, accumulatedSpace, line, charBound, spaces;\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        if (this.textAlign !== 'justify' && (i === len - 1 || this.isEndOfWrapping(i))) {\n          continue;\n        }\n        accumulatedSpace = 0;\n        line = this._textLines[i];\n        currentLineWidth = this.getLineWidth(i);\n        if (currentLineWidth < this.width && (spaces = this.textLines[i].match(this._reSpacesAndTabs))) {\n          numberOfSpaces = spaces.length;\n          diffSpace = (this.width - currentLineWidth) / numberOfSpaces;\n          for (var j = 0, jlen = line.length; j <= jlen; j++) {\n            charBound = this.__charBounds[i][j];\n            if (this._reSpaceAndTab.test(line[j])) {\n              charBound.width += diffSpace;\n              charBound.kernedWidth += diffSpace;\n              charBound.left += accumulatedSpace;\n              accumulatedSpace += diffSpace;\n            }\n            else {\n              charBound.left += accumulatedSpace;\n            }\n          }\n        }\n      }\n    },\n\n    /**\n     * Detect if the text line is ended with an hard break\n     * text and itext do not have wrapping, return false\n     * @return {Boolean}\n     */\n    isEndOfWrapping: function(lineIndex) {\n      return lineIndex === this._textLines.length - 1;\n    },\n\n    /**\n     * Detect if a line has a linebreak and so we need to account for it when moving\n     * and counting style.\n     * It return always for text and Itext.\n     * @return Number\n     */\n    missingNewlineOffset: function() {\n      return 1;\n    },\n\n    /**\n     * Returns string representation of an instance\n     * @return {String} String representation of text object\n     */\n    toString: function() {\n      return '#<fabric.Text (' + this.complexity() +\n        '): { \"text\": \"' + this.text + '\", \"fontFamily\": \"' + this.fontFamily + '\" }>';\n    },\n\n    /**\n     * Return the dimension and the zoom level needed to create a cache canvas\n     * big enough to host the object to be cached.\n     * @private\n     * @param {Object} dim.x width of object to be cached\n     * @param {Object} dim.y height of object to be cached\n     * @return {Object}.width width of canvas\n     * @return {Object}.height height of canvas\n     * @return {Object}.zoomX zoomX zoom value to unscale the canvas before drawing cache\n     * @return {Object}.zoomY zoomY zoom value to unscale the canvas before drawing cache\n     */\n    _getCacheCanvasDimensions: function() {\n      var dims = this.callSuper('_getCacheCanvasDimensions');\n      var fontSize = this.fontSize;\n      dims.width += fontSize * dims.zoomX;\n      dims.height += fontSize * dims.zoomY;\n      return dims;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      var path = this.path;\n      path && !path.isNotVisible() && path._render(ctx);\n      this._setTextStyles(ctx);\n      this._renderTextLinesBackground(ctx);\n      this._renderTextDecoration(ctx, 'underline');\n      this._renderText(ctx);\n      this._renderTextDecoration(ctx, 'overline');\n      this._renderTextDecoration(ctx, 'linethrough');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderText: function(ctx) {\n      if (this.paintFirst === 'stroke') {\n        this._renderTextStroke(ctx);\n        this._renderTextFill(ctx);\n      }\n      else {\n        this._renderTextFill(ctx);\n        this._renderTextStroke(ctx);\n      }\n    },\n\n    /**\n     * Set the font parameter of the context with the object properties or with charStyle\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Object} [charStyle] object with font style properties\n     * @param {String} [charStyle.fontFamily] Font Family\n     * @param {Number} [charStyle.fontSize] Font size in pixels. ( without px suffix )\n     * @param {String} [charStyle.fontWeight] Font weight\n     * @param {String} [charStyle.fontStyle] Font style (italic|normal)\n     */\n    _setTextStyles: function(ctx, charStyle, forMeasuring) {\n      ctx.textBaseline = 'alphabetical';\n      if (this.path) {\n        switch (this.pathAlign) {\n          case 'center':\n            ctx.textBaseline = 'middle';\n            break;\n          case 'ascender':\n            ctx.textBaseline = 'top';\n            break;\n          case 'descender':\n            ctx.textBaseline = 'bottom';\n            break;\n        }\n      }\n      ctx.font = this._getFontDeclaration(charStyle, forMeasuring);\n    },\n\n    /**\n     * calculate and return the text Width measuring each line.\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @return {Number} Maximum width of fabric.Text object\n     */\n    calcTextWidth: function() {\n      var maxWidth = this.getLineWidth(0);\n\n      for (var i = 1, len = this._textLines.length; i < len; i++) {\n        var currentLineWidth = this.getLineWidth(i);\n        if (currentLineWidth > maxWidth) {\n          maxWidth = currentLineWidth;\n        }\n      }\n      return maxWidth;\n    },\n\n    /**\n     * @private\n     * @param {String} method Method name (\"fillText\" or \"strokeText\")\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} line Text to render\n     * @param {Number} left Left position of text\n     * @param {Number} top Top position of text\n     * @param {Number} lineIndex Index of a line in a text\n     */\n    _renderTextLine: function(method, ctx, line, left, top, lineIndex) {\n      this._renderChars(method, ctx, line, left, top, lineIndex);\n    },\n\n    /**\n     * Renders the text background for lines, taking care of style\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextLinesBackground: function(ctx) {\n      if (!this.textBackgroundColor && !this.styleHas('textBackgroundColor')) {\n        return;\n      }\n      var heightOfLine,\n          lineLeftOffset, originalFill = ctx.fillStyle,\n          line, lastColor,\n          leftOffset = this._getLeftOffset(),\n          lineTopOffset = this._getTopOffset(),\n          boxStart = 0, boxWidth = 0, charBox, currentColor, path = this.path,\n          drawStart;\n\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        heightOfLine = this.getHeightOfLine(i);\n        if (!this.textBackgroundColor && !this.styleHas('textBackgroundColor', i)) {\n          lineTopOffset += heightOfLine;\n          continue;\n        }\n        line = this._textLines[i];\n        lineLeftOffset = this._getLineLeftOffset(i);\n        boxWidth = 0;\n        boxStart = 0;\n        lastColor = this.getValueOfPropertyAt(i, 0, 'textBackgroundColor');\n        for (var j = 0, jlen = line.length; j < jlen; j++) {\n          charBox = this.__charBounds[i][j];\n          currentColor = this.getValueOfPropertyAt(i, j, 'textBackgroundColor');\n          if (path) {\n            ctx.save();\n            ctx.translate(charBox.renderLeft, charBox.renderTop);\n            ctx.rotate(charBox.angle);\n            ctx.fillStyle = currentColor;\n            currentColor && ctx.fillRect(\n              -charBox.width / 2,\n              -heightOfLine / this.lineHeight * (1 - this._fontSizeFraction),\n              charBox.width,\n              heightOfLine / this.lineHeight\n            );\n            ctx.restore();\n          }\n          else if (currentColor !== lastColor) {\n            drawStart = leftOffset + lineLeftOffset + boxStart;\n            if (this.direction === 'rtl') {\n              drawStart = this.width - drawStart - boxWidth;\n            }\n            ctx.fillStyle = lastColor;\n            lastColor && ctx.fillRect(\n              drawStart,\n              lineTopOffset,\n              boxWidth,\n              heightOfLine / this.lineHeight\n            );\n            boxStart = charBox.left;\n            boxWidth = charBox.width;\n            lastColor = currentColor;\n          }\n          else {\n            boxWidth += charBox.kernedWidth;\n          }\n        }\n        if (currentColor && !path) {\n          drawStart = leftOffset + lineLeftOffset + boxStart;\n          if (this.direction === 'rtl') {\n            drawStart = this.width - drawStart - boxWidth;\n          }\n          ctx.fillStyle = currentColor;\n          ctx.fillRect(\n            drawStart,\n            lineTopOffset,\n            boxWidth,\n            heightOfLine / this.lineHeight\n          );\n        }\n        lineTopOffset += heightOfLine;\n      }\n      ctx.fillStyle = originalFill;\n      // if there is text background color no\n      // other shadows should be casted\n      this._removeShadow(ctx);\n    },\n\n    /**\n     * @private\n     * @param {Object} decl style declaration for cache\n     * @param {String} decl.fontFamily fontFamily\n     * @param {String} decl.fontStyle fontStyle\n     * @param {String} decl.fontWeight fontWeight\n     * @return {Object} reference to cache\n     */\n    getFontCache: function(decl) {\n      var fontFamily = decl.fontFamily.toLowerCase();\n      if (!fabric.charWidthsCache[fontFamily]) {\n        fabric.charWidthsCache[fontFamily] = { };\n      }\n      var cache = fabric.charWidthsCache[fontFamily],\n          cacheProp = decl.fontStyle.toLowerCase() + '_' + (decl.fontWeight + '').toLowerCase();\n      if (!cache[cacheProp]) {\n        cache[cacheProp] = { };\n      }\n      return cache[cacheProp];\n    },\n\n    /**\n     * measure and return the width of a single character.\n     * possibly overridden to accommodate different measure logic or\n     * to hook some external lib for character measurement\n     * @private\n     * @param {String} _char, char to be measured\n     * @param {Object} charStyle style of char to be measured\n     * @param {String} [previousChar] previous char\n     * @param {Object} [prevCharStyle] style of previous char\n     */\n    _measureChar: function(_char, charStyle, previousChar, prevCharStyle) {\n      // first i try to return from cache\n      var fontCache = this.getFontCache(charStyle), fontDeclaration = this._getFontDeclaration(charStyle),\n          previousFontDeclaration = this._getFontDeclaration(prevCharStyle), couple = previousChar + _char,\n          stylesAreEqual = fontDeclaration === previousFontDeclaration, width, coupleWidth, previousWidth,\n          fontMultiplier = charStyle.fontSize / this.CACHE_FONT_SIZE, kernedWidth;\n\n      if (previousChar && fontCache[previousChar] !== undefined) {\n        previousWidth = fontCache[previousChar];\n      }\n      if (fontCache[_char] !== undefined) {\n        kernedWidth = width = fontCache[_char];\n      }\n      if (stylesAreEqual && fontCache[couple] !== undefined) {\n        coupleWidth = fontCache[couple];\n        kernedWidth = coupleWidth - previousWidth;\n      }\n      if (width === undefined || previousWidth === undefined || coupleWidth === undefined) {\n        var ctx = this.getMeasuringContext();\n        // send a TRUE to specify measuring font size CACHE_FONT_SIZE\n        this._setTextStyles(ctx, charStyle, true);\n      }\n      if (width === undefined) {\n        kernedWidth = width = ctx.measureText(_char).width;\n        fontCache[_char] = width;\n      }\n      if (previousWidth === undefined && stylesAreEqual && previousChar) {\n        previousWidth = ctx.measureText(previousChar).width;\n        fontCache[previousChar] = previousWidth;\n      }\n      if (stylesAreEqual && coupleWidth === undefined) {\n        // we can measure the kerning couple and subtract the width of the previous character\n        coupleWidth = ctx.measureText(couple).width;\n        fontCache[couple] = coupleWidth;\n        kernedWidth = coupleWidth - previousWidth;\n      }\n      return { width: width * fontMultiplier, kernedWidth: kernedWidth * fontMultiplier };\n    },\n\n    /**\n     * Computes height of character at given position\n     * @param {Number} line the line index number\n     * @param {Number} _char the character index number\n     * @return {Number} fontSize of the character\n     */\n    getHeightOfChar: function(line, _char) {\n      return this.getValueOfPropertyAt(line, _char, 'fontSize');\n    },\n\n    /**\n     * measure a text line measuring all characters.\n     * @param {Number} lineIndex line number\n     * @return {Number} Line width\n     */\n    measureLine: function(lineIndex) {\n      var lineInfo = this._measureLine(lineIndex);\n      if (this.charSpacing !== 0) {\n        lineInfo.width -= this._getWidthOfCharSpacing();\n      }\n      if (lineInfo.width < 0) {\n        lineInfo.width = 0;\n      }\n      return lineInfo;\n    },\n\n    /**\n     * measure every grapheme of a line, populating __charBounds\n     * @param {Number} lineIndex\n     * @return {Object} object.width total width of characters\n     * @return {Object} object.widthOfSpaces length of chars that match this._reSpacesAndTabs\n     */\n    _measureLine: function(lineIndex) {\n      var width = 0, i, grapheme, line = this._textLines[lineIndex], prevGrapheme,\n          graphemeInfo, numOfSpaces = 0, lineBounds = new Array(line.length),\n          positionInPath = 0, startingPoint, totalPathLength, path = this.path,\n          reverse = this.pathSide === 'right';\n\n      this.__charBounds[lineIndex] = lineBounds;\n      for (i = 0; i < line.length; i++) {\n        grapheme = line[i];\n        graphemeInfo = this._getGraphemeBox(grapheme, lineIndex, i, prevGrapheme);\n        lineBounds[i] = graphemeInfo;\n        width += graphemeInfo.kernedWidth;\n        prevGrapheme = grapheme;\n      }\n      // this latest bound box represent the last character of the line\n      // to simplify cursor handling in interactive mode.\n      lineBounds[i] = {\n        left: graphemeInfo ? graphemeInfo.left + graphemeInfo.width : 0,\n        width: 0,\n        kernedWidth: 0,\n        height: this.fontSize\n      };\n      if (path) {\n        totalPathLength = path.segmentsInfo[path.segmentsInfo.length - 1].length;\n        startingPoint = fabric.util.getPointOnPath(path.path, 0, path.segmentsInfo);\n        startingPoint.x += path.pathOffset.x;\n        startingPoint.y += path.pathOffset.y;\n        switch (this.textAlign) {\n          case 'left':\n            positionInPath = reverse ? (totalPathLength - width) : 0;\n            break;\n          case 'center':\n            positionInPath = (totalPathLength - width) / 2;\n            break;\n          case 'right':\n            positionInPath = reverse ? 0 : (totalPathLength - width);\n            break;\n          //todo - add support for justify\n        }\n        positionInPath += this.pathStartOffset * (reverse ? -1 : 1);\n        for (i = reverse ? line.length - 1 : 0;\n          reverse ? i >= 0 : i < line.length;\n          reverse ? i-- : i++) {\n          graphemeInfo = lineBounds[i];\n          if (positionInPath > totalPathLength) {\n            positionInPath %= totalPathLength;\n          }\n          else if (positionInPath < 0) {\n            positionInPath += totalPathLength;\n          }\n          // it would probably much faster to send all the grapheme position for a line\n          // and calculate path position/angle at once.\n          this._setGraphemeOnPath(positionInPath, graphemeInfo, startingPoint);\n          positionInPath += graphemeInfo.kernedWidth;\n        }\n      }\n      return { width: width, numOfSpaces: numOfSpaces };\n    },\n\n    /**\n     * Calculate the angle  and the left,top position of the char that follow a path.\n     * It appends it to graphemeInfo to be reused later at rendering\n     * @private\n     * @param {Number} positionInPath to be measured\n     * @param {Object} graphemeInfo current grapheme box information\n     * @param {Object} startingPoint position of the point\n     */\n    _setGraphemeOnPath: function(positionInPath, graphemeInfo, startingPoint) {\n      var centerPosition = positionInPath + graphemeInfo.kernedWidth / 2,\n          path = this.path;\n\n      // we are at currentPositionOnPath. we want to know what point on the path is.\n      var info = fabric.util.getPointOnPath(path.path, centerPosition, path.segmentsInfo);\n      graphemeInfo.renderLeft = info.x - startingPoint.x;\n      graphemeInfo.renderTop = info.y - startingPoint.y;\n      graphemeInfo.angle = info.angle + (this.pathSide ===  'right' ? Math.PI : 0);\n    },\n\n    /**\n     * Measure and return the info of a single grapheme.\n     * needs the the info of previous graphemes already filled\n     * @private\n     * @param {String} grapheme to be measured\n     * @param {Number} lineIndex index of the line where the char is\n     * @param {Number} charIndex position in the line\n     * @param {String} [prevGrapheme] character preceding the one to be measured\n     */\n    _getGraphemeBox: function(grapheme, lineIndex, charIndex, prevGrapheme, skipLeft) {\n      var style = this.getCompleteStyleDeclaration(lineIndex, charIndex),\n          prevStyle = prevGrapheme ? this.getCompleteStyleDeclaration(lineIndex, charIndex - 1) : { },\n          info = this._measureChar(grapheme, style, prevGrapheme, prevStyle),\n          kernedWidth = info.kernedWidth,\n          width = info.width, charSpacing;\n\n      if (this.charSpacing !== 0) {\n        charSpacing = this._getWidthOfCharSpacing();\n        width += charSpacing;\n        kernedWidth += charSpacing;\n      }\n\n      var box = {\n        width: width,\n        left: 0,\n        height: style.fontSize,\n        kernedWidth: kernedWidth,\n        deltaY: style.deltaY,\n      };\n      if (charIndex > 0 && !skipLeft) {\n        var previousBox = this.__charBounds[lineIndex][charIndex - 1];\n        box.left = previousBox.left + previousBox.width + info.kernedWidth - info.width;\n      }\n      return box;\n    },\n\n    /**\n     * Calculate height of line at 'lineIndex'\n     * @param {Number} lineIndex index of line to calculate\n     * @return {Number}\n     */\n    getHeightOfLine: function(lineIndex) {\n      if (this.__lineHeights[lineIndex]) {\n        return this.__lineHeights[lineIndex];\n      }\n\n      var line = this._textLines[lineIndex],\n          // char 0 is measured before the line cycle because it nneds to char\n          // emptylines\n          maxHeight = this.getHeightOfChar(lineIndex, 0);\n      for (var i = 1, len = line.length; i < len; i++) {\n        maxHeight = Math.max(this.getHeightOfChar(lineIndex, i), maxHeight);\n      }\n\n      return this.__lineHeights[lineIndex] = maxHeight * this.lineHeight * this._fontSizeMult;\n    },\n\n    /**\n     * Calculate text box height\n     */\n    calcTextHeight: function() {\n      var lineHeight, height = 0;\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        lineHeight = this.getHeightOfLine(i);\n        height += (i === len - 1 ? lineHeight / this.lineHeight : lineHeight);\n      }\n      return height;\n    },\n\n    /**\n     * @private\n     * @return {Number} Left offset\n     */\n    _getLeftOffset: function() {\n      return this.direction === 'ltr' ? -this.width / 2 : this.width / 2;\n    },\n\n    /**\n     * @private\n     * @return {Number} Top offset\n     */\n    _getTopOffset: function() {\n      return -this.height / 2;\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {String} method Method name (\"fillText\" or \"strokeText\")\n     */\n    _renderTextCommon: function(ctx, method) {\n      ctx.save();\n      var lineHeights = 0, left = this._getLeftOffset(), top = this._getTopOffset();\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        var heightOfLine = this.getHeightOfLine(i),\n            maxHeight = heightOfLine / this.lineHeight,\n            leftOffset = this._getLineLeftOffset(i);\n        this._renderTextLine(\n          method,\n          ctx,\n          this._textLines[i],\n          left + leftOffset,\n          top + lineHeights + maxHeight,\n          i\n        );\n        lineHeights += heightOfLine;\n      }\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextFill: function(ctx) {\n      if (!this.fill && !this.styleHas('fill')) {\n        return;\n      }\n\n      this._renderTextCommon(ctx, 'fillText');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextStroke: function(ctx) {\n      if ((!this.stroke || this.strokeWidth === 0) && this.isEmptyStyles()) {\n        return;\n      }\n\n      if (this.shadow && !this.shadow.affectStroke) {\n        this._removeShadow(ctx);\n      }\n\n      ctx.save();\n      this._setLineDash(ctx, this.strokeDashArray);\n      ctx.beginPath();\n      this._renderTextCommon(ctx, 'strokeText');\n      ctx.closePath();\n      ctx.restore();\n    },\n\n    /**\n     * @private\n     * @param {String} method fillText or strokeText.\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Array} line Content of the line, splitted in an array by grapheme\n     * @param {Number} left\n     * @param {Number} top\n     * @param {Number} lineIndex\n     */\n    _renderChars: function(method, ctx, line, left, top, lineIndex) {\n      // set proper line offset\n      var lineHeight = this.getHeightOfLine(lineIndex),\n          isJustify = this.textAlign.indexOf('justify') !== -1,\n          actualStyle,\n          nextStyle,\n          charsToRender = '',\n          charBox,\n          boxWidth = 0,\n          timeToRender,\n          path = this.path,\n          shortCut = !isJustify && this.charSpacing === 0 && this.isEmptyStyles(lineIndex) && !path,\n          isLtr = this.direction === 'ltr', sign = this.direction === 'ltr' ? 1 : -1,\n          drawingLeft, currentDirection = ctx.canvas.getAttribute('dir');\n      ctx.save();\n      if (currentDirection !== this.direction) {\n        ctx.canvas.setAttribute('dir', isLtr ? 'ltr' : 'rtl');\n        ctx.direction = isLtr ? 'ltr' : 'rtl';\n        ctx.textAlign = isLtr ? 'left' : 'right';\n      }\n      top -= lineHeight * this._fontSizeFraction / this.lineHeight;\n      if (shortCut) {\n        // render all the line in one pass without checking\n        // drawingLeft = isLtr ? left : left - this.getLineWidth(lineIndex);\n        this._renderChar(method, ctx, lineIndex, 0, line.join(''), left, top, lineHeight);\n        ctx.restore();\n        return;\n      }\n      for (var i = 0, len = line.length - 1; i <= len; i++) {\n        timeToRender = i === len || this.charSpacing || path;\n        charsToRender += line[i];\n        charBox = this.__charBounds[lineIndex][i];\n        if (boxWidth === 0) {\n          left += sign * (charBox.kernedWidth - charBox.width);\n          boxWidth += charBox.width;\n        }\n        else {\n          boxWidth += charBox.kernedWidth;\n        }\n        if (isJustify && !timeToRender) {\n          if (this._reSpaceAndTab.test(line[i])) {\n            timeToRender = true;\n          }\n        }\n        if (!timeToRender) {\n          // if we have charSpacing, we render char by char\n          actualStyle = actualStyle || this.getCompleteStyleDeclaration(lineIndex, i);\n          nextStyle = this.getCompleteStyleDeclaration(lineIndex, i + 1);\n          timeToRender = fabric.util.hasStyleChanged(actualStyle, nextStyle, false);\n        }\n        if (timeToRender) {\n          if (path) {\n            ctx.save();\n            ctx.translate(charBox.renderLeft, charBox.renderTop);\n            ctx.rotate(charBox.angle);\n            this._renderChar(method, ctx, lineIndex, i, charsToRender, -boxWidth / 2, 0, lineHeight);\n            ctx.restore();\n          }\n          else {\n            drawingLeft = left;\n            this._renderChar(method, ctx, lineIndex, i, charsToRender, drawingLeft, top, lineHeight);\n          }\n          charsToRender = '';\n          actualStyle = nextStyle;\n          left += sign * boxWidth;\n          boxWidth = 0;\n        }\n      }\n      ctx.restore();\n    },\n\n    /**\n     * This function try to patch the missing gradientTransform on canvas gradients.\n     * transforming a context to transform the gradient, is going to transform the stroke too.\n     * we want to transform the gradient but not the stroke operation, so we create\n     * a transformed gradient on a pattern and then we use the pattern instead of the gradient.\n     * this method has drawbacks: is slow, is in low resolution, needs a patch for when the size\n     * is limited.\n     * @private\n     * @param {fabric.Gradient} filler a fabric gradient instance\n     * @return {CanvasPattern} a pattern to use as fill/stroke style\n     */\n    _applyPatternGradientTransformText: function(filler) {\n      var pCanvas = fabric.util.createCanvasElement(), pCtx,\n          // TODO: verify compatibility with strokeUniform\n          width = this.width + this.strokeWidth, height = this.height + this.strokeWidth;\n      pCanvas.width = width;\n      pCanvas.height = height;\n      pCtx = pCanvas.getContext('2d');\n      pCtx.beginPath(); pCtx.moveTo(0, 0); pCtx.lineTo(width, 0); pCtx.lineTo(width, height);\n      pCtx.lineTo(0, height); pCtx.closePath();\n      pCtx.translate(width / 2, height / 2);\n      pCtx.fillStyle = filler.toLive(pCtx);\n      this._applyPatternGradientTransform(pCtx, filler);\n      pCtx.fill();\n      return pCtx.createPattern(pCanvas, 'no-repeat');\n    },\n\n    handleFiller: function(ctx, property, filler) {\n      var offsetX, offsetY;\n      if (filler.toLive) {\n        if (filler.gradientUnits === 'percentage' || filler.gradientTransform || filler.patternTransform) {\n          // need to transform gradient in a pattern.\n          // this is a slow process. If you are hitting this codepath, and the object\n          // is not using caching, you should consider switching it on.\n          // we need a canvas as big as the current object caching canvas.\n          offsetX = -this.width / 2;\n          offsetY = -this.height / 2;\n          ctx.translate(offsetX, offsetY);\n          ctx[property] = this._applyPatternGradientTransformText(filler);\n          return { offsetX: offsetX, offsetY: offsetY };\n        }\n        else {\n          // is a simple gradient or pattern\n          ctx[property] = filler.toLive(ctx, this);\n          return this._applyPatternGradientTransform(ctx, filler);\n        }\n      }\n      else {\n        // is a color\n        ctx[property] = filler;\n      }\n      return { offsetX: 0, offsetY: 0 };\n    },\n\n    _setStrokeStyles: function(ctx, decl) {\n      ctx.lineWidth = decl.strokeWidth;\n      ctx.lineCap = this.strokeLineCap;\n      ctx.lineDashOffset = this.strokeDashOffset;\n      ctx.lineJoin = this.strokeLineJoin;\n      ctx.miterLimit = this.strokeMiterLimit;\n      return this.handleFiller(ctx, 'strokeStyle', decl.stroke);\n    },\n\n    _setFillStyles: function(ctx, decl) {\n      return this.handleFiller(ctx, 'fillStyle', decl.fill);\n    },\n\n    /**\n     * @private\n     * @param {String} method\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {String} _char\n     * @param {Number} left Left coordinate\n     * @param {Number} top Top coordinate\n     * @param {Number} lineHeight Height of the line\n     */\n    _renderChar: function(method, ctx, lineIndex, charIndex, _char, left, top) {\n      var decl = this._getStyleDeclaration(lineIndex, charIndex),\n          fullDecl = this.getCompleteStyleDeclaration(lineIndex, charIndex),\n          shouldFill = method === 'fillText' && fullDecl.fill,\n          shouldStroke = method === 'strokeText' && fullDecl.stroke && fullDecl.strokeWidth,\n          fillOffsets, strokeOffsets;\n\n      if (!shouldStroke && !shouldFill) {\n        return;\n      }\n      ctx.save();\n\n      shouldFill && (fillOffsets = this._setFillStyles(ctx, fullDecl));\n      shouldStroke && (strokeOffsets = this._setStrokeStyles(ctx, fullDecl));\n\n      ctx.font = this._getFontDeclaration(fullDecl);\n\n\n      if (decl && decl.textBackgroundColor) {\n        this._removeShadow(ctx);\n      }\n      if (decl && decl.deltaY) {\n        top += decl.deltaY;\n      }\n      shouldFill && ctx.fillText(_char, left - fillOffsets.offsetX, top - fillOffsets.offsetY);\n      shouldStroke && ctx.strokeText(_char, left - strokeOffsets.offsetX, top - strokeOffsets.offsetY);\n      ctx.restore();\n    },\n\n    /**\n     * Turns the character into a 'superior figure' (i.e. 'superscript')\n     * @param {Number} start selection start\n     * @param {Number} end selection end\n     * @returns {fabric.Text} thisArg\n     * @chainable\n     */\n    setSuperscript: function(start, end) {\n      return this._setScript(start, end, this.superscript);\n    },\n\n    /**\n     * Turns the character into an 'inferior figure' (i.e. 'subscript')\n     * @param {Number} start selection start\n     * @param {Number} end selection end\n     * @returns {fabric.Text} thisArg\n     * @chainable\n     */\n    setSubscript: function(start, end) {\n      return this._setScript(start, end, this.subscript);\n    },\n\n    /**\n     * Applies 'schema' at given position\n     * @private\n     * @param {Number} start selection start\n     * @param {Number} end selection end\n     * @param {Number} schema\n     * @returns {fabric.Text} thisArg\n     * @chainable\n     */\n    _setScript: function(start, end, schema) {\n      var loc = this.get2DCursorLocation(start, true),\n          fontSize = this.getValueOfPropertyAt(loc.lineIndex, loc.charIndex, 'fontSize'),\n          dy = this.getValueOfPropertyAt(loc.lineIndex, loc.charIndex, 'deltaY'),\n          style = { fontSize: fontSize * schema.size, deltaY: dy + fontSize * schema.baseline };\n      this.setSelectionStyles(style, start, end);\n      return this;\n    },\n\n    /**\n     * @private\n     * @param {Number} lineIndex index text line\n     * @return {Number} Line left offset\n     */\n    _getLineLeftOffset: function(lineIndex) {\n      var lineWidth = this.getLineWidth(lineIndex),\n          lineDiff = this.width - lineWidth, textAlign = this.textAlign, direction = this.direction,\n          isEndOfWrapping, leftOffset = 0, isEndOfWrapping = this.isEndOfWrapping(lineIndex);\n      if (textAlign === 'justify'\n        || (textAlign === 'justify-center' && !isEndOfWrapping)\n        || (textAlign === 'justify-right' && !isEndOfWrapping)\n        || (textAlign === 'justify-left' && !isEndOfWrapping)\n      ) {\n        return 0;\n      }\n      if (textAlign === 'center') {\n        leftOffset = lineDiff / 2;\n      }\n      if (textAlign === 'right') {\n        leftOffset = lineDiff;\n      }\n      if (textAlign === 'justify-center') {\n        leftOffset = lineDiff / 2;\n      }\n      if (textAlign === 'justify-right') {\n        leftOffset = lineDiff;\n      }\n      if (direction === 'rtl') {\n        leftOffset -= lineDiff;\n      }\n      return leftOffset;\n    },\n\n    /**\n     * @private\n     */\n    _clearCache: function() {\n      this.__lineWidths = [];\n      this.__lineHeights = [];\n      this.__charBounds = [];\n    },\n\n    /**\n     * @private\n     */\n    _shouldClearDimensionCache: function() {\n      var shouldClear = this._forceClearCache;\n      shouldClear || (shouldClear = this.hasStateChanged('_dimensionAffectingProps'));\n      if (shouldClear) {\n        this.dirty = true;\n        this._forceClearCache = false;\n      }\n      return shouldClear;\n    },\n\n    /**\n     * Measure a single line given its index. Used to calculate the initial\n     * text bounding box. The values are calculated and stored in __lineWidths cache.\n     * @private\n     * @param {Number} lineIndex line number\n     * @return {Number} Line width\n     */\n    getLineWidth: function(lineIndex) {\n      if (this.__lineWidths[lineIndex] !== undefined) {\n        return this.__lineWidths[lineIndex];\n      }\n\n      var lineInfo = this.measureLine(lineIndex);\n      var width = lineInfo.width;\n      this.__lineWidths[lineIndex] = width;\n      return width;\n    },\n\n    _getWidthOfCharSpacing: function() {\n      if (this.charSpacing !== 0) {\n        return this.fontSize * this.charSpacing / 1000;\n      }\n      return 0;\n    },\n\n    /**\n     * Retrieves the value of property at given character position\n     * @param {Number} lineIndex the line number\n     * @param {Number} charIndex the character number\n     * @param {String} property the property name\n     * @returns the value of 'property'\n     */\n    getValueOfPropertyAt: function(lineIndex, charIndex, property) {\n      var charStyle = this._getStyleDeclaration(lineIndex, charIndex);\n      if (charStyle && typeof charStyle[property] !== 'undefined') {\n        return charStyle[property];\n      }\n      return this[property];\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _renderTextDecoration: function(ctx, type) {\n      if (!this[type] && !this.styleHas(type)) {\n        return;\n      }\n      var heightOfLine, size, _size,\n          lineLeftOffset, dy, _dy,\n          line, lastDecoration,\n          leftOffset = this._getLeftOffset(),\n          topOffset = this._getTopOffset(), top,\n          boxStart, boxWidth, charBox, currentDecoration,\n          maxHeight, currentFill, lastFill, path = this.path,\n          charSpacing = this._getWidthOfCharSpacing(),\n          offsetY = this.offsets[type];\n\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        heightOfLine = this.getHeightOfLine(i);\n        if (!this[type] && !this.styleHas(type, i)) {\n          topOffset += heightOfLine;\n          continue;\n        }\n        line = this._textLines[i];\n        maxHeight = heightOfLine / this.lineHeight;\n        lineLeftOffset = this._getLineLeftOffset(i);\n        boxStart = 0;\n        boxWidth = 0;\n        lastDecoration = this.getValueOfPropertyAt(i, 0, type);\n        lastFill = this.getValueOfPropertyAt(i, 0, 'fill');\n        top = topOffset + maxHeight * (1 - this._fontSizeFraction);\n        size = this.getHeightOfChar(i, 0);\n        dy = this.getValueOfPropertyAt(i, 0, 'deltaY');\n        for (var j = 0, jlen = line.length; j < jlen; j++) {\n          charBox = this.__charBounds[i][j];\n          currentDecoration = this.getValueOfPropertyAt(i, j, type);\n          currentFill = this.getValueOfPropertyAt(i, j, 'fill');\n          _size = this.getHeightOfChar(i, j);\n          _dy = this.getValueOfPropertyAt(i, j, 'deltaY');\n          if (path && currentDecoration && currentFill) {\n            ctx.save();\n            ctx.fillStyle = lastFill;\n            ctx.translate(charBox.renderLeft, charBox.renderTop);\n            ctx.rotate(charBox.angle);\n            ctx.fillRect(\n              -charBox.kernedWidth / 2,\n              offsetY * _size + _dy,\n              charBox.kernedWidth,\n              this.fontSize / 15\n            );\n            ctx.restore();\n          }\n          else if (\n            (currentDecoration !== lastDecoration || currentFill !== lastFill || _size !== size || _dy !== dy)\n            && boxWidth > 0\n          ) {\n            var drawStart = leftOffset + lineLeftOffset + boxStart;\n            if (this.direction === 'rtl') {\n              drawStart = this.width - drawStart - boxWidth;\n            }\n            if (lastDecoration && lastFill) {\n              ctx.fillStyle = lastFill;\n              ctx.fillRect(\n                drawStart,\n                top + offsetY * size + dy,\n                boxWidth,\n                this.fontSize / 15\n              );\n            }\n            boxStart = charBox.left;\n            boxWidth = charBox.width;\n            lastDecoration = currentDecoration;\n            lastFill = currentFill;\n            size = _size;\n            dy = _dy;\n          }\n          else {\n            boxWidth += charBox.kernedWidth;\n          }\n        }\n        var drawStart = leftOffset + lineLeftOffset + boxStart;\n        if (this.direction === 'rtl') {\n          drawStart = this.width - drawStart - boxWidth;\n        }\n        ctx.fillStyle = currentFill;\n        currentDecoration && currentFill && ctx.fillRect(\n          drawStart,\n          top + offsetY * size + dy,\n          boxWidth - charSpacing,\n          this.fontSize / 15\n        );\n        topOffset += heightOfLine;\n      }\n      // if there is text background color no\n      // other shadows should be casted\n      this._removeShadow(ctx);\n    },\n\n    /**\n     * return font declaration string for canvas context\n     * @param {Object} [styleObject] object\n     * @returns {String} font declaration formatted for canvas context.\n     */\n    _getFontDeclaration: function(styleObject, forMeasuring) {\n      var style = styleObject || this, family = this.fontFamily,\n          fontIsGeneric = fabric.Text.genericFonts.indexOf(family.toLowerCase()) > -1;\n      var fontFamily = family === undefined ||\n      family.indexOf('\\'') > -1 || family.indexOf(',') > -1 ||\n      family.indexOf('\"') > -1 || fontIsGeneric\n        ? style.fontFamily : '\"' + style.fontFamily + '\"';\n      return [\n        // node-canvas needs \"weight style\", while browsers need \"style weight\"\n        // verify if this can be fixed in JSDOM\n        (fabric.isLikelyNode ? style.fontWeight : style.fontStyle),\n        (fabric.isLikelyNode ? style.fontStyle : style.fontWeight),\n        forMeasuring ? this.CACHE_FONT_SIZE + 'px' : style.fontSize + 'px',\n        fontFamily\n      ].join(' ');\n    },\n\n    /**\n     * Renders text instance on a specified context\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    render: function(ctx) {\n      // do not render if object is not visible\n      if (!this.visible) {\n        return;\n      }\n      if (this.canvas && this.canvas.skipOffscreen && !this.group && !this.isOnScreen()) {\n        return;\n      }\n      if (this._shouldClearDimensionCache()) {\n        this.initDimensions();\n      }\n      this.callSuper('render', ctx);\n    },\n\n    /**\n     * Returns the text as an array of lines.\n     * @param {String} text text to split\n     * @returns {Array} Lines in the text\n     */\n    _splitTextIntoLines: function(text) {\n      var lines = text.split(this._reNewline),\n          newLines = new Array(lines.length),\n          newLine = ['\\n'],\n          newText = [];\n      for (var i = 0; i < lines.length; i++) {\n        newLines[i] = fabric.util.string.graphemeSplit(lines[i]);\n        newText = newText.concat(newLines[i], newLine);\n      }\n      newText.pop();\n      return { _unwrappedLines: newLines, lines: lines, graphemeText: newText, graphemeLines: newLines };\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} Object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      var allProperties = additionalProps.concat(propertiesToInclude);\n      var obj = this.callSuper('toObject', allProperties);\n      obj.styles = fabric.util.stylesToArray(this.styles, this.text);\n      if (obj.path) {\n        obj.path = this.path.toObject();\n      }\n      return obj;\n    },\n\n    /**\n     * Sets property to a given value. When changing position/dimension -related properties (left, top, scale, angle, etc.) `set` does not update position of object's borders/controls. If you need to update those, call `setCoords()`.\n     * @param {String|Object} key Property name or object (if object, iterate over the object properties)\n     * @param {Object|Function} value Property value (if function, the value is passed into it and its return value is used as a new one)\n     * @return {fabric.Object} thisArg\n     * @chainable\n     */\n    set: function(key, value) {\n      this.callSuper('set', key, value);\n      var needsDims = false;\n      var isAddingPath = false;\n      if (typeof key === 'object') {\n        for (var _key in key) {\n          if (_key === 'path') {\n            this.setPathInfo();\n          }\n          needsDims = needsDims || this._dimensionAffectingProps.indexOf(_key) !== -1;\n          isAddingPath = isAddingPath || _key === 'path';\n        }\n      }\n      else {\n        needsDims = this._dimensionAffectingProps.indexOf(key) !== -1;\n        isAddingPath = key === 'path';\n      }\n      if (isAddingPath) {\n        this.setPathInfo();\n      }\n      if (needsDims) {\n        this.initDimensions();\n        this.setCoords();\n      }\n      return this;\n    },\n\n    /**\n     * Returns complexity of an instance\n     * @return {Number} complexity\n     */\n    complexity: function() {\n      return 1;\n    }\n  });\n\n  /* _FROM_SVG_START_ */\n  /**\n   * List of attribute names to account for when parsing SVG element (used by {@link fabric.Text.fromElement})\n   * @static\n   * @memberOf fabric.Text\n   * @see: http://www.w3.org/TR/SVG/text.html#TextElement\n   */\n  fabric.Text.ATTRIBUTE_NAMES = fabric.SHARED_ATTRIBUTES.concat(\n    'x y dx dy font-family font-style font-weight font-size letter-spacing text-decoration text-anchor'.split(' '));\n\n  /**\n   * Default SVG font size\n   * @static\n   * @memberOf fabric.Text\n   */\n  fabric.Text.DEFAULT_SVG_FONT_SIZE = 16;\n\n  /**\n   * Returns fabric.Text instance from an SVG element (<b>not yet implemented</b>)\n   * @static\n   * @memberOf fabric.Text\n   * @param {SVGElement} element Element to parse\n   * @param {Function} callback callback function invoked after parsing\n   * @param {Object} [options] Options object\n   */\n  fabric.Text.fromElement = function(element, callback, options) {\n    if (!element) {\n      return callback(null);\n    }\n\n    var parsedAttributes = fabric.parseAttributes(element, fabric.Text.ATTRIBUTE_NAMES),\n        parsedAnchor = parsedAttributes.textAnchor || 'left';\n    options = fabric.util.object.extend((options ? clone(options) : { }), parsedAttributes);\n\n    options.top = options.top || 0;\n    options.left = options.left || 0;\n    if (parsedAttributes.textDecoration) {\n      var textDecoration = parsedAttributes.textDecoration;\n      if (textDecoration.indexOf('underline') !== -1) {\n        options.underline = true;\n      }\n      if (textDecoration.indexOf('overline') !== -1) {\n        options.overline = true;\n      }\n      if (textDecoration.indexOf('line-through') !== -1) {\n        options.linethrough = true;\n      }\n      delete options.textDecoration;\n    }\n    if ('dx' in parsedAttributes) {\n      options.left += parsedAttributes.dx;\n    }\n    if ('dy' in parsedAttributes) {\n      options.top += parsedAttributes.dy;\n    }\n    if (!('fontSize' in options)) {\n      options.fontSize = fabric.Text.DEFAULT_SVG_FONT_SIZE;\n    }\n\n    var textContent = '';\n\n    // The XML is not properly parsed in IE9 so a workaround to get\n    // textContent is through firstChild.data. Another workaround would be\n    // to convert XML loaded from a file to be converted using DOMParser (same way loadSVGFromString() does)\n    if (!('textContent' in element)) {\n      if ('firstChild' in element && element.firstChild !== null) {\n        if ('data' in element.firstChild && element.firstChild.data !== null) {\n          textContent = element.firstChild.data;\n        }\n      }\n    }\n    else {\n      textContent = element.textContent;\n    }\n\n    textContent = textContent.replace(/^\\s+|\\s+$|\\n+/g, '').replace(/\\s+/g, ' ');\n    var originalStrokeWidth = options.strokeWidth;\n    options.strokeWidth = 0;\n\n    var text = new fabric.Text(textContent, options),\n        textHeightScaleFactor = text.getScaledHeight() / text.height,\n        lineHeightDiff = (text.height + text.strokeWidth) * text.lineHeight - text.height,\n        scaledDiff = lineHeightDiff * textHeightScaleFactor,\n        textHeight = text.getScaledHeight() + scaledDiff,\n        offX = 0;\n    /*\n      Adjust positioning:\n        x/y attributes in SVG correspond to the bottom-left corner of text bounding box\n        fabric output by default at top, left.\n    */\n    if (parsedAnchor === 'center') {\n      offX = text.getScaledWidth() / 2;\n    }\n    if (parsedAnchor === 'right') {\n      offX = text.getScaledWidth();\n    }\n    text.set({\n      left: text.left - offX,\n      top: text.top - (textHeight - text.fontSize * (0.07 + text._fontSizeFraction)) / text.lineHeight,\n      strokeWidth: typeof originalStrokeWidth !== 'undefined' ? originalStrokeWidth : 1,\n    });\n    callback(text);\n  };\n  /* _FROM_SVG_END_ */\n\n  /**\n   * Returns fabric.Text instance from an object representation\n   * @static\n   * @memberOf fabric.Text\n   * @param {Object} object plain js Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Text instance is created\n   */\n  fabric.Text.fromObject = function(object, callback) {\n    var objectCopy = clone(object), path = object.path;\n    delete objectCopy.path;\n    return fabric.Object._fromObject('Text', objectCopy, function(textInstance) {\n      textInstance.styles = fabric.util.stylesFromArray(object.styles, object.text);\n      if (path) {\n        fabric.Object._fromObject('Path', path, function(pathInstance) {\n          textInstance.set('path', pathInstance);\n          callback(textInstance);\n        }, 'path');\n      }\n      else {\n        callback(textInstance);\n      }\n    }, 'text');\n  };\n\n  fabric.Text.genericFonts = ['sans-serif', 'serif', 'cursive', 'fantasy', 'monospace'];\n\n  fabric.util.createAccessors && fabric.util.createAccessors(fabric.Text);\n\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n  fabric.util.object.extend(fabric.Text.prototype, /** @lends fabric.Text.prototype */ {\n    /**\n     * Returns true if object has no styling or no styling in a line\n     * @param {Number} lineIndex , lineIndex is on wrapped lines.\n     * @return {Boolean}\n     */\n    isEmptyStyles: function(lineIndex) {\n      if (!this.styles) {\n        return true;\n      }\n      if (typeof lineIndex !== 'undefined' && !this.styles[lineIndex]) {\n        return true;\n      }\n      var obj = typeof lineIndex === 'undefined' ? this.styles : { line: this.styles[lineIndex] };\n      for (var p1 in obj) {\n        for (var p2 in obj[p1]) {\n          // eslint-disable-next-line no-unused-vars\n          for (var p3 in obj[p1][p2]) {\n            return false;\n          }\n        }\n      }\n      return true;\n    },\n\n    /**\n     * Returns true if object has a style property or has it ina specified line\n     * This function is used to detect if a text will use a particular property or not.\n     * @param {String} property to check for\n     * @param {Number} lineIndex to check the style on\n     * @return {Boolean}\n     */\n    styleHas: function(property, lineIndex) {\n      if (!this.styles || !property || property === '') {\n        return false;\n      }\n      if (typeof lineIndex !== 'undefined' && !this.styles[lineIndex]) {\n        return false;\n      }\n      var obj = typeof lineIndex === 'undefined' ? this.styles : { 0: this.styles[lineIndex] };\n      // eslint-disable-next-line\n      for (var p1 in obj) {\n        // eslint-disable-next-line\n        for (var p2 in obj[p1]) {\n          if (typeof obj[p1][p2][property] !== 'undefined') {\n            return true;\n          }\n        }\n      }\n      return false;\n    },\n\n    /**\n     * Check if characters in a text have a value for a property\n     * whose value matches the textbox's value for that property.  If so,\n     * the character-level property is deleted.  If the character\n     * has no other properties, then it is also deleted.  Finally,\n     * if the line containing that character has no other characters\n     * then it also is deleted.\n     *\n     * @param {string} property The property to compare between characters and text.\n     */\n    cleanStyle: function(property) {\n      if (!this.styles || !property || property === '') {\n        return false;\n      }\n      var obj = this.styles, stylesCount = 0, letterCount, stylePropertyValue,\n          allStyleObjectPropertiesMatch = true, graphemeCount = 0, styleObject;\n      // eslint-disable-next-line\n      for (var p1 in obj) {\n        letterCount = 0;\n        // eslint-disable-next-line\n        for (var p2 in obj[p1]) {\n          var styleObject = obj[p1][p2],\n              stylePropertyHasBeenSet = styleObject.hasOwnProperty(property);\n\n          stylesCount++;\n\n          if (stylePropertyHasBeenSet) {\n            if (!stylePropertyValue) {\n              stylePropertyValue = styleObject[property];\n            }\n            else if (styleObject[property] !== stylePropertyValue) {\n              allStyleObjectPropertiesMatch = false;\n            }\n\n            if (styleObject[property] === this[property]) {\n              delete styleObject[property];\n            }\n          }\n          else {\n            allStyleObjectPropertiesMatch = false;\n          }\n\n          if (Object.keys(styleObject).length !== 0) {\n            letterCount++;\n          }\n          else {\n            delete obj[p1][p2];\n          }\n        }\n\n        if (letterCount === 0) {\n          delete obj[p1];\n        }\n      }\n      // if every grapheme has the same style set then\n      // delete those styles and set it on the parent\n      for (var i = 0; i < this._textLines.length; i++) {\n        graphemeCount += this._textLines[i].length;\n      }\n      if (allStyleObjectPropertiesMatch && stylesCount === graphemeCount) {\n        this[property] = stylePropertyValue;\n        this.removeStyle(property);\n      }\n    },\n\n    /**\n     * Remove a style property or properties from all individual character styles\n     * in a text object.  Deletes the character style object if it contains no other style\n     * props.  Deletes a line style object if it contains no other character styles.\n     *\n     * @param {String} props The property to remove from character styles.\n     */\n    removeStyle: function(property) {\n      if (!this.styles || !property || property === '') {\n        return;\n      }\n      var obj = this.styles, line, lineNum, charNum;\n      for (lineNum in obj) {\n        line = obj[lineNum];\n        for (charNum in line) {\n          delete line[charNum][property];\n          if (Object.keys(line[charNum]).length === 0) {\n            delete line[charNum];\n          }\n        }\n        if (Object.keys(line).length === 0) {\n          delete obj[lineNum];\n        }\n      }\n    },\n\n    /**\n     * @private\n     */\n    _extendStyles: function(index, styles) {\n      var loc = this.get2DCursorLocation(index);\n\n      if (!this._getLineStyle(loc.lineIndex)) {\n        this._setLineStyle(loc.lineIndex);\n      }\n\n      if (!this._getStyleDeclaration(loc.lineIndex, loc.charIndex)) {\n        this._setStyleDeclaration(loc.lineIndex, loc.charIndex, {});\n      }\n\n      fabric.util.object.extend(this._getStyleDeclaration(loc.lineIndex, loc.charIndex), styles);\n    },\n\n    /**\n     * Returns 2d representation (lineIndex and charIndex) of cursor (or selection start)\n     * @param {Number} [selectionStart] Optional index. When not given, current selectionStart is used.\n     * @param {Boolean} [skipWrapping] consider the location for unwrapped lines. useful to manage styles.\n     */\n    get2DCursorLocation: function(selectionStart, skipWrapping) {\n      if (typeof selectionStart === 'undefined') {\n        selectionStart = this.selectionStart;\n      }\n      var lines = skipWrapping ? this._unwrappedTextLines : this._textLines,\n          len = lines.length;\n      for (var i = 0; i < len; i++) {\n        if (selectionStart <= lines[i].length) {\n          return {\n            lineIndex: i,\n            charIndex: selectionStart\n          };\n        }\n        selectionStart -= lines[i].length + this.missingNewlineOffset(i);\n      }\n      return {\n        lineIndex: i - 1,\n        charIndex: lines[i - 1].length < selectionStart ? lines[i - 1].length : selectionStart\n      };\n    },\n\n    /**\n     * Gets style of a current selection/cursor (at the start position)\n     * if startIndex or endIndex are not provided, selectionStart or selectionEnd will be used.\n     * @param {Number} [startIndex] Start index to get styles at\n     * @param {Number} [endIndex] End index to get styles at, if not specified selectionEnd or startIndex + 1\n     * @param {Boolean} [complete] get full style or not\n     * @return {Array} styles an array with one, zero or more Style objects\n     */\n    getSelectionStyles: function(startIndex, endIndex, complete) {\n      if (typeof startIndex === 'undefined') {\n        startIndex = this.selectionStart || 0;\n      }\n      if (typeof endIndex === 'undefined') {\n        endIndex = this.selectionEnd || startIndex;\n      }\n      var styles = [];\n      for (var i = startIndex; i < endIndex; i++) {\n        styles.push(this.getStyleAtPosition(i, complete));\n      }\n      return styles;\n    },\n\n    /**\n     * Gets style of a current selection/cursor position\n     * @param {Number} position  to get styles at\n     * @param {Boolean} [complete] full style if true\n     * @return {Object} style Style object at a specified index\n     * @private\n     */\n    getStyleAtPosition: function(position, complete) {\n      var loc = this.get2DCursorLocation(position),\n          style = complete ? this.getCompleteStyleDeclaration(loc.lineIndex, loc.charIndex) :\n            this._getStyleDeclaration(loc.lineIndex, loc.charIndex);\n      return style || {};\n    },\n\n    /**\n     * Sets style of a current selection, if no selection exist, do not set anything.\n     * @param {Object} [styles] Styles object\n     * @param {Number} [startIndex] Start index to get styles at\n     * @param {Number} [endIndex] End index to get styles at, if not specified selectionEnd or startIndex + 1\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    setSelectionStyles: function(styles, startIndex, endIndex) {\n      if (typeof startIndex === 'undefined') {\n        startIndex = this.selectionStart || 0;\n      }\n      if (typeof endIndex === 'undefined') {\n        endIndex = this.selectionEnd || startIndex;\n      }\n      for (var i = startIndex; i < endIndex; i++) {\n        this._extendStyles(i, styles);\n      }\n      /* not included in _extendStyles to avoid clearing cache more than once */\n      this._forceClearCache = true;\n      return this;\n    },\n\n    /**\n     * get the reference, not a clone, of the style object for a given character\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @return {Object} style object\n     */\n    _getStyleDeclaration: function(lineIndex, charIndex) {\n      var lineStyle = this.styles && this.styles[lineIndex];\n      if (!lineStyle) {\n        return null;\n      }\n      return lineStyle[charIndex];\n    },\n\n    /**\n     * return a new object that contains all the style property for a character\n     * the object returned is newly created\n     * @param {Number} lineIndex of the line where the character is\n     * @param {Number} charIndex position of the character on the line\n     * @return {Object} style object\n     */\n    getCompleteStyleDeclaration: function(lineIndex, charIndex) {\n      var style = this._getStyleDeclaration(lineIndex, charIndex) || { },\n          styleObject = { }, prop;\n      for (var i = 0; i < this._styleProperties.length; i++) {\n        prop = this._styleProperties[i];\n        styleObject[prop] = typeof style[prop] === 'undefined' ? this[prop] : style[prop];\n      }\n      return styleObject;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Object} style\n     * @private\n     */\n    _setStyleDeclaration: function(lineIndex, charIndex, style) {\n      this.styles[lineIndex][charIndex] = style;\n    },\n\n    /**\n     *\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _deleteStyleDeclaration: function(lineIndex, charIndex) {\n      delete this.styles[lineIndex][charIndex];\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @return {Boolean} if the line exists or not\n     * @private\n     */\n    _getLineStyle: function(lineIndex) {\n      return !!this.styles[lineIndex];\n    },\n\n    /**\n     * Set the line style to an empty object so that is initialized\n     * @param {Number} lineIndex\n     * @private\n     */\n    _setLineStyle: function(lineIndex) {\n      this.styles[lineIndex] = {};\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @private\n     */\n    _deleteLineStyle: function(lineIndex) {\n      delete this.styles[lineIndex];\n    }\n  });\n})();\n\n\n(function() {\n\n  function parseDecoration(object) {\n    if (object.textDecoration) {\n      object.textDecoration.indexOf('underline') > -1 && (object.underline = true);\n      object.textDecoration.indexOf('line-through') > -1 && (object.linethrough = true);\n      object.textDecoration.indexOf('overline') > -1 && (object.overline = true);\n      delete object.textDecoration;\n    }\n  }\n\n  /**\n   * IText class (introduced in <b>v1.4</b>) Events are also fired with \"text:\"\n   * prefix when observing canvas.\n   * @class fabric.IText\n   * @extends fabric.Text\n   * @mixes fabric.Observable\n   *\n   * @fires changed\n   * @fires selection:changed\n   * @fires editing:entered\n   * @fires editing:exited\n   *\n   * @return {fabric.IText} thisArg\n   * @see {@link fabric.IText#initialize} for constructor definition\n   *\n   * <p>Supported key combinations:</p>\n   * <pre>\n   *   Move cursor:                    left, right, up, down\n   *   Select character:               shift + left, shift + right\n   *   Select text vertically:         shift + up, shift + down\n   *   Move cursor by word:            alt + left, alt + right\n   *   Select words:                   shift + alt + left, shift + alt + right\n   *   Move cursor to line start/end:  cmd + left, cmd + right or home, end\n   *   Select till start/end of line:  cmd + shift + left, cmd + shift + right or shift + home, shift + end\n   *   Jump to start/end of text:      cmd + up, cmd + down\n   *   Select till start/end of text:  cmd + shift + up, cmd + shift + down or shift + pgUp, shift + pgDown\n   *   Delete character:               backspace\n   *   Delete word:                    alt + backspace\n   *   Delete line:                    cmd + backspace\n   *   Forward delete:                 delete\n   *   Copy text:                      ctrl/cmd + c\n   *   Paste text:                     ctrl/cmd + v\n   *   Cut text:                       ctrl/cmd + x\n   *   Select entire text:             ctrl/cmd + a\n   *   Quit editing                    tab or esc\n   * </pre>\n   *\n   * <p>Supported mouse/touch combination</p>\n   * <pre>\n   *   Position cursor:                click/touch\n   *   Create selection:               click/touch & drag\n   *   Create selection:               click & shift + click\n   *   Select word:                    double click\n   *   Select line:                    triple click\n   * </pre>\n   */\n  fabric.IText = fabric.util.createClass(fabric.Text, fabric.Observable, /** @lends fabric.IText.prototype */ {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'i-text',\n\n    /**\n     * Index where text selection starts (or where cursor is when there is no selection)\n     * @type Number\n     * @default\n     */\n    selectionStart: 0,\n\n    /**\n     * Index where text selection ends\n     * @type Number\n     * @default\n     */\n    selectionEnd: 0,\n\n    /**\n     * Color of text selection\n     * @type String\n     * @default\n     */\n    selectionColor: 'rgba(17,119,255,0.3)',\n\n    /**\n     * Indicates whether text is in editing mode\n     * @type Boolean\n     * @default\n     */\n    isEditing: false,\n\n    /**\n     * Indicates whether a text can be edited\n     * @type Boolean\n     * @default\n     */\n    editable: true,\n\n    /**\n     * Border color of text object while it's in editing mode\n     * @type String\n     * @default\n     */\n    editingBorderColor: 'rgba(102,153,255,0.25)',\n\n    /**\n     * Width of cursor (in px)\n     * @type Number\n     * @default\n     */\n    cursorWidth: 2,\n\n    /**\n     * Color of text cursor color in editing mode.\n     * if not set (default) will take color from the text.\n     * if set to a color value that fabric can understand, it will\n     * be used instead of the color of the text at the current position.\n     * @type String\n     * @default\n     */\n    cursorColor: '',\n\n    /**\n     * Delay between cursor blink (in ms)\n     * @type Number\n     * @default\n     */\n    cursorDelay: 1000,\n\n    /**\n     * Duration of cursor fadein (in ms)\n     * @type Number\n     * @default\n     */\n    cursorDuration: 600,\n\n    /**\n     * Indicates whether internal text char widths can be cached\n     * @type Boolean\n     * @default\n     */\n    caching: true,\n\n    /**\n     * DOM container to append the hiddenTextarea.\n     * An alternative to attaching to the document.body.\n     * Useful to reduce laggish redraw of the full document.body tree and\n     * also with modals event capturing that won't let the textarea take focus.\n     * @type HTMLElement\n     * @default\n     */\n    hiddenTextareaContainer: null,\n\n    /**\n     * @private\n     */\n    _reSpace: /\\s|\\n/,\n\n    /**\n     * @private\n     */\n    _currentCursorOpacity: 0,\n\n    /**\n     * @private\n     */\n    _selectionDirection: null,\n\n    /**\n     * @private\n     */\n    _abortCursorAnimation: false,\n\n    /**\n     * @private\n     */\n    __widthOfSpace: [],\n\n    /**\n     * Helps determining when the text is in composition, so that the cursor\n     * rendering is altered.\n     */\n    inCompositionMode: false,\n\n    /**\n     * Constructor\n     * @param {String} text Text string\n     * @param {Object} [options] Options object\n     * @return {fabric.IText} thisArg\n     */\n    initialize: function(text, options) {\n      this.callSuper('initialize', text, options);\n      this.initBehavior();\n    },\n\n    /**\n     * Sets selection start (left boundary of a selection)\n     * @param {Number} index Index to set selection start to\n     */\n    setSelectionStart: function(index) {\n      index = Math.max(index, 0);\n      this._updateAndFire('selectionStart', index);\n    },\n\n    /**\n     * Sets selection end (right boundary of a selection)\n     * @param {Number} index Index to set selection end to\n     */\n    setSelectionEnd: function(index) {\n      index = Math.min(index, this.text.length);\n      this._updateAndFire('selectionEnd', index);\n    },\n\n    /**\n     * @private\n     * @param {String} property 'selectionStart' or 'selectionEnd'\n     * @param {Number} index new position of property\n     */\n    _updateAndFire: function(property, index) {\n      if (this[property] !== index) {\n        this._fireSelectionChanged();\n        this[property] = index;\n      }\n      this._updateTextarea();\n    },\n\n    /**\n     * Fires the even of selection changed\n     * @private\n     */\n    _fireSelectionChanged: function() {\n      this.fire('selection:changed');\n      this.canvas && this.canvas.fire('text:selection:changed', { target: this });\n    },\n\n    /**\n     * Initialize text dimensions. Render all text on given context\n     * or on a offscreen canvas to get the text width with measureText.\n     * Updates this.width and this.height with the proper values.\n     * Does not return dimensions.\n     * @private\n     */\n    initDimensions: function() {\n      this.isEditing && this.initDelayedCursor();\n      this.clearContextTop();\n      this.callSuper('initDimensions');\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    render: function(ctx) {\n      this.clearContextTop();\n      this.callSuper('render', ctx);\n      // clear the cursorOffsetCache, so we ensure to calculate once per renderCursor\n      // the correct position but not at every cursor animation.\n      this.cursorOffsetCache = { };\n      this.renderCursorOrSelection();\n    },\n\n    /**\n     * @private\n     * @param {CanvasRenderingContext2D} ctx Context to render on\n     */\n    _render: function(ctx) {\n      this.callSuper('_render', ctx);\n    },\n\n    /**\n     * Prepare and clean the contextTop\n     */\n    clearContextTop: function(skipRestore) {\n      if (!this.isEditing || !this.canvas || !this.canvas.contextTop) {\n        return;\n      }\n      var ctx = this.canvas.contextTop, v = this.canvas.viewportTransform;\n      ctx.save();\n      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);\n      this.transform(ctx);\n      this._clearTextArea(ctx);\n      skipRestore || ctx.restore();\n    },\n    /**\n     * Renders cursor or selection (depending on what exists)\n     * it does on the contextTop. If contextTop is not available, do nothing.\n     */\n    renderCursorOrSelection: function() {\n      if (!this.isEditing || !this.canvas || !this.canvas.contextTop) {\n        return;\n      }\n      var boundaries = this._getCursorBoundaries(),\n          ctx = this.canvas.contextTop;\n      this.clearContextTop(true);\n      if (this.selectionStart === this.selectionEnd) {\n        this.renderCursor(boundaries, ctx);\n      }\n      else {\n        this.renderSelection(boundaries, ctx);\n      }\n      ctx.restore();\n    },\n\n    _clearTextArea: function(ctx) {\n      // we add 4 pixel, to be sure to do not leave any pixel out\n      var width = this.width + 4, height = this.height + 4;\n      ctx.clearRect(-width / 2, -height / 2, width, height);\n    },\n\n    /**\n     * Returns cursor boundaries (left, top, leftOffset, topOffset)\n     * @private\n     * @param {Array} chars Array of characters\n     * @param {String} typeOfBoundaries\n     */\n    _getCursorBoundaries: function(position) {\n\n      // left/top are left/top of entire text box\n      // leftOffset/topOffset are offset from that left/top point of a text box\n\n      if (typeof position === 'undefined') {\n        position = this.selectionStart;\n      }\n\n      var left = this._getLeftOffset(),\n          top = this._getTopOffset(),\n          offsets = this._getCursorBoundariesOffsets(position);\n      return {\n        left: left,\n        top: top,\n        leftOffset: offsets.left,\n        topOffset: offsets.top\n      };\n    },\n\n    /**\n     * @private\n     */\n    _getCursorBoundariesOffsets: function(position) {\n      if (this.cursorOffsetCache && 'top' in this.cursorOffsetCache) {\n        return this.cursorOffsetCache;\n      }\n      var lineLeftOffset,\n          lineIndex,\n          charIndex,\n          topOffset = 0,\n          leftOffset = 0,\n          boundaries,\n          cursorPosition = this.get2DCursorLocation(position);\n      charIndex = cursorPosition.charIndex;\n      lineIndex = cursorPosition.lineIndex;\n      for (var i = 0; i < lineIndex; i++) {\n        topOffset += this.getHeightOfLine(i);\n      }\n      lineLeftOffset = this._getLineLeftOffset(lineIndex);\n      var bound = this.__charBounds[lineIndex][charIndex];\n      bound && (leftOffset = bound.left);\n      if (this.charSpacing !== 0 && charIndex === this._textLines[lineIndex].length) {\n        leftOffset -= this._getWidthOfCharSpacing();\n      }\n      boundaries = {\n        top: topOffset,\n        left: lineLeftOffset + (leftOffset > 0 ? leftOffset : 0),\n      };\n      if (this.direction === 'rtl') {\n        boundaries.left *= -1;\n      }\n      this.cursorOffsetCache = boundaries;\n      return this.cursorOffsetCache;\n    },\n\n    /**\n     * Renders cursor\n     * @param {Object} boundaries\n     * @param {CanvasRenderingContext2D} ctx transformed context to draw on\n     */\n    renderCursor: function(boundaries, ctx) {\n      var cursorLocation = this.get2DCursorLocation(),\n          lineIndex = cursorLocation.lineIndex,\n          charIndex = cursorLocation.charIndex > 0 ? cursorLocation.charIndex - 1 : 0,\n          charHeight = this.getValueOfPropertyAt(lineIndex, charIndex, 'fontSize'),\n          multiplier = this.scaleX * this.canvas.getZoom(),\n          cursorWidth = this.cursorWidth / multiplier,\n          topOffset = boundaries.topOffset,\n          dy = this.getValueOfPropertyAt(lineIndex, charIndex, 'deltaY');\n      topOffset += (1 - this._fontSizeFraction) * this.getHeightOfLine(lineIndex) / this.lineHeight\n        - charHeight * (1 - this._fontSizeFraction);\n\n      if (this.inCompositionMode) {\n        this.renderSelection(boundaries, ctx);\n      }\n      ctx.fillStyle = this.cursorColor || this.getValueOfPropertyAt(lineIndex, charIndex, 'fill');\n      ctx.globalAlpha = this.__isMousedown ? 1 : this._currentCursorOpacity;\n      ctx.fillRect(\n        boundaries.left + boundaries.leftOffset - cursorWidth / 2,\n        topOffset + boundaries.top + dy,\n        cursorWidth,\n        charHeight);\n    },\n\n    /**\n     * Renders text selection\n     * @param {Object} boundaries Object with left/top/leftOffset/topOffset\n     * @param {CanvasRenderingContext2D} ctx transformed context to draw on\n     */\n    renderSelection: function(boundaries, ctx) {\n\n      var selectionStart = this.inCompositionMode ? this.hiddenTextarea.selectionStart : this.selectionStart,\n          selectionEnd = this.inCompositionMode ? this.hiddenTextarea.selectionEnd : this.selectionEnd,\n          isJustify = this.textAlign.indexOf('justify') !== -1,\n          start = this.get2DCursorLocation(selectionStart),\n          end = this.get2DCursorLocation(selectionEnd),\n          startLine = start.lineIndex,\n          endLine = end.lineIndex,\n          startChar = start.charIndex < 0 ? 0 : start.charIndex,\n          endChar = end.charIndex < 0 ? 0 : end.charIndex;\n\n      for (var i = startLine; i <= endLine; i++) {\n        var lineOffset = this._getLineLeftOffset(i) || 0,\n            lineHeight = this.getHeightOfLine(i),\n            realLineHeight = 0, boxStart = 0, boxEnd = 0;\n\n        if (i === startLine) {\n          boxStart = this.__charBounds[startLine][startChar].left;\n        }\n        if (i >= startLine && i < endLine) {\n          boxEnd = isJustify && !this.isEndOfWrapping(i) ? this.width : this.getLineWidth(i) || 5; // WTF is this 5?\n        }\n        else if (i === endLine) {\n          if (endChar === 0) {\n            boxEnd = this.__charBounds[endLine][endChar].left;\n          }\n          else {\n            var charSpacing = this._getWidthOfCharSpacing();\n            boxEnd = this.__charBounds[endLine][endChar - 1].left\n              + this.__charBounds[endLine][endChar - 1].width - charSpacing;\n          }\n        }\n        realLineHeight = lineHeight;\n        if (this.lineHeight < 1 || (i === endLine && this.lineHeight > 1)) {\n          lineHeight /= this.lineHeight;\n        }\n        var drawStart = boundaries.left + lineOffset + boxStart,\n            drawWidth = boxEnd - boxStart,\n            drawHeight = lineHeight, extraTop = 0;\n        if (this.inCompositionMode) {\n          ctx.fillStyle = this.compositionColor || 'black';\n          drawHeight = 1;\n          extraTop = lineHeight;\n        }\n        else {\n          ctx.fillStyle = this.selectionColor;\n        }\n        if (this.direction === 'rtl') {\n          drawStart = this.width - drawStart - drawWidth;\n        }\n        ctx.fillRect(\n          drawStart,\n          boundaries.top + boundaries.topOffset + extraTop,\n          drawWidth,\n          drawHeight);\n        boundaries.topOffset += realLineHeight;\n      }\n    },\n\n    /**\n     * High level function to know the height of the cursor.\n     * the currentChar is the one that precedes the cursor\n     * Returns fontSize of char at the current cursor\n     * Unused from the library, is for the end user\n     * @return {Number} Character font size\n     */\n    getCurrentCharFontSize: function() {\n      var cp = this._getCurrentCharIndex();\n      return this.getValueOfPropertyAt(cp.l, cp.c, 'fontSize');\n    },\n\n    /**\n     * High level function to know the color of the cursor.\n     * the currentChar is the one that precedes the cursor\n     * Returns color (fill) of char at the current cursor\n     * if the text object has a pattern or gradient for filler, it will return that.\n     * Unused by the library, is for the end user\n     * @return {String | fabric.Gradient | fabric.Pattern} Character color (fill)\n     */\n    getCurrentCharColor: function() {\n      var cp = this._getCurrentCharIndex();\n      return this.getValueOfPropertyAt(cp.l, cp.c, 'fill');\n    },\n\n    /**\n     * Returns the cursor position for the getCurrent.. functions\n     * @private\n     */\n    _getCurrentCharIndex: function() {\n      var cursorPosition = this.get2DCursorLocation(this.selectionStart, true),\n          charIndex = cursorPosition.charIndex > 0 ? cursorPosition.charIndex - 1 : 0;\n      return { l: cursorPosition.lineIndex, c: charIndex };\n    }\n  });\n\n  /**\n   * Returns fabric.IText instance from an object representation\n   * @static\n   * @memberOf fabric.IText\n   * @param {Object} object Object to create an instance from\n   * @param {function} [callback] invoked with new instance as argument\n   */\n  fabric.IText.fromObject = function(object, callback) {\n    var styles = fabric.util.stylesFromArray(object.styles, object.text);\n    //copy object to prevent mutation\n    var objCopy = Object.assign({}, object, { styles: styles });\n    parseDecoration(objCopy);\n    if (objCopy.styles) {\n      for (var i in objCopy.styles) {\n        for (var j in objCopy.styles[i]) {\n          parseDecoration(objCopy.styles[i][j]);\n        }\n      }\n    }\n    fabric.Object._fromObject('IText', objCopy, callback, 'text');\n  };\n})();\n\n\n(function() {\n\n  var clone = fabric.util.object.clone;\n\n  fabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n\n    /**\n     * Initializes all the interactive behavior of IText\n     */\n    initBehavior: function() {\n      this.initAddedHandler();\n      this.initRemovedHandler();\n      this.initCursorSelectionHandlers();\n      this.initDoubleClickSimulation();\n      this.mouseMoveHandler = this.mouseMoveHandler.bind(this);\n    },\n\n    onDeselect: function() {\n      this.isEditing && this.exitEditing();\n      this.selected = false;\n    },\n\n    /**\n     * Initializes \"added\" event handler\n     */\n    initAddedHandler: function() {\n      var _this = this;\n      this.on('added', function() {\n        var canvas = _this.canvas;\n        if (canvas) {\n          if (!canvas._hasITextHandlers) {\n            canvas._hasITextHandlers = true;\n            _this._initCanvasHandlers(canvas);\n          }\n          canvas._iTextInstances = canvas._iTextInstances || [];\n          canvas._iTextInstances.push(_this);\n        }\n      });\n    },\n\n    initRemovedHandler: function() {\n      var _this = this;\n      this.on('removed', function() {\n        var canvas = _this.canvas;\n        if (canvas) {\n          canvas._iTextInstances = canvas._iTextInstances || [];\n          fabric.util.removeFromArray(canvas._iTextInstances, _this);\n          if (canvas._iTextInstances.length === 0) {\n            canvas._hasITextHandlers = false;\n            _this._removeCanvasHandlers(canvas);\n          }\n        }\n      });\n    },\n\n    /**\n     * register canvas event to manage exiting on other instances\n     * @private\n     */\n    _initCanvasHandlers: function(canvas) {\n      canvas._mouseUpITextHandler = function() {\n        if (canvas._iTextInstances) {\n          canvas._iTextInstances.forEach(function(obj) {\n            obj.__isMousedown = false;\n          });\n        }\n      };\n      canvas.on('mouse:up', canvas._mouseUpITextHandler);\n    },\n\n    /**\n     * remove canvas event to manage exiting on other instances\n     * @private\n     */\n    _removeCanvasHandlers: function(canvas) {\n      canvas.off('mouse:up', canvas._mouseUpITextHandler);\n    },\n\n    /**\n     * @private\n     */\n    _tick: function() {\n      this._currentTickState = this._animateCursor(this, 1, this.cursorDuration, '_onTickComplete');\n    },\n\n    /**\n     * @private\n     */\n    _animateCursor: function(obj, targetOpacity, duration, completeMethod) {\n\n      var tickState;\n\n      tickState = {\n        isAborted: false,\n        abort: function() {\n          this.isAborted = true;\n        },\n      };\n\n      obj.animate('_currentCursorOpacity', targetOpacity, {\n        duration: duration,\n        onComplete: function() {\n          if (!tickState.isAborted) {\n            obj[completeMethod]();\n          }\n        },\n        onChange: function() {\n          // we do not want to animate a selection, only cursor\n          if (obj.canvas && obj.selectionStart === obj.selectionEnd) {\n            obj.renderCursorOrSelection();\n          }\n        },\n        abort: function() {\n          return tickState.isAborted;\n        }\n      });\n      return tickState;\n    },\n\n    /**\n     * @private\n     */\n    _onTickComplete: function() {\n\n      var _this = this;\n\n      if (this._cursorTimeout1) {\n        clearTimeout(this._cursorTimeout1);\n      }\n      this._cursorTimeout1 = setTimeout(function() {\n        _this._currentTickCompleteState = _this._animateCursor(_this, 0, this.cursorDuration / 2, '_tick');\n      }, 100);\n    },\n\n    /**\n     * Initializes delayed cursor\n     */\n    initDelayedCursor: function(restart) {\n      var _this = this,\n          delay = restart ? 0 : this.cursorDelay;\n\n      this.abortCursorAnimation();\n      this._currentCursorOpacity = 1;\n      this._cursorTimeout2 = setTimeout(function() {\n        _this._tick();\n      }, delay);\n    },\n\n    /**\n     * Aborts cursor animation and clears all timeouts\n     */\n    abortCursorAnimation: function() {\n      var shouldClear = this._currentTickState || this._currentTickCompleteState,\n          canvas = this.canvas;\n      this._currentTickState && this._currentTickState.abort();\n      this._currentTickCompleteState && this._currentTickCompleteState.abort();\n\n      clearTimeout(this._cursorTimeout1);\n      clearTimeout(this._cursorTimeout2);\n\n      this._currentCursorOpacity = 0;\n      // to clear just itext area we need to transform the context\n      // it may not be worth it\n      if (shouldClear && canvas) {\n        canvas.clearContext(canvas.contextTop || canvas.contextContainer);\n      }\n\n    },\n\n    /**\n     * Selects entire text\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    selectAll: function() {\n      this.selectionStart = 0;\n      this.selectionEnd = this._text.length;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n      return this;\n    },\n\n    /**\n     * Returns selected text\n     * @return {String}\n     */\n    getSelectedText: function() {\n      return this._text.slice(this.selectionStart, this.selectionEnd).join('');\n    },\n\n    /**\n     * Find new selection index representing start of current word according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findWordBoundaryLeft: function(startFrom) {\n      var offset = 0, index = startFrom - 1;\n\n      // remove space before cursor first\n      if (this._reSpace.test(this._text[index])) {\n        while (this._reSpace.test(this._text[index])) {\n          offset++;\n          index--;\n        }\n      }\n      while (/\\S/.test(this._text[index]) && index > -1) {\n        offset++;\n        index--;\n      }\n\n      return startFrom - offset;\n    },\n\n    /**\n     * Find new selection index representing end of current word according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findWordBoundaryRight: function(startFrom) {\n      var offset = 0, index = startFrom;\n\n      // remove space after cursor first\n      if (this._reSpace.test(this._text[index])) {\n        while (this._reSpace.test(this._text[index])) {\n          offset++;\n          index++;\n        }\n      }\n      while (/\\S/.test(this._text[index]) && index < this._text.length) {\n        offset++;\n        index++;\n      }\n\n      return startFrom + offset;\n    },\n\n    /**\n     * Find new selection index representing start of current line according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findLineBoundaryLeft: function(startFrom) {\n      var offset = 0, index = startFrom - 1;\n\n      while (!/\\n/.test(this._text[index]) && index > -1) {\n        offset++;\n        index--;\n      }\n\n      return startFrom - offset;\n    },\n\n    /**\n     * Find new selection index representing end of current line according to current selection index\n     * @param {Number} startFrom Current selection index\n     * @return {Number} New selection index\n     */\n    findLineBoundaryRight: function(startFrom) {\n      var offset = 0, index = startFrom;\n\n      while (!/\\n/.test(this._text[index]) && index < this._text.length) {\n        offset++;\n        index++;\n      }\n\n      return startFrom + offset;\n    },\n\n    /**\n     * Finds index corresponding to beginning or end of a word\n     * @param {Number} selectionStart Index of a character\n     * @param {Number} direction 1 or -1\n     * @return {Number} Index of the beginning or end of a word\n     */\n    searchWordBoundary: function(selectionStart, direction) {\n      var text = this._text,\n          index     = this._reSpace.test(text[selectionStart]) ? selectionStart - 1 : selectionStart,\n          _char     = text[index],\n          // wrong\n          reNonWord = fabric.reNonWord;\n\n      while (!reNonWord.test(_char) && index > 0 && index < text.length) {\n        index += direction;\n        _char = text[index];\n      }\n      if (reNonWord.test(_char)) {\n        index += direction === 1 ? 0 : 1;\n      }\n      return index;\n    },\n\n    /**\n     * Selects a word based on the index\n     * @param {Number} selectionStart Index of a character\n     */\n    selectWord: function(selectionStart) {\n      selectionStart = selectionStart || this.selectionStart;\n      var newSelectionStart = this.searchWordBoundary(selectionStart, -1), /* search backwards */\n          newSelectionEnd = this.searchWordBoundary(selectionStart, 1); /* search forward */\n\n      this.selectionStart = newSelectionStart;\n      this.selectionEnd = newSelectionEnd;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n      this.renderCursorOrSelection();\n    },\n\n    /**\n     * Selects a line based on the index\n     * @param {Number} selectionStart Index of a character\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    selectLine: function(selectionStart) {\n      selectionStart = selectionStart || this.selectionStart;\n      var newSelectionStart = this.findLineBoundaryLeft(selectionStart),\n          newSelectionEnd = this.findLineBoundaryRight(selectionStart);\n\n      this.selectionStart = newSelectionStart;\n      this.selectionEnd = newSelectionEnd;\n      this._fireSelectionChanged();\n      this._updateTextarea();\n      return this;\n    },\n\n    /**\n     * Enters editing state\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    enterEditing: function(e) {\n      if (this.isEditing || !this.editable) {\n        return;\n      }\n\n      if (this.canvas) {\n        this.canvas.calcOffset();\n        this.exitEditingOnOthers(this.canvas);\n      }\n\n      this.isEditing = true;\n\n      this.initHiddenTextarea(e);\n      this.hiddenTextarea.focus();\n      this.hiddenTextarea.value = this.text;\n      this._updateTextarea();\n      this._saveEditingProps();\n      this._setEditingProps();\n      this._textBeforeEdit = this.text;\n\n      this._tick();\n      this.fire('editing:entered');\n      this._fireSelectionChanged();\n      if (!this.canvas) {\n        return this;\n      }\n      this.canvas.fire('text:editing:entered', { target: this });\n      this.initMouseMoveHandler();\n      this.canvas.requestRenderAll();\n      return this;\n    },\n\n    exitEditingOnOthers: function(canvas) {\n      if (canvas._iTextInstances) {\n        canvas._iTextInstances.forEach(function(obj) {\n          obj.selected = false;\n          if (obj.isEditing) {\n            obj.exitEditing();\n          }\n        });\n      }\n    },\n\n    /**\n     * Initializes \"mousemove\" event handler\n     */\n    initMouseMoveHandler: function() {\n      this.canvas.on('mouse:move', this.mouseMoveHandler);\n    },\n\n    /**\n     * @private\n     */\n    mouseMoveHandler: function(options) {\n      if (!this.__isMousedown || !this.isEditing) {\n        return;\n      }\n\n      // regain focus\n      document.activeElement !== this.hiddenTextarea && this.hiddenTextarea.focus();\n\n      var newSelectionStart = this.getSelectionStartFromPointer(options.e),\n          currentStart = this.selectionStart,\n          currentEnd = this.selectionEnd;\n      if (\n        (newSelectionStart !== this.__selectionStartOnMouseDown || currentStart === currentEnd)\n        &&\n        (currentStart === newSelectionStart || currentEnd === newSelectionStart)\n      ) {\n        return;\n      }\n      if (newSelectionStart > this.__selectionStartOnMouseDown) {\n        this.selectionStart = this.__selectionStartOnMouseDown;\n        this.selectionEnd = newSelectionStart;\n      }\n      else {\n        this.selectionStart = newSelectionStart;\n        this.selectionEnd = this.__selectionStartOnMouseDown;\n      }\n      if (this.selectionStart !== currentStart || this.selectionEnd !== currentEnd) {\n        this.restartCursorIfNeeded();\n        this._fireSelectionChanged();\n        this._updateTextarea();\n        this.renderCursorOrSelection();\n      }\n    },\n\n    /**\n     * @private\n     */\n    _setEditingProps: function() {\n      this.hoverCursor = 'text';\n\n      if (this.canvas) {\n        this.canvas.defaultCursor = this.canvas.moveCursor = 'text';\n      }\n\n      this.borderColor = this.editingBorderColor;\n      this.hasControls = this.selectable = false;\n      this.lockMovementX = this.lockMovementY = true;\n    },\n\n    /**\n     * convert from textarea to grapheme indexes\n     */\n    fromStringToGraphemeSelection: function(start, end, text) {\n      var smallerTextStart = text.slice(0, start),\n          graphemeStart = fabric.util.string.graphemeSplit(smallerTextStart).length;\n      if (start === end) {\n        return { selectionStart: graphemeStart, selectionEnd: graphemeStart };\n      }\n      var smallerTextEnd = text.slice(start, end),\n          graphemeEnd = fabric.util.string.graphemeSplit(smallerTextEnd).length;\n      return { selectionStart: graphemeStart, selectionEnd: graphemeStart + graphemeEnd };\n    },\n\n    /**\n     * convert from fabric to textarea values\n     */\n    fromGraphemeToStringSelection: function(start, end, _text) {\n      var smallerTextStart = _text.slice(0, start),\n          graphemeStart = smallerTextStart.join('').length;\n      if (start === end) {\n        return { selectionStart: graphemeStart, selectionEnd: graphemeStart };\n      }\n      var smallerTextEnd = _text.slice(start, end),\n          graphemeEnd = smallerTextEnd.join('').length;\n      return { selectionStart: graphemeStart, selectionEnd: graphemeStart + graphemeEnd };\n    },\n\n    /**\n     * @private\n     */\n    _updateTextarea: function() {\n      this.cursorOffsetCache = { };\n      if (!this.hiddenTextarea) {\n        return;\n      }\n      if (!this.inCompositionMode) {\n        var newSelection = this.fromGraphemeToStringSelection(this.selectionStart, this.selectionEnd, this._text);\n        this.hiddenTextarea.selectionStart = newSelection.selectionStart;\n        this.hiddenTextarea.selectionEnd = newSelection.selectionEnd;\n      }\n      this.updateTextareaPosition();\n    },\n\n    /**\n     * @private\n     */\n    updateFromTextArea: function() {\n      if (!this.hiddenTextarea) {\n        return;\n      }\n      this.cursorOffsetCache = { };\n      this.text = this.hiddenTextarea.value;\n      if (this._shouldClearDimensionCache()) {\n        this.initDimensions();\n        this.setCoords();\n      }\n      var newSelection = this.fromStringToGraphemeSelection(\n        this.hiddenTextarea.selectionStart, this.hiddenTextarea.selectionEnd, this.hiddenTextarea.value);\n      this.selectionEnd = this.selectionStart = newSelection.selectionEnd;\n      if (!this.inCompositionMode) {\n        this.selectionStart = newSelection.selectionStart;\n      }\n      this.updateTextareaPosition();\n    },\n\n    /**\n     * @private\n     */\n    updateTextareaPosition: function() {\n      if (this.selectionStart === this.selectionEnd) {\n        var style = this._calcTextareaPosition();\n        this.hiddenTextarea.style.left = style.left;\n        this.hiddenTextarea.style.top = style.top;\n      }\n    },\n\n    /**\n     * @private\n     * @return {Object} style contains style for hiddenTextarea\n     */\n    _calcTextareaPosition: function() {\n      if (!this.canvas) {\n        return { x: 1, y: 1 };\n      }\n      var desiredPosition = this.inCompositionMode ? this.compositionStart : this.selectionStart,\n          boundaries = this._getCursorBoundaries(desiredPosition),\n          cursorLocation = this.get2DCursorLocation(desiredPosition),\n          lineIndex = cursorLocation.lineIndex,\n          charIndex = cursorLocation.charIndex,\n          charHeight = this.getValueOfPropertyAt(lineIndex, charIndex, 'fontSize') * this.lineHeight,\n          leftOffset = boundaries.leftOffset,\n          m = this.calcTransformMatrix(),\n          p = {\n            x: boundaries.left + leftOffset,\n            y: boundaries.top + boundaries.topOffset + charHeight\n          },\n          retinaScaling = this.canvas.getRetinaScaling(),\n          upperCanvas = this.canvas.upperCanvasEl,\n          upperCanvasWidth = upperCanvas.width / retinaScaling,\n          upperCanvasHeight = upperCanvas.height / retinaScaling,\n          maxWidth = upperCanvasWidth - charHeight,\n          maxHeight = upperCanvasHeight - charHeight,\n          scaleX = upperCanvas.clientWidth / upperCanvasWidth,\n          scaleY = upperCanvas.clientHeight / upperCanvasHeight;\n\n      p = fabric.util.transformPoint(p, m);\n      p = fabric.util.transformPoint(p, this.canvas.viewportTransform);\n      p.x *= scaleX;\n      p.y *= scaleY;\n      if (p.x < 0) {\n        p.x = 0;\n      }\n      if (p.x > maxWidth) {\n        p.x = maxWidth;\n      }\n      if (p.y < 0) {\n        p.y = 0;\n      }\n      if (p.y > maxHeight) {\n        p.y = maxHeight;\n      }\n\n      // add canvas offset on document\n      p.x += this.canvas._offset.left;\n      p.y += this.canvas._offset.top;\n\n      return { left: p.x + 'px', top: p.y + 'px', fontSize: charHeight + 'px', charHeight: charHeight };\n    },\n\n    /**\n     * @private\n     */\n    _saveEditingProps: function() {\n      this._savedProps = {\n        hasControls: this.hasControls,\n        borderColor: this.borderColor,\n        lockMovementX: this.lockMovementX,\n        lockMovementY: this.lockMovementY,\n        hoverCursor: this.hoverCursor,\n        selectable: this.selectable,\n        defaultCursor: this.canvas && this.canvas.defaultCursor,\n        moveCursor: this.canvas && this.canvas.moveCursor\n      };\n    },\n\n    /**\n     * @private\n     */\n    _restoreEditingProps: function() {\n      if (!this._savedProps) {\n        return;\n      }\n\n      this.hoverCursor = this._savedProps.hoverCursor;\n      this.hasControls = this._savedProps.hasControls;\n      this.borderColor = this._savedProps.borderColor;\n      this.selectable = this._savedProps.selectable;\n      this.lockMovementX = this._savedProps.lockMovementX;\n      this.lockMovementY = this._savedProps.lockMovementY;\n\n      if (this.canvas) {\n        this.canvas.defaultCursor = this._savedProps.defaultCursor;\n        this.canvas.moveCursor = this._savedProps.moveCursor;\n      }\n    },\n\n    /**\n     * Exits from editing state\n     * @return {fabric.IText} thisArg\n     * @chainable\n     */\n    exitEditing: function() {\n      var isTextChanged = (this._textBeforeEdit !== this.text);\n      var hiddenTextarea = this.hiddenTextarea;\n      this.selected = false;\n      this.isEditing = false;\n\n      this.selectionEnd = this.selectionStart;\n\n      if (hiddenTextarea) {\n        hiddenTextarea.blur && hiddenTextarea.blur();\n        hiddenTextarea.parentNode && hiddenTextarea.parentNode.removeChild(hiddenTextarea);\n      }\n      this.hiddenTextarea = null;\n      this.abortCursorAnimation();\n      this._restoreEditingProps();\n      this._currentCursorOpacity = 0;\n      if (this._shouldClearDimensionCache()) {\n        this.initDimensions();\n        this.setCoords();\n      }\n      this.fire('editing:exited');\n      isTextChanged && this.fire('modified');\n      if (this.canvas) {\n        this.canvas.off('mouse:move', this.mouseMoveHandler);\n        this.canvas.fire('text:editing:exited', { target: this });\n        isTextChanged && this.canvas.fire('object:modified', { target: this });\n      }\n      return this;\n    },\n\n    /**\n     * @private\n     */\n    _removeExtraneousStyles: function() {\n      for (var prop in this.styles) {\n        if (!this._textLines[prop]) {\n          delete this.styles[prop];\n        }\n      }\n    },\n\n    /**\n     * remove and reflow a style block from start to end.\n     * @param {Number} start linear start position for removal (included in removal)\n     * @param {Number} end linear end position for removal ( excluded from removal )\n     */\n    removeStyleFromTo: function(start, end) {\n      var cursorStart = this.get2DCursorLocation(start, true),\n          cursorEnd = this.get2DCursorLocation(end, true),\n          lineStart = cursorStart.lineIndex,\n          charStart = cursorStart.charIndex,\n          lineEnd = cursorEnd.lineIndex,\n          charEnd = cursorEnd.charIndex,\n          i, styleObj;\n      if (lineStart !== lineEnd) {\n        // step1 remove the trailing of lineStart\n        if (this.styles[lineStart]) {\n          for (i = charStart; i < this._unwrappedTextLines[lineStart].length; i++) {\n            delete this.styles[lineStart][i];\n          }\n        }\n        // step2 move the trailing of lineEnd to lineStart if needed\n        if (this.styles[lineEnd]) {\n          for (i = charEnd; i < this._unwrappedTextLines[lineEnd].length; i++) {\n            styleObj = this.styles[lineEnd][i];\n            if (styleObj) {\n              this.styles[lineStart] || (this.styles[lineStart] = { });\n              this.styles[lineStart][charStart + i - charEnd] = styleObj;\n            }\n          }\n        }\n        // step3 detects lines will be completely removed.\n        for (i = lineStart + 1; i <= lineEnd; i++) {\n          delete this.styles[i];\n        }\n        // step4 shift remaining lines.\n        this.shiftLineStyles(lineEnd, lineStart - lineEnd);\n      }\n      else {\n        // remove and shift left on the same line\n        if (this.styles[lineStart]) {\n          styleObj = this.styles[lineStart];\n          var diff = charEnd - charStart, numericChar, _char;\n          for (i = charStart; i < charEnd; i++) {\n            delete styleObj[i];\n          }\n          for (_char in this.styles[lineStart]) {\n            numericChar = parseInt(_char, 10);\n            if (numericChar >= charEnd) {\n              styleObj[numericChar - diff] = styleObj[_char];\n              delete styleObj[_char];\n            }\n          }\n        }\n      }\n    },\n\n    /**\n     * Shifts line styles up or down\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} offset Can any number?\n     */\n    shiftLineStyles: function(lineIndex, offset) {\n      // shift all line styles by offset upward or downward\n      // do not clone deep. we need new array, not new style objects\n      var clonedStyles = clone(this.styles);\n      for (var line in this.styles) {\n        var numericLine = parseInt(line, 10);\n        if (numericLine > lineIndex) {\n          this.styles[numericLine + offset] = clonedStyles[numericLine];\n          if (!clonedStyles[numericLine - offset]) {\n            delete this.styles[numericLine];\n          }\n        }\n      }\n    },\n\n    restartCursorIfNeeded: function() {\n      if (!this._currentTickState || this._currentTickState.isAborted\n        || !this._currentTickCompleteState || this._currentTickCompleteState.isAborted\n      ) {\n        this.initDelayedCursor();\n      }\n    },\n\n    /**\n     * Handle insertion of more consecutive style lines for when one or more\n     * newlines gets added to the text. Since current style needs to be shifted\n     * first we shift the current style of the number lines needed, then we add\n     * new lines from the last to the first.\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} charIndex Index of a char\n     * @param {Number} qty number of lines to add\n     * @param {Array} copiedStyle Array of objects styles\n     */\n    insertNewlineStyleObject: function(lineIndex, charIndex, qty, copiedStyle) {\n      var currentCharStyle,\n          newLineStyles = {},\n          somethingAdded = false,\n          isEndOfLine = this._unwrappedTextLines[lineIndex].length === charIndex;\n\n      qty || (qty = 1);\n      this.shiftLineStyles(lineIndex, qty);\n      if (this.styles[lineIndex]) {\n        currentCharStyle = this.styles[lineIndex][charIndex === 0 ? charIndex : charIndex - 1];\n      }\n      // we clone styles of all chars\n      // after cursor onto the current line\n      for (var index in this.styles[lineIndex]) {\n        var numIndex = parseInt(index, 10);\n        if (numIndex >= charIndex) {\n          somethingAdded = true;\n          newLineStyles[numIndex - charIndex] = this.styles[lineIndex][index];\n          // remove lines from the previous line since they're on a new line now\n          if (!(isEndOfLine && charIndex === 0)) {\n            delete this.styles[lineIndex][index];\n          }\n        }\n      }\n      var styleCarriedOver = false;\n      if (somethingAdded && !isEndOfLine) {\n        // if is end of line, the extra style we copied\n        // is probably not something we want\n        this.styles[lineIndex + qty] = newLineStyles;\n        styleCarriedOver = true;\n      }\n      if (styleCarriedOver) {\n        // skip the last line of since we already prepared it.\n        qty--;\n      }\n      // for the all the lines or all the other lines\n      // we clone current char style onto the next (otherwise empty) line\n      while (qty > 0) {\n        if (copiedStyle && copiedStyle[qty - 1]) {\n          this.styles[lineIndex + qty] = { 0: clone(copiedStyle[qty - 1]) };\n        }\n        else if (currentCharStyle) {\n          this.styles[lineIndex + qty] = { 0: clone(currentCharStyle) };\n        }\n        else {\n          delete this.styles[lineIndex + qty];\n        }\n        qty--;\n      }\n      this._forceClearCache = true;\n    },\n\n    /**\n     * Inserts style object for a given line/char index\n     * @param {Number} lineIndex Index of a line\n     * @param {Number} charIndex Index of a char\n     * @param {Number} quantity number Style object to insert, if given\n     * @param {Array} copiedStyle array of style objects\n     */\n    insertCharStyleObject: function(lineIndex, charIndex, quantity, copiedStyle) {\n      if (!this.styles) {\n        this.styles = {};\n      }\n      var currentLineStyles       = this.styles[lineIndex],\n          currentLineStylesCloned = currentLineStyles ? clone(currentLineStyles) : {};\n\n      quantity || (quantity = 1);\n      // shift all char styles by quantity forward\n      // 0,1,2,3 -> (charIndex=2) -> 0,1,3,4 -> (insert 2) -> 0,1,2,3,4\n      for (var index in currentLineStylesCloned) {\n        var numericIndex = parseInt(index, 10);\n        if (numericIndex >= charIndex) {\n          currentLineStyles[numericIndex + quantity] = currentLineStylesCloned[numericIndex];\n          // only delete the style if there was nothing moved there\n          if (!currentLineStylesCloned[numericIndex - quantity]) {\n            delete currentLineStyles[numericIndex];\n          }\n        }\n      }\n      this._forceClearCache = true;\n      if (copiedStyle) {\n        while (quantity--) {\n          if (!Object.keys(copiedStyle[quantity]).length) {\n            continue;\n          }\n          if (!this.styles[lineIndex]) {\n            this.styles[lineIndex] = {};\n          }\n          this.styles[lineIndex][charIndex + quantity] = clone(copiedStyle[quantity]);\n        }\n        return;\n      }\n      if (!currentLineStyles) {\n        return;\n      }\n      var newStyle = currentLineStyles[charIndex ? charIndex - 1 : 1];\n      while (newStyle && quantity--) {\n        this.styles[lineIndex][charIndex + quantity] = clone(newStyle);\n      }\n    },\n\n    /**\n     * Inserts style object(s)\n     * @param {Array} insertedText Characters at the location where style is inserted\n     * @param {Number} start cursor index for inserting style\n     * @param {Array} [copiedStyle] array of style objects to insert.\n     */\n    insertNewStyleBlock: function(insertedText, start, copiedStyle) {\n      var cursorLoc = this.get2DCursorLocation(start, true),\n          addedLines = [0], linesLength = 0;\n      // get an array of how many char per lines are being added.\n      for (var i = 0; i < insertedText.length; i++) {\n        if (insertedText[i] === '\\n') {\n          linesLength++;\n          addedLines[linesLength] = 0;\n        }\n        else {\n          addedLines[linesLength]++;\n        }\n      }\n      // for the first line copy the style from the current char position.\n      if (addedLines[0] > 0) {\n        this.insertCharStyleObject(cursorLoc.lineIndex, cursorLoc.charIndex, addedLines[0], copiedStyle);\n        copiedStyle = copiedStyle && copiedStyle.slice(addedLines[0] + 1);\n      }\n      linesLength && this.insertNewlineStyleObject(\n        cursorLoc.lineIndex, cursorLoc.charIndex + addedLines[0], linesLength);\n      for (var i = 1; i < linesLength; i++) {\n        if (addedLines[i] > 0) {\n          this.insertCharStyleObject(cursorLoc.lineIndex + i, 0, addedLines[i], copiedStyle);\n        }\n        else if (copiedStyle) {\n          // this test is required in order to close #6841\n          // when a pasted buffer begins with a newline then\n          // this.styles[cursorLoc.lineIndex + i] and copiedStyle[0]\n          // may be undefined for some reason\n          if (this.styles[cursorLoc.lineIndex + i] && copiedStyle[0]) {\n            this.styles[cursorLoc.lineIndex + i][0] = copiedStyle[0];\n          }\n        }\n        copiedStyle = copiedStyle && copiedStyle.slice(addedLines[i] + 1);\n      }\n      // we use i outside the loop to get it like linesLength\n      if (addedLines[i] > 0) {\n        this.insertCharStyleObject(cursorLoc.lineIndex + i, 0, addedLines[i], copiedStyle);\n      }\n    },\n\n    /**\n     * Set the selectionStart and selectionEnd according to the new position of cursor\n     * mimic the key - mouse navigation when shift is pressed.\n     */\n    setSelectionStartEndWithShift: function(start, end, newSelection) {\n      if (newSelection <= start) {\n        if (end === start) {\n          this._selectionDirection = 'left';\n        }\n        else if (this._selectionDirection === 'right') {\n          this._selectionDirection = 'left';\n          this.selectionEnd = start;\n        }\n        this.selectionStart = newSelection;\n      }\n      else if (newSelection > start && newSelection < end) {\n        if (this._selectionDirection === 'right') {\n          this.selectionEnd = newSelection;\n        }\n        else {\n          this.selectionStart = newSelection;\n        }\n      }\n      else {\n        // newSelection is > selection start and end\n        if (end === start) {\n          this._selectionDirection = 'right';\n        }\n        else if (this._selectionDirection === 'left') {\n          this._selectionDirection = 'right';\n          this.selectionStart = end;\n        }\n        this.selectionEnd = newSelection;\n      }\n    },\n\n    setSelectionInBoundaries: function() {\n      var length = this.text.length;\n      if (this.selectionStart > length) {\n        this.selectionStart = length;\n      }\n      else if (this.selectionStart < 0) {\n        this.selectionStart = 0;\n      }\n      if (this.selectionEnd > length) {\n        this.selectionEnd = length;\n      }\n      else if (this.selectionEnd < 0) {\n        this.selectionEnd = 0;\n      }\n    }\n  });\n})();\n\n\nfabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n  /**\n   * Initializes \"dbclick\" event handler\n   */\n  initDoubleClickSimulation: function() {\n\n    // for double click\n    this.__lastClickTime = +new Date();\n\n    // for triple click\n    this.__lastLastClickTime = +new Date();\n\n    this.__lastPointer = { };\n\n    this.on('mousedown', this.onMouseDown);\n  },\n\n  /**\n   * Default event handler to simulate triple click\n   * @private\n   */\n  onMouseDown: function(options) {\n    if (!this.canvas) {\n      return;\n    }\n    this.__newClickTime = +new Date();\n    var newPointer = options.pointer;\n    if (this.isTripleClick(newPointer)) {\n      this.fire('tripleclick', options);\n      this._stopEvent(options.e);\n    }\n    this.__lastLastClickTime = this.__lastClickTime;\n    this.__lastClickTime = this.__newClickTime;\n    this.__lastPointer = newPointer;\n    this.__lastIsEditing = this.isEditing;\n    this.__lastSelected = this.selected;\n  },\n\n  isTripleClick: function(newPointer) {\n    return this.__newClickTime - this.__lastClickTime < 500 &&\n        this.__lastClickTime - this.__lastLastClickTime < 500 &&\n        this.__lastPointer.x === newPointer.x &&\n        this.__lastPointer.y === newPointer.y;\n  },\n\n  /**\n   * @private\n   */\n  _stopEvent: function(e) {\n    e.preventDefault && e.preventDefault();\n    e.stopPropagation && e.stopPropagation();\n  },\n\n  /**\n   * Initializes event handlers related to cursor or selection\n   */\n  initCursorSelectionHandlers: function() {\n    this.initMousedownHandler();\n    this.initMouseupHandler();\n    this.initClicks();\n  },\n\n  /**\n   * Default handler for double click, select a word\n   */\n  doubleClickHandler: function(options) {\n    if (!this.isEditing) {\n      return;\n    }\n    this.selectWord(this.getSelectionStartFromPointer(options.e));\n  },\n\n  /**\n   * Default handler for triple click, select a line\n   */\n  tripleClickHandler: function(options) {\n    if (!this.isEditing) {\n      return;\n    }\n    this.selectLine(this.getSelectionStartFromPointer(options.e));\n  },\n\n  /**\n   * Initializes double and triple click event handlers\n   */\n  initClicks: function() {\n    this.on('mousedblclick', this.doubleClickHandler);\n    this.on('tripleclick', this.tripleClickHandler);\n  },\n\n  /**\n   * Default event handler for the basic functionalities needed on _mouseDown\n   * can be overridden to do something different.\n   * Scope of this implementation is: find the click position, set selectionStart\n   * find selectionEnd, initialize the drawing of either cursor or selection area\n   * initializing a mousedDown on a text area will cancel fabricjs knowledge of\n   * current compositionMode. It will be set to false.\n   */\n  _mouseDownHandler: function(options) {\n    if (!this.canvas || !this.editable || (options.e.button && options.e.button !== 1)) {\n      return;\n    }\n\n    this.__isMousedown = true;\n\n    if (this.selected) {\n      this.inCompositionMode = false;\n      this.setCursorByClick(options.e);\n    }\n\n    if (this.isEditing) {\n      this.__selectionStartOnMouseDown = this.selectionStart;\n      if (this.selectionStart === this.selectionEnd) {\n        this.abortCursorAnimation();\n      }\n      this.renderCursorOrSelection();\n    }\n  },\n\n  /**\n   * Default event handler for the basic functionalities needed on mousedown:before\n   * can be overridden to do something different.\n   * Scope of this implementation is: verify the object is already selected when mousing down\n   */\n  _mouseDownHandlerBefore: function(options) {\n    if (!this.canvas || !this.editable || (options.e.button && options.e.button !== 1)) {\n      return;\n    }\n    // we want to avoid that an object that was selected and then becomes unselectable,\n    // may trigger editing mode in some way.\n    this.selected = this === this.canvas._activeObject;\n  },\n\n  /**\n   * Initializes \"mousedown\" event handler\n   */\n  initMousedownHandler: function() {\n    this.on('mousedown', this._mouseDownHandler);\n    this.on('mousedown:before', this._mouseDownHandlerBefore);\n  },\n\n  /**\n   * Initializes \"mouseup\" event handler\n   */\n  initMouseupHandler: function() {\n    this.on('mouseup', this.mouseUpHandler);\n  },\n\n  /**\n   * standard handler for mouse up, overridable\n   * @private\n   */\n  mouseUpHandler: function(options) {\n    this.__isMousedown = false;\n    if (!this.editable || this.group ||\n      (options.transform && options.transform.actionPerformed) ||\n      (options.e.button && options.e.button !== 1)) {\n      return;\n    }\n\n    if (this.canvas) {\n      var currentActive = this.canvas._activeObject;\n      if (currentActive && currentActive !== this) {\n        // avoid running this logic when there is an active object\n        // this because is possible with shift click and fast clicks,\n        // to rapidly deselect and reselect this object and trigger an enterEdit\n        return;\n      }\n    }\n\n    if (this.__lastSelected && !this.__corner) {\n      this.selected = false;\n      this.__lastSelected = false;\n      this.enterEditing(options.e);\n      if (this.selectionStart === this.selectionEnd) {\n        this.initDelayedCursor(true);\n      }\n      else {\n        this.renderCursorOrSelection();\n      }\n    }\n    else {\n      this.selected = true;\n    }\n  },\n\n  /**\n   * Changes cursor location in a text depending on passed pointer (x/y) object\n   * @param {Event} e Event object\n   */\n  setCursorByClick: function(e) {\n    var newSelection = this.getSelectionStartFromPointer(e),\n        start = this.selectionStart, end = this.selectionEnd;\n    if (e.shiftKey) {\n      this.setSelectionStartEndWithShift(start, end, newSelection);\n    }\n    else {\n      this.selectionStart = newSelection;\n      this.selectionEnd = newSelection;\n    }\n    if (this.isEditing) {\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Returns index of a character corresponding to where an object was clicked\n   * @param {Event} e Event object\n   * @return {Number} Index of a character\n   */\n  getSelectionStartFromPointer: function(e) {\n    var mouseOffset = this.getLocalPointer(e),\n        prevWidth = 0,\n        width = 0,\n        height = 0,\n        charIndex = 0,\n        lineIndex = 0,\n        lineLeftOffset,\n        line;\n    for (var i = 0, len = this._textLines.length; i < len; i++) {\n      if (height <= mouseOffset.y) {\n        height += this.getHeightOfLine(i) * this.scaleY;\n        lineIndex = i;\n        if (i > 0) {\n          charIndex += this._textLines[i - 1].length + this.missingNewlineOffset(i - 1);\n        }\n      }\n      else {\n        break;\n      }\n    }\n    lineLeftOffset = this._getLineLeftOffset(lineIndex);\n    width = lineLeftOffset * this.scaleX;\n    line = this._textLines[lineIndex];\n    // handling of RTL: in order to get things work correctly,\n    // we assume RTL writing is mirrored compared to LTR writing.\n    // so in position detection we mirror the X offset, and when is time\n    // of rendering it, we mirror it again.\n    if (this.direction === 'rtl') {\n      mouseOffset.x = this.width * this.scaleX - mouseOffset.x + width;\n    }\n    for (var j = 0, jlen = line.length; j < jlen; j++) {\n      prevWidth = width;\n      // i removed something about flipX here, check.\n      width += this.__charBounds[lineIndex][j].kernedWidth * this.scaleX;\n      if (width <= mouseOffset.x) {\n        charIndex++;\n      }\n      else {\n        break;\n      }\n    }\n    return this._getNewSelectionStartFromOffset(mouseOffset, prevWidth, width, charIndex, jlen);\n  },\n\n  /**\n   * @private\n   */\n  _getNewSelectionStartFromOffset: function(mouseOffset, prevWidth, width, index, jlen) {\n    // we need Math.abs because when width is after the last char, the offset is given as 1, while is 0\n    var distanceBtwLastCharAndCursor = mouseOffset.x - prevWidth,\n        distanceBtwNextCharAndCursor = width - mouseOffset.x,\n        offset = distanceBtwNextCharAndCursor > distanceBtwLastCharAndCursor ||\n          distanceBtwNextCharAndCursor < 0 ? 0 : 1,\n        newSelectionStart = index + offset;\n    // if object is horizontally flipped, mirror cursor location from the end\n    if (this.flipX) {\n      newSelectionStart = jlen - newSelectionStart;\n    }\n\n    if (newSelectionStart > this._text.length) {\n      newSelectionStart = this._text.length;\n    }\n\n    return newSelectionStart;\n  }\n});\n\n\nfabric.util.object.extend(fabric.IText.prototype, /** @lends fabric.IText.prototype */ {\n\n  /**\n   * Initializes hidden textarea (needed to bring up keyboard in iOS)\n   */\n  initHiddenTextarea: function() {\n    this.hiddenTextarea = fabric.document.createElement('textarea');\n    this.hiddenTextarea.setAttribute('autocapitalize', 'off');\n    this.hiddenTextarea.setAttribute('autocorrect', 'off');\n    this.hiddenTextarea.setAttribute('autocomplete', 'off');\n    this.hiddenTextarea.setAttribute('spellcheck', 'false');\n    this.hiddenTextarea.setAttribute('data-fabric-hiddentextarea', '');\n    this.hiddenTextarea.setAttribute('wrap', 'off');\n    var style = this._calcTextareaPosition();\n    // line-height: 1px; was removed from the style to fix this:\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=870966\n    this.hiddenTextarea.style.cssText = 'position: absolute; top: ' + style.top +\n    '; left: ' + style.left + '; z-index: -999; opacity: 0; width: 1px; height: 1px; font-size: 1px;' +\n    ' padding-top: ' + style.fontSize + ';';\n\n    if (this.hiddenTextareaContainer) {\n      this.hiddenTextareaContainer.appendChild(this.hiddenTextarea);\n    }\n    else {\n      fabric.document.body.appendChild(this.hiddenTextarea);\n    }\n\n    fabric.util.addListener(this.hiddenTextarea, 'keydown', this.onKeyDown.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'keyup', this.onKeyUp.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'input', this.onInput.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'copy', this.copy.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'cut', this.copy.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'paste', this.paste.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionstart', this.onCompositionStart.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionupdate', this.onCompositionUpdate.bind(this));\n    fabric.util.addListener(this.hiddenTextarea, 'compositionend', this.onCompositionEnd.bind(this));\n\n    if (!this._clickHandlerInitialized && this.canvas) {\n      fabric.util.addListener(this.canvas.upperCanvasEl, 'click', this.onClick.bind(this));\n      this._clickHandlerInitialized = true;\n    }\n  },\n\n  /**\n   * For functionalities on keyDown\n   * Map a special key to a function of the instance/prototype\n   * If you need different behaviour for ESC or TAB or arrows, you have to change\n   * this map setting the name of a function that you build on the fabric.Itext or\n   * your prototype.\n   * the map change will affect all Instances unless you need for only some text Instances\n   * in that case you have to clone this object and assign your Instance.\n   * this.keysMap = fabric.util.object.clone(this.keysMap);\n   * The function must be in fabric.Itext.prototype.myFunction And will receive event as args[0]\n   */\n  keysMap: {\n    9:  'exitEditing',\n    27: 'exitEditing',\n    33: 'moveCursorUp',\n    34: 'moveCursorDown',\n    35: 'moveCursorRight',\n    36: 'moveCursorLeft',\n    37: 'moveCursorLeft',\n    38: 'moveCursorUp',\n    39: 'moveCursorRight',\n    40: 'moveCursorDown',\n  },\n\n  keysMapRtl: {\n    9:  'exitEditing',\n    27: 'exitEditing',\n    33: 'moveCursorUp',\n    34: 'moveCursorDown',\n    35: 'moveCursorLeft',\n    36: 'moveCursorRight',\n    37: 'moveCursorRight',\n    38: 'moveCursorUp',\n    39: 'moveCursorLeft',\n    40: 'moveCursorDown',\n  },\n\n  /**\n   * For functionalities on keyUp + ctrl || cmd\n   */\n  ctrlKeysMapUp: {\n    67: 'copy',\n    88: 'cut'\n  },\n\n  /**\n   * For functionalities on keyDown + ctrl || cmd\n   */\n  ctrlKeysMapDown: {\n    65: 'selectAll'\n  },\n\n  onClick: function() {\n    // No need to trigger click event here, focus is enough to have the keyboard appear on Android\n    this.hiddenTextarea && this.hiddenTextarea.focus();\n  },\n\n  /**\n   * Handles keydown event\n   * only used for arrows and combination of modifier keys.\n   * @param {Event} e Event object\n   */\n  onKeyDown: function(e) {\n    if (!this.isEditing) {\n      return;\n    }\n    var keyMap = this.direction === 'rtl' ? this.keysMapRtl : this.keysMap;\n    if (e.keyCode in keyMap) {\n      this[keyMap[e.keyCode]](e);\n    }\n    else if ((e.keyCode in this.ctrlKeysMapDown) && (e.ctrlKey || e.metaKey)) {\n      this[this.ctrlKeysMapDown[e.keyCode]](e);\n    }\n    else {\n      return;\n    }\n    e.stopImmediatePropagation();\n    e.preventDefault();\n    if (e.keyCode >= 33 && e.keyCode <= 40) {\n      // if i press an arrow key just update selection\n      this.inCompositionMode = false;\n      this.clearContextTop();\n      this.renderCursorOrSelection();\n    }\n    else {\n      this.canvas && this.canvas.requestRenderAll();\n    }\n  },\n\n  /**\n   * Handles keyup event\n   * We handle KeyUp because ie11 and edge have difficulties copy/pasting\n   * if a copy/cut event fired, keyup is dismissed\n   * @param {Event} e Event object\n   */\n  onKeyUp: function(e) {\n    if (!this.isEditing || this._copyDone || this.inCompositionMode) {\n      this._copyDone = false;\n      return;\n    }\n    if ((e.keyCode in this.ctrlKeysMapUp) && (e.ctrlKey || e.metaKey)) {\n      this[this.ctrlKeysMapUp[e.keyCode]](e);\n    }\n    else {\n      return;\n    }\n    e.stopImmediatePropagation();\n    e.preventDefault();\n    this.canvas && this.canvas.requestRenderAll();\n  },\n\n  /**\n   * Handles onInput event\n   * @param {Event} e Event object\n   */\n  onInput: function(e) {\n    var fromPaste = this.fromPaste;\n    this.fromPaste = false;\n    e && e.stopPropagation();\n    if (!this.isEditing) {\n      return;\n    }\n    // decisions about style changes.\n    var nextText = this._splitTextIntoLines(this.hiddenTextarea.value).graphemeText,\n        charCount = this._text.length,\n        nextCharCount = nextText.length,\n        removedText, insertedText,\n        charDiff = nextCharCount - charCount,\n        selectionStart = this.selectionStart, selectionEnd = this.selectionEnd,\n        selection = selectionStart !== selectionEnd,\n        copiedStyle, removeFrom, removeTo;\n    if (this.hiddenTextarea.value === '') {\n      this.styles = { };\n      this.updateFromTextArea();\n      this.fire('changed');\n      if (this.canvas) {\n        this.canvas.fire('text:changed', { target: this });\n        this.canvas.requestRenderAll();\n      }\n      return;\n    }\n\n    var textareaSelection = this.fromStringToGraphemeSelection(\n      this.hiddenTextarea.selectionStart,\n      this.hiddenTextarea.selectionEnd,\n      this.hiddenTextarea.value\n    );\n    var backDelete = selectionStart > textareaSelection.selectionStart;\n\n    if (selection) {\n      removedText = this._text.slice(selectionStart, selectionEnd);\n      charDiff += selectionEnd - selectionStart;\n    }\n    else if (nextCharCount < charCount) {\n      if (backDelete) {\n        removedText = this._text.slice(selectionEnd + charDiff, selectionEnd);\n      }\n      else {\n        removedText = this._text.slice(selectionStart, selectionStart - charDiff);\n      }\n    }\n    insertedText = nextText.slice(textareaSelection.selectionEnd - charDiff, textareaSelection.selectionEnd);\n    if (removedText && removedText.length) {\n      if (insertedText.length) {\n        // let's copy some style before deleting.\n        // we want to copy the style before the cursor OR the style at the cursor if selection\n        // is bigger than 0.\n        copiedStyle = this.getSelectionStyles(selectionStart, selectionStart + 1, false);\n        // now duplicate the style one for each inserted text.\n        copiedStyle = insertedText.map(function() {\n          // this return an array of references, but that is fine since we are\n          // copying the style later.\n          return copiedStyle[0];\n        });\n      }\n      if (selection) {\n        removeFrom = selectionStart;\n        removeTo = selectionEnd;\n      }\n      else if (backDelete) {\n        // detect differences between forwardDelete and backDelete\n        removeFrom = selectionEnd - removedText.length;\n        removeTo = selectionEnd;\n      }\n      else {\n        removeFrom = selectionEnd;\n        removeTo = selectionEnd + removedText.length;\n      }\n      this.removeStyleFromTo(removeFrom, removeTo);\n    }\n    if (insertedText.length) {\n      if (fromPaste && insertedText.join('') === fabric.copiedText && !fabric.disableStyleCopyPaste) {\n        copiedStyle = fabric.copiedTextStyle;\n      }\n      this.insertNewStyleBlock(insertedText, selectionStart, copiedStyle);\n    }\n    this.updateFromTextArea();\n    this.fire('changed');\n    if (this.canvas) {\n      this.canvas.fire('text:changed', { target: this });\n      this.canvas.requestRenderAll();\n    }\n  },\n  /**\n   * Composition start\n   */\n  onCompositionStart: function() {\n    this.inCompositionMode = true;\n  },\n\n  /**\n   * Composition end\n   */\n  onCompositionEnd: function() {\n    this.inCompositionMode = false;\n  },\n\n  // /**\n  //  * Composition update\n  //  */\n  onCompositionUpdate: function(e) {\n    this.compositionStart = e.target.selectionStart;\n    this.compositionEnd = e.target.selectionEnd;\n    this.updateTextareaPosition();\n  },\n\n  /**\n   * Copies selected text\n   * @param {Event} e Event object\n   */\n  copy: function() {\n    if (this.selectionStart === this.selectionEnd) {\n      //do not cut-copy if no selection\n      return;\n    }\n\n    fabric.copiedText = this.getSelectedText();\n    if (!fabric.disableStyleCopyPaste) {\n      fabric.copiedTextStyle = this.getSelectionStyles(this.selectionStart, this.selectionEnd, true);\n    }\n    else {\n      fabric.copiedTextStyle = null;\n    }\n    this._copyDone = true;\n  },\n\n  /**\n   * Pastes text\n   * @param {Event} e Event object\n   */\n  paste: function() {\n    this.fromPaste = true;\n  },\n\n  /**\n   * @private\n   * @param {Event} e Event object\n   * @return {Object} Clipboard data object\n   */\n  _getClipboardData: function(e) {\n    return (e && e.clipboardData) || fabric.window.clipboardData;\n  },\n\n  /**\n   * Finds the width in pixels before the cursor on the same line\n   * @private\n   * @param {Number} lineIndex\n   * @param {Number} charIndex\n   * @return {Number} widthBeforeCursor width before cursor\n   */\n  _getWidthBeforeCursor: function(lineIndex, charIndex) {\n    var widthBeforeCursor = this._getLineLeftOffset(lineIndex), bound;\n\n    if (charIndex > 0) {\n      bound = this.__charBounds[lineIndex][charIndex - 1];\n      widthBeforeCursor += bound.left + bound.width;\n    }\n    return widthBeforeCursor;\n  },\n\n  /**\n   * Gets start offset of a selection\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  getDownCursorOffset: function(e, isRight) {\n    var selectionProp = this._getSelectionForOffset(e, isRight),\n        cursorLocation = this.get2DCursorLocation(selectionProp),\n        lineIndex = cursorLocation.lineIndex;\n    // if on last line, down cursor goes to end of line\n    if (lineIndex === this._textLines.length - 1 || e.metaKey || e.keyCode === 34) {\n      // move to the end of a text\n      return this._text.length - selectionProp;\n    }\n    var charIndex = cursorLocation.charIndex,\n        widthBeforeCursor = this._getWidthBeforeCursor(lineIndex, charIndex),\n        indexOnOtherLine = this._getIndexOnLine(lineIndex + 1, widthBeforeCursor),\n        textAfterCursor = this._textLines[lineIndex].slice(charIndex);\n    return textAfterCursor.length + indexOnOtherLine + 1 + this.missingNewlineOffset(lineIndex);\n  },\n\n  /**\n   * private\n   * Helps finding if the offset should be counted from Start or End\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  _getSelectionForOffset: function(e, isRight) {\n    if (e.shiftKey && this.selectionStart !== this.selectionEnd && isRight) {\n      return this.selectionEnd;\n    }\n    else {\n      return this.selectionStart;\n    }\n  },\n\n  /**\n   * @param {Event} e Event object\n   * @param {Boolean} isRight\n   * @return {Number}\n   */\n  getUpCursorOffset: function(e, isRight) {\n    var selectionProp = this._getSelectionForOffset(e, isRight),\n        cursorLocation = this.get2DCursorLocation(selectionProp),\n        lineIndex = cursorLocation.lineIndex;\n    if (lineIndex === 0 || e.metaKey || e.keyCode === 33) {\n      // if on first line, up cursor goes to start of line\n      return -selectionProp;\n    }\n    var charIndex = cursorLocation.charIndex,\n        widthBeforeCursor = this._getWidthBeforeCursor(lineIndex, charIndex),\n        indexOnOtherLine = this._getIndexOnLine(lineIndex - 1, widthBeforeCursor),\n        textBeforeCursor = this._textLines[lineIndex].slice(0, charIndex),\n        missingNewlineOffset = this.missingNewlineOffset(lineIndex - 1);\n    // return a negative offset\n    return -this._textLines[lineIndex - 1].length\n     + indexOnOtherLine - textBeforeCursor.length + (1 - missingNewlineOffset);\n  },\n\n  /**\n   * for a given width it founds the matching character.\n   * @private\n   */\n  _getIndexOnLine: function(lineIndex, width) {\n\n    var line = this._textLines[lineIndex],\n        lineLeftOffset = this._getLineLeftOffset(lineIndex),\n        widthOfCharsOnLine = lineLeftOffset,\n        indexOnLine = 0, charWidth, foundMatch;\n\n    for (var j = 0, jlen = line.length; j < jlen; j++) {\n      charWidth = this.__charBounds[lineIndex][j].width;\n      widthOfCharsOnLine += charWidth;\n      if (widthOfCharsOnLine > width) {\n        foundMatch = true;\n        var leftEdge = widthOfCharsOnLine - charWidth,\n            rightEdge = widthOfCharsOnLine,\n            offsetFromLeftEdge = Math.abs(leftEdge - width),\n            offsetFromRightEdge = Math.abs(rightEdge - width);\n\n        indexOnLine = offsetFromRightEdge < offsetFromLeftEdge ? j : (j - 1);\n        break;\n      }\n    }\n\n    // reached end\n    if (!foundMatch) {\n      indexOnLine = line.length - 1;\n    }\n\n    return indexOnLine;\n  },\n\n\n  /**\n   * Moves cursor down\n   * @param {Event} e Event object\n   */\n  moveCursorDown: function(e) {\n    if (this.selectionStart >= this._text.length && this.selectionEnd >= this._text.length) {\n      return;\n    }\n    this._moveCursorUpOrDown('Down', e);\n  },\n\n  /**\n   * Moves cursor up\n   * @param {Event} e Event object\n   */\n  moveCursorUp: function(e) {\n    if (this.selectionStart === 0 && this.selectionEnd === 0) {\n      return;\n    }\n    this._moveCursorUpOrDown('Up', e);\n  },\n\n  /**\n   * Moves cursor up or down, fires the events\n   * @param {String} direction 'Up' or 'Down'\n   * @param {Event} e Event object\n   */\n  _moveCursorUpOrDown: function(direction, e) {\n    // getUpCursorOffset\n    // getDownCursorOffset\n    var action = 'get' + direction + 'CursorOffset',\n        offset = this[action](e, this._selectionDirection === 'right');\n    if (e.shiftKey) {\n      this.moveCursorWithShift(offset);\n    }\n    else {\n      this.moveCursorWithoutShift(offset);\n    }\n    if (offset !== 0) {\n      this.setSelectionInBoundaries();\n      this.abortCursorAnimation();\n      this._currentCursorOpacity = 1;\n      this.initDelayedCursor();\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Moves cursor with shift\n   * @param {Number} offset\n   */\n  moveCursorWithShift: function(offset) {\n    var newSelection = this._selectionDirection === 'left'\n      ? this.selectionStart + offset\n      : this.selectionEnd + offset;\n    this.setSelectionStartEndWithShift(this.selectionStart, this.selectionEnd, newSelection);\n    return offset !== 0;\n  },\n\n  /**\n   * Moves cursor up without shift\n   * @param {Number} offset\n   */\n  moveCursorWithoutShift: function(offset) {\n    if (offset < 0) {\n      this.selectionStart += offset;\n      this.selectionEnd = this.selectionStart;\n    }\n    else {\n      this.selectionEnd += offset;\n      this.selectionStart = this.selectionEnd;\n    }\n    return offset !== 0;\n  },\n\n  /**\n   * Moves cursor left\n   * @param {Event} e Event object\n   */\n  moveCursorLeft: function(e) {\n    if (this.selectionStart === 0 && this.selectionEnd === 0) {\n      return;\n    }\n    this._moveCursorLeftOrRight('Left', e);\n  },\n\n  /**\n   * @private\n   * @return {Boolean} true if a change happened\n   */\n  _move: function(e, prop, direction) {\n    var newValue;\n    if (e.altKey) {\n      newValue = this['findWordBoundary' + direction](this[prop]);\n    }\n    else if (e.metaKey || e.keyCode === 35 ||  e.keyCode === 36 ) {\n      newValue = this['findLineBoundary' + direction](this[prop]);\n    }\n    else {\n      this[prop] += direction === 'Left' ? -1 : 1;\n      return true;\n    }\n    if (typeof newValue !== 'undefined' && this[prop] !== newValue) {\n      this[prop] = newValue;\n      return true;\n    }\n  },\n\n  /**\n   * @private\n   */\n  _moveLeft: function(e, prop) {\n    return this._move(e, prop, 'Left');\n  },\n\n  /**\n   * @private\n   */\n  _moveRight: function(e, prop) {\n    return this._move(e, prop, 'Right');\n  },\n\n  /**\n   * Moves cursor left without keeping selection\n   * @param {Event} e\n   */\n  moveCursorLeftWithoutShift: function(e) {\n    var change = true;\n    this._selectionDirection = 'left';\n\n    // only move cursor when there is no selection,\n    // otherwise we discard it, and leave cursor on same place\n    if (this.selectionEnd === this.selectionStart && this.selectionStart !== 0) {\n      change = this._moveLeft(e, 'selectionStart');\n\n    }\n    this.selectionEnd = this.selectionStart;\n    return change;\n  },\n\n  /**\n   * Moves cursor left while keeping selection\n   * @param {Event} e\n   */\n  moveCursorLeftWithShift: function(e) {\n    if (this._selectionDirection === 'right' && this.selectionStart !== this.selectionEnd) {\n      return this._moveLeft(e, 'selectionEnd');\n    }\n    else if (this.selectionStart !== 0){\n      this._selectionDirection = 'left';\n      return this._moveLeft(e, 'selectionStart');\n    }\n  },\n\n  /**\n   * Moves cursor right\n   * @param {Event} e Event object\n   */\n  moveCursorRight: function(e) {\n    if (this.selectionStart >= this._text.length && this.selectionEnd >= this._text.length) {\n      return;\n    }\n    this._moveCursorLeftOrRight('Right', e);\n  },\n\n  /**\n   * Moves cursor right or Left, fires event\n   * @param {String} direction 'Left', 'Right'\n   * @param {Event} e Event object\n   */\n  _moveCursorLeftOrRight: function(direction, e) {\n    var actionName = 'moveCursor' + direction + 'With';\n    this._currentCursorOpacity = 1;\n\n    if (e.shiftKey) {\n      actionName += 'Shift';\n    }\n    else {\n      actionName += 'outShift';\n    }\n    if (this[actionName](e)) {\n      this.abortCursorAnimation();\n      this.initDelayedCursor();\n      this._fireSelectionChanged();\n      this._updateTextarea();\n    }\n  },\n\n  /**\n   * Moves cursor right while keeping selection\n   * @param {Event} e\n   */\n  moveCursorRightWithShift: function(e) {\n    if (this._selectionDirection === 'left' && this.selectionStart !== this.selectionEnd) {\n      return this._moveRight(e, 'selectionStart');\n    }\n    else if (this.selectionEnd !== this._text.length) {\n      this._selectionDirection = 'right';\n      return this._moveRight(e, 'selectionEnd');\n    }\n  },\n\n  /**\n   * Moves cursor right without keeping selection\n   * @param {Event} e Event object\n   */\n  moveCursorRightWithoutShift: function(e) {\n    var changed = true;\n    this._selectionDirection = 'right';\n\n    if (this.selectionStart === this.selectionEnd) {\n      changed = this._moveRight(e, 'selectionStart');\n      this.selectionEnd = this.selectionStart;\n    }\n    else {\n      this.selectionStart = this.selectionEnd;\n    }\n    return changed;\n  },\n\n  /**\n   * Removes characters from start/end\n   * start/end ar per grapheme position in _text array.\n   *\n   * @param {Number} start\n   * @param {Number} end default to start + 1\n   */\n  removeChars: function(start, end) {\n    if (typeof end === 'undefined') {\n      end = start + 1;\n    }\n    this.removeStyleFromTo(start, end);\n    this._text.splice(start, end - start);\n    this.text = this._text.join('');\n    this.set('dirty', true);\n    if (this._shouldClearDimensionCache()) {\n      this.initDimensions();\n      this.setCoords();\n    }\n    this._removeExtraneousStyles();\n  },\n\n  /**\n   * insert characters at start position, before start position.\n   * start  equal 1 it means the text get inserted between actual grapheme 0 and 1\n   * if style array is provided, it must be as the same length of text in graphemes\n   * if end is provided and is bigger than start, old text is replaced.\n   * start/end ar per grapheme position in _text array.\n   *\n   * @param {String} text text to insert\n   * @param {Array} style array of style objects\n   * @param {Number} start\n   * @param {Number} end default to start + 1\n   */\n  insertChars: function(text, style, start, end) {\n    if (typeof end === 'undefined') {\n      end = start;\n    }\n    if (end > start) {\n      this.removeStyleFromTo(start, end);\n    }\n    var graphemes = fabric.util.string.graphemeSplit(text);\n    this.insertNewStyleBlock(graphemes, start, style);\n    this._text = [].concat(this._text.slice(0, start), graphemes, this._text.slice(end));\n    this.text = this._text.join('');\n    this.set('dirty', true);\n    if (this._shouldClearDimensionCache()) {\n      this.initDimensions();\n      this.setCoords();\n    }\n    this._removeExtraneousStyles();\n  },\n\n});\n\n\n/* _TO_SVG_START_ */\n(function() {\n  var toFixed = fabric.util.toFixed,\n      multipleSpacesRegex = /  +/g;\n\n  fabric.util.object.extend(fabric.Text.prototype, /** @lends fabric.Text.prototype */ {\n\n    /**\n     * Returns SVG representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    _toSVG: function() {\n      var offsets = this._getSVGLeftTopOffsets(),\n          textAndBg = this._getSVGTextAndBg(offsets.textTop, offsets.textLeft);\n      return this._wrapSVGTextAndBg(textAndBg);\n    },\n\n    /**\n     * Returns svg representation of an instance\n     * @param {Function} [reviver] Method for further parsing of svg representation.\n     * @return {String} svg representation of an instance\n     */\n    toSVG: function(reviver) {\n      return this._createBaseSVGMarkup(\n        this._toSVG(),\n        { reviver: reviver, noStyle: true, withShadow: true }\n      );\n    },\n\n    /**\n     * @private\n     */\n    _getSVGLeftTopOffsets: function() {\n      return {\n        textLeft: -this.width / 2,\n        textTop: -this.height / 2,\n        lineTop: this.getHeightOfLine(0)\n      };\n    },\n\n    /**\n     * @private\n     */\n    _wrapSVGTextAndBg: function(textAndBg) {\n      var noShadow = true,\n          textDecoration = this.getSvgTextDecoration(this);\n      return [\n        textAndBg.textBgRects.join(''),\n        '\\t\\t<text xml:space=\"preserve\" ',\n        (this.fontFamily ? 'font-family=\"' + this.fontFamily.replace(/\"/g, '\\'') + '\" ' : ''),\n        (this.fontSize ? 'font-size=\"' + this.fontSize + '\" ' : ''),\n        (this.fontStyle ? 'font-style=\"' + this.fontStyle + '\" ' : ''),\n        (this.fontWeight ? 'font-weight=\"' + this.fontWeight + '\" ' : ''),\n        (textDecoration ? 'text-decoration=\"' + textDecoration + '\" ' : ''),\n        'style=\"', this.getSvgStyles(noShadow), '\"', this.addPaintOrder(), ' >',\n        textAndBg.textSpans.join(''),\n        '</text>\\n'\n      ];\n    },\n\n    /**\n     * @private\n     * @param {Number} textTopOffset Text top offset\n     * @param {Number} textLeftOffset Text left offset\n     * @return {Object}\n     */\n    _getSVGTextAndBg: function(textTopOffset, textLeftOffset) {\n      var textSpans = [],\n          textBgRects = [],\n          height = textTopOffset, lineOffset;\n      // bounding-box background\n      this._setSVGBg(textBgRects);\n\n      // text and text-background\n      for (var i = 0, len = this._textLines.length; i < len; i++) {\n        lineOffset = this._getLineLeftOffset(i);\n        if (this.textBackgroundColor || this.styleHas('textBackgroundColor', i)) {\n          this._setSVGTextLineBg(textBgRects, i, textLeftOffset + lineOffset, height);\n        }\n        this._setSVGTextLineText(textSpans, i, textLeftOffset + lineOffset, height);\n        height += this.getHeightOfLine(i);\n      }\n\n      return {\n        textSpans: textSpans,\n        textBgRects: textBgRects\n      };\n    },\n\n    /**\n     * @private\n     */\n    _createTextCharSpan: function(_char, styleDecl, left, top) {\n      var shouldUseWhitespace = _char !== _char.trim() || _char.match(multipleSpacesRegex),\n          styleProps = this.getSvgSpanStyles(styleDecl, shouldUseWhitespace),\n          fillStyles = styleProps ? 'style=\"' + styleProps + '\"' : '',\n          dy = styleDecl.deltaY, dySpan = '',\n          NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n      if (dy) {\n        dySpan = ' dy=\"' + toFixed(dy, NUM_FRACTION_DIGITS) + '\" ';\n      }\n      return [\n        '<tspan x=\"', toFixed(left, NUM_FRACTION_DIGITS), '\" y=\"',\n        toFixed(top, NUM_FRACTION_DIGITS), '\" ', dySpan,\n        fillStyles, '>',\n        fabric.util.string.escapeXml(_char),\n        '</tspan>'\n      ].join('');\n    },\n\n    _setSVGTextLineText: function(textSpans, lineIndex, textLeftOffset, textTopOffset) {\n      // set proper line offset\n      var lineHeight = this.getHeightOfLine(lineIndex),\n          isJustify = this.textAlign.indexOf('justify') !== -1,\n          actualStyle,\n          nextStyle,\n          charsToRender = '',\n          charBox, style,\n          boxWidth = 0,\n          line = this._textLines[lineIndex],\n          timeToRender;\n\n      textTopOffset += lineHeight * (1 - this._fontSizeFraction) / this.lineHeight;\n      for (var i = 0, len = line.length - 1; i <= len; i++) {\n        timeToRender = i === len || this.charSpacing;\n        charsToRender += line[i];\n        charBox = this.__charBounds[lineIndex][i];\n        if (boxWidth === 0) {\n          textLeftOffset += charBox.kernedWidth - charBox.width;\n          boxWidth += charBox.width;\n        }\n        else {\n          boxWidth += charBox.kernedWidth;\n        }\n        if (isJustify && !timeToRender) {\n          if (this._reSpaceAndTab.test(line[i])) {\n            timeToRender = true;\n          }\n        }\n        if (!timeToRender) {\n          // if we have charSpacing, we render char by char\n          actualStyle = actualStyle || this.getCompleteStyleDeclaration(lineIndex, i);\n          nextStyle = this.getCompleteStyleDeclaration(lineIndex, i + 1);\n          timeToRender = fabric.util.hasStyleChanged(actualStyle, nextStyle, true);\n        }\n        if (timeToRender) {\n          style = this._getStyleDeclaration(lineIndex, i) || { };\n          textSpans.push(this._createTextCharSpan(charsToRender, style, textLeftOffset, textTopOffset));\n          charsToRender = '';\n          actualStyle = nextStyle;\n          textLeftOffset += boxWidth;\n          boxWidth = 0;\n        }\n      }\n    },\n\n    _pushTextBgRect: function(textBgRects, color, left, top, width, height) {\n      var NUM_FRACTION_DIGITS = fabric.Object.NUM_FRACTION_DIGITS;\n      textBgRects.push(\n        '\\t\\t<rect ',\n        this._getFillAttributes(color),\n        ' x=\"',\n        toFixed(left, NUM_FRACTION_DIGITS),\n        '\" y=\"',\n        toFixed(top, NUM_FRACTION_DIGITS),\n        '\" width=\"',\n        toFixed(width, NUM_FRACTION_DIGITS),\n        '\" height=\"',\n        toFixed(height, NUM_FRACTION_DIGITS),\n        '\"></rect>\\n');\n    },\n\n    _setSVGTextLineBg: function(textBgRects, i, leftOffset, textTopOffset) {\n      var line = this._textLines[i],\n          heightOfLine = this.getHeightOfLine(i) / this.lineHeight,\n          boxWidth = 0,\n          boxStart = 0,\n          charBox, currentColor,\n          lastColor = this.getValueOfPropertyAt(i, 0, 'textBackgroundColor');\n      for (var j = 0, jlen = line.length; j < jlen; j++) {\n        charBox = this.__charBounds[i][j];\n        currentColor = this.getValueOfPropertyAt(i, j, 'textBackgroundColor');\n        if (currentColor !== lastColor) {\n          lastColor && this._pushTextBgRect(textBgRects, lastColor, leftOffset + boxStart,\n            textTopOffset, boxWidth, heightOfLine);\n          boxStart = charBox.left;\n          boxWidth = charBox.width;\n          lastColor = currentColor;\n        }\n        else {\n          boxWidth += charBox.kernedWidth;\n        }\n      }\n      currentColor && this._pushTextBgRect(textBgRects, currentColor, leftOffset + boxStart,\n        textTopOffset, boxWidth, heightOfLine);\n    },\n\n    /**\n     * Adobe Illustrator (at least CS5) is unable to render rgba()-based fill values\n     * we work around it by \"moving\" alpha channel into opacity attribute and setting fill's alpha to 1\n     *\n     * @private\n     * @param {*} value\n     * @return {String}\n     */\n    _getFillAttributes: function(value) {\n      var fillColor = (value && typeof value === 'string') ? new fabric.Color(value) : '';\n      if (!fillColor || !fillColor.getSource() || fillColor.getAlpha() === 1) {\n        return 'fill=\"' + value + '\"';\n      }\n      return 'opacity=\"' + fillColor.getAlpha() + '\" fill=\"' + fillColor.setAlpha(1).toRgb() + '\"';\n    },\n\n    /**\n     * @private\n     */\n    _getSVGLineTopOffset: function(lineIndex) {\n      var lineTopOffset = 0, lastHeight = 0;\n      for (var j = 0; j < lineIndex; j++) {\n        lineTopOffset += this.getHeightOfLine(j);\n      }\n      lastHeight = this.getHeightOfLine(j);\n      return {\n        lineTop: lineTopOffset,\n        offset: (this._fontSizeMult - this._fontSizeFraction) * lastHeight / (this.lineHeight * this._fontSizeMult)\n      };\n    },\n\n    /**\n     * Returns styles-string for svg-export\n     * @param {Boolean} skipShadow a boolean to skip shadow filter output\n     * @return {String}\n     */\n    getSvgStyles: function(skipShadow) {\n      var svgStyle = fabric.Object.prototype.getSvgStyles.call(this, skipShadow);\n      return svgStyle + ' white-space: pre;';\n    },\n  });\n})();\n/* _TO_SVG_END_ */\n\n\n(function(global) {\n\n  'use strict';\n\n  var fabric = global.fabric || (global.fabric = {});\n\n  /**\n   * Textbox class, based on IText, allows the user to resize the text rectangle\n   * and wraps lines automatically. Textboxes have their Y scaling locked, the\n   * user can only change width. Height is adjusted automatically based on the\n   * wrapping of lines.\n   * @class fabric.Textbox\n   * @extends fabric.IText\n   * @mixes fabric.Observable\n   * @return {fabric.Textbox} thisArg\n   * @see {@link fabric.Textbox#initialize} for constructor definition\n   */\n  fabric.Textbox = fabric.util.createClass(fabric.IText, fabric.Observable, {\n\n    /**\n     * Type of an object\n     * @type String\n     * @default\n     */\n    type: 'textbox',\n\n    /**\n     * Minimum width of textbox, in pixels.\n     * @type Number\n     * @default\n     */\n    minWidth: 20,\n\n    /**\n     * Minimum calculated width of a textbox, in pixels.\n     * fixed to 2 so that an empty textbox cannot go to 0\n     * and is still selectable without text.\n     * @type Number\n     * @default\n     */\n    dynamicMinWidth: 2,\n\n    /**\n     * Cached array of text wrapping.\n     * @type Array\n     */\n    __cachedLines: null,\n\n    /**\n     * Override standard Object class values\n     */\n    lockScalingFlip: true,\n\n    /**\n     * Override standard Object class values\n     * Textbox needs this on false\n     */\n    noScaleCache: false,\n\n    /**\n     * Properties which when set cause object to change dimensions\n     * @type Object\n     * @private\n     */\n    _dimensionAffectingProps: fabric.Text.prototype._dimensionAffectingProps.concat('width'),\n\n    /**\n     * Use this regular expression to split strings in breakable lines\n     * @private\n     */\n    _wordJoiners: /[ \\t\\r]/,\n\n    /**\n     * Use this boolean property in order to split strings that have no white space concept.\n     * this is a cheap way to help with chinese/japanese\n     * @type Boolean\n     * @since 2.6.0\n     */\n    splitByGrapheme: false,\n\n    /**\n     * Unlike superclass's version of this function, Textbox does not update\n     * its width.\n     * @private\n     * @override\n     */\n    initDimensions: function() {\n      if (this.__skipDimension) {\n        return;\n      }\n      this.isEditing && this.initDelayedCursor();\n      this.clearContextTop();\n      this._clearCache();\n      // clear dynamicMinWidth as it will be different after we re-wrap line\n      this.dynamicMinWidth = 0;\n      // wrap lines\n      this._styleMap = this._generateStyleMap(this._splitText());\n      // if after wrapping, the width is smaller than dynamicMinWidth, change the width and re-wrap\n      if (this.dynamicMinWidth > this.width) {\n        this._set('width', this.dynamicMinWidth);\n      }\n      if (this.textAlign.indexOf('justify') !== -1) {\n        // once text is measured we need to make space fatter to make justified text.\n        this.enlargeSpaces();\n      }\n      // clear cache and re-calculate height\n      this.height = this.calcTextHeight();\n      this.saveState({ propertySet: '_dimensionAffectingProps' });\n    },\n\n    /**\n     * Generate an object that translates the style object so that it is\n     * broken up by visual lines (new lines and automatic wrapping).\n     * The original text styles object is broken up by actual lines (new lines only),\n     * which is only sufficient for Text / IText\n     * @private\n     */\n    _generateStyleMap: function(textInfo) {\n      var realLineCount     = 0,\n          realLineCharCount = 0,\n          charCount         = 0,\n          map               = {};\n\n      for (var i = 0; i < textInfo.graphemeLines.length; i++) {\n        if (textInfo.graphemeText[charCount] === '\\n' && i > 0) {\n          realLineCharCount = 0;\n          charCount++;\n          realLineCount++;\n        }\n        else if (!this.splitByGrapheme && this._reSpaceAndTab.test(textInfo.graphemeText[charCount]) && i > 0) {\n          // this case deals with space's that are removed from end of lines when wrapping\n          realLineCharCount++;\n          charCount++;\n        }\n\n        map[i] = { line: realLineCount, offset: realLineCharCount };\n\n        charCount += textInfo.graphemeLines[i].length;\n        realLineCharCount += textInfo.graphemeLines[i].length;\n      }\n\n      return map;\n    },\n\n    /**\n     * Returns true if object has a style property or has it on a specified line\n     * @param {Number} lineIndex\n     * @return {Boolean}\n     */\n    styleHas: function(property, lineIndex) {\n      if (this._styleMap && !this.isWrapping) {\n        var map = this._styleMap[lineIndex];\n        if (map) {\n          lineIndex = map.line;\n        }\n      }\n      return fabric.Text.prototype.styleHas.call(this, property, lineIndex);\n    },\n\n    /**\n     * Returns true if object has no styling or no styling in a line\n     * @param {Number} lineIndex , lineIndex is on wrapped lines.\n     * @return {Boolean}\n     */\n    isEmptyStyles: function(lineIndex) {\n      if (!this.styles) {\n        return true;\n      }\n      var offset = 0, nextLineIndex = lineIndex + 1, nextOffset, obj, shouldLimit = false,\n          map = this._styleMap[lineIndex], mapNextLine = this._styleMap[lineIndex + 1];\n      if (map) {\n        lineIndex = map.line;\n        offset = map.offset;\n      }\n      if (mapNextLine) {\n        nextLineIndex = mapNextLine.line;\n        shouldLimit = nextLineIndex === lineIndex;\n        nextOffset = mapNextLine.offset;\n      }\n      obj = typeof lineIndex === 'undefined' ? this.styles : { line: this.styles[lineIndex] };\n      for (var p1 in obj) {\n        for (var p2 in obj[p1]) {\n          if (p2 >= offset && (!shouldLimit || p2 < nextOffset)) {\n            // eslint-disable-next-line no-unused-vars\n            for (var p3 in obj[p1][p2]) {\n              return false;\n            }\n          }\n        }\n      }\n      return true;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _getStyleDeclaration: function(lineIndex, charIndex) {\n      if (this._styleMap && !this.isWrapping) {\n        var map = this._styleMap[lineIndex];\n        if (!map) {\n          return null;\n        }\n        lineIndex = map.line;\n        charIndex = map.offset + charIndex;\n      }\n      return this.callSuper('_getStyleDeclaration', lineIndex, charIndex);\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @param {Object} style\n     * @private\n     */\n    _setStyleDeclaration: function(lineIndex, charIndex, style) {\n      var map = this._styleMap[lineIndex];\n      lineIndex = map.line;\n      charIndex = map.offset + charIndex;\n\n      this.styles[lineIndex][charIndex] = style;\n    },\n\n    /**\n     * @param {Number} lineIndex\n     * @param {Number} charIndex\n     * @private\n     */\n    _deleteStyleDeclaration: function(lineIndex, charIndex) {\n      var map = this._styleMap[lineIndex];\n      lineIndex = map.line;\n      charIndex = map.offset + charIndex;\n      delete this.styles[lineIndex][charIndex];\n    },\n\n    /**\n     * probably broken need a fix\n     * Returns the real style line that correspond to the wrapped lineIndex line\n     * Used just to verify if the line does exist or not.\n     * @param {Number} lineIndex\n     * @returns {Boolean} if the line exists or not\n     * @private\n     */\n    _getLineStyle: function(lineIndex) {\n      var map = this._styleMap[lineIndex];\n      return !!this.styles[map.line];\n    },\n\n    /**\n     * Set the line style to an empty object so that is initialized\n     * @param {Number} lineIndex\n     * @param {Object} style\n     * @private\n     */\n    _setLineStyle: function(lineIndex) {\n      var map = this._styleMap[lineIndex];\n      this.styles[map.line] = {};\n    },\n\n    /**\n     * Wraps text using the 'width' property of Textbox. First this function\n     * splits text on newlines, so we preserve newlines entered by the user.\n     * Then it wraps each line using the width of the Textbox by calling\n     * _wrapLine().\n     * @param {Array} lines The string array of text that is split into lines\n     * @param {Number} desiredWidth width you want to wrap to\n     * @returns {Array} Array of lines\n     */\n    _wrapText: function(lines, desiredWidth) {\n      var wrapped = [], i;\n      this.isWrapping = true;\n      for (i = 0; i < lines.length; i++) {\n        wrapped = wrapped.concat(this._wrapLine(lines[i], i, desiredWidth));\n      }\n      this.isWrapping = false;\n      return wrapped;\n    },\n\n    /**\n     * Helper function to measure a string of text, given its lineIndex and charIndex offset\n     * it gets called when charBounds are not available yet.\n     * @param {CanvasRenderingContext2D} ctx\n     * @param {String} text\n     * @param {number} lineIndex\n     * @param {number} charOffset\n     * @returns {number}\n     * @private\n     */\n    _measureWord: function(word, lineIndex, charOffset) {\n      var width = 0, prevGrapheme, skipLeft = true;\n      charOffset = charOffset || 0;\n      for (var i = 0, len = word.length; i < len; i++) {\n        var box = this._getGraphemeBox(word[i], lineIndex, i + charOffset, prevGrapheme, skipLeft);\n        width += box.kernedWidth;\n        prevGrapheme = word[i];\n      }\n      return width;\n    },\n\n    /**\n     * Wraps a line of text using the width of the Textbox and a context.\n     * @param {Array} line The grapheme array that represent the line\n     * @param {Number} lineIndex\n     * @param {Number} desiredWidth width you want to wrap the line to\n     * @param {Number} reservedSpace space to remove from wrapping for custom functionalities\n     * @returns {Array} Array of line(s) into which the given text is wrapped\n     * to.\n     */\n    _wrapLine: function(_line, lineIndex, desiredWidth, reservedSpace) {\n      var lineWidth = 0,\n          splitByGrapheme = this.splitByGrapheme,\n          graphemeLines = [],\n          line = [],\n          // spaces in different languages?\n          words = splitByGrapheme ? fabric.util.string.graphemeSplit(_line) : _line.split(this._wordJoiners),\n          word = '',\n          offset = 0,\n          infix = splitByGrapheme ? '' : ' ',\n          wordWidth = 0,\n          infixWidth = 0,\n          largestWordWidth = 0,\n          lineJustStarted = true,\n          additionalSpace = this._getWidthOfCharSpacing(),\n          reservedSpace = reservedSpace || 0;\n      // fix a difference between split and graphemeSplit\n      if (words.length === 0) {\n        words.push([]);\n      }\n      desiredWidth -= reservedSpace;\n      for (var i = 0; i < words.length; i++) {\n        // if using splitByGrapheme words are already in graphemes.\n        word = splitByGrapheme ? words[i] : fabric.util.string.graphemeSplit(words[i]);\n        wordWidth = this._measureWord(word, lineIndex, offset);\n        offset += word.length;\n\n        lineWidth += infixWidth + wordWidth - additionalSpace;\n        if (lineWidth > desiredWidth && !lineJustStarted) {\n          graphemeLines.push(line);\n          line = [];\n          lineWidth = wordWidth;\n          lineJustStarted = true;\n        }\n        else {\n          lineWidth += additionalSpace;\n        }\n\n        if (!lineJustStarted && !splitByGrapheme) {\n          line.push(infix);\n        }\n        line = line.concat(word);\n\n        infixWidth = splitByGrapheme ? 0 : this._measureWord([infix], lineIndex, offset);\n        offset++;\n        lineJustStarted = false;\n        // keep track of largest word\n        if (wordWidth > largestWordWidth) {\n          largestWordWidth = wordWidth;\n        }\n      }\n\n      i && graphemeLines.push(line);\n\n      if (largestWordWidth + reservedSpace > this.dynamicMinWidth) {\n        this.dynamicMinWidth = largestWordWidth - additionalSpace + reservedSpace;\n      }\n      return graphemeLines;\n    },\n\n    /**\n     * Detect if the text line is ended with an hard break\n     * text and itext do not have wrapping, return false\n     * @param {Number} lineIndex text to split\n     * @return {Boolean}\n     */\n    isEndOfWrapping: function(lineIndex) {\n      if (!this._styleMap[lineIndex + 1]) {\n        // is last line, return true;\n        return true;\n      }\n      if (this._styleMap[lineIndex + 1].line !== this._styleMap[lineIndex].line) {\n        // this is last line before a line break, return true;\n        return true;\n      }\n      return false;\n    },\n\n    /**\n     * Detect if a line has a linebreak and so we need to account for it when moving\n     * and counting style.\n     * @return Number\n     */\n    missingNewlineOffset: function(lineIndex) {\n      if (this.splitByGrapheme) {\n        return this.isEndOfWrapping(lineIndex) ? 1 : 0;\n      }\n      return 1;\n    },\n\n    /**\n    * Gets lines of text to render in the Textbox. This function calculates\n    * text wrapping on the fly every time it is called.\n    * @param {String} text text to split\n    * @returns {Array} Array of lines in the Textbox.\n    * @override\n    */\n    _splitTextIntoLines: function(text) {\n      var newText = fabric.Text.prototype._splitTextIntoLines.call(this, text),\n          graphemeLines = this._wrapText(newText.lines, this.width),\n          lines = new Array(graphemeLines.length);\n      for (var i = 0; i < graphemeLines.length; i++) {\n        lines[i] = graphemeLines[i].join('');\n      }\n      newText.lines = lines;\n      newText.graphemeLines = graphemeLines;\n      return newText;\n    },\n\n    getMinWidth: function() {\n      return Math.max(this.minWidth, this.dynamicMinWidth);\n    },\n\n    _removeExtraneousStyles: function() {\n      var linesToKeep = {};\n      for (var prop in this._styleMap) {\n        if (this._textLines[prop]) {\n          linesToKeep[this._styleMap[prop].line] = 1;\n        }\n      }\n      for (var prop in this.styles) {\n        if (!linesToKeep[prop]) {\n          delete this.styles[prop];\n        }\n      }\n    },\n\n    /**\n     * Returns object representation of an instance\n     * @method toObject\n     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output\n     * @return {Object} object representation of an instance\n     */\n    toObject: function(propertiesToInclude) {\n      return this.callSuper('toObject', ['minWidth', 'splitByGrapheme'].concat(propertiesToInclude));\n    }\n  });\n\n  /**\n   * Returns fabric.Textbox instance from an object representation\n   * @static\n   * @memberOf fabric.Textbox\n   * @param {Object} object Object to create an instance from\n   * @param {Function} [callback] Callback to invoke when an fabric.Textbox instance is created\n   */\n  fabric.Textbox.fromObject = function(object, callback) {\n    var styles = fabric.util.stylesFromArray(object.styles, object.text);\n    //copy object to prevent mutation\n    var objCopy = Object.assign({}, object, { styles: styles });\n    return fabric.Object._fromObject('Textbox', objCopy, callback, 'text');\n  };\n})(typeof exports !== 'undefined' ? exports : this);\n\n\n(function() {\n\n  var controlsUtils = fabric.controlsUtils,\n      scaleSkewStyleHandler = controlsUtils.scaleSkewCursorStyleHandler,\n      scaleStyleHandler = controlsUtils.scaleCursorStyleHandler,\n      scalingEqually = controlsUtils.scalingEqually,\n      scalingYOrSkewingX = controlsUtils.scalingYOrSkewingX,\n      scalingXOrSkewingY = controlsUtils.scalingXOrSkewingY,\n      scaleOrSkewActionName = controlsUtils.scaleOrSkewActionName,\n      objectControls = fabric.Object.prototype.controls;\n\n  objectControls.ml = new fabric.Control({\n    x: -0.5,\n    y: 0,\n    cursorStyleHandler: scaleSkewStyleHandler,\n    actionHandler: scalingXOrSkewingY,\n    getActionName: scaleOrSkewActionName,\n  });\n\n  objectControls.mr = new fabric.Control({\n    x: 0.5,\n    y: 0,\n    cursorStyleHandler: scaleSkewStyleHandler,\n    actionHandler: scalingXOrSkewingY,\n    getActionName: scaleOrSkewActionName,\n  });\n\n  objectControls.mb = new fabric.Control({\n    x: 0,\n    y: 0.5,\n    cursorStyleHandler: scaleSkewStyleHandler,\n    actionHandler: scalingYOrSkewingX,\n    getActionName: scaleOrSkewActionName,\n  });\n\n  objectControls.mt = new fabric.Control({\n    x: 0,\n    y: -0.5,\n    cursorStyleHandler: scaleSkewStyleHandler,\n    actionHandler: scalingYOrSkewingX,\n    getActionName: scaleOrSkewActionName,\n  });\n\n  objectControls.tl = new fabric.Control({\n    x: -0.5,\n    y: -0.5,\n    cursorStyleHandler: scaleStyleHandler,\n    actionHandler: scalingEqually\n  });\n\n  objectControls.tr = new fabric.Control({\n    x: 0.5,\n    y: -0.5,\n    cursorStyleHandler: scaleStyleHandler,\n    actionHandler: scalingEqually\n  });\n\n  objectControls.bl = new fabric.Control({\n    x: -0.5,\n    y: 0.5,\n    cursorStyleHandler: scaleStyleHandler,\n    actionHandler: scalingEqually\n  });\n\n  objectControls.br = new fabric.Control({\n    x: 0.5,\n    y: 0.5,\n    cursorStyleHandler: scaleStyleHandler,\n    actionHandler: scalingEqually\n  });\n\n  objectControls.mtr = new fabric.Control({\n    x: 0,\n    y: -0.5,\n    actionHandler: controlsUtils.rotationWithSnapping,\n    cursorStyleHandler: controlsUtils.rotationStyleHandler,\n    offsetY: -40,\n    withConnection: true,\n    actionName: 'rotate',\n  });\n\n  if (fabric.Textbox) {\n    // this is breaking the prototype inheritance, no time / ideas to fix it.\n    // is important to document that if you want to have all objects to have a\n    // specific custom control, you have to add it to Object prototype and to Textbox\n    // prototype. The controls are shared as references. So changes to control `tr`\n    // can still apply to all objects if needed.\n    var textBoxControls = fabric.Textbox.prototype.controls = { };\n\n    textBoxControls.mtr = objectControls.mtr;\n    textBoxControls.tr = objectControls.tr;\n    textBoxControls.br = objectControls.br;\n    textBoxControls.tl = objectControls.tl;\n    textBoxControls.bl = objectControls.bl;\n    textBoxControls.mt = objectControls.mt;\n    textBoxControls.mb = objectControls.mb;\n\n    textBoxControls.mr = new fabric.Control({\n      x: 0.5,\n      y: 0,\n      actionHandler: controlsUtils.changeWidth,\n      cursorStyleHandler: scaleSkewStyleHandler,\n      actionName: 'resizing',\n    });\n\n    textBoxControls.ml = new fabric.Control({\n      x: -0.5,\n      y: 0,\n      actionHandler: controlsUtils.changeWidth,\n      cursorStyleHandler: scaleSkewStyleHandler,\n      actionName: 'resizing',\n    });\n  }\n})();\n\n","'use strict';\n\nvar Queue = require('tinyqueue');\n\nif (Queue.default) Queue = Queue.default; // temporary webpack fix\n\nmodule.exports = polylabel;\nmodule.exports.default = polylabel;\n\nfunction polylabel(polygon, precision, debug) {\n    precision = precision || 1.0;\n\n    // find the bounding box of the outer ring\n    var minX, minY, maxX, maxY;\n    for (var i = 0; i < polygon[0].length; i++) {\n        var p = polygon[0][i];\n        if (!i || p[0] < minX) minX = p[0];\n        if (!i || p[1] < minY) minY = p[1];\n        if (!i || p[0] > maxX) maxX = p[0];\n        if (!i || p[1] > maxY) maxY = p[1];\n    }\n\n    var width = maxX - minX;\n    var height = maxY - minY;\n    var cellSize = Math.min(width, height);\n    var h = cellSize / 2;\n\n    if (cellSize === 0) {\n        var degeneratePoleOfInaccessibility = [minX, minY];\n        degeneratePoleOfInaccessibility.distance = 0;\n        return degeneratePoleOfInaccessibility;\n    }\n\n    // a priority queue of cells in order of their \"potential\" (max distance to polygon)\n    var cellQueue = new Queue(undefined, compareMax);\n\n    // cover polygon with initial cells\n    for (var x = minX; x < maxX; x += cellSize) {\n        for (var y = minY; y < maxY; y += cellSize) {\n            cellQueue.push(new Cell(x + h, y + h, h, polygon));\n        }\n    }\n\n    // take centroid as the first best guess\n    var bestCell = getCentroidCell(polygon);\n\n    // special case for rectangular polygons\n    var bboxCell = new Cell(minX + width / 2, minY + height / 2, 0, polygon);\n    if (bboxCell.d > bestCell.d) bestCell = bboxCell;\n\n    var numProbes = cellQueue.length;\n\n    while (cellQueue.length) {\n        // pick the most promising cell from the queue\n        var cell = cellQueue.pop();\n\n        // update the best cell if we found a better one\n        if (cell.d > bestCell.d) {\n            bestCell = cell;\n            if (debug) console.log('found best %d after %d probes', Math.round(1e4 * cell.d) / 1e4, numProbes);\n        }\n\n        // do not drill down further if there's no chance of a better solution\n        if (cell.max - bestCell.d <= precision) continue;\n\n        // split the cell into four cells\n        h = cell.h / 2;\n        cellQueue.push(new Cell(cell.x - h, cell.y - h, h, polygon));\n        cellQueue.push(new Cell(cell.x + h, cell.y - h, h, polygon));\n        cellQueue.push(new Cell(cell.x - h, cell.y + h, h, polygon));\n        cellQueue.push(new Cell(cell.x + h, cell.y + h, h, polygon));\n        numProbes += 4;\n    }\n\n    if (debug) {\n        console.log('num probes: ' + numProbes);\n        console.log('best distance: ' + bestCell.d);\n    }\n\n    var poleOfInaccessibility = [bestCell.x, bestCell.y];\n    poleOfInaccessibility.distance = bestCell.d;\n    return poleOfInaccessibility;\n}\n\nfunction compareMax(a, b) {\n    return b.max - a.max;\n}\n\nfunction Cell(x, y, h, polygon) {\n    this.x = x; // cell center x\n    this.y = y; // cell center y\n    this.h = h; // half the cell size\n    this.d = pointToPolygonDist(x, y, polygon); // distance from cell center to polygon\n    this.max = this.d + this.h * Math.SQRT2; // max distance to polygon within a cell\n}\n\n// signed distance from point to polygon outline (negative if point is outside)\nfunction pointToPolygonDist(x, y, polygon) {\n    var inside = false;\n    var minDistSq = Infinity;\n\n    for (var k = 0; k < polygon.length; k++) {\n        var ring = polygon[k];\n\n        for (var i = 0, len = ring.length, j = len - 1; i < len; j = i++) {\n            var a = ring[i];\n            var b = ring[j];\n\n            if ((a[1] > y !== b[1] > y) &&\n                (x < (b[0] - a[0]) * (y - a[1]) / (b[1] - a[1]) + a[0])) inside = !inside;\n\n            minDistSq = Math.min(minDistSq, getSegDistSq(x, y, a, b));\n        }\n    }\n\n    return minDistSq === 0 ? 0 : (inside ? 1 : -1) * Math.sqrt(minDistSq);\n}\n\n// get polygon centroid\nfunction getCentroidCell(polygon) {\n    var area = 0;\n    var x = 0;\n    var y = 0;\n    var points = polygon[0];\n\n    for (var i = 0, len = points.length, j = len - 1; i < len; j = i++) {\n        var a = points[i];\n        var b = points[j];\n        var f = a[0] * b[1] - b[0] * a[1];\n        x += (a[0] + b[0]) * f;\n        y += (a[1] + b[1]) * f;\n        area += f * 3;\n    }\n    if (area === 0) return new Cell(points[0][0], points[0][1], 0, polygon);\n    return new Cell(x / area, y / area, 0, polygon);\n}\n\n// get squared distance from a point to a segment\nfunction getSegDistSq(px, py, a, b) {\n\n    var x = a[0];\n    var y = a[1];\n    var dx = b[0] - x;\n    var dy = b[1] - y;\n\n    if (dx !== 0 || dy !== 0) {\n\n        var t = ((px - x) * dx + (py - y) * dy) / (dx * dx + dy * dy);\n\n        if (t > 1) {\n            x = b[0];\n            y = b[1];\n\n        } else if (t > 0) {\n            x += dx * t;\n            y += dy * t;\n        }\n    }\n\n    dx = px - x;\n    dy = py - y;\n\n    return dx * dx + dy * dy;\n}\n","var api = require(\"!../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[1].use[1]!../../../node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[1].use[2]!../../../node_modules/sass-loader/dist/cjs.js!./canvas.scss\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nmodule.exports = content.locals || {};","\"use strict\";\n\nvar isOldIE = function isOldIE() {\n  var memo;\n  return function memorize() {\n    if (typeof memo === 'undefined') {\n      // Test for IE <= 9 as proposed by Browserhacks\n      // @see http://browserhacks.com/#hack-e71d8692f65334173fee715c222cb805\n      // Tests for existence of standard globals is to allow style-loader\n      // to operate correctly into non-standard environments\n      // @see https://github.com/webpack-contrib/style-loader/issues/177\n      memo = Boolean(window && document && document.all && !window.atob);\n    }\n\n    return memo;\n  };\n}();\n\nvar getTarget = function getTarget() {\n  var memo = {};\n  return function memorize(target) {\n    if (typeof memo[target] === 'undefined') {\n      var styleTarget = document.querySelector(target); // Special case to return head of iframe instead of iframe itself\n\n      if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n        try {\n          // This will throw an exception if access to iframe is blocked\n          // due to cross-origin restrictions\n          styleTarget = styleTarget.contentDocument.head;\n        } catch (e) {\n          // istanbul ignore next\n          styleTarget = null;\n        }\n      }\n\n      memo[target] = styleTarget;\n    }\n\n    return memo[target];\n  };\n}();\n\nvar stylesInDom = [];\n\nfunction getIndexByIdentifier(identifier) {\n  var result = -1;\n\n  for (var i = 0; i < stylesInDom.length; i++) {\n    if (stylesInDom[i].identifier === identifier) {\n      result = i;\n      break;\n    }\n  }\n\n  return result;\n}\n\nfunction modulesToDom(list, options) {\n  var idCountMap = {};\n  var identifiers = [];\n\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i];\n    var id = options.base ? item[0] + options.base : item[0];\n    var count = idCountMap[id] || 0;\n    var identifier = \"\".concat(id, \" \").concat(count);\n    idCountMap[id] = count + 1;\n    var index = getIndexByIdentifier(identifier);\n    var obj = {\n      css: item[1],\n      media: item[2],\n      sourceMap: item[3]\n    };\n\n    if (index !== -1) {\n      stylesInDom[index].references++;\n      stylesInDom[index].updater(obj);\n    } else {\n      stylesInDom.push({\n        identifier: identifier,\n        updater: addStyle(obj, options),\n        references: 1\n      });\n    }\n\n    identifiers.push(identifier);\n  }\n\n  return identifiers;\n}\n\nfunction insertStyleElement(options) {\n  var style = document.createElement('style');\n  var attributes = options.attributes || {};\n\n  if (typeof attributes.nonce === 'undefined') {\n    var nonce = typeof __webpack_nonce__ !== 'undefined' ? __webpack_nonce__ : null;\n\n    if (nonce) {\n      attributes.nonce = nonce;\n    }\n  }\n\n  Object.keys(attributes).forEach(function (key) {\n    style.setAttribute(key, attributes[key]);\n  });\n\n  if (typeof options.insert === 'function') {\n    options.insert(style);\n  } else {\n    var target = getTarget(options.insert || 'head');\n\n    if (!target) {\n      throw new Error(\"Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.\");\n    }\n\n    target.appendChild(style);\n  }\n\n  return style;\n}\n\nfunction removeStyleElement(style) {\n  // istanbul ignore if\n  if (style.parentNode === null) {\n    return false;\n  }\n\n  style.parentNode.removeChild(style);\n}\n/* istanbul ignore next  */\n\n\nvar replaceText = function replaceText() {\n  var textStore = [];\n  return function replace(index, replacement) {\n    textStore[index] = replacement;\n    return textStore.filter(Boolean).join('\\n');\n  };\n}();\n\nfunction applyToSingletonTag(style, index, remove, obj) {\n  var css = remove ? '' : obj.media ? \"@media \".concat(obj.media, \" {\").concat(obj.css, \"}\") : obj.css; // For old IE\n\n  /* istanbul ignore if  */\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = replaceText(index, css);\n  } else {\n    var cssNode = document.createTextNode(css);\n    var childNodes = style.childNodes;\n\n    if (childNodes[index]) {\n      style.removeChild(childNodes[index]);\n    }\n\n    if (childNodes.length) {\n      style.insertBefore(cssNode, childNodes[index]);\n    } else {\n      style.appendChild(cssNode);\n    }\n  }\n}\n\nfunction applyToTag(style, options, obj) {\n  var css = obj.css;\n  var media = obj.media;\n  var sourceMap = obj.sourceMap;\n\n  if (media) {\n    style.setAttribute('media', media);\n  } else {\n    style.removeAttribute('media');\n  }\n\n  if (sourceMap && typeof btoa !== 'undefined') {\n    css += \"\\n/*# sourceMappingURL=data:application/json;base64,\".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), \" */\");\n  } // For old IE\n\n  /* istanbul ignore if  */\n\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    while (style.firstChild) {\n      style.removeChild(style.firstChild);\n    }\n\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar singleton = null;\nvar singletonCounter = 0;\n\nfunction addStyle(obj, options) {\n  var style;\n  var update;\n  var remove;\n\n  if (options.singleton) {\n    var styleIndex = singletonCounter++;\n    style = singleton || (singleton = insertStyleElement(options));\n    update = applyToSingletonTag.bind(null, style, styleIndex, false);\n    remove = applyToSingletonTag.bind(null, style, styleIndex, true);\n  } else {\n    style = insertStyleElement(options);\n    update = applyToTag.bind(null, style, options);\n\n    remove = function remove() {\n      removeStyleElement(style);\n    };\n  }\n\n  update(obj);\n  return function updateStyle(newObj) {\n    if (newObj) {\n      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap) {\n        return;\n      }\n\n      update(obj = newObj);\n    } else {\n      remove();\n    }\n  };\n}\n\nmodule.exports = function (list, options) {\n  options = options || {}; // Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n  // tags it will allow on a page\n\n  if (!options.singleton && typeof options.singleton !== 'boolean') {\n    options.singleton = isOldIE();\n  }\n\n  list = list || [];\n  var lastIdentifiers = modulesToDom(list, options);\n  return function update(newList) {\n    newList = newList || [];\n\n    if (Object.prototype.toString.call(newList) !== '[object Array]') {\n      return;\n    }\n\n    for (var i = 0; i < lastIdentifiers.length; i++) {\n      var identifier = lastIdentifiers[i];\n      var index = getIndexByIdentifier(identifier);\n      stylesInDom[index].references--;\n    }\n\n    var newLastIdentifiers = modulesToDom(newList, options);\n\n    for (var _i = 0; _i < lastIdentifiers.length; _i++) {\n      var _identifier = lastIdentifiers[_i];\n\n      var _index = getIndexByIdentifier(_identifier);\n\n      if (stylesInDom[_index].references === 0) {\n        stylesInDom[_index].updater();\n\n        stylesInDom.splice(_index, 1);\n      }\n    }\n\n    lastIdentifiers = newLastIdentifiers;\n  };\n};","/*! svg.draggable.js - v2.2.2 - 2019-01-08\r\n* https://github.com/svgdotjs/svg.draggable.js\r\n* Copyright (c) 2019 Wout Fierens; Licensed MIT */\r\n;(function() {\r\n\r\n  // creates handler, saves it\r\n  function DragHandler(el){\r\n    el.remember('_draggable', this)\r\n    this.el = el\r\n  }\r\n\r\n\r\n  // Sets new parameter, starts dragging\r\n  DragHandler.prototype.init = function(constraint, val){\r\n    var _this = this\r\n    this.constraint = constraint\r\n    this.value = val\r\n    this.el.on('mousedown.drag', function(e){ _this.start(e) })\r\n    this.el.on('touchstart.drag', function(e){ _this.start(e) })\r\n  }\r\n\r\n  // transforms one point from screen to user coords\r\n  DragHandler.prototype.transformPoint = function(event, offset){\r\n      event = event || window.event\r\n      var touches = event.changedTouches && event.changedTouches[0] || event\r\n      this.p.x = touches.clientX - (offset || 0)\r\n      this.p.y = touches.clientY\r\n      return this.p.matrixTransform(this.m)\r\n  }\r\n\r\n  // gets elements bounding box with special handling of groups, nested and use\r\n  DragHandler.prototype.getBBox = function(){\r\n\r\n    var box = this.el.bbox()\r\n\r\n    if(this.el instanceof SVG.Nested) box = this.el.rbox()\r\n\r\n    if (this.el instanceof SVG.G || this.el instanceof SVG.Use || this.el instanceof SVG.Nested) {\r\n      box.x = this.el.x()\r\n      box.y = this.el.y()\r\n    }\r\n\r\n    return box\r\n  }\r\n\r\n  // start dragging\r\n  DragHandler.prototype.start = function(e){\r\n\r\n    // check for left button\r\n    if(e.type == 'click'|| e.type == 'mousedown' || e.type == 'mousemove'){\r\n      if((e.which || e.buttons) != 1){\r\n          return\r\n      }\r\n    }\r\n\r\n    var _this = this\r\n\r\n    // fire beforedrag event\r\n    this.el.fire('beforedrag', { event: e, handler: this })\r\n    if(this.el.event().defaultPrevented) return;\r\n\r\n    // prevent browser drag behavior as soon as possible\r\n    e.preventDefault();\r\n\r\n    // prevent propagation to a parent that might also have dragging enabled\r\n    e.stopPropagation();\r\n\r\n    // search for parent on the fly to make sure we can call\r\n    // draggable() even when element is not in the dom currently\r\n    this.parent = this.parent || this.el.parent(SVG.Nested) || this.el.parent(SVG.Doc)\r\n    this.p = this.parent.node.createSVGPoint()\r\n\r\n    // save current transformation matrix\r\n    this.m = this.el.node.getScreenCTM().inverse()\r\n\r\n    var box = this.getBBox()\r\n\r\n    var anchorOffset;\r\n\r\n    // fix text-anchor in text-element (#37)\r\n    if(this.el instanceof SVG.Text){\r\n      anchorOffset = this.el.node.getComputedTextLength();\r\n\r\n      switch(this.el.attr('text-anchor')){\r\n        case 'middle':\r\n          anchorOffset /= 2;\r\n          break\r\n        case 'start':\r\n          anchorOffset = 0;\r\n          break;\r\n      }\r\n    }\r\n\r\n    this.startPoints = {\r\n      // We take absolute coordinates since we are just using a delta here\r\n      point: this.transformPoint(e, anchorOffset),\r\n      box:   box,\r\n      transform: this.el.transform()\r\n    }\r\n\r\n    // add drag and end events to window\r\n    SVG.on(window, 'mousemove.drag', function(e){ _this.drag(e) })\r\n    SVG.on(window, 'touchmove.drag', function(e){ _this.drag(e) })\r\n    SVG.on(window, 'mouseup.drag', function(e){ _this.end(e) })\r\n    SVG.on(window, 'touchend.drag', function(e){ _this.end(e) })\r\n\r\n    // fire dragstart event\r\n    this.el.fire('dragstart', {event: e, p: this.startPoints.point, m: this.m, handler: this})\r\n  }\r\n\r\n  // while dragging\r\n  DragHandler.prototype.drag = function(e){\r\n\r\n    var box = this.getBBox()\r\n      , p   = this.transformPoint(e)\r\n      , x   = this.startPoints.box.x + p.x - this.startPoints.point.x\r\n      , y   = this.startPoints.box.y + p.y - this.startPoints.point.y\r\n      , c   = this.constraint\r\n      , gx  = p.x - this.startPoints.point.x\r\n      , gy  = p.y - this.startPoints.point.y\r\n\r\n    this.el.fire('dragmove', {\r\n        event: e\r\n      , p: p\r\n      , m: this.m\r\n      , handler: this\r\n    })\r\n\r\n    if(this.el.event().defaultPrevented) return p\r\n\r\n    // move the element to its new position, if possible by constraint\r\n    if (typeof c == 'function') {\r\n\r\n      var coord = c.call(this.el, x, y, this.m)\r\n\r\n      // bool, just show us if movement is allowed or not\r\n      if (typeof coord == 'boolean') {\r\n        coord = {\r\n          x: coord,\r\n          y: coord\r\n        }\r\n      }\r\n\r\n      // if true, we just move. If !false its a number and we move it there\r\n      if (coord.x === true) {\r\n        this.el.x(x)\r\n      } else if (coord.x !== false) {\r\n        this.el.x(coord.x)\r\n      }\r\n\r\n      if (coord.y === true) {\r\n        this.el.y(y)\r\n      } else if (coord.y !== false) {\r\n        this.el.y(coord.y)\r\n      }\r\n\r\n    } else if (typeof c == 'object') {\r\n\r\n      // keep element within constrained box\r\n      if (c.minX != null && x < c.minX) {\r\n        x = c.minX\r\n        gx = x - this.startPoints.box.x\r\n      } else if (c.maxX != null && x > c.maxX - box.width) {\r\n        x = c.maxX - box.width\r\n        gx = x - this.startPoints.box.x\r\n      } if (c.minY != null && y < c.minY) {\r\n        y = c.minY\r\n        gy = y - this.startPoints.box.y\r\n      } else if (c.maxY != null && y > c.maxY - box.height) {\r\n        y = c.maxY - box.height\r\n        gy = y - this.startPoints.box.y\r\n      }\r\n\r\n      if (c.snapToGrid != null) {\r\n        x = x - (x % c.snapToGrid)\r\n        y = y - (y % c.snapToGrid)\r\n        gx = gx - (gx % c.snapToGrid)\r\n        gy = gy - (gy % c.snapToGrid)\r\n      }\r\n\r\n      if(this.el instanceof SVG.G)\r\n        this.el.matrix(this.startPoints.transform).transform({x:gx, y: gy}, true)\r\n      else\r\n        this.el.move(x, y)\r\n    }\r\n\r\n    // so we can use it in the end-method, too\r\n    return p\r\n  }\r\n\r\n  DragHandler.prototype.end = function(e){\r\n\r\n    // final drag\r\n    var p = this.drag(e);\r\n\r\n    // fire dragend event\r\n    this.el.fire('dragend', { event: e, p: p, m: this.m, handler: this })\r\n\r\n    // unbind events\r\n    SVG.off(window, 'mousemove.drag')\r\n    SVG.off(window, 'touchmove.drag')\r\n    SVG.off(window, 'mouseup.drag')\r\n    SVG.off(window, 'touchend.drag')\r\n\r\n  }\r\n\r\n  SVG.extend(SVG.Element, {\r\n    // Make element draggable\r\n    // Constraint might be an object (as described in readme.md) or a function in the form \"function (x, y)\" that gets called before every move.\r\n    // The function can return a boolean or an object of the form {x, y}, to which the element will be moved. \"False\" skips moving, true moves to raw x, y.\r\n    draggable: function(value, constraint) {\r\n\r\n      // Check the parameters and reassign if needed\r\n      if (typeof value == 'function' || typeof value == 'object') {\r\n        constraint = value\r\n        value = true\r\n      }\r\n\r\n      var dragHandler = this.remember('_draggable') || new DragHandler(this)\r\n\r\n      // When no parameter is given, value is true\r\n      value = typeof value === 'undefined' ? true : value\r\n\r\n      if(value) dragHandler.init(constraint || {}, value)\r\n      else {\r\n        this.off('mousedown.drag')\r\n        this.off('touchstart.drag')\r\n      }\r\n\r\n      return this\r\n    }\r\n\r\n  })\r\n\r\n}).call(this);\r\n","/*! svg.draw.js - v2.0.4 - 2019-11-28\r\n* https://github.com/svgdotjs/svg.draw.js\r\n* Copyright (c) 2019 Ulrich-Matthias Schfer; Licensed MIT */\r\n\r\n;(function () {\r\n    // Our Object which manages drawing\r\n    function PaintHandler(el, event, options) {\r\n\r\n        this.el = el;\r\n        el.remember('_paintHandler', this);\r\n    \r\n        var _this = this,\r\n            plugin = this.getPlugin();\r\n\r\n        this.parent = el.parent(SVG.Nested) || el.parent(SVG.Doc);\r\n        this.p = this.parent.node.createSVGPoint(); // Helping point for coord transformation\r\n        this.m = null;  // transformation matrix. We get it when drawing starts\r\n        this.startPoint = null;\r\n        this.lastUpdateCall = null;\r\n        this.options = {};\r\n        this.set = new SVG.Set();\r\n\r\n        // Merge options and defaults\r\n        for (var i in this.el.draw.defaults) {\r\n            this.options[i] = this.el.draw.defaults[i];\r\n            if (typeof options[i] !== 'undefined') {\r\n                this.options[i] = options[i];\r\n            }\r\n        }\r\n        \r\n        if(plugin.point) {\r\n          plugin['pointPlugin'] = plugin.point;\r\n          delete plugin.point;\r\n        }\r\n        \r\n        // Import all methods from plugin into object\r\n        for (var i in plugin){\r\n            this[i] = plugin[i];\r\n        }\r\n        \r\n        // When we got an event, we use this for start, otherwise we use the click-event as default\r\n        if (!event) {\r\n            this.parent.on('click.draw', function (e) {\r\n                _this.start(e);\r\n            });\r\n\r\n        }\r\n\r\n    }\r\n\r\n    PaintHandler.prototype.transformPoint = function(x, y){\r\n\r\n        this.p.x = x - (this.offset.x - window.pageXOffset);\r\n        this.p.y = y - (this.offset.y - window.pageYOffset);\r\n        \r\n        return this.p.matrixTransform(this.m);\r\n    \r\n    }\r\n    \r\n    PaintHandler.prototype.start = function (event) {\r\n    \r\n        var _this = this;\r\n    \r\n        // get the current transform matrix from screen to element (offset corrected)\r\n        this.m = this.el.node.getScreenCTM().inverse();\r\n\r\n        // we save the current scrolling-offset here\r\n        this.offset = { x: window.pageXOffset, y: window.pageYOffset };\r\n\r\n        // we want to snap in screen-coords, so we have to scale the snapToGrid accordingly\r\n        this.options.snapToGrid *= Math.sqrt(this.m.a * this.m.a + this.m.b * this.m.b)\r\n\r\n        // save the startpoint\r\n        this.startPoint = this.snapToGrid(this.transformPoint(event.clientX, event.clientY));\r\n\r\n        // the plugin may do some initial work\r\n        if(this.init){ this.init(event); }\r\n\r\n        // Fire our `drawstart`-event. We send the offset-corrected cursor-position along\r\n        this.el.fire('drawstart', {event:event, p:this.p, m:this.m});\r\n\r\n        // We need to bind the update-function to the mousemove event to keep track of the cursor\r\n        SVG.on(window, 'mousemove.draw', function (e) {\r\n            _this.update(e);\r\n        });\r\n\r\n        // Every consecutive call to start should map to point now\r\n        this.start = this.point;\r\n\r\n\r\n    };\r\n\r\n    // This function draws a point if the element is a polyline or polygon\r\n    // Otherwise it will just stop drawing the shape cause we are done\r\n    PaintHandler.prototype.point = function (event) {\r\n        if (this.point != this.start) return this.start(event);\r\n        \r\n        if (this.pointPlugin) {\r\n            return this.pointPlugin(event);\r\n        }\r\n    \r\n        // If this function is not overwritten we just call stop\r\n        this.stop(event);\r\n    };\r\n\r\n\r\n    // The stop-function does the cleanup work\r\n    PaintHandler.prototype.stop = function (event) {\r\n        if (event) {\r\n            this.update(event);\r\n        }\r\n        \r\n        // Plugin may want to clean something\r\n        if(this.clean){ this.clean(); }\r\n\r\n        // Unbind from all events\r\n        SVG.off(window, 'mousemove.draw');\r\n        this.parent.off('click.draw');\r\n\r\n        // remove Refernce to PaintHandler\r\n        this.el.forget('_paintHandler');\r\n\r\n        // overwrite draw-function since we never need it again for this element\r\n        this.el.draw = function () {\r\n        };\r\n\r\n        // Fire the `drawstop`-event\r\n        this.el.fire('drawstop');\r\n    };\r\n\r\n    // Updates the element while moving the cursor\r\n    PaintHandler.prototype.update = function (event) {\r\n\r\n        if(!event && this.lastUpdateCall){\r\n            event = this.lastUpdateCall;\r\n        }\r\n        \r\n        this.lastUpdateCall = event;\r\n        \r\n        // Get the current transform matrix\r\n        // it could have been changed since the start or the last update call\r\n        this.m = this.el.node.getScreenCTM().inverse();\r\n    \r\n        // Call the calc-function which calculates the new position and size\r\n        this.calc(event);\r\n\r\n        // Fire the `drawupdate`-event\r\n        this.el.fire('drawupdate', {event:event, p:this.p, m:this.m});\r\n    };\r\n\r\n    // Called from outside. Finishs a poly-element\r\n    PaintHandler.prototype.done = function () {\r\n        this.calc();\r\n        this.stop();\r\n\r\n        this.el.fire('drawdone');\r\n    };\r\n\r\n    // Called from outside. Cancels a poly-element\r\n    PaintHandler.prototype.cancel = function () {\r\n        // stop drawing and remove the element\r\n        this.stop();\r\n        this.el.remove();\r\n\r\n        this.el.fire('drawcancel');\r\n    };\r\n\r\n    // Calculate the corrected position when using `snapToGrid`\r\n    PaintHandler.prototype.snapToGrid = function (draw) {\r\n\r\n        var temp = null;\r\n\r\n        // An array was given. Loop through every element\r\n        if (draw.length) {\r\n            temp = [draw[0] % this.options.snapToGrid, draw[1] % this.options.snapToGrid];\r\n            draw[0] -= temp[0] < this.options.snapToGrid / 2 ? temp[0] : temp[0] - this.options.snapToGrid;\r\n            draw[1] -= temp[1] < this.options.snapToGrid / 2 ? temp[1] : temp[1] - this.options.snapToGrid;\r\n            return draw;\r\n        }\r\n\r\n        // Properties of element were given. Snap them all\r\n        for (var i in draw) {\r\n            temp = draw[i] % this.options.snapToGrid;\r\n            draw[i] -= (temp < this.options.snapToGrid / 2 ? temp : temp - this.options.snapToGrid) + (temp < 0 ? this.options.snapToGrid : 0);\r\n        }\r\n\r\n        return draw;\r\n    };\r\n\r\n    PaintHandler.prototype.param = function (key, value) {\r\n        this.options[key] = value === null ? this.el.draw.defaults[key] : value;\r\n        this.update();\r\n    };\r\n\r\n    // Returns the plugin\r\n    PaintHandler.prototype.getPlugin = function () {\r\n        return this.el.draw.plugins[this.el.type];\r\n    };\r\n\r\n    SVG.extend(SVG.Element, {\r\n        // Draw element with mouse\r\n        draw: function (event, options, value) {\r\n\r\n            // sort the parameters\r\n            if (!(event instanceof Event || typeof event === 'string')) {\r\n                options = event;\r\n                event = null;\r\n            }\r\n\r\n            // get the old Handler or create a new one from event and options\r\n            var paintHandler = this.remember('_paintHandler') || new PaintHandler(this, event, options || {});\r\n\r\n            // When we got an event we have to start/continue drawing\r\n            if (event instanceof Event) {\r\n                paintHandler['start'](event);\r\n            }\r\n\r\n            // if event is located in our PaintHandler we handle it as method\r\n            if (paintHandler[event]) {\r\n                paintHandler[event](options, value);\r\n            }\r\n\r\n            return this;\r\n        }\r\n\r\n    });\r\n\r\n    // Default values. Can be changed for the whole project if needed\r\n    SVG.Element.prototype.draw.defaults = {\r\n        snapToGrid: 1        // Snaps to a grid of `snapToGrid` px\r\n    };\r\n\r\n    SVG.Element.prototype.draw.extend = function(name, obj){\r\n\r\n        var plugins = {};\r\n        if(typeof name === 'string'){\r\n            plugins[name] = obj;\r\n        }else{\r\n            plugins = name;\r\n        }\r\n\r\n        for(var shapes in plugins){\r\n            var shapesArr = shapes.trim().split(/\\s+/);\r\n\r\n            for(var i in shapesArr){\r\n                SVG.Element.prototype.draw.plugins[shapesArr[i]] = plugins[shapes];\r\n            }\r\n        }\r\n\r\n    };\r\n\r\n    // Container for all types not specified here\r\n    SVG.Element.prototype.draw.plugins = {};\r\n\r\n\r\n    SVG.Element.prototype.draw.extend('rect image', {\r\n    \r\n        init:function(e){\r\n\r\n            var p = this.startPoint;\r\n            \r\n            this.el.attr({ x: p.x, y: p.y, height: 0, width: 0 });\r\n        },\r\n        \r\n        calc:function (e) {\r\n\r\n            var rect = {\r\n                x: this.startPoint.x,\r\n                y: this.startPoint.y\r\n            },  p = this.transformPoint(e.clientX, e.clientY);\r\n\r\n            rect.width = p.x - rect.x;\r\n            rect.height = p.y - rect.y;\r\n\r\n            // Snap the params to the grid we specified\r\n            this.snapToGrid(rect);\r\n\r\n            // When width is less than zero, we have to draw to the left\r\n            // which means we have to move the start-point to the left\r\n            if (rect.width < 0) {\r\n                rect.x = rect.x + rect.width;\r\n                rect.width = -rect.width;\r\n            }\r\n\r\n            // ...same with height\r\n            if (rect.height < 0) {\r\n                rect.y = rect.y + rect.height;\r\n                rect.height = -rect.height;\r\n            }\r\n\r\n            // draw the element\r\n            this.el.attr(rect);\r\n        }\r\n    \r\n    });\r\n\r\n\r\n    SVG.Element.prototype.draw.extend('line polyline polygon', {\r\n\r\n        init:function(e){\r\n            // When we draw a polygon, we immediately need 2 points.\r\n            // One start-point and one point at the mouse-position\r\n\r\n            this.set = new SVG.Set();\r\n\r\n            var p = this.startPoint,\r\n                arr = [\r\n                    [p.x, p.y],\r\n                    [p.x, p.y]\r\n                ];\r\n\r\n            this.el.plot(arr);\r\n\r\n            // We draw little circles around each point\r\n            // This is absolutely not needed and maybe removed in a later release\r\n            this.drawCircles();\r\n\r\n        },\r\n\r\n\r\n        // The calc-function sets the position of the last point to the mouse-position (with offset ofc)\r\n        calc:function (e) {\r\n            var arr = this.el.array().valueOf();\r\n            arr.pop();\r\n\r\n            if (e) {\r\n                var p = this.transformPoint(e.clientX, e.clientY);\r\n                arr.push(this.snapToGrid([p.x, p.y]));\r\n            }\r\n\r\n            this.el.plot(arr);\r\n            this.drawCircles();\r\n        },\r\n\r\n        point:function(e){\r\n\r\n            if (this.el.type.indexOf('poly') > -1) {\r\n                // Add the new Point to the point-array\r\n                var p = this.transformPoint(e.clientX, e.clientY),\r\n                    arr = this.el.array().valueOf();\r\n\r\n                arr.push(this.snapToGrid([p.x, p.y]));\r\n\r\n                this.el.plot(arr);\r\n                this.drawCircles();\r\n\r\n                // Fire the `drawpoint`-event, which holds the coords of the new Point\r\n                this.el.fire('drawpoint', {event:e, p:{x:p.x, y:p.y}, m:this.m});\r\n\r\n                return;\r\n            }\r\n\r\n            // We are done, if the element is no polyline or polygon\r\n            this.stop(e);\r\n\r\n        },\r\n\r\n        clean:function(){\r\n\r\n            // Remove all circles\r\n            this.set.each(function () {\r\n                this.remove();\r\n            });\r\n\r\n            this.set.clear();\r\n\r\n            delete this.set;\r\n\r\n        },\r\n\r\n        drawCircles:function () {\r\n            var array = this.el.array().valueOf()\r\n\r\n            this.set.each(function () {\r\n                this.remove();\r\n            });\r\n\r\n            this.set.clear();\r\n\r\n            for (var i = 0; i < array.length; ++i) {\r\n\r\n                this.p.x = array[i][0]\r\n                this.p.y = array[i][1]\r\n\r\n                var p = this.p.matrixTransform(this.parent.node.getScreenCTM().inverse().multiply(this.el.node.getScreenCTM()));\r\n\r\n                this.set.add(this.parent.circle(5).stroke({width: 1}).fill('#ccc').center(p.x, p.y));\r\n            }\r\n        },\r\n\r\n        undo:function() {\r\n            if (this.set.length()) {\r\n                this.set.members.splice(-2, 1)[0].remove();\r\n                this.el.array().value.splice(-2, 1);\r\n                this.el.plot(this.el.array());\r\n                this.el.fire('undopoint');\r\n            }\r\n        },\r\n    });\r\n\r\n\r\n    SVG.Element.prototype.draw.extend('circle', {\r\n    \r\n        init:function(e){\r\n        \r\n            var p = this.startPoint;\r\n\r\n            this.el.attr({ cx: p.x, cy: p.y, r: 1 });\r\n        },\r\n\r\n        // We determine the radius by the cursor position\r\n        calc:function (e) {\r\n            \r\n            var p = this.transformPoint(e.clientX, e.clientY),\r\n                circle = {\r\n                    cx: this.startPoint.x,\r\n                    cy: this.startPoint.y,\r\n\r\n                    // calculating the radius\r\n                    r: Math.sqrt(\r\n                        (p.x - this.startPoint.x) * (p.x - this.startPoint.x) +\r\n                        (p.y - this.startPoint.y) * (p.y - this.startPoint.y)\r\n                    )\r\n            };\r\n            \r\n            this.snapToGrid(circle);\r\n            this.el.attr(circle);\r\n        }\r\n        \r\n    });\r\n\r\n    SVG.Element.prototype.draw.extend('ellipse', {\r\n    \r\n        init:function(e){\r\n            // We start with a circle with radius 1 at the position of the cursor\r\n            var p = this.startPoint;\r\n\r\n            this.el.attr({ cx: p.x, cy: p.y, rx: 1, ry: 1 });\r\n            \r\n        },\r\n\r\n        calc:function (e) {\r\n            var p = this.transformPoint(e.clientX, e.clientY);\r\n        \r\n            var ellipse = {\r\n                cx: this.startPoint.x,\r\n                cy: this.startPoint.y,\r\n                rx: Math.abs(p.x - this.startPoint.x),\r\n                ry: Math.abs(p.y - this.startPoint.y)\r\n            };\r\n            \r\n            this.snapToGrid(ellipse);\r\n            this.el.attr(ellipse);\r\n        }\r\n        \r\n    });\r\n}).call(this);","/*!\n* svg.js - A lightweight library for manipulating and animating SVG.\n* @version 2.7.1\n* https://svgdotjs.github.io/\n*\n* @copyright Wout Fierens <wout@mick-wout.com>\n* @license MIT\n*\n* BUILT: Fri Nov 30 2018 10:01:55 GMT+0100 (GMT+01:00)\n*/;\n(function(root, factory) {\r\n  /* istanbul ignore next */\r\n  if (typeof define === 'function' && define.amd) {\r\n    define(function(){\r\n      return factory(root, root.document)\r\n    })\r\n  } else if (typeof exports === 'object') {\r\n    module.exports = root.document ? factory(root, root.document) : function(w){ return factory(w, w.document) }\r\n  } else {\r\n    root.SVG = factory(root, root.document)\r\n  }\r\n}(typeof window !== \"undefined\" ? window : this, function(window, document) {\r\n\r\n// Find global reference - uses 'this' by default when available,\r\n// falls back to 'window' otherwise (for bundlers like Webpack)\r\nvar globalRef = (typeof this !== \"undefined\") ? this : window;\r\n\r\n// The main wrapping element\r\nvar SVG = globalRef.SVG = function(element) {\r\n  if (SVG.supported) {\r\n    element = new SVG.Doc(element)\r\n\r\n    if(!SVG.parser.draw)\r\n      SVG.prepare()\r\n\r\n    return element\r\n  }\r\n}\r\n\r\n// Default namespaces\r\nSVG.ns    = 'http://www.w3.org/2000/svg'\r\nSVG.xmlns = 'http://www.w3.org/2000/xmlns/'\r\nSVG.xlink = 'http://www.w3.org/1999/xlink'\r\nSVG.svgjs = 'http://svgjs.com/svgjs'\r\n\r\n// Svg support test\r\nSVG.supported = (function() {\r\n  return !! document.createElementNS &&\r\n         !! document.createElementNS(SVG.ns,'svg').createSVGRect\r\n})()\r\n\r\n// Don't bother to continue if SVG is not supported\r\nif (!SVG.supported) return false\r\n\r\n// Element id sequence\r\nSVG.did  = 1000\r\n\r\n// Get next named element id\r\nSVG.eid = function(name) {\r\n  return 'Svgjs' + capitalize(name) + (SVG.did++)\r\n}\r\n\r\n// Method for element creation\r\nSVG.create = function(name) {\r\n  // create element\r\n  var element = document.createElementNS(this.ns, name)\r\n\r\n  // apply unique id\r\n  element.setAttribute('id', this.eid(name))\r\n\r\n  return element\r\n}\r\n\r\n// Method for extending objects\r\nSVG.extend = function() {\r\n  var modules, methods, key, i\r\n\r\n  // Get list of modules\r\n  modules = [].slice.call(arguments)\r\n\r\n  // Get object with extensions\r\n  methods = modules.pop()\r\n\r\n  for (i = modules.length - 1; i >= 0; i--)\r\n    if (modules[i])\r\n      for (key in methods)\r\n        modules[i].prototype[key] = methods[key]\r\n\r\n  // Make sure SVG.Set inherits any newly added methods\r\n  if (SVG.Set && SVG.Set.inherit)\r\n    SVG.Set.inherit()\r\n}\r\n\r\n// Invent new element\r\nSVG.invent = function(config) {\r\n  // Create element initializer\r\n  var initializer = typeof config.create == 'function' ?\r\n    config.create :\r\n    function() {\r\n      this.constructor.call(this, SVG.create(config.create))\r\n    }\r\n\r\n  // Inherit prototype\r\n  if (config.inherit)\r\n    initializer.prototype = new config.inherit\r\n\r\n  // Extend with methods\r\n  if (config.extend)\r\n    SVG.extend(initializer, config.extend)\r\n\r\n  // Attach construct method to parent\r\n  if (config.construct)\r\n    SVG.extend(config.parent || SVG.Container, config.construct)\r\n\r\n  return initializer\r\n}\r\n\r\n// Adopt existing svg elements\r\nSVG.adopt = function(node) {\r\n  // check for presence of node\r\n  if (!node) return null\r\n\r\n  // make sure a node isn't already adopted\r\n  if (node.instance) return node.instance\r\n\r\n  // initialize variables\r\n  var element\r\n\r\n  // adopt with element-specific settings\r\n  if (node.nodeName == 'svg')\r\n    element = node.parentNode instanceof window.SVGElement ? new SVG.Nested : new SVG.Doc\r\n  else if (node.nodeName == 'linearGradient')\r\n    element = new SVG.Gradient('linear')\r\n  else if (node.nodeName == 'radialGradient')\r\n    element = new SVG.Gradient('radial')\r\n  else if (SVG[capitalize(node.nodeName)])\r\n    element = new SVG[capitalize(node.nodeName)]\r\n  else\r\n    element = new SVG.Element(node)\r\n\r\n  // ensure references\r\n  element.type  = node.nodeName\r\n  element.node  = node\r\n  node.instance = element\r\n\r\n  // SVG.Class specific preparations\r\n  if (element instanceof SVG.Doc)\r\n    element.namespace().defs()\r\n\r\n  // pull svgjs data from the dom (getAttributeNS doesn't work in html5)\r\n  element.setData(JSON.parse(node.getAttribute('svgjs:data')) || {})\r\n\r\n  return element\r\n}\r\n\r\n// Initialize parsing element\r\nSVG.prepare = function() {\r\n  // Select document body and create invisible svg element\r\n  var body = document.getElementsByTagName('body')[0]\r\n    , draw = (body ? new SVG.Doc(body) : SVG.adopt(document.documentElement).nested()).size(2, 0)\r\n\r\n  // Create parser object\r\n  SVG.parser = {\r\n    body: body || document.documentElement\r\n  , draw: draw.style('opacity:0;position:absolute;left:-100%;top:-100%;overflow:hidden').attr('focusable', 'false').node\r\n  , poly: draw.polyline().node\r\n  , path: draw.path().node\r\n  , native: SVG.create('svg')\r\n  }\r\n}\r\n\r\nSVG.parser = {\r\n  native: SVG.create('svg')\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n  if(!SVG.parser.draw)\r\n    SVG.prepare()\r\n}, false)\r\n\n// Storage for regular expressions\r\nSVG.regex = {\r\n  // Parse unit value\r\n  numberAndUnit:    /^([+-]?(\\d+(\\.\\d*)?|\\.\\d+)(e[+-]?\\d+)?)([a-z%]*)$/i\r\n\r\n  // Parse hex value\r\n, hex:              /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i\r\n\r\n  // Parse rgb value\r\n, rgb:              /rgb\\((\\d+),(\\d+),(\\d+)\\)/\r\n\r\n  // Parse reference id\r\n, reference:        /#([a-z0-9\\-_]+)/i\r\n\r\n  // splits a transformation chain\r\n, transforms:       /\\)\\s*,?\\s*/\r\n\r\n  // Whitespace\r\n, whitespace:       /\\s/g\r\n\r\n  // Test hex value\r\n, isHex:            /^#[a-f0-9]{3,6}$/i\r\n\r\n  // Test rgb value\r\n, isRgb:            /^rgb\\(/\r\n\r\n  // Test css declaration\r\n, isCss:            /[^:]+:[^;]+;?/\r\n\r\n  // Test for blank string\r\n, isBlank:          /^(\\s+)?$/\r\n\r\n  // Test for numeric string\r\n, isNumber:         /^[+-]?(\\d+(\\.\\d*)?|\\.\\d+)(e[+-]?\\d+)?$/i\r\n\r\n  // Test for percent value\r\n, isPercent:        /^-?[\\d\\.]+%$/\r\n\r\n  // Test for image url\r\n, isImage:          /\\.(jpg|jpeg|png|gif|svg)(\\?[^=]+.*)?/i\r\n\r\n  // split at whitespace and comma\r\n, delimiter:        /[\\s,]+/\r\n\r\n  // The following regex are used to parse the d attribute of a path\r\n\r\n  // Matches all hyphens which are not after an exponent\r\n, hyphen:           /([^e])\\-/gi\r\n\r\n  // Replaces and tests for all path letters\r\n, pathLetters:      /[MLHVCSQTAZ]/gi\r\n\r\n  // yes we need this one, too\r\n, isPathLetter:     /[MLHVCSQTAZ]/i\r\n\r\n  // matches 0.154.23.45\r\n, numbersWithDots:  /((\\d?\\.\\d+(?:e[+-]?\\d+)?)((?:\\.\\d+(?:e[+-]?\\d+)?)+))+/gi\r\n\r\n  // matches .\r\n, dots:             /\\./g\r\n}\r\n\nSVG.utils = {\r\n  // Map function\r\n  map: function(array, block) {\r\n    var i\r\n      , il = array.length\r\n      , result = []\r\n\r\n    for (i = 0; i < il; i++)\r\n      result.push(block(array[i]))\r\n\r\n    return result\r\n  }\r\n\r\n  // Filter function\r\n, filter: function(array, block) {\r\n    var i\r\n      , il = array.length\r\n      , result = []\r\n\r\n    for (i = 0; i < il; i++)\r\n      if (block(array[i]))\r\n        result.push(array[i])\r\n\r\n    return result\r\n  }\r\n\r\n  // Degrees to radians\r\n, radians: function(d) {\r\n    return d % 360 * Math.PI / 180\r\n  }\r\n\r\n  // Radians to degrees\r\n, degrees: function(r) {\r\n    return r * 180 / Math.PI % 360\r\n  }\r\n\r\n, filterSVGElements: function(nodes) {\r\n    return this.filter( nodes, function(el) { return el instanceof window.SVGElement })\r\n  }\r\n\r\n}\n\r\nSVG.defaults = {\r\n  // Default attribute values\r\n  attrs: {\r\n    // fill and stroke\r\n    'fill-opacity':     1\r\n  , 'stroke-opacity':   1\r\n  , 'stroke-width':     0\r\n  , 'stroke-linejoin':  'miter'\r\n  , 'stroke-linecap':   'butt'\r\n  , fill:               '#000000'\r\n  , stroke:             '#000000'\r\n  , opacity:            1\r\n    // position\r\n  , x:                  0\r\n  , y:                  0\r\n  , cx:                 0\r\n  , cy:                 0\r\n    // size\r\n  , width:              0\r\n  , height:             0\r\n    // radius\r\n  , r:                  0\r\n  , rx:                 0\r\n  , ry:                 0\r\n    // gradient\r\n  , offset:             0\r\n  , 'stop-opacity':     1\r\n  , 'stop-color':       '#000000'\r\n    // text\r\n  , 'font-size':        16\r\n  , 'font-family':      'Helvetica, Arial, sans-serif'\r\n  , 'text-anchor':      'start'\r\n  }\r\n\r\n}\n// Module for color convertions\r\nSVG.Color = function(color) {\r\n  var match\r\n\r\n  // initialize defaults\r\n  this.r = 0\r\n  this.g = 0\r\n  this.b = 0\r\n\r\n  if(!color) return\r\n\r\n  // parse color\r\n  if (typeof color === 'string') {\r\n    if (SVG.regex.isRgb.test(color)) {\r\n      // get rgb values\r\n      match = SVG.regex.rgb.exec(color.replace(SVG.regex.whitespace,''))\r\n\r\n      // parse numeric values\r\n      this.r = parseInt(match[1])\r\n      this.g = parseInt(match[2])\r\n      this.b = parseInt(match[3])\r\n\r\n    } else if (SVG.regex.isHex.test(color)) {\r\n      // get hex values\r\n      match = SVG.regex.hex.exec(fullHex(color))\r\n\r\n      // parse numeric values\r\n      this.r = parseInt(match[1], 16)\r\n      this.g = parseInt(match[2], 16)\r\n      this.b = parseInt(match[3], 16)\r\n\r\n    }\r\n\r\n  } else if (typeof color === 'object') {\r\n    this.r = color.r\r\n    this.g = color.g\r\n    this.b = color.b\r\n\r\n  }\r\n\r\n}\r\n\r\nSVG.extend(SVG.Color, {\r\n  // Default to hex conversion\r\n  toString: function() {\r\n    return this.toHex()\r\n  }\r\n  // Build hex value\r\n, toHex: function() {\r\n    return '#'\r\n      + compToHex(this.r)\r\n      + compToHex(this.g)\r\n      + compToHex(this.b)\r\n  }\r\n  // Build rgb value\r\n, toRgb: function() {\r\n    return 'rgb(' + [this.r, this.g, this.b].join() + ')'\r\n  }\r\n  // Calculate true brightness\r\n, brightness: function() {\r\n    return (this.r / 255 * 0.30)\r\n         + (this.g / 255 * 0.59)\r\n         + (this.b / 255 * 0.11)\r\n  }\r\n  // Make color morphable\r\n, morph: function(color) {\r\n    this.destination = new SVG.Color(color)\r\n\r\n    return this\r\n  }\r\n  // Get morphed color at given position\r\n, at: function(pos) {\r\n    // make sure a destination is defined\r\n    if (!this.destination) return this\r\n\r\n    // normalise pos\r\n    pos = pos < 0 ? 0 : pos > 1 ? 1 : pos\r\n\r\n    // generate morphed color\r\n    return new SVG.Color({\r\n      r: ~~(this.r + (this.destination.r - this.r) * pos)\r\n    , g: ~~(this.g + (this.destination.g - this.g) * pos)\r\n    , b: ~~(this.b + (this.destination.b - this.b) * pos)\r\n    })\r\n  }\r\n\r\n})\r\n\r\n// Testers\r\n\r\n// Test if given value is a color string\r\nSVG.Color.test = function(color) {\r\n  color += ''\r\n  return SVG.regex.isHex.test(color)\r\n      || SVG.regex.isRgb.test(color)\r\n}\r\n\r\n// Test if given value is a rgb object\r\nSVG.Color.isRgb = function(color) {\r\n  return color && typeof color.r == 'number'\r\n               && typeof color.g == 'number'\r\n               && typeof color.b == 'number'\r\n}\r\n\r\n// Test if given value is a color\r\nSVG.Color.isColor = function(color) {\r\n  return SVG.Color.isRgb(color) || SVG.Color.test(color)\r\n}\n// Module for array conversion\r\nSVG.Array = function(array, fallback) {\r\n  array = (array || []).valueOf()\r\n\r\n  // if array is empty and fallback is provided, use fallback\r\n  if (array.length == 0 && fallback)\r\n    array = fallback.valueOf()\r\n\r\n  // parse array\r\n  this.value = this.parse(array)\r\n}\r\n\r\nSVG.extend(SVG.Array, {\r\n  // Make array morphable\r\n  morph: function(array) {\r\n    this.destination = this.parse(array)\r\n\r\n    // normalize length of arrays\r\n    if (this.value.length != this.destination.length) {\r\n      var lastValue       = this.value[this.value.length - 1]\r\n        , lastDestination = this.destination[this.destination.length - 1]\r\n\r\n      while(this.value.length > this.destination.length)\r\n        this.destination.push(lastDestination)\r\n      while(this.value.length < this.destination.length)\r\n        this.value.push(lastValue)\r\n    }\r\n\r\n    return this\r\n  }\r\n  // Clean up any duplicate points\r\n, settle: function() {\r\n    // find all unique values\r\n    for (var i = 0, il = this.value.length, seen = []; i < il; i++)\r\n      if (seen.indexOf(this.value[i]) == -1)\r\n        seen.push(this.value[i])\r\n\r\n    // set new value\r\n    return this.value = seen\r\n  }\r\n  // Get morphed array at given position\r\n, at: function(pos) {\r\n    // make sure a destination is defined\r\n    if (!this.destination) return this\r\n\r\n    // generate morphed array\r\n    for (var i = 0, il = this.value.length, array = []; i < il; i++)\r\n      array.push(this.value[i] + (this.destination[i] - this.value[i]) * pos)\r\n\r\n    return new SVG.Array(array)\r\n  }\r\n  // Convert array to string\r\n, toString: function() {\r\n    return this.value.join(' ')\r\n  }\r\n  // Real value\r\n, valueOf: function() {\r\n    return this.value\r\n  }\r\n  // Parse whitespace separated string\r\n, parse: function(array) {\r\n    array = array.valueOf()\r\n\r\n    // if already is an array, no need to parse it\r\n    if (Array.isArray(array)) return array\r\n\r\n    return this.split(array)\r\n  }\r\n  // Strip unnecessary whitespace\r\n, split: function(string) {\r\n    return string.trim().split(SVG.regex.delimiter).map(parseFloat)\r\n  }\r\n  // Reverse array\r\n, reverse: function() {\r\n    this.value.reverse()\r\n\r\n    return this\r\n  }\r\n, clone: function() {\r\n    var clone = new this.constructor()\r\n    clone.value = array_clone(this.value)\r\n    return clone\r\n  }\r\n})\n// Poly points array\r\nSVG.PointArray = function(array, fallback) {\r\n  SVG.Array.call(this, array, fallback || [[0,0]])\r\n}\r\n\r\n// Inherit from SVG.Array\r\nSVG.PointArray.prototype = new SVG.Array\r\nSVG.PointArray.prototype.constructor = SVG.PointArray\r\n\r\nSVG.extend(SVG.PointArray, {\r\n  // Convert array to string\r\n  toString: function() {\r\n    // convert to a poly point string\r\n    for (var i = 0, il = this.value.length, array = []; i < il; i++)\r\n      array.push(this.value[i].join(','))\r\n\r\n    return array.join(' ')\r\n  }\r\n  // Convert array to line object\r\n, toLine: function() {\r\n    return {\r\n      x1: this.value[0][0]\r\n    , y1: this.value[0][1]\r\n    , x2: this.value[1][0]\r\n    , y2: this.value[1][1]\r\n    }\r\n  }\r\n  // Get morphed array at given position\r\n, at: function(pos) {\r\n    // make sure a destination is defined\r\n    if (!this.destination) return this\r\n\r\n    // generate morphed point string\r\n    for (var i = 0, il = this.value.length, array = []; i < il; i++)\r\n      array.push([\r\n        this.value[i][0] + (this.destination[i][0] - this.value[i][0]) * pos\r\n      , this.value[i][1] + (this.destination[i][1] - this.value[i][1]) * pos\r\n      ])\r\n\r\n    return new SVG.PointArray(array)\r\n  }\r\n  // Parse point string and flat array\r\n, parse: function(array) {\r\n    var points = []\r\n\r\n    array = array.valueOf()\r\n\r\n    // if it is an array\r\n    if (Array.isArray(array)) {\r\n      // and it is not flat, there is no need to parse it\r\n      if(Array.isArray(array[0])) {\r\n        // make sure to use a clone\r\n        return array.map(function (el) { return el.slice() })\r\n      } else if (array[0].x != null){\r\n        // allow point objects to be passed\r\n        return array.map(function (el) { return [el.x, el.y] })\r\n      }\r\n    } else { // Else, it is considered as a string\r\n      // parse points\r\n      array = array.trim().split(SVG.regex.delimiter).map(parseFloat)\r\n    }\r\n\r\n    // validate points - https://svgwg.org/svg2-draft/shapes.html#DataTypePoints\r\n    // Odd number of coordinates is an error. In such cases, drop the last odd coordinate.\r\n    if (array.length % 2 !== 0) array.pop()\r\n\r\n    // wrap points in two-tuples and parse points as floats\r\n    for(var i = 0, len = array.length; i < len; i = i + 2)\r\n      points.push([ array[i], array[i+1] ])\r\n\r\n    return points\r\n  }\r\n  // Move point string\r\n, move: function(x, y) {\r\n    var box = this.bbox()\r\n\r\n    // get relative offset\r\n    x -= box.x\r\n    y -= box.y\r\n\r\n    // move every point\r\n    if (!isNaN(x) && !isNaN(y))\r\n      for (var i = this.value.length - 1; i >= 0; i--)\r\n        this.value[i] = [this.value[i][0] + x, this.value[i][1] + y]\r\n\r\n    return this\r\n  }\r\n  // Resize poly string\r\n, size: function(width, height) {\r\n    var i, box = this.bbox()\r\n\r\n    // recalculate position of all points according to new size\r\n    for (i = this.value.length - 1; i >= 0; i--) {\r\n      if(box.width) this.value[i][0] = ((this.value[i][0] - box.x) * width)  / box.width  + box.x\r\n      if(box.height) this.value[i][1] = ((this.value[i][1] - box.y) * height) / box.height + box.y\r\n    }\r\n\r\n    return this\r\n  }\r\n  // Get bounding box of points\r\n, bbox: function() {\r\n    SVG.parser.poly.setAttribute('points', this.toString())\r\n\r\n    return SVG.parser.poly.getBBox()\r\n  }\r\n})\r\n\nvar pathHandlers = {\r\n  M: function(c, p, p0) {\r\n    p.x = p0.x = c[0]\r\n    p.y = p0.y = c[1]\r\n\r\n    return ['M', p.x, p.y]\r\n  },\r\n  L: function(c, p) {\r\n    p.x = c[0]\r\n    p.y = c[1]\r\n    return ['L', c[0], c[1]]\r\n  },\r\n  H: function(c, p) {\r\n    p.x = c[0]\r\n    return ['H', c[0]]\r\n  },\r\n  V: function(c, p) {\r\n    p.y = c[0]\r\n    return ['V', c[0]]\r\n  },\r\n  C: function(c, p) {\r\n    p.x = c[4]\r\n    p.y = c[5]\r\n    return ['C', c[0], c[1], c[2], c[3], c[4], c[5]]\r\n  },\r\n  S: function(c, p) {\r\n    p.x = c[2]\r\n    p.y = c[3]\r\n    return ['S', c[0], c[1], c[2], c[3]]\r\n  },\r\n  Q: function(c, p) {\r\n    p.x = c[2]\r\n    p.y = c[3]\r\n    return ['Q', c[0], c[1], c[2], c[3]]\r\n  },\r\n  T: function(c, p) {\r\n    p.x = c[0]\r\n    p.y = c[1]\r\n    return ['T', c[0], c[1]]\r\n  },\r\n  Z: function(c, p, p0) {\r\n    p.x = p0.x\r\n    p.y = p0.y\r\n    return ['Z']\r\n  },\r\n  A: function(c, p) {\r\n    p.x = c[5]\r\n    p.y = c[6]\r\n    return ['A', c[0], c[1], c[2], c[3], c[4], c[5], c[6]]\r\n  }\r\n}\r\n\r\nvar mlhvqtcsa = 'mlhvqtcsaz'.split('')\r\n\r\nfor(var i = 0, il = mlhvqtcsa.length; i < il; ++i){\r\n  pathHandlers[mlhvqtcsa[i]] = (function(i){\r\n    return function(c, p, p0) {\r\n      if(i == 'H') c[0] = c[0] + p.x\r\n      else if(i == 'V') c[0] = c[0] + p.y\r\n      else if(i == 'A'){\r\n        c[5] = c[5] + p.x,\r\n        c[6] = c[6] + p.y\r\n      }\r\n      else\r\n        for(var j = 0, jl = c.length; j < jl; ++j) {\r\n          c[j] = c[j] + (j%2 ? p.y : p.x)\r\n        }\r\n\r\n      return pathHandlers[i](c, p, p0)\r\n    }\r\n  })(mlhvqtcsa[i].toUpperCase())\r\n}\r\n\r\n// Path points array\r\nSVG.PathArray = function(array, fallback) {\r\n  SVG.Array.call(this, array, fallback || [['M', 0, 0]])\r\n}\r\n\r\n// Inherit from SVG.Array\r\nSVG.PathArray.prototype = new SVG.Array\r\nSVG.PathArray.prototype.constructor = SVG.PathArray\r\n\r\nSVG.extend(SVG.PathArray, {\r\n  // Convert array to string\r\n  toString: function() {\r\n    return arrayToString(this.value)\r\n  }\r\n  // Move path string\r\n, move: function(x, y) {\r\n    // get bounding box of current situation\r\n    var box = this.bbox()\r\n\r\n    // get relative offset\r\n    x -= box.x\r\n    y -= box.y\r\n\r\n    if (!isNaN(x) && !isNaN(y)) {\r\n      // move every point\r\n      for (var l, i = this.value.length - 1; i >= 0; i--) {\r\n        l = this.value[i][0]\r\n\r\n        if (l == 'M' || l == 'L' || l == 'T')  {\r\n          this.value[i][1] += x\r\n          this.value[i][2] += y\r\n\r\n        } else if (l == 'H')  {\r\n          this.value[i][1] += x\r\n\r\n        } else if (l == 'V')  {\r\n          this.value[i][1] += y\r\n\r\n        } else if (l == 'C' || l == 'S' || l == 'Q')  {\r\n          this.value[i][1] += x\r\n          this.value[i][2] += y\r\n          this.value[i][3] += x\r\n          this.value[i][4] += y\r\n\r\n          if (l == 'C')  {\r\n            this.value[i][5] += x\r\n            this.value[i][6] += y\r\n          }\r\n\r\n        } else if (l == 'A')  {\r\n          this.value[i][6] += x\r\n          this.value[i][7] += y\r\n        }\r\n\r\n      }\r\n    }\r\n\r\n    return this\r\n  }\r\n  // Resize path string\r\n, size: function(width, height) {\r\n    // get bounding box of current situation\r\n    var i, l, box = this.bbox()\r\n\r\n    // recalculate position of all points according to new size\r\n    for (i = this.value.length - 1; i >= 0; i--) {\r\n      l = this.value[i][0]\r\n\r\n      if (l == 'M' || l == 'L' || l == 'T')  {\r\n        this.value[i][1] = ((this.value[i][1] - box.x) * width)  / box.width  + box.x\r\n        this.value[i][2] = ((this.value[i][2] - box.y) * height) / box.height + box.y\r\n\r\n      } else if (l == 'H')  {\r\n        this.value[i][1] = ((this.value[i][1] - box.x) * width)  / box.width  + box.x\r\n\r\n      } else if (l == 'V')  {\r\n        this.value[i][1] = ((this.value[i][1] - box.y) * height) / box.height + box.y\r\n\r\n      } else if (l == 'C' || l == 'S' || l == 'Q')  {\r\n        this.value[i][1] = ((this.value[i][1] - box.x) * width)  / box.width  + box.x\r\n        this.value[i][2] = ((this.value[i][2] - box.y) * height) / box.height + box.y\r\n        this.value[i][3] = ((this.value[i][3] - box.x) * width)  / box.width  + box.x\r\n        this.value[i][4] = ((this.value[i][4] - box.y) * height) / box.height + box.y\r\n\r\n        if (l == 'C')  {\r\n          this.value[i][5] = ((this.value[i][5] - box.x) * width)  / box.width  + box.x\r\n          this.value[i][6] = ((this.value[i][6] - box.y) * height) / box.height + box.y\r\n        }\r\n\r\n      } else if (l == 'A')  {\r\n        // resize radii\r\n        this.value[i][1] = (this.value[i][1] * width)  / box.width\r\n        this.value[i][2] = (this.value[i][2] * height) / box.height\r\n\r\n        // move position values\r\n        this.value[i][6] = ((this.value[i][6] - box.x) * width)  / box.width  + box.x\r\n        this.value[i][7] = ((this.value[i][7] - box.y) * height) / box.height + box.y\r\n      }\r\n\r\n    }\r\n\r\n    return this\r\n  }\r\n  // Test if the passed path array use the same path data commands as this path array\r\n, equalCommands: function(pathArray) {\r\n    var i, il, equalCommands\r\n\r\n    pathArray = new SVG.PathArray(pathArray)\r\n\r\n    equalCommands = this.value.length === pathArray.value.length\r\n    for(i = 0, il = this.value.length; equalCommands && i < il; i++) {\r\n      equalCommands = this.value[i][0] === pathArray.value[i][0]\r\n    }\r\n\r\n    return equalCommands\r\n  }\r\n  // Make path array morphable\r\n, morph: function(pathArray) {\r\n    pathArray = new SVG.PathArray(pathArray)\r\n\r\n    if(this.equalCommands(pathArray)) {\r\n      this.destination = pathArray\r\n    } else {\r\n      this.destination = null\r\n    }\r\n\r\n    return this\r\n  }\r\n  // Get morphed path array at given position\r\n, at: function(pos) {\r\n    // make sure a destination is defined\r\n    if (!this.destination) return this\r\n\r\n    var sourceArray = this.value\r\n      , destinationArray = this.destination.value\r\n      , array = [], pathArray = new SVG.PathArray()\r\n      , i, il, j, jl\r\n\r\n    // Animate has specified in the SVG spec\r\n    // See: https://www.w3.org/TR/SVG11/paths.html#PathElement\r\n    for (i = 0, il = sourceArray.length; i < il; i++) {\r\n      array[i] = [sourceArray[i][0]]\r\n      for(j = 1, jl = sourceArray[i].length; j < jl; j++) {\r\n        array[i][j] = sourceArray[i][j] + (destinationArray[i][j] - sourceArray[i][j]) * pos\r\n      }\r\n      // For the two flags of the elliptical arc command, the SVG spec say:\r\n      // Flags and booleans are interpolated as fractions between zero and one, with any non-zero value considered to be a value of one/true\r\n      // Elliptical arc command as an array followed by corresponding indexes:\r\n      // ['A', rx, ry, x-axis-rotation, large-arc-flag, sweep-flag, x, y]\r\n      //   0    1   2        3                 4             5      6  7\r\n      if(array[i][0] === 'A') {\r\n        array[i][4] = +(array[i][4] != 0)\r\n        array[i][5] = +(array[i][5] != 0)\r\n      }\r\n    }\r\n\r\n    // Directly modify the value of a path array, this is done this way for performance\r\n    pathArray.value = array\r\n    return pathArray\r\n  }\r\n  // Absolutize and parse path to array\r\n, parse: function(array) {\r\n    // if it's already a patharray, no need to parse it\r\n    if (array instanceof SVG.PathArray) return array.valueOf()\r\n\r\n    // prepare for parsing\r\n    var i, x0, y0, s, seg, arr\r\n      , x = 0\r\n      , y = 0\r\n      , paramCnt = { 'M':2, 'L':2, 'H':1, 'V':1, 'C':6, 'S':4, 'Q':4, 'T':2, 'A':7, 'Z':0 }\r\n\r\n    if(typeof array == 'string'){\r\n\r\n      array = array\r\n        .replace(SVG.regex.numbersWithDots, pathRegReplace) // convert 45.123.123 to 45.123 .123\r\n        .replace(SVG.regex.pathLetters, ' $& ') // put some room between letters and numbers\r\n        .replace(SVG.regex.hyphen, '$1 -')      // add space before hyphen\r\n        .trim()                                 // trim\r\n        .split(SVG.regex.delimiter)   // split into array\r\n\r\n    }else{\r\n      array = array.reduce(function(prev, curr){\r\n        return [].concat.call(prev, curr)\r\n      }, [])\r\n    }\r\n\r\n    // array now is an array containing all parts of a path e.g. ['M', '0', '0', 'L', '30', '30' ...]\r\n    var arr = []\r\n      , p = new SVG.Point()\r\n      , p0 = new SVG.Point()\r\n      , index = 0\r\n      , len = array.length\r\n\r\n    do{\r\n      // Test if we have a path letter\r\n      if(SVG.regex.isPathLetter.test(array[index])){\r\n        s = array[index]\r\n        ++index\r\n      // If last letter was a move command and we got no new, it defaults to [L]ine\r\n      }else if(s == 'M'){\r\n        s = 'L'\r\n      }else if(s == 'm'){\r\n        s = 'l'\r\n      }\r\n\r\n      arr.push(pathHandlers[s].call(null,\r\n          array.slice(index, (index = index + paramCnt[s.toUpperCase()])).map(parseFloat),\r\n          p, p0\r\n        )\r\n      )\r\n\r\n    }while(len > index)\r\n\r\n    return arr\r\n\r\n  }\r\n  // Get bounding box of path\r\n, bbox: function() {\r\n    SVG.parser.path.setAttribute('d', this.toString())\r\n\r\n    return SVG.parser.path.getBBox()\r\n  }\r\n\r\n})\r\n\n// Module for unit convertions\r\nSVG.Number = SVG.invent({\r\n  // Initialize\r\n  create: function(value, unit) {\r\n    // initialize defaults\r\n    this.value = 0\r\n    this.unit  = unit || ''\r\n\r\n    // parse value\r\n    if (typeof value === 'number') {\r\n      // ensure a valid numeric value\r\n      this.value = isNaN(value) ? 0 : !isFinite(value) ? (value < 0 ? -3.4e+38 : +3.4e+38) : value\r\n\r\n    } else if (typeof value === 'string') {\r\n      unit = value.match(SVG.regex.numberAndUnit)\r\n\r\n      if (unit) {\r\n        // make value numeric\r\n        this.value = parseFloat(unit[1])\r\n\r\n        // normalize\r\n        if (unit[5] == '%')\r\n          this.value /= 100\r\n        else if (unit[5] == 's')\r\n          this.value *= 1000\r\n\r\n        // store unit\r\n        this.unit = unit[5]\r\n      }\r\n\r\n    } else {\r\n      if (value instanceof SVG.Number) {\r\n        this.value = value.valueOf()\r\n        this.unit  = value.unit\r\n      }\r\n    }\r\n\r\n  }\r\n  // Add methods\r\n, extend: {\r\n    // Stringalize\r\n    toString: function() {\r\n      return (\r\n        this.unit == '%' ?\r\n          ~~(this.value * 1e8) / 1e6:\r\n        this.unit == 's' ?\r\n          this.value / 1e3 :\r\n          this.value\r\n      ) + this.unit\r\n    }\r\n  , toJSON: function() {\r\n      return this.toString()\r\n    }\r\n  , // Convert to primitive\r\n    valueOf: function() {\r\n      return this.value\r\n    }\r\n    // Add number\r\n  , plus: function(number) {\r\n      number = new SVG.Number(number)\r\n      return new SVG.Number(this + number, this.unit || number.unit)\r\n    }\r\n    // Subtract number\r\n  , minus: function(number) {\r\n      number = new SVG.Number(number)\r\n      return new SVG.Number(this - number, this.unit || number.unit)\r\n    }\r\n    // Multiply number\r\n  , times: function(number) {\r\n      number = new SVG.Number(number)\r\n      return new SVG.Number(this * number, this.unit || number.unit)\r\n    }\r\n    // Divide number\r\n  , divide: function(number) {\r\n      number = new SVG.Number(number)\r\n      return new SVG.Number(this / number, this.unit || number.unit)\r\n    }\r\n    // Convert to different unit\r\n  , to: function(unit) {\r\n      var number = new SVG.Number(this)\r\n\r\n      if (typeof unit === 'string')\r\n        number.unit = unit\r\n\r\n      return number\r\n    }\r\n    // Make number morphable\r\n  , morph: function(number) {\r\n      this.destination = new SVG.Number(number)\r\n\r\n      if(number.relative) {\r\n        this.destination.value += this.value\r\n      }\r\n\r\n      return this\r\n    }\r\n    // Get morphed number at given position\r\n  , at: function(pos) {\r\n      // Make sure a destination is defined\r\n      if (!this.destination) return this\r\n\r\n      // Generate new morphed number\r\n      return new SVG.Number(this.destination)\r\n          .minus(this)\r\n          .times(pos)\r\n          .plus(this)\r\n    }\r\n\r\n  }\r\n})\r\n\n\r\nSVG.Element = SVG.invent({\r\n  // Initialize node\r\n  create: function(node) {\r\n    // make stroke value accessible dynamically\r\n    this._stroke = SVG.defaults.attrs.stroke\r\n    this._event = null\r\n    this._events = {}\r\n\r\n    // initialize data object\r\n    this.dom = {}\r\n\r\n    // create circular reference\r\n    if (this.node = node) {\r\n      this.type = node.nodeName\r\n      this.node.instance = this\r\n      this._events = node._events || {}\r\n\r\n      // store current attribute value\r\n      this._stroke = node.getAttribute('stroke') || this._stroke\r\n    }\r\n  }\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Move over x-axis\r\n    x: function(x) {\r\n      return this.attr('x', x)\r\n    }\r\n    // Move over y-axis\r\n  , y: function(y) {\r\n      return this.attr('y', y)\r\n    }\r\n    // Move by center over x-axis\r\n  , cx: function(x) {\r\n      return x == null ? this.x() + this.width() / 2 : this.x(x - this.width() / 2)\r\n    }\r\n    // Move by center over y-axis\r\n  , cy: function(y) {\r\n      return y == null ? this.y() + this.height() / 2 : this.y(y - this.height() / 2)\r\n    }\r\n    // Move element to given x and y values\r\n  , move: function(x, y) {\r\n      return this.x(x).y(y)\r\n    }\r\n    // Move element by its center\r\n  , center: function(x, y) {\r\n      return this.cx(x).cy(y)\r\n    }\r\n    // Set width of element\r\n  , width: function(width) {\r\n      return this.attr('width', width)\r\n    }\r\n    // Set height of element\r\n  , height: function(height) {\r\n      return this.attr('height', height)\r\n    }\r\n    // Set element size to given width and height\r\n  , size: function(width, height) {\r\n      var p = proportionalSize(this, width, height)\r\n\r\n      return this\r\n        .width(new SVG.Number(p.width))\r\n        .height(new SVG.Number(p.height))\r\n    }\r\n    // Clone element\r\n  , clone: function(parent) {\r\n      // write dom data to the dom so the clone can pickup the data\r\n      this.writeDataToDom()\r\n\r\n      // clone element and assign new id\r\n      var clone = assignNewId(this.node.cloneNode(true))\r\n\r\n      // insert the clone in the given parent or after myself\r\n      if(parent) parent.add(clone)\r\n      else this.after(clone)\r\n\r\n      return clone\r\n    }\r\n    // Remove element\r\n  , remove: function() {\r\n      if (this.parent())\r\n        this.parent().removeElement(this)\r\n\r\n      return this\r\n    }\r\n    // Replace element\r\n  , replace: function(element) {\r\n      this.after(element).remove()\r\n\r\n      return element\r\n    }\r\n    // Add element to given container and return self\r\n  , addTo: function(parent) {\r\n      return parent.put(this)\r\n    }\r\n    // Add element to given container and return container\r\n  , putIn: function(parent) {\r\n      return parent.add(this)\r\n    }\r\n    // Get / set id\r\n  , id: function(id) {\r\n      return this.attr('id', id)\r\n    }\r\n    // Checks whether the given point inside the bounding box of the element\r\n  , inside: function(x, y) {\r\n      var box = this.bbox()\r\n\r\n      return x > box.x\r\n          && y > box.y\r\n          && x < box.x + box.width\r\n          && y < box.y + box.height\r\n    }\r\n    // Show element\r\n  , show: function() {\r\n      return this.style('display', '')\r\n    }\r\n    // Hide element\r\n  , hide: function() {\r\n      return this.style('display', 'none')\r\n    }\r\n    // Is element visible?\r\n  , visible: function() {\r\n      return this.style('display') != 'none'\r\n    }\r\n    // Return id on string conversion\r\n  , toString: function() {\r\n      return this.attr('id')\r\n    }\r\n    // Return array of classes on the node\r\n  , classes: function() {\r\n      var attr = this.attr('class')\r\n\r\n      return attr == null ? [] : attr.trim().split(SVG.regex.delimiter)\r\n    }\r\n    // Return true if class exists on the node, false otherwise\r\n  , hasClass: function(name) {\r\n      return this.classes().indexOf(name) != -1\r\n    }\r\n    // Add class to the node\r\n  , addClass: function(name) {\r\n      if (!this.hasClass(name)) {\r\n        var array = this.classes()\r\n        array.push(name)\r\n        this.attr('class', array.join(' '))\r\n      }\r\n\r\n      return this\r\n    }\r\n    // Remove class from the node\r\n  , removeClass: function(name) {\r\n      if (this.hasClass(name)) {\r\n        this.attr('class', this.classes().filter(function(c) {\r\n          return c != name\r\n        }).join(' '))\r\n      }\r\n\r\n      return this\r\n    }\r\n    // Toggle the presence of a class on the node\r\n  , toggleClass: function(name) {\r\n      return this.hasClass(name) ? this.removeClass(name) : this.addClass(name)\r\n    }\r\n    // Get referenced element form attribute value\r\n  , reference: function(attr) {\r\n      return SVG.get(this.attr(attr))\r\n    }\r\n    // Returns the parent element instance\r\n  , parent: function(type) {\r\n      var parent = this\r\n\r\n      // check for parent\r\n      if(!parent.node.parentNode) return null\r\n\r\n      // get parent element\r\n      parent = SVG.adopt(parent.node.parentNode)\r\n\r\n      if(!type) return parent\r\n\r\n      // loop trough ancestors if type is given\r\n      while(parent && parent.node instanceof window.SVGElement){\r\n        if(typeof type === 'string' ? parent.matches(type) : parent instanceof type) return parent\r\n        if(!parent.node.parentNode || parent.node.parentNode.nodeName == '#document' || parent.node.parentNode.nodeName == '#document-fragment') return null // #759, #720\r\n        parent = SVG.adopt(parent.node.parentNode)\r\n      }\r\n    }\r\n    // Get parent document\r\n  , doc: function() {\r\n      return this instanceof SVG.Doc ? this : this.parent(SVG.Doc)\r\n    }\r\n    // return array of all ancestors of given type up to the root svg\r\n  , parents: function(type) {\r\n      var parents = [], parent = this\r\n\r\n      do{\r\n        parent = parent.parent(type)\r\n        if(!parent || !parent.node) break\r\n\r\n        parents.push(parent)\r\n      } while(parent.parent)\r\n\r\n      return parents\r\n    }\r\n    // matches the element vs a css selector\r\n  , matches: function(selector){\r\n      return matches(this.node, selector)\r\n    }\r\n    // Returns the svg node to call native svg methods on it\r\n  , native: function() {\r\n      return this.node\r\n    }\r\n    // Import raw svg\r\n  , svg: function(svg) {\r\n      // create temporary holder\r\n      var well = document.createElement('svg')\r\n\r\n      // act as a setter if svg is given\r\n      if (svg && this instanceof SVG.Parent) {\r\n        // dump raw svg\r\n        well.innerHTML = '<svg>' + svg.replace(/\\n/, '').replace(/<([\\w:-]+)([^<]+?)\\/>/g, '<$1$2></$1>') + '</svg>'\r\n\r\n        // transplant nodes\r\n        for (var i = 0, il = well.firstChild.childNodes.length; i < il; i++)\r\n          this.node.appendChild(well.firstChild.firstChild)\r\n\r\n      // otherwise act as a getter\r\n      } else {\r\n        // create a wrapping svg element in case of partial content\r\n        well.appendChild(svg = document.createElement('svg'))\r\n\r\n        // write svgjs data to the dom\r\n        this.writeDataToDom()\r\n\r\n        // insert a copy of this node\r\n        svg.appendChild(this.node.cloneNode(true))\r\n\r\n        // return target element\r\n        return well.innerHTML.replace(/^<svg>/, '').replace(/<\\/svg>$/, '')\r\n      }\r\n\r\n      return this\r\n    }\r\n  // write svgjs data to the dom\r\n  , writeDataToDom: function() {\r\n\r\n      // dump variables recursively\r\n      if(this.each || this.lines){\r\n        var fn = this.each ? this : this.lines();\r\n        fn.each(function(){\r\n          this.writeDataToDom()\r\n        })\r\n      }\r\n\r\n      // remove previously set data\r\n      this.node.removeAttribute('svgjs:data')\r\n\r\n      if(Object.keys(this.dom).length)\r\n        this.node.setAttribute('svgjs:data', JSON.stringify(this.dom)) // see #428\r\n\r\n      return this\r\n    }\r\n  // set given data to the elements data property\r\n  , setData: function(o){\r\n      this.dom = o\r\n      return this\r\n    }\r\n  , is: function(obj){\r\n      return is(this, obj)\r\n    }\r\n  }\r\n})\r\n\nSVG.easing = {\r\n  '-': function(pos){return pos}\r\n, '<>':function(pos){return -Math.cos(pos * Math.PI) / 2 + 0.5}\r\n, '>': function(pos){return  Math.sin(pos * Math.PI / 2)}\r\n, '<': function(pos){return -Math.cos(pos * Math.PI / 2) + 1}\r\n}\r\n\r\nSVG.morph = function(pos){\r\n  return function(from, to) {\r\n    return new SVG.MorphObj(from, to).at(pos)\r\n  }\r\n}\r\n\r\nSVG.Situation = SVG.invent({\r\n\r\n  create: function(o){\r\n    this.init = false\r\n    this.reversed = false\r\n    this.reversing = false\r\n\r\n    this.duration = new SVG.Number(o.duration).valueOf()\r\n    this.delay = new SVG.Number(o.delay).valueOf()\r\n\r\n    this.start = +new Date() + this.delay\r\n    this.finish = this.start + this.duration\r\n    this.ease = o.ease\r\n\r\n    // this.loop is incremented from 0 to this.loops\r\n    // it is also incremented when in an infinite loop (when this.loops is true)\r\n    this.loop = 0\r\n    this.loops = false\r\n\r\n    this.animations = {\r\n      // functionToCall: [list of morphable objects]\r\n      // e.g. move: [SVG.Number, SVG.Number]\r\n    }\r\n\r\n    this.attrs = {\r\n      // holds all attributes which are not represented from a function svg.js provides\r\n      // e.g. someAttr: SVG.Number\r\n    }\r\n\r\n    this.styles = {\r\n      // holds all styles which should be animated\r\n      // e.g. fill-color: SVG.Color\r\n    }\r\n\r\n    this.transforms = [\r\n      // holds all transformations as transformation objects\r\n      // e.g. [SVG.Rotate, SVG.Translate, SVG.Matrix]\r\n    ]\r\n\r\n    this.once = {\r\n      // functions to fire at a specific position\r\n      // e.g. \"0.5\": function foo(){}\r\n    }\r\n\r\n  }\r\n\r\n})\r\n\r\n\r\nSVG.FX = SVG.invent({\r\n\r\n  create: function(element) {\r\n    this._target = element\r\n    this.situations = []\r\n    this.active = false\r\n    this.situation = null\r\n    this.paused = false\r\n    this.lastPos = 0\r\n    this.pos = 0\r\n    // The absolute position of an animation is its position in the context of its complete duration (including delay and loops)\r\n    // When performing a delay, absPos is below 0 and when performing a loop, its value is above 1\r\n    this.absPos = 0\r\n    this._speed = 1\r\n  }\r\n\r\n, extend: {\r\n\r\n    /**\r\n     * sets or returns the target of this animation\r\n     * @param o object || number In case of Object it holds all parameters. In case of number its the duration of the animation\r\n     * @param ease function || string Function which should be used for easing or easing keyword\r\n     * @param delay Number indicating the delay before the animation starts\r\n     * @return target || this\r\n     */\r\n    animate: function(o, ease, delay){\r\n\r\n      if(typeof o == 'object'){\r\n        ease = o.ease\r\n        delay = o.delay\r\n        o = o.duration\r\n      }\r\n\r\n      var situation = new SVG.Situation({\r\n        duration: o || 1000,\r\n        delay: delay || 0,\r\n        ease: SVG.easing[ease || '-'] || ease\r\n      })\r\n\r\n      this.queue(situation)\r\n\r\n      return this\r\n    }\r\n\r\n    /**\r\n     * sets a delay before the next element of the queue is called\r\n     * @param delay Duration of delay in milliseconds\r\n     * @return this.target()\r\n     */\r\n  , delay: function(delay){\r\n      // The delay is performed by an empty situation with its duration\r\n      // attribute set to the duration of the delay\r\n      var situation = new SVG.Situation({\r\n        duration: delay,\r\n        delay: 0,\r\n        ease: SVG.easing['-']\r\n      })\r\n\r\n      return this.queue(situation)\r\n    }\r\n\r\n    /**\r\n     * sets or returns the target of this animation\r\n     * @param null || target SVG.Element which should be set as new target\r\n     * @return target || this\r\n     */\r\n  , target: function(target){\r\n      if(target && target instanceof SVG.Element){\r\n        this._target = target\r\n        return this\r\n      }\r\n\r\n      return this._target\r\n    }\r\n\r\n    // returns the absolute position at a given time\r\n  , timeToAbsPos: function(timestamp){\r\n      return (timestamp - this.situation.start) / (this.situation.duration/this._speed)\r\n    }\r\n\r\n    // returns the timestamp from a given absolute positon\r\n  , absPosToTime: function(absPos){\r\n      return this.situation.duration/this._speed * absPos + this.situation.start\r\n    }\r\n\r\n    // starts the animationloop\r\n  , startAnimFrame: function(){\r\n      this.stopAnimFrame()\r\n      this.animationFrame = window.requestAnimationFrame(function(){ this.step() }.bind(this))\r\n    }\r\n\r\n    // cancels the animationframe\r\n  , stopAnimFrame: function(){\r\n      window.cancelAnimationFrame(this.animationFrame)\r\n    }\r\n\r\n    // kicks off the animation - only does something when the queue is currently not active and at least one situation is set\r\n  , start: function(){\r\n      // dont start if already started\r\n      if(!this.active && this.situation){\r\n        this.active = true\r\n        this.startCurrent()\r\n      }\r\n\r\n      return this\r\n    }\r\n\r\n    // start the current situation\r\n  , startCurrent: function(){\r\n      this.situation.start = +new Date + this.situation.delay/this._speed\r\n      this.situation.finish = this.situation.start + this.situation.duration/this._speed\r\n      return this.initAnimations().step()\r\n    }\r\n\r\n    /**\r\n     * adds a function / Situation to the animation queue\r\n     * @param fn function / situation to add\r\n     * @return this\r\n     */\r\n  , queue: function(fn){\r\n      if(typeof fn == 'function' || fn instanceof SVG.Situation)\r\n        this.situations.push(fn)\r\n\r\n      if(!this.situation) this.situation = this.situations.shift()\r\n\r\n      return this\r\n    }\r\n\r\n    /**\r\n     * pulls next element from the queue and execute it\r\n     * @return this\r\n     */\r\n  , dequeue: function(){\r\n      // stop current animation\r\n      this.stop()\r\n\r\n      // get next animation from queue\r\n      this.situation = this.situations.shift()\r\n\r\n      if(this.situation){\r\n        if(this.situation instanceof SVG.Situation) {\r\n          this.start()\r\n        } else {\r\n          // If it is not a SVG.Situation, then it is a function, we execute it\r\n          this.situation.call(this)\r\n        }\r\n      }\r\n\r\n      return this\r\n    }\r\n\r\n    // updates all animations to the current state of the element\r\n    // this is important when one property could be changed from another property\r\n  , initAnimations: function() {\r\n      var i, j, source\r\n      var s = this.situation\r\n\r\n      if(s.init) return this\r\n\r\n      for(i in s.animations){\r\n        source = this.target()[i]()\r\n\r\n        if(!Array.isArray(source)) {\r\n          source = [source]\r\n        }\r\n\r\n        if(!Array.isArray(s.animations[i])) {\r\n          s.animations[i] = [s.animations[i]]\r\n        }\r\n\r\n        //if(s.animations[i].length > source.length) {\r\n        //  source.concat = source.concat(s.animations[i].slice(source.length, s.animations[i].length))\r\n        //}\r\n\r\n        for(j = source.length; j--;) {\r\n          // The condition is because some methods return a normal number instead\r\n          // of a SVG.Number\r\n          if(s.animations[i][j] instanceof SVG.Number)\r\n            source[j] = new SVG.Number(source[j])\r\n\r\n          s.animations[i][j] = source[j].morph(s.animations[i][j])\r\n        }\r\n      }\r\n\r\n      for(i in s.attrs){\r\n        s.attrs[i] = new SVG.MorphObj(this.target().attr(i), s.attrs[i])\r\n      }\r\n\r\n      for(i in s.styles){\r\n        s.styles[i] = new SVG.MorphObj(this.target().style(i), s.styles[i])\r\n      }\r\n\r\n      s.initialTransformation = this.target().matrixify()\r\n\r\n      s.init = true\r\n      return this\r\n    }\r\n  , clearQueue: function(){\r\n      this.situations = []\r\n      return this\r\n    }\r\n  , clearCurrent: function(){\r\n      this.situation = null\r\n      return this\r\n    }\r\n    /** stops the animation immediately\r\n     * @param jumpToEnd A Boolean indicating whether to complete the current animation immediately.\r\n     * @param clearQueue A Boolean indicating whether to remove queued animation as well.\r\n     * @return this\r\n     */\r\n  , stop: function(jumpToEnd, clearQueue){\r\n      var active = this.active\r\n      this.active = false\r\n\r\n      if(clearQueue){\r\n        this.clearQueue()\r\n      }\r\n\r\n      if(jumpToEnd && this.situation){\r\n        // initialize the situation if it was not\r\n        !active && this.startCurrent()\r\n        this.atEnd()\r\n      }\r\n\r\n      this.stopAnimFrame()\r\n\r\n      return this.clearCurrent()\r\n    }\r\n\r\n    /** resets the element to the state where the current element has started\r\n     * @return this\r\n     */\r\n  , reset: function(){\r\n      if(this.situation){\r\n        var temp = this.situation\r\n        this.stop()\r\n        this.situation = temp\r\n        this.atStart()\r\n      }\r\n      return this\r\n    }\r\n\r\n    // Stop the currently-running animation, remove all queued animations, and complete all animations for the element.\r\n  , finish: function(){\r\n\r\n      this.stop(true, false)\r\n\r\n      while(this.dequeue().situation && this.stop(true, false));\r\n\r\n      this.clearQueue().clearCurrent()\r\n\r\n      return this\r\n    }\r\n\r\n    // set the internal animation pointer at the start position, before any loops, and updates the visualisation\r\n  , atStart: function() {\r\n      return this.at(0, true)\r\n    }\r\n\r\n    // set the internal animation pointer at the end position, after all the loops, and updates the visualisation\r\n  , atEnd: function() {\r\n      if (this.situation.loops === true) {\r\n        // If in a infinite loop, we end the current iteration\r\n        this.situation.loops = this.situation.loop + 1\r\n      }\r\n\r\n      if(typeof this.situation.loops == 'number') {\r\n        // If performing a finite number of loops, we go after all the loops\r\n        return this.at(this.situation.loops, true)\r\n      } else {\r\n        // If no loops, we just go at the end\r\n        return this.at(1, true)\r\n      }\r\n    }\r\n\r\n    // set the internal animation pointer to the specified position and updates the visualisation\r\n    // if isAbsPos is true, pos is treated as an absolute position\r\n  , at: function(pos, isAbsPos){\r\n      var durDivSpd = this.situation.duration/this._speed\r\n\r\n      this.absPos = pos\r\n      // If pos is not an absolute position, we convert it into one\r\n      if (!isAbsPos) {\r\n        if (this.situation.reversed) this.absPos = 1 - this.absPos\r\n        this.absPos += this.situation.loop\r\n      }\r\n\r\n      this.situation.start = +new Date - this.absPos * durDivSpd\r\n      this.situation.finish = this.situation.start + durDivSpd\r\n\r\n      return this.step(true)\r\n    }\r\n\r\n    /**\r\n     * sets or returns the speed of the animations\r\n     * @param speed null || Number The new speed of the animations\r\n     * @return Number || this\r\n     */\r\n  , speed: function(speed){\r\n      if (speed === 0) return this.pause()\r\n\r\n      if (speed) {\r\n        this._speed = speed\r\n        // We use an absolute position here so that speed can affect the delay before the animation\r\n        return this.at(this.absPos, true)\r\n      } else return this._speed\r\n    }\r\n\r\n    // Make loopable\r\n  , loop: function(times, reverse) {\r\n      var c = this.last()\r\n\r\n      // store total loops\r\n      c.loops = (times != null) ? times : true\r\n      c.loop = 0\r\n\r\n      if(reverse) c.reversing = true\r\n      return this\r\n    }\r\n\r\n    // pauses the animation\r\n  , pause: function(){\r\n      this.paused = true\r\n      this.stopAnimFrame()\r\n\r\n      return this\r\n    }\r\n\r\n    // unpause the animation\r\n  , play: function(){\r\n      if(!this.paused) return this\r\n      this.paused = false\r\n      // We use an absolute position here so that the delay before the animation can be paused\r\n      return this.at(this.absPos, true)\r\n    }\r\n\r\n    /**\r\n     * toggle or set the direction of the animation\r\n     * true sets direction to backwards while false sets it to forwards\r\n     * @param reversed Boolean indicating whether to reverse the animation or not (default: toggle the reverse status)\r\n     * @return this\r\n     */\r\n  , reverse: function(reversed){\r\n      var c = this.last()\r\n\r\n      if(typeof reversed == 'undefined') c.reversed = !c.reversed\r\n      else c.reversed = reversed\r\n\r\n      return this\r\n    }\r\n\r\n\r\n    /**\r\n     * returns a float from 0-1 indicating the progress of the current animation\r\n     * @param eased Boolean indicating whether the returned position should be eased or not\r\n     * @return number\r\n     */\r\n  , progress: function(easeIt){\r\n      return easeIt ? this.situation.ease(this.pos) : this.pos\r\n    }\r\n\r\n    /**\r\n     * adds a callback function which is called when the current animation is finished\r\n     * @param fn Function which should be executed as callback\r\n     * @return number\r\n     */\r\n  , after: function(fn){\r\n      var c = this.last()\r\n        , wrapper = function wrapper(e){\r\n            if(e.detail.situation == c){\r\n              fn.call(this, c)\r\n              this.off('finished.fx', wrapper) // prevent memory leak\r\n            }\r\n          }\r\n\r\n      this.target().on('finished.fx', wrapper)\r\n\r\n      return this._callStart()\r\n    }\r\n\r\n    // adds a callback which is called whenever one animation step is performed\r\n  , during: function(fn){\r\n      var c = this.last()\r\n        , wrapper = function(e){\r\n            if(e.detail.situation == c){\r\n              fn.call(this, e.detail.pos, SVG.morph(e.detail.pos), e.detail.eased, c)\r\n            }\r\n          }\r\n\r\n      // see above\r\n      this.target().off('during.fx', wrapper).on('during.fx', wrapper)\r\n\r\n      this.after(function(){\r\n        this.off('during.fx', wrapper)\r\n      })\r\n\r\n      return this._callStart()\r\n    }\r\n\r\n    // calls after ALL animations in the queue are finished\r\n  , afterAll: function(fn){\r\n      var wrapper = function wrapper(e){\r\n            fn.call(this)\r\n            this.off('allfinished.fx', wrapper)\r\n          }\r\n\r\n      // see above\r\n      this.target().off('allfinished.fx', wrapper).on('allfinished.fx', wrapper)\r\n\r\n      return this._callStart()\r\n    }\r\n\r\n    // calls on every animation step for all animations\r\n  , duringAll: function(fn){\r\n      var wrapper = function(e){\r\n            fn.call(this, e.detail.pos, SVG.morph(e.detail.pos), e.detail.eased, e.detail.situation)\r\n          }\r\n\r\n      this.target().off('during.fx', wrapper).on('during.fx', wrapper)\r\n\r\n      this.afterAll(function(){\r\n        this.off('during.fx', wrapper)\r\n      })\r\n\r\n      return this._callStart()\r\n    }\r\n\r\n  , last: function(){\r\n      return this.situations.length ? this.situations[this.situations.length-1] : this.situation\r\n    }\r\n\r\n    // adds one property to the animations\r\n  , add: function(method, args, type){\r\n      this.last()[type || 'animations'][method] = args\r\n      return this._callStart()\r\n    }\r\n\r\n    /** perform one step of the animation\r\n     *  @param ignoreTime Boolean indicating whether to ignore time and use position directly or recalculate position based on time\r\n     *  @return this\r\n     */\r\n  , step: function(ignoreTime){\r\n\r\n      // convert current time to an absolute position\r\n      if(!ignoreTime) this.absPos = this.timeToAbsPos(+new Date)\r\n\r\n      // This part convert an absolute position to a position\r\n      if(this.situation.loops !== false) {\r\n        var absPos, absPosInt, lastLoop\r\n\r\n        // If the absolute position is below 0, we just treat it as if it was 0\r\n        absPos = Math.max(this.absPos, 0)\r\n        absPosInt = Math.floor(absPos)\r\n\r\n        if(this.situation.loops === true || absPosInt < this.situation.loops) {\r\n          this.pos = absPos - absPosInt\r\n          lastLoop = this.situation.loop\r\n          this.situation.loop = absPosInt\r\n        } else {\r\n          this.absPos = this.situation.loops\r\n          this.pos = 1\r\n          // The -1 here is because we don't want to toggle reversed when all the loops have been completed\r\n          lastLoop = this.situation.loop - 1\r\n          this.situation.loop = this.situation.loops\r\n        }\r\n\r\n        if(this.situation.reversing) {\r\n          // Toggle reversed if an odd number of loops as occured since the last call of step\r\n          this.situation.reversed = this.situation.reversed != Boolean((this.situation.loop - lastLoop) % 2)\r\n        }\r\n\r\n      } else {\r\n        // If there are no loop, the absolute position must not be above 1\r\n        this.absPos = Math.min(this.absPos, 1)\r\n        this.pos = this.absPos\r\n      }\r\n\r\n      // while the absolute position can be below 0, the position must not be below 0\r\n      if(this.pos < 0) this.pos = 0\r\n\r\n      if(this.situation.reversed) this.pos = 1 - this.pos\r\n\r\n\r\n      // apply easing\r\n      var eased = this.situation.ease(this.pos)\r\n\r\n      // call once-callbacks\r\n      for(var i in this.situation.once){\r\n        if(i > this.lastPos && i <= eased){\r\n          this.situation.once[i].call(this.target(), this.pos, eased)\r\n          delete this.situation.once[i]\r\n        }\r\n      }\r\n\r\n      // fire during callback with position, eased position and current situation as parameter\r\n      if(this.active) this.target().fire('during', {pos: this.pos, eased: eased, fx: this, situation: this.situation})\r\n\r\n      // the user may call stop or finish in the during callback\r\n      // so make sure that we still have a valid situation\r\n      if(!this.situation){\r\n        return this\r\n      }\r\n\r\n      // apply the actual animation to every property\r\n      this.eachAt()\r\n\r\n      // do final code when situation is finished\r\n      if((this.pos == 1 && !this.situation.reversed) || (this.situation.reversed && this.pos == 0)){\r\n\r\n        // stop animation callback\r\n        this.stopAnimFrame()\r\n\r\n        // fire finished callback with current situation as parameter\r\n        this.target().fire('finished', {fx:this, situation: this.situation})\r\n\r\n        if(!this.situations.length){\r\n          this.target().fire('allfinished')\r\n\r\n          // Recheck the length since the user may call animate in the afterAll callback\r\n          if(!this.situations.length){\r\n            this.target().off('.fx') // there shouldnt be any binding left, but to make sure...\r\n            this.active = false\r\n          }\r\n        }\r\n\r\n        // start next animation\r\n        if(this.active) this.dequeue()\r\n        else this.clearCurrent()\r\n\r\n      }else if(!this.paused && this.active){\r\n        // we continue animating when we are not at the end\r\n        this.startAnimFrame()\r\n      }\r\n\r\n      // save last eased position for once callback triggering\r\n      this.lastPos = eased\r\n      return this\r\n\r\n    }\r\n\r\n    // calculates the step for every property and calls block with it\r\n  , eachAt: function(){\r\n      var i, len, at, self = this, target = this.target(), s = this.situation\r\n\r\n      // apply animations which can be called trough a method\r\n      for(i in s.animations){\r\n\r\n        at = [].concat(s.animations[i]).map(function(el){\r\n          return typeof el !== 'string' && el.at ? el.at(s.ease(self.pos), self.pos) : el\r\n        })\r\n\r\n        target[i].apply(target, at)\r\n\r\n      }\r\n\r\n      // apply animation which has to be applied with attr()\r\n      for(i in s.attrs){\r\n\r\n        at = [i].concat(s.attrs[i]).map(function(el){\r\n          return typeof el !== 'string' && el.at ? el.at(s.ease(self.pos), self.pos) : el\r\n        })\r\n\r\n        target.attr.apply(target, at)\r\n\r\n      }\r\n\r\n      // apply animation which has to be applied with style()\r\n      for(i in s.styles){\r\n\r\n        at = [i].concat(s.styles[i]).map(function(el){\r\n          return typeof el !== 'string' && el.at ? el.at(s.ease(self.pos), self.pos) : el\r\n        })\r\n\r\n        target.style.apply(target, at)\r\n\r\n      }\r\n\r\n      // animate initialTransformation which has to be chained\r\n      if(s.transforms.length){\r\n\r\n        // get initial initialTransformation\r\n        at = s.initialTransformation\r\n        for(i = 0, len = s.transforms.length; i < len; i++){\r\n\r\n          // get next transformation in chain\r\n          var a = s.transforms[i]\r\n\r\n          // multiply matrix directly\r\n          if(a instanceof SVG.Matrix){\r\n\r\n            if(a.relative){\r\n              at = at.multiply(new SVG.Matrix().morph(a).at(s.ease(this.pos)))\r\n            }else{\r\n              at = at.morph(a).at(s.ease(this.pos))\r\n            }\r\n            continue\r\n          }\r\n\r\n          // when transformation is absolute we have to reset the needed transformation first\r\n          if(!a.relative)\r\n            a.undo(at.extract())\r\n\r\n          // and reapply it after\r\n          at = at.multiply(a.at(s.ease(this.pos)))\r\n\r\n        }\r\n\r\n        // set new matrix on element\r\n        target.matrix(at)\r\n      }\r\n\r\n      return this\r\n\r\n    }\r\n\r\n\r\n    // adds an once-callback which is called at a specific position and never again\r\n  , once: function(pos, fn, isEased){\r\n      var c = this.last()\r\n      if(!isEased) pos = c.ease(pos)\r\n\r\n      c.once[pos] = fn\r\n\r\n      return this\r\n    }\r\n\r\n  , _callStart: function() {\r\n      setTimeout(function(){this.start()}.bind(this), 0)\r\n      return this\r\n    }\r\n\r\n  }\r\n\r\n, parent: SVG.Element\r\n\r\n  // Add method to parent elements\r\n, construct: {\r\n    // Get fx module or create a new one, then animate with given duration and ease\r\n    animate: function(o, ease, delay) {\r\n      return (this.fx || (this.fx = new SVG.FX(this))).animate(o, ease, delay)\r\n    }\r\n  , delay: function(delay){\r\n      return (this.fx || (this.fx = new SVG.FX(this))).delay(delay)\r\n    }\r\n  , stop: function(jumpToEnd, clearQueue) {\r\n      if (this.fx)\r\n        this.fx.stop(jumpToEnd, clearQueue)\r\n\r\n      return this\r\n    }\r\n  , finish: function() {\r\n      if (this.fx)\r\n        this.fx.finish()\r\n\r\n      return this\r\n    }\r\n    // Pause current animation\r\n  , pause: function() {\r\n      if (this.fx)\r\n        this.fx.pause()\r\n\r\n      return this\r\n    }\r\n    // Play paused current animation\r\n  , play: function() {\r\n      if (this.fx)\r\n        this.fx.play()\r\n\r\n      return this\r\n    }\r\n    // Set/Get the speed of the animations\r\n  , speed: function(speed) {\r\n      if (this.fx)\r\n        if (speed == null)\r\n          return this.fx.speed()\r\n        else\r\n          this.fx.speed(speed)\r\n\r\n      return this\r\n    }\r\n  }\r\n\r\n})\r\n\r\n// MorphObj is used whenever no morphable object is given\r\nSVG.MorphObj = SVG.invent({\r\n\r\n  create: function(from, to){\r\n    // prepare color for morphing\r\n    if(SVG.Color.isColor(to)) return new SVG.Color(from).morph(to)\r\n    // check if we have a list of values\r\n    if(SVG.regex.delimiter.test(from)) {\r\n      // prepare path for morphing\r\n      if(SVG.regex.pathLetters.test(from)) return new SVG.PathArray(from).morph(to)\r\n      // prepare value list for morphing\r\n      else return new SVG.Array(from).morph(to)\r\n    }\r\n    // prepare number for morphing\r\n    if(SVG.regex.numberAndUnit.test(to)) return new SVG.Number(from).morph(to)\r\n\r\n    // prepare for plain morphing\r\n    this.value = from\r\n    this.destination = to\r\n  }\r\n\r\n, extend: {\r\n    at: function(pos, real){\r\n      return real < 1 ? this.value : this.destination\r\n    },\r\n\r\n    valueOf: function(){\r\n      return this.value\r\n    }\r\n  }\r\n\r\n})\r\n\r\nSVG.extend(SVG.FX, {\r\n  // Add animatable attributes\r\n  attr: function(a, v, relative) {\r\n    // apply attributes individually\r\n    if (typeof a == 'object') {\r\n      for (var key in a)\r\n        this.attr(key, a[key])\r\n\r\n    } else {\r\n      this.add(a, v, 'attrs')\r\n    }\r\n\r\n    return this\r\n  }\r\n  // Add animatable styles\r\n, style: function(s, v) {\r\n    if (typeof s == 'object')\r\n      for (var key in s)\r\n        this.style(key, s[key])\r\n\r\n    else\r\n      this.add(s, v, 'styles')\r\n\r\n    return this\r\n  }\r\n  // Animatable x-axis\r\n, x: function(x, relative) {\r\n    if(this.target() instanceof SVG.G){\r\n      this.transform({x:x}, relative)\r\n      return this\r\n    }\r\n\r\n    var num = new SVG.Number(x)\r\n    num.relative = relative\r\n    return this.add('x', num)\r\n  }\r\n  // Animatable y-axis\r\n, y: function(y, relative) {\r\n    if(this.target() instanceof SVG.G){\r\n      this.transform({y:y}, relative)\r\n      return this\r\n    }\r\n\r\n    var num = new SVG.Number(y)\r\n    num.relative = relative\r\n    return this.add('y', num)\r\n  }\r\n  // Animatable center x-axis\r\n, cx: function(x) {\r\n    return this.add('cx', new SVG.Number(x))\r\n  }\r\n  // Animatable center y-axis\r\n, cy: function(y) {\r\n    return this.add('cy', new SVG.Number(y))\r\n  }\r\n  // Add animatable move\r\n, move: function(x, y) {\r\n    return this.x(x).y(y)\r\n  }\r\n  // Add animatable center\r\n, center: function(x, y) {\r\n    return this.cx(x).cy(y)\r\n  }\r\n  // Add animatable size\r\n, size: function(width, height) {\r\n    if (this.target() instanceof SVG.Text) {\r\n      // animate font size for Text elements\r\n      this.attr('font-size', width)\r\n\r\n    } else {\r\n      // animate bbox based size for all other elements\r\n      var box\r\n\r\n      if(!width || !height){\r\n        box = this.target().bbox()\r\n      }\r\n\r\n      if(!width){\r\n        width = box.width / box.height  * height\r\n      }\r\n\r\n      if(!height){\r\n        height = box.height / box.width  * width\r\n      }\r\n\r\n      this.add('width' , new SVG.Number(width))\r\n          .add('height', new SVG.Number(height))\r\n\r\n    }\r\n\r\n    return this\r\n  }\r\n  // Add animatable width\r\n, width: function(width) {\r\n    return this.add('width', new SVG.Number(width))\r\n  }\r\n  // Add animatable height\r\n, height: function(height) {\r\n    return this.add('height', new SVG.Number(height))\r\n  }\r\n  // Add animatable plot\r\n, plot: function(a, b, c, d) {\r\n    // Lines can be plotted with 4 arguments\r\n    if(arguments.length == 4) {\r\n      return this.plot([a, b, c, d])\r\n    }\r\n\r\n    return this.add('plot', new (this.target().morphArray)(a))\r\n  }\r\n  // Add leading method\r\n, leading: function(value) {\r\n    return this.target().leading ?\r\n      this.add('leading', new SVG.Number(value)) :\r\n      this\r\n  }\r\n  // Add animatable viewbox\r\n, viewbox: function(x, y, width, height) {\r\n    if (this.target() instanceof SVG.Container) {\r\n      this.add('viewbox', new SVG.ViewBox(x, y, width, height))\r\n    }\r\n\r\n    return this\r\n  }\r\n, update: function(o) {\r\n    if (this.target() instanceof SVG.Stop) {\r\n      if (typeof o == 'number' || o instanceof SVG.Number) {\r\n        return this.update({\r\n          offset:  arguments[0]\r\n        , color:   arguments[1]\r\n        , opacity: arguments[2]\r\n        })\r\n      }\r\n\r\n      if (o.opacity != null) this.attr('stop-opacity', o.opacity)\r\n      if (o.color   != null) this.attr('stop-color', o.color)\r\n      if (o.offset  != null) this.attr('offset', o.offset)\r\n    }\r\n\r\n    return this\r\n  }\r\n})\r\n\nSVG.Box = SVG.invent({\r\n  create: function(x, y, width, height) {\r\n    if (typeof x == 'object' && !(x instanceof SVG.Element)) {\r\n      // chromes getBoundingClientRect has no x and y property\r\n      return SVG.Box.call(this, x.left != null ? x.left : x.x , x.top != null ? x.top : x.y, x.width, x.height)\r\n    } else if (arguments.length == 4) {\r\n      this.x = x\r\n      this.y = y\r\n      this.width = width\r\n      this.height = height\r\n    }\r\n\r\n    // add center, right, bottom...\r\n    fullBox(this)\r\n  }\r\n, extend: {\r\n    // Merge rect box with another, return a new instance\r\n    merge: function(box) {\r\n      var b = new this.constructor()\r\n\r\n      // merge boxes\r\n      b.x      = Math.min(this.x, box.x)\r\n      b.y      = Math.min(this.y, box.y)\r\n      b.width  = Math.max(this.x + this.width,  box.x + box.width)  - b.x\r\n      b.height = Math.max(this.y + this.height, box.y + box.height) - b.y\r\n\r\n      return fullBox(b)\r\n    }\r\n\r\n  , transform: function(m) {\r\n      var xMin = Infinity, xMax = -Infinity, yMin = Infinity, yMax = -Infinity, p, bbox\r\n\r\n      var pts = [\r\n        new SVG.Point(this.x, this.y),\r\n        new SVG.Point(this.x2, this.y),\r\n        new SVG.Point(this.x, this.y2),\r\n        new SVG.Point(this.x2, this.y2)\r\n      ]\r\n\r\n      pts.forEach(function(p) {\r\n        p = p.transform(m)\r\n        xMin = Math.min(xMin,p.x)\r\n        xMax = Math.max(xMax,p.x)\r\n        yMin = Math.min(yMin,p.y)\r\n        yMax = Math.max(yMax,p.y)\r\n      })\r\n\r\n      bbox = new this.constructor()\r\n      bbox.x = xMin\r\n      bbox.width = xMax-xMin\r\n      bbox.y = yMin\r\n      bbox.height = yMax-yMin\r\n\r\n      fullBox(bbox)\r\n\r\n      return bbox\r\n    }\r\n  }\r\n})\r\n\r\nSVG.BBox = SVG.invent({\r\n  // Initialize\r\n  create: function(element) {\r\n    SVG.Box.apply(this, [].slice.call(arguments))\r\n\r\n    // get values if element is given\r\n    if (element instanceof SVG.Element) {\r\n      var box\r\n\r\n      // yes this is ugly, but Firefox can be a pain when it comes to elements that are not yet rendered\r\n      try {\r\n\r\n        if (!document.documentElement.contains){\r\n          // This is IE - it does not support contains() for top-level SVGs\r\n          var topParent = element.node\r\n          while (topParent.parentNode){\r\n            topParent = topParent.parentNode\r\n          }\r\n          if (topParent != document) throw new Exception('Element not in the dom')\r\n        } else {\r\n          // the element is NOT in the dom, throw error\r\n          if(!document.documentElement.contains(element.node)) throw new Exception('Element not in the dom')\r\n        }\r\n\r\n        // find native bbox\r\n        box = element.node.getBBox()\r\n      } catch(e) {\r\n        if(element instanceof SVG.Shape){\r\n          var clone = element.clone(SVG.parser.draw.instance).show()\r\n          box = clone.node.getBBox()\r\n          clone.remove()\r\n        }else{\r\n          box = {\r\n            x:      element.node.clientLeft\r\n          , y:      element.node.clientTop\r\n          , width:  element.node.clientWidth\r\n          , height: element.node.clientHeight\r\n          }\r\n        }\r\n      }\r\n\r\n      SVG.Box.call(this, box)\r\n    }\r\n\r\n  }\r\n\r\n  // Define ancestor\r\n, inherit: SVG.Box\r\n\r\n  // Define Parent\r\n, parent: SVG.Element\r\n\r\n  // Constructor\r\n, construct: {\r\n    // Get bounding box\r\n    bbox: function() {\r\n      return new SVG.BBox(this)\r\n    }\r\n  }\r\n\r\n})\r\n\r\nSVG.BBox.prototype.constructor = SVG.BBox\r\n\r\n\r\nSVG.extend(SVG.Element, {\r\n  tbox: function(){\r\n    console.warn('Use of TBox is deprecated and mapped to RBox. Use .rbox() instead.')\r\n    return this.rbox(this.doc())\r\n  }\r\n})\r\n\r\nSVG.RBox = SVG.invent({\r\n  // Initialize\r\n  create: function(element) {\r\n    SVG.Box.apply(this, [].slice.call(arguments))\r\n\r\n    if (element instanceof SVG.Element) {\r\n      SVG.Box.call(this, element.node.getBoundingClientRect())\r\n    }\r\n  }\r\n\r\n, inherit: SVG.Box\r\n\r\n  // define Parent\r\n, parent: SVG.Element\r\n\r\n, extend: {\r\n    addOffset: function() {\r\n      // offset by window scroll position, because getBoundingClientRect changes when window is scrolled\r\n      this.x += window.pageXOffset\r\n      this.y += window.pageYOffset\r\n      return this\r\n    }\r\n  }\r\n\r\n  // Constructor\r\n, construct: {\r\n    // Get rect box\r\n    rbox: function(el) {\r\n      if (el) return new SVG.RBox(this).transform(el.screenCTM().inverse())\r\n      return new SVG.RBox(this).addOffset()\r\n    }\r\n  }\r\n\r\n})\r\n\r\nSVG.RBox.prototype.constructor = SVG.RBox\r\n\nSVG.Matrix = SVG.invent({\r\n  // Initialize\r\n  create: function(source) {\r\n    var i, base = arrayToMatrix([1, 0, 0, 1, 0, 0])\r\n\r\n    // ensure source as object\r\n    source = source instanceof SVG.Element ?\r\n      source.matrixify() :\r\n    typeof source === 'string' ?\r\n      arrayToMatrix(source.split(SVG.regex.delimiter).map(parseFloat)) :\r\n    arguments.length == 6 ?\r\n      arrayToMatrix([].slice.call(arguments)) :\r\n    Array.isArray(source) ?\r\n      arrayToMatrix(source) :\r\n    typeof source === 'object' ?\r\n      source : base\r\n\r\n    // merge source\r\n    for (i = abcdef.length - 1; i >= 0; --i)\r\n      this[abcdef[i]] = source[abcdef[i]] != null ?\r\n        source[abcdef[i]] : base[abcdef[i]]\r\n  }\r\n\r\n  // Add methods\r\n, extend: {\r\n    // Extract individual transformations\r\n    extract: function() {\r\n      // find delta transform points\r\n      var px    = deltaTransformPoint(this, 0, 1)\r\n        , py    = deltaTransformPoint(this, 1, 0)\r\n        , skewX = 180 / Math.PI * Math.atan2(px.y, px.x) - 90\r\n\r\n      return {\r\n        // translation\r\n        x:        this.e\r\n      , y:        this.f\r\n      , transformedX:(this.e * Math.cos(skewX * Math.PI / 180) + this.f * Math.sin(skewX * Math.PI / 180)) / Math.sqrt(this.a * this.a + this.b * this.b)\r\n      , transformedY:(this.f * Math.cos(skewX * Math.PI / 180) + this.e * Math.sin(-skewX * Math.PI / 180)) / Math.sqrt(this.c * this.c + this.d * this.d)\r\n        // skew\r\n      , skewX:    -skewX\r\n      , skewY:    180 / Math.PI * Math.atan2(py.y, py.x)\r\n        // scale\r\n      , scaleX:   Math.sqrt(this.a * this.a + this.b * this.b)\r\n      , scaleY:   Math.sqrt(this.c * this.c + this.d * this.d)\r\n        // rotation\r\n      , rotation: skewX\r\n      , a: this.a\r\n      , b: this.b\r\n      , c: this.c\r\n      , d: this.d\r\n      , e: this.e\r\n      , f: this.f\r\n      , matrix: new SVG.Matrix(this)\r\n      }\r\n    }\r\n    // Clone matrix\r\n  , clone: function() {\r\n      return new SVG.Matrix(this)\r\n    }\r\n    // Morph one matrix into another\r\n  , morph: function(matrix) {\r\n      // store new destination\r\n      this.destination = new SVG.Matrix(matrix)\r\n\r\n      return this\r\n    }\r\n    // Get morphed matrix at a given position\r\n  , at: function(pos) {\r\n      // make sure a destination is defined\r\n      if (!this.destination) return this\r\n\r\n      // calculate morphed matrix at a given position\r\n      var matrix = new SVG.Matrix({\r\n        a: this.a + (this.destination.a - this.a) * pos\r\n      , b: this.b + (this.destination.b - this.b) * pos\r\n      , c: this.c + (this.destination.c - this.c) * pos\r\n      , d: this.d + (this.destination.d - this.d) * pos\r\n      , e: this.e + (this.destination.e - this.e) * pos\r\n      , f: this.f + (this.destination.f - this.f) * pos\r\n      })\r\n\r\n      return matrix\r\n    }\r\n    // Multiplies by given matrix\r\n  , multiply: function(matrix) {\r\n      return new SVG.Matrix(this.native().multiply(parseMatrix(matrix).native()))\r\n    }\r\n    // Inverses matrix\r\n  , inverse: function() {\r\n      return new SVG.Matrix(this.native().inverse())\r\n    }\r\n    // Translate matrix\r\n  , translate: function(x, y) {\r\n      return new SVG.Matrix(this.native().translate(x || 0, y || 0))\r\n    }\r\n    // Scale matrix\r\n  , scale: function(x, y, cx, cy) {\r\n      // support uniformal scale\r\n      if (arguments.length == 1) {\r\n        y = x\r\n      } else if (arguments.length == 3) {\r\n        cy = cx\r\n        cx = y\r\n        y = x\r\n      }\r\n\r\n      return this.around(cx, cy, new SVG.Matrix(x, 0, 0, y, 0, 0))\r\n    }\r\n    // Rotate matrix\r\n  , rotate: function(r, cx, cy) {\r\n      // convert degrees to radians\r\n      r = SVG.utils.radians(r)\r\n\r\n      return this.around(cx, cy, new SVG.Matrix(Math.cos(r), Math.sin(r), -Math.sin(r), Math.cos(r), 0, 0))\r\n    }\r\n    // Flip matrix on x or y, at a given offset\r\n  , flip: function(a, o) {\r\n      return a == 'x' ?\r\n          this.scale(-1, 1, o, 0) :\r\n        a == 'y' ?\r\n          this.scale(1, -1, 0, o) :\r\n          this.scale(-1, -1, a, o != null ? o : a)\r\n    }\r\n    // Skew\r\n  , skew: function(x, y, cx, cy) {\r\n      // support uniformal skew\r\n      if (arguments.length == 1) {\r\n        y = x\r\n      } else if (arguments.length == 3) {\r\n        cy = cx\r\n        cx = y\r\n        y = x\r\n      }\r\n\r\n      // convert degrees to radians\r\n      x = SVG.utils.radians(x)\r\n      y = SVG.utils.radians(y)\r\n\r\n      return this.around(cx, cy, new SVG.Matrix(1, Math.tan(y), Math.tan(x), 1, 0, 0))\r\n    }\r\n    // SkewX\r\n  , skewX: function(x, cx, cy) {\r\n      return this.skew(x, 0, cx, cy)\r\n    }\r\n    // SkewY\r\n  , skewY: function(y, cx, cy) {\r\n      return this.skew(0, y, cx, cy)\r\n    }\r\n    // Transform around a center point\r\n  , around: function(cx, cy, matrix) {\r\n      return this\r\n        .multiply(new SVG.Matrix(1, 0, 0, 1, cx || 0, cy || 0))\r\n        .multiply(matrix)\r\n        .multiply(new SVG.Matrix(1, 0, 0, 1, -cx || 0, -cy || 0))\r\n    }\r\n    // Convert to native SVGMatrix\r\n  , native: function() {\r\n      // create new matrix\r\n      var matrix = SVG.parser.native.createSVGMatrix()\r\n\r\n      // update with current values\r\n      for (var i = abcdef.length - 1; i >= 0; i--)\r\n        matrix[abcdef[i]] = this[abcdef[i]]\r\n\r\n      return matrix\r\n    }\r\n    // Convert matrix to string\r\n  , toString: function() {\r\n      // Construct the matrix directly, avoid values that are too small\r\n      return 'matrix(' + float32String(this.a) + ',' + float32String(this.b)\r\n        + ',' + float32String(this.c) + ',' + float32String(this.d)\r\n        + ',' + float32String(this.e) + ',' + float32String(this.f)\r\n        + ')'\r\n    }\r\n  }\r\n\r\n  // Define parent\r\n, parent: SVG.Element\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Get current matrix\r\n    ctm: function() {\r\n      return new SVG.Matrix(this.node.getCTM())\r\n    },\r\n    // Get current screen matrix\r\n    screenCTM: function() {\r\n      /* https://bugzilla.mozilla.org/show_bug.cgi?id=1344537\r\n         This is needed because FF does not return the transformation matrix\r\n         for the inner coordinate system when getScreenCTM() is called on nested svgs.\r\n         However all other Browsers do that */\r\n      if(this instanceof SVG.Nested) {\r\n        var rect = this.rect(1,1)\r\n        var m = rect.node.getScreenCTM()\r\n        rect.remove()\r\n        return new SVG.Matrix(m)\r\n      }\r\n      return new SVG.Matrix(this.node.getScreenCTM())\r\n    }\r\n\r\n  }\r\n\r\n})\r\n\nSVG.Point = SVG.invent({\r\n  // Initialize\r\n  create: function(x,y) {\r\n    var i, source, base = {x:0, y:0}\r\n\r\n    // ensure source as object\r\n    source = Array.isArray(x) ?\r\n      {x:x[0], y:x[1]} :\r\n    typeof x === 'object' ?\r\n      {x:x.x, y:x.y} :\r\n    x != null ?\r\n      {x:x, y:(y != null ? y : x)} : base // If y has no value, then x is used has its value\r\n\r\n    // merge source\r\n    this.x = source.x\r\n    this.y = source.y\r\n  }\r\n\r\n  // Add methods\r\n, extend: {\r\n    // Clone point\r\n    clone: function() {\r\n      return new SVG.Point(this)\r\n    }\r\n    // Morph one point into another\r\n  , morph: function(x, y) {\r\n      // store new destination\r\n      this.destination = new SVG.Point(x, y)\r\n\r\n      return this\r\n    }\r\n    // Get morphed point at a given position\r\n  , at: function(pos) {\r\n      // make sure a destination is defined\r\n      if (!this.destination) return this\r\n\r\n      // calculate morphed matrix at a given position\r\n      var point = new SVG.Point({\r\n        x: this.x + (this.destination.x - this.x) * pos\r\n      , y: this.y + (this.destination.y - this.y) * pos\r\n      })\r\n\r\n      return point\r\n    }\r\n    // Convert to native SVGPoint\r\n  , native: function() {\r\n      // create new point\r\n      var point = SVG.parser.native.createSVGPoint()\r\n\r\n      // update with current values\r\n      point.x = this.x\r\n      point.y = this.y\r\n\r\n      return point\r\n    }\r\n    // transform point with matrix\r\n  , transform: function(matrix) {\r\n      return new SVG.Point(this.native().matrixTransform(matrix.native()))\r\n    }\r\n\r\n  }\r\n\r\n})\r\n\r\nSVG.extend(SVG.Element, {\r\n\r\n  // Get point\r\n  point: function(x, y) {\r\n    return new SVG.Point(x,y).transform(this.screenCTM().inverse());\r\n  }\r\n\r\n})\r\n\nSVG.extend(SVG.Element, {\r\n  // Set svg element attribute\r\n  attr: function(a, v, n) {\r\n    // act as full getter\r\n    if (a == null) {\r\n      // get an object of attributes\r\n      a = {}\r\n      v = this.node.attributes\r\n      for (n = v.length - 1; n >= 0; n--)\r\n        a[v[n].nodeName] = SVG.regex.isNumber.test(v[n].nodeValue) ? parseFloat(v[n].nodeValue) : v[n].nodeValue\r\n\r\n      return a\r\n\r\n    } else if (typeof a == 'object') {\r\n      // apply every attribute individually if an object is passed\r\n      for (v in a) this.attr(v, a[v])\r\n\r\n    } else if (v === null) {\r\n        // remove value\r\n        this.node.removeAttribute(a)\r\n\r\n    } else if (v == null) {\r\n      // act as a getter if the first and only argument is not an object\r\n      v = this.node.getAttribute(a)\r\n      return v == null ?\r\n        SVG.defaults.attrs[a] :\r\n      SVG.regex.isNumber.test(v) ?\r\n        parseFloat(v) : v\r\n\r\n    } else {\r\n      // BUG FIX: some browsers will render a stroke if a color is given even though stroke width is 0\r\n      if (a == 'stroke-width')\r\n        this.attr('stroke', parseFloat(v) > 0 ? this._stroke : null)\r\n      else if (a == 'stroke')\r\n        this._stroke = v\r\n\r\n      // convert image fill and stroke to patterns\r\n      if (a == 'fill' || a == 'stroke') {\r\n        if (SVG.regex.isImage.test(v))\r\n          v = this.doc().defs().image(v, 0, 0)\r\n\r\n        if (v instanceof SVG.Image)\r\n          v = this.doc().defs().pattern(0, 0, function() {\r\n            this.add(v)\r\n          })\r\n      }\r\n\r\n      // ensure correct numeric values (also accepts NaN and Infinity)\r\n      if (typeof v === 'number')\r\n        v = new SVG.Number(v)\r\n\r\n      // ensure full hex color\r\n      else if (SVG.Color.isColor(v))\r\n        v = new SVG.Color(v)\r\n\r\n      // parse array values\r\n      else if (Array.isArray(v))\r\n        v = new SVG.Array(v)\r\n\r\n      // if the passed attribute is leading...\r\n      if (a == 'leading') {\r\n        // ... call the leading method instead\r\n        if (this.leading)\r\n          this.leading(v)\r\n      } else {\r\n        // set given attribute on node\r\n        typeof n === 'string' ?\r\n          this.node.setAttributeNS(n, a, v.toString()) :\r\n          this.node.setAttribute(a, v.toString())\r\n      }\r\n\r\n      // rebuild if required\r\n      if (this.rebuild && (a == 'font-size' || a == 'x'))\r\n        this.rebuild(a, v)\r\n    }\r\n\r\n    return this\r\n  }\r\n})\nSVG.extend(SVG.Element, {\r\n  // Add transformations\r\n  transform: function(o, relative) {\r\n    // get target in case of the fx module, otherwise reference this\r\n    var target = this\r\n      , matrix, bbox\r\n\r\n    // act as a getter\r\n    if (typeof o !== 'object') {\r\n      // get current matrix\r\n      matrix = new SVG.Matrix(target).extract()\r\n\r\n      return typeof o === 'string' ? matrix[o] : matrix\r\n    }\r\n\r\n    // get current matrix\r\n    matrix = new SVG.Matrix(target)\r\n\r\n    // ensure relative flag\r\n    relative = !!relative || !!o.relative\r\n\r\n    // act on matrix\r\n    if (o.a != null) {\r\n      matrix = relative ?\r\n        // relative\r\n        matrix.multiply(new SVG.Matrix(o)) :\r\n        // absolute\r\n        new SVG.Matrix(o)\r\n\r\n    // act on rotation\r\n    } else if (o.rotation != null) {\r\n      // ensure centre point\r\n      ensureCentre(o, target)\r\n\r\n      // apply transformation\r\n      matrix = relative ?\r\n        // relative\r\n        matrix.rotate(o.rotation, o.cx, o.cy) :\r\n        // absolute\r\n        matrix.rotate(o.rotation - matrix.extract().rotation, o.cx, o.cy)\r\n\r\n    // act on scale\r\n    } else if (o.scale != null || o.scaleX != null || o.scaleY != null) {\r\n      // ensure centre point\r\n      ensureCentre(o, target)\r\n\r\n      // ensure scale values on both axes\r\n      o.scaleX = o.scale != null ? o.scale : o.scaleX != null ? o.scaleX : 1\r\n      o.scaleY = o.scale != null ? o.scale : o.scaleY != null ? o.scaleY : 1\r\n\r\n      if (!relative) {\r\n        // absolute; multiply inversed values\r\n        var e = matrix.extract()\r\n        o.scaleX = o.scaleX * 1 / e.scaleX\r\n        o.scaleY = o.scaleY * 1 / e.scaleY\r\n      }\r\n\r\n      matrix = matrix.scale(o.scaleX, o.scaleY, o.cx, o.cy)\r\n\r\n    // act on skew\r\n    } else if (o.skew != null || o.skewX != null || o.skewY != null) {\r\n      // ensure centre point\r\n      ensureCentre(o, target)\r\n\r\n      // ensure skew values on both axes\r\n      o.skewX = o.skew != null ? o.skew : o.skewX != null ? o.skewX : 0\r\n      o.skewY = o.skew != null ? o.skew : o.skewY != null ? o.skewY : 0\r\n\r\n      if (!relative) {\r\n        // absolute; reset skew values\r\n        var e = matrix.extract()\r\n        matrix = matrix.multiply(new SVG.Matrix().skew(e.skewX, e.skewY, o.cx, o.cy).inverse())\r\n      }\r\n\r\n      matrix = matrix.skew(o.skewX, o.skewY, o.cx, o.cy)\r\n\r\n    // act on flip\r\n    } else if (o.flip) {\r\n      if(o.flip == 'x' || o.flip == 'y') {\r\n        o.offset = o.offset == null ? target.bbox()['c' + o.flip] : o.offset\r\n      } else {\r\n        if(o.offset == null) {\r\n          bbox = target.bbox()\r\n          o.flip = bbox.cx\r\n          o.offset = bbox.cy\r\n        } else {\r\n          o.flip = o.offset\r\n        }\r\n      }\r\n\r\n      matrix = new SVG.Matrix().flip(o.flip, o.offset)\r\n\r\n    // act on translate\r\n    } else if (o.x != null || o.y != null) {\r\n      if (relative) {\r\n        // relative\r\n        matrix = matrix.translate(o.x, o.y)\r\n      } else {\r\n        // absolute\r\n        if (o.x != null) matrix.e = o.x\r\n        if (o.y != null) matrix.f = o.y\r\n      }\r\n    }\r\n\r\n    return this.attr('transform', matrix)\r\n  }\r\n})\r\n\r\nSVG.extend(SVG.FX, {\r\n  transform: function(o, relative) {\r\n    // get target in case of the fx module, otherwise reference this\r\n    var target = this.target()\r\n      , matrix, bbox\r\n\r\n    // act as a getter\r\n    if (typeof o !== 'object') {\r\n      // get current matrix\r\n      matrix = new SVG.Matrix(target).extract()\r\n\r\n      return typeof o === 'string' ? matrix[o] : matrix\r\n    }\r\n\r\n    // ensure relative flag\r\n    relative = !!relative || !!o.relative\r\n\r\n    // act on matrix\r\n    if (o.a != null) {\r\n      matrix = new SVG.Matrix(o)\r\n\r\n    // act on rotation\r\n    } else if (o.rotation != null) {\r\n      // ensure centre point\r\n      ensureCentre(o, target)\r\n\r\n      // apply transformation\r\n      matrix = new SVG.Rotate(o.rotation, o.cx, o.cy)\r\n\r\n    // act on scale\r\n    } else if (o.scale != null || o.scaleX != null || o.scaleY != null) {\r\n      // ensure centre point\r\n      ensureCentre(o, target)\r\n\r\n      // ensure scale values on both axes\r\n      o.scaleX = o.scale != null ? o.scale : o.scaleX != null ? o.scaleX : 1\r\n      o.scaleY = o.scale != null ? o.scale : o.scaleY != null ? o.scaleY : 1\r\n\r\n      matrix = new SVG.Scale(o.scaleX, o.scaleY, o.cx, o.cy)\r\n\r\n    // act on skew\r\n    } else if (o.skewX != null || o.skewY != null) {\r\n      // ensure centre point\r\n      ensureCentre(o, target)\r\n\r\n      // ensure skew values on both axes\r\n      o.skewX = o.skewX != null ? o.skewX : 0\r\n      o.skewY = o.skewY != null ? o.skewY : 0\r\n\r\n      matrix = new SVG.Skew(o.skewX, o.skewY, o.cx, o.cy)\r\n\r\n    // act on flip\r\n    } else if (o.flip) {\r\n      if(o.flip == 'x' || o.flip == 'y') {\r\n        o.offset = o.offset == null ? target.bbox()['c' + o.flip] : o.offset\r\n      } else {\r\n        if(o.offset == null) {\r\n          bbox = target.bbox()\r\n          o.flip = bbox.cx\r\n          o.offset = bbox.cy\r\n        } else {\r\n          o.flip = o.offset\r\n        }\r\n      }\r\n\r\n      matrix = new SVG.Matrix().flip(o.flip, o.offset)\r\n\r\n    // act on translate\r\n    } else if (o.x != null || o.y != null) {\r\n      matrix = new SVG.Translate(o.x, o.y)\r\n    }\r\n\r\n    if(!matrix) return this\r\n\r\n    matrix.relative = relative\r\n\r\n    this.last().transforms.push(matrix)\r\n\r\n    return this._callStart()\r\n  }\r\n})\r\n\r\nSVG.extend(SVG.Element, {\r\n  // Reset all transformations\r\n  untransform: function() {\r\n    return this.attr('transform', null)\r\n  },\r\n  // merge the whole transformation chain into one matrix and returns it\r\n  matrixify: function() {\r\n\r\n    var matrix = (this.attr('transform') || '')\r\n      // split transformations\r\n      .split(SVG.regex.transforms).slice(0,-1).map(function(str){\r\n        // generate key => value pairs\r\n        var kv = str.trim().split('(')\r\n        return [kv[0], kv[1].split(SVG.regex.delimiter).map(function(str){ return parseFloat(str) })]\r\n      })\r\n      // merge every transformation into one matrix\r\n      .reduce(function(matrix, transform){\r\n\r\n        if(transform[0] == 'matrix') return matrix.multiply(arrayToMatrix(transform[1]))\r\n        return matrix[transform[0]].apply(matrix, transform[1])\r\n\r\n      }, new SVG.Matrix())\r\n\r\n    return matrix\r\n  },\r\n  // add an element to another parent without changing the visual representation on the screen\r\n  toParent: function(parent) {\r\n    if(this == parent) return this\r\n    var ctm = this.screenCTM()\r\n    var pCtm = parent.screenCTM().inverse()\r\n\r\n    this.addTo(parent).untransform().transform(pCtm.multiply(ctm))\r\n\r\n    return this\r\n  },\r\n  // same as above with parent equals root-svg\r\n  toDoc: function() {\r\n    return this.toParent(this.doc())\r\n  }\r\n\r\n})\r\n\r\nSVG.Transformation = SVG.invent({\r\n\r\n  create: function(source, inversed){\r\n\r\n    if(arguments.length > 1 && typeof inversed != 'boolean'){\r\n      return this.constructor.call(this, [].slice.call(arguments))\r\n    }\r\n\r\n    if(Array.isArray(source)){\r\n      for(var i = 0, len = this.arguments.length; i < len; ++i){\r\n        this[this.arguments[i]] = source[i]\r\n      }\r\n    } else if(typeof source == 'object'){\r\n      for(var i = 0, len = this.arguments.length; i < len; ++i){\r\n        this[this.arguments[i]] = source[this.arguments[i]]\r\n      }\r\n    }\r\n\r\n    this.inversed = false\r\n\r\n    if(inversed === true){\r\n      this.inversed = true\r\n    }\r\n\r\n  }\r\n\r\n, extend: {\r\n\r\n    arguments: []\r\n  , method: ''\r\n\r\n  , at: function(pos){\r\n\r\n      var params = []\r\n\r\n      for(var i = 0, len = this.arguments.length; i < len; ++i){\r\n        params.push(this[this.arguments[i]])\r\n      }\r\n\r\n      var m = this._undo || new SVG.Matrix()\r\n\r\n      m = new SVG.Matrix().morph(SVG.Matrix.prototype[this.method].apply(m, params)).at(pos)\r\n\r\n      return this.inversed ? m.inverse() : m\r\n\r\n    }\r\n\r\n  , undo: function(o){\r\n      for(var i = 0, len = this.arguments.length; i < len; ++i){\r\n        o[this.arguments[i]] = typeof this[this.arguments[i]] == 'undefined' ? 0 : o[this.arguments[i]]\r\n      }\r\n\r\n      // The method SVG.Matrix.extract which was used before calling this\r\n      // method to obtain a value for the parameter o doesn't return a cx and\r\n      // a cy so we use the ones that were provided to this object at its creation\r\n      o.cx = this.cx\r\n      o.cy = this.cy\r\n\r\n      this._undo = new SVG[capitalize(this.method)](o, true).at(1)\r\n\r\n      return this\r\n    }\r\n\r\n  }\r\n\r\n})\r\n\r\nSVG.Translate = SVG.invent({\r\n\r\n  parent: SVG.Matrix\r\n, inherit: SVG.Transformation\r\n\r\n, create: function(source, inversed){\r\n    this.constructor.apply(this, [].slice.call(arguments))\r\n  }\r\n\r\n, extend: {\r\n    arguments: ['transformedX', 'transformedY']\r\n  , method: 'translate'\r\n  }\r\n\r\n})\r\n\r\nSVG.Rotate = SVG.invent({\r\n\r\n  parent: SVG.Matrix\r\n, inherit: SVG.Transformation\r\n\r\n, create: function(source, inversed){\r\n    this.constructor.apply(this, [].slice.call(arguments))\r\n  }\r\n\r\n, extend: {\r\n    arguments: ['rotation', 'cx', 'cy']\r\n  , method: 'rotate'\r\n  , at: function(pos){\r\n      var m = new SVG.Matrix().rotate(new SVG.Number().morph(this.rotation - (this._undo ? this._undo.rotation : 0)).at(pos), this.cx, this.cy)\r\n      return this.inversed ? m.inverse() : m\r\n    }\r\n  , undo: function(o){\r\n      this._undo = o\r\n      return this\r\n    }\r\n  }\r\n\r\n})\r\n\r\nSVG.Scale = SVG.invent({\r\n\r\n  parent: SVG.Matrix\r\n, inherit: SVG.Transformation\r\n\r\n, create: function(source, inversed){\r\n    this.constructor.apply(this, [].slice.call(arguments))\r\n  }\r\n\r\n, extend: {\r\n    arguments: ['scaleX', 'scaleY', 'cx', 'cy']\r\n  , method: 'scale'\r\n  }\r\n\r\n})\r\n\r\nSVG.Skew = SVG.invent({\r\n\r\n  parent: SVG.Matrix\r\n, inherit: SVG.Transformation\r\n\r\n, create: function(source, inversed){\r\n    this.constructor.apply(this, [].slice.call(arguments))\r\n  }\r\n\r\n, extend: {\r\n    arguments: ['skewX', 'skewY', 'cx', 'cy']\r\n  , method: 'skew'\r\n  }\r\n\r\n})\r\n\nSVG.extend(SVG.Element, {\r\n  // Dynamic style generator\r\n  style: function(s, v) {\r\n    if (arguments.length == 0) {\r\n      // get full style\r\n      return this.node.style.cssText || ''\r\n\r\n    } else if (arguments.length < 2) {\r\n      // apply every style individually if an object is passed\r\n      if (typeof s == 'object') {\r\n        for (v in s) this.style(v, s[v])\r\n\r\n      } else if (SVG.regex.isCss.test(s)) {\r\n        // parse css string\r\n        s = s.split(/\\s*;\\s*/)\r\n          // filter out suffix ; and stuff like ;;\r\n          .filter(function(e) { return !!e })\r\n          .map(function(e){ return e.split(/\\s*:\\s*/) })\r\n\r\n        // apply every definition individually\r\n        while (v = s.pop()) {\r\n          this.style(v[0], v[1])\r\n        }\r\n      } else {\r\n        // act as a getter if the first and only argument is not an object\r\n        return this.node.style[camelCase(s)]\r\n      }\r\n\r\n    } else {\r\n      this.node.style[camelCase(s)] = v === null || SVG.regex.isBlank.test(v) ? '' : v\r\n    }\r\n\r\n    return this\r\n  }\r\n})\nSVG.Parent = SVG.invent({\r\n  // Initialize node\r\n  create: function(element) {\r\n    this.constructor.call(this, element)\r\n  }\r\n\r\n  // Inherit from\r\n, inherit: SVG.Element\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Returns all child elements\r\n    children: function() {\r\n      return SVG.utils.map(SVG.utils.filterSVGElements(this.node.childNodes), function(node) {\r\n        return SVG.adopt(node)\r\n      })\r\n    }\r\n    // Add given element at a position\r\n  , add: function(element, i) {\r\n      if (i == null)\r\n        this.node.appendChild(element.node)\r\n      else if (element.node != this.node.childNodes[i])\r\n        this.node.insertBefore(element.node, this.node.childNodes[i])\r\n\r\n      return this\r\n    }\r\n    // Basically does the same as `add()` but returns the added element instead\r\n  , put: function(element, i) {\r\n      this.add(element, i)\r\n      return element\r\n    }\r\n    // Checks if the given element is a child\r\n  , has: function(element) {\r\n      return this.index(element) >= 0\r\n    }\r\n    // Gets index of given element\r\n  , index: function(element) {\r\n      return [].slice.call(this.node.childNodes).indexOf(element.node)\r\n    }\r\n    // Get a element at the given index\r\n  , get: function(i) {\r\n      return SVG.adopt(this.node.childNodes[i])\r\n    }\r\n    // Get first child\r\n  , first: function() {\r\n      return this.get(0)\r\n    }\r\n    // Get the last child\r\n  , last: function() {\r\n      return this.get(this.node.childNodes.length - 1)\r\n    }\r\n    // Iterates over all children and invokes a given block\r\n  , each: function(block, deep) {\r\n      var i, il\r\n        , children = this.children()\r\n\r\n      for (i = 0, il = children.length; i < il; i++) {\r\n        if (children[i] instanceof SVG.Element)\r\n          block.apply(children[i], [i, children])\r\n\r\n        if (deep && (children[i] instanceof SVG.Container))\r\n          children[i].each(block, deep)\r\n      }\r\n\r\n      return this\r\n    }\r\n    // Remove a given child\r\n  , removeElement: function(element) {\r\n      this.node.removeChild(element.node)\r\n\r\n      return this\r\n    }\r\n    // Remove all elements in this container\r\n  , clear: function() {\r\n      // remove children\r\n      while(this.node.hasChildNodes())\r\n        this.node.removeChild(this.node.lastChild)\r\n\r\n      // remove defs reference\r\n      delete this._defs\r\n\r\n      return this\r\n    }\r\n  , // Get defs\r\n    defs: function() {\r\n      return this.doc().defs()\r\n    }\r\n  }\r\n\r\n})\r\n\nSVG.extend(SVG.Parent, {\r\n\r\n  ungroup: function(parent, depth) {\r\n    if(depth === 0 || this instanceof SVG.Defs || this.node == SVG.parser.draw) return this\r\n\r\n    parent = parent || (this instanceof SVG.Doc ? this : this.parent(SVG.Parent))\r\n    depth = depth || Infinity\r\n\r\n    this.each(function(){\r\n      if(this instanceof SVG.Defs) return this\r\n      if(this instanceof SVG.Parent) return this.ungroup(parent, depth-1)\r\n      return this.toParent(parent)\r\n    })\r\n\r\n    this.node.firstChild || this.remove()\r\n\r\n    return this\r\n  },\r\n\r\n  flatten: function(parent, depth) {\r\n    return this.ungroup(parent, depth)\r\n  }\r\n\r\n})\nSVG.Container = SVG.invent({\r\n  // Initialize node\r\n  create: function(element) {\r\n    this.constructor.call(this, element)\r\n  }\r\n\r\n  // Inherit from\r\n, inherit: SVG.Parent\r\n\r\n})\n\r\nSVG.ViewBox = SVG.invent({\r\n\r\n  create: function(source) {\r\n    var i, base = [0, 0, 0, 0]\r\n\r\n    var x, y, width, height, box, view, we, he\r\n      , wm   = 1 // width multiplier\r\n      , hm   = 1 // height multiplier\r\n      , reg  = /[+-]?(?:\\d+(?:\\.\\d*)?|\\.\\d+)(?:e[+-]?\\d+)?/gi\r\n\r\n    if(source instanceof SVG.Element){\r\n\r\n      we = source\r\n      he = source\r\n      view = (source.attr('viewBox') || '').match(reg)\r\n      box = source.bbox\r\n\r\n      // get dimensions of current node\r\n      width  = new SVG.Number(source.width())\r\n      height = new SVG.Number(source.height())\r\n\r\n      // find nearest non-percentual dimensions\r\n      while (width.unit == '%') {\r\n        wm *= width.value\r\n        width = new SVG.Number(we instanceof SVG.Doc ? we.parent().offsetWidth : we.parent().width())\r\n        we = we.parent()\r\n      }\r\n      while (height.unit == '%') {\r\n        hm *= height.value\r\n        height = new SVG.Number(he instanceof SVG.Doc ? he.parent().offsetHeight : he.parent().height())\r\n        he = he.parent()\r\n      }\r\n\r\n      // ensure defaults\r\n      this.x      = 0\r\n      this.y      = 0\r\n      this.width  = width  * wm\r\n      this.height = height * hm\r\n      this.zoom   = 1\r\n\r\n      if (view) {\r\n        // get width and height from viewbox\r\n        x      = parseFloat(view[0])\r\n        y      = parseFloat(view[1])\r\n        width  = parseFloat(view[2])\r\n        height = parseFloat(view[3])\r\n\r\n        // calculate zoom accoring to viewbox\r\n        this.zoom = ((this.width / this.height) > (width / height)) ?\r\n          this.height / height :\r\n          this.width  / width\r\n\r\n        // calculate real pixel dimensions on parent SVG.Doc element\r\n        this.x      = x\r\n        this.y      = y\r\n        this.width  = width\r\n        this.height = height\r\n\r\n      }\r\n\r\n    }else{\r\n\r\n      // ensure source as object\r\n      source = typeof source === 'string' ?\r\n        source.match(reg).map(function(el){ return parseFloat(el) }) :\r\n      Array.isArray(source) ?\r\n        source :\r\n      typeof source == 'object' ?\r\n        [source.x, source.y, source.width, source.height] :\r\n      arguments.length == 4 ?\r\n        [].slice.call(arguments) :\r\n        base\r\n\r\n      this.x = source[0]\r\n      this.y = source[1]\r\n      this.width = source[2]\r\n      this.height = source[3]\r\n    }\r\n\r\n\r\n  }\r\n\r\n, extend: {\r\n\r\n    toString: function() {\r\n      return this.x + ' ' + this.y + ' ' + this.width + ' ' + this.height\r\n    }\r\n  , morph: function(x, y, width, height){\r\n      this.destination = new SVG.ViewBox(x, y, width, height)\r\n      return this\r\n    }\r\n\r\n  , at: function(pos) {\r\n\r\n      if(!this.destination) return this\r\n\r\n      return new SVG.ViewBox([\r\n          this.x + (this.destination.x - this.x) * pos\r\n        , this.y + (this.destination.y - this.y) * pos\r\n        , this.width + (this.destination.width - this.width) * pos\r\n        , this.height + (this.destination.height - this.height) * pos\r\n      ])\r\n\r\n    }\r\n\r\n  }\r\n\r\n  // Define parent\r\n, parent: SVG.Container\r\n\r\n  // Add parent method\r\n, construct: {\r\n\r\n    // get/set viewbox\r\n    viewbox: function(x, y, width, height) {\r\n      if (arguments.length == 0)\r\n        // act as a getter if there are no arguments\r\n        return new SVG.ViewBox(this)\r\n\r\n      // otherwise act as a setter\r\n      return this.attr('viewBox', new SVG.ViewBox(x, y, width, height))\r\n    }\r\n\r\n  }\r\n\r\n})\n// Add events to elements\r\n\r\n;[ 'click',\r\n  'dblclick',\r\n  'mousedown',\r\n  'mouseup',\r\n  'mouseover',\r\n  'mouseout',\r\n  'mousemove',\r\n  'mouseenter',\r\n  'mouseleave',\r\n  'touchstart',\r\n  'touchmove',\r\n  'touchleave',\r\n  'touchend',\r\n  'touchcancel' ].forEach(function (event) {\r\n    // add event to SVG.Element\r\n    SVG.Element.prototype[event] = function (f) {\r\n      // bind event to element rather than element node\r\n      if (f == null) {\r\n        SVG.off(this, event)\r\n      } else {\r\n        SVG.on(this, event, f)\r\n      }\r\n      return this\r\n    }\r\n  })\r\n\r\nSVG.listenerId = 0\r\n\r\n// Add event binder in the SVG namespace\r\nSVG.on = function (node, events, listener, binding, options) {\r\n  var l = listener.bind(binding || node)\r\n  var n = node instanceof SVG.Element ? node.node : node\r\n\r\n  // ensure instance object for nodes which are not adopted\r\n  n.instance = n.instance || {_events: {}}\r\n\r\n  var bag = n.instance._events\r\n\r\n  // add id to listener\r\n  if (!listener._svgjsListenerId) { listener._svgjsListenerId = ++SVG.listenerId }\r\n\r\n  events.split(SVG.regex.delimiter).forEach(function (event) {\r\n    var ev = event.split('.')[0]\r\n    var ns = event.split('.')[1] || '*'\r\n\r\n    // ensure valid object\r\n    bag[ev] = bag[ev] || {}\r\n    bag[ev][ns] = bag[ev][ns] || {}\r\n\r\n    // reference listener\r\n    bag[ev][ns][listener._svgjsListenerId] = l\r\n\r\n    // add listener\r\n    n.addEventListener(ev, l, options || false)\r\n  })\r\n}\r\n\r\n// Add event unbinder in the SVG namespace\r\nSVG.off = function (node, events, listener, options) {\r\n  var n = node instanceof SVG.Element ? node.node : node\r\n  if (!n.instance) return\r\n\r\n  // listener can be a function or a number\r\n  if (typeof listener === 'function') {\r\n    listener = listener._svgjsListenerId\r\n    if (!listener) return\r\n  }\r\n\r\n  var bag = n.instance._events\r\n\r\n  ;(events || '').split(SVG.regex.delimiter).forEach(function (event) {\r\n    var ev = event && event.split('.')[0]\r\n    var ns = event && event.split('.')[1]\r\n    var namespace, l\r\n\r\n    if (listener) {\r\n      // remove listener reference\r\n      if (bag[ev] && bag[ev][ns || '*']) {\r\n        // removeListener\r\n        n.removeEventListener(ev, bag[ev][ns || '*'][listener], options || false)\r\n\r\n        delete bag[ev][ns || '*'][listener]\r\n      }\r\n    } else if (ev && ns) {\r\n      // remove all listeners for a namespaced event\r\n      if (bag[ev] && bag[ev][ns]) {\r\n        for (l in bag[ev][ns]) { SVG.off(n, [ev, ns].join('.'), l) }\r\n\r\n        delete bag[ev][ns]\r\n      }\r\n    } else if (ns) {\r\n      // remove all listeners for a specific namespace\r\n      for (event in bag) {\r\n        for (namespace in bag[event]) {\r\n          if (ns === namespace) { SVG.off(n, [event, ns].join('.')) }\r\n        }\r\n      }\r\n    } else if (ev) {\r\n      // remove all listeners for the event\r\n      if (bag[ev]) {\r\n        for (namespace in bag[ev]) { SVG.off(n, [ev, namespace].join('.')) }\r\n\r\n        delete bag[ev]\r\n      }\r\n    } else {\r\n      // remove all listeners on a given node\r\n      for (event in bag) { SVG.off(n, event) }\r\n\r\n      n.instance._events = {}\r\n    }\r\n  })\r\n}\r\n\r\nSVG.extend(SVG.Element, {\r\n  // Bind given event to listener\r\n  on: function (event, listener, binding, options) {\r\n    SVG.on(this, event, listener, binding, options)\r\n    return this\r\n  },\r\n  // Unbind event from listener\r\n  off: function (event, listener) {\r\n    SVG.off(this.node, event, listener)\r\n    return this\r\n  },\r\n  fire: function (event, data) {\r\n    // Dispatch event\r\n    if (event instanceof window.Event) {\r\n      this.node.dispatchEvent(event)\r\n    } else {\r\n      this.node.dispatchEvent(event = new SVG.CustomEvent(event, {detail: data, cancelable: true}))\r\n    }\r\n    this._event = event\r\n    return this\r\n  },\r\n  event: function() {\r\n    return this._event\r\n  }\r\n})\r\n\n\r\nSVG.Defs = SVG.invent({\r\n  // Initialize node\r\n  create: 'defs'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n})\nSVG.G = SVG.invent({\r\n  // Initialize node\r\n  create: 'g'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Move over x-axis\r\n    x: function(x) {\r\n      return x == null ? this.transform('x') : this.transform({ x: x - this.x() }, true)\r\n    }\r\n    // Move over y-axis\r\n  , y: function(y) {\r\n      return y == null ? this.transform('y') : this.transform({ y: y - this.y() }, true)\r\n    }\r\n    // Move by center over x-axis\r\n  , cx: function(x) {\r\n      return x == null ? this.gbox().cx : this.x(x - this.gbox().width / 2)\r\n    }\r\n    // Move by center over y-axis\r\n  , cy: function(y) {\r\n      return y == null ? this.gbox().cy : this.y(y - this.gbox().height / 2)\r\n    }\r\n  , gbox: function() {\r\n\r\n      var bbox  = this.bbox()\r\n        , trans = this.transform()\r\n\r\n      bbox.x  += trans.x\r\n      bbox.x2 += trans.x\r\n      bbox.cx += trans.x\r\n\r\n      bbox.y  += trans.y\r\n      bbox.y2 += trans.y\r\n      bbox.cy += trans.y\r\n\r\n      return bbox\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create a group element\r\n    group: function() {\r\n      return this.put(new SVG.G)\r\n    }\r\n  }\r\n})\r\n\nSVG.Doc = SVG.invent({\r\n  // Initialize node\r\n  create: function(element) {\r\n    if (element) {\r\n      // ensure the presence of a dom element\r\n      element = typeof element == 'string' ?\r\n        document.getElementById(element) :\r\n        element\r\n\r\n      // If the target is an svg element, use that element as the main wrapper.\r\n      // This allows svg.js to work with svg documents as well.\r\n      if (element.nodeName == 'svg') {\r\n        this.constructor.call(this, element)\r\n      } else {\r\n        this.constructor.call(this, SVG.create('svg'))\r\n        element.appendChild(this.node)\r\n        this.size('100%', '100%')\r\n      }\r\n\r\n      // set svg element attributes and ensure defs node\r\n      this.namespace().defs()\r\n    }\r\n  }\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Add namespaces\r\n    namespace: function() {\r\n      return this\r\n        .attr({ xmlns: SVG.ns, version: '1.1' })\r\n        .attr('xmlns:xlink', SVG.xlink, SVG.xmlns)\r\n        .attr('xmlns:svgjs', SVG.svgjs, SVG.xmlns)\r\n    }\r\n    // Creates and returns defs element\r\n  , defs: function() {\r\n      if (!this._defs) {\r\n        var defs\r\n\r\n        // Find or create a defs element in this instance\r\n        if (defs = this.node.getElementsByTagName('defs')[0])\r\n          this._defs = SVG.adopt(defs)\r\n        else\r\n          this._defs = new SVG.Defs\r\n\r\n        // Make sure the defs node is at the end of the stack\r\n        this.node.appendChild(this._defs.node)\r\n      }\r\n\r\n      return this._defs\r\n    }\r\n    // custom parent method\r\n  , parent: function() {\r\n      if(!this.node.parentNode || this.node.parentNode.nodeName == '#document' || this.node.parentNode.nodeName == '#document-fragment') return null\r\n      return this.node.parentNode\r\n    }\r\n    // Fix for possible sub-pixel offset. See:\r\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=608812\r\n  , spof: function() {\r\n      var pos = this.node.getScreenCTM()\r\n\r\n      if (pos)\r\n        this\r\n          .style('left', (-pos.e % 1) + 'px')\r\n          .style('top',  (-pos.f % 1) + 'px')\r\n\r\n      return this\r\n    }\r\n\r\n      // Removes the doc from the DOM\r\n  , remove: function() {\r\n      if(this.parent()) {\r\n        this.parent().removeChild(this.node)\r\n      }\r\n\r\n      return this\r\n    }\r\n  , clear: function() {\r\n      // remove children\r\n      while(this.node.hasChildNodes())\r\n        this.node.removeChild(this.node.lastChild)\r\n\r\n      // remove defs reference\r\n      delete this._defs\r\n\r\n      // add back parser\r\n      if(!SVG.parser.draw.parentNode)\r\n        this.node.appendChild(SVG.parser.draw)\r\n\r\n      return this\r\n    }\r\n  , clone: function (parent) {\r\n      // write dom data to the dom so the clone can pickup the data\r\n      this.writeDataToDom()\r\n\r\n      // get reference to node\r\n      var node = this.node\r\n\r\n      // clone element and assign new id\r\n      var clone = assignNewId(node.cloneNode(true))\r\n\r\n      // insert the clone in the given parent or after myself\r\n      if(parent) {\r\n        (parent.node || parent).appendChild(clone.node)\r\n      } else {\r\n        node.parentNode.insertBefore(clone.node, node.nextSibling)\r\n      }\r\n\r\n      return clone\r\n    }\r\n  }\r\n\r\n})\r\n\n// ### This module adds backward / forward functionality to elements.\r\n\r\n//\r\nSVG.extend(SVG.Element, {\r\n  // Get all siblings, including myself\r\n  siblings: function() {\r\n    return this.parent().children()\r\n  }\r\n  // Get the curent position siblings\r\n, position: function() {\r\n    return this.parent().index(this)\r\n  }\r\n  // Get the next element (will return null if there is none)\r\n, next: function() {\r\n    return this.siblings()[this.position() + 1]\r\n  }\r\n  // Get the next element (will return null if there is none)\r\n, previous: function() {\r\n    return this.siblings()[this.position() - 1]\r\n  }\r\n  // Send given element one step forward\r\n, forward: function() {\r\n    var i = this.position() + 1\r\n      , p = this.parent()\r\n\r\n    // move node one step forward\r\n    p.removeElement(this).add(this, i)\r\n\r\n    // make sure defs node is always at the top\r\n    if (p instanceof SVG.Doc)\r\n      p.node.appendChild(p.defs().node)\r\n\r\n    return this\r\n  }\r\n  // Send given element one step backward\r\n, backward: function() {\r\n    var i = this.position()\r\n\r\n    if (i > 0)\r\n      this.parent().removeElement(this).add(this, i - 1)\r\n\r\n    return this\r\n  }\r\n  // Send given element all the way to the front\r\n, front: function() {\r\n    var p = this.parent()\r\n\r\n    // Move node forward\r\n    p.node.appendChild(this.node)\r\n\r\n    // Make sure defs node is always at the top\r\n    if (p instanceof SVG.Doc)\r\n      p.node.appendChild(p.defs().node)\r\n\r\n    return this\r\n  }\r\n  // Send given element all the way to the back\r\n, back: function() {\r\n    if (this.position() > 0)\r\n      this.parent().removeElement(this).add(this, 0)\r\n\r\n    return this\r\n  }\r\n  // Inserts a given element before the targeted element\r\n, before: function(element) {\r\n    element.remove()\r\n\r\n    var i = this.position()\r\n\r\n    this.parent().add(element, i)\r\n\r\n    return this\r\n  }\r\n  // Insters a given element after the targeted element\r\n, after: function(element) {\r\n    element.remove()\r\n\r\n    var i = this.position()\r\n\r\n    this.parent().add(element, i + 1)\r\n\r\n    return this\r\n  }\r\n\r\n})\nSVG.Mask = SVG.invent({\r\n  // Initialize node\r\n  create: function() {\r\n    this.constructor.call(this, SVG.create('mask'))\r\n\r\n    // keep references to masked elements\r\n    this.targets = []\r\n  }\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Unmask all masked elements and remove itself\r\n    remove: function() {\r\n      // unmask all targets\r\n      for (var i = this.targets.length - 1; i >= 0; i--)\r\n        if (this.targets[i])\r\n          this.targets[i].unmask()\r\n      this.targets = []\r\n\r\n      // remove mask from parent\r\n      SVG.Element.prototype.remove.call(this)\r\n\r\n      return this\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create masking element\r\n    mask: function() {\r\n      return this.defs().put(new SVG.Mask)\r\n    }\r\n  }\r\n})\r\n\r\n\r\nSVG.extend(SVG.Element, {\r\n  // Distribute mask to svg element\r\n  maskWith: function(element) {\r\n    // use given mask or create a new one\r\n    this.masker = element instanceof SVG.Mask ? element : this.parent().mask().add(element)\r\n\r\n    // store reverence on self in mask\r\n    this.masker.targets.push(this)\r\n\r\n    // apply mask\r\n    return this.attr('mask', 'url(\"#' + this.masker.attr('id') + '\")')\r\n  }\r\n  // Unmask element\r\n, unmask: function() {\r\n    delete this.masker\r\n    return this.attr('mask', null)\r\n  }\r\n\r\n})\r\n\nSVG.ClipPath = SVG.invent({\r\n  // Initialize node\r\n  create: function() {\r\n    this.constructor.call(this, SVG.create('clipPath'))\r\n\r\n    // keep references to clipped elements\r\n    this.targets = []\r\n  }\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Unclip all clipped elements and remove itself\r\n    remove: function() {\r\n      // unclip all targets\r\n      for (var i = this.targets.length - 1; i >= 0; i--)\r\n        if (this.targets[i])\r\n          this.targets[i].unclip()\r\n      this.targets = []\r\n\r\n      // remove clipPath from parent\r\n      this.parent().removeElement(this)\r\n\r\n      return this\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create clipping element\r\n    clip: function() {\r\n      return this.defs().put(new SVG.ClipPath)\r\n    }\r\n  }\r\n})\r\n\r\n//\r\nSVG.extend(SVG.Element, {\r\n  // Distribute clipPath to svg element\r\n  clipWith: function(element) {\r\n    // use given clip or create a new one\r\n    this.clipper = element instanceof SVG.ClipPath ? element : this.parent().clip().add(element)\r\n\r\n    // store reverence on self in mask\r\n    this.clipper.targets.push(this)\r\n\r\n    // apply mask\r\n    return this.attr('clip-path', 'url(\"#' + this.clipper.attr('id') + '\")')\r\n  }\r\n  // Unclip element\r\n, unclip: function() {\r\n    delete this.clipper\r\n    return this.attr('clip-path', null)\r\n  }\r\n\r\n})\nSVG.Gradient = SVG.invent({\r\n  // Initialize node\r\n  create: function(type) {\r\n    this.constructor.call(this, SVG.create(type + 'Gradient'))\r\n\r\n    // store type\r\n    this.type = type\r\n  }\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Add a color stop\r\n    at: function(offset, color, opacity) {\r\n      return this.put(new SVG.Stop).update(offset, color, opacity)\r\n    }\r\n    // Update gradient\r\n  , update: function(block) {\r\n      // remove all stops\r\n      this.clear()\r\n\r\n      // invoke passed block\r\n      if (typeof block == 'function')\r\n        block.call(this, this)\r\n\r\n      return this\r\n    }\r\n    // Return the fill id\r\n  , fill: function() {\r\n      return 'url(#' + this.id() + ')'\r\n    }\r\n    // Alias string convertion to fill\r\n  , toString: function() {\r\n      return this.fill()\r\n    }\r\n    // custom attr to handle transform\r\n  , attr: function(a, b, c) {\r\n      if(a == 'transform') a = 'gradientTransform'\r\n      return SVG.Container.prototype.attr.call(this, a, b, c)\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create gradient element in defs\r\n    gradient: function(type, block) {\r\n      return this.defs().gradient(type, block)\r\n    }\r\n  }\r\n})\r\n\r\n// Add animatable methods to both gradient and fx module\r\nSVG.extend(SVG.Gradient, SVG.FX, {\r\n  // From position\r\n  from: function(x, y) {\r\n    return (this._target || this).type == 'radial' ?\r\n      this.attr({ fx: new SVG.Number(x), fy: new SVG.Number(y) }) :\r\n      this.attr({ x1: new SVG.Number(x), y1: new SVG.Number(y) })\r\n  }\r\n  // To position\r\n, to: function(x, y) {\r\n    return (this._target || this).type == 'radial' ?\r\n      this.attr({ cx: new SVG.Number(x), cy: new SVG.Number(y) }) :\r\n      this.attr({ x2: new SVG.Number(x), y2: new SVG.Number(y) })\r\n  }\r\n})\r\n\r\n// Base gradient generation\r\nSVG.extend(SVG.Defs, {\r\n  // define gradient\r\n  gradient: function(type, block) {\r\n    return this.put(new SVG.Gradient(type)).update(block)\r\n  }\r\n\r\n})\r\n\r\nSVG.Stop = SVG.invent({\r\n  // Initialize node\r\n  create: 'stop'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Element\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // add color stops\r\n    update: function(o) {\r\n      if (typeof o == 'number' || o instanceof SVG.Number) {\r\n        o = {\r\n          offset:  arguments[0]\r\n        , color:   arguments[1]\r\n        , opacity: arguments[2]\r\n        }\r\n      }\r\n\r\n      // set attributes\r\n      if (o.opacity != null) this.attr('stop-opacity', o.opacity)\r\n      if (o.color   != null) this.attr('stop-color', o.color)\r\n      if (o.offset  != null) this.attr('offset', new SVG.Number(o.offset))\r\n\r\n      return this\r\n    }\r\n  }\r\n\r\n})\r\n\nSVG.Pattern = SVG.invent({\r\n  // Initialize node\r\n  create: 'pattern'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Return the fill id\r\n    fill: function() {\r\n      return 'url(#' + this.id() + ')'\r\n    }\r\n    // Update pattern by rebuilding\r\n  , update: function(block) {\r\n      // remove content\r\n      this.clear()\r\n\r\n      // invoke passed block\r\n      if (typeof block == 'function')\r\n        block.call(this, this)\r\n\r\n      return this\r\n    }\r\n    // Alias string convertion to fill\r\n  , toString: function() {\r\n      return this.fill()\r\n    }\r\n    // custom attr to handle transform\r\n  , attr: function(a, b, c) {\r\n      if(a == 'transform') a = 'patternTransform'\r\n      return SVG.Container.prototype.attr.call(this, a, b, c)\r\n    }\r\n\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create pattern element in defs\r\n    pattern: function(width, height, block) {\r\n      return this.defs().pattern(width, height, block)\r\n    }\r\n  }\r\n})\r\n\r\nSVG.extend(SVG.Defs, {\r\n  // Define gradient\r\n  pattern: function(width, height, block) {\r\n    return this.put(new SVG.Pattern).update(block).attr({\r\n      x:            0\r\n    , y:            0\r\n    , width:        width\r\n    , height:       height\r\n    , patternUnits: 'userSpaceOnUse'\r\n    })\r\n  }\r\n\r\n})\nSVG.Shape = SVG.invent({\r\n  // Initialize node\r\n  create: function(element) {\r\n    this.constructor.call(this, element)\r\n  }\r\n\r\n  // Inherit from\r\n, inherit: SVG.Element\r\n\r\n})\n\r\nSVG.Bare = SVG.invent({\r\n  // Initialize\r\n  create: function(element, inherit) {\r\n    // construct element\r\n    this.constructor.call(this, SVG.create(element))\r\n\r\n    // inherit custom methods\r\n    if (inherit)\r\n      for (var method in inherit.prototype)\r\n        if (typeof inherit.prototype[method] === 'function')\r\n          this[method] = inherit.prototype[method]\r\n  }\r\n\r\n  // Inherit from\r\n, inherit: SVG.Element\r\n\r\n  // Add methods\r\n, extend: {\r\n    // Insert some plain text\r\n    words: function(text) {\r\n      // remove contents\r\n      while (this.node.hasChildNodes())\r\n        this.node.removeChild(this.node.lastChild)\r\n\r\n      // create text node\r\n      this.node.appendChild(document.createTextNode(text))\r\n\r\n      return this\r\n    }\r\n  }\r\n})\r\n\r\n\r\nSVG.extend(SVG.Parent, {\r\n  // Create an element that is not described by SVG.js\r\n  element: function(element, inherit) {\r\n    return this.put(new SVG.Bare(element, inherit))\r\n  }\r\n})\r\n\nSVG.Symbol = SVG.invent({\r\n  // Initialize node\r\n  create: 'symbol'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n, construct: {\r\n    // create symbol\r\n    symbol: function() {\r\n      return this.put(new SVG.Symbol)\r\n    }\r\n  }\r\n})\r\n\nSVG.Use = SVG.invent({\r\n  // Initialize node\r\n  create: 'use'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Use element as a reference\r\n    element: function(element, file) {\r\n      // Set lined element\r\n      return this.attr('href', (file || '') + '#' + element, SVG.xlink)\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create a use element\r\n    use: function(element, file) {\r\n      return this.put(new SVG.Use).element(element, file)\r\n    }\r\n  }\r\n})\nSVG.Rect = SVG.invent({\r\n  // Initialize node\r\n  create: 'rect'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create a rect element\r\n    rect: function(width, height) {\r\n      return this.put(new SVG.Rect()).size(width, height)\r\n    }\r\n  }\r\n})\nSVG.Circle = SVG.invent({\r\n  // Initialize node\r\n  create: 'circle'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create circle element, based on ellipse\r\n    circle: function(size) {\r\n      return this.put(new SVG.Circle).rx(new SVG.Number(size).divide(2)).move(0, 0)\r\n    }\r\n  }\r\n})\r\n\r\nSVG.extend(SVG.Circle, SVG.FX, {\r\n  // Radius x value\r\n  rx: function(rx) {\r\n    return this.attr('r', rx)\r\n  }\r\n  // Alias radius x value\r\n, ry: function(ry) {\r\n    return this.rx(ry)\r\n  }\r\n})\r\n\r\nSVG.Ellipse = SVG.invent({\r\n  // Initialize node\r\n  create: 'ellipse'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create an ellipse\r\n    ellipse: function(width, height) {\r\n      return this.put(new SVG.Ellipse).size(width, height).move(0, 0)\r\n    }\r\n  }\r\n})\r\n\r\nSVG.extend(SVG.Ellipse, SVG.Rect, SVG.FX, {\r\n  // Radius x value\r\n  rx: function(rx) {\r\n    return this.attr('rx', rx)\r\n  }\r\n  // Radius y value\r\n, ry: function(ry) {\r\n    return this.attr('ry', ry)\r\n  }\r\n})\r\n\r\n// Add common method\r\nSVG.extend(SVG.Circle, SVG.Ellipse, {\r\n    // Move over x-axis\r\n    x: function(x) {\r\n      return x == null ? this.cx() - this.rx() : this.cx(x + this.rx())\r\n    }\r\n    // Move over y-axis\r\n  , y: function(y) {\r\n      return y == null ? this.cy() - this.ry() : this.cy(y + this.ry())\r\n    }\r\n    // Move by center over x-axis\r\n  , cx: function(x) {\r\n      return x == null ? this.attr('cx') : this.attr('cx', x)\r\n    }\r\n    // Move by center over y-axis\r\n  , cy: function(y) {\r\n      return y == null ? this.attr('cy') : this.attr('cy', y)\r\n    }\r\n    // Set width of element\r\n  , width: function(width) {\r\n      return width == null ? this.rx() * 2 : this.rx(new SVG.Number(width).divide(2))\r\n    }\r\n    // Set height of element\r\n  , height: function(height) {\r\n      return height == null ? this.ry() * 2 : this.ry(new SVG.Number(height).divide(2))\r\n    }\r\n    // Custom size function\r\n  , size: function(width, height) {\r\n      var p = proportionalSize(this, width, height)\r\n\r\n      return this\r\n        .rx(new SVG.Number(p.width).divide(2))\r\n        .ry(new SVG.Number(p.height).divide(2))\r\n    }\r\n})\nSVG.Line = SVG.invent({\r\n  // Initialize node\r\n  create: 'line'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Get array\r\n    array: function() {\r\n      return new SVG.PointArray([\r\n        [ this.attr('x1'), this.attr('y1') ]\r\n      , [ this.attr('x2'), this.attr('y2') ]\r\n      ])\r\n    }\r\n    // Overwrite native plot() method\r\n  , plot: function(x1, y1, x2, y2) {\r\n      if (x1 == null)\r\n        return this.array()\r\n      else if (typeof y1 !== 'undefined')\r\n        x1 = { x1: x1, y1: y1, x2: x2, y2: y2 }\r\n      else\r\n        x1 = new SVG.PointArray(x1).toLine()\r\n\r\n      return this.attr(x1)\r\n    }\r\n    // Move by left top corner\r\n  , move: function(x, y) {\r\n      return this.attr(this.array().move(x, y).toLine())\r\n    }\r\n    // Set element size to given width and height\r\n  , size: function(width, height) {\r\n      var p = proportionalSize(this, width, height)\r\n\r\n      return this.attr(this.array().size(p.width, p.height).toLine())\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create a line element\r\n    line: function(x1, y1, x2, y2) {\r\n      // make sure plot is called as a setter\r\n      // x1 is not necessarily a number, it can also be an array, a string and a SVG.PointArray\r\n      return SVG.Line.prototype.plot.apply(\r\n        this.put(new SVG.Line)\r\n      , x1 != null ? [x1, y1, x2, y2] : [0, 0, 0, 0]\r\n      )\r\n    }\r\n  }\r\n})\r\n\nSVG.Polyline = SVG.invent({\r\n  // Initialize node\r\n  create: 'polyline'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create a wrapped polyline element\r\n    polyline: function(p) {\r\n      // make sure plot is called as a setter\r\n      return this.put(new SVG.Polyline).plot(p || new SVG.PointArray)\r\n    }\r\n  }\r\n})\r\n\r\nSVG.Polygon = SVG.invent({\r\n  // Initialize node\r\n  create: 'polygon'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create a wrapped polygon element\r\n    polygon: function(p) {\r\n      // make sure plot is called as a setter\r\n      return this.put(new SVG.Polygon).plot(p || new SVG.PointArray)\r\n    }\r\n  }\r\n})\r\n\r\n// Add polygon-specific functions\r\nSVG.extend(SVG.Polyline, SVG.Polygon, {\r\n  // Get array\r\n  array: function() {\r\n    return this._array || (this._array = new SVG.PointArray(this.attr('points')))\r\n  }\r\n  // Plot new path\r\n, plot: function(p) {\r\n    return (p == null) ?\r\n      this.array() :\r\n      this.clear().attr('points', typeof p == 'string' ? p : (this._array = new SVG.PointArray(p)))\r\n  }\r\n  // Clear array cache\r\n, clear: function() {\r\n    delete this._array\r\n    return this\r\n  }\r\n  // Move by left top corner\r\n, move: function(x, y) {\r\n    return this.attr('points', this.array().move(x, y))\r\n  }\r\n  // Set element size to given width and height\r\n, size: function(width, height) {\r\n    var p = proportionalSize(this, width, height)\r\n\r\n    return this.attr('points', this.array().size(p.width, p.height))\r\n  }\r\n\r\n})\r\n\n// unify all point to point elements\r\nSVG.extend(SVG.Line, SVG.Polyline, SVG.Polygon, {\r\n  // Define morphable array\r\n  morphArray:  SVG.PointArray\r\n  // Move by left top corner over x-axis\r\n, x: function(x) {\r\n    return x == null ? this.bbox().x : this.move(x, this.bbox().y)\r\n  }\r\n  // Move by left top corner over y-axis\r\n, y: function(y) {\r\n    return y == null ? this.bbox().y : this.move(this.bbox().x, y)\r\n  }\r\n  // Set width of element\r\n, width: function(width) {\r\n    var b = this.bbox()\r\n\r\n    return width == null ? b.width : this.size(width, b.height)\r\n  }\r\n  // Set height of element\r\n, height: function(height) {\r\n    var b = this.bbox()\r\n\r\n    return height == null ? b.height : this.size(b.width, height)\r\n  }\r\n})\nSVG.Path = SVG.invent({\r\n  // Initialize node\r\n  create: 'path'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Define morphable array\r\n    morphArray:  SVG.PathArray\r\n    // Get array\r\n  , array: function() {\r\n      return this._array || (this._array = new SVG.PathArray(this.attr('d')))\r\n    }\r\n    // Plot new path\r\n  , plot: function(d) {\r\n      return (d == null) ?\r\n        this.array() :\r\n        this.clear().attr('d', typeof d == 'string' ? d : (this._array = new SVG.PathArray(d)))\r\n    }\r\n    // Clear array cache\r\n  , clear: function() {\r\n      delete this._array\r\n      return this\r\n    }\r\n    // Move by left top corner\r\n  , move: function(x, y) {\r\n      return this.attr('d', this.array().move(x, y))\r\n    }\r\n    // Move by left top corner over x-axis\r\n  , x: function(x) {\r\n      return x == null ? this.bbox().x : this.move(x, this.bbox().y)\r\n    }\r\n    // Move by left top corner over y-axis\r\n  , y: function(y) {\r\n      return y == null ? this.bbox().y : this.move(this.bbox().x, y)\r\n    }\r\n    // Set element size to given width and height\r\n  , size: function(width, height) {\r\n      var p = proportionalSize(this, width, height)\r\n\r\n      return this.attr('d', this.array().size(p.width, p.height))\r\n    }\r\n    // Set width of element\r\n  , width: function(width) {\r\n      return width == null ? this.bbox().width : this.size(width, this.bbox().height)\r\n    }\r\n    // Set height of element\r\n  , height: function(height) {\r\n      return height == null ? this.bbox().height : this.size(this.bbox().width, height)\r\n    }\r\n\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create a wrapped path element\r\n    path: function(d) {\r\n      // make sure plot is called as a setter\r\n      return this.put(new SVG.Path).plot(d || new SVG.PathArray)\r\n    }\r\n  }\r\n})\r\n\nSVG.Image = SVG.invent({\r\n  // Initialize node\r\n  create: 'image'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // (re)load image\r\n    load: function(url) {\r\n      if (!url) return this\r\n\r\n      var self = this\r\n        , img  = new window.Image()\r\n\r\n      // preload image\r\n      SVG.on(img, 'load', function() {\r\n        SVG.off(img)\r\n\r\n        var p = self.parent(SVG.Pattern)\r\n\r\n        if(p === null) return\r\n\r\n        // ensure image size\r\n        if (self.width() == 0 && self.height() == 0)\r\n          self.size(img.width, img.height)\r\n\r\n        // ensure pattern size if not set\r\n        if (p && p.width() == 0 && p.height() == 0)\r\n          p.size(self.width(), self.height())\r\n\r\n        // callback\r\n        if (typeof self._loaded === 'function')\r\n          self._loaded.call(self, {\r\n            width:  img.width\r\n          , height: img.height\r\n          , ratio:  img.width / img.height\r\n          , url:    url\r\n          })\r\n      })\r\n\r\n      SVG.on(img, 'error', function(e){\r\n        SVG.off(img)\r\n\r\n        if (typeof self._error === 'function'){\r\n            self._error.call(self, e)\r\n        }\r\n      })\r\n\r\n      return this.attr('href', (img.src = this.src = url), SVG.xlink)\r\n    }\r\n    // Add loaded callback\r\n  , loaded: function(loaded) {\r\n      this._loaded = loaded\r\n      return this\r\n    }\r\n\r\n  , error: function(error) {\r\n      this._error = error\r\n      return this\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // create image element, load image and set its size\r\n    image: function(source, width, height) {\r\n      return this.put(new SVG.Image).load(source).size(width || 0, height || width || 0)\r\n    }\r\n  }\r\n\r\n})\nSVG.Text = SVG.invent({\r\n  // Initialize node\r\n  create: function() {\r\n    this.constructor.call(this, SVG.create('text'))\r\n\r\n    this.dom.leading = new SVG.Number(1.3)    // store leading value for rebuilding\r\n    this._rebuild = true                      // enable automatic updating of dy values\r\n    this._build   = false                     // disable build mode for adding multiple lines\r\n\r\n    // set default font\r\n    this.attr('font-family', SVG.defaults.attrs['font-family'])\r\n  }\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Move over x-axis\r\n    x: function(x) {\r\n      // act as getter\r\n      if (x == null)\r\n        return this.attr('x')\r\n\r\n      return this.attr('x', x)\r\n    }\r\n    // Move over y-axis\r\n  , y: function(y) {\r\n      var oy = this.attr('y')\r\n        , o  = typeof oy === 'number' ? oy - this.bbox().y : 0\r\n\r\n      // act as getter\r\n      if (y == null)\r\n        return typeof oy === 'number' ? oy - o : oy\r\n\r\n      return this.attr('y', typeof y.valueOf() === 'number' ? y + o : y)\r\n    }\r\n    // Move center over x-axis\r\n  , cx: function(x) {\r\n      return x == null ? this.bbox().cx : this.x(x - this.bbox().width / 2)\r\n    }\r\n    // Move center over y-axis\r\n  , cy: function(y) {\r\n      return y == null ? this.bbox().cy : this.y(y - this.bbox().height / 2)\r\n    }\r\n    // Set the text content\r\n  , text: function(text) {\r\n      // act as getter\r\n      if (typeof text === 'undefined'){\r\n        var text = ''\r\n        var children = this.node.childNodes\r\n        for(var i = 0, len = children.length; i < len; ++i){\r\n\r\n          // add newline if its not the first child and newLined is set to true\r\n          if(i != 0 && children[i].nodeType != 3 && SVG.adopt(children[i]).dom.newLined == true){\r\n            text += '\\n'\r\n          }\r\n\r\n          // add content of this node\r\n          text += children[i].textContent\r\n        }\r\n\r\n        return text\r\n      }\r\n\r\n      // remove existing content\r\n      this.clear().build(true)\r\n\r\n      if (typeof text === 'function') {\r\n        // call block\r\n        text.call(this, this)\r\n\r\n      } else {\r\n        // store text and make sure text is not blank\r\n        text = text.split('\\n')\r\n\r\n        // build new lines\r\n        for (var i = 0, il = text.length; i < il; i++)\r\n          this.tspan(text[i]).newLine()\r\n      }\r\n\r\n      // disable build mode and rebuild lines\r\n      return this.build(false).rebuild()\r\n    }\r\n    // Set font size\r\n  , size: function(size) {\r\n      return this.attr('font-size', size).rebuild()\r\n    }\r\n    // Set / get leading\r\n  , leading: function(value) {\r\n      // act as getter\r\n      if (value == null)\r\n        return this.dom.leading\r\n\r\n      // act as setter\r\n      this.dom.leading = new SVG.Number(value)\r\n\r\n      return this.rebuild()\r\n    }\r\n    // Get all the first level lines\r\n  , lines: function() {\r\n      var node = (this.textPath && this.textPath() || this).node\r\n\r\n      // filter tspans and map them to SVG.js instances\r\n      var lines = SVG.utils.map(SVG.utils.filterSVGElements(node.childNodes), function(el){\r\n        return SVG.adopt(el)\r\n      })\r\n\r\n      // return an instance of SVG.set\r\n      return new SVG.Set(lines)\r\n    }\r\n    // Rebuild appearance type\r\n  , rebuild: function(rebuild) {\r\n      // store new rebuild flag if given\r\n      if (typeof rebuild == 'boolean')\r\n        this._rebuild = rebuild\r\n\r\n      // define position of all lines\r\n      if (this._rebuild) {\r\n        var self = this\r\n          , blankLineOffset = 0\r\n          , dy = this.dom.leading * new SVG.Number(this.attr('font-size'))\r\n\r\n        this.lines().each(function() {\r\n          if (this.dom.newLined) {\r\n            if (!self.textPath())\r\n              this.attr('x', self.attr('x'))\r\n            if(this.text() == '\\n') {\r\n              blankLineOffset += dy\r\n            }else{\r\n              this.attr('dy', dy + blankLineOffset)\r\n              blankLineOffset = 0\r\n            }\r\n          }\r\n        })\r\n\r\n        this.fire('rebuild')\r\n      }\r\n\r\n      return this\r\n    }\r\n    // Enable / disable build mode\r\n  , build: function(build) {\r\n      this._build = !!build\r\n      return this\r\n    }\r\n    // overwrite method from parent to set data properly\r\n  , setData: function(o){\r\n      this.dom = o\r\n      this.dom.leading = new SVG.Number(o.leading || 1.3)\r\n      return this\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create text element\r\n    text: function(text) {\r\n      return this.put(new SVG.Text).text(text)\r\n    }\r\n    // Create plain text element\r\n  , plain: function(text) {\r\n      return this.put(new SVG.Text).plain(text)\r\n    }\r\n  }\r\n\r\n})\r\n\r\nSVG.Tspan = SVG.invent({\r\n  // Initialize node\r\n  create: 'tspan'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Shape\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Set text content\r\n    text: function(text) {\r\n      if(text == null) return this.node.textContent + (this.dom.newLined ? '\\n' : '')\r\n\r\n      typeof text === 'function' ? text.call(this, this) : this.plain(text)\r\n\r\n      return this\r\n    }\r\n    // Shortcut dx\r\n  , dx: function(dx) {\r\n      return this.attr('dx', dx)\r\n    }\r\n    // Shortcut dy\r\n  , dy: function(dy) {\r\n      return this.attr('dy', dy)\r\n    }\r\n    // Create new line\r\n  , newLine: function() {\r\n      // fetch text parent\r\n      var t = this.parent(SVG.Text)\r\n\r\n      // mark new line\r\n      this.dom.newLined = true\r\n\r\n      // apply new hyn\r\n      return this.dy(t.dom.leading * t.attr('font-size')).attr('x', t.x())\r\n    }\r\n  }\r\n\r\n})\r\n\r\nSVG.extend(SVG.Text, SVG.Tspan, {\r\n  // Create plain text node\r\n  plain: function(text) {\r\n    // clear if build mode is disabled\r\n    if (this._build === false)\r\n      this.clear()\r\n\r\n    // create text node\r\n    this.node.appendChild(document.createTextNode(text))\r\n\r\n    return this\r\n  }\r\n  // Create a tspan\r\n, tspan: function(text) {\r\n    var node  = (this.textPath && this.textPath() || this).node\r\n      , tspan = new SVG.Tspan\r\n\r\n    // clear if build mode is disabled\r\n    if (this._build === false)\r\n      this.clear()\r\n\r\n    // add new tspan\r\n    node.appendChild(tspan.node)\r\n\r\n    return tspan.text(text)\r\n  }\r\n  // Clear all lines\r\n, clear: function() {\r\n    var node = (this.textPath && this.textPath() || this).node\r\n\r\n    // remove existing child nodes\r\n    while (node.hasChildNodes())\r\n      node.removeChild(node.lastChild)\r\n\r\n    return this\r\n  }\r\n  // Get length of text element\r\n, length: function() {\r\n    return this.node.getComputedTextLength()\r\n  }\r\n})\r\n\nSVG.TextPath = SVG.invent({\r\n  // Initialize node\r\n  create: 'textPath'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Parent\r\n\r\n  // Define parent class\r\n, parent: SVG.Text\r\n\r\n  // Add parent method\r\n, construct: {\r\n    morphArray: SVG.PathArray\r\n    // Create path for text to run on\r\n  , path: function(d) {\r\n      // create textPath element\r\n      var path  = new SVG.TextPath\r\n        , track = this.doc().defs().path(d)\r\n\r\n      // move lines to textpath\r\n      while (this.node.hasChildNodes())\r\n        path.node.appendChild(this.node.firstChild)\r\n\r\n      // add textPath element as child node\r\n      this.node.appendChild(path.node)\r\n\r\n      // link textPath to path and add content\r\n      path.attr('href', '#' + track, SVG.xlink)\r\n\r\n      return this\r\n    }\r\n    // return the array of the path track element\r\n  , array: function() {\r\n      var track = this.track()\r\n\r\n      return track ? track.array() : null\r\n    }\r\n    // Plot path if any\r\n  , plot: function(d) {\r\n      var track = this.track()\r\n        , pathArray = null\r\n\r\n      if (track) {\r\n        pathArray = track.plot(d)\r\n      }\r\n\r\n      return (d == null) ? pathArray : this\r\n    }\r\n    // Get the path track element\r\n  , track: function() {\r\n      var path = this.textPath()\r\n\r\n      if (path)\r\n        return path.reference('href')\r\n    }\r\n    // Get the textPath child\r\n  , textPath: function() {\r\n      if (this.node.firstChild && this.node.firstChild.nodeName == 'textPath')\r\n        return SVG.adopt(this.node.firstChild)\r\n    }\r\n  }\r\n})\r\n\nSVG.Nested = SVG.invent({\r\n  // Initialize node\r\n  create: function() {\r\n    this.constructor.call(this, SVG.create('svg'))\r\n\r\n    this.style('overflow', 'visible')\r\n  }\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create nested svg document\r\n    nested: function() {\r\n      return this.put(new SVG.Nested)\r\n    }\r\n  }\r\n})\nSVG.A = SVG.invent({\r\n  // Initialize node\r\n  create: 'a'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Link url\r\n    to: function(url) {\r\n      return this.attr('href', url, SVG.xlink)\r\n    }\r\n    // Link show attribute\r\n  , show: function(target) {\r\n      return this.attr('show', target, SVG.xlink)\r\n    }\r\n    // Link target attribute\r\n  , target: function(target) {\r\n      return this.attr('target', target)\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create a hyperlink element\r\n    link: function(url) {\r\n      return this.put(new SVG.A).to(url)\r\n    }\r\n  }\r\n})\r\n\r\nSVG.extend(SVG.Element, {\r\n  // Create a hyperlink element\r\n  linkTo: function(url) {\r\n    var link = new SVG.A\r\n\r\n    if (typeof url == 'function')\r\n      url.call(link, link)\r\n    else\r\n      link.to(url)\r\n\r\n    return this.parent().put(link).put(this)\r\n  }\r\n\r\n})\nSVG.Marker = SVG.invent({\r\n  // Initialize node\r\n  create: 'marker'\r\n\r\n  // Inherit from\r\n, inherit: SVG.Container\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Set width of element\r\n    width: function(width) {\r\n      return this.attr('markerWidth', width)\r\n    }\r\n    // Set height of element\r\n  , height: function(height) {\r\n      return this.attr('markerHeight', height)\r\n    }\r\n    // Set marker refX and refY\r\n  , ref: function(x, y) {\r\n      return this.attr('refX', x).attr('refY', y)\r\n    }\r\n    // Update marker\r\n  , update: function(block) {\r\n      // remove all content\r\n      this.clear()\r\n\r\n      // invoke passed block\r\n      if (typeof block == 'function')\r\n        block.call(this, this)\r\n\r\n      return this\r\n    }\r\n    // Return the fill id\r\n  , toString: function() {\r\n      return 'url(#' + this.id() + ')'\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    marker: function(width, height, block) {\r\n      // Create marker element in defs\r\n      return this.defs().marker(width, height, block)\r\n    }\r\n  }\r\n\r\n})\r\n\r\nSVG.extend(SVG.Defs, {\r\n  // Create marker\r\n  marker: function(width, height, block) {\r\n    // Set default viewbox to match the width and height, set ref to cx and cy and set orient to auto\r\n    return this.put(new SVG.Marker)\r\n      .size(width, height)\r\n      .ref(width / 2, height / 2)\r\n      .viewbox(0, 0, width, height)\r\n      .attr('orient', 'auto')\r\n      .update(block)\r\n  }\r\n\r\n})\r\n\r\nSVG.extend(SVG.Line, SVG.Polyline, SVG.Polygon, SVG.Path, {\r\n  // Create and attach markers\r\n  marker: function(marker, width, height, block) {\r\n    var attr = ['marker']\r\n\r\n    // Build attribute name\r\n    if (marker != 'all') attr.push(marker)\r\n    attr = attr.join('-')\r\n\r\n    // Set marker attribute\r\n    marker = arguments[1] instanceof SVG.Marker ?\r\n      arguments[1] :\r\n      this.doc().marker(width, height, block)\r\n\r\n    return this.attr(attr, marker)\r\n  }\r\n\r\n})\n// Define list of available attributes for stroke and fill\r\nvar sugar = {\r\n  stroke: ['color', 'width', 'opacity', 'linecap', 'linejoin', 'miterlimit', 'dasharray', 'dashoffset']\r\n, fill:   ['color', 'opacity', 'rule']\r\n, prefix: function(t, a) {\r\n    return a == 'color' ? t : t + '-' + a\r\n  }\r\n}\r\n\r\n// Add sugar for fill and stroke\r\n;['fill', 'stroke'].forEach(function(m) {\r\n  var i, extension = {}\r\n\r\n  extension[m] = function(o) {\r\n    if (typeof o == 'undefined')\r\n      return this\r\n    if (typeof o == 'string' || SVG.Color.isRgb(o) || (o && typeof o.fill === 'function'))\r\n      this.attr(m, o)\r\n\r\n    else\r\n      // set all attributes from sugar.fill and sugar.stroke list\r\n      for (i = sugar[m].length - 1; i >= 0; i--)\r\n        if (o[sugar[m][i]] != null)\r\n          this.attr(sugar.prefix(m, sugar[m][i]), o[sugar[m][i]])\r\n\r\n    return this\r\n  }\r\n\r\n  SVG.extend(SVG.Element, SVG.FX, extension)\r\n\r\n})\r\n\r\nSVG.extend(SVG.Element, SVG.FX, {\r\n  // Map rotation to transform\r\n  rotate: function(d, cx, cy) {\r\n    return this.transform({ rotation: d, cx: cx, cy: cy })\r\n  }\r\n  // Map skew to transform\r\n, skew: function(x, y, cx, cy) {\r\n    return arguments.length == 1  || arguments.length == 3 ?\r\n      this.transform({ skew: x, cx: y, cy: cx }) :\r\n      this.transform({ skewX: x, skewY: y, cx: cx, cy: cy })\r\n  }\r\n  // Map scale to transform\r\n, scale: function(x, y, cx, cy) {\r\n    return arguments.length == 1  || arguments.length == 3 ?\r\n      this.transform({ scale: x, cx: y, cy: cx }) :\r\n      this.transform({ scaleX: x, scaleY: y, cx: cx, cy: cy })\r\n  }\r\n  // Map translate to transform\r\n, translate: function(x, y) {\r\n    return this.transform({ x: x, y: y })\r\n  }\r\n  // Map flip to transform\r\n, flip: function(a, o) {\r\n    o = typeof a == 'number' ? a : o\r\n    return this.transform({ flip: a || 'both', offset: o })\r\n  }\r\n  // Map matrix to transform\r\n, matrix: function(m) {\r\n    return this.attr('transform', new SVG.Matrix(arguments.length == 6 ? [].slice.call(arguments) : m))\r\n  }\r\n  // Opacity\r\n, opacity: function(value) {\r\n    return this.attr('opacity', value)\r\n  }\r\n  // Relative move over x axis\r\n, dx: function(x) {\r\n    return this.x(new SVG.Number(x).plus(this instanceof SVG.FX ? 0 : this.x()), true)\r\n  }\r\n  // Relative move over y axis\r\n, dy: function(y) {\r\n    return this.y(new SVG.Number(y).plus(this instanceof SVG.FX ? 0 : this.y()), true)\r\n  }\r\n  // Relative move over x and y axes\r\n, dmove: function(x, y) {\r\n    return this.dx(x).dy(y)\r\n  }\r\n})\r\n\r\nSVG.extend(SVG.Rect, SVG.Ellipse, SVG.Circle, SVG.Gradient, SVG.FX, {\r\n  // Add x and y radius\r\n  radius: function(x, y) {\r\n    var type = (this._target || this).type;\r\n    return type == 'radial' || type == 'circle' ?\r\n      this.attr('r', new SVG.Number(x)) :\r\n      this.rx(x).ry(y == null ? x : y)\r\n  }\r\n})\r\n\r\nSVG.extend(SVG.Path, {\r\n  // Get path length\r\n  length: function() {\r\n    return this.node.getTotalLength()\r\n  }\r\n  // Get point at length\r\n, pointAt: function(length) {\r\n    return this.node.getPointAtLength(length)\r\n  }\r\n})\r\n\r\nSVG.extend(SVG.Parent, SVG.Text, SVG.Tspan, SVG.FX, {\r\n  // Set font\r\n  font: function(a, v) {\r\n    if (typeof a == 'object') {\r\n      for (v in a) this.font(v, a[v])\r\n    }\r\n\r\n    return a == 'leading' ?\r\n        this.leading(v) :\r\n      a == 'anchor' ?\r\n        this.attr('text-anchor', v) :\r\n      a == 'size' || a == 'family' || a == 'weight' || a == 'stretch' || a == 'variant' || a == 'style' ?\r\n        this.attr('font-'+ a, v) :\r\n        this.attr(a, v)\r\n  }\r\n})\r\n\nSVG.Set = SVG.invent({\r\n  // Initialize\r\n  create: function(members) {\r\n    if (members instanceof SVG.Set) {\r\n      this.members = members.members.slice()\r\n    } else {\r\n      Array.isArray(members) ? this.members = members : this.clear()\r\n    }\r\n  }\r\n\r\n  // Add class methods\r\n, extend: {\r\n    // Add element to set\r\n    add: function() {\r\n      var i, il, elements = [].slice.call(arguments)\r\n\r\n      for (i = 0, il = elements.length; i < il; i++)\r\n        this.members.push(elements[i])\r\n\r\n      return this\r\n    }\r\n    // Remove element from set\r\n  , remove: function(element) {\r\n      var i = this.index(element)\r\n\r\n      // remove given child\r\n      if (i > -1)\r\n        this.members.splice(i, 1)\r\n\r\n      return this\r\n    }\r\n    // Iterate over all members\r\n  , each: function(block) {\r\n      for (var i = 0, il = this.members.length; i < il; i++)\r\n        block.apply(this.members[i], [i, this.members])\r\n\r\n      return this\r\n    }\r\n    // Restore to defaults\r\n  , clear: function() {\r\n      // initialize store\r\n      this.members = []\r\n\r\n      return this\r\n    }\r\n    // Get the length of a set\r\n  , length: function() {\r\n      return this.members.length\r\n    }\r\n    // Checks if a given element is present in set\r\n  , has: function(element) {\r\n      return this.index(element) >= 0\r\n    }\r\n    // retuns index of given element in set\r\n  , index: function(element) {\r\n      return this.members.indexOf(element)\r\n    }\r\n    // Get member at given index\r\n  , get: function(i) {\r\n      return this.members[i]\r\n    }\r\n    // Get first member\r\n  , first: function() {\r\n      return this.get(0)\r\n    }\r\n    // Get last member\r\n  , last: function() {\r\n      return this.get(this.members.length - 1)\r\n    }\r\n    // Default value\r\n  , valueOf: function() {\r\n      return this.members\r\n    }\r\n    // Get the bounding box of all members included or empty box if set has no items\r\n  , bbox: function(){\r\n      // return an empty box of there are no members\r\n      if (this.members.length == 0)\r\n        return new SVG.RBox()\r\n\r\n      // get the first rbox and update the target bbox\r\n      var rbox = this.members[0].rbox(this.members[0].doc())\r\n\r\n      this.each(function() {\r\n        // user rbox for correct position and visual representation\r\n        rbox = rbox.merge(this.rbox(this.doc()))\r\n      })\r\n\r\n      return rbox\r\n    }\r\n  }\r\n\r\n  // Add parent method\r\n, construct: {\r\n    // Create a new set\r\n    set: function(members) {\r\n      return new SVG.Set(members)\r\n    }\r\n  }\r\n})\r\n\r\nSVG.FX.Set = SVG.invent({\r\n  // Initialize node\r\n  create: function(set) {\r\n    // store reference to set\r\n    this.set = set\r\n  }\r\n\r\n})\r\n\r\n// Alias methods\r\nSVG.Set.inherit = function() {\r\n  var m\r\n    , methods = []\r\n\r\n  // gather shape methods\r\n  for(var m in SVG.Shape.prototype)\r\n    if (typeof SVG.Shape.prototype[m] == 'function' && typeof SVG.Set.prototype[m] != 'function')\r\n      methods.push(m)\r\n\r\n  // apply shape aliasses\r\n  methods.forEach(function(method) {\r\n    SVG.Set.prototype[method] = function() {\r\n      for (var i = 0, il = this.members.length; i < il; i++)\r\n        if (this.members[i] && typeof this.members[i][method] == 'function')\r\n          this.members[i][method].apply(this.members[i], arguments)\r\n\r\n      return method == 'animate' ? (this.fx || (this.fx = new SVG.FX.Set(this))) : this\r\n    }\r\n  })\r\n\r\n  // clear methods for the next round\r\n  methods = []\r\n\r\n  // gather fx methods\r\n  for(var m in SVG.FX.prototype)\r\n    if (typeof SVG.FX.prototype[m] == 'function' && typeof SVG.FX.Set.prototype[m] != 'function')\r\n      methods.push(m)\r\n\r\n  // apply fx aliasses\r\n  methods.forEach(function(method) {\r\n    SVG.FX.Set.prototype[method] = function() {\r\n      for (var i = 0, il = this.set.members.length; i < il; i++)\r\n        this.set.members[i].fx[method].apply(this.set.members[i].fx, arguments)\r\n\r\n      return this\r\n    }\r\n  })\r\n}\r\n\n\r\nSVG.extend(SVG.Element, {\r\n  // Store data values on svg nodes\r\n  data: function(a, v, r) {\r\n    if (typeof a == 'object') {\r\n      for (v in a)\r\n        this.data(v, a[v])\r\n\r\n    } else if (arguments.length < 2) {\r\n      try {\r\n        return JSON.parse(this.attr('data-' + a))\r\n      } catch(e) {\r\n        return this.attr('data-' + a)\r\n      }\r\n\r\n    } else {\r\n      this.attr(\r\n        'data-' + a\r\n      , v === null ?\r\n          null :\r\n        r === true || typeof v === 'string' || typeof v === 'number' ?\r\n          v :\r\n          JSON.stringify(v)\r\n      )\r\n    }\r\n\r\n    return this\r\n  }\r\n})\nSVG.extend(SVG.Element, {\r\n  // Remember arbitrary data\r\n  remember: function(k, v) {\r\n    // remember every item in an object individually\r\n    if (typeof arguments[0] == 'object')\r\n      for (var v in k)\r\n        this.remember(v, k[v])\r\n\r\n    // retrieve memory\r\n    else if (arguments.length == 1)\r\n      return this.memory()[k]\r\n\r\n    // store memory\r\n    else\r\n      this.memory()[k] = v\r\n\r\n    return this\r\n  }\r\n\r\n  // Erase a given memory\r\n, forget: function() {\r\n    if (arguments.length == 0)\r\n      this._memory = {}\r\n    else\r\n      for (var i = arguments.length - 1; i >= 0; i--)\r\n        delete this.memory()[arguments[i]]\r\n\r\n    return this\r\n  }\r\n\r\n  // Initialize or return local memory object\r\n, memory: function() {\r\n    return this._memory || (this._memory = {})\r\n  }\r\n\r\n})\n// Method for getting an element by id\r\nSVG.get = function(id) {\r\n  var node = document.getElementById(idFromReference(id) || id)\r\n  return SVG.adopt(node)\r\n}\r\n\r\n// Select elements by query string\r\nSVG.select = function(query, parent) {\r\n  return new SVG.Set(\r\n    SVG.utils.map((parent || document).querySelectorAll(query), function(node) {\r\n      return SVG.adopt(node)\r\n    })\r\n  )\r\n}\r\n\r\nSVG.extend(SVG.Parent, {\r\n  // Scoped select method\r\n  select: function(query) {\r\n    return SVG.select(query, this.node)\r\n  }\r\n\r\n})\nfunction pathRegReplace(a, b, c, d) {\r\n  return c + d.replace(SVG.regex.dots, ' .')\r\n}\r\n\r\n// creates deep clone of array\r\nfunction array_clone(arr){\r\n  var clone = arr.slice(0)\r\n  for(var i = clone.length; i--;){\r\n    if(Array.isArray(clone[i])){\r\n      clone[i] = array_clone(clone[i])\r\n    }\r\n  }\r\n  return clone\r\n}\r\n\r\n// tests if a given element is instance of an object\r\nfunction is(el, obj){\r\n  return el instanceof obj\r\n}\r\n\r\n// tests if a given selector matches an element\r\nfunction matches(el, selector) {\r\n  return (el.matches || el.matchesSelector || el.msMatchesSelector || el.mozMatchesSelector || el.webkitMatchesSelector || el.oMatchesSelector).call(el, selector);\r\n}\r\n\r\n// Convert dash-separated-string to camelCase\r\nfunction camelCase(s) {\r\n  return s.toLowerCase().replace(/-(.)/g, function(m, g) {\r\n    return g.toUpperCase()\r\n  })\r\n}\r\n\r\n// Capitalize first letter of a string\r\nfunction capitalize(s) {\r\n  return s.charAt(0).toUpperCase() + s.slice(1)\r\n}\r\n\r\n// Ensure to six-based hex\r\nfunction fullHex(hex) {\r\n  return hex.length == 4 ?\r\n    [ '#',\r\n      hex.substring(1, 2), hex.substring(1, 2)\r\n    , hex.substring(2, 3), hex.substring(2, 3)\r\n    , hex.substring(3, 4), hex.substring(3, 4)\r\n    ].join('') : hex\r\n}\r\n\r\n// Component to hex value\r\nfunction compToHex(comp) {\r\n  var hex = comp.toString(16)\r\n  return hex.length == 1 ? '0' + hex : hex\r\n}\r\n\r\n// Calculate proportional width and height values when necessary\r\nfunction proportionalSize(element, width, height) {\r\n  if (width == null || height == null) {\r\n    var box = element.bbox()\r\n\r\n    if (width == null)\r\n      width = box.width / box.height * height\r\n    else if (height == null)\r\n      height = box.height / box.width * width\r\n  }\r\n\r\n  return {\r\n    width:  width\r\n  , height: height\r\n  }\r\n}\r\n\r\n// Delta transform point\r\nfunction deltaTransformPoint(matrix, x, y) {\r\n  return {\r\n    x: x * matrix.a + y * matrix.c + 0\r\n  , y: x * matrix.b + y * matrix.d + 0\r\n  }\r\n}\r\n\r\n// Map matrix array to object\r\nfunction arrayToMatrix(a) {\r\n  return { a: a[0], b: a[1], c: a[2], d: a[3], e: a[4], f: a[5] }\r\n}\r\n\r\n// Parse matrix if required\r\nfunction parseMatrix(matrix) {\r\n  if (!(matrix instanceof SVG.Matrix))\r\n    matrix = new SVG.Matrix(matrix)\r\n\r\n  return matrix\r\n}\r\n\r\n// Add centre point to transform object\r\nfunction ensureCentre(o, target) {\r\n  o.cx = o.cx == null ? target.bbox().cx : o.cx\r\n  o.cy = o.cy == null ? target.bbox().cy : o.cy\r\n}\r\n\r\n// PathArray Helpers\r\nfunction arrayToString(a) {\r\n  for (var i = 0, il = a.length, s = ''; i < il; i++) {\r\n    s += a[i][0]\r\n\r\n    if (a[i][1] != null) {\r\n      s += a[i][1]\r\n\r\n      if (a[i][2] != null) {\r\n        s += ' '\r\n        s += a[i][2]\r\n\r\n        if (a[i][3] != null) {\r\n          s += ' '\r\n          s += a[i][3]\r\n          s += ' '\r\n          s += a[i][4]\r\n\r\n          if (a[i][5] != null) {\r\n            s += ' '\r\n            s += a[i][5]\r\n            s += ' '\r\n            s += a[i][6]\r\n\r\n            if (a[i][7] != null) {\r\n              s += ' '\r\n              s += a[i][7]\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return s + ' '\r\n}\r\n\r\n// Deep new id assignment\r\nfunction assignNewId(node) {\r\n  // do the same for SVG child nodes as well\r\n  for (var i = node.childNodes.length - 1; i >= 0; i--)\r\n    if (node.childNodes[i] instanceof window.SVGElement)\r\n      assignNewId(node.childNodes[i])\r\n\r\n  return SVG.adopt(node).id(SVG.eid(node.nodeName))\r\n}\r\n\r\n// Add more bounding box properties\r\nfunction fullBox(b) {\r\n  if (b.x == null) {\r\n    b.x      = 0\r\n    b.y      = 0\r\n    b.width  = 0\r\n    b.height = 0\r\n  }\r\n\r\n  b.w  = b.width\r\n  b.h  = b.height\r\n  b.x2 = b.x + b.width\r\n  b.y2 = b.y + b.height\r\n  b.cx = b.x + b.width / 2\r\n  b.cy = b.y + b.height / 2\r\n\r\n  return b\r\n}\r\n\r\n// Get id from reference string\r\nfunction idFromReference(url) {\r\n  var m = (url || '').toString().match(SVG.regex.reference)\r\n\r\n  if (m) return m[1]\r\n}\r\n\r\n// If values like 1e-88 are passed, this is not a valid 32 bit float,\r\n// but in those cases, we are so close to 0 that 0 works well!\r\nfunction float32String(v) {\r\n  return Math.abs(v) > 1e-37 ? v : 0\r\n}\r\n\r\n// Create matrix array for looping\r\nvar abcdef = 'abcdef'.split('')\r\n\n// Add CustomEvent to IE9 and IE10\r\nif (typeof window.CustomEvent !== 'function') {\r\n  // Code from: https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent\r\n  var CustomEventPoly = function(event, options) {\r\n    options = options || { bubbles: false, cancelable: false, detail: undefined }\r\n    var e = document.createEvent('CustomEvent')\r\n    e.initCustomEvent(event, options.bubbles, options.cancelable, options.detail)\r\n    return e\r\n  }\r\n\r\n  CustomEventPoly.prototype = window.Event.prototype\r\n\r\n  SVG.CustomEvent = CustomEventPoly\r\n} else {\r\n  SVG.CustomEvent = window.CustomEvent\r\n}\r\n\r\n// requestAnimationFrame / cancelAnimationFrame Polyfill with fallback based on Paul Irish\r\n(function(w) {\r\n  var lastTime = 0\r\n  var vendors = ['moz', 'webkit']\r\n\r\n  for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {\r\n    w.requestAnimationFrame = w[vendors[x] + 'RequestAnimationFrame']\r\n    w.cancelAnimationFrame  = w[vendors[x] + 'CancelAnimationFrame'] ||\r\n                              w[vendors[x] + 'CancelRequestAnimationFrame']\r\n  }\r\n\r\n  w.requestAnimationFrame = w.requestAnimationFrame ||\r\n    function(callback) {\r\n      var currTime = new Date().getTime()\r\n      var timeToCall = Math.max(0, 16 - (currTime - lastTime))\r\n\r\n      var id = w.setTimeout(function() {\r\n        callback(currTime + timeToCall)\r\n      }, timeToCall)\r\n\r\n      lastTime = currTime + timeToCall\r\n      return id\r\n    }\r\n\r\n  w.cancelAnimationFrame = w.cancelAnimationFrame || w.clearTimeout;\r\n\r\n}(window))\r\n\r\nreturn SVG\r\n\r\n}));\r","/*!\n* svg.resize.js - An extension for svg.js which allows to resize elements which are selected\n* @version 1.4.3\n* https://github.com/svgdotjs/svg.resize.js\n*\n* @copyright [object Object]\n* @license MIT\n*/;\n;(function() {\n\"use strict\";\n\n;(function () {\r\n\r\n    function ResizeHandler(el) {\r\n\r\n        el.remember('_resizeHandler', this);\r\n\r\n        this.el = el;\r\n        this.parameters = {};\r\n        this.lastUpdateCall = null;\r\n        this.p = el.doc().node.createSVGPoint();\r\n    }\r\n\r\n    ResizeHandler.prototype.transformPoint = function(x, y, m){\r\n\r\n        this.p.x = x - (this.offset.x - window.pageXOffset);\r\n        this.p.y = y - (this.offset.y - window.pageYOffset);\r\n\r\n        return this.p.matrixTransform(m || this.m);\r\n\r\n    };\r\n\r\n    ResizeHandler.prototype._extractPosition = function(event) {\r\n        // Extract a position from a mouse/touch event.\r\n        // Returns { x: .., y: .. }\r\n        return {\r\n            x: event.clientX != null ? event.clientX : event.touches[0].clientX,\r\n            y: event.clientY != null ? event.clientY : event.touches[0].clientY\r\n        }\r\n    };\r\n\r\n    ResizeHandler.prototype.init = function (options) {\r\n\r\n        var _this = this;\r\n\r\n        this.stop();\r\n\r\n        if (options === 'stop') {\r\n            return;\r\n        }\r\n\r\n        this.options = {};\r\n\r\n        // Merge options and defaults\r\n        for (var i in this.el.resize.defaults) {\r\n            this.options[i] = this.el.resize.defaults[i];\r\n            if (typeof options[i] !== 'undefined') {\r\n                this.options[i] = options[i];\r\n            }\r\n        }\r\n\r\n        // We listen to all these events which are specifying different edges\r\n        this.el.on('lt.resize', function(e){ _this.resize(e || window.event); });  // Left-Top\r\n        this.el.on('rt.resize', function(e){ _this.resize(e || window.event); });  // Right-Top\r\n        this.el.on('rb.resize', function(e){ _this.resize(e || window.event); });  // Right-Bottom\r\n        this.el.on('lb.resize', function(e){ _this.resize(e || window.event); });  // Left-Bottom\r\n\r\n        this.el.on('t.resize', function(e){ _this.resize(e || window.event); });   // Top\r\n        this.el.on('r.resize', function(e){ _this.resize(e || window.event); });   // Right\r\n        this.el.on('b.resize', function(e){ _this.resize(e || window.event); });   // Bottom\r\n        this.el.on('l.resize', function(e){ _this.resize(e || window.event); });   // Left\r\n\r\n        this.el.on('rot.resize', function(e){ _this.resize(e || window.event); }); // Rotation\r\n\r\n        this.el.on('point.resize', function(e){ _this.resize(e || window.event); }); // Point-Moving\r\n\r\n        // This call ensures, that the plugin reacts to a change of snapToGrid immediately\r\n        this.update();\r\n\r\n    };\r\n\r\n    ResizeHandler.prototype.stop = function(){\r\n        this.el.off('lt.resize');\r\n        this.el.off('rt.resize');\r\n        this.el.off('rb.resize');\r\n        this.el.off('lb.resize');\r\n\r\n        this.el.off('t.resize');\r\n        this.el.off('r.resize');\r\n        this.el.off('b.resize');\r\n        this.el.off('l.resize');\r\n\r\n        this.el.off('rot.resize');\r\n\r\n        this.el.off('point.resize');\r\n\r\n        return this;\r\n    };\r\n\r\n    ResizeHandler.prototype.resize = function (event) {\r\n\r\n        var _this = this;\r\n\r\n        this.m = this.el.node.getScreenCTM().inverse();\r\n        this.offset = { x: window.pageXOffset, y: window.pageYOffset };\r\n\r\n        var txPt = this._extractPosition(event.detail.event);\r\n        this.parameters = {\r\n            type: this.el.type, // the type of element\r\n            p: this.transformPoint(txPt.x, txPt.y),\r\n            x: event.detail.x,      // x-position of the mouse when resizing started\r\n            y: event.detail.y,      // y-position of the mouse when resizing started\r\n            box: this.el.bbox(),    // The bounding-box of the element\r\n            rotation: this.el.transform().rotation  // The current rotation of the element\r\n        };\r\n\r\n        // Add font-size parameter if the element type is text\r\n        if (this.el.type === \"text\") {\r\n            this.parameters.fontSize = this.el.attr()[\"font-size\"];\r\n        }\r\n\r\n        // the i-param in the event holds the index of the point which is moved, when using `deepSelect`\r\n        if (event.detail.i !== undefined) {\r\n\r\n            // get the point array\r\n            var array = this.el.array().valueOf();\r\n\r\n            // Save the index and the point which is moved\r\n            this.parameters.i = event.detail.i;\r\n            this.parameters.pointCoords = [array[event.detail.i][0], array[event.detail.i][1]];\r\n        }\r\n\r\n        // Lets check which edge of the bounding-box was clicked and resize the this.el according to this\r\n        switch (event.type) {\r\n\r\n            // Left-Top-Edge\r\n            case 'lt':\r\n                // We build a calculating function for every case which gives us the new position of the this.el\r\n                this.calc = function (diffX, diffY) {\r\n                    // The procedure is always the same\r\n                    // First we snap the edge to the given grid (snapping to 1px grid is normal resizing)\r\n                    var snap = this.snapToGrid(diffX, diffY);\r\n\r\n                    // Now we check if the new height and width still valid (> 0)\r\n                    if (this.parameters.box.width - snap[0] > 0 && this.parameters.box.height - snap[1] > 0) {\r\n                        // ...if valid, we resize the this.el (which can include moving because the coord-system starts at the left-top and this edge is moving sometimes when resized)\r\n\r\n                        /*\r\n                         * but first check if the element is text box, so we can change the font size instead of\r\n                         * the width and height\r\n                         */\r\n\r\n                        if (this.parameters.type === \"text\") {\r\n                            this.el.move(this.parameters.box.x + snap[0], this.parameters.box.y);\r\n                            this.el.attr(\"font-size\", this.parameters.fontSize - snap[0]);\r\n                            return;\r\n                        }\r\n\r\n                        snap = this.checkAspectRatio(snap);\r\n\r\n                        this.el.move(this.parameters.box.x + snap[0], this.parameters.box.y + snap[1]).size(this.parameters.box.width - snap[0], this.parameters.box.height - snap[1]);\r\n                    }\r\n                };\r\n                break;\r\n\r\n            // Right-Top\r\n            case 'rt':\r\n                // s.a.\r\n                this.calc = function (diffX, diffY) {\r\n                    var snap = this.snapToGrid(diffX, diffY, 1 << 1);\r\n                    if (this.parameters.box.width + snap[0] > 0 && this.parameters.box.height - snap[1] > 0) {\r\n                        if (this.parameters.type === \"text\") {\r\n                            this.el.move(this.parameters.box.x - snap[0], this.parameters.box.y);\r\n                            this.el.attr(\"font-size\", this.parameters.fontSize + snap[0]);\r\n                            return;\r\n                        }\r\n\r\n                        snap = this.checkAspectRatio(snap, true);\r\n\r\n                        this.el.move(this.parameters.box.x, this.parameters.box.y + snap[1]).size(this.parameters.box.width + snap[0], this.parameters.box.height - snap[1]);\r\n                    }\r\n                };\r\n                break;\r\n\r\n            // Right-Bottom\r\n            case 'rb':\r\n                // s.a.\r\n                this.calc = function (diffX, diffY) {\r\n                    var snap = this.snapToGrid(diffX, diffY, 0);\r\n                    if (this.parameters.box.width + snap[0] > 0 && this.parameters.box.height + snap[1] > 0) {\r\n                        if (this.parameters.type === \"text\") {\r\n                            this.el.move(this.parameters.box.x - snap[0], this.parameters.box.y);\r\n                            this.el.attr(\"font-size\", this.parameters.fontSize + snap[0]);\r\n                            return;\r\n                        }\r\n\r\n                        snap = this.checkAspectRatio(snap);\r\n\r\n                        this.el.move(this.parameters.box.x, this.parameters.box.y).size(this.parameters.box.width + snap[0], this.parameters.box.height + snap[1]);\r\n                    }\r\n                };\r\n                break;\r\n\r\n            // Left-Bottom\r\n            case 'lb':\r\n                // s.a.\r\n                this.calc = function (diffX, diffY) {\r\n                    var snap = this.snapToGrid(diffX, diffY, 1);\r\n                    if (this.parameters.box.width - snap[0] > 0 && this.parameters.box.height + snap[1] > 0) {\r\n                        if (this.parameters.type === \"text\") {\r\n                            this.el.move(this.parameters.box.x + snap[0], this.parameters.box.y);\r\n                            this.el.attr(\"font-size\", this.parameters.fontSize - snap[0]);\r\n                            return;\r\n                        }\r\n\r\n                        snap = this.checkAspectRatio(snap, true);\r\n\r\n                        this.el.move(this.parameters.box.x + snap[0], this.parameters.box.y).size(this.parameters.box.width - snap[0], this.parameters.box.height + snap[1]);\r\n                    }\r\n                };\r\n                break;\r\n\r\n            // Top\r\n            case 't':\r\n                // s.a.\r\n                this.calc = function (diffX, diffY) {\r\n                    var snap = this.snapToGrid(diffX, diffY, 1 << 1);\r\n                    if (this.parameters.box.height - snap[1] > 0) {\r\n                        // Disable the font-resizing if it is not from the corner of bounding-box\r\n                        if (this.parameters.type === \"text\") {\r\n                            return;\r\n                        }\r\n\r\n                        this.el.move(this.parameters.box.x, this.parameters.box.y + snap[1]).height(this.parameters.box.height - snap[1]);\r\n                    }\r\n                };\r\n                break;\r\n\r\n            // Right\r\n            case 'r':\r\n                // s.a.\r\n                this.calc = function (diffX, diffY) {\r\n                    var snap = this.snapToGrid(diffX, diffY, 0);\r\n                    if (this.parameters.box.width + snap[0] > 0) {\r\n                        if (this.parameters.type === \"text\") {\r\n                            return;\r\n                        }\r\n\r\n                        this.el.move(this.parameters.box.x, this.parameters.box.y).width(this.parameters.box.width + snap[0]);\r\n                    }\r\n                };\r\n                break;\r\n\r\n            // Bottom\r\n            case 'b':\r\n                // s.a.\r\n                this.calc = function (diffX, diffY) {\r\n                    var snap = this.snapToGrid(diffX, diffY, 0);\r\n                    if (this.parameters.box.height + snap[1] > 0) {\r\n                        if (this.parameters.type === \"text\") {\r\n                            return;\r\n                        }\r\n\r\n                        this.el.move(this.parameters.box.x, this.parameters.box.y).height(this.parameters.box.height + snap[1]);\r\n                    }\r\n                };\r\n                break;\r\n\r\n            // Left\r\n            case 'l':\r\n                // s.a.\r\n                this.calc = function (diffX, diffY) {\r\n                    var snap = this.snapToGrid(diffX, diffY, 1);\r\n                    if (this.parameters.box.width - snap[0] > 0) {\r\n                        if (this.parameters.type === \"text\") {\r\n                            return;\r\n                        }\r\n\r\n                        this.el.move(this.parameters.box.x + snap[0], this.parameters.box.y).width(this.parameters.box.width - snap[0]);\r\n                    }\r\n                };\r\n                break;\r\n\r\n            // Rotation\r\n            case 'rot':\r\n                // s.a.\r\n                this.calc = function (diffX, diffY) {\r\n\r\n                    // yes this is kinda stupid but we need the mouse coords back...\r\n                    var current = {x: diffX + this.parameters.p.x, y: diffY + this.parameters.p.y};\r\n\r\n                    // start minus middle\r\n                    var sAngle = Math.atan2((this.parameters.p.y - this.parameters.box.y - this.parameters.box.height / 2), (this.parameters.p.x - this.parameters.box.x - this.parameters.box.width / 2));\r\n\r\n                    // end minus middle\r\n                    var pAngle = Math.atan2((current.y - this.parameters.box.y - this.parameters.box.height / 2), (current.x - this.parameters.box.x - this.parameters.box.width / 2));\r\n\r\n                    var angle = this.parameters.rotation + (pAngle - sAngle) * 180 / Math.PI + this.options.snapToAngle / 2;\r\n\r\n                    // We have to move the element to the center of the box first and change the rotation afterwards\r\n                    // because rotation always works around a rotation-center, which is changed when moving the element\r\n                    // We also set the new rotation center to the center of the box.\r\n                    this.el.center(this.parameters.box.cx, this.parameters.box.cy).rotate(angle - (angle % this.options.snapToAngle), this.parameters.box.cx, this.parameters.box.cy);\r\n                };\r\n                break;\r\n\r\n            // Moving one single Point (needed when an element is deepSelected which means you can move every single point of the object)\r\n            case 'point':\r\n                this.calc = function (diffX, diffY) {\r\n\r\n                    // Snapping the point to the grid\r\n                    var snap = this.snapToGrid(diffX, diffY, this.parameters.pointCoords[0], this.parameters.pointCoords[1]);\r\n\r\n                    // Get the point array\r\n                    var array = this.el.array().valueOf();\r\n\r\n                    // Changing the moved point in the array\r\n                    array[this.parameters.i][0] = this.parameters.pointCoords[0] + snap[0];\r\n                    array[this.parameters.i][1] = this.parameters.pointCoords[1] + snap[1];\r\n\r\n                    // And plot the new this.el\r\n                    this.el.plot(array);\r\n                };\r\n        }\r\n\r\n        this.el.fire('resizestart', {dx: this.parameters.x, dy: this.parameters.y, event: event});\r\n        // When resizing started, we have to register events for...\r\n        // Touches.\r\n        SVG.on(window, 'touchmove.resize', function(e) {\r\n            _this.update(e || window.event);\r\n        });\r\n        SVG.on(window, 'touchend.resize', function() {\r\n            _this.done();\r\n        });\r\n        // Mouse.\r\n        SVG.on(window, 'mousemove.resize', function (e) {\r\n            _this.update(e || window.event);\r\n        });\r\n        SVG.on(window, 'mouseup.resize', function () {\r\n            _this.done();\r\n        });\r\n\r\n    };\r\n\r\n    // The update-function redraws the element every time the mouse is moving\r\n    ResizeHandler.prototype.update = function (event) {\r\n\r\n        if (!event) {\r\n            if (this.lastUpdateCall) {\r\n                this.calc(this.lastUpdateCall[0], this.lastUpdateCall[1]);\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Calculate the difference between the mouseposition at start and now\r\n        var txPt = this._extractPosition(event);\r\n        var p = this.transformPoint(txPt.x, txPt.y);\r\n\r\n        var diffX = p.x - this.parameters.p.x,\r\n            diffY = p.y - this.parameters.p.y;\r\n\r\n        this.lastUpdateCall = [diffX, diffY];\r\n\r\n        // Calculate the new position and height / width of the element\r\n        this.calc(diffX, diffY);\r\n\r\n       // Emit an event to say we have changed.\r\n        this.el.fire('resizing', {dx: diffX, dy: diffY, event: event});\r\n    };\r\n\r\n    // Is called on mouseup.\r\n    // Removes the update-function from the mousemove event\r\n    ResizeHandler.prototype.done = function () {\r\n        this.lastUpdateCall = null;\r\n        SVG.off(window, 'mousemove.resize');\r\n        SVG.off(window, 'mouseup.resize');\r\n        SVG.off(window, 'touchmove.resize');\r\n        SVG.off(window, 'touchend.resize');\r\n        this.el.fire('resizedone');\r\n    };\r\n\r\n    // The flag is used to determine whether the resizing is used with a left-Point (first bit) and top-point (second bit)\r\n    // In this cases the temp-values are calculated differently\r\n    ResizeHandler.prototype.snapToGrid = function (diffX, diffY, flag, pointCoordsY) {\r\n\r\n        var temp;\r\n\r\n        // If `pointCoordsY` is given, a single Point has to be snapped (deepSelect). That's why we need a different temp-value\r\n        if (typeof pointCoordsY !== 'undefined') {\r\n            // Note that flag = pointCoordsX in this case\r\n            temp = [(flag + diffX) % this.options.snapToGrid, (pointCoordsY + diffY) % this.options.snapToGrid];\r\n        } else {\r\n            // We check if the flag is set and if not we set a default-value (both bits set - which means upper-left-edge)\r\n            flag = flag == null ? 1 | 1 << 1 : flag;\r\n            temp = [(this.parameters.box.x + diffX + (flag & 1 ? 0 : this.parameters.box.width)) % this.options.snapToGrid, (this.parameters.box.y + diffY + (flag & (1 << 1) ? 0 : this.parameters.box.height)) % this.options.snapToGrid];\r\n        }\r\n\r\n        if(diffX < 0) {\r\n            temp[0] -= this.options.snapToGrid;\r\n        }\r\n        if(diffY < 0) {\r\n            temp[1] -= this.options.snapToGrid;\r\n        }\r\n\r\n        diffX -= (Math.abs(temp[0]) < this.options.snapToGrid / 2 ?\r\n                  temp[0] :\r\n                  temp[0] - (diffX < 0 ? -this.options.snapToGrid : this.options.snapToGrid));\r\n        diffY -= (Math.abs(temp[1]) < this.options.snapToGrid / 2 ?\r\n                  temp[1] :\r\n                  temp[1] - (diffY < 0 ? -this.options.snapToGrid : this.options.snapToGrid));\r\n\r\n        return this.constraintToBox(diffX, diffY, flag, pointCoordsY);\r\n\r\n    };\r\n\r\n    // keep element within constrained box\r\n    ResizeHandler.prototype.constraintToBox = function (diffX, diffY, flag, pointCoordsY) {\r\n        //return [diffX, diffY]\r\n        var c = this.options.constraint || {};\r\n        var orgX, orgY;\r\n\r\n        if (typeof pointCoordsY !== 'undefined') {\r\n          orgX = flag;\r\n          orgY = pointCoordsY;\r\n        } else {\r\n          orgX = this.parameters.box.x + (flag & 1 ? 0 : this.parameters.box.width);\r\n          orgY = this.parameters.box.y + (flag & (1<<1) ? 0 : this.parameters.box.height);\r\n        }\r\n\r\n        if (typeof c.minX !== 'undefined' && orgX + diffX < c.minX) {\r\n          diffX = c.minX - orgX;\r\n        }\r\n\r\n        if (typeof c.maxX !== 'undefined' && orgX + diffX > c.maxX) {\r\n          diffX = c.maxX - orgX;\r\n        }\r\n\r\n        if (typeof c.minY !== 'undefined' && orgY + diffY < c.minY) {\r\n          diffY = c.minY - orgY;\r\n        }\r\n\r\n        if (typeof c.maxY !== 'undefined' && orgY + diffY > c.maxY) {\r\n          diffY = c.maxY - orgY;\r\n        }\r\n\r\n        return [diffX, diffY];\r\n    };\r\n\r\n    ResizeHandler.prototype.checkAspectRatio = function (snap, isReverse) {\r\n        if (!this.options.saveAspectRatio) {\r\n            return snap;\r\n        }\r\n\r\n        var updatedSnap = snap.slice();\r\n        var aspectRatio = this.parameters.box.width / this.parameters.box.height;\r\n        var newW = this.parameters.box.width + snap[0];\r\n        var newH = this.parameters.box.height - snap[1];\r\n        var newAspectRatio = newW / newH;\r\n\r\n        if (newAspectRatio < aspectRatio) {\r\n            // Height is too big. Adapt it\r\n            updatedSnap[1] = newW / aspectRatio - this.parameters.box.height;\r\n            isReverse && (updatedSnap[1] = -updatedSnap[1]);\r\n        } else if (newAspectRatio > aspectRatio) {\r\n            // Width is too big. Adapt it\r\n            updatedSnap[0] = this.parameters.box.width - newH * aspectRatio;\r\n            isReverse && (updatedSnap[0] = -updatedSnap[0]);\r\n        }\r\n\r\n        return updatedSnap;\r\n    };\r\n\r\n    SVG.extend(SVG.Element, {\r\n        // Resize element with mouse\r\n        resize: function (options) {\r\n\r\n            (this.remember('_resizeHandler') || new ResizeHandler(this)).init(options || {});\r\n\r\n            return this;\r\n\r\n        }\r\n\r\n    });\r\n\r\n    SVG.Element.prototype.resize.defaults = {\r\n        snapToAngle: 0.1,       // Specifies the speed the rotation is happening when moving the mouse\r\n        snapToGrid: 1,          // Snaps to a grid of `snapToGrid` Pixels\r\n        constraint: {},         // keep element within constrained box\r\n        saveAspectRatio: false  // Save aspect ratio when resizing using lt, rt, rb or lb points\r\n    };\r\n\r\n}).call(this);\n}());\n","/*!\n* svg.select.js - An extension of svg.js which allows to select elements with mouse\n* @version 3.0.1\n* https://github.com/svgdotjs/svg.select.js\n*\n* @copyright Ulrich-Matthias Schfer\n* @license MIT\n*/;\n;(function() {\n\"use strict\";\n\nfunction SelectHandler(el) {\r\n\r\n    this.el = el;\r\n    el.remember('_selectHandler', this);\r\n    this.pointSelection = {isSelected: false};\r\n    this.rectSelection = {isSelected: false};\r\n\r\n    // helper list with position settings of each type of point\r\n    this.pointsList = {\r\n      lt: [ 0, 0 ],\r\n      rt: [ 'width', 0 ],\r\n      rb: [ 'width', 'height' ],\r\n      lb: [ 0, 'height' ],\r\n      t: [ 'width', 0 ],\r\n      r: [ 'width', 'height' ],\r\n      b: [ 'width', 'height' ],\r\n      l: [ 0, 'height' ]\r\n    };\r\n\r\n    // helper function to get point coordinates based on settings above and an object (bbox in our case)\r\n    this.pointCoord = function (setting, object, isPointCentered) {\r\n      var coord = typeof setting !== 'string' ? setting : object[setting];\r\n      // Top, bottom, right and left points are placed in the center of element width/height\r\n      return isPointCentered ? coord / 2 : coord\r\n    }\r\n\r\n    this.pointCoords = function (point, object) {\r\n      var settings = this.pointsList[point];\r\n\r\n      return {\r\n        x: this.pointCoord(settings[0], object, (point === 't' || point === 'b')),\r\n        y: this.pointCoord(settings[1], object, (point === 'r' || point === 'l'))\r\n      }\r\n    }\r\n}\r\n\r\nSelectHandler.prototype.init = function (value, options) {\r\n\r\n    var bbox = this.el.bbox();\r\n    this.options = {};\r\n\r\n    // store defaults list of points in order to verify users config\r\n    var points = this.el.selectize.defaults.points;\r\n\r\n    // Merging the defaults and the options-object together\r\n    for (var i in this.el.selectize.defaults) {\r\n        this.options[i] = this.el.selectize.defaults[i];\r\n        if (options[i] !== undefined) {\r\n            this.options[i] = options[i];\r\n        }\r\n    }\r\n\r\n    // prepare & validate list of points to be added (or excluded)\r\n    var pointsLists = ['points', 'pointsExclude'];\r\n\r\n    for (var i in pointsLists) {\r\n      var option = this.options[pointsLists[i]];\r\n\r\n      if (typeof option === 'string') {\r\n        if (option.length > 0) {\r\n          // if set as comma separated string list => convert it into an array\r\n          option = option.split(/\\s*,\\s*/i);\r\n        } else {\r\n          option = [];\r\n        }\r\n      } else if (typeof option === 'boolean' && pointsLists[i] === 'points') {\r\n        // this is not needed, but let's have it for legacy support\r\n        option = option ? points : [];\r\n      }\r\n\r\n      this.options[pointsLists[i]] = option;\r\n    }\r\n\r\n    // intersect correct all points options with users config (exclude unwanted points)\r\n    // ES5 -> NO arrow functions nor Array.includes()\r\n    this.options.points = [ points, this.options.points ].reduce(\r\n      function (a, b) {\r\n        return a.filter(\r\n          function (c) {\r\n            return b.indexOf(c) > -1;\r\n          }\r\n        )\r\n      }\r\n    );\r\n\r\n    // exclude pointsExclude, if wanted\r\n    this.options.points = [ this.options.points, this.options.pointsExclude ].reduce(\r\n      function (a, b) {\r\n        return a.filter(\r\n          function (c) {\r\n            return b.indexOf(c) < 0;\r\n          }\r\n        )\r\n      }\r\n    );\r\n\r\n    this.parent = this.el.parent();\r\n    this.nested = (this.nested || this.parent.group());\r\n    this.nested.matrix(new SVG.Matrix(this.el).translate(bbox.x, bbox.y));\r\n\r\n    // When deepSelect is enabled and the element is a line/polyline/polygon, draw only points for moving\r\n    if (this.options.deepSelect && ['line', 'polyline', 'polygon'].indexOf(this.el.type) !== -1) {\r\n        this.selectPoints(value);\r\n    } else {\r\n        this.selectRect(value);\r\n    }\r\n\r\n    this.observe();\r\n    this.cleanup();\r\n\r\n};\r\n\r\nSelectHandler.prototype.selectPoints = function (value) {\r\n\r\n    this.pointSelection.isSelected = value;\r\n\r\n    // When set is already there we dont have to create one\r\n    if (this.pointSelection.set) {\r\n        return this;\r\n    }\r\n\r\n    // Create our set of elements\r\n    this.pointSelection.set = this.parent.set();\r\n    // draw the points and mark the element as selected\r\n    this.drawPoints();\r\n\r\n    return this;\r\n\r\n};\r\n\r\n// create the point-array which contains the 2 points of a line or simply the points-array of polyline/polygon\r\nSelectHandler.prototype.getPointArray = function () {\r\n    var bbox = this.el.bbox();\r\n\r\n    return this.el.array().valueOf().map(function (el) {\r\n        return [el[0] - bbox.x, el[1] - bbox.y];\r\n    });\r\n};\r\n\r\n// Draws a points\r\nSelectHandler.prototype.drawPoints = function () {\r\n\r\n    var _this = this, array = this.getPointArray();\r\n\r\n    // go through the array of points\r\n    for (var i = 0, len = array.length; i < len; ++i) {\r\n\r\n        var curriedEvent = (function (k) {\r\n            return function (ev) {\r\n                ev = ev || window.event;\r\n                ev.preventDefault ? ev.preventDefault() : ev.returnValue = false;\r\n                ev.stopPropagation();\r\n\r\n                var x = ev.pageX || ev.touches[0].pageX;\r\n                var y = ev.pageY || ev.touches[0].pageY;\r\n                _this.el.fire('point', {x: x, y: y, i: k, event: ev});\r\n            };\r\n        })(i);\r\n\r\n        // add every point to the set\r\n        // add css-classes and a touchstart-event which fires our event for moving points\r\n        var point = this.drawPoint(array[i][0], array[i][1])\r\n                        .addClass(this.options.classPoints)\r\n                        .addClass(this.options.classPoints + '_point')\r\n                        .on('touchstart', curriedEvent)\r\n                        .on('mousedown', curriedEvent)\r\n        this.pointSelection.set.add(point);\r\n    }\r\n};\r\n\r\n// The function to draw single point\r\nSelectHandler.prototype.drawPoint = function (cx, cy) {\r\n    var pointType = this.options.pointType;\r\n\r\n    switch (pointType) {\r\n        case 'circle':\r\n            return this.drawCircle(cx, cy);\r\n        case 'rect':\r\n            return this.drawRect(cx, cy);\r\n        default:\r\n            if (typeof pointType === 'function') {\r\n                return pointType.call(this, cx, cy);\r\n            }\r\n\r\n            throw new Error('Unknown ' + pointType + ' point type!');\r\n    }\r\n};\r\n\r\n// The function to draw the circle point\r\nSelectHandler.prototype.drawCircle = function (cx, cy) {\r\n    return this.nested.circle(this.options.pointSize)\r\n                      .center(cx, cy);\r\n};\r\n\r\n// The function to draw the rect point\r\nSelectHandler.prototype.drawRect = function (cx, cy) {\r\n    return this.nested.rect(this.options.pointSize, this.options.pointSize)\r\n                      .center(cx, cy);\r\n};\r\n\r\n// every time a point is moved, we have to update the positions of our point\r\nSelectHandler.prototype.updatePointSelection = function () {\r\n    var array = this.getPointArray();\r\n\r\n    this.pointSelection.set.each(function (i) {\r\n        if (this.cx() === array[i][0] && this.cy() === array[i][1]) {\r\n            return;\r\n        }\r\n        this.center(array[i][0], array[i][1]);\r\n    });\r\n};\r\n\r\nSelectHandler.prototype.updateRectSelection = function () {\r\n    var _this = this, bbox = this.el.bbox();\r\n\r\n    this.rectSelection.set.get(0).attr({\r\n        width: bbox.width,\r\n        height: bbox.height\r\n    });\r\n\r\n    // set.get(1) is always in the upper left corner. no need to move it\r\n    if (this.options.points.length) {\r\n      this.options.points.map(function (point, index) {\r\n        var coords = _this.pointCoords(point, bbox);\r\n\r\n        _this.rectSelection.set.get(index + 1).center(coords.x, coords.y);\r\n      });\r\n    }\r\n\r\n    if (this.options.rotationPoint) {\r\n        var length = this.rectSelection.set.length();\r\n\r\n        this.rectSelection.set.get(length - 1).center(bbox.width / 2, 20);\r\n    }\r\n};\r\n\r\nSelectHandler.prototype.selectRect = function (value) {\r\n\r\n    var _this = this, bbox = this.el.bbox();\r\n\r\n    this.rectSelection.isSelected = value;\r\n\r\n    // when set is already p\r\n    this.rectSelection.set = this.rectSelection.set || this.parent.set();\r\n\r\n    // helperFunction to create a mouse-down function which triggers the event specified in `eventName`\r\n    function getMoseDownFunc(eventName) {\r\n        return function (ev) {\r\n            ev = ev || window.event;\r\n            ev.preventDefault ? ev.preventDefault() : ev.returnValue = false;\r\n            ev.stopPropagation();\r\n\r\n            var x = ev.pageX || ev.touches[0].pageX;\r\n            var y = ev.pageY || ev.touches[0].pageY;\r\n            _this.el.fire(eventName, {x: x, y: y, event: ev});\r\n        };\r\n    }\r\n\r\n    // create the selection-rectangle and add the css-class\r\n    if (!this.rectSelection.set.get(0)) {\r\n        this.rectSelection.set.add(this.nested.rect(bbox.width, bbox.height).addClass(this.options.classRect));\r\n    }\r\n\r\n    // Draw Points at the edges, if enabled\r\n    if (this.options.points.length && this.rectSelection.set.length() < 2) {\r\n        var ename =\"touchstart\", mname = \"mousedown\";\r\n\r\n        this.options.points.map(function (point, index) {\r\n            var coords = _this.pointCoords(point, bbox);\r\n\r\n            var pointElement = _this.drawPoint(coords.x, coords.y)\r\n                                    .attr('class', _this.options.classPoints + '_' + point)\r\n                                    .on(mname, getMoseDownFunc(point))\r\n                                    .on(ename, getMoseDownFunc(point));\r\n            _this.rectSelection.set.add(pointElement);\r\n        });\r\n\r\n        this.rectSelection.set.each(function () {\r\n            this.addClass(_this.options.classPoints);\r\n        });\r\n    }\r\n\r\n    // draw rotationPint, if enabled\r\n    if (this.options.rotationPoint && ((this.options.points && !this.rectSelection.set.get(9)) || (!this.options.points && !this.rectSelection.set.get(1)))) {\r\n\r\n        var curriedEvent = function (ev) {\r\n            ev = ev || window.event;\r\n            ev.preventDefault ? ev.preventDefault() : ev.returnValue = false;\r\n            ev.stopPropagation();\r\n\r\n            var x = ev.pageX || ev.touches[0].pageX;\r\n            var y = ev.pageY || ev.touches[0].pageY;\r\n            _this.el.fire('rot', {x: x, y: y, event: ev});\r\n        };\r\n\r\n        var pointElement = this.drawPoint(bbox.width / 2, 20)\r\n                              .attr('class', this.options.classPoints + '_rot')\r\n                              .on(\"touchstart\", curriedEvent)\r\n                              .on(\"mousedown\", curriedEvent);\r\n        this.rectSelection.set.add(pointElement);\r\n    }\r\n\r\n};\r\n\r\nSelectHandler.prototype.handler = function () {\r\n\r\n    var bbox = this.el.bbox();\r\n    this.nested.matrix(new SVG.Matrix(this.el).translate(bbox.x, bbox.y));\r\n\r\n    if (this.rectSelection.isSelected) {\r\n        this.updateRectSelection();\r\n    }\r\n\r\n    if (this.pointSelection.isSelected) {\r\n        this.updatePointSelection();\r\n    }\r\n\r\n};\r\n\r\nSelectHandler.prototype.observe = function () {\r\n    var _this = this;\r\n\r\n    if (MutationObserver) {\r\n        if (this.rectSelection.isSelected || this.pointSelection.isSelected) {\r\n            this.observerInst = this.observerInst || new MutationObserver(function () {\r\n                _this.handler();\r\n            });\r\n            this.observerInst.observe(this.el.node, {attributes: true});\r\n        } else {\r\n            try {\r\n                this.observerInst.disconnect();\r\n                delete this.observerInst;\r\n            } catch (e) {\r\n            }\r\n        }\r\n    } else {\r\n        this.el.off('DOMAttrModified.select');\r\n\r\n        if (this.rectSelection.isSelected || this.pointSelection.isSelected) {\r\n            this.el.on('DOMAttrModified.select', function () {\r\n                _this.handler();\r\n            });\r\n        }\r\n    }\r\n};\r\n\r\nSelectHandler.prototype.cleanup = function () {\r\n\r\n    //var _this = this;\r\n\r\n    if (!this.rectSelection.isSelected && this.rectSelection.set) {\r\n        // stop watching the element, remove the selection\r\n        this.rectSelection.set.each(function () {\r\n            this.remove();\r\n        });\r\n\r\n        this.rectSelection.set.clear();\r\n        delete this.rectSelection.set;\r\n    }\r\n\r\n    if (!this.pointSelection.isSelected && this.pointSelection.set) {\r\n        // Remove all points, clear the set, stop watching the element\r\n        this.pointSelection.set.each(function () {\r\n            this.remove();\r\n        });\r\n\r\n        this.pointSelection.set.clear();\r\n        delete this.pointSelection.set;\r\n    }\r\n\r\n    if (!this.pointSelection.isSelected && !this.rectSelection.isSelected) {\r\n        this.nested.remove();\r\n        delete this.nested;\r\n\r\n    }\r\n};\r\n\r\n\r\nSVG.extend(SVG.Element, {\r\n    // Select element with mouse\r\n    selectize: function (value, options) {\r\n\r\n        // Check the parameters and reassign if needed\r\n        if (typeof value === 'object') {\r\n            options = value;\r\n            value = true;\r\n        }\r\n\r\n        var selectHandler = this.remember('_selectHandler') || new SelectHandler(this);\r\n\r\n        selectHandler.init(value === undefined ? true : value, options || {});\r\n\r\n        return this;\r\n\r\n    }\r\n});\r\n\r\nSVG.Element.prototype.selectize.defaults = {\r\n    points: ['lt', 'rt', 'rb', 'lb', 't', 'r', 'b', 'l'],    // which points to draw, default all\r\n    pointsExclude: [],                       // easier option if to exclude few than rewrite all\r\n    classRect: 'svg_select_boundingRect',    // Css-class added to the rect\r\n    classPoints: 'svg_select_points',        // Css-class added to the points\r\n    pointSize: 7,                            // size of point\r\n    rotationPoint: true,                     // If true, rotation point is drawn. Needed for rotation!\r\n    deepSelect: false,                       // If true, moving of single points is possible (only line, polyline, polyon)\r\n    pointType: 'circle'                      // Point type: circle or rect, default circle\r\n};\n}());\n","\nexport default class TinyQueue {\n    constructor(data = [], compare = defaultCompare) {\n        this.data = data;\n        this.length = this.data.length;\n        this.compare = compare;\n\n        if (this.length > 0) {\n            for (let i = (this.length >> 1) - 1; i >= 0; i--) this._down(i);\n        }\n    }\n\n    push(item) {\n        this.data.push(item);\n        this.length++;\n        this._up(this.length - 1);\n    }\n\n    pop() {\n        if (this.length === 0) return undefined;\n\n        const top = this.data[0];\n        const bottom = this.data.pop();\n        this.length--;\n\n        if (this.length > 0) {\n            this.data[0] = bottom;\n            this._down(0);\n        }\n\n        return top;\n    }\n\n    peek() {\n        return this.data[0];\n    }\n\n    _up(pos) {\n        const {data, compare} = this;\n        const item = data[pos];\n\n        while (pos > 0) {\n            const parent = (pos - 1) >> 1;\n            const current = data[parent];\n            if (compare(item, current) >= 0) break;\n            data[pos] = current;\n            pos = parent;\n        }\n\n        data[pos] = item;\n    }\n\n    _down(pos) {\n        const {data, compare} = this;\n        const halfLength = this.length >> 1;\n        const item = data[pos];\n\n        while (pos < halfLength) {\n            let left = (pos << 1) + 1;\n            let best = data[left];\n            const right = left + 1;\n\n            if (right < this.length && compare(data[right], best) < 0) {\n                left = right;\n                best = data[right];\n            }\n            if (compare(best, item) >= 0) break;\n\n            data[pos] = best;\n            pos = left;\n        }\n\n        data[pos] = item;\n    }\n}\n\nfunction defaultCompare(a, b) {\n    return a < b ? -1 : a > b ? 1 : 0;\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.b = document.baseURI || self.location.href;\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t928: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n// no on chunks loaded\n\n// no jsonp function","__webpack_require__.nc = undefined;","// Copyright (C) 2019-2022 Intel Corporation\n//\n// SPDX-License-Identifier: MIT\n\nconst BASE_STROKE_WIDTH = 1.25;\nconst BASE_GRID_WIDTH = 2;\nconst BASE_POINT_SIZE = 4;\nconst TEXT_MARGIN = 10;\nconst AREA_THRESHOLD = 9;\nconst SIZE_THRESHOLD = 3;\nconst POINTS_STROKE_WIDTH = 1;\nconst POINTS_SELECTED_STROKE_WIDTH = 4;\nconst MIN_EDGE_LENGTH = 3;\nconst CUBOID_ACTIVE_EDGE_STROKE_WIDTH = 2.5;\nconst CUBOID_UNACTIVE_EDGE_STROKE_WIDTH = 1.75;\nconst UNDEFINED_ATTRIBUTE_VALUE = '__undefined__';\nconst ARROW_PATH = 'M13.162 6.284L.682.524a.483.483 0 0 0-.574.134.477.477 0 ' +\n    '0 0-.012.59L4.2 6.72.096 12.192a.479.479 0 0 0 .585.724l12.48-5.76a.48.48 0 0 0 0-.872z';\nconst BASE_PATTERN_SIZE = 5;\nconst SNAP_TO_ANGLE_RESIZE_DEFAULT = 0.1;\nconst SNAP_TO_ANGLE_RESIZE_SHIFT = 15;\nconst MINIMUM_TEXT_FONT_SIZE = 8;\nconst SKELETON_RECT_MARGIN = 20;\n\nconst DEFAULT_SHAPE_TEXT_SIZE = 12;\nconst DEFAULT_SHAPE_TEXT_CONTENT = 'id,label,attributes,source,descriptions';\nconst DEFAULT_SHAPE_TEXT_POSITION: 'auto' | 'center' = 'auto';\nconst DEFAULT_UNDEFINED_ATTR_VALUE = '__undefined__';\n\nconst CONFLICT_COLOR = '#ff4800';\nconst WARNING_COLOR = '#ff7301';\nconst SHADED_COLOR = '#808080';\n\nexport default {\n    BASE_STROKE_WIDTH,\n    BASE_GRID_WIDTH,\n    BASE_POINT_SIZE,\n    TEXT_MARGIN,\n    AREA_THRESHOLD,\n    SIZE_THRESHOLD,\n    POINTS_STROKE_WIDTH,\n    POINTS_SELECTED_STROKE_WIDTH,\n    MIN_EDGE_LENGTH,\n    CUBOID_ACTIVE_EDGE_STROKE_WIDTH,\n    CUBOID_UNACTIVE_EDGE_STROKE_WIDTH,\n    UNDEFINED_ATTRIBUTE_VALUE,\n    ARROW_PATH,\n    BASE_PATTERN_SIZE,\n    SNAP_TO_ANGLE_RESIZE_DEFAULT,\n    SNAP_TO_ANGLE_RESIZE_SHIFT,\n    DEFAULT_SHAPE_TEXT_SIZE,\n    DEFAULT_SHAPE_TEXT_CONTENT,\n    DEFAULT_SHAPE_TEXT_POSITION,\n    DEFAULT_UNDEFINED_ATTR_VALUE,\n    MINIMUM_TEXT_FONT_SIZE,\n    SKELETON_RECT_MARGIN,\n    CONFLICT_COLOR,\n    WARNING_COLOR,\n    SHADED_COLOR,\n};\n","// Copyright (C) 2019-2022 Intel Corporation\n//\n// SPDX-License-Identifier: MIT\n\nexport interface Master {\n    subscribe(listener: Listener): void;\n    notify(reason: string): void;\n}\n\nexport interface Listener {\n    notify(master: Master, reason: string): void;\n}\n\nexport class MasterImpl implements Master {\n    private listeners: Listener[];\n\n    public constructor() {\n        this.listeners = [];\n    }\n\n    public subscribe(listener: Listener): void {\n        this.listeners.push(listener);\n    }\n\n    public notify(reason: string): void {\n        for (const listener of this.listeners) {\n            listener.notify(this, reason);\n        }\n    }\n}\n","// Copyright (C) 2019-2022 Intel Corporation\n// Copyright (C) 2022 CVAT.ai Corporation\n//\n// SPDX-License-Identifier: MIT\n\nimport consts from './consts';\nimport { MasterImpl } from './master';\n\nexport interface Size {\n    width: number;\n    height: number;\n}\n\nexport interface Image {\n    renderWidth: number;\n    renderHeight: number;\n    imageData: ImageBitmap;\n}\n\nexport interface Position {\n    x: number;\n    y: number;\n}\n\nexport interface Geometry {\n    image: Size;\n    canvas: Size;\n    grid: Size;\n    top: number;\n    left: number;\n    scale: number;\n    offset: number;\n    angle: number;\n}\n\nexport interface FocusData {\n    clientID: number;\n    padding: number;\n}\n\nexport interface ActiveElement {\n    clientID: number | null;\n    attributeID: number | null;\n}\n\nexport enum HighlightSeverity {\n    ERROR = 'error',\n    WARNING = 'warning',\n}\n\nexport interface HighlightedElements {\n    elementsIDs: number [];\n    severity: HighlightSeverity;\n}\n\nexport enum RectDrawingMethod {\n    CLASSIC = 'By 2 points',\n    EXTREME_POINTS = 'By 4 points',\n}\n\nexport enum CuboidDrawingMethod {\n    CLASSIC = 'From rectangle',\n    CORNER_POINTS = 'By 4 points',\n}\n\nexport enum ColorBy {\n    INSTANCE = 'Instance',\n    GROUP = 'Group',\n    LABEL = 'Label',\n}\n\nexport interface Configuration {\n    smoothImage?: boolean;\n    autoborders?: boolean;\n    displayAllText?: boolean;\n    textFontSize?: number;\n    textPosition?: 'auto' | 'center';\n    textContent?: string;\n    undefinedAttrValue?: string;\n    showProjections?: boolean;\n    showConflicts?: boolean;\n    forceDisableEditing?: boolean;\n    intelligentPolygonCrop?: boolean;\n    forceFrameUpdate?: boolean;\n    CSSImageFilter?: string;\n    colorBy?: ColorBy;\n    selectedShapeOpacity?: number;\n    shapeOpacity?: number;\n    controlPointsSize?: number;\n    outlinedBorders?: string | false;\n    resetZoom?: boolean;\n}\n\nexport interface BrushTool {\n    type: 'brush' | 'eraser' | 'polygon-plus' | 'polygon-minus';\n    color: string;\n    form: 'circle' | 'square';\n    size: number;\n}\n\nexport interface DrawData {\n    enabled: boolean;\n    continue?: boolean;\n    shapeType?: string;\n    rectDrawingMethod?: RectDrawingMethod;\n    cuboidDrawingMethod?: CuboidDrawingMethod;\n    skeletonSVG?: string;\n    numberOfPoints?: number;\n    initialState?: any;\n    crosshair?: boolean;\n    brushTool?: BrushTool;\n    redraw?: number;\n    onDrawDone?: (data: object) => void;\n    onUpdateConfiguration?: (configuration: { brushTool?: Pick<BrushTool, 'size'> }) => void;\n}\n\nexport interface InteractionData {\n    enabled: boolean;\n    shapeType?: string;\n    crosshair?: boolean;\n    minPosVertices?: number;\n    minNegVertices?: number;\n    startWithBox?: boolean;\n    enableThreshold?: boolean;\n    enableSliding?: boolean;\n    allowRemoveOnlyLast?: boolean;\n    intermediateShape?: {\n        shapeType: string;\n        points: number[];\n    };\n    onChangeToolsBlockerState?: (event: string) => void;\n}\n\nexport interface InteractionResult {\n    points: number[];\n    shapeType: string;\n    button: number;\n}\n\nexport interface PolyEditData {\n    enabled: boolean;\n    state: any;\n    pointID: number;\n}\n\nexport interface MasksEditData {\n    enabled: boolean;\n    state?: any;\n    brushTool?: BrushTool;\n    onUpdateConfiguration?: (configuration: { brushTool?: Pick<BrushTool, 'size'> }) => void;\n}\n\nexport interface GroupData {\n    enabled: boolean;\n}\n\nexport interface MergeData {\n    enabled: boolean;\n}\n\nexport interface SplitData {\n    enabled: boolean;\n}\n\nexport enum FrameZoom {\n    MIN = 0.1,\n    MAX = 10,\n}\n\nexport enum UpdateReasons {\n    IMAGE_CHANGED = 'image_changed',\n    IMAGE_ZOOMED = 'image_zoomed',\n    IMAGE_FITTED = 'image_fitted',\n    IMAGE_MOVED = 'image_moved',\n    IMAGE_ROTATED = 'image_rotated',\n    GRID_UPDATED = 'grid_updated',\n\n    ISSUE_REGIONS_UPDATED = 'issue_regions_updated',\n    OBJECTS_UPDATED = 'objects_updated',\n    SHAPE_ACTIVATED = 'shape_activated',\n    SHAPE_FOCUSED = 'shape_focused',\n    SHAPE_HIGHLIGHTED = 'shape_highlighted',\n\n    FITTED_CANVAS = 'fitted_canvas',\n\n    INTERACT = 'interact',\n    DRAW = 'draw',\n    EDIT = 'edit',\n    MERGE = 'merge',\n    SPLIT = 'split',\n    GROUP = 'group',\n    SELECT = 'select',\n    CANCEL = 'cancel',\n    BITMAP = 'bitmap',\n    SELECT_REGION = 'select_region',\n    DRAG_CANVAS = 'drag_canvas',\n    ZOOM_CANVAS = 'zoom_canvas',\n    CONFIG_UPDATED = 'config_updated',\n    DATA_FAILED = 'data_failed',\n    DESTROY = 'destroy',\n}\n\nexport enum Mode {\n    IDLE = 'idle',\n    DRAG = 'drag',\n    RESIZE = 'resize',\n    DRAW = 'draw',\n    EDIT = 'edit',\n    MERGE = 'merge',\n    SPLIT = 'split',\n    GROUP = 'group',\n    INTERACT = 'interact',\n    SELECT_REGION = 'select_region',\n    DRAG_CANVAS = 'drag_canvas',\n    ZOOM_CANVAS = 'zoom_canvas',\n}\n\nexport interface CanvasModel {\n    readonly imageBitmap: boolean;\n    readonly imageIsDeleted: boolean;\n    readonly image: Image | null;\n    readonly issueRegions: Record<number, { hidden: boolean; points: number[] }>;\n    readonly objects: any[];\n    readonly zLayer: number | null;\n    readonly gridSize: Size;\n    readonly focusData: FocusData;\n    readonly activeElement: ActiveElement;\n    readonly highlightedElements: HighlightedElements;\n    readonly drawData: DrawData;\n    readonly editData: MasksEditData;\n    readonly interactionData: InteractionData;\n    readonly mergeData: MergeData;\n    readonly splitData: SplitData;\n    readonly groupData: GroupData;\n    readonly configuration: Configuration;\n    readonly selected: any;\n    geometry: Geometry;\n    mode: Mode;\n    exception: Error | null;\n\n    zoom(x: number, y: number, direction: number): void;\n    move(topOffset: number, leftOffset: number): void;\n\n    setup(frameData: any, objectStates: any[], zLayer: number): void;\n    setupIssueRegions(issueRegions: Record<number, { hidden: boolean; points: number[] }>): void;\n    activate(clientID: number | null, attributeID: number | null): void;\n    highlight(clientIDs: number[] | null, severity: HighlightSeverity): void;\n    rotate(rotationAngle: number): void;\n    focus(clientID: number, padding: number): void;\n    fit(): void;\n    grid(stepX: number, stepY: number): void;\n\n    draw(drawData: DrawData): void;\n    edit(editData: MasksEditData): void;\n    group(groupData: GroupData): void;\n    split(splitData: SplitData): void;\n    merge(mergeData: MergeData): void;\n    select(objectState: any): void;\n    interact(interactionData: InteractionData): void;\n\n    fitCanvas(width: number, height: number): void;\n    bitmap(enabled: boolean): void;\n    selectRegion(enabled: boolean): void;\n    dragCanvas(enable: boolean): void;\n    zoomCanvas(enable: boolean): void;\n\n    isAbleToChangeFrame(): boolean;\n    configure(configuration: Configuration): void;\n    cancel(): void;\n    destroy(): void;\n}\n\nconst defaultData = {\n    drawData: {\n        enabled: false,\n    },\n    editData: {\n        enabled: false,\n    },\n    interactionData: {\n        enabled: false,\n    },\n    mergeData: {\n        enabled: false,\n    },\n    groupData: {\n        enabled: false,\n    },\n    splitData: {\n        enabled: false,\n    },\n};\n\nfunction hasShapeIsBeingDrawn(): boolean {\n    const [element] = window.document.getElementsByClassName('cvat_canvas_shape_drawing');\n    if (element) {\n        return !!(element as any).instance.remember('_paintHandler');\n    }\n\n    return false;\n}\n\nfunction disableInternalSVGDrawing(data: DrawData | MasksEditData, currentData: DrawData | MasksEditData): boolean {\n    // P.S. spaghetti code, but probably significant refactoring needed to find a better solution\n    // when it is a mask drawing/editing using polygon fill\n    // a user needs to close drawing/editing twice\n    // first close stops internal drawing/editing with svg.js\n    // the second one stops drawing/editing mask itself\n\n    return !data.enabled && currentData.enabled &&\n        (('shapeType' in currentData && currentData.shapeType === 'mask') ||\n        ('state' in currentData && currentData.state.shapeType === 'mask')) &&\n        currentData.brushTool?.type?.startsWith('polygon-') &&\n        hasShapeIsBeingDrawn();\n}\n\nexport class CanvasModelImpl extends MasterImpl implements CanvasModel {\n    private data: {\n        activeElement: ActiveElement;\n        highlightedElements: HighlightedElements;\n        angle: number;\n        canvasSize: Size;\n        configuration: Configuration;\n        imageBitmap: boolean;\n        image: Image | null;\n        imageID: number | null;\n        imageOffset: number;\n        imageSize: Size;\n        imageIsDeleted: boolean;\n        focusData: FocusData;\n        gridSize: Size;\n        objects: any[];\n        issueRegions: Record<number, { hidden: boolean; points: number[] }>;\n        scale: number;\n        top: number;\n        left: number;\n        fittedScale: number;\n        zLayer: number | null;\n        drawData: DrawData;\n        editData: MasksEditData;\n        interactionData: InteractionData;\n        mergeData: MergeData;\n        groupData: GroupData;\n        splitData: SplitData;\n        selected: any;\n        mode: Mode;\n        exception: Error | null;\n    };\n\n    public constructor() {\n        super();\n\n        this.data = {\n            activeElement: {\n                clientID: null,\n                attributeID: null,\n            },\n            highlightedElements: {\n                elementsIDs: [],\n                severity: null,\n            },\n            angle: 0,\n            canvasSize: {\n                height: 0,\n                width: 0,\n            },\n            configuration: {\n                smoothImage: true,\n                autoborders: false,\n                displayAllText: false,\n                showProjections: false,\n                showConflicts: false,\n                forceDisableEditing: false,\n                intelligentPolygonCrop: false,\n                forceFrameUpdate: false,\n                CSSImageFilter: '',\n                colorBy: ColorBy.LABEL,\n                selectedShapeOpacity: 0.5,\n                shapeOpacity: 0.2,\n                outlinedBorders: false,\n                resetZoom: true,\n                textFontSize: consts.DEFAULT_SHAPE_TEXT_SIZE,\n                controlPointsSize: consts.BASE_POINT_SIZE,\n                textPosition: consts.DEFAULT_SHAPE_TEXT_POSITION,\n                textContent: consts.DEFAULT_SHAPE_TEXT_CONTENT,\n                undefinedAttrValue: consts.DEFAULT_UNDEFINED_ATTR_VALUE,\n            },\n            imageBitmap: false,\n            image: null,\n            imageID: null,\n            imageOffset: 0,\n            imageSize: {\n                height: 0,\n                width: 0,\n            },\n            imageIsDeleted: false,\n            focusData: {\n                clientID: 0,\n                padding: 0,\n            },\n            gridSize: {\n                height: 100,\n                width: 100,\n            },\n            objects: [],\n            issueRegions: {},\n            scale: 1,\n            top: 0,\n            left: 0,\n            fittedScale: 0,\n            zLayer: null,\n            selected: null,\n            mode: Mode.IDLE,\n            exception: null,\n            ...defaultData,\n        };\n    }\n\n    public zoom(x: number, y: number, direction: number): void {\n        const oldScale: number = this.data.scale;\n        const newScale: number = direction > 0 ? (oldScale * 6) / 5 : (oldScale * 5) / 6;\n        this.data.scale = Math.min(Math.max(newScale, FrameZoom.MIN), FrameZoom.MAX);\n\n        const { angle } = this.data;\n\n        const mutiplier = Math.sin((angle * Math.PI) / 180) + Math.cos((angle * Math.PI) / 180);\n        if ((angle / 90) % 2) {\n            // 90, 270, ..\n            const topMultiplier = (x - this.data.imageSize.width / 2) * (oldScale / this.data.scale - 1);\n            const leftMultiplier = (y - this.data.imageSize.height / 2) * (oldScale / this.data.scale - 1);\n            this.data.top += mutiplier * topMultiplier * this.data.scale;\n            this.data.left -= mutiplier * leftMultiplier * this.data.scale;\n        } else {\n            const leftMultiplier = (x - this.data.imageSize.width / 2) * (oldScale / this.data.scale - 1);\n            const topMultiplier = (y - this.data.imageSize.height / 2) * (oldScale / this.data.scale - 1);\n            this.data.left += mutiplier * leftMultiplier * this.data.scale;\n            this.data.top += mutiplier * topMultiplier * this.data.scale;\n        }\n\n        this.notify(UpdateReasons.IMAGE_ZOOMED);\n    }\n\n    public move(topOffset: number, leftOffset: number): void {\n        this.data.top += topOffset;\n        this.data.left += leftOffset;\n        this.notify(UpdateReasons.IMAGE_MOVED);\n    }\n\n    public fitCanvas(width: number, height: number): void {\n        this.data.canvasSize.height = height;\n        this.data.canvasSize.width = width;\n\n        this.data.imageOffset = Math.floor(\n            Math.max(this.data.canvasSize.height / FrameZoom.MIN, this.data.canvasSize.width / FrameZoom.MIN),\n        );\n\n        this.notify(UpdateReasons.FITTED_CANVAS);\n        this.notify(UpdateReasons.OBJECTS_UPDATED);\n        this.notify(UpdateReasons.ISSUE_REGIONS_UPDATED);\n    }\n\n    public bitmap(enabled: boolean): void {\n        this.data.imageBitmap = enabled;\n        this.notify(UpdateReasons.BITMAP);\n    }\n\n    public selectRegion(enable: boolean): void {\n        if (enable && this.data.mode !== Mode.IDLE) {\n            throw Error(`Canvas is busy. Action: ${this.data.mode}`);\n        }\n\n        if (!enable && this.data.mode !== Mode.SELECT_REGION) {\n            throw Error(`Canvas is not in the region selecting mode. Action: ${this.data.mode}`);\n        }\n\n        this.data.mode = enable ? Mode.SELECT_REGION : Mode.IDLE;\n        this.notify(UpdateReasons.SELECT_REGION);\n    }\n\n    public dragCanvas(enable: boolean): void {\n        if (enable && this.data.mode !== Mode.IDLE) {\n            throw Error(`Canvas is busy. Action: ${this.data.mode}`);\n        }\n\n        if (!enable && this.data.mode !== Mode.DRAG_CANVAS) {\n            throw Error(`Canvas is not in the drag mode. Action: ${this.data.mode}`);\n        }\n\n        this.data.mode = enable ? Mode.DRAG_CANVAS : Mode.IDLE;\n        this.notify(UpdateReasons.DRAG_CANVAS);\n    }\n\n    public zoomCanvas(enable: boolean): void {\n        if (enable && this.data.mode !== Mode.IDLE) {\n            throw Error(`Canvas is busy. Action: ${this.data.mode}`);\n        }\n\n        if (!enable && this.data.mode !== Mode.ZOOM_CANVAS) {\n            throw Error(`Canvas is not in the zoom mode. Action: ${this.data.mode}`);\n        }\n\n        this.data.mode = enable ? Mode.ZOOM_CANVAS : Mode.IDLE;\n        this.notify(UpdateReasons.ZOOM_CANVAS);\n    }\n\n    public setup(frameData: any, objectStates: any[], zLayer: number): void {\n        if (this.data.imageID !== frameData.number) {\n            if ([Mode.EDIT, Mode.DRAG, Mode.RESIZE].includes(this.data.mode)) {\n                throw Error(`Canvas is busy. Action: ${this.data.mode}`);\n            }\n        }\n        if (frameData.number === this.data.imageID &&\n            frameData.deleted === this.data.imageIsDeleted &&\n            !this.data.configuration.forceFrameUpdate\n        ) {\n            this.data.zLayer = zLayer;\n            this.data.objects = objectStates;\n            this.notify(UpdateReasons.OBJECTS_UPDATED);\n            return;\n        }\n\n        this.data.imageID = frameData.number;\n        frameData\n            .data((): void => {\n                this.data.image = null;\n                this.notify(UpdateReasons.IMAGE_CHANGED);\n            })\n            .then((data: Image): void => {\n                if (frameData.number !== this.data.imageID) {\n                    // already another image\n                    return;\n                }\n\n                const relativeScaling = this.data.scale / this.data.fittedScale;\n                const prevImageLeft = this.data.left;\n                const prevImageTop = this.data.top;\n                const prevImageWidth = this.data.imageSize.width;\n                const prevImageHeight = this.data.imageSize.height;\n\n                this.data.imageSize = {\n                    height: frameData.height as number,\n                    width: frameData.width as number,\n                };\n\n                this.data.image = data;\n                this.data.imageIsDeleted = frameData.deleted;\n                if (this.data.imageIsDeleted) {\n                    this.data.angle = 0;\n                }\n\n                this.fit();\n\n                // restore correct image position after switching to a new frame\n                // if corresponding option is disabled\n                // prevImageHeight and prevImageWidth are initialized by 0 by default\n                if (prevImageHeight !== 0 && prevImageWidth !== 0 && !this.data.configuration.resetZoom) {\n                    const leftOffset = Math.round((this.data.imageSize.width - prevImageWidth) / 2);\n                    const topOffset = Math.round((this.data.imageSize.height - prevImageHeight) / 2);\n                    this.data.left = prevImageLeft - leftOffset;\n                    this.data.top = prevImageTop - topOffset;\n                    this.data.scale *= relativeScaling;\n                }\n\n                this.notify(UpdateReasons.IMAGE_CHANGED);\n                this.data.zLayer = zLayer;\n                this.data.objects = objectStates;\n                this.notify(UpdateReasons.OBJECTS_UPDATED);\n            })\n            .catch((exception: any): void => {\n                this.data.exception = exception;\n                // don't notify when the frame is no longer needed\n                if (typeof exception !== 'number') {\n                    this.notify(UpdateReasons.DATA_FAILED);\n                }\n            });\n    }\n\n    public setupIssueRegions(issueRegions: Record<number, { hidden: boolean; points: number[] }>): void {\n        this.data.issueRegions = issueRegions;\n        this.notify(UpdateReasons.ISSUE_REGIONS_UPDATED);\n    }\n\n    public activate(clientID: number | null, attributeID: number | null): void {\n        if (this.data.activeElement.clientID === clientID && this.data.activeElement.attributeID === attributeID) {\n            return;\n        }\n\n        if (this.data.mode !== Mode.IDLE && clientID !== null) {\n            throw Error(`Canvas is busy. Action: ${this.data.mode}`);\n        }\n\n        if (typeof clientID === 'number') {\n            const [state] = this.objects.filter((_state: any): boolean => _state.clientID === clientID);\n            if (!state || state.objectType === 'tag') {\n                return;\n            }\n        }\n\n        this.data.activeElement = {\n            clientID,\n            attributeID,\n        };\n\n        this.notify(UpdateReasons.SHAPE_ACTIVATED);\n    }\n\n    public highlight(clientIDs: number[] | null, severity: HighlightSeverity | null): void {\n        if (Array.isArray(clientIDs)) {\n            this.data.highlightedElements = {\n                elementsIDs: clientIDs,\n                severity,\n            };\n        } else {\n            this.data.highlightedElements = {\n                elementsIDs: [],\n                severity: null,\n            };\n        }\n\n        this.notify(UpdateReasons.SHAPE_HIGHLIGHTED);\n    }\n\n    public rotate(rotationAngle: number): void {\n        if (this.data.angle !== rotationAngle && !this.data.imageIsDeleted) {\n            this.data.angle = (360 + Math.floor(rotationAngle / 90) * 90) % 360;\n            this.notify(UpdateReasons.IMAGE_ROTATED);\n        }\n    }\n\n    public focus(clientID: number, padding: number): void {\n        this.data.focusData = {\n            clientID,\n            padding,\n        };\n\n        this.notify(UpdateReasons.SHAPE_FOCUSED);\n    }\n\n    public fit(): void {\n        const { angle } = this.data;\n\n        if ((angle / 90) % 2) {\n            // 90, 270, ..\n            this.data.scale = Math.min(\n                this.data.canvasSize.width / this.data.imageSize.height,\n                this.data.canvasSize.height / this.data.imageSize.width,\n            );\n        } else {\n            this.data.scale = Math.min(\n                this.data.canvasSize.width / this.data.imageSize.width,\n                this.data.canvasSize.height / this.data.imageSize.height,\n            );\n        }\n\n        this.data.scale = Math.min(Math.max(this.data.scale, FrameZoom.MIN), FrameZoom.MAX);\n        this.data.top = this.data.canvasSize.height / 2 - this.data.imageSize.height / 2;\n        this.data.left = this.data.canvasSize.width / 2 - this.data.imageSize.width / 2;\n\n        // scale is changed during zooming or translating\n        // so, remember fitted scale to compute fit-relative scaling\n        this.data.fittedScale = this.data.scale;\n\n        this.notify(UpdateReasons.IMAGE_FITTED);\n    }\n\n    public grid(stepX: number, stepY: number): void {\n        this.data.gridSize = {\n            height: stepY,\n            width: stepX,\n        };\n\n        this.notify(UpdateReasons.GRID_UPDATED);\n    }\n\n    public draw(drawData: DrawData): void {\n        if (![Mode.IDLE, Mode.DRAW].includes(this.data.mode)) {\n            throw Error(`Canvas is busy. Action: ${this.data.mode}`);\n        }\n\n        if (drawData.enabled) {\n            if (drawData.shapeType === 'skeleton' && !drawData.skeletonSVG) {\n                throw new Error('Skeleton template must be specified when drawing a skeleton');\n            }\n\n            if (!drawData.shapeType && !drawData.initialState) {\n                throw new Error('A shape type is not specified');\n            } else if (typeof drawData.numberOfPoints !== 'undefined') {\n                if (drawData.shapeType === 'polygon' && drawData.numberOfPoints < 3) {\n                    throw new Error('A polygon consists of at least 3 points');\n                } else if (drawData.shapeType === 'polyline' && drawData.numberOfPoints < 2) {\n                    throw new Error('A polyline consists of at least 2 points');\n                }\n            }\n        }\n\n        if (typeof drawData.redraw === 'number') {\n            const clientID = drawData.redraw;\n            const [state] = this.data.objects.filter((_state: any): boolean => _state.clientID === clientID);\n\n            if (state) {\n                this.data.drawData = { ...drawData };\n                this.data.drawData.shapeType = state.shapeType;\n            } else {\n                return;\n            }\n        } else {\n            if (disableInternalSVGDrawing(drawData, this.data.drawData)) {\n                this.notify(UpdateReasons.DRAW);\n                return;\n            }\n\n            this.data.drawData = { ...drawData };\n            if (this.data.drawData.initialState) {\n                this.data.drawData.shapeType = this.data.drawData.initialState.shapeType;\n            }\n        }\n\n        // install default values for drawing method\n        if (drawData.enabled) {\n            if (drawData.shapeType === 'rectangle') {\n                this.data.drawData.rectDrawingMethod = drawData.rectDrawingMethod || RectDrawingMethod.CLASSIC;\n            }\n            if (drawData.shapeType === 'cuboid') {\n                this.data.drawData.cuboidDrawingMethod = drawData.cuboidDrawingMethod || CuboidDrawingMethod.CLASSIC;\n            }\n        }\n\n        this.notify(UpdateReasons.DRAW);\n    }\n\n    public edit(editData: MasksEditData): void {\n        if (![Mode.IDLE, Mode.EDIT].includes(this.data.mode)) {\n            throw Error(`Canvas is busy. Action: ${this.data.mode}`);\n        }\n\n        if (editData.enabled && !editData.state) {\n            throw Error('State must be specified when call edit() editing process');\n        }\n\n        if (this.data.editData.enabled && editData.enabled &&\n            editData.state.clientID !== this.data.editData.state.clientID\n        ) {\n            throw Error('State cannot be updated during editing, need to finish current editing first');\n        }\n\n        if (editData.enabled) {\n            this.data.editData = { ...editData };\n        } else if (disableInternalSVGDrawing(editData, this.data.editData)) {\n            this.notify(UpdateReasons.EDIT);\n            return;\n        } else {\n            this.data.editData = { enabled: false };\n        }\n\n        this.notify(UpdateReasons.EDIT);\n    }\n\n    public interact(interactionData: InteractionData): void {\n        if (![Mode.IDLE, Mode.INTERACT].includes(this.data.mode)) {\n            throw Error(`Canvas is busy. Action: ${this.data.mode}`);\n        }\n        const thresholdChanged = this.data.interactionData.enableThreshold !== interactionData.enableThreshold;\n        if (interactionData.enabled && !interactionData.intermediateShape && !thresholdChanged) {\n            if (this.data.interactionData.enabled) {\n                throw new Error('Interaction has been already started');\n            } else if (!interactionData.shapeType) {\n                throw new Error('A shape type was not specified');\n            }\n        }\n        this.data.interactionData = interactionData;\n        if (typeof this.data.interactionData.crosshair !== 'boolean') {\n            this.data.interactionData.crosshair = true;\n        }\n\n        this.notify(UpdateReasons.INTERACT);\n    }\n\n    public split(splitData: SplitData): void {\n        if (![Mode.IDLE, Mode.SPLIT].includes(this.data.mode)) {\n            throw Error(`Canvas is busy. Action: ${this.data.mode}`);\n        }\n\n        if (this.data.splitData.enabled && splitData.enabled) {\n            return;\n        }\n\n        if (!this.data.splitData.enabled && !splitData.enabled) {\n            return;\n        }\n\n        this.data.splitData = { ...splitData };\n        this.notify(UpdateReasons.SPLIT);\n    }\n\n    public group(groupData: GroupData): void {\n        if (![Mode.IDLE, Mode.GROUP].includes(this.data.mode)) {\n            throw Error(`Canvas is busy. Action: ${this.data.mode}`);\n        }\n\n        if (this.data.groupData.enabled && groupData.enabled) {\n            return;\n        }\n\n        if (!this.data.groupData.enabled && !groupData.enabled) {\n            return;\n        }\n\n        this.data.groupData = { ...groupData };\n        this.notify(UpdateReasons.GROUP);\n    }\n\n    public merge(mergeData: MergeData): void {\n        if (![Mode.IDLE, Mode.MERGE].includes(this.data.mode)) {\n            throw Error(`Canvas is busy. Action: ${this.data.mode}`);\n        }\n\n        if (this.data.mergeData.enabled && mergeData.enabled) {\n            return;\n        }\n\n        if (!this.data.mergeData.enabled && !mergeData.enabled) {\n            return;\n        }\n\n        this.data.mergeData = { ...mergeData };\n        this.notify(UpdateReasons.MERGE);\n    }\n\n    public select(objectState: any): void {\n        this.data.selected = objectState;\n        this.notify(UpdateReasons.SELECT);\n        this.data.selected = null;\n    }\n\n    public configure(configuration: Configuration): void {\n        if (typeof configuration.displayAllText === 'boolean') {\n            this.data.configuration.displayAllText = configuration.displayAllText;\n        }\n\n        if (typeof configuration.textFontSize === 'number' && configuration.textFontSize >= consts.MINIMUM_TEXT_FONT_SIZE) {\n            this.data.configuration.textFontSize = configuration.textFontSize;\n        }\n\n        if (typeof configuration.controlPointsSize === 'number') {\n            this.data.configuration.controlPointsSize = configuration.controlPointsSize;\n        }\n\n        if (['auto', 'center'].includes(configuration.textPosition)) {\n            this.data.configuration.textPosition = configuration.textPosition;\n        }\n\n        if (typeof configuration.textContent === 'string') {\n            const splitted = configuration.textContent.split(',').filter((entry: string) => !!entry);\n            if (splitted.every((entry: string) => ['id', 'label', 'attributes', 'source', 'descriptions'].includes(entry))) {\n                this.data.configuration.textContent = configuration.textContent;\n            }\n        }\n\n        if (typeof configuration.showProjections === 'boolean') {\n            this.data.configuration.showProjections = configuration.showProjections;\n        }\n        if (typeof configuration.autoborders === 'boolean') {\n            this.data.configuration.autoborders = configuration.autoborders;\n        }\n        if (typeof configuration.smoothImage === 'boolean') {\n            this.data.configuration.smoothImage = configuration.smoothImage;\n        }\n        if (typeof configuration.undefinedAttrValue === 'string') {\n            this.data.configuration.undefinedAttrValue = configuration.undefinedAttrValue;\n        }\n        if (typeof configuration.forceDisableEditing === 'boolean') {\n            this.data.configuration.forceDisableEditing = configuration.forceDisableEditing;\n        }\n        if (typeof configuration.intelligentPolygonCrop === 'boolean') {\n            this.data.configuration.intelligentPolygonCrop = configuration.intelligentPolygonCrop;\n        }\n        if (typeof configuration.forceFrameUpdate === 'boolean') {\n            this.data.configuration.forceFrameUpdate = configuration.forceFrameUpdate;\n        }\n        if (typeof configuration.resetZoom === 'boolean') {\n            this.data.configuration.resetZoom = configuration.resetZoom;\n        }\n        if (typeof configuration.selectedShapeOpacity === 'number') {\n            this.data.configuration.selectedShapeOpacity = configuration.selectedShapeOpacity;\n        }\n        if (typeof configuration.shapeOpacity === 'number') {\n            this.data.configuration.shapeOpacity = configuration.shapeOpacity;\n        }\n        if (['string', 'boolean'].includes(typeof configuration.outlinedBorders)) {\n            this.data.configuration.outlinedBorders = configuration.outlinedBorders;\n        }\n        if (Object.values(ColorBy).includes(configuration.colorBy)) {\n            this.data.configuration.colorBy = configuration.colorBy;\n        }\n\n        if (typeof configuration.showConflicts === 'boolean') {\n            this.data.configuration.showConflicts = configuration.showConflicts;\n        }\n\n        if (typeof configuration.CSSImageFilter === 'string') {\n            this.data.configuration.CSSImageFilter = configuration.CSSImageFilter;\n        }\n\n        this.notify(UpdateReasons.CONFIG_UPDATED);\n    }\n\n    public isAbleToChangeFrame(): boolean {\n        const isUnable = [Mode.DRAG, Mode.EDIT, Mode.RESIZE, Mode.INTERACT].includes(this.data.mode) ||\n            (this.data.mode === Mode.DRAW && typeof this.data.drawData.redraw === 'number');\n\n        return !isUnable;\n    }\n\n    public cancel(): void {\n        this.data = {\n            ...this.data,\n            ...defaultData,\n        };\n        this.notify(UpdateReasons.CANCEL);\n    }\n\n    public destroy(): void {\n        this.notify(UpdateReasons.DESTROY);\n    }\n\n    public get configuration(): Configuration {\n        return { ...this.data.configuration };\n    }\n\n    public get geometry(): Geometry {\n        return {\n            angle: this.data.angle,\n            canvas: { ...this.data.canvasSize },\n            image: { ...this.data.imageSize },\n            grid: { ...this.data.gridSize },\n            left: this.data.left,\n            offset: this.data.imageOffset,\n            scale: this.data.scale,\n            top: this.data.top,\n        };\n    }\n\n    public set geometry(geometry: Geometry) {\n        this.data.angle = geometry.angle;\n        this.data.canvasSize = { ...geometry.canvas };\n        this.data.imageSize = { ...geometry.image };\n        this.data.gridSize = { ...geometry.grid };\n        this.data.left = geometry.left;\n        this.data.top = geometry.top;\n        this.data.imageOffset = geometry.offset;\n        this.data.scale = geometry.scale;\n\n        this.data.imageOffset = Math.floor(\n            Math.max(this.data.canvasSize.height / FrameZoom.MIN, this.data.canvasSize.width / FrameZoom.MIN),\n        );\n    }\n\n    public get zLayer(): number | null {\n        return this.data.zLayer;\n    }\n\n    public get imageBitmap(): boolean {\n        return this.data.imageBitmap;\n    }\n\n    public get imageIsDeleted(): boolean {\n        return this.data.imageIsDeleted;\n    }\n\n    public get image(): Image | null {\n        return this.data.image;\n    }\n\n    public get issueRegions(): Record<number, { hidden: boolean; points: number[] }> {\n        return { ...this.data.issueRegions };\n    }\n\n    public get objects(): any[] {\n        if (this.data.zLayer !== null) {\n            return this.data.objects.filter((object: any): boolean => object.zOrder <= this.data.zLayer);\n        }\n\n        return this.data.objects;\n    }\n\n    public get gridSize(): Size {\n        return { ...this.data.gridSize };\n    }\n\n    public get focusData(): FocusData {\n        return { ...this.data.focusData };\n    }\n\n    public get activeElement(): ActiveElement {\n        return { ...this.data.activeElement };\n    }\n\n    public get highlightedElements(): HighlightedElements {\n        return { ...this.data.highlightedElements };\n    }\n\n    public get drawData(): DrawData {\n        return { ...this.data.drawData };\n    }\n\n    public get editData(): MasksEditData {\n        return { ...this.data.editData };\n    }\n\n    public get interactionData(): InteractionData {\n        return { ...this.data.interactionData };\n    }\n\n    public get mergeData(): MergeData {\n        return { ...this.data.mergeData };\n    }\n\n    public get splitData(): SplitData {\n        return { ...this.data.splitData };\n    }\n\n    public get groupData(): GroupData {\n        return { ...this.data.groupData };\n    }\n\n    public get selected(): any {\n        return this.data.selected;\n    }\n\n    public set mode(value: Mode) {\n        this.data.mode = value;\n    }\n\n    public get mode(): Mode {\n        return this.data.mode;\n    }\n    public get exception(): Error {\n        return this.data.exception;\n    }\n}\n","// Copyright (C) 2019-2022 Intel Corporation\n// Copyright (C) 2022 CVAT.ai Corporation\n//\n// SPDX-License-Identifier: MIT\n\nimport {\n    CanvasModel,\n    Geometry,\n    Position,\n    FocusData,\n    ActiveElement,\n    DrawData,\n    MergeData,\n    SplitData,\n    GroupData,\n    Mode,\n    InteractionData,\n    Configuration,\n    MasksEditData,\n    HighlightedElements,\n} from './canvasModel';\n\nexport interface CanvasController {\n    readonly objects: any[];\n    readonly issueRegions: Record<number, { hidden: boolean; points: number[] }>;\n    readonly zLayer: number | null;\n    readonly focusData: FocusData;\n    readonly activeElement: ActiveElement;\n    readonly highlightedElements: HighlightedElements;\n    readonly drawData: DrawData;\n    readonly editData: MasksEditData;\n    readonly interactionData: InteractionData;\n    readonly mergeData: MergeData;\n    readonly splitData: SplitData;\n    readonly groupData: GroupData;\n    readonly selected: any;\n    readonly configuration: Configuration;\n    mode: Mode;\n    geometry: Geometry;\n\n    zoom(x: number, y: number, direction: number): void;\n    draw(drawData: DrawData): void;\n    edit(editData: MasksEditData): void;\n    interact(interactionData: InteractionData): void;\n    merge(mergeData: MergeData): void;\n    split(splitData: SplitData): void;\n    group(groupData: GroupData): void;\n    selectRegion(enabled: boolean): void;\n    enableDrag(x: number, y: number): void;\n    drag(x: number, y: number): void;\n    disableDrag(): void;\n    fit(): void;\n}\n\nexport class CanvasControllerImpl implements CanvasController {\n    private model: CanvasModel;\n    private lastDragPosition: Position;\n    private isDragging: boolean;\n\n    public constructor(model: CanvasModel) {\n        this.model = model;\n    }\n\n    public zoom(x: number, y: number, direction: number): void {\n        this.model.zoom(x, y, direction);\n    }\n\n    public fit(): void {\n        this.model.fit();\n    }\n\n    public enableDrag(x: number, y: number): void {\n        this.lastDragPosition = {\n            x,\n            y,\n        };\n        this.isDragging = true;\n    }\n\n    public drag(x: number, y: number): void {\n        if (this.isDragging) {\n            const topOffset: number = y - this.lastDragPosition.y;\n            const leftOffset: number = x - this.lastDragPosition.x;\n            this.lastDragPosition = {\n                x,\n                y,\n            };\n            this.model.move(topOffset, leftOffset);\n        }\n    }\n\n    public disableDrag(): void {\n        this.isDragging = false;\n    }\n\n    public draw(drawData: DrawData): void {\n        this.model.draw(drawData);\n    }\n\n    public edit(editData: MasksEditData): void {\n        this.model.edit(editData);\n    }\n\n    public interact(interactionData: InteractionData): void {\n        this.model.interact(interactionData);\n    }\n\n    public merge(mergeData: MergeData): void {\n        this.model.merge(mergeData);\n    }\n\n    public split(splitData: SplitData): void {\n        this.model.split(splitData);\n    }\n\n    public group(groupData: GroupData): void {\n        this.model.group(groupData);\n    }\n\n    public selectRegion(enable: boolean): void {\n        this.model.selectRegion(enable);\n    }\n\n    public get geometry(): Geometry {\n        return this.model.geometry;\n    }\n\n    public set geometry(geometry: Geometry) {\n        this.model.geometry = geometry;\n    }\n\n    public get zLayer(): number | null {\n        return this.model.zLayer;\n    }\n\n    public get issueRegions(): Record<number, { hidden: boolean; points: number[] }> {\n        return this.model.issueRegions;\n    }\n\n    public get objects(): any[] {\n        return this.model.objects;\n    }\n\n    public get focusData(): FocusData {\n        return this.model.focusData;\n    }\n\n    public get activeElement(): ActiveElement {\n        return this.model.activeElement;\n    }\n\n    public get highlightedElements(): HighlightedElements {\n        return this.model.highlightedElements;\n    }\n\n    public get drawData(): DrawData {\n        return this.model.drawData;\n    }\n\n    public get editData(): MasksEditData {\n        return this.model.editData;\n    }\n\n    public get interactionData(): InteractionData {\n        return this.model.interactionData;\n    }\n\n    public get mergeData(): MergeData {\n        return this.model.mergeData;\n    }\n\n    public get splitData(): SplitData {\n        return this.model.splitData;\n    }\n\n    public get groupData(): GroupData {\n        return this.model.groupData;\n    }\n\n    public get selected(): any {\n        return this.model.selected;\n    }\n\n    public get configuration(): Configuration {\n        return this.model.configuration;\n    }\n\n    public set mode(value: Mode) {\n        this.model.mode = value;\n    }\n\n    public get mode(): Mode {\n        return this.model.mode;\n    }\n}\n","// Copyright (C) 2021-2022 Intel Corporation\n//\n// SPDX-License-Identifier: MIT\n\nimport consts from './consts';\nimport { Point } from './shared';\n\nexport enum Orientation {\n    LEFT = 'left',\n    RIGHT = 'right',\n}\n\nexport function intersection(p1: Point, p2: Point, p3: Point, p4: Point): Point | null {\n    // Check if none of the lines are of length 0\n    const { x: x1, y: y1 } = p1;\n    const { x: x2, y: y2 } = p2;\n    const { x: x3, y: y3 } = p3;\n    const { x: x4, y: y4 } = p4;\n\n    if ((x1 === x2 && y1 === y2) || (x3 === x4 && y3 === y4)) {\n        return null;\n    }\n\n    const denominator = ((y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1));\n\n    // Lines are parallel\n    if (Math.abs(denominator) < Number.EPSILON) {\n        return null;\n    }\n\n    const ua = ((x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3)) / denominator;\n\n    // Return a object with the x and y coordinates of the intersection\n    return { x: x1 + ua * (x2 - x1), y: y1 + ua * (y2 - y1) };\n}\n\nexport class Equation {\n    private a: number;\n    private b: number;\n    private c: number;\n\n    public constructor(p1: Point, p2: Point) {\n        this.a = p1.y - p2.y;\n        this.b = p2.x - p1.x;\n        this.c = this.b * p1.y + this.a * p1.x;\n    }\n\n    // get the line equation in actual coordinates\n    public getY(x: number): number {\n        return (this.c - this.a * x) / this.b;\n    }\n}\n\nexport class Figure {\n    private indices: number[];\n    private allPoints: Point[];\n\n    public constructor(indices: number[], points: Point[]) {\n        this.indices = indices;\n        this.allPoints = points;\n    }\n\n    public get points(): Point[] {\n        const points = [];\n        for (const index of this.indices) {\n            points.push(this.allPoints[index]);\n        }\n        return points;\n    }\n\n    // sets the point for a given edge, points must be given in\n    // array form in the same ordering as the getter\n    // if you only need to update a subset of the points,\n    // simply put null for the points you want to keep\n    public set points(newPoints) {\n        const oldPoints = this.allPoints;\n        for (let i = 0; i < newPoints.length; i += 1) {\n            if (newPoints[i] !== null) {\n                oldPoints[this.indices[i]] = { x: newPoints[i].x, y: newPoints[i].y };\n            }\n        }\n    }\n}\n\nexport class Edge extends Figure {\n    public getEquation(): Equation {\n        return new Equation(this.points[0], this.points[1]);\n    }\n}\n\nexport class CuboidModel {\n    public points: Point[];\n    private fr: Edge;\n    private fl: Edge;\n    private dr: Edge;\n    private dl: Edge;\n    private ft: Edge;\n    private rt: Edge;\n    private lt: Edge;\n    private dt: Edge;\n    private fb: Edge;\n    private rb: Edge;\n    private lb: Edge;\n    private db: Edge;\n    public edgeList: Edge[];\n    private front: Figure;\n    private right: Figure;\n    private dorsal: Figure;\n    private left: Figure;\n    private top: Figure;\n    private bot: Figure;\n    public facesList: Figure[];\n    public vpl: Point | null;\n    public vpr: Point | null;\n    public orientation: Orientation;\n\n    public constructor(points?: Point[]) {\n        this.points = points;\n        this.initEdges();\n        this.initFaces();\n        this.updateVanishingPoints(false);\n        this.buildBackEdge(false);\n        this.updatePoints();\n        this.updateOrientation();\n    }\n\n    public getPoints(): Point[] {\n        return this.points;\n    }\n\n    public setPoints(points: (Point | null)[]): void {\n        points.forEach((point: Point | null, i: number): void => {\n            if (point !== null) {\n                this.points[i].x = point.x;\n                this.points[i].y = point.y;\n            }\n        });\n    }\n\n    public updateOrientation(): void {\n        if (this.dl.points[0].x > this.fl.points[0].x) {\n            this.orientation = Orientation.LEFT;\n        } else {\n            this.orientation = Orientation.RIGHT;\n        }\n    }\n\n    public updatePoints(): void {\n        // making sure that the edges are vertical\n        this.fr.points[0].x = this.fr.points[1].x;\n        this.fl.points[0].x = this.fl.points[1].x;\n        this.dr.points[0].x = this.dr.points[1].x;\n        this.dl.points[0].x = this.dl.points[1].x;\n    }\n\n    public computeSideEdgeConstraints(edge: any): any {\n        const midLength = this.fr.points[1].y - this.fr.points[0].y - 1;\n\n        const minY = edge.points[1].y - midLength;\n        const maxY = edge.points[0].y + midLength;\n\n        const y1 = edge.points[0].y;\n        const y2 = edge.points[1].y;\n\n        const miny1 = y2 - midLength;\n        const maxy1 = y2 - consts.MIN_EDGE_LENGTH;\n\n        const miny2 = y1 + consts.MIN_EDGE_LENGTH;\n        const maxy2 = y1 + midLength;\n\n        return {\n            constraint: {\n                minY,\n                maxY,\n            },\n            y1Range: {\n                max: maxy1,\n                min: miny1,\n            },\n            y2Range: {\n                max: maxy2,\n                min: miny2,\n            },\n        };\n    }\n\n    // boolean value parameter controls which edges should be used to recalculate vanishing points\n    private updateVanishingPoints(buildright: boolean): void {\n        let leftEdge = [];\n        let rightEdge = [];\n        let midEdge = [];\n        if (buildright) {\n            leftEdge = this.fr.points;\n            rightEdge = this.dl.points;\n            midEdge = this.fl.points;\n        } else {\n            leftEdge = this.fl.points;\n            rightEdge = this.dr.points;\n            midEdge = this.fr.points;\n        }\n\n        this.vpl = intersection(leftEdge[0], midEdge[0], leftEdge[1], midEdge[1]);\n        this.vpr = intersection(rightEdge[0], midEdge[0], rightEdge[1], midEdge[1]);\n        if (this.vpl === null) {\n            // shift the edge slightly to avoid edge case\n            leftEdge[0].y -= 0.001;\n            leftEdge[0].x += 0.001;\n            leftEdge[1].x += 0.001;\n            this.vpl = intersection(leftEdge[0], midEdge[0], leftEdge[1], midEdge[1]);\n        }\n        if (this.vpr === null) {\n            // shift the edge slightly to avoid edge case\n            rightEdge[0].y -= 0.001;\n            rightEdge[0].x -= 0.001;\n            rightEdge[1].x -= 0.001;\n            this.vpr = intersection(leftEdge[0], midEdge[0], leftEdge[1], midEdge[1]);\n        }\n    }\n\n    private initEdges(): void {\n        this.fl = new Edge([0, 1], this.points);\n        this.fr = new Edge([2, 3], this.points);\n        this.dr = new Edge([4, 5], this.points);\n        this.dl = new Edge([6, 7], this.points);\n\n        this.ft = new Edge([0, 2], this.points);\n        this.lt = new Edge([0, 6], this.points);\n        this.rt = new Edge([2, 4], this.points);\n        this.dt = new Edge([6, 4], this.points);\n\n        this.fb = new Edge([1, 3], this.points);\n        this.lb = new Edge([1, 7], this.points);\n        this.rb = new Edge([3, 5], this.points);\n        this.db = new Edge([7, 5], this.points);\n\n        this.edgeList = [\n            this.fl,\n            this.fr,\n            this.dl,\n            this.dr,\n            this.ft,\n            this.lt,\n            this.rt,\n            this.dt,\n            this.fb,\n            this.lb,\n            this.rb,\n            this.db,\n        ];\n    }\n\n    private initFaces(): void {\n        this.front = new Figure([0, 1, 3, 2], this.points);\n        this.right = new Figure([2, 3, 5, 4], this.points);\n        this.dorsal = new Figure([4, 5, 7, 6], this.points);\n        this.left = new Figure([6, 7, 1, 0], this.points);\n        this.top = new Figure([0, 2, 4, 6], this.points);\n        this.bot = new Figure([1, 3, 5, 7], this.points);\n\n        this.facesList = [this.front, this.right, this.dorsal, this.left];\n    }\n\n    private buildBackEdge(buildright: boolean): void {\n        this.updateVanishingPoints(buildright);\n        let leftPoints = [];\n        let rightPoints = [];\n\n        let topIndex = 0;\n        let botIndex = 0;\n\n        if (buildright) {\n            leftPoints = this.dl.points;\n            rightPoints = this.fr.points;\n            topIndex = 4;\n            botIndex = 5;\n        } else {\n            leftPoints = this.dr.points;\n            rightPoints = this.fl.points;\n            topIndex = 6;\n            botIndex = 7;\n        }\n\n        const vpLeft = this.vpl;\n        const vpRight = this.vpr;\n\n        let p1 = intersection(vpLeft, leftPoints[0], vpRight, rightPoints[0]);\n        let p2 = intersection(vpLeft, leftPoints[1], vpRight, rightPoints[1]);\n\n        if (p1 === null) {\n            p1 = { x: p2.x, y: vpLeft.y };\n        } else if (p2 === null) {\n            p2 = { x: p1.x, y: vpLeft.y };\n        }\n\n        this.points[topIndex] = { x: p1.x, y: p1.y };\n        this.points[botIndex] = { x: p2.x, y: p2.y };\n\n        // Making sure that the vertical edges stay vertical\n        this.updatePoints();\n    }\n}\n\nfunction sortPointsClockwise(points: any[]): any[] {\n    points.sort((a, b): number => a.y - b.y);\n    // Get center y\n    const cy = (points[0].y + points[points.length - 1].y) / 2;\n\n    // Sort from right to left\n    points.sort((a, b): number => b.x - a.x);\n\n    // Get center x\n    const cx = (points[0].x + points[points.length - 1].x) / 2;\n\n    // Center point\n    const center = {\n        x: cx,\n        y: cy,\n    };\n\n    // Starting angle used to reference other angles\n    let startAng: number | undefined;\n    points.forEach((point): void => {\n        let ang = Math.atan2(point.y - center.y, point.x - center.x);\n        if (!startAng) {\n            startAng = ang;\n            // ensure that all points are clockwise of the start point\n        } else if (ang < startAng) {\n            ang += Math.PI * 2;\n        }\n        // eslint-disable-next-line no-param-reassign\n        point.angle = ang; // add the angle to the point\n    });\n\n    // first sort clockwise\n    points.sort((a, b): number => a.angle - b.angle);\n    return points.reverse();\n}\n\nfunction setupCuboidPoints(points: Point[]): any[] {\n    let left;\n    let right;\n    let left2;\n    let right2;\n    let p1;\n    let p2;\n    let p3;\n    let p4;\n\n    const height = Math.abs(points[0].x - points[1].x) < Math.abs(points[1].x - points[2].x) ?\n        Math.abs(points[1].y - points[0].y) : Math.abs(points[1].y - points[2].y);\n\n    // separate into left and right point\n    // we pick the first and third point because we know assume they will be on\n    // opposite corners\n    if (points[0].x < points[2].x) {\n        [left, , right] = points;\n    } else {\n        [right, , left] = points;\n    }\n\n    // get other 2 points using the given height\n    if (left.y < right.y) {\n        left2 = { x: left.x, y: left.y + height };\n        right2 = { x: right.x, y: right.y - height };\n    } else {\n        left2 = { x: left.x, y: left.y - height };\n        right2 = { x: right.x, y: right.y + height };\n    }\n\n    // get the vector for the last point relative to the previous point\n    const vec = {\n        x: points[3].x - points[2].x,\n        y: points[3].y - points[2].y,\n    };\n\n    if (left.y < left2.y) {\n        p1 = left;\n        p2 = left2;\n    } else {\n        p1 = left2;\n        p2 = left;\n    }\n\n    if (right.y < right2.y) {\n        p3 = right;\n        p4 = right2;\n    } else {\n        p3 = right2;\n        p4 = right;\n    }\n\n    const p5 = { x: p3.x + vec.x, y: p3.y + vec.y + 0.1 };\n    const p6 = { x: p4.x + vec.x, y: p4.y + vec.y - 0.1 };\n    const p7 = { x: p1.x + vec.x, y: p1.y + vec.y + 0.1 };\n    const p8 = { x: p2.x + vec.x, y: p2.y + vec.y - 0.1 };\n\n    p1.y += 0.1;\n    return [p1, p2, p3, p4, p5, p6, p7, p8];\n}\n\nexport function cuboidFrom4Points(flattenedPoints: any[]): any[] {\n    const points: Point[] = [];\n    for (let i = 0; i < 4; i++) {\n        const [x, y] = flattenedPoints.slice(i * 2, i * 2 + 2);\n        points.push({ x, y });\n    }\n    const unsortedPlanePoints = points.slice(0, 3);\n    function rotate(array: any[], times: number): void {\n        let t = times;\n        while (t--) {\n            const temp = array.shift();\n            array.push(temp);\n        }\n    }\n\n    const plane2 = {\n        p1: points[0],\n        p2: points[0],\n        p3: points[0],\n        p4: points[0],\n    };\n\n    // completing the plane\n    const vector = {\n        x: points[2].x - points[1].x,\n        y: points[2].y - points[1].y,\n    };\n\n    // sorting the first plane\n    unsortedPlanePoints.push({\n        x: points[0].x + vector.x,\n        y: points[0].y + vector.y,\n    });\n    const sortedPlanePoints = sortPointsClockwise(unsortedPlanePoints);\n    let leftIndex = 0;\n    for (let i = 0; i < 4; i++) {\n        leftIndex = sortedPlanePoints[i].x < sortedPlanePoints[leftIndex].x ? i : leftIndex;\n    }\n    rotate(sortedPlanePoints, leftIndex);\n    const plane1 = {\n        p1: sortedPlanePoints[0],\n        p2: sortedPlanePoints[1],\n        p3: sortedPlanePoints[2],\n        p4: sortedPlanePoints[3],\n    };\n\n    const vec = {\n        x: points[3].x - points[2].x,\n        y: points[3].y - points[2].y,\n    };\n    // determine the orientation\n    const angle = Math.atan2(vec.y, vec.x);\n\n    // making the other plane\n    plane2.p1 = { x: plane1.p1.x + vec.x, y: plane1.p1.y + vec.y };\n    plane2.p2 = { x: plane1.p2.x + vec.x, y: plane1.p2.y + vec.y };\n    plane2.p3 = { x: plane1.p3.x + vec.x, y: plane1.p3.y + vec.y };\n    plane2.p4 = { x: plane1.p4.x + vec.x, y: plane1.p4.y + vec.y };\n\n    let cuboidPoints;\n    // right\n    if (Math.abs(angle) < Math.PI / 2 - 0.1) {\n        cuboidPoints = setupCuboidPoints(points);\n        // left\n    } else if (Math.abs(angle) > Math.PI / 2 + 0.1) {\n        cuboidPoints = setupCuboidPoints(points);\n        // down\n    } else if (angle > 0) {\n        cuboidPoints = [plane1.p1, plane2.p1, plane1.p2, plane2.p2, plane1.p3, plane2.p3, plane1.p4, plane2.p4];\n        cuboidPoints[0].y += 0.1;\n        cuboidPoints[4].y += 0.1;\n        // up\n    } else {\n        cuboidPoints = [plane2.p1, plane1.p1, plane2.p2, plane1.p2, plane2.p3, plane1.p3, plane2.p4, plane1.p4];\n        cuboidPoints[0].y += 0.1;\n        cuboidPoints[4].y += 0.1;\n    }\n\n    return cuboidPoints.reduce((arr: number[], point: any): number[] => {\n        arr.push(point.x);\n        arr.push(point.y);\n        return arr;\n    }, []);\n}\n","// Copyright (C) 2019-2022 Intel Corporation\n//\n// SPDX-License-Identifier: MIT\n\nimport * as SVG from 'svg.js';\nimport consts from './consts';\n\nexport interface ShapeSizeElement {\n    sizeElement: any;\n    update(shape: SVG.Shape): void;\n    rm(): void;\n}\n\nexport interface Box {\n    xtl: number;\n    ytl: number;\n    xbr: number;\n    ybr: number;\n}\n\nexport interface BBox {\n    width: number;\n    height: number;\n    x: number;\n    y: number;\n}\n\nexport interface Point {\n    x: number;\n    y: number;\n}\n\ninterface Vector2D {\n    i: number;\n    j: number;\n}\n\nexport interface DrawnState {\n    clientID: number;\n    outside?: boolean;\n    occluded?: boolean;\n    hidden?: boolean;\n    lock: boolean;\n    source: 'AUTO' | 'SEMI-AUTO' | 'MANUAL' | 'FILE';\n    shapeType: string;\n    points?: number[];\n    rotation: number;\n    attributes: Record<number, string>;\n    descriptions: string[];\n    zOrder?: number;\n    pinned?: boolean;\n    updated: number;\n    frame: number;\n    label: any;\n    group: any;\n    color: string;\n    elements: DrawnState[] | null;\n}\n\n// Translate point array from the canvas coordinate system\n// to the coordinate system of a client\nexport function translateFromSVG(svg: SVGSVGElement, points: number[]): number[] {\n    const output = [];\n    const transformationMatrix = svg.getScreenCTM() as DOMMatrix;\n    let pt = svg.createSVGPoint();\n    for (let i = 0; i < points.length - 1; i += 2) {\n        pt.x = points[i];\n        pt.y = points[i + 1];\n        pt = pt.matrixTransform(transformationMatrix);\n        output.push(pt.x, pt.y);\n    }\n\n    return output;\n}\n\n// Translate point array from the coordinate system of a client\n// to the canvas coordinate system\nexport function translateToSVG(svg: SVGSVGElement, points: number[]): number[] {\n    const output = [];\n    const transformationMatrix = (svg.getScreenCTM() as DOMMatrix).inverse();\n    let pt = svg.createSVGPoint();\n    for (let i = 0; i < points.length; i += 2) {\n        pt.x = points[i];\n        pt.y = points[i + 1];\n        pt = pt.matrixTransform(transformationMatrix);\n        output.push(pt.x, pt.y);\n    }\n\n    return output;\n}\n\nexport function displayShapeSize(shapesContainer: SVG.Container, textContainer: SVG.Container): ShapeSizeElement {\n    const shapeSize: ShapeSizeElement = {\n        sizeElement: textContainer\n            .text('')\n            .font({\n                weight: 'bolder',\n            })\n            .fill('white')\n            .addClass('cvat_canvas_text'),\n        update(shape: SVG.Shape): void {\n            let text = `${Math.round(shape.width())}x${Math.round(shape.height())}px`;\n            if (shape.type === 'rect' || shape.type === 'ellipse') {\n                let rotation = shape.transform().rotation || 0;\n                // be sure, that rotation in range [0; 360]\n                while (rotation < 0) rotation += 360;\n                rotation %= 360;\n                if (rotation) {\n                    text = `${text} ${rotation.toFixed(1)}\\u00B0`;\n                }\n            }\n            const [x, y, cx, cy]: number[] = translateToSVG(\n                (textContainer.node as any) as SVGSVGElement,\n                translateFromSVG((shapesContainer.node as any) as SVGSVGElement, [\n                    shape.x(),\n                    shape.y(),\n                    shape.cx(),\n                    shape.cy(),\n                ]),\n            ).map((coord: number): number => Math.round(coord));\n            this.sizeElement\n                .clear()\n                .plain(text)\n                .move(x + consts.TEXT_MARGIN, y + consts.TEXT_MARGIN)\n                .rotate(shape.transform().rotation, cx, cy);\n        },\n        rm(): void {\n            if (this.sizeElement) {\n                this.sizeElement.remove();\n                this.sizeElement = null;\n            }\n        },\n    };\n\n    return shapeSize;\n}\n\nexport function rotate2DPoints(cx: number, cy: number, angle: number, points: number[]): number[] {\n    const rad = (Math.PI / 180) * angle;\n    const cos = Math.cos(rad);\n    const sin = Math.sin(rad);\n    const result = [];\n    for (let i = 0; i < points.length; i += 2) {\n        const x = points[i];\n        const y = points[i + 1];\n        result.push(\n            (x - cx) * cos - (y - cy) * sin + cx,\n            (y - cy) * cos + (x - cx) * sin + cy,\n        );\n    }\n\n    return result;\n}\n\nexport function pointsToNumberArray(points: string | Point[]): number[] {\n    if (Array.isArray(points)) {\n        return points.reduce((acc: number[], point: Point): number[] => {\n            acc.push(point.x, point.y);\n            return acc;\n        }, []);\n    }\n\n    return points\n        .trim()\n        .split(/[,\\s]+/g)\n        .map((coord: string): number => +coord);\n}\n\nexport function parsePoints(source: string | number[]): Point[] {\n    if (Array.isArray(source)) {\n        return source.reduce((acc: Point[], _: number, index: number): Point[] => {\n            if (index % 2) {\n                acc.push({\n                    x: source[index - 1],\n                    y: source[index],\n                });\n            }\n\n            return acc;\n        }, []);\n    }\n\n    return source\n        .trim()\n        .split(/\\s/)\n        .map(\n            (point: string): Point => {\n                const [x, y] = point.split(',').map((coord: string): number => +coord);\n                return { x, y };\n            },\n        );\n}\n\nexport function readPointsFromShape(shape: SVG.Shape): number[] {\n    let points = null;\n    if (shape.type === 'ellipse') {\n        const [rx, ry] = [+shape.attr('rx'), +shape.attr('ry')];\n        const [cx, cy] = [shape.cx(), shape.cy()];\n        points = `${cx},${cy} ${cx + rx},${cy - ry}`;\n    } else if (shape.type === 'rect') {\n        points = `${shape.attr('x')},${shape.attr('y')} ` +\n            `${shape.attr('x') + shape.attr('width')},${shape.attr('y') + shape.attr('height')}`;\n    } else if (shape.type === 'circle') {\n        points = `${shape.cx()},${shape.cy()}`;\n    } else {\n        points = shape.attr('points');\n    }\n\n    return pointsToNumberArray(points);\n}\n\nexport function stringifyPoints(points: (Point | number)[]): string {\n    if (typeof points[0] === 'number') {\n        return points.reduce((acc: string, val: number, idx: number): string => {\n            if (idx % 2) {\n                return `${acc},${val}`;\n            }\n\n            return `${acc} ${val}`.trim();\n        }, '');\n    }\n    return points.map((point: Point): string => `${point.x},${point.y}`).join(' ');\n}\n\nexport function clamp(x: number, min: number, max: number): number {\n    return Math.min(Math.max(x, min), max);\n}\n\nexport function scalarProduct(a: Vector2D, b: Vector2D): number {\n    return a.i * b.i + a.j * b.j;\n}\n\nexport function vectorLength(vector: Vector2D): number {\n    const sqrI = vector.i ** 2;\n    const sqrJ = vector.j ** 2;\n    return Math.sqrt(sqrI + sqrJ);\n}\n\nexport function translateToCanvas(offset: number, points: number[]): number[] {\n    return points.map((coord: number): number => coord + offset);\n}\n\nexport function translateFromCanvas(offset: number, points: number[]): number[] {\n    return points.map((coord: number): number => coord - offset);\n}\n\nexport function computeWrappingBox(points: number[], margin = 0): Box & BBox {\n    let xtl = Number.MAX_SAFE_INTEGER;\n    let ytl = Number.MAX_SAFE_INTEGER;\n    let xbr = Number.MIN_SAFE_INTEGER;\n    let ybr = Number.MIN_SAFE_INTEGER;\n\n    for (let i = 0; i < points.length; i += 2) {\n        const [x, y] = [points[i], points[i + 1]];\n        xtl = Math.min(xtl, x);\n        ytl = Math.min(ytl, y);\n        xbr = Math.max(xbr, x);\n        ybr = Math.max(ybr, y);\n    }\n\n    const box = {\n        xtl: xtl - margin,\n        ytl: ytl - margin,\n        xbr: xbr + margin,\n        ybr: ybr + margin,\n    };\n\n    return {\n        ...box,\n        x: box.xtl,\n        y: box.ytl,\n        width: box.xbr - box.xtl,\n        height: box.ybr - box.ytl,\n    };\n}\n\nexport function getSkeletonEdgeCoordinates(edge: SVG.Line): {\n    x1: number, y1: number, x2: number, y2: number\n} {\n    let x1 = 0;\n    let y1 = 0;\n    let x2 = 0;\n    let y2 = 0;\n\n    const parent = edge.parent() as any as SVG.G;\n    if (parent.type !== 'g') {\n        throw new Error('Edge parent must be a group');\n    }\n\n    const dataNodeFrom = edge.attr('data-node-from');\n    const dataNodeTo = edge.attr('data-node-to');\n    const nodeFrom = parent.children()\n        .find((element: SVG.Element): boolean => element.attr('data-node-id') === dataNodeFrom);\n    const nodeTo = parent.children()\n        .find((element: SVG.Element): boolean => element.attr('data-node-id') === dataNodeTo);\n\n    if (!nodeFrom || !nodeTo) {\n        throw new Error(`Edge's nodeFrom ${dataNodeFrom} or nodeTo ${dataNodeTo} do not to refer to any node`);\n    }\n\n    x1 = nodeFrom.cx();\n    y1 = nodeFrom.cy();\n    x2 = nodeTo.cx();\n    y2 = nodeTo.cy();\n\n    if (nodeFrom.hasClass('cvat_canvas_hidden') || nodeTo.hasClass('cvat_canvas_hidden')) {\n        edge.addClass('cvat_canvas_hidden');\n    } else {\n        edge.removeClass('cvat_canvas_hidden');\n    }\n\n    if (nodeFrom.hasClass('cvat_canvas_shape_occluded') || nodeTo.hasClass('cvat_canvas_shape_occluded')) {\n        edge.addClass('cvat_canvas_shape_occluded');\n    }\n\n    if ([x1, y1, x2, y2].some((coord: number): boolean => typeof coord !== 'number')) {\n        throw new Error(`Edge coordinates must be numbers, got [${x1}, ${y1}, ${x2}, ${y2}]`);\n    }\n\n    return {\n        x1, y1, x2, y2,\n    };\n}\n\nexport function makeSVGFromTemplate(template: string): SVG.G {\n    const SVGElement = new SVG.G();\n    /* eslint-disable-next-line no-unsanitized/property */\n    SVGElement.node.innerHTML = template;\n    return SVGElement;\n}\n\nexport function setupSkeletonEdges(skeleton: SVG.G, referenceSVG: SVG.G): void {\n    for (const child of referenceSVG.children()) {\n        // search for all edges on template\n        const dataType = child.attr('data-type');\n        if (child.type === 'line' && dataType === 'edge') {\n            const dataNodeFrom = child.attr('data-node-from');\n            const dataNodeTo = child.attr('data-node-to');\n            if (!Number.isInteger(dataNodeFrom) || !Number.isInteger(dataNodeTo)) {\n                throw new Error(`Edge nodeFrom and nodeTo must be numbers, got ${dataNodeFrom}, ${dataNodeTo}`);\n            }\n\n            // try to find the same edge on the skeleton\n            let edge = skeleton.children().find((_child: SVG.Element) => (\n                _child.attr('data-node-from') === dataNodeFrom && _child.attr('data-node-to') === dataNodeTo\n            )) as SVG.Line;\n\n            // if not found, lets create it\n            if (!edge) {\n                edge = skeleton.line(0, 0, 0, 0).attr({\n                    'data-node-from': dataNodeFrom,\n                    'data-node-to': dataNodeTo,\n                    'stroke-width': 'inherit',\n                }).addClass('cvat_canvas_skeleton_edge') as SVG.Line;\n            }\n\n            skeleton.node.prepend(edge.node);\n            const points = getSkeletonEdgeCoordinates(edge);\n            edge.attr({ ...points, 'stroke-width': 'inherit' });\n        }\n    }\n}\n\nexport function imageDataToDataURL(\n    imageBitmap: Uint8ClampedArray,\n    width: number,\n    height: number,\n    handleResult: (dataURL: string) => Promise<void>,\n): void {\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n\n    canvas.getContext('2d').putImageData(\n        new ImageData(imageBitmap, width, height), 0, 0,\n    );\n\n    canvas.toBlob((blob) => {\n        const dataURL = URL.createObjectURL(blob);\n        handleResult(dataURL).finally(() => {\n            URL.revokeObjectURL(dataURL);\n        });\n    }, 'image/png');\n}\n\nexport function alphaChannelOnly(imageData: Uint8ClampedArray): number[] {\n    const alpha = new Array(imageData.length / 4);\n    for (let i = 3; i < imageData.length; i += 4) {\n        alpha[Math.floor(i / 4)] = imageData[i] > 0 ? 1 : 0;\n    }\n    return alpha;\n}\n\nexport function expandChannels(r: number, g: number, b: number, alpha: number[], endOffset = 0): Uint8ClampedArray {\n    const imageBitmap = new Uint8ClampedArray((alpha.length - endOffset) * 4);\n    for (let i = 0; i < alpha.length - endOffset; i++) {\n        const val = alpha[i] ? 1 : 0;\n        imageBitmap[i * 4] = r;\n        imageBitmap[i * 4 + 1] = g;\n        imageBitmap[i * 4 + 2] = b;\n        imageBitmap[i * 4 + 3] = val * 255;\n    }\n    return imageBitmap;\n}\n\nexport type PropType<T, Prop extends keyof T> = T[Prop];\n","// Copyright (C) 2019-2022 Intel Corporation\n//\n// SPDX-License-Identifier: MIT\n\n/* eslint-disable */\nimport * as SVG from 'svg.js';\nimport 'svg.draggable.js';\nimport 'svg.resize.js';\nimport 'svg.select.js';\nimport 'svg.draw.js';\n\nimport consts from './consts';\nimport { Equation, CuboidModel, Orientation, Edge } from './cuboid';\nimport { Point, parsePoints, clamp } from './shared';\n\n// Update constructor\nconst originalDraw = SVG.Element.prototype.draw;\nSVG.Element.prototype.draw = function constructor(...args: any): any {\n    let handler = this.remember('_paintHandler');\n    if (!handler) {\n        originalDraw.call(this, ...args);\n        handler = this.remember('_paintHandler');\n        // There is use case (drawing a single point when handler is created and destructed immediately in one stack)\n        // So, we need to check if handler still exists\n        if (handler && !handler.set) {\n            handler.set = new SVG.Set();\n        }\n    } else {\n        originalDraw.call(this, ...args);\n    }\n\n    return this;\n};\nfor (const key of Object.keys(originalDraw)) {\n    SVG.Element.prototype.draw[key] = originalDraw[key];\n}\n\n// Create undo for polygones and polylines\nfunction undo(): void {\n    if (this.set && this.set.length()) {\n        this.set.members.splice(-1, 1)[0].remove();\n        this.el.array().value.splice(-2, 1);\n        this.el.plot(this.el.array());\n        this.el.fire('undopoint');\n    }\n}\n\nSVG.Element.prototype.draw.extend(\n    'polyline',\n    Object.assign({}, SVG.Element.prototype.draw.plugins.polyline, {\n        undo: undo,\n    }),\n);\n\nSVG.Element.prototype.draw.extend(\n    'polygon',\n    Object.assign({}, SVG.Element.prototype.draw.plugins.polygon, {\n        undo: undo,\n    }),\n);\n\n// Create transform for rect, polyline and polygon\nfunction transform(): void {\n    this.m = this.el.node.getScreenCTM().inverse();\n    this.offset = { x: window.pageXOffset, y: window.pageYOffset };\n}\n\nSVG.Element.prototype.draw.extend(\n    'rect',\n    Object.assign({}, SVG.Element.prototype.draw.plugins.rect, {\n        transform: transform,\n    }),\n);\n\nSVG.Element.prototype.draw.extend(\n    'polyline',\n    Object.assign({}, SVG.Element.prototype.draw.plugins.polyline, {\n        transform: transform,\n    }),\n);\n\nSVG.Element.prototype.draw.extend(\n    'polygon',\n    Object.assign({}, SVG.Element.prototype.draw.plugins.polygon, {\n        transform: transform,\n    }),\n);\n\n// Fix method drawCircles\nfunction drawCircles(): void {\n    const array = this.el.array().valueOf();\n\n    this.set.each(function (): void {\n        this.remove();\n    });\n\n    this.set.clear();\n\n    for (let i = 0; i < array.length - 1; ++i) {\n        [this.p.x] = array[i];\n        [, this.p.y] = array[i];\n\n        const p = this.p.matrixTransform(\n            this.parent.node.getScreenCTM().inverse().multiply(this.el.node.getScreenCTM()),\n        );\n\n        this.set.add(\n            this.parent\n                .circle(5)\n                .stroke({\n                    width: 1,\n                })\n                .fill('#ccc')\n                .center(p.x, p.y),\n        );\n    }\n}\n\nSVG.Element.prototype.draw.extend(\n    'line',\n    Object.assign({}, SVG.Element.prototype.draw.plugins.line, {\n        drawCircles: drawCircles,\n    }),\n);\n\nSVG.Element.prototype.draw.extend(\n    'polyline',\n    Object.assign({}, SVG.Element.prototype.draw.plugins.polyline, {\n        drawCircles: drawCircles,\n    }),\n);\n\nSVG.Element.prototype.draw.extend(\n    'polygon',\n    Object.assign({}, SVG.Element.prototype.draw.plugins.polygon, {\n        drawCircles: drawCircles,\n    }),\n);\n\n// Fix method drag\nconst originalDraggable = SVG.Element.prototype.draggable;\nSVG.Element.prototype.draggable = function constructor(...args: any): any {\n    let handler = this.remember('_draggable');\n    if (!handler) {\n        originalDraggable.call(this, ...args);\n        handler = this.remember('_draggable');\n        handler.drag = function (e: any) {\n            this.m = this.el.node.getScreenCTM().inverse();\n            return handler.constructor.prototype.drag.call(this, e);\n        };\n    } else {\n        originalDraggable.call(this, ...args);\n    }\n\n    return this;\n};\nfor (const key of Object.keys(originalDraggable)) {\n    SVG.Element.prototype.draggable[key] = originalDraggable[key];\n}\n\n// Fix method resize\nconst originalResize = SVG.Element.prototype.resize;\nSVG.Element.prototype.resize = function constructor(...args: any): any {\n    let handler = this.remember('_resizeHandler');\n    if (!handler) {\n        originalResize.call(this, ...args);\n        handler = this.remember('_resizeHandler');\n        handler.resize = function (e: any) {\n            const { event } = e.detail;\n            this.rotationPointPressed = e.type === 'rot';\n            if (\n                event.button === 0 &&\n                // ignore shift key for cuboids (change perspective) and rectangles (precise rotation)\n                (!event.shiftKey || (\n                    this.el.parent().hasClass('cvat_canvas_shape_cuboid')\n                    || this.el.type  === 'rect')\n                ) && !event.altKey\n            ) {\n                return handler.constructor.prototype.resize.call(this, e);\n            }\n        };\n        handler.update = function (e: any) {\n            if (!this.rotationPointPressed) {\n                this.m = this.el.node.getScreenCTM().inverse();\n            }\n            handler.constructor.prototype.update.call(this, e);\n        };\n    } else {\n        originalResize.call(this, ...args);\n    }\n\n    return this;\n};\nfor (const key of Object.keys(originalResize)) {\n    SVG.Element.prototype.resize[key] = originalResize[key];\n}\n\nenum EdgeIndex {\n    FL = 1,\n    FR = 2,\n    DR = 3,\n    DL = 4,\n}\n\nfunction getEdgeIndex(cuboidPoint: number): EdgeIndex {\n    switch (cuboidPoint) {\n        case 0:\n        case 1:\n            return EdgeIndex.FL;\n        case 2:\n        case 3:\n            return EdgeIndex.FR;\n        case 4:\n        case 5:\n            return EdgeIndex.DR;\n        default:\n            return EdgeIndex.DL;\n    }\n}\n\nfunction getTopDown(edgeIndex: EdgeIndex): number[] {\n    switch (edgeIndex) {\n        case EdgeIndex.FL:\n            return [0, 1];\n        case EdgeIndex.FR:\n            return [2, 3];\n        case EdgeIndex.DR:\n            return [4, 5];\n        default:\n            return [6, 7];\n    }\n}\n\n(SVG as any).Cube = SVG.invent({\n    create: 'g',\n    inherit: SVG.G,\n    extend: {\n        constructorMethod(points: string) {\n            this.cuboidModel = new CuboidModel(parsePoints(points));\n            this.setupFaces();\n            this.setupEdges();\n            this.setupProjections();\n            this.hideProjections();\n\n            this._attr('points', points);\n            this.addClass('cvat_canvas_shape_cuboid');\n            return this;\n        },\n\n        setupFaces() {\n            this.bot = this.polygon(this.cuboidModel.bot.points);\n            this.top = this.polygon(this.cuboidModel.top.points);\n            this.right = this.polygon(this.cuboidModel.right.points);\n            this.left = this.polygon(this.cuboidModel.left.points);\n            this.dorsal = this.polygon(this.cuboidModel.dorsal.points);\n            this.face = this.polygon(this.cuboidModel.front.points);\n        },\n\n        setupProjections() {\n            this.ftProj = this.line(\n                this.updateProjectionLine(\n                    this.cuboidModel.ft.getEquation(),\n                    this.cuboidModel.ft.points[0],\n                    this.cuboidModel.vpl,\n                ),\n            );\n            this.fbProj = this.line(\n                this.updateProjectionLine(\n                    this.cuboidModel.fb.getEquation(),\n                    this.cuboidModel.ft.points[0],\n                    this.cuboidModel.vpl,\n                ),\n            );\n            this.rtProj = this.line(\n                this.updateProjectionLine(\n                    this.cuboidModel.rt.getEquation(),\n                    this.cuboidModel.rt.points[1],\n                    this.cuboidModel.vpr,\n                ),\n            );\n            this.rbProj = this.line(\n                this.updateProjectionLine(\n                    this.cuboidModel.rb.getEquation(),\n                    this.cuboidModel.rb.points[1],\n                    this.cuboidModel.vpr,\n                ),\n            );\n\n            this.ftProj.stroke({ color: '#C0C0C0' }).addClass('cvat_canvas_cuboid_projections');\n            this.fbProj.stroke({ color: '#C0C0C0' }).addClass('cvat_canvas_cuboid_projections');\n            this.rtProj.stroke({ color: '#C0C0C0' }).addClass('cvat_canvas_cuboid_projections');\n            this.rbProj.stroke({ color: '#C0C0C0' }).addClass('cvat_canvas_cuboid_projections');\n        },\n\n        setupEdges() {\n            this.frontLeftEdge = this.line(this.cuboidModel.fl.points);\n            this.frontRightEdge = this.line(this.cuboidModel.fr.points);\n            this.dorsalRightEdge = this.line(this.cuboidModel.dr.points);\n            this.dorsalLeftEdge = this.line(this.cuboidModel.dl.points);\n\n            this.frontTopEdge = this.line(this.cuboidModel.ft.points);\n            this.rightTopEdge = this.line(this.cuboidModel.rt.points);\n            this.frontBotEdge = this.line(this.cuboidModel.fb.points);\n            this.rightBotEdge = this.line(this.cuboidModel.rb.points);\n        },\n\n        setupGrabPoints(circleType: Function | string) {\n            const viewModel = this.cuboidModel;\n            const circle = typeof circleType === 'function' ? circleType : this.circle;\n\n            this.flCenter = circle(0, 0).addClass('svg_select_points').addClass('svg_select_points_l');\n            this.frCenter = circle(0, 0).addClass('svg_select_points').addClass('svg_select_points_r');\n            this.ftCenter = circle(0, 0).addClass('svg_select_points').addClass('svg_select_points_t');\n            this.fbCenter = circle(0, 0).addClass('svg_select_points').addClass('svg_select_points_b');\n\n            this.drCenter = circle(0, 0).addClass('svg_select_points').addClass('svg_select_points_ew');\n            this.dlCenter = circle(0, 0).addClass('svg_select_points').addClass('svg_select_points_ew');\n\n            const grabPoints = this.getGrabPoints();\n            const edges = this.getEdges();\n            for (let i = 0; i < grabPoints.length; i += 1) {\n                const edge = edges[i];\n                const cx = (edge.attr('x2') + edge.attr('x1')) / 2;\n                const cy = (edge.attr('y2') + edge.attr('y1')) / 2;\n                grabPoints[i].center(cx, cy);\n            }\n\n            if (viewModel.orientation === Orientation.LEFT) {\n                this.dlCenter.hide();\n            } else {\n                this.drCenter.hide();\n            }\n        },\n\n        showProjections() {\n            if (this.projectionLineEnable) {\n                this.ftProj.show();\n                this.fbProj.show();\n                this.rtProj.show();\n                this.rbProj.show();\n            }\n        },\n\n        hideProjections() {\n            this.ftProj.hide();\n            this.fbProj.hide();\n            this.rtProj.hide();\n            this.rbProj.hide();\n        },\n\n        getEdges() {\n            const arr = [];\n            arr.push(this.frontLeftEdge);\n            arr.push(this.frontRightEdge);\n            arr.push(this.dorsalRightEdge);\n            arr.push(this.frontTopEdge);\n            arr.push(this.frontBotEdge);\n            arr.push(this.dorsalLeftEdge);\n            arr.push(this.rightTopEdge);\n            arr.push(this.rightBotEdge);\n            return arr;\n        },\n\n        getGrabPoints() {\n            const arr = [];\n            arr.push(this.flCenter);\n            arr.push(this.frCenter);\n            arr.push(this.drCenter);\n            arr.push(this.ftCenter);\n            arr.push(this.fbCenter);\n            arr.push(this.dlCenter);\n            return arr;\n        },\n\n        updateProjectionLine(equation: Equation, source: Point, direction: Point) {\n            const x1 = source.x;\n            const y1 = equation.getY(x1);\n\n            const x2 = direction.x;\n            const y2 = equation.getY(x2);\n            return [\n                [x1, y1],\n                [x2, y2],\n            ];\n        },\n\n        selectize(value: boolean, options: object) {\n            this.face.selectize(value, options);\n\n            if (this.cuboidModel.orientation === Orientation.LEFT) {\n                this.dorsalLeftEdge.selectize(false, options);\n                this.dorsalRightEdge.selectize(value, options);\n            } else {\n                this.dorsalRightEdge.selectize(false, options);\n                this.dorsalLeftEdge.selectize(value, options);\n            }\n\n            if (value === false) {\n                this.getGrabPoints().forEach((point: SVG.Element) => {\n                    point && point.remove();\n                });\n            } else {\n                this.setupGrabPoints(\n                    this.face\n                        .remember('_selectHandler')\n                        .drawPoint.bind({ nested: this, options: this.face.remember('_selectHandler').options }),\n                );\n\n                // setup proper classes for selection points for proper cursor\n                Array.from(this.face.remember('_selectHandler').nested.node.children).forEach(\n                    (point: SVG.LinkedHTMLElement, i: number) => {\n                        point.classList.add(`svg_select_points_${['lt', 'lb', 'rb', 'rt'][i]}`);\n                    },\n                );\n\n                if (this.cuboidModel.orientation === Orientation.LEFT) {\n                    Array.from(this.dorsalRightEdge.remember('_selectHandler').nested.node.children).forEach(\n                        (point: SVG.LinkedHTMLElement, i: number) => {\n                            point.classList.add(`svg_select_points_${['t', 'b'][i]}`);\n                            point.ondblclick = (e: MouseEvent) => {\n                                if (e.shiftKey) {\n                                    this.resetPerspective();\n                                }\n                            };\n                        },\n                    );\n                } else {\n                    Array.from(this.dorsalLeftEdge.remember('_selectHandler').nested.node.children).forEach(\n                        (point: SVG.LinkedHTMLElement, i: number) => {\n                            point.classList.add(`svg_select_points_${['t', 'b'][i]}`);\n                            point.ondblclick = (e: MouseEvent) => {\n                                if (e.shiftKey) {\n                                    this.resetPerspective();\n                                }\n                            };\n                        },\n                    );\n                }\n            }\n\n            return this;\n        },\n\n        resize(value?: string | object) {\n            this.face.resize(value);\n\n            if (value === 'stop') {\n                this.dorsalRightEdge.resize(value);\n                this.dorsalLeftEdge.resize(value);\n                this.face.off('resizing').off('resizedone').off('resizestart');\n                this.dorsalRightEdge.off('resizing').off('resizedone').off('resizestart');\n                this.dorsalLeftEdge.off('resizing').off('resizedone').off('resizestart');\n\n                this.getGrabPoints().forEach((point: SVG.Element) => {\n                    if (point) {\n                        point.off('dragstart');\n                        point.off('dragmove');\n                        point.off('dragend');\n                    }\n                });\n\n                return;\n            }\n\n            function getResizedPointIndex(event: CustomEvent): number {\n                const { target } = event.detail.event.detail.event;\n                const { parentElement } = target;\n                return Array.from(parentElement.children).indexOf(target);\n            }\n\n            let resizedCubePoint: null | number = null;\n            const accumulatedOffset: Point = {\n                x: 0,\n                y: 0,\n            };\n\n            this.face\n                .on('resizestart', (event: CustomEvent) => {\n                    accumulatedOffset.x = 0;\n                    accumulatedOffset.y = 0;\n                    const resizedFacePoint = getResizedPointIndex(event);\n                    resizedCubePoint = [0, 1].includes(resizedFacePoint) ? resizedFacePoint : 5 - resizedFacePoint; // 2,3 -> 3,2\n                    this.fire(new CustomEvent('resizestart', event));\n                })\n                .on('resizing', (event: CustomEvent) => {\n                    let { dx, dy } = event.detail;\n                    let dxPortion = dx - accumulatedOffset.x;\n                    let dyPortion = dy - accumulatedOffset.y;\n                    accumulatedOffset.x += dxPortion;\n                    accumulatedOffset.y += dyPortion;\n\n                    const edge = getEdgeIndex(resizedCubePoint);\n                    const [edgeTopIndex, edgeBottomIndex] = getTopDown(edge);\n\n                    let cuboidPoints = this.cuboidModel.getPoints();\n                    let x1 = cuboidPoints[edgeTopIndex].x + dxPortion;\n                    let x2 = cuboidPoints[edgeBottomIndex].x + dxPortion;\n                    if (\n                        edge === EdgeIndex.FL &&\n                        cuboidPoints[2].x - (cuboidPoints[0].x + dxPortion) < consts.MIN_EDGE_LENGTH\n                    ) {\n                        x1 = cuboidPoints[edgeTopIndex].x;\n                        x2 = cuboidPoints[edgeBottomIndex].x;\n                    } else if (\n                        edge === EdgeIndex.FR &&\n                        cuboidPoints[2].x + dxPortion - cuboidPoints[0].x < consts.MIN_EDGE_LENGTH\n                    ) {\n                        x1 = cuboidPoints[edgeTopIndex].x;\n                        x2 = cuboidPoints[edgeBottomIndex].x;\n                    }\n                    const y1 = this.cuboidModel.ft.getEquation().getY(x1);\n                    const y2 = this.cuboidModel.fb.getEquation().getY(x2);\n                    const topPoint = { x: x1, y: y1 };\n                    const botPoint = { x: x2, y: y2 };\n                    if (edge === 1) {\n                        this.cuboidModel.fl.points = [topPoint, botPoint];\n                    } else {\n                        this.cuboidModel.fr.points = [topPoint, botPoint];\n                    }\n                    this.updateViewAndVM(edge === EdgeIndex.FR);\n\n                    cuboidPoints = this.cuboidModel.getPoints();\n                    const midPointUp = { ...cuboidPoints[edgeTopIndex] };\n                    const midPointDown = { ...cuboidPoints[edgeBottomIndex] };\n                    (edgeTopIndex === resizedCubePoint ? midPointUp : midPointDown).y += dyPortion;\n                    if (midPointDown.y - midPointUp.y > consts.MIN_EDGE_LENGTH) {\n                        const topPoints = this.computeHeightFace(midPointUp, edge);\n                        const bottomPoints = this.computeHeightFace(midPointDown, edge);\n                        this.cuboidModel.top.points = topPoints;\n                        this.cuboidModel.bot.points = bottomPoints;\n                        this.updateViewAndVM(false);\n                    }\n\n                    this.face.plot(this.cuboidModel.front.points);\n                    this.fire(new CustomEvent('resizing', event));\n                })\n                .on('resizedone', (event: CustomEvent) => {\n                    this.fire(new CustomEvent('resizedone', event));\n                });\n\n            function computeSideEdgeConstraints(edge: Edge, fr: Edge) {\n                const midLength = fr.points[1].y - fr.points[0].y - 1;\n\n                const minY = edge.points[1].y - midLength;\n                const maxY = edge.points[0].y + midLength;\n\n                const y1 = edge.points[0].y;\n                const y2 = edge.points[1].y;\n\n                const miny1 = y2 - midLength;\n                const maxy1 = y2 - consts.MIN_EDGE_LENGTH;\n\n                const miny2 = y1 + consts.MIN_EDGE_LENGTH;\n                const maxy2 = y1 + midLength;\n\n                return {\n                    constraint: {\n                        minY,\n                        maxY,\n                    },\n                    y1Range: {\n                        max: maxy1,\n                        min: miny1,\n                    },\n                    y2Range: {\n                        max: maxy2,\n                        min: miny2,\n                    },\n                };\n            }\n\n            function setupDorsalEdge(edge: SVG.Line, orientation: Orientation) {\n                edge.on('resizestart', (event: CustomEvent) => {\n                    accumulatedOffset.x = 0;\n                    accumulatedOffset.y = 0;\n                    resizedCubePoint = getResizedPointIndex(event) + (orientation === Orientation.LEFT ? 4 : 6);\n                    this.fire(new CustomEvent('resizestart', event));\n                })\n                    .on('resizing', (event: CustomEvent) => {\n                        let { dy } = event.detail;\n                        let dyPortion = dy - accumulatedOffset.y;\n                        accumulatedOffset.y += dyPortion;\n\n                        const edge = getEdgeIndex(resizedCubePoint);\n                        const [edgeTopIndex, edgeBottomIndex] = getTopDown(edge);\n                        let cuboidPoints = this.cuboidModel.getPoints();\n\n                        if (!event.detail.event.shiftKey) {\n                            cuboidPoints = this.cuboidModel.getPoints();\n                            const midPointUp = { ...cuboidPoints[edgeTopIndex] };\n                            const midPointDown = { ...cuboidPoints[edgeBottomIndex] };\n                            (edgeTopIndex === resizedCubePoint ? midPointUp : midPointDown).y += dyPortion;\n                            if (midPointDown.y - midPointUp.y > consts.MIN_EDGE_LENGTH) {\n                                const topPoints = this.computeHeightFace(midPointUp, edge);\n                                const bottomPoints = this.computeHeightFace(midPointDown, edge);\n                                this.cuboidModel.top.points = topPoints;\n                                this.cuboidModel.bot.points = bottomPoints;\n                            }\n                        } else {\n                            const midPointUp = { ...cuboidPoints[edgeTopIndex] };\n                            const midPointDown = { ...cuboidPoints[edgeBottomIndex] };\n                            (edgeTopIndex === resizedCubePoint ? midPointUp : midPointDown).y += dyPortion;\n                            const dorselEdge =\n                                orientation === Orientation.LEFT ? this.cuboidModel.dr : this.cuboidModel.dl;\n                            const constraints = computeSideEdgeConstraints(dorselEdge, this.cuboidModel.fr);\n                            midPointUp.y = clamp(midPointUp.y, constraints.y1Range.min, constraints.y1Range.max);\n                            midPointDown.y = clamp(midPointDown.y, constraints.y2Range.min, constraints.y2Range.max);\n                            dorselEdge.points = [midPointUp, midPointDown];\n                            this.updateViewAndVM(edge === EdgeIndex.DL);\n                        }\n\n                        this.updateViewAndVM(false);\n                        this.face.plot(this.cuboidModel.front.points);\n                        this.fire(new CustomEvent('resizing', event));\n                    })\n                    .on('resizedone', (event: CustomEvent) => {\n                        this.fire(new CustomEvent('resizedone', event));\n                    });\n            }\n\n            if (this.cuboidModel.orientation === Orientation.LEFT) {\n                this.dorsalRightEdge.resize(value);\n                setupDorsalEdge.call(this, this.dorsalRightEdge, this.cuboidModel.orientation);\n            } else {\n                this.dorsalLeftEdge.resize(value);\n                setupDorsalEdge.call(this, this.dorsalLeftEdge, this.cuboidModel.orientation);\n            }\n\n            function horizontalEdgeControl(updatingFace: any, midX: number, midY: number) {\n                const leftPoints = this.updatedEdge(\n                    this.cuboidModel.fl.points[0],\n                    { x: midX, y: midY },\n                    this.cuboidModel.vpl,\n                );\n                const rightPoints = this.updatedEdge(\n                    this.cuboidModel.dr.points[0],\n                    { x: midX, y: midY },\n                    this.cuboidModel.vpr,\n                );\n\n                updatingFace.points = [leftPoints, { x: midX, y: midY }, rightPoints, null];\n            }\n\n            this.drCenter\n                .draggable((x: number) => {\n                    let xStatus;\n                    if (this.drCenter.cx() < this.cuboidModel.fr.points[0].x) {\n                        xStatus =\n                            x < this.cuboidModel.fr.points[0].x - consts.MIN_EDGE_LENGTH &&\n                            x > this.cuboidModel.vpr.x + consts.MIN_EDGE_LENGTH;\n                    } else {\n                        xStatus =\n                            x > this.cuboidModel.fr.points[0].x + consts.MIN_EDGE_LENGTH &&\n                            x < this.cuboidModel.vpr.x - consts.MIN_EDGE_LENGTH;\n                    }\n                    return { x: xStatus, y: this.drCenter.attr('y1') };\n                })\n                .on('dragstart', (event: CustomEvent) => {\n                    this.fire(new CustomEvent('resizestart', event));\n                })\n                .on('dragmove', (event: CustomEvent) => {\n                    this.dorsalRightEdge.center(this.drCenter.cx(), this.drCenter.cy());\n\n                    const x = this.dorsalRightEdge.attr('x1');\n                    const y1 = this.cuboidModel.rt.getEquation().getY(x);\n                    const y2 = this.cuboidModel.rb.getEquation().getY(x);\n                    const topPoint = { x, y: y1 };\n                    const botPoint = { x, y: y2 };\n\n                    this.cuboidModel.dr.points = [topPoint, botPoint];\n                    this.updateViewAndVM();\n                    this.fire(new CustomEvent('resizing', event));\n                })\n                .on('dragend', (event: CustomEvent) => {\n                    this.fire(new CustomEvent('resizedone', event));\n                });\n\n            this.dlCenter\n                .draggable((x: number) => {\n                    let xStatus;\n                    if (this.dlCenter.cx() < this.cuboidModel.fl.points[0].x) {\n                        xStatus =\n                            x < this.cuboidModel.fl.points[0].x - consts.MIN_EDGE_LENGTH &&\n                            x > this.cuboidModel.vpr.x + consts.MIN_EDGE_LENGTH;\n                    } else {\n                        xStatus =\n                            x > this.cuboidModel.fl.points[0].x + consts.MIN_EDGE_LENGTH &&\n                            x < this.cuboidModel.vpr.x - consts.MIN_EDGE_LENGTH;\n                    }\n                    return { x: xStatus, y: this.dlCenter.attr('y1') };\n                })\n                .on('dragstart', (event: CustomEvent) => {\n                    this.fire(new CustomEvent('resizestart', event));\n                })\n                .on('dragmove', (event: CustomEvent) => {\n                    this.dorsalLeftEdge.center(this.dlCenter.cx(), this.dlCenter.cy());\n\n                    const x = this.dorsalLeftEdge.attr('x1');\n                    const y1 = this.cuboidModel.lt.getEquation().getY(x);\n                    const y2 = this.cuboidModel.lb.getEquation().getY(x);\n                    const topPoint = { x, y: y1 };\n                    const botPoint = { x, y: y2 };\n\n                    this.cuboidModel.dl.points = [topPoint, botPoint];\n                    this.updateViewAndVM(true);\n                    this.fire(new CustomEvent('resizing', event));\n                })\n                .on('dragend', (event: CustomEvent) => {\n                    this.fire(new CustomEvent('resizedone', event));\n                });\n\n            this.flCenter\n                .draggable((x: number) => {\n                    const vpX = this.flCenter.cx() - this.cuboidModel.vpl.x > 0 ? this.cuboidModel.vpl.x : 0;\n                    return { x: x < this.cuboidModel.fr.points[0].x && x > vpX + consts.MIN_EDGE_LENGTH };\n                })\n                .on('dragstart', (event: CustomEvent) => {\n                    this.fire(new CustomEvent('resizestart', event));\n                })\n                .on('dragmove', (event: CustomEvent) => {\n                    this.frontLeftEdge.center(this.flCenter.cx(), this.flCenter.cy());\n\n                    const x = this.frontLeftEdge.attr('x1');\n                    const y1 = this.cuboidModel.ft.getEquation().getY(x);\n                    const y2 = this.cuboidModel.fb.getEquation().getY(x);\n                    const topPoint = { x, y: y1 };\n                    const botPoint = { x, y: y2 };\n\n                    this.cuboidModel.fl.points = [topPoint, botPoint];\n                    this.updateViewAndVM();\n                    this.fire(new CustomEvent('resizing', event));\n                })\n                .on('dragend', (event: CustomEvent) => {\n                    this.fire(new CustomEvent('resizedone', event));\n                });\n\n            this.frCenter\n                .draggable((x: number) => {\n                    return { x: x > this.cuboidModel.fl.points[0].x, y: this.frCenter.attr('y1') };\n                })\n                .on('dragstart', (event: CustomEvent) => {\n                    this.fire(new CustomEvent('resizestart', event));\n                })\n                .on('dragmove', (event: CustomEvent) => {\n                    this.frontRightEdge.center(this.frCenter.cx(), this.frCenter.cy());\n\n                    const x = this.frontRightEdge.attr('x1');\n                    const y1 = this.cuboidModel.ft.getEquation().getY(x);\n                    const y2 = this.cuboidModel.fb.getEquation().getY(x);\n                    const topPoint = { x, y: y1 };\n                    const botPoint = { x, y: y2 };\n\n                    this.cuboidModel.fr.points = [topPoint, botPoint];\n                    this.updateViewAndVM(true);\n                    this.fire(new CustomEvent('resizing', event));\n                })\n                .on('dragend', (event: CustomEvent) => {\n                    this.fire(new CustomEvent('resizedone', event));\n                });\n\n            this.ftCenter\n                .draggable((x: number, y: number) => {\n                    return { x: x === this.ftCenter.cx(), y: y < this.fbCenter.cy() - consts.MIN_EDGE_LENGTH };\n                })\n                .on('dragstart', (event: CustomEvent) => {\n                    this.fire(new CustomEvent('resizestart', event));\n                })\n                .on('dragmove', (event: CustomEvent) => {\n                    this.frontTopEdge.center(this.ftCenter.cx(), this.ftCenter.cy());\n                    horizontalEdgeControl.call(\n                        this,\n                        this.cuboidModel.top,\n                        this.frontTopEdge.attr('x2'),\n                        this.frontTopEdge.attr('y2'),\n                    );\n                    this.updateViewAndVM();\n                    this.fire(new CustomEvent('resizing', event));\n                })\n                .on('dragend', (event: CustomEvent) => {\n                    this.fire(new CustomEvent('resizedone', event));\n                });\n\n            this.fbCenter\n                .draggable((x: number, y: number) => {\n                    return { x: x === this.fbCenter.cx(), y: y > this.ftCenter.cy() + consts.MIN_EDGE_LENGTH };\n                })\n                .on('dragstart', (event: CustomEvent) => {\n                    this.fire(new CustomEvent('resizestart', event));\n                })\n                .on('dragmove', (event: CustomEvent) => {\n                    this.frontBotEdge.center(this.fbCenter.cx(), this.fbCenter.cy());\n                    horizontalEdgeControl.call(\n                        this,\n                        this.cuboidModel.bot,\n                        this.frontBotEdge.attr('x2'),\n                        this.frontBotEdge.attr('y2'),\n                    );\n                    this.updateViewAndVM();\n                    this.fire(new CustomEvent('resizing', event));\n                })\n                .on('dragend', (event: CustomEvent) => {\n                    this.fire(new CustomEvent('resizedone', event));\n                });\n\n            return this;\n        },\n\n        draggable(value: any, constraint: any) {\n            const { cuboidModel } = this;\n            const faces = [this.face, this.right, this.dorsal, this.left];\n            const accumulatedOffset: Point = {\n                x: 0,\n                y: 0,\n            };\n\n            if (value === false) {\n                faces.forEach((face: any) => {\n                    face.draggable(false);\n                    face.off('dragstart');\n                    face.off('dragmove');\n                    face.off('dragend');\n                });\n                return;\n            }\n\n            this.face\n                .draggable()\n                .on('dragstart', (event: CustomEvent) => {\n                    accumulatedOffset.x = 0;\n                    accumulatedOffset.y = 0;\n\n                    this.fire(new CustomEvent('dragstart', event));\n                })\n                .on('dragmove', (event: CustomEvent) => {\n                    const dx = event.detail.p.x - event.detail.handler.startPoints.point.x;\n                    const dy = event.detail.p.y - event.detail.handler.startPoints.point.y;\n                    let dxPortion = dx - accumulatedOffset.x;\n                    let dyPortion = dy - accumulatedOffset.y;\n                    accumulatedOffset.x += dxPortion;\n                    accumulatedOffset.y += dyPortion;\n\n                    this.dmove(dxPortion, dyPortion);\n\n                    this.fire(new CustomEvent('dragmove', event));\n                })\n                .on('dragend', (event: CustomEvent) => {\n                    this.fire(new CustomEvent('dragend', event));\n                });\n\n            this.left\n                .draggable((x: number, y: number) => ({\n                    x: x < Math.min(cuboidModel.dr.points[0].x, cuboidModel.fr.points[0].x) - consts.MIN_EDGE_LENGTH,\n                    y,\n                }))\n                .on('dragstart', (event: CustomEvent) => {\n                    this.fire(new CustomEvent('dragstart', event));\n                })\n                .on('dragmove', (event: CustomEvent) => {\n                    this.cuboidModel.left.points = parsePoints(this.left.attr('points'));\n                    this.updateViewAndVM();\n\n                    this.fire(new CustomEvent('dragmove', event));\n                })\n                .on('dragend', (event: CustomEvent) => {\n                    this.fire(new CustomEvent('dragend', event));\n                });\n\n            this.dorsal\n                .draggable()\n                .on('dragstart', (event: CustomEvent) => {\n                    this.fire(new CustomEvent('dragstart', event));\n                })\n                .on('dragmove', (event: CustomEvent) => {\n                    this.cuboidModel.dorsal.points = parsePoints(this.dorsal.attr('points'));\n                    this.updateViewAndVM();\n\n                    this.fire(new CustomEvent('dragmove', event));\n                })\n                .on('dragend', (event: CustomEvent) => {\n                    this.fire(new CustomEvent('dragend', event));\n                });\n\n            this.right\n                .draggable((x: number, y: number) => ({\n                    x: x > Math.min(cuboidModel.dl.points[0].x, cuboidModel.fl.points[0].x) + consts.MIN_EDGE_LENGTH,\n                    y,\n                }))\n                .on('dragstart', (event: CustomEvent) => {\n                    this.fire(new CustomEvent('dragstart', event));\n                })\n                .on('dragmove', (event: CustomEvent) => {\n                    this.cuboidModel.right.points = parsePoints(this.right.attr('points'));\n                    this.updateViewAndVM(true);\n\n                    this.fire(new CustomEvent('dragmove', event));\n                })\n                .on('dragend', (event: CustomEvent) => {\n                    this.fire(new CustomEvent('dragend', event));\n                });\n\n            return this;\n        },\n\n        _attr: SVG.Element.prototype.attr,\n\n        attr(a: any, v: any, n: any) {\n            if ((a === 'fill' || a === 'stroke' || a === 'face-stroke') && v !== undefined) {\n                this._attr(a, v, n);\n                this.paintOrientationLines();\n            } else if (a === 'points' && typeof v === 'string') {\n                const points = parsePoints(v);\n                this.cuboidModel.setPoints(points);\n                this.updateViewAndVM();\n            } else if (a === 'projections') {\n                this._attr(a, v, n);\n                if (v === true) {\n                    this.ftProj.show();\n                    this.fbProj.show();\n                    this.rtProj.show();\n                    this.rbProj.show();\n                } else {\n                    this.ftProj.hide();\n                    this.fbProj.hide();\n                    this.rtProj.hide();\n                    this.rbProj.hide();\n                }\n            } else if (a === 'stroke-width' && typeof v === 'number') {\n                this._attr(a, v, n);\n                this.updateThickness();\n            } else if (a === 'data-z-order' && typeof v !== 'undefined') {\n                this._attr(a, v, n);\n                [this.face, this.left, this.dorsal, this.right, ...this.getEdges(), ...this.getGrabPoints()].forEach(\n                    (el) => {\n                        if (el) el.attr(a, v, n);\n                    },\n                );\n            } else {\n                return this._attr(a, v, n);\n            }\n\n            return this;\n        },\n\n        updateThickness() {\n            const edges = [this.frontLeftEdge, this.frontRightEdge, this.frontTopEdge, this.frontBotEdge];\n            const width = this.attr('stroke-width');\n            edges.forEach((edge: SVG.Element) => {\n                edge.attr('stroke-width', width * (this.strokeOffset || consts.CUBOID_UNACTIVE_EDGE_STROKE_WIDTH));\n            });\n            this.on('mouseover', () => {\n                edges.forEach((edge: SVG.Element) => {\n                    this.strokeOffset = this.node.classList.contains('cvat_canvas_shape_activated')\n                        ? consts.CUBOID_ACTIVE_EDGE_STROKE_WIDTH\n                        : consts.CUBOID_UNACTIVE_EDGE_STROKE_WIDTH;\n                    edge.attr('stroke-width', width * this.strokeOffset);\n                });\n            }).on('mouseout', () => {\n                edges.forEach((edge: SVG.Element) => {\n                    this.strokeOffset = consts.CUBOID_UNACTIVE_EDGE_STROKE_WIDTH;\n                    edge.attr('stroke-width', width * this.strokeOffset);\n                });\n            });\n        },\n\n        paintOrientationLines() {\n            // style has higher priority than attr, so then try to fetch it if exists\n            // https://stackoverflow.com/questions/47088409/svg-attributes-beaten-by-cssstyle-in-priority]\n            // we use getComputedStyle to get actual, not-inlined css property (come from the corresponding css class)\n            const computedStyles = getComputedStyle(this.node);\n            const fillColor = computedStyles['fill'] || this.attr('fill');\n            const strokeColor = computedStyles['stroke'] || this.attr('stroke');\n            const selectedColor = this.attr('face-stroke') || '#b0bec5';\n            this.frontTopEdge.stroke({ color: selectedColor });\n            this.frontLeftEdge.stroke({ color: selectedColor });\n            this.frontBotEdge.stroke({ color: selectedColor });\n            this.frontRightEdge.stroke({ color: selectedColor });\n\n            this.rightTopEdge.stroke({ color: strokeColor });\n            this.rightBotEdge.stroke({ color: strokeColor });\n            this.dorsalRightEdge.stroke({ color: strokeColor });\n            this.dorsalLeftEdge.stroke({ color: strokeColor });\n\n            this.bot.stroke({ color: strokeColor }).fill({ color: fillColor });\n            this.top.stroke({ color: strokeColor }).fill({ color: fillColor });\n            this.face.stroke({ color: strokeColor, width: 0 }).fill({ color: fillColor });\n            this.right.stroke({ color: strokeColor }).fill({ color: fillColor });\n            this.dorsal.stroke({ color: strokeColor }).fill({ color: fillColor });\n            this.left.stroke({ color: strokeColor }).fill({ color: fillColor });\n        },\n\n        dmove(dx: number, dy: number) {\n            this.cuboidModel.points.forEach((point: Point) => {\n                point.x += dx;\n                point.y += dy;\n            });\n\n            this.updateViewAndVM();\n        },\n\n        x(x?: number) {\n            if (typeof x === 'number') {\n                const { x: xInitial } = this.bbox();\n                this.dmove(x - xInitial, 0);\n                return this;\n            } else {\n                return this.bbox().x;\n            }\n        },\n\n        y(y?: number) {\n            if (typeof y === 'number') {\n                const { y: yInitial } = this.bbox();\n                this.dmove(0, y - yInitial);\n                return this;\n            } else {\n                return this.bbox().y;\n            }\n        },\n\n        resetPerspective() {\n            if (this.cuboidModel.orientation === Orientation.LEFT) {\n                const edgePoints = this.cuboidModel.dl.points;\n                const constraints = this.cuboidModel.computeSideEdgeConstraints(this.cuboidModel.dl);\n                edgePoints[0].y = constraints.y1Range.min;\n                this.cuboidModel.dl.points = [edgePoints[0], edgePoints[1]];\n                this.updateViewAndVM(true);\n            } else {\n                const edgePoints = this.cuboidModel.dr.points;\n                const constraints = this.cuboidModel.computeSideEdgeConstraints(this.cuboidModel.dr);\n                edgePoints[0].y = constraints.y1Range.min;\n                this.cuboidModel.dr.points = [edgePoints[0], edgePoints[1]];\n                this.updateViewAndVM();\n            }\n        },\n\n        updateViewAndVM(build: boolean) {\n            this.cuboidModel.updateOrientation();\n            this.cuboidModel.buildBackEdge(build);\n            this.updateView();\n\n            // to correct getting of points in resizedone, dragdone\n            this._attr(\n                'points',\n                this.cuboidModel\n                    .getPoints()\n                    .reduce((acc: string, point: Point): string => `${acc} ${point.x},${point.y}`, '')\n                    .trim(),\n            );\n        },\n\n        computeHeightFace(point: Point, index: number) {\n            switch (index) {\n                // fl\n                case 1: {\n                    const p2 = this.updatedEdge(this.cuboidModel.fr.points[0], point, this.cuboidModel.vpl);\n                    const p3 = this.updatedEdge(this.cuboidModel.dr.points[0], p2, this.cuboidModel.vpr);\n                    const p4 = this.updatedEdge(this.cuboidModel.dl.points[0], point, this.cuboidModel.vpr);\n                    return [point, p2, p3, p4];\n                }\n                // fr\n                case 2: {\n                    const p1 = this.updatedEdge(this.cuboidModel.fl.points[0], point, this.cuboidModel.vpl);\n                    const p3 = this.updatedEdge(this.cuboidModel.dr.points[0], point, this.cuboidModel.vpr);\n                    const p4 = this.updatedEdge(this.cuboidModel.dl.points[0], p3, this.cuboidModel.vpr);\n                    return [p1, point, p3, p4];\n                }\n                // dr\n                case 3: {\n                    const p2 = this.updatedEdge(this.cuboidModel.dl.points[0], point, this.cuboidModel.vpl);\n                    const p3 = this.updatedEdge(this.cuboidModel.fr.points[0], point, this.cuboidModel.vpr);\n                    const p4 = this.updatedEdge(this.cuboidModel.fl.points[0], p2, this.cuboidModel.vpr);\n                    return [p4, p3, point, p2];\n                }\n                // dl\n                case 4: {\n                    const p2 = this.updatedEdge(this.cuboidModel.dr.points[0], point, this.cuboidModel.vpl);\n                    const p3 = this.updatedEdge(this.cuboidModel.fl.points[0], point, this.cuboidModel.vpr);\n                    const p4 = this.updatedEdge(this.cuboidModel.fr.points[0], p2, this.cuboidModel.vpr);\n                    return [p3, p4, p2, point];\n                }\n                default: {\n                    return [null, null, null, null];\n                }\n            }\n        },\n\n        updatedEdge(target: Point, base: Point, pivot: Point) {\n            const targetX = target.x;\n            const line = new Equation(pivot, base);\n            const newY = line.getY(targetX);\n            return { x: targetX, y: newY };\n        },\n\n        updateView() {\n            this.updateFaces();\n            this.updateEdges();\n            this.updateProjections();\n            this.updateGrabPoints();\n        },\n\n        updateFaces() {\n            const viewModel = this.cuboidModel;\n\n            this.bot.plot(viewModel.bot.points);\n            this.top.plot(viewModel.top.points);\n            this.right.plot(viewModel.right.points);\n            this.dorsal.plot(viewModel.dorsal.points);\n            this.left.plot(viewModel.left.points);\n            this.face.plot(viewModel.front.points);\n        },\n\n        updateEdges() {\n            const viewModel = this.cuboidModel;\n\n            this.frontLeftEdge.plot(viewModel.fl.points);\n            this.frontRightEdge.plot(viewModel.fr.points);\n            this.dorsalRightEdge.plot(viewModel.dr.points);\n            this.dorsalLeftEdge.plot(viewModel.dl.points);\n\n            this.frontTopEdge.plot(viewModel.ft.points);\n            this.rightTopEdge.plot(viewModel.rt.points);\n            this.frontBotEdge.plot(viewModel.fb.points);\n            this.rightBotEdge.plot(viewModel.rb.points);\n        },\n\n        updateProjections() {\n            const viewModel = this.cuboidModel;\n\n            this.ftProj.plot(\n                this.updateProjectionLine(viewModel.ft.getEquation(), viewModel.ft.points[0], viewModel.vpl),\n            );\n            this.fbProj.plot(\n                this.updateProjectionLine(viewModel.fb.getEquation(), viewModel.ft.points[0], viewModel.vpl),\n            );\n            this.rtProj.plot(\n                this.updateProjectionLine(viewModel.rt.getEquation(), viewModel.rt.points[1], viewModel.vpr),\n            );\n            this.rbProj.plot(\n                this.updateProjectionLine(viewModel.rb.getEquation(), viewModel.rt.points[1], viewModel.vpr),\n            );\n        },\n\n        updateGrabPoints() {\n            const centers = this.getGrabPoints();\n            const edges = this.getEdges();\n            for (let i = 0; i < centers.length; i += 1) {\n                const edge = edges[i];\n                if (centers[i]) centers[i].center(edge.cx(), edge.cy());\n            }\n        },\n    },\n    construct: {\n        cube(points: string) {\n            return this.put(new (SVG as any).Cube()).constructorMethod(points);\n        },\n    },\n});\n","// Copyright (C) 2020-2022 Intel Corporation\n//\n// SPDX-License-Identifier: MIT\n\nimport * as SVG from 'svg.js';\nimport consts from './consts';\n\nexport default class Crosshair {\n    private x: SVG.Line | null;\n    private y: SVG.Line | null;\n    private canvas: SVG.Container | null;\n\n    public constructor() {\n        this.x = null;\n        this.y = null;\n        this.canvas = null;\n    }\n\n    public show(canvas: SVG.Container, x: number, y: number, scale: number): void {\n        if (this.canvas && this.canvas !== canvas) {\n            if (this.x) this.x.remove();\n            if (this.y) this.y.remove();\n            this.x = null;\n            this.y = null;\n        }\n\n        this.canvas = canvas;\n        this.x = this.canvas\n            .line(0, y, this.canvas.node.clientWidth, y)\n            .attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / (2 * scale),\n            })\n            .addClass('cvat_canvas_crosshair');\n\n        this.y = this.canvas\n            .line(x, 0, x, this.canvas.node.clientHeight)\n            .attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / (2 * scale),\n            })\n            .addClass('cvat_canvas_crosshair');\n    }\n\n    public hide(): void {\n        if (this.x) {\n            this.x.remove();\n            this.x = null;\n        }\n\n        if (this.y) {\n            this.y.remove();\n            this.y = null;\n        }\n\n        this.canvas = null;\n    }\n\n    public move(x: number, y: number): void {\n        if (this.x) {\n            this.x.attr({ y1: y, y2: y });\n        }\n\n        if (this.y) {\n            this.y.attr({ x1: x, x2: x });\n        }\n    }\n\n    public scale(scale: number): void {\n        if (this.x) {\n            this.x.attr('stroke-width', consts.BASE_STROKE_WIDTH / (2 * scale));\n        }\n\n        if (this.y) {\n            this.y.attr('stroke-width', consts.BASE_STROKE_WIDTH / (2 * scale));\n        }\n    }\n}\n","// Copyright (C) 2019-2022 Intel Corporation\n//\n// SPDX-License-Identifier: MIT\n\nimport * as SVG from 'svg.js';\nimport 'svg.draw.js';\nimport './svg.patch';\n\nimport { AutoborderHandler } from './autoborderHandler';\nimport {\n    translateToSVG,\n    displayShapeSize,\n    ShapeSizeElement,\n    stringifyPoints,\n    BBox,\n    Box,\n    Point,\n    readPointsFromShape,\n    clamp,\n    translateToCanvas,\n    computeWrappingBox,\n    makeSVGFromTemplate,\n    setupSkeletonEdges,\n    translateFromCanvas,\n} from './shared';\nimport Crosshair from './crosshair';\nimport consts from './consts';\nimport {\n    DrawData, Geometry, RectDrawingMethod, Configuration, CuboidDrawingMethod,\n} from './canvasModel';\n\nimport { cuboidFrom4Points, intersection } from './cuboid';\n\nexport interface DrawHandler {\n    configurate(configuration: Configuration): void;\n    draw(drawData: DrawData, geometry: Geometry): void;\n    transform(geometry: Geometry): void;\n    cancel(): void;\n}\n\ninterface FinalCoordinates {\n    points: number[];\n    box: Box;\n}\n\nfunction checkConstraint(shapeType: string, points: number[], box: Box | null = null): boolean {\n    if (shapeType === 'rectangle') {\n        const [xtl, ytl, xbr, ybr] = points;\n        return (xbr - xtl) * (ybr - ytl) >= consts.AREA_THRESHOLD;\n    }\n\n    if (shapeType === 'polygon') {\n        return (box.xbr - box.xtl) * (box.ybr - box.ytl) >= consts.AREA_THRESHOLD && points.length >= 3 * 2;\n    }\n\n    if (shapeType === 'polyline') {\n        return (box.xbr - box.xtl >= consts.SIZE_THRESHOLD ||\n            box.ybr - box.ytl >= consts.SIZE_THRESHOLD) && points.length >= 2 * 2;\n    }\n\n    if (shapeType === 'points') {\n        return points.length > 2 || (points.length === 2 && points[0] !== 0 && points[1] !== 0);\n    }\n\n    if (shapeType === 'ellipse') {\n        const [rx, ry] = [points[2] - points[0], points[1] - points[3]];\n        return rx * ry * Math.PI >= consts.AREA_THRESHOLD;\n    }\n\n    if (shapeType === 'cuboid') {\n        return points.length === 4 * 2 || points.length === 8 * 2 ||\n            (points.length === 2 * 2 && (points[2] - points[0]) * (points[3] - points[1]) >= consts.AREA_THRESHOLD);\n    }\n\n    if (shapeType === 'skeleton') {\n        const [xtl, ytl, xbr, ybr] = points;\n        return (xbr - xtl >= 1 || ybr - ytl >= 1);\n    }\n\n    return false;\n}\n\nexport class DrawHandlerImpl implements DrawHandler {\n    // callback is used to notify about creating new shape\n    private onDrawDoneDefault: (\n        data: object | null,\n        duration?: number,\n        continueDraw?: boolean,\n        prevDrawData?: DrawData,\n    ) => void;\n    private startTimestamp: number;\n    private canvas: SVG.Container;\n    private text: SVG.Container;\n    private cursorPosition: {\n        x: number;\n        y: number;\n    };\n    private crosshair: Crosshair;\n    private drawData: DrawData | null;\n    private geometry: Geometry;\n    private autoborderHandler: AutoborderHandler;\n    private autobordersEnabled: boolean;\n    private controlPointsSize: number;\n    private selectedShapeOpacity: number;\n    private outlinedBorders: string;\n\n    // we should use any instead of SVG.Shape because svg plugins cannot change declared interface\n    // so, methods like draw() just undefined for SVG.Shape, but nevertheless they exist\n    private drawInstance: any;\n    private initialized: boolean;\n    private canceled: boolean;\n    private pointsGroup: SVG.G | null;\n    private shapeSizeElement: ShapeSizeElement | null;\n\n    private getFinalEllipseCoordinates(points: number[], fitIntoFrame: boolean): number[] {\n        const { offset } = this.geometry;\n        const [cx, cy, rightX, topY] = points.map((coord: number) => coord - offset);\n        const [rx, ry] = [rightX - cx, cy - topY];\n        const frameWidth = this.geometry.image.width;\n        const frameHeight = this.geometry.image.height;\n        const [fitCX, fitCY] = fitIntoFrame ?\n            [clamp(cx, 0, frameWidth), clamp(cy, 0, frameHeight)] : [cx, cy];\n        const [fitRX, fitRY] = fitIntoFrame ?\n            [Math.min(rx, frameWidth - cx, cx), Math.min(ry, frameHeight - cy, cy)] : [rx, ry];\n        return [fitCX, fitCY, fitCX + fitRX, fitCY - fitRY];\n    }\n\n    private getFinalRectCoordinates(points: number[], fitIntoFrame: boolean): number[] {\n        const frameWidth = this.geometry.image.width;\n        const frameHeight = this.geometry.image.height;\n        const { offset } = this.geometry;\n\n        let [xtl, ytl, xbr, ybr] = points.map((coord: number): number => coord - offset);\n\n        if (fitIntoFrame) {\n            xtl = Math.min(Math.max(xtl, 0), frameWidth);\n            xbr = Math.min(Math.max(xbr, 0), frameWidth);\n            ytl = Math.min(Math.max(ytl, 0), frameHeight);\n            ybr = Math.min(Math.max(ybr, 0), frameHeight);\n        }\n\n        return [xtl, ytl, xbr, ybr];\n    }\n\n    private getFinalPolyshapeCoordinates(targetPoints: number[], fitIntoFrame: boolean): FinalCoordinates {\n        const { offset } = this.geometry;\n        let points = targetPoints.map((coord: number): number => coord - offset);\n        const box = {\n            xtl: Number.MAX_SAFE_INTEGER,\n            ytl: Number.MAX_SAFE_INTEGER,\n            xbr: Number.MIN_SAFE_INTEGER,\n            ybr: Number.MIN_SAFE_INTEGER,\n        };\n\n        const frameWidth = this.geometry.image.width;\n        const frameHeight = this.geometry.image.height;\n\n        enum Direction {\n            Horizontal,\n            Vertical,\n        }\n\n        function isBetween(x1: number, x2: number, c: number): boolean {\n            return c >= Math.min(x1, x2) && c <= Math.max(x1, x2);\n        }\n\n        const isInsideFrame = (p: Point, direction: Direction): boolean => {\n            if (direction === Direction.Horizontal) {\n                return isBetween(0, frameWidth, p.x);\n            }\n            return isBetween(0, frameHeight, p.y);\n        };\n\n        const findInersection = (p1: Point, p2: Point, p3: Point, p4: Point): number[] => {\n            const intersectionPoint = intersection(p1, p2, p3, p4);\n            if (\n                intersectionPoint &&\n                isBetween(p1.x, p2.x, intersectionPoint.x) &&\n                isBetween(p1.y, p2.y, intersectionPoint.y)\n            ) {\n                return [intersectionPoint.x, intersectionPoint.y];\n            }\n            return [];\n        };\n\n        const findIntersectionsWithFrameBorders = (p1: Point, p2: Point, direction: Direction): number[] => {\n            const resultPoints = [];\n            const leftLine = [\n                { x: 0, y: 0 },\n                { x: 0, y: frameHeight },\n            ];\n            const topLine = [\n                { x: frameWidth, y: 0 },\n                { x: 0, y: 0 },\n            ];\n            const rightLine = [\n                { x: frameWidth, y: frameHeight },\n                { x: frameWidth, y: 0 },\n            ];\n            const bottomLine = [\n                { x: 0, y: frameHeight },\n                { x: frameWidth, y: frameHeight },\n            ];\n\n            if (direction === Direction.Horizontal) {\n                resultPoints.push(...findInersection(p1, p2, leftLine[0], leftLine[1]));\n                resultPoints.push(...findInersection(p1, p2, rightLine[0], rightLine[1]));\n            } else {\n                resultPoints.push(...findInersection(p1, p2, bottomLine[0], bottomLine[1]));\n                resultPoints.push(...findInersection(p1, p2, topLine[0], topLine[1]));\n            }\n\n            if (resultPoints.length === 4) {\n                if (\n                    (p1.x === p2.x || Math.sign(resultPoints[0] - resultPoints[2]) !== Math.sign(p1.x - p2.x)) &&\n                    (p1.y === p2.y || Math.sign(resultPoints[1] - resultPoints[3]) !== Math.sign(p1.y - p2.y))\n                ) {\n                    [resultPoints[0], resultPoints[2]] = [resultPoints[2], resultPoints[0]];\n                    [resultPoints[1], resultPoints[3]] = [resultPoints[3], resultPoints[1]];\n                }\n            }\n            return resultPoints;\n        };\n\n        const crop = (shapePoints: number[], direction: Direction): number[] => {\n            const resultPoints = [];\n            const isPolyline = this.drawData.shapeType === 'polyline';\n            const isPolygon = this.drawData.shapeType === 'polygon';\n\n            for (let i = 0; i < shapePoints.length - 1; i += 2) {\n                const curPoint = { x: shapePoints[i], y: shapePoints[i + 1] };\n                if (isInsideFrame(curPoint, direction)) {\n                    resultPoints.push(shapePoints[i], shapePoints[i + 1]);\n                }\n                const isLastPoint = i === shapePoints.length - 2;\n                if (isLastPoint && (isPolyline || (isPolygon && shapePoints.length === 4))) {\n                    break;\n                }\n                const nextPoint = isLastPoint ?\n                    { x: shapePoints[0], y: shapePoints[1] } :\n                    { x: shapePoints[i + 2], y: shapePoints[i + 3] };\n                const intersectionPoints = findIntersectionsWithFrameBorders(curPoint, nextPoint, direction);\n                if (intersectionPoints.length !== 0) {\n                    resultPoints.push(...intersectionPoints);\n                }\n            }\n            return resultPoints;\n        };\n\n        if (fitIntoFrame) {\n            points = crop(points, Direction.Horizontal);\n            points = crop(points, Direction.Vertical);\n        }\n\n        for (let i = 0; i < points.length - 1; i += 2) {\n            box.xtl = Math.min(box.xtl, points[i]);\n            box.ytl = Math.min(box.ytl, points[i + 1]);\n            box.xbr = Math.max(box.xbr, points[i]);\n            box.ybr = Math.max(box.ybr, points[i + 1]);\n        }\n\n        return {\n            points,\n            box,\n        };\n    }\n\n    private getFinalCuboidCoordinates(targetPoints: number[]): FinalCoordinates {\n        const { offset } = this.geometry;\n        let points = targetPoints;\n\n        const box = {\n            xtl: Number.MAX_SAFE_INTEGER,\n            ytl: Number.MAX_SAFE_INTEGER,\n            xbr: Number.MIN_SAFE_INTEGER,\n            ybr: Number.MIN_SAFE_INTEGER,\n        };\n\n        const frameWidth = this.geometry.image.width;\n        const frameHeight = this.geometry.image.height;\n\n        const cuboidOffsets = [];\n        const minCuboidOffset = {\n            d: Number.MAX_SAFE_INTEGER,\n            dx: 0,\n            dy: 0,\n        };\n\n        for (let i = 0; i < points.length - 1; i += 2) {\n            const [x, y] = points.slice(i);\n\n            if (x >= offset && x <= offset + frameWidth && y >= offset && y <= offset + frameHeight) continue;\n\n            let xOffset = 0;\n            let yOffset = 0;\n\n            if (x < offset) {\n                xOffset = offset - x;\n            } else if (x > offset + frameWidth) {\n                xOffset = offset + frameWidth - x;\n            }\n\n            if (y < offset) {\n                yOffset = offset - y;\n            } else if (y > offset + frameHeight) {\n                yOffset = offset + frameHeight - y;\n            }\n\n            cuboidOffsets.push([xOffset, yOffset]);\n        }\n\n        if (cuboidOffsets.length === points.length / 2) {\n            cuboidOffsets.forEach((offsetCoords: number[]): void => {\n                const dx = offsetCoords[0] ** 2;\n                const dy = offsetCoords[1] ** 2;\n                if (Math.sqrt(dx + dy) < minCuboidOffset.d) {\n                    minCuboidOffset.d = Math.sqrt(dx + dy);\n                    [minCuboidOffset.dx, minCuboidOffset.dy] = offsetCoords;\n                }\n            });\n\n            points = points.map((coord: number, i: number): number => {\n                if (i % 2) {\n                    return coord + minCuboidOffset.dy;\n                }\n                return coord + minCuboidOffset.dx;\n            });\n        }\n\n        points.forEach((coord: number, i: number): number => {\n            if (i % 2 === 0) {\n                box.xtl = Math.min(box.xtl, coord);\n                box.xbr = Math.max(box.xbr, coord);\n            } else {\n                box.ytl = Math.min(box.ytl, coord);\n                box.ybr = Math.max(box.ybr, coord);\n            }\n\n            return coord;\n        });\n\n        return {\n            points: points.map((coord: number): number => coord - offset),\n            box,\n        };\n    }\n\n    private addCrosshair(): void {\n        const { x, y } = this.cursorPosition;\n        this.crosshair.show(this.canvas, x, y, this.geometry.scale);\n    }\n\n    private removeCrosshair(): void {\n        this.crosshair.hide();\n    }\n\n    private onDrawDone(...args: any[]): void {\n        if (this.drawData.onDrawDone) {\n            this.drawData.onDrawDone.call(this, ...args);\n            return;\n        }\n\n        this.onDrawDoneDefault.call(this, ...args);\n    }\n\n    private release(): void {\n        if (!this.initialized) {\n            // prevents recursive calls\n            return;\n        }\n\n        this.autoborderHandler.autoborder(false);\n        this.initialized = false;\n        this.canvas.off('mousedown.draw');\n        this.canvas.off('mousemove.draw');\n\n        // Draw plugin in some cases isn't activated\n        // For example when draw from initialState\n        // Or when no drawn points, but we call cancel() drawing\n        // We check if it is activated with remember function\n        if (this.drawInstance.remember('_paintHandler')) {\n            if (['polygon', 'polyline', 'points'].includes(this.drawData.shapeType) ||\n                (this.drawData.shapeType === 'cuboid' &&\n                this.drawData.cuboidDrawingMethod === CuboidDrawingMethod.CORNER_POINTS)) {\n                // Check for unsaved drawn shapes\n                this.drawInstance.draw('done');\n            }\n            // Clear drawing\n            this.drawInstance.draw('stop');\n        } else if (this.drawInstance && this.drawData.shapeType === 'ellipse' && !this.drawData.initialState) {\n            this.drawInstance.fire('drawstop');\n        }\n\n        if (this.pointsGroup) {\n            this.pointsGroup.remove();\n            this.pointsGroup = null;\n        }\n\n        this.drawInstance.off();\n        this.drawInstance.remove();\n        this.drawInstance = null;\n\n        if (this.shapeSizeElement) {\n            this.shapeSizeElement.rm();\n            this.shapeSizeElement = null;\n        }\n\n        if (this.crosshair) {\n            this.removeCrosshair();\n        }\n\n        this.onDrawDone(null);\n    }\n\n    private initDrawing(): void {\n        if (this.drawData.crosshair) {\n            this.addCrosshair();\n        }\n    }\n\n    private drawBox(): void {\n        this.drawInstance = this.canvas.rect();\n        this.drawInstance\n            .on('drawstop', (e: Event): void => {\n                const points = readPointsFromShape((e.target as any as { instance: SVG.Rect }).instance);\n                const [xtl, ytl, xbr, ybr] = this.getFinalRectCoordinates(points, true);\n                const { shapeType, redraw: clientID } = this.drawData;\n                this.release();\n\n                if (this.canceled) return;\n                if (checkConstraint('rectangle', [xtl, ytl, xbr, ybr])) {\n                    this.onDrawDone({\n                        clientID,\n                        shapeType,\n                        points: [xtl, ytl, xbr, ybr],\n                    },\n                    Date.now() - this.startTimestamp);\n                }\n            })\n            .on('drawupdate', (): void => {\n                this.shapeSizeElement.update(this.drawInstance);\n            })\n            .addClass('cvat_canvas_shape_drawing')\n            .attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                'fill-opacity': this.selectedShapeOpacity,\n                stroke: this.outlinedBorders,\n            });\n    }\n\n    private drawEllipse(): void {\n        this.drawInstance = (this.canvas as any).ellipse()\n            .addClass('cvat_canvas_shape_drawing')\n            .attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                'fill-opacity': this.selectedShapeOpacity,\n                stroke: this.outlinedBorders,\n            });\n\n        const initialPoint: {\n            x: number;\n            y: number;\n        } = {\n            x: null,\n            y: null,\n        };\n\n        this.canvas.on('mousedown.draw', (e: MouseEvent): void => {\n            if (initialPoint.x === null || initialPoint.y === null) {\n                const translated = translateToSVG(this.canvas.node as any as SVGSVGElement, [e.clientX, e.clientY]);\n                [initialPoint.x, initialPoint.y] = translated;\n            } else {\n                this.drawInstance.fire('drawstop');\n            }\n        });\n\n        this.canvas.on('mousemove.draw', (e: MouseEvent): void => {\n            if (initialPoint.x !== null && initialPoint.y !== null) {\n                const translated = translateToSVG(this.canvas.node as any as SVGSVGElement, [e.clientX, e.clientY]);\n                const rx = Math.abs(translated[0] - initialPoint.x) / 2;\n                const ry = Math.abs(translated[1] - initialPoint.y) / 2;\n                const cx = initialPoint.x + rx * Math.sign(translated[0] - initialPoint.x);\n                const cy = initialPoint.y + ry * Math.sign(translated[1] - initialPoint.y);\n                this.drawInstance.center(cx, cy);\n                this.drawInstance.radius(rx, ry);\n                this.shapeSizeElement.update(this.drawInstance);\n            }\n        });\n\n        this.drawInstance.on('drawstop', () => {\n            this.drawInstance.off('drawstop');\n            const points = this.getFinalEllipseCoordinates(readPointsFromShape(this.drawInstance), false);\n            const { shapeType, redraw: clientID } = this.drawData;\n            this.release();\n\n            if (this.canceled) return;\n            if (checkConstraint('ellipse', points)) {\n                this.onDrawDone(\n                    {\n                        clientID,\n                        shapeType,\n                        points,\n                    },\n                    Date.now() - this.startTimestamp,\n                );\n            }\n        });\n    }\n\n    private drawBoxBy4Points(): void {\n        let numberOfPoints = 0;\n        this.drawInstance = (this.canvas as any)\n            .polygon()\n            .addClass('cvat_canvas_shape_drawing')\n            .attr({\n                'stroke-width': 0,\n                opacity: 0,\n            })\n            .on('drawstart', (): void => {\n                // init numberOfPoints as one on drawstart\n                numberOfPoints = 1;\n            })\n            .on('drawpoint', (e: CustomEvent): void => {\n                // increase numberOfPoints by one on drawpoint\n                numberOfPoints += 1;\n\n                // finish if numberOfPoints are exactly four\n                if (numberOfPoints === 4) {\n                    const bbox = (e.target as SVGPolylineElement).getBBox();\n                    const points = [bbox.x, bbox.y, bbox.x + bbox.width, bbox.y + bbox.height];\n                    const [xtl, ytl, xbr, ybr] = this.getFinalRectCoordinates(points, true);\n                    const { shapeType, redraw: clientID } = this.drawData;\n                    this.cancel();\n\n                    if (checkConstraint('rectangle', [xtl, ytl, xbr, ybr])) {\n                        this.onDrawDone({\n                            shapeType,\n                            clientID,\n                            points: [xtl, ytl, xbr, ybr],\n                        },\n                        Date.now() - this.startTimestamp);\n                    }\n                }\n            })\n            .on('undopoint', (): void => {\n                if (numberOfPoints > 0) {\n                    numberOfPoints -= 1;\n                }\n            });\n\n        this.drawPolyshape();\n    }\n\n    private drawPolyshape(): void {\n        let size = this.drawData.shapeType === 'cuboid' ? 4 : this.drawData.numberOfPoints;\n\n        const sizeDecrement = (): void => {\n            if (--size === 0) {\n                // we need additional settimeout because we cannot invoke draw('done')\n                // from event listener for drawstart event\n                // because of implementation of svg.js\n                setTimeout((): void => this.drawInstance.draw('done'));\n            }\n        };\n\n        this.drawInstance.on('drawstart', sizeDecrement);\n        this.drawInstance.on('drawpoint', sizeDecrement);\n        this.drawInstance.on('drawupdate', (): void => this.transform(this.geometry));\n        this.drawInstance.on('undopoint', (): number => size++);\n\n        // Add ability to cancel the latest drawn point\n        this.canvas.on('mousedown.draw', (e: MouseEvent): void => {\n            if (e.button === 2) {\n                e.stopPropagation();\n                e.preventDefault();\n                this.drawInstance.draw('undo');\n            }\n        });\n\n        // Add ability to draw shapes by sliding\n        // We need to remember last drawn point\n        // to implementation of slide drawing\n        const lastDrawnPoint: {\n            x: number;\n            y: number;\n        } = {\n            x: null,\n            y: null,\n        };\n\n        this.canvas.on('mousemove.draw', (e: MouseEvent): void => {\n            // TODO: Use enumeration after typification cvat-core\n            if (e.shiftKey && ['polygon', 'polyline'].includes(this.drawData.shapeType)) {\n                if (lastDrawnPoint.x === null || lastDrawnPoint.y === null) {\n                    this.drawInstance.draw('point', e);\n                } else {\n                    this.drawInstance.draw('update', e);\n                    const deltaThreshold = 15;\n                    const dx = (e.clientX - lastDrawnPoint.x) ** 2;\n                    const dy = (e.clientY - lastDrawnPoint.y) ** 2;\n                    const delta = Math.sqrt(dx + dy);\n                    if (delta > deltaThreshold) {\n                        this.drawInstance.draw('point', e);\n                    }\n                }\n\n                e.stopPropagation();\n                e.preventDefault();\n            }\n        });\n\n        // We need to scale points that have been just drawn\n        this.drawInstance.on('drawstart drawpoint', (e: CustomEvent): void => {\n            this.transform(this.geometry);\n            lastDrawnPoint.x = e.detail.event.clientX;\n            lastDrawnPoint.y = e.detail.event.clientY;\n        });\n\n        this.drawInstance.on('drawdone', (e: CustomEvent): void => {\n            const targetPoints = readPointsFromShape((e.target as any as { instance: SVG.Shape }).instance);\n            const { shapeType, redraw: clientID } = this.drawData;\n            const { points, box } = shapeType === 'cuboid' ?\n                this.getFinalCuboidCoordinates(targetPoints) :\n                this.getFinalPolyshapeCoordinates(targetPoints, true);\n            this.release();\n\n            if (this.canceled) return;\n            if (checkConstraint(shapeType, points, box)) {\n                if (shapeType === 'cuboid') {\n                    this.onDrawDone(\n                        { clientID, shapeType, points: cuboidFrom4Points(points) },\n                        Date.now() - this.startTimestamp,\n                    );\n                    return;\n                }\n\n                this.onDrawDone({ clientID, shapeType, points }, Date.now() - this.startTimestamp);\n            }\n        });\n    }\n\n    private drawPolygon(): void {\n        this.drawInstance = (this.canvas as any)\n            .polygon()\n            .addClass('cvat_canvas_shape_drawing')\n            .attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                'fill-opacity': this.selectedShapeOpacity,\n                stroke: this.outlinedBorders,\n            });\n\n        this.drawPolyshape();\n        if (this.autobordersEnabled) {\n            this.autoborderHandler.autoborder(true, this.drawInstance, this.drawData.redraw);\n        }\n    }\n\n    private drawPolyline(): void {\n        this.drawInstance = (this.canvas as any)\n            .polyline()\n            .addClass('cvat_canvas_shape_drawing')\n            .attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                'fill-opacity': 0,\n                stroke: this.outlinedBorders,\n            });\n\n        this.drawPolyshape();\n        if (this.autobordersEnabled) {\n            this.autoborderHandler.autoborder(true, this.drawInstance, this.drawData.redraw);\n        }\n    }\n\n    private drawPoints(): void {\n        this.drawInstance = (this.canvas as any).polygon().addClass('cvat_canvas_shape_drawing').attr({\n            'stroke-width': 0,\n            opacity: 0,\n        });\n\n        this.drawPolyshape();\n    }\n\n    private drawCuboidBy4Points(): void {\n        this.drawInstance = (this.canvas as any)\n            .polyline()\n            .addClass('cvat_canvas_shape_drawing')\n            .attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                stroke: this.outlinedBorders,\n            });\n        this.drawPolyshape();\n    }\n\n    private drawCuboid(): void {\n        this.drawInstance = this.canvas.rect();\n        this.drawInstance\n            .on('drawstop', (e: Event): void => {\n                const points = readPointsFromShape((e.target as any as { instance: SVG.Rect }).instance);\n                const [xtl, ytl, xbr, ybr] = this.getFinalRectCoordinates(points, true);\n                const { shapeType, redraw: clientID } = this.drawData;\n                this.release();\n\n                if (this.canceled) return;\n                if (checkConstraint('cuboid', [xtl, ytl, xbr, ybr])) {\n                    const d = { x: (xbr - xtl) * 0.1, y: (ybr - ytl) * 0.1 };\n                    this.onDrawDone({\n                        shapeType,\n                        points: cuboidFrom4Points([xtl, ybr, xbr, ybr, xbr, ytl, xbr + d.x, ytl - d.y]),\n                        clientID,\n                    },\n                    Date.now() - this.startTimestamp);\n                }\n            })\n            .on('drawupdate', (): void => {\n                this.shapeSizeElement.update(this.drawInstance);\n            })\n            .addClass('cvat_canvas_shape_drawing')\n            .attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                'fill-opacity': this.selectedShapeOpacity,\n                stroke: this.outlinedBorders,\n            });\n    }\n\n    private drawSkeleton(): void {\n        this.drawInstance = this.canvas.rect().attr({\n            stroke: this.outlinedBorders,\n        });\n        this.pointsGroup = makeSVGFromTemplate(this.drawData.skeletonSVG);\n        this.canvas.add(this.pointsGroup);\n        this.pointsGroup.attr('stroke-width', consts.BASE_STROKE_WIDTH / this.geometry.scale);\n        this.pointsGroup.attr('stroke', this.outlinedBorders);\n\n        let minX = Number.MAX_SAFE_INTEGER;\n        let minY = Number.MAX_SAFE_INTEGER;\n        let maxX = 0;\n        let maxY = 0;\n\n        this.pointsGroup.children().forEach((child: SVG.Element): void => {\n            const cx = child.cx();\n            const cy = child.cy();\n            minX = Math.min(cx, minX);\n            minY = Math.min(cy, minY);\n            maxX = Math.max(cx, maxX);\n            maxY = Math.max(cy, maxY);\n        });\n\n        this.drawInstance\n            .on('drawstop', (e: Event): void => {\n                const points = readPointsFromShape((e.target as any as { instance: SVG.Rect }).instance);\n                const [xtl, ytl, xbr, ybr] = this.getFinalRectCoordinates(points, true);\n                const elements: any[] = [];\n                Array.from(this.pointsGroup.node.children).forEach((child: Element) => {\n                    if (child.tagName === 'circle') {\n                        const cx = +(child.getAttribute('cx') as string) + xtl;\n                        const cy = +(child.getAttribute('cy') as string) + ytl;\n                        const label = +child.getAttribute('data-label-id');\n                        elements.push({\n                            shapeType: 'points',\n                            points: [cx, cy],\n                            labelID: label,\n                        });\n                    }\n                });\n\n                const { shapeType, redraw: clientID } = this.drawData;\n                this.release();\n\n                if (this.canceled) return;\n                if (checkConstraint('skeleton', [xtl, ytl, xbr, ybr])) {\n                    this.onDrawDone({\n                        clientID,\n                        shapeType,\n                        elements,\n                    },\n                    Date.now() - this.startTimestamp);\n                }\n            })\n            .on('drawupdate', (): void => {\n                const x = this.drawInstance.x();\n                const y = this.drawInstance.y();\n                const width = this.drawInstance.width();\n                const height = this.drawInstance.height();\n                this.pointsGroup.style({\n                    transform: `translate(${x}px, ${y}px)`,\n                });\n\n                /* eslint-disable-next-line no-unsanitized/property */\n                this.pointsGroup.node.innerHTML = this.drawData.skeletonSVG;\n                Array.from(this.pointsGroup.node.children).forEach((child: Element) => {\n                    const dataType = child.getAttribute('data-type');\n                    if (child.tagName === 'circle' && dataType && dataType.includes('element')) {\n                        child.setAttribute('r', `${this.controlPointsSize / this.geometry.scale}`);\n                        let cx = +(child.getAttribute('cx') as string);\n                        let cy = +(child.getAttribute('cy') as string);\n                        const cxOffset = (cx - minX) / (maxX - minX);\n                        const cyOffset = (cy - minY) / (maxY - minY);\n                        cx = Number.isNaN(cxOffset) ? 0.5 * width : cxOffset * width;\n                        cy = Number.isNaN(cyOffset) ? 0.5 * height : cyOffset * height;\n                        child.setAttribute('cx', `${cx}`);\n                        child.setAttribute('cy', `${cy}`);\n                    }\n                });\n\n                Array.from(this.pointsGroup.node.children).forEach((child: Element) => {\n                    const dataType = child.getAttribute('data-type');\n                    if (child.tagName === 'line' && dataType && dataType.includes('edge')) {\n                        child.setAttribute('stroke-width', 'inherit');\n                        child.setAttribute('stroke', 'inherit');\n                        const dataNodeFrom = child.getAttribute('data-node-from');\n                        const dataNodeTo = child.getAttribute('data-node-to');\n                        if (dataNodeFrom && dataNodeTo) {\n                            const from = this.pointsGroup.node.querySelector(`[data-node-id=\"${dataNodeFrom}\"]`);\n                            const to = this.pointsGroup.node.querySelector(`[data-node-id=\"${dataNodeTo}\"]`);\n\n                            if (from && to) {\n                                const x1 = from.getAttribute('cx');\n                                const y1 = from.getAttribute('cy');\n                                const x2 = to.getAttribute('cx');\n                                const y2 = to.getAttribute('cy');\n\n                                if (x1 && y1 && x2 && y2) {\n                                    child.setAttribute('x1', x1);\n                                    child.setAttribute('y1', y1);\n                                    child.setAttribute('x2', x2);\n                                    child.setAttribute('y2', y2);\n                                }\n                            }\n                        }\n                        let cx = +(child.getAttribute('cx') as string);\n                        let cy = +(child.getAttribute('cy') as string);\n                        const cxOffset = cx / 100;\n                        const cyOffset = cy / 100;\n                        cx = cxOffset * width;\n                        cy = cyOffset * height;\n                        child.setAttribute('cx', `${cx}`);\n                        child.setAttribute('cy', `${cy}`);\n                    }\n                });\n            })\n            .addClass('cvat_canvas_shape_drawing')\n            .attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                'fill-opacity': this.selectedShapeOpacity,\n            });\n    }\n\n    private pastePolyshape(): void {\n        this.drawInstance.on('done', (e: CustomEvent): void => {\n            const targetPoints = this.drawInstance\n                .attr('points')\n                .split(/[,\\s]/g)\n                .map((coord: string): number => +coord);\n\n            const { shapeType } = this.drawData.initialState;\n            const { points, box } = shapeType === 'cuboid' ?\n                this.getFinalCuboidCoordinates(targetPoints) :\n                this.getFinalPolyshapeCoordinates(targetPoints, true);\n\n            if (checkConstraint(shapeType, points, box)) {\n                this.onDrawDone(\n                    {\n                        shapeType,\n                        objectType: this.drawData.initialState.objectType,\n                        points,\n                        occluded: this.drawData.initialState.occluded,\n                        attributes: { ...this.drawData.initialState.attributes },\n                        label: this.drawData.initialState.label,\n                        color: this.drawData.initialState.color,\n                    },\n                    Date.now() - this.startTimestamp,\n                    e.detail.originalEvent.ctrlKey,\n                    this.drawData,\n                );\n            }\n\n            if (!e.detail.originalEvent.ctrlKey) {\n                this.release();\n            }\n        });\n    }\n\n    // Common settings for rectangle and polyshapes\n    private pasteShape(): void {\n        const moveShape = (shape: SVG.Shape, x: number, y: number): void => {\n            const { rotation } = shape.transform();\n            shape.untransform();\n            shape.center(x, y);\n            shape.rotate(rotation);\n        };\n\n        const { x: initialX, y: initialY } = this.cursorPosition;\n        moveShape(this.drawInstance, initialX, initialY);\n\n        this.canvas.on('mousemove.draw', (): void => {\n            const { x, y } = this.cursorPosition; // was computed in another callback\n            moveShape(this.drawInstance, x, y);\n        });\n    }\n\n    private pasteBox(box: BBox, rotation: number): void {\n        this.drawInstance = (this.canvas as any)\n            .rect(box.width, box.height)\n            .center(box.x, box.y)\n            .addClass('cvat_canvas_shape_drawing')\n            .attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                'fill-opacity': this.selectedShapeOpacity,\n                stroke: this.outlinedBorders,\n            }).rotate(rotation);\n        this.pasteShape();\n\n        this.drawInstance.on('done', (e: CustomEvent): void => {\n            const points = readPointsFromShape((e.target as any as { instance: SVG.Rect }).instance);\n            const [xtl, ytl, xbr, ybr] = this.getFinalRectCoordinates(points, !this.drawData.initialState.rotation);\n            if (checkConstraint('rectangle', [xtl, ytl, xbr, ybr])) {\n                this.onDrawDone(\n                    {\n                        shapeType: this.drawData.initialState.shapeType,\n                        objectType: this.drawData.initialState.objectType,\n                        points: [xtl, ytl, xbr, ybr],\n                        occluded: this.drawData.initialState.occluded,\n                        attributes: { ...this.drawData.initialState.attributes },\n                        label: this.drawData.initialState.label,\n                        color: this.drawData.initialState.color,\n                        rotation: this.drawData.initialState.rotation,\n                    },\n                    Date.now() - this.startTimestamp,\n                    e.detail.originalEvent.ctrlKey,\n                    this.drawData,\n                );\n            }\n\n            if (!e.detail.originalEvent.ctrlKey) {\n                this.release();\n            }\n        });\n    }\n\n    private pasteEllipse([cx, cy, rx, ry]: number[], rotation: number): void {\n        this.drawInstance = (this.canvas as any)\n            .ellipse(rx * 2, ry * 2)\n            .center(cx, cy)\n            .addClass('cvat_canvas_shape_drawing')\n            .attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                'fill-opacity': this.selectedShapeOpacity,\n                stroke: this.outlinedBorders,\n            }).rotate(rotation);\n        this.pasteShape();\n\n        this.drawInstance.on('done', (e: CustomEvent): void => {\n            const points = this.getFinalEllipseCoordinates(\n                readPointsFromShape((e.target as any as { instance: SVG.Ellipse }).instance), false,\n            );\n            if (checkConstraint('ellipse', points)) {\n                this.onDrawDone(\n                    {\n                        shapeType: this.drawData.initialState.shapeType,\n                        objectType: this.drawData.initialState.objectType,\n                        points,\n                        occluded: this.drawData.initialState.occluded,\n                        attributes: { ...this.drawData.initialState.attributes },\n                        label: this.drawData.initialState.label,\n                        color: this.drawData.initialState.color,\n                        rotation: this.drawData.initialState.rotation,\n                    },\n                    Date.now() - this.startTimestamp,\n                    e.detail.originalEvent.ctrlKey,\n                    this.drawData,\n                );\n            }\n\n            if (!e.detail.originalEvent.ctrlKey) {\n                this.release();\n            }\n        });\n    }\n\n    private pastePolygon(points: string): void {\n        this.drawInstance = (this.canvas as any)\n            .polygon(points)\n            .addClass('cvat_canvas_shape_drawing')\n            .attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                'fill-opacity': this.selectedShapeOpacity,\n                stroke: this.outlinedBorders,\n            });\n        this.pasteShape();\n        this.pastePolyshape();\n    }\n\n    private pastePolyline(points: string): void {\n        this.drawInstance = (this.canvas as any)\n            .polyline(points)\n            .addClass('cvat_canvas_shape_drawing')\n            .attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                stroke: this.outlinedBorders,\n            });\n        this.pasteShape();\n        this.pastePolyshape();\n    }\n\n    private pasteCuboid(points: string): void {\n        this.drawInstance = (this.canvas as any)\n            .cube(points)\n            .addClass('cvat_canvas_shape_drawing')\n            .attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                'face-stroke': this.outlinedBorders,\n                'fill-opacity': this.selectedShapeOpacity,\n                stroke: this.outlinedBorders,\n            });\n        this.pasteShape();\n        this.pastePolyshape();\n    }\n\n    private pasteSkeleton(box: BBox, elements: any[]): void {\n        const { offset } = this.geometry;\n        let [xtl, ytl] = [box.x, box.y];\n\n        this.pasteBox(box, 0);\n        this.pointsGroup = makeSVGFromTemplate(this.drawData.skeletonSVG);\n        this.pointsGroup.attr({\n            'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n            stroke: this.outlinedBorders,\n        });\n        this.canvas.add(this.pointsGroup);\n\n        this.pointsGroup.children().forEach((child: SVG.Element): void => {\n            const dataType = child.attr('data-type');\n            if (child.node.tagName === 'circle' && dataType && dataType.includes('element')) {\n                child.attr('r', `${this.controlPointsSize / this.geometry.scale}`);\n                const labelID = +child.attr('data-label-id');\n                const element = elements.find((_element: any): boolean => _element.label.id === labelID);\n                if (element) {\n                    const points = translateToCanvas(offset, element.points);\n                    child.center(points[0], points[1]);\n                }\n            }\n        });\n\n        this.drawInstance.off('done').on('done', (e: CustomEvent) => {\n            const result = {\n                shapeType: this.drawData.initialState.shapeType,\n                objectType: this.drawData.initialState.objectType,\n                elements: this.drawData.initialState.elements.map((element: any) => ({\n                    shapeType: element.shapeType,\n                    outside: element.outside,\n                    occluded: element.occluded,\n                    label: element.label,\n                    attributes: element.attributes,\n                    points: (() => {\n                        const circle = this.pointsGroup.children()\n                            .find((child: SVG.Element) => child.attr('data-label-id') === element.label.id);\n                        const points = translateFromCanvas(this.geometry.offset, [circle.cx(), circle.cy()]);\n                        return points;\n                    })(),\n                })),\n                occluded: this.drawData.initialState.occluded,\n                attributes: { ...this.drawData.initialState.attributes },\n                label: this.drawData.initialState.label,\n                color: this.drawData.initialState.color,\n                rotation: this.drawData.initialState.rotation,\n            };\n\n            this.onDrawDone(\n                result,\n                Date.now() - this.startTimestamp,\n                e.detail.originalEvent.ctrlKey,\n                this.drawData,\n            );\n\n            if (!e.detail.originalEvent.ctrlKey) {\n                this.release();\n            }\n        });\n\n        this.canvas.on('mousemove.draw', (): void => {\n            const [newXtl, newYtl] = [\n                this.drawInstance.x(), this.drawInstance.y(),\n                this.drawInstance.width(), this.drawInstance.height(),\n            ];\n            const [xDiff, yDiff] = [newXtl - xtl, newYtl - ytl];\n            xtl = newXtl;\n            ytl = newYtl;\n            this.pointsGroup.children().forEach((child: SVG.Element): void => {\n                const dataType = child.attr('data-type');\n                if (child.node.tagName === 'circle' && dataType && dataType.includes('element')) {\n                    const [cx, cy] = [child.cx(), child.cy()];\n                    child.center(cx + xDiff, cy + yDiff);\n                }\n            });\n            this.pointsGroup.untransform();\n            setupSkeletonEdges(this.pointsGroup, this.pointsGroup);\n        });\n    }\n\n    private pastePoints(initialPoints: string): void {\n        const moveShape = (shape: SVG.PolyLine, group: SVG.G, x: number, y: number, scale: number): void => {\n            const bbox = shape.bbox();\n            shape.move(x - bbox.width / 2, y - bbox.height / 2);\n\n            const points = shape.attr('points').split(' ');\n            const radius = this.controlPointsSize / scale;\n\n            group.children().forEach((child: SVG.Element, idx: number): void => {\n                const [px, py] = points[idx].split(',');\n                child.move(px - radius / 2, py - radius / 2);\n            });\n        };\n\n        const { x: initialX, y: initialY } = this.cursorPosition;\n        this.pointsGroup = this.canvas.group();\n        this.drawInstance = (this.canvas as any).polyline(initialPoints).addClass('cvat_canvas_shape_drawing').style({\n            'stroke-width': 0,\n        });\n\n        let numOfPoints = initialPoints.split(' ').length;\n        while (numOfPoints) {\n            numOfPoints--;\n            const radius = this.controlPointsSize / this.geometry.scale;\n            const stroke = consts.POINTS_STROKE_WIDTH / this.geometry.scale;\n            this.pointsGroup.circle().fill('white').stroke('black').attr({\n                r: radius,\n                'stroke-width': stroke,\n            });\n        }\n\n        moveShape(this.drawInstance, this.pointsGroup, initialX, initialY, this.geometry.scale);\n\n        this.canvas.on('mousemove.draw', (): void => {\n            const { x, y } = this.cursorPosition; // was computer in another callback\n            moveShape(this.drawInstance, this.pointsGroup, x, y, this.geometry.scale);\n        });\n\n        this.pastePolyshape();\n    }\n\n    private setupPasteEvents(): void {\n        this.canvas.on('mousedown.draw', (e: MouseEvent): void => {\n            if (e.button === 0 && !e.altKey) {\n                this.drawInstance.fire('done', { originalEvent: e });\n            }\n        });\n    }\n\n    private setupDrawEvents(): void {\n        let initialized = false;\n\n        this.canvas.on('mousedown.draw', (e: MouseEvent): void => {\n            if (e.button === 0 && !e.altKey) {\n                if (!initialized) {\n                    this.drawInstance.draw(e, { snapToGrid: 0.1 });\n                    initialized = true;\n                } else {\n                    this.drawInstance.draw(e);\n                }\n            }\n        });\n    }\n\n    private startDraw(): void {\n        // TODO: Use enums after typification cvat-core\n        if (this.drawData.initialState) {\n            const { offset } = this.geometry;\n            if (this.drawData.shapeType === 'rectangle') {\n                const [xtl, ytl, xbr, ybr] = translateToCanvas(offset, this.drawData.initialState.points);\n                this.pasteBox({\n                    x: xtl,\n                    y: ytl,\n                    width: xbr - xtl,\n                    height: ybr - ytl,\n                }, this.drawData.initialState.rotation);\n            } else if (this.drawData.shapeType === 'ellipse') {\n                const [cx, cy, rightX, topY] = translateToCanvas(offset, this.drawData.initialState.points);\n                this.pasteEllipse([cx, cy, rightX - cx, cy - topY], this.drawData.initialState.rotation);\n            } else if (this.drawData.shapeType === 'skeleton') {\n                const box = computeWrappingBox(\n                    translateToCanvas(offset, this.drawData.initialState.points), consts.SKELETON_RECT_MARGIN,\n                );\n                this.pasteSkeleton(box, this.drawData.initialState.elements);\n            } else {\n                const points = translateToCanvas(offset, this.drawData.initialState.points);\n                const stringifiedPoints = stringifyPoints(points);\n\n                if (this.drawData.shapeType === 'polygon') {\n                    this.pastePolygon(stringifiedPoints);\n                } else if (this.drawData.shapeType === 'polyline') {\n                    this.pastePolyline(stringifiedPoints);\n                } else if (this.drawData.shapeType === 'points') {\n                    this.pastePoints(stringifiedPoints);\n                } else if (this.drawData.shapeType === 'cuboid') {\n                    this.pasteCuboid(stringifiedPoints);\n                }\n            }\n            this.setupPasteEvents();\n        } else {\n            if (this.drawData.shapeType === 'rectangle') {\n                if (this.drawData.rectDrawingMethod === RectDrawingMethod.EXTREME_POINTS) {\n                    this.drawBoxBy4Points(); // draw box by extreme clicking\n                } else {\n                    this.drawBox(); // default box drawing\n                    // draw instance was initialized after drawBox();\n                    this.shapeSizeElement = displayShapeSize(this.canvas, this.text);\n                }\n            } else if (this.drawData.shapeType === 'polygon') {\n                this.drawPolygon();\n            } else if (this.drawData.shapeType === 'polyline') {\n                this.drawPolyline();\n            } else if (this.drawData.shapeType === 'points') {\n                this.drawPoints();\n            } else if (this.drawData.shapeType === 'ellipse') {\n                this.drawEllipse();\n                this.shapeSizeElement = displayShapeSize(this.canvas, this.text);\n            } else if (this.drawData.shapeType === 'cuboid') {\n                if (this.drawData.cuboidDrawingMethod === CuboidDrawingMethod.CORNER_POINTS) {\n                    this.drawCuboidBy4Points();\n                } else {\n                    this.drawCuboid();\n                    this.shapeSizeElement = displayShapeSize(this.canvas, this.text);\n                }\n            } else if (this.drawData.shapeType === 'skeleton') {\n                this.drawSkeleton();\n            }\n\n            if (this.drawData.shapeType !== 'ellipse') {\n                this.setupDrawEvents();\n            }\n        }\n\n        this.startTimestamp = Date.now();\n        this.initialized = true;\n    }\n\n    public constructor(\n        onDrawDone: (data: object | null, duration?: number, continueDraw?: boolean, prevDrawData?: DrawData) => void,\n        canvas: SVG.Container,\n        text: SVG.Container,\n        autoborderHandler: AutoborderHandler,\n        geometry: Geometry,\n        configuration: Configuration,\n    ) {\n        this.autoborderHandler = autoborderHandler;\n        this.controlPointsSize = configuration.controlPointsSize;\n        this.selectedShapeOpacity = configuration.selectedShapeOpacity;\n        this.outlinedBorders = configuration.outlinedBorders || 'black';\n        this.autobordersEnabled = false;\n        this.startTimestamp = Date.now();\n        this.onDrawDoneDefault = onDrawDone;\n        this.canvas = canvas;\n        this.text = text;\n        this.initialized = false;\n        this.canceled = false;\n        this.drawData = null;\n        this.geometry = geometry;\n        this.crosshair = new Crosshair();\n        this.drawInstance = null;\n        this.pointsGroup = null;\n        this.cursorPosition = {\n            x: 0,\n            y: 0,\n        };\n\n        this.canvas.on('mousemove.crosshair', (e: MouseEvent): void => {\n            const [x, y] = translateToSVG((this.canvas.node as any) as SVGSVGElement, [e.clientX, e.clientY]);\n            this.cursorPosition = { x, y };\n            if (this.crosshair) {\n                this.crosshair.move(x, y);\n            }\n        });\n    }\n\n    public configurate(configuration: Configuration): void {\n        this.controlPointsSize = configuration.controlPointsSize;\n        this.selectedShapeOpacity = configuration.selectedShapeOpacity;\n        this.outlinedBorders = configuration.outlinedBorders || 'black';\n\n        const isFillableRect = this.drawData &&\n            this.drawData.shapeType === 'rectangle' &&\n            (this.drawData.rectDrawingMethod === RectDrawingMethod.CLASSIC || this.drawData.initialState);\n        const isFillableCuboid = this.drawData &&\n            this.drawData.shapeType === 'cuboid' &&\n            (this.drawData.cuboidDrawingMethod === CuboidDrawingMethod.CLASSIC || this.drawData.initialState);\n        const isFilalblePolygon = this.drawData && this.drawData.shapeType === 'polygon';\n\n        if (this.drawInstance && (isFillableRect || isFillableCuboid || isFilalblePolygon)) {\n            this.drawInstance.fill({ opacity: configuration.selectedShapeOpacity });\n        }\n\n        if (this.drawInstance && this.drawInstance.attr('stroke')) {\n            this.drawInstance.attr('stroke', this.outlinedBorders);\n        }\n\n        if (this.pointsGroup && this.pointsGroup.attr('stroke')) {\n            this.pointsGroup.attr('stroke', this.outlinedBorders);\n        }\n\n        this.autobordersEnabled = configuration.autoborders;\n        if (this.drawInstance && !this.drawData.initialState) {\n            if (this.autobordersEnabled) {\n                this.autoborderHandler.autoborder(true, this.drawInstance, this.drawData.redraw);\n            } else {\n                this.autoborderHandler.autoborder(false);\n            }\n        }\n    }\n\n    public transform(geometry: Geometry): void {\n        this.geometry = geometry;\n\n        if (this.shapeSizeElement && this.drawInstance && ['rectangle', 'ellipse'].includes(this.drawData.shapeType)) {\n            this.shapeSizeElement.update(this.drawInstance);\n        }\n\n        if (this.crosshair) {\n            this.crosshair.scale(this.geometry.scale);\n        }\n\n        if (this.pointsGroup) {\n            this.pointsGroup.attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n            });\n\n            for (const point of this.pointsGroup.children()) {\n                point.attr({\n                    'stroke-width': consts.POINTS_STROKE_WIDTH / geometry.scale,\n                    r: this.controlPointsSize / geometry.scale,\n                });\n            }\n        }\n\n        if (this.drawInstance) {\n            this.drawInstance.draw('transform');\n            this.drawInstance.attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / geometry.scale,\n            });\n\n            const paintHandler = this.drawInstance.remember('_paintHandler');\n\n            for (const point of (paintHandler as any).set.members) {\n                point.attr('stroke-width', `${consts.POINTS_STROKE_WIDTH / geometry.scale}`);\n                point.attr('r', `${this.controlPointsSize / geometry.scale}`);\n            }\n        }\n    }\n\n    public draw(drawData: DrawData, geometry: Geometry): void {\n        this.geometry = geometry;\n\n        if (drawData.enabled) {\n            this.canceled = false;\n            this.drawData = drawData;\n            this.initDrawing();\n            this.startDraw();\n        } else {\n            this.release();\n            this.drawData = drawData;\n        }\n    }\n\n    public cancel(): void {\n        this.canceled = true;\n        this.release();\n    }\n}\n","// Copyright (C) 2022 CVAT.ai Corporation\n//\n// SPDX-License-Identifier: MIT\n\nimport { fabric } from 'fabric';\n\nimport {\n    DrawData, MasksEditData, Geometry, Configuration, BrushTool, ColorBy,\n} from './canvasModel';\nimport consts from './consts';\nimport { DrawHandler } from './drawHandler';\nimport {\n    PropType, computeWrappingBox, alphaChannelOnly, expandChannels, imageDataToDataURL,\n} from './shared';\n\ninterface WrappingBBox {\n    left: number;\n    top: number;\n    right: number;\n    bottom: number;\n}\n\nexport interface MasksHandler {\n    draw(drawData: DrawData): void;\n    edit(state: MasksEditData): void;\n    configurate(configuration: Configuration): void;\n    transform(geometry: Geometry): void;\n    cancel(): void;\n    enabled: boolean;\n}\n\nexport class MasksHandlerImpl implements MasksHandler {\n    private onDrawDone: (\n        data: object | null,\n        duration?: number,\n        continueDraw?: boolean,\n        prevDrawData?: DrawData,\n    ) => void;\n    private onDrawRepeat: (data: DrawData) => void;\n    private onEditStart: (state: any) => void;\n    private onEditDone: (state: any, points: number[]) => void;\n    private vectorDrawHandler: DrawHandler;\n\n    private redraw: number | null;\n    private isDrawing: boolean;\n    private isEditing: boolean;\n    private isInsertion: boolean;\n    private isMouseDown: boolean;\n    private isBrushSizeChanging: boolean;\n    private resizeBrushToolLatestX: number;\n    private brushMarker: fabric.Rect | fabric.Circle | null;\n    private drawablePolygon: null | fabric.Polygon;\n    private isPolygonDrawing: boolean;\n    private drawnObjects: (fabric.Polygon | fabric.Circle | fabric.Rect | fabric.Line | fabric.Image)[];\n\n    private tool: DrawData['brushTool'] | null;\n    private drawData: DrawData | null;\n    private canvas: fabric.Canvas;\n\n    private editData: MasksEditData | null;\n\n    private colorBy: ColorBy;\n    private latestMousePos: { x: number; y: number; };\n    private startTimestamp: number;\n    private geometry: Geometry;\n    private drawingOpacity: number;\n\n    private keepDrawnPolygon(): void {\n        const canvasWrapper = this.canvas.getElement().parentElement;\n        canvasWrapper.style.pointerEvents = '';\n        canvasWrapper.style.zIndex = '';\n        this.isPolygonDrawing = false;\n        this.vectorDrawHandler.draw({ enabled: false }, this.geometry);\n    }\n\n    private removeBrushMarker(): void {\n        if (this.brushMarker) {\n            this.canvas.remove(this.brushMarker);\n            this.brushMarker = null;\n            this.canvas.renderAll();\n        }\n    }\n\n    private setupBrushMarker(): void {\n        if (['brush', 'eraser'].includes(this.tool.type)) {\n            const common = {\n                evented: false,\n                selectable: false,\n                opacity: 0.75,\n                left: this.latestMousePos.x - this.tool.size / 2,\n                top: this.latestMousePos.y - this.tool.size / 2,\n                stroke: 'white',\n                strokeWidth: 1,\n            };\n            this.brushMarker = this.tool.form === 'circle' ? new fabric.Circle({\n                ...common,\n                radius: this.tool.size / 2,\n            }) : new fabric.Rect({\n                ...common,\n                width: this.tool.size,\n                height: this.tool.size,\n            });\n\n            this.canvas.defaultCursor = 'none';\n            this.canvas.add(this.brushMarker);\n        } else {\n            this.canvas.defaultCursor = 'inherit';\n        }\n    }\n\n    private releaseCanvasWrapperCSS(): void {\n        const canvasWrapper = this.canvas.getElement().parentElement;\n        canvasWrapper.style.pointerEvents = '';\n        canvasWrapper.style.zIndex = '';\n        canvasWrapper.style.display = '';\n    }\n\n    private releasePaste(): void {\n        this.releaseCanvasWrapperCSS();\n        this.canvas.clear();\n        this.canvas.renderAll();\n        this.isInsertion = false;\n        this.drawnObjects = [];\n        this.onDrawDone(null);\n    }\n\n    private releaseDraw(): void {\n        this.removeBrushMarker();\n        this.releaseCanvasWrapperCSS();\n        if (this.isPolygonDrawing) {\n            this.isPolygonDrawing = false;\n            this.vectorDrawHandler.cancel();\n        }\n        this.canvas.clear();\n        this.canvas.renderAll();\n        this.isDrawing = false;\n        this.isInsertion = false;\n        this.redraw = null;\n        this.drawnObjects = [];\n        this.onDrawDone(null);\n    }\n\n    private releaseEdit(): void {\n        this.removeBrushMarker();\n        this.releaseCanvasWrapperCSS();\n        if (this.isPolygonDrawing) {\n            this.isPolygonDrawing = false;\n            this.vectorDrawHandler.cancel();\n        }\n        this.canvas.clear();\n        this.canvas.renderAll();\n        this.isEditing = false;\n        this.drawnObjects = [];\n        this.onEditDone(null, null);\n    }\n\n    private getStateColor(state: any): string {\n        if (this.colorBy === ColorBy.INSTANCE) {\n            return state.color;\n        }\n\n        if (this.colorBy === ColorBy.LABEL) {\n            return state.label.color;\n        }\n\n        return state.group.color;\n    }\n\n    private getDrawnObjectsWrappingBox(): WrappingBBox {\n        type BoundingRect = ReturnType<PropType<fabric.Polygon, 'getBoundingRect'>>;\n        type TwoCornerBox = Pick<BoundingRect, 'top' | 'left'> & { right: number; bottom: number };\n        const { width, height } = this.geometry.image;\n        const wrappingBbox = this.drawnObjects\n            .map((obj) => {\n                if (obj instanceof fabric.Polygon) {\n                    const bbox = computeWrappingBox(obj.points\n                        .reduce(((acc, val) => {\n                            acc.push(val.x, val.y);\n                            return acc;\n                        }), []));\n\n                    return {\n                        left: bbox.xtl,\n                        top: bbox.ytl,\n                        width: bbox.width,\n                        height: bbox.height,\n                    };\n                }\n\n                if (obj instanceof fabric.Image) {\n                    return {\n                        left: obj.left,\n                        top: obj.top,\n                        width: obj.width,\n                        height: obj.height,\n                    };\n                }\n\n                return obj.getBoundingRect();\n            })\n            .reduce((acc: TwoCornerBox, rect: BoundingRect) => {\n                acc.top = Math.floor(Math.max(0, Math.min(rect.top, acc.top)));\n                acc.left = Math.floor(Math.max(0, Math.min(rect.left, acc.left)));\n                acc.bottom = Math.floor(Math.min(height, Math.max(rect.top + rect.height, acc.bottom)));\n                acc.right = Math.floor(Math.min(width, Math.max(rect.left + rect.width, acc.right)));\n                return acc;\n            }, {\n                left: Number.MAX_SAFE_INTEGER,\n                top: Number.MAX_SAFE_INTEGER,\n                right: Number.MIN_SAFE_INTEGER,\n                bottom: Number.MIN_SAFE_INTEGER,\n            });\n\n        return wrappingBbox;\n    }\n\n    private imageDataFromCanvas(wrappingBBox: WrappingBBox): Uint8ClampedArray {\n        const imageData = this.canvas.toCanvasElement()\n            .getContext('2d').getImageData(\n                wrappingBBox.left, wrappingBBox.top,\n                wrappingBBox.right - wrappingBBox.left + 1, wrappingBBox.bottom - wrappingBBox.top + 1,\n            ).data;\n        return imageData;\n    }\n\n    private updateBrushTools(brushTool?: BrushTool, opts: Partial<BrushTool> = {}): void {\n        if (this.isPolygonDrawing) {\n            // tool was switched from polygon to brush for example\n            this.keepDrawnPolygon();\n        }\n\n        this.removeBrushMarker();\n        if (brushTool) {\n            if (brushTool.color && this.tool?.color !== brushTool.color) {\n                const color = fabric.Color.fromHex(brushTool.color);\n                for (const object of this.drawnObjects) {\n                    if (object instanceof fabric.Line) {\n                        const alpha = +object.stroke.split(',')[3].slice(0, -1);\n                        color.setAlpha(alpha);\n                        object.set({ stroke: color.toRgba() });\n                    } else if (\n                        object instanceof fabric.Rect ||\n                        object instanceof fabric.Polygon ||\n                        object instanceof fabric.Circle\n                    ) {\n                        const alpha = +(object.fill as string).split(',')[3].slice(0, -1);\n                        color.setAlpha(alpha);\n                        (object as fabric.Object).set({ fill: color.toRgba() });\n                    }\n                }\n                this.canvas.renderAll();\n            }\n\n            this.tool = { ...brushTool, ...opts };\n            if (this.isDrawing || this.isEditing) {\n                this.setupBrushMarker();\n            }\n        }\n\n        if (this.tool?.type?.startsWith('polygon-')) {\n            this.isPolygonDrawing = true;\n            this.vectorDrawHandler.draw({\n                enabled: true,\n                shapeType: 'polygon',\n                onDrawDone: (data: { points: number[] } | null) => {\n                    if (!data) return;\n                    const points = data.points.reduce((acc: fabric.Point[], _: number, idx: number) => {\n                        if (idx % 2) {\n                            acc.push(new fabric.Point(data.points[idx - 1], data.points[idx]));\n                        }\n\n                        return acc;\n                    }, []);\n\n                    const color = fabric.Color.fromHex(this.tool.color);\n                    color.setAlpha(this.tool.type === 'polygon-minus' ? 1 : this.drawingOpacity);\n                    const polygon = new fabric.Polygon(points, {\n                        fill: color.toRgba(),\n                        selectable: false,\n                        objectCaching: false,\n                        absolutePositioned: true,\n                        globalCompositeOperation: this.tool.type === 'polygon-minus' ? 'destination-out' : 'xor',\n                    });\n\n                    this.canvas.add(polygon);\n                    this.drawnObjects.push(polygon);\n                    this.canvas.renderAll();\n                },\n            }, this.geometry);\n\n            const canvasWrapper = this.canvas.getElement().parentElement as HTMLDivElement;\n            canvasWrapper.style.pointerEvents = 'none';\n            canvasWrapper.style.zIndex = '0';\n        }\n    }\n\n    public constructor(\n        onDrawDone: (\n            data: object | null,\n            duration?: number,\n            continueDraw?: boolean,\n            prevDrawData?: DrawData,\n        ) => void,\n        onDrawRepeat: (data: DrawData) => void,\n        onEditStart: (state: any) => void,\n        onEditDone: (state: any, points: number[]) => void,\n        vectorDrawHandler: DrawHandler,\n        canvas: HTMLCanvasElement,\n    ) {\n        this.redraw = null;\n        this.isDrawing = false;\n        this.isEditing = false;\n        this.isMouseDown = false;\n        this.isBrushSizeChanging = false;\n        this.isPolygonDrawing = false;\n        this.drawData = null;\n        this.editData = null;\n        this.drawnObjects = [];\n        this.drawingOpacity = 0.5;\n        this.brushMarker = null;\n        this.colorBy = ColorBy.LABEL;\n        this.onDrawDone = onDrawDone;\n        this.onDrawRepeat = onDrawRepeat;\n        this.onEditDone = onEditDone;\n        this.onEditStart = onEditStart;\n        this.vectorDrawHandler = vectorDrawHandler;\n        this.canvas = new fabric.Canvas(canvas, {\n            containerClass: 'cvat_masks_canvas_wrapper',\n            fireRightClick: true,\n            selection: false,\n            defaultCursor: 'inherit',\n        });\n        this.canvas.imageSmoothingEnabled = false;\n\n        this.canvas.getElement().parentElement.addEventListener('contextmenu', (e: MouseEvent) => e.preventDefault());\n        this.latestMousePos = { x: -1, y: -1 };\n        window.document.addEventListener('mouseup', () => {\n            this.isMouseDown = false;\n            this.isBrushSizeChanging = false;\n        });\n\n        this.canvas.on('mouse:down', (options: fabric.IEvent<MouseEvent>) => {\n            const { isDrawing, isEditing, isInsertion } = this;\n            this.isMouseDown = (isDrawing || isEditing) && options.e.button === 0 && !options.e.altKey;\n            this.isBrushSizeChanging = (isDrawing || isEditing) && options.e.button === 2 && options.e.altKey;\n\n            if (isInsertion) {\n                const continueInserting = options.e.ctrlKey;\n                const wrappingBbox = this.getDrawnObjectsWrappingBox();\n                const imageData = this.imageDataFromCanvas(wrappingBbox);\n                const alpha = alphaChannelOnly(imageData);\n                alpha.push(wrappingBbox.left, wrappingBbox.top, wrappingBbox.right, wrappingBbox.bottom);\n\n                this.onDrawDone({\n                    shapeType: this.drawData.shapeType,\n                    points: alpha,\n                }, Date.now() - this.startTimestamp, continueInserting, this.drawData);\n\n                if (!continueInserting) {\n                    this.releasePaste();\n                }\n            } else {\n                this.canvas.fire('mouse:move', options);\n            }\n        });\n\n        this.canvas.on('mouse:move', (e: fabric.IEvent<MouseEvent>) => {\n            const { image: { width: imageWidth, height: imageHeight } } = this.geometry;\n            const { angle } = this.geometry;\n            let [x, y] = [e.pointer.x, e.pointer.y];\n            if (angle === 180) {\n                [x, y] = [imageWidth - x, imageHeight - y];\n            } else if (angle === 270) {\n                [x, y] = [imageWidth - (y / imageHeight) * imageWidth, (x / imageWidth) * imageHeight];\n            } else if (angle === 90) {\n                [x, y] = [(y / imageHeight) * imageWidth, imageHeight - (x / imageWidth) * imageHeight];\n            }\n\n            const position = { x, y };\n            const {\n                tool, isMouseDown, isInsertion, isBrushSizeChanging,\n            } = this;\n\n            if (isInsertion) {\n                const [object] = this.drawnObjects;\n                if (object && object instanceof fabric.Image) {\n                    object.left = position.x - object.width / 2;\n                    object.top = position.y - object.height / 2;\n                    this.canvas.renderAll();\n                }\n            }\n\n            if (isBrushSizeChanging && ['brush', 'eraser'].includes(tool?.type)) {\n                const xDiff = e.pointer.x - this.resizeBrushToolLatestX;\n                let onUpdateConfiguration = null;\n                if (this.isDrawing) {\n                    onUpdateConfiguration = this.drawData.onUpdateConfiguration;\n                } else if (this.isEditing) {\n                    onUpdateConfiguration = this.editData.onUpdateConfiguration;\n                }\n                if (onUpdateConfiguration) {\n                    onUpdateConfiguration({\n                        brushTool: {\n                            size: Math.trunc(Math.max(1, this.tool.size + xDiff)),\n                        },\n                    });\n                }\n\n                this.resizeBrushToolLatestX = e.pointer.x;\n                e.e.stopPropagation();\n                return;\n            }\n\n            if (this.brushMarker) {\n                this.brushMarker.left = position.x - tool.size / 2;\n                this.brushMarker.top = position.y - tool.size / 2;\n                this.canvas.bringToFront(this.brushMarker);\n                this.canvas.renderAll();\n            }\n\n            if (isMouseDown && !isBrushSizeChanging && ['brush', 'eraser'].includes(tool?.type)) {\n                const color = fabric.Color.fromHex(tool.color);\n                color.setAlpha(tool.type === 'eraser' ? 1 : 0.5);\n\n                const commonProperties = {\n                    selectable: false,\n                    evented: false,\n                    globalCompositeOperation: tool.type === 'eraser' ? 'destination-out' : 'xor',\n                };\n\n                const shapeProperties = {\n                    ...commonProperties,\n                    fill: color.toRgba(),\n                    left: position.x - tool.size / 2,\n                    top: position.y - tool.size / 2,\n                };\n\n                let shape: fabric.Circle | fabric.Rect | null = null;\n                if (tool.form === 'circle') {\n                    shape = new fabric.Circle({\n                        ...shapeProperties,\n                        radius: tool.size / 2,\n                    });\n                } else if (tool.form === 'square') {\n                    shape = new fabric.Rect({\n                        ...shapeProperties,\n                        width: tool.size,\n                        height: tool.size,\n                    });\n                }\n\n                this.canvas.add(shape);\n                if (tool.type === 'brush') {\n                    this.drawnObjects.push(shape);\n                }\n\n                // add line to smooth the mask\n                if (this.latestMousePos.x !== -1 && this.latestMousePos.y !== -1) {\n                    const dx = position.x - this.latestMousePos.x;\n                    const dy = position.y - this.latestMousePos.y;\n                    if (Math.sqrt(dx ** 2 + dy ** 2) > tool.size / 2) {\n                        const line = new fabric.Line([\n                            this.latestMousePos.x - tool.size / 2,\n                            this.latestMousePos.y - tool.size / 2,\n                            position.x - tool.size / 2,\n                            position.y - tool.size / 2,\n                        ], {\n                            ...commonProperties,\n                            stroke: color.toRgba(),\n                            strokeWidth: tool.size,\n                            strokeLineCap: tool.form === 'circle' ? 'round' : 'square',\n                        });\n\n                        this.canvas.add(line);\n                        if (tool.type === 'brush') {\n                            this.drawnObjects.push(line);\n                        }\n                    }\n                }\n                this.canvas.renderAll();\n            } else if (tool?.type.startsWith('polygon-') && this.drawablePolygon) {\n                // update the polygon position\n                const points = this.drawablePolygon.get('points');\n                if (points.length) {\n                    points[points.length - 1].setX(e.e.offsetX);\n                    points[points.length - 1].setY(e.e.offsetY);\n                }\n                this.canvas.renderAll();\n            }\n\n            this.latestMousePos.x = position.x;\n            this.latestMousePos.y = position.y;\n            this.resizeBrushToolLatestX = position.x;\n        });\n    }\n\n    public configurate(configuration: Configuration): void {\n        this.colorBy = configuration.colorBy;\n    }\n\n    public transform(geometry: Geometry): void {\n        this.geometry = geometry;\n        const {\n            scale, angle, image: { width, height }, top, left,\n        } = geometry;\n\n        const topCanvas = this.canvas.getElement().parentElement as HTMLDivElement;\n        if (this.canvas.width !== width || this.canvas.height !== height) {\n            this.canvas.setHeight(height);\n            this.canvas.setWidth(width);\n            this.canvas.setDimensions({ width, height });\n        }\n\n        topCanvas.style.top = `${top}px`;\n        topCanvas.style.left = `${left}px`;\n        topCanvas.style.transform = `scale(${scale}) rotate(${angle}deg)`;\n\n        if (this.drawablePolygon) {\n            this.drawablePolygon.set('strokeWidth', consts.BASE_STROKE_WIDTH / scale);\n            this.canvas.renderAll();\n        }\n    }\n\n    public draw(drawData: DrawData): void {\n        if (drawData.enabled && drawData.shapeType === 'mask') {\n            if (!this.isInsertion && drawData.initialState?.shapeType === 'mask') {\n                // initialize inserting pipeline if not started\n                const { points } = drawData.initialState;\n                const color = fabric.Color.fromHex(this.getStateColor(drawData.initialState)).getSource();\n                const [left, top, right, bottom] = points.slice(-4);\n                const imageBitmap = expandChannels(color[0], color[1], color[2], points, 4);\n                imageDataToDataURL(imageBitmap, right - left + 1, bottom - top + 1,\n                    (dataURL: string) => new Promise((resolve) => {\n                        fabric.Image.fromURL(dataURL, (image: fabric.Image) => {\n                            try {\n                                image.selectable = false;\n                                image.evented = false;\n                                image.globalCompositeOperation = 'xor';\n                                image.opacity = 0.5;\n                                this.canvas.add(image);\n                                this.drawnObjects.push(image);\n                                this.canvas.renderAll();\n                            } finally {\n                                resolve();\n                            }\n                        }, { left, top });\n                    }));\n\n                this.isInsertion = true;\n            } else if (!this.isDrawing) {\n                // initialize drawing pipeline if not started\n                this.isDrawing = true;\n                this.redraw = drawData.redraw || null;\n            }\n\n            this.canvas.getElement().parentElement.style.display = 'block';\n            this.startTimestamp = Date.now();\n        }\n\n        this.updateBrushTools(drawData.brushTool);\n\n        if (!drawData.enabled && this.isDrawing) {\n            try {\n                if (this.drawnObjects.length) {\n                    const wrappingBbox = this.getDrawnObjectsWrappingBox();\n                    const imageData = this.imageDataFromCanvas(wrappingBbox);\n                    const alpha = alphaChannelOnly(imageData);\n                    alpha.push(wrappingBbox.left, wrappingBbox.top, wrappingBbox.right, wrappingBbox.bottom);\n                    this.onDrawDone({\n                        shapeType: this.drawData.shapeType,\n                        points: alpha,\n                        ...(Number.isInteger(this.redraw) ? { clientID: this.redraw } : {}),\n                    }, Date.now() - this.startTimestamp, drawData.continue, this.drawData);\n                }\n            } finally {\n                this.releaseDraw();\n            }\n\n            if (drawData.continue) {\n                const newDrawData = {\n                    ...this.drawData,\n                    brushTool: { ...this.tool },\n                    ...drawData,\n                    enabled: true,\n                    shapeType: 'mask',\n                };\n                this.onDrawRepeat(newDrawData);\n                return;\n            }\n        }\n\n        this.drawData = drawData;\n    }\n\n    public edit(editData: MasksEditData): void {\n        if (editData.enabled && editData.state.shapeType === 'mask') {\n            if (!this.isEditing) {\n                // start editing pipeline if not started yet\n                this.canvas.getElement().parentElement.style.display = 'block';\n                const { points } = editData.state;\n                const color = fabric.Color.fromHex(this.getStateColor(editData.state)).getSource();\n                const [left, top, right, bottom] = points.slice(-4);\n                const imageBitmap = expandChannels(color[0], color[1], color[2], points, 4);\n                imageDataToDataURL(imageBitmap, right - left + 1, bottom - top + 1,\n                    (dataURL: string) => new Promise((resolve) => {\n                        fabric.Image.fromURL(dataURL, (image: fabric.Image) => {\n                            try {\n                                image.selectable = false;\n                                image.evented = false;\n                                image.globalCompositeOperation = 'xor';\n                                image.opacity = 0.5;\n                                this.canvas.add(image);\n                                this.drawnObjects.push(image);\n                                this.canvas.renderAll();\n                            } finally {\n                                resolve();\n                            }\n                        }, { left, top });\n                    }));\n\n                this.isEditing = true;\n                this.startTimestamp = Date.now();\n                this.onEditStart(editData.state);\n            }\n        }\n\n        this.updateBrushTools(\n            editData.brushTool,\n            editData.state ? { color: this.getStateColor(editData.state) } : {},\n        );\n\n        if (!editData.enabled && this.isEditing) {\n            try {\n                if (this.drawnObjects.length) {\n                    const wrappingBbox = this.getDrawnObjectsWrappingBox();\n                    const imageData = this.imageDataFromCanvas(wrappingBbox);\n                    const alpha = alphaChannelOnly(imageData);\n                    alpha.push(wrappingBbox.left, wrappingBbox.top, wrappingBbox.right, wrappingBbox.bottom);\n                    this.onEditDone(this.editData.state, alpha);\n                }\n            } finally {\n                this.releaseEdit();\n            }\n        }\n        this.editData = editData;\n    }\n\n    get enabled(): boolean {\n        return this.isDrawing || this.isEditing || this.isInsertion;\n    }\n\n    public cancel(): void {\n        if (this.isDrawing || this.isInsertion) {\n            this.releaseDraw();\n        }\n\n        if (this.isEditing) {\n            this.releaseEdit();\n        }\n    }\n}\n","// Copyright (C) 2019-2022 Intel Corporation\n// Copyright (C) 2022 CVAT.ai Corporation\n//\n// SPDX-License-Identifier: MIT\n\nimport * as SVG from 'svg.js';\nimport 'svg.select.js';\n\nimport consts from './consts';\nimport { translateFromSVG, pointsToNumberArray } from './shared';\nimport { PolyEditData, Geometry, Configuration } from './canvasModel';\nimport { AutoborderHandler } from './autoborderHandler';\n\nexport interface EditHandler {\n    edit(editData: PolyEditData): void;\n    transform(geometry: Geometry): void;\n    configurate(configuration: Configuration): void;\n    cancel(): void;\n}\n\nexport class EditHandlerImpl implements EditHandler {\n    private onEditDone: (state: any, points: number[]) => void;\n    private autoborderHandler: AutoborderHandler;\n    private geometry: Geometry | null;\n    private canvas: SVG.Container;\n    private editData: PolyEditData | null;\n    private editedShape: SVG.Shape | null;\n    private editLine: SVG.PolyLine | null;\n    private clones: SVG.Polygon[];\n    private controlPointsSize: number;\n    private autobordersEnabled: boolean;\n    private intelligentCutEnabled: boolean;\n    private outlinedBorders: string;\n\n    private setupTrailingPoint(circle: SVG.Circle): void {\n        const head = this.editedShape.attr('points').split(' ').slice(0, this.editData.pointID).join(' ');\n        circle.on('mouseenter', (): void => {\n            circle.attr({\n                'stroke-width': consts.POINTS_SELECTED_STROKE_WIDTH / this.geometry.scale,\n            });\n        });\n\n        circle.on('mouseleave', (): void => {\n            circle.attr({\n                'stroke-width': consts.POINTS_STROKE_WIDTH / this.geometry.scale,\n            });\n        });\n\n        const minimumPoints = 2;\n        circle.on('mousedown', (e: MouseEvent): void => {\n            if (e.button !== 0) return;\n            const { offset } = this.geometry;\n            const stringifiedPoints = `${head} ${this.editLine.node.getAttribute('points').slice(0, -2)}`;\n            const points = pointsToNumberArray(stringifiedPoints)\n                .slice(0, -2)\n                .map((coord: number): number => coord - offset);\n\n            if (points.length >= minimumPoints * 2) {\n                const { state } = this.editData;\n                this.edit({\n                    enabled: false,\n                });\n                this.onEditDone(state, points);\n            }\n        });\n    }\n\n    private startEdit(): void {\n        // get started coordinates\n        const [clientX, clientY] = translateFromSVG(\n            (this.canvas.node as any) as SVGSVGElement,\n            this.editedShape.attr('points').split(' ')[this.editData.pointID].split(','),\n        );\n\n        // generate mouse event\n        const dummyEvent = new MouseEvent('mousedown', {\n            bubbles: true,\n            cancelable: true,\n            clientX,\n            clientY,\n        });\n\n        // Add ability to edit shapes by sliding\n        // We need to remember last drawn point\n        // to implementation of slide drawing\n        const lastDrawnPoint: {\n            x: number;\n            y: number;\n        } = {\n            x: null,\n            y: null,\n        };\n\n        this.canvas.on('mousemove.edit', (e: MouseEvent): void => {\n            if (e.shiftKey && ['polygon', 'polyline'].includes(this.editData.state.shapeType)) {\n                if (lastDrawnPoint.x === null || lastDrawnPoint.y === null) {\n                    (this.editLine as any).draw('point', e);\n                } else {\n                    const deltaThreshold = 15;\n                    const dxsqr = (e.clientX - lastDrawnPoint.x) ** 2;\n                    const dysqr = (e.clientY - lastDrawnPoint.y) ** 2;\n                    const delta = Math.sqrt(dxsqr + dysqr);\n                    if (delta > deltaThreshold) {\n                        (this.editLine as any).draw('point', e);\n                    }\n                }\n            }\n        });\n\n        this.editLine = (this.canvas as any).polyline();\n        if (this.editData.state.shapeType === 'polyline') {\n            (this.editLine as any).on('drawupdate', (e: CustomEvent): void => {\n                const circle = (e.target as any).instance.remember('_paintHandler').set.last();\n                if (circle) this.setupTrailingPoint(circle);\n            });\n        }\n\n        (this.editLine as any)\n            .addClass('cvat_canvas_shape_drawing')\n            .style({\n                'pointer-events': 'none',\n                'fill-opacity': 0,\n            })\n            .attr({\n                'data-origin-client-id': this.editData.state.clientID,\n                stroke: this.editedShape.attr('stroke'),\n            })\n            .on('drawstart drawpoint', (e: CustomEvent): void => {\n                this.transform(this.geometry);\n                lastDrawnPoint.x = e.detail.event.clientX;\n                lastDrawnPoint.y = e.detail.event.clientY;\n            })\n            .on('drawupdate', (): void => this.transform(this.geometry))\n            .draw(dummyEvent, { snapToGrid: 0.1 });\n\n        if (this.editData.state.shapeType === 'points') {\n            this.editLine.attr('stroke-width', 0);\n            (this.editLine as any).draw('undo');\n        }\n\n        this.setupEditEvents();\n        if (this.autobordersEnabled) {\n            this.autoborderHandler.autoborder(true, this.editLine, this.editData.state.clientID);\n        }\n    }\n\n    private setupEditEvents(): void {\n        this.canvas.on('mousedown.edit', (e: MouseEvent): void => {\n            if (e.button === 0 && !e.altKey) {\n                (this.editLine as any).draw('point', e);\n            } else if (e.button === 2 && this.editLine) {\n                if (this.editData.state.shapeType === 'points' || this.editLine.attr('points').split(' ').length > 2) {\n                    (this.editLine as any).draw('undo');\n                }\n            }\n        });\n    }\n\n    private selectPolygon(shape: SVG.Polygon): void {\n        const { offset } = this.geometry;\n        const points = pointsToNumberArray(shape.attr('points')).map((coord: number): number => coord - offset);\n\n        const { state } = this.editData;\n        this.edit({\n            enabled: false,\n        });\n        this.onEditDone(state, points);\n    }\n\n    private stopEdit(e: MouseEvent): void {\n        if (!this.editLine) {\n            return;\n        }\n\n        // Get stop point and all points\n        const stopPointID = Array.prototype.indexOf.call((e.target as HTMLElement).parentElement.children, e.target);\n        const oldPoints = this.editedShape.attr('points').trim().split(' ');\n        const linePoints = this.editLine.attr('points').trim().split(' ');\n\n        if (this.editLine.attr('points') === '0,0') {\n            this.cancel();\n            return;\n        }\n\n        // Compute new point array\n        const [start, stop] = [this.editData.pointID, stopPointID].sort((a, b): number => +a - +b);\n\n        if (this.editData.state.shapeType !== 'polygon') {\n            let points = null;\n            const { offset } = this.geometry;\n\n            if (this.editData.state.shapeType === 'polyline') {\n                if (start !== this.editData.pointID) {\n                    linePoints.reverse();\n                }\n                points = oldPoints\n                    .slice(0, start)\n                    .concat(linePoints)\n                    .concat(oldPoints.slice(stop + 1));\n            } else {\n                points = oldPoints.concat(linePoints.slice(0, -1));\n            }\n\n            points = pointsToNumberArray(points.join(' ')).map((coord: number): number => coord - offset);\n\n            const { state } = this.editData;\n            this.edit({\n                enabled: false,\n            });\n            this.onEditDone(state, points);\n\n            return;\n        }\n\n        const cutIndexes1 = oldPoints.reduce(\n            (acc: number[], _: string, i: number): number[] => (i >= stop || i <= start ? [...acc, i] : acc),\n            [],\n        );\n        const cutIndexes2 = oldPoints.reduce(\n            (acc: number[], _: string, i: number): number[] => (i <= stop && i >= start ? [...acc, i] : acc),\n            [],\n        );\n\n        const curveLength = (indexes: number[]): number => {\n            const points = indexes\n                .map((index: number): string => oldPoints[index])\n                .map((point: string): string[] => point.split(','))\n                .map((point: string[]): number[] => [+point[0], +point[1]]);\n            let length = 0;\n            for (let i = 1; i < points.length; i++) {\n                const dxsqr = (points[i][0] - points[i - 1][0]) ** 2;\n                const dysqr = (points[i][1] - points[i - 1][1]) ** 2;\n                length += Math.sqrt(dxsqr + dysqr);\n            }\n\n            return length;\n        };\n\n        const pointsCriteria = cutIndexes1.length > cutIndexes2.length;\n        const lengthCriteria = curveLength(cutIndexes1) > curveLength(cutIndexes2);\n\n        if (start !== this.editData.pointID) {\n            linePoints.reverse();\n        }\n\n        const firstPart = oldPoints\n            .slice(0, start)\n            .concat(linePoints)\n            .concat(oldPoints.slice(stop + 1));\n        const secondPart = oldPoints.slice(start, stop).concat(linePoints.slice(1).reverse());\n\n        if (firstPart.length < 3 || secondPart.length < 3) {\n            this.cancel();\n            return;\n        }\n\n        // We do not need these events any more\n        this.canvas.off('mousedown.edit');\n        this.canvas.off('mousemove.edit');\n\n        (this.editLine as any).draw('stop');\n        this.editLine.remove();\n        this.editLine = null;\n\n        if (pointsCriteria && lengthCriteria && this.intelligentCutEnabled) {\n            this.clones.push(this.canvas.polygon(firstPart.join(' ')));\n            this.selectPolygon(this.clones[0]);\n            // left indexes1 and\n        } else if (!pointsCriteria && !lengthCriteria && this.intelligentCutEnabled) {\n            this.clones.push(this.canvas.polygon(secondPart.join(' ')));\n            this.selectPolygon(this.clones[0]);\n        } else {\n            for (const points of [firstPart, secondPart]) {\n                this.clones.push(\n                    this.canvas\n                        .polygon(points.join(' '))\n                        .attr('fill', this.editedShape.attr('fill'))\n                        .attr('fill-opacity', '0.5')\n                        .addClass('cvat_canvas_shape'),\n                );\n            }\n\n            for (const clone of this.clones) {\n                clone.on('click', (): void => this.selectPolygon(clone));\n                clone\n                    .on('mouseenter', (): void => {\n                        clone.addClass('cvat_canvas_shape_splitting');\n                    })\n                    .on('mouseleave', (): void => {\n                        clone.removeClass('cvat_canvas_shape_splitting');\n                    });\n            }\n        }\n    }\n\n    private setupPoints(enabled: boolean): void {\n        const stopEdit = this.stopEdit.bind(this);\n        const getGeometry = (): Geometry => this.geometry;\n        const fill = this.editedShape.attr('fill') || 'inherit';\n\n        if (enabled) {\n            (this.editedShape as any).selectize(true, {\n                deepSelect: true,\n                pointSize: (2 * this.controlPointsSize) / getGeometry().scale,\n                rotationPoint: false,\n                pointType(cx: number, cy: number): SVG.Circle {\n                    const circle: SVG.Circle = this.nested\n                        .circle(this.options.pointSize)\n                        .stroke('black')\n                        .fill(fill)\n                        .center(cx, cy)\n                        .attr({\n                            'stroke-width': consts.POINTS_STROKE_WIDTH / getGeometry().scale,\n                        });\n\n                    circle.node.addEventListener('mouseenter', (): void => {\n                        circle.attr({\n                            'stroke-width': consts.POINTS_SELECTED_STROKE_WIDTH / getGeometry().scale,\n                        });\n\n                        circle.node.addEventListener('click', stopEdit);\n                        circle.addClass('cvat_canvas_selected_point');\n                    });\n\n                    circle.node.addEventListener('mouseleave', (): void => {\n                        circle.attr({\n                            'stroke-width': consts.POINTS_STROKE_WIDTH / getGeometry().scale,\n                        });\n\n                        circle.node.removeEventListener('click', stopEdit);\n                        circle.removeClass('cvat_canvas_selected_point');\n                    });\n\n                    return circle;\n                },\n            });\n        } else {\n            (this.editedShape as any).selectize(false, {\n                deepSelect: true,\n            });\n        }\n    }\n\n    private release(): void {\n        this.canvas.off('mousedown.edit');\n        this.canvas.off('mousemove.edit');\n        this.autoborderHandler.autoborder(false);\n\n        if (this.editedShape) {\n            this.setupPoints(false);\n            this.editedShape.remove();\n            this.editedShape = null;\n        }\n\n        if (this.editLine) {\n            (this.editLine as any).draw('stop');\n            this.editLine.remove();\n            this.editLine = null;\n        }\n\n        if (this.clones.length) {\n            for (const clone of this.clones) {\n                clone.remove();\n            }\n            this.clones = [];\n        }\n    }\n\n    private initEditing(): void {\n        this.editedShape = this.canvas\n            .select(`#cvat_canvas_shape_${this.editData.state.clientID}`).first()\n            .clone().attr('stroke', this.outlinedBorders);\n        this.setupPoints(true);\n        this.startEdit();\n        // draw points for this with selected and start editing till another point is clicked\n        // click one of two parts to remove (in case of polygon only)\n\n        // else we can start draw polyline\n        // after we have got shape and points, we are waiting for second point pressed on this shape\n    }\n\n    private closeEditing(): void {\n        this.release();\n    }\n\n    public constructor(\n        onEditDone: (state: any, points: number[]) => void,\n        canvas: SVG.Container,\n        autoborderHandler: AutoborderHandler,\n    ) {\n        this.autoborderHandler = autoborderHandler;\n        this.autobordersEnabled = false;\n        this.intelligentCutEnabled = false;\n        this.controlPointsSize = consts.BASE_POINT_SIZE;\n        this.outlinedBorders = 'black';\n        this.onEditDone = onEditDone;\n        this.canvas = canvas;\n        this.editData = null;\n        this.editedShape = null;\n        this.editLine = null;\n        this.geometry = null;\n        this.clones = [];\n    }\n\n    public edit(editData: any): void {\n        if (editData.enabled) {\n            if (editData.state.shapeType !== 'rectangle') {\n                this.editData = editData;\n                this.initEditing();\n            } else {\n                this.cancel();\n            }\n        } else {\n            this.closeEditing();\n            this.editData = editData;\n        }\n    }\n\n    public cancel(): void {\n        this.release();\n        this.onEditDone(null, null);\n    }\n\n    public configurate(configuration: Configuration): void {\n        this.autobordersEnabled = configuration.autoborders;\n        this.outlinedBorders = configuration.outlinedBorders || 'black';\n\n        if (this.editedShape) {\n            this.editedShape.attr('stroke', this.outlinedBorders);\n        }\n\n        if (this.editLine) {\n            this.editLine.attr('stroke', this.outlinedBorders);\n            if (this.autobordersEnabled) {\n                this.autoborderHandler.autoborder(true, this.editLine, this.editData.state.clientID);\n            } else {\n                this.autoborderHandler.autoborder(false);\n            }\n        }\n        this.controlPointsSize = configuration.controlPointsSize || consts.BASE_POINT_SIZE;\n        this.intelligentCutEnabled = configuration.intelligentPolygonCrop;\n    }\n\n    public transform(geometry: Geometry): void {\n        this.geometry = geometry;\n\n        if (this.editedShape) {\n            this.editedShape.attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / geometry.scale,\n            });\n        }\n\n        if (this.editLine) {\n            (this.editLine as any).draw('transform');\n            if (this.editData.state.shapeType !== 'points') {\n                this.editLine.attr({\n                    'stroke-width': consts.BASE_STROKE_WIDTH / geometry.scale,\n                });\n            }\n\n            const paintHandler = this.editLine.remember('_paintHandler');\n\n            for (const point of (paintHandler as any).set.members) {\n                point.attr('stroke-width', `${consts.POINTS_STROKE_WIDTH / geometry.scale}`);\n                point.attr('r', `${this.controlPointsSize / geometry.scale}`);\n            }\n        }\n    }\n}\n","// Copyright (C) 2019-2022 Intel Corporation\n//\n// SPDX-License-Identifier: MIT\n\nimport * as SVG from 'svg.js';\nimport { MergeData } from './canvasModel';\n\nexport interface MergeHandler {\n    merge(mergeData: MergeData): void;\n    select(state: any): void;\n    cancel(): void;\n    repeatSelection(): void;\n}\n\nexport class MergeHandlerImpl implements MergeHandler {\n    // callback is used to notify about merging end\n    private onMergeDone: (objects: any[] | null, duration?: number) => void;\n    private onFindObject: (event: MouseEvent) => void;\n    private startTimestamp: number;\n    private canvas: SVG.Container;\n    private initialized: boolean;\n    private statesToBeMerged: any[]; // are being merged\n    private highlightedShapes: Record<number, SVG.Shape>;\n    private constraints: {\n        labelID: number;\n        shapeType: string;\n    } | null;\n\n    private addConstraints(): void {\n        const shape = this.statesToBeMerged[0];\n        this.constraints = {\n            labelID: shape.label.id,\n            shapeType: shape.shapeType,\n        };\n    }\n\n    private removeConstraints(): void {\n        this.constraints = null;\n    }\n\n    private checkConstraints(state: any): boolean {\n        return (\n            !this.constraints ||\n            (state.label.id === this.constraints.labelID && state.shapeType === this.constraints.shapeType)\n        );\n    }\n\n    private release(): void {\n        this.removeConstraints();\n        this.canvas.node.removeEventListener('click', this.onFindObject);\n        for (const state of this.statesToBeMerged) {\n            const shape = this.highlightedShapes[state.clientID];\n            shape.removeClass('cvat_canvas_shape_merging');\n        }\n        this.statesToBeMerged = [];\n        this.highlightedShapes = {};\n        this.initialized = false;\n    }\n\n    private initMerging(): void {\n        this.canvas.node.addEventListener('click', this.onFindObject);\n        this.startTimestamp = Date.now();\n        this.initialized = true;\n    }\n\n    private closeMerging(): void {\n        if (this.initialized) {\n            const { statesToBeMerged } = this;\n            this.release();\n\n            if (statesToBeMerged.length > 1) {\n                this.onMergeDone(statesToBeMerged, Date.now() - this.startTimestamp);\n            } else {\n                this.onMergeDone(null);\n                // here is a cycle\n                // onMergeDone => controller => model => view => closeMerging\n                // one call of closeMerging is unuseful, but it's okey\n            }\n        }\n    }\n\n    public constructor(\n        onMergeDone: (objects: any[] | null, duration?: number) => void,\n        onFindObject: (event: MouseEvent) => void,\n        canvas: SVG.Container,\n    ) {\n        this.onMergeDone = onMergeDone;\n        this.onFindObject = onFindObject;\n        this.startTimestamp = Date.now();\n        this.canvas = canvas;\n        this.statesToBeMerged = [];\n        this.highlightedShapes = {};\n        this.constraints = null;\n        this.initialized = false;\n    }\n\n    public merge(mergeData: MergeData): void {\n        if (mergeData.enabled) {\n            this.initMerging();\n        } else {\n            this.closeMerging();\n        }\n    }\n\n    public select(objectState: any): void {\n        if (objectState.shapeType === 'mask') {\n            // masks can not be merged\n            return;\n        }\n        const stateIndexes = this.statesToBeMerged.map((state): number => state.clientID);\n        const stateFrames = this.statesToBeMerged.map((state): number => state.frame);\n        const includes = stateIndexes.indexOf(objectState.clientID);\n        if (includes !== -1) {\n            const shape = this.highlightedShapes[objectState.clientID];\n            this.statesToBeMerged.splice(includes, 1);\n            if (shape) {\n                delete this.highlightedShapes[objectState.clientID];\n                shape.removeClass('cvat_canvas_shape_merging');\n            }\n\n            if (!this.statesToBeMerged.length) {\n                this.removeConstraints();\n            }\n        } else {\n            const shape = this.canvas.select(`#cvat_canvas_shape_${objectState.clientID}`).first();\n            if (shape && this.checkConstraints(objectState) && !stateFrames.includes(objectState.frame)) {\n                this.statesToBeMerged.push(objectState);\n                this.highlightedShapes[objectState.clientID] = shape;\n                shape.addClass('cvat_canvas_shape_merging');\n\n                if (this.statesToBeMerged.length === 1) {\n                    this.addConstraints();\n                }\n            }\n        }\n    }\n\n    public repeatSelection(): void {\n        for (const objectState of this.statesToBeMerged) {\n            const shape = this.canvas.select(`#cvat_canvas_shape_${objectState.clientID}`).first();\n            if (shape) {\n                this.highlightedShapes[objectState.clientID] = shape;\n                shape.addClass('cvat_canvas_shape_merging');\n            }\n        }\n    }\n\n    public cancel(): void {\n        this.release();\n        this.onMergeDone(null);\n        // here is a cycle\n        // onMergeDone => controller => model => view => closeMerging\n        // one call of closeMerging is unuseful, but it's okey\n    }\n}\n","// Copyright (C) 2019-2022 Intel Corporation\n//\n// SPDX-License-Identifier: MIT\n\nimport * as SVG from 'svg.js';\nimport { SplitData } from './canvasModel';\n\nexport interface SplitHandler {\n    split(splitData: SplitData): void;\n    select(state: any): void;\n    cancel(): void;\n}\n\nexport class SplitHandlerImpl implements SplitHandler {\n    // callback is used to notify about splitting end\n    private onSplitDone: (object: any) => void;\n    private onFindObject: (event: MouseEvent) => void;\n    private canvas: SVG.Container;\n    private highlightedShape: SVG.Shape | null;\n    private initialized: boolean;\n    private splitDone: boolean;\n\n    private resetShape(): void {\n        if (this.highlightedShape) {\n            this.highlightedShape.removeClass('cvat_canvas_shape_splitting');\n            this.highlightedShape.off('click.split');\n            this.highlightedShape = null;\n        }\n    }\n\n    private release(): void {\n        if (this.initialized) {\n            this.resetShape();\n            this.canvas.node.removeEventListener('mousemove', this.findObject);\n            this.initialized = false;\n        }\n    }\n\n    private initSplitting(): void {\n        this.canvas.node.addEventListener('mousemove', this.findObject);\n        this.initialized = true;\n        this.splitDone = false;\n    }\n\n    private closeSplitting(): void {\n        // Split done is true if an object was split\n        // Split also can be called with { enabled: false } without splitting an object\n        if (!this.splitDone) {\n            this.onSplitDone(null);\n        }\n        this.release();\n    }\n\n    private findObject = (e: MouseEvent): void => {\n        this.resetShape();\n        this.onFindObject(e);\n    };\n\n    public constructor(\n        onSplitDone: (object: any) => void,\n        onFindObject: (event: MouseEvent) => void,\n        canvas: SVG.Container,\n    ) {\n        this.onSplitDone = onSplitDone;\n        this.onFindObject = onFindObject;\n        this.canvas = canvas;\n        this.highlightedShape = null;\n        this.initialized = false;\n        this.splitDone = false;\n    }\n\n    public split(splitData: SplitData): void {\n        if (splitData.enabled) {\n            this.initSplitting();\n        } else {\n            this.closeSplitting();\n        }\n    }\n\n    public select(state: any): void {\n        if (state.objectType === 'track') {\n            const shape = this.canvas.select(`#cvat_canvas_shape_${state.clientID}`).first();\n            if (shape && shape !== this.highlightedShape) {\n                this.resetShape();\n                this.highlightedShape = shape;\n                this.highlightedShape.addClass('cvat_canvas_shape_splitting');\n                this.canvas.node.append(this.highlightedShape.node);\n                this.highlightedShape.on(\n                    'click.split',\n                    (): void => {\n                        this.splitDone = true;\n                        this.onSplitDone(state);\n                    },\n                    {\n                        once: true,\n                    },\n                );\n            }\n        }\n    }\n\n    public cancel(): void {\n        this.release();\n        this.onSplitDone(null);\n        // here is a cycle\n        // onSplitDone => controller => model => view => closeSplitting\n        // one call of closeMerging is unuseful, but it's okey\n    }\n}\n","// Copyright (C) 2019-2022 Intel Corporation\n// Copyright (C) 2022 CVAT.ai Corporation\n//\n// SPDX-License-Identifier: MIT\n\nimport * as SVG from 'svg.js';\nimport { GroupData } from './canvasModel';\nimport { expandChannels, imageDataToDataURL, translateToSVG } from './shared';\n\nexport interface GroupHandler {\n    group(groupData: GroupData): void;\n    select(state: any): void;\n    cancel(): void;\n    resetSelectedObjects(): void;\n}\n\nexport class GroupHandlerImpl implements GroupHandler {\n    // callback is used to notify about grouping end\n    private onGroupDone: (objects?: any[]) => void;\n    private getStates: () => any[];\n    private onFindObject: (event: MouseEvent) => void;\n    private bindedOnSelectStart: (event: MouseEvent) => void;\n    private bindedOnSelectUpdate: (event: MouseEvent) => void;\n    private bindedOnSelectStop: (event: MouseEvent) => void;\n    private selectionRect: SVG.Rect | null;\n    private startSelectionPoint: {\n        x: number;\n        y: number;\n    };\n    private canvas: SVG.Container;\n    private initialized: boolean;\n    private statesToBeGroupped: any[];\n    private highlightedShapes: Record<number, SVG.Shape>;\n    private groupingCopies: Record<number, SVG.Image>;\n\n    private getSelectionBox(\n        event: MouseEvent,\n    ): {\n            xtl: number;\n            ytl: number;\n            xbr: number;\n            ybr: number;\n        } {\n        const point = translateToSVG((this.canvas.node as any) as SVGSVGElement, [event.clientX, event.clientY]);\n        const stopSelectionPoint = {\n            x: point[0],\n            y: point[1],\n        };\n\n        return {\n            xtl: Math.min(this.startSelectionPoint.x, stopSelectionPoint.x),\n            ytl: Math.min(this.startSelectionPoint.y, stopSelectionPoint.y),\n            xbr: Math.max(this.startSelectionPoint.x, stopSelectionPoint.x),\n            ybr: Math.max(this.startSelectionPoint.y, stopSelectionPoint.y),\n        };\n    }\n\n    private onSelectStart(event: MouseEvent): void {\n        if (!this.selectionRect) {\n            const point = translateToSVG((this.canvas.node as any) as SVGSVGElement, [event.clientX, event.clientY]);\n            this.startSelectionPoint = {\n                x: point[0],\n                y: point[1],\n            };\n\n            this.selectionRect = this.canvas.rect().addClass('cvat_canvas_shape_grouping');\n            this.selectionRect.attr({ ...this.startSelectionPoint });\n        }\n    }\n\n    private onSelectUpdate(event: MouseEvent): void {\n        // called on mousemove\n        if (this.selectionRect) {\n            const box = this.getSelectionBox(event);\n\n            this.selectionRect.attr({\n                x: box.xtl,\n                y: box.ytl,\n                width: box.xbr - box.xtl,\n                height: box.ybr - box.ytl,\n            });\n        }\n    }\n\n    private onSelectStop(event: MouseEvent): void {\n        // called on mouseup, mouseleave\n        if (this.selectionRect) {\n            this.selectionRect.remove();\n            this.selectionRect = null;\n\n            const box = this.getSelectionBox(event);\n            const shapes = (this.canvas.select('.cvat_canvas_shape') as any).members.filter(\n                (shape: SVG.Shape): boolean => !shape.hasClass('cvat_canvas_hidden'),\n            );\n            for (const shape of shapes) {\n                // TODO: Doesn't work properly for groups\n                const bbox = shape.bbox();\n                const clientID = shape.attr('clientID');\n                if (\n                    bbox.x > box.xtl &&\n                    bbox.y > box.ytl &&\n                    bbox.x + bbox.width < box.xbr &&\n                    bbox.y + bbox.height < box.ybr &&\n                    !(clientID in this.highlightedShapes)\n                ) {\n                    const objectState = this.getStates().filter(\n                        (state: any): boolean => state.clientID === clientID,\n                    )[0];\n\n                    this.appendToSelection(objectState);\n                }\n            }\n        }\n    }\n\n    private release(): void {\n        this.canvas.node.removeEventListener('click', this.onFindObject);\n        this.canvas.node.removeEventListener('mousedown', this.bindedOnSelectStart);\n        this.canvas.node.removeEventListener('mousemove', this.bindedOnSelectUpdate);\n        this.canvas.node.removeEventListener('mouseup', this.bindedOnSelectStop);\n\n        this.resetSelectedObjects();\n        this.initialized = false;\n        this.startSelectionPoint = {\n            x: null,\n            y: null,\n        };\n    }\n\n    private initGrouping(): void {\n        this.canvas.node.addEventListener('click', this.onFindObject);\n        this.canvas.node.addEventListener('mousedown', this.bindedOnSelectStart);\n        this.canvas.node.addEventListener('mousemove', this.bindedOnSelectUpdate);\n        this.canvas.node.addEventListener('mouseup', this.bindedOnSelectStop);\n\n        this.initialized = true;\n    }\n\n    private closeGrouping(): void {\n        if (this.initialized) {\n            const { statesToBeGroupped } = this;\n            this.release();\n\n            if (statesToBeGroupped.length) {\n                this.onGroupDone(statesToBeGroupped);\n            } else {\n                this.onGroupDone();\n            }\n        }\n    }\n\n    public constructor(\n        onGroupDone: (objects?: any[]) => void,\n        getStates: () => any[],\n        onFindObject: (event: MouseEvent) => void,\n        canvas: SVG.Container,\n    ) {\n        this.onGroupDone = onGroupDone;\n        this.getStates = getStates;\n        this.onFindObject = onFindObject;\n        this.canvas = canvas;\n        this.statesToBeGroupped = [];\n        this.highlightedShapes = {};\n        this.groupingCopies = {};\n        this.selectionRect = null;\n        this.initialized = false;\n        this.startSelectionPoint = {\n            x: null,\n            y: null,\n        };\n\n        this.bindedOnSelectStart = this.onSelectStart.bind(this);\n        this.bindedOnSelectUpdate = this.onSelectUpdate.bind(this);\n        this.bindedOnSelectStop = this.onSelectStop.bind(this);\n    }\n\n    /* eslint-disable-next-line */\n    public group(groupData: GroupData): void {\n        if (groupData.enabled) {\n            this.initGrouping();\n        } else {\n            this.closeGrouping();\n        }\n    }\n\n    private appendToSelection(objectState: any): void {\n        const { clientID } = objectState;\n\n        const shape = this.canvas.select(`#cvat_canvas_shape_${clientID}`).first();\n        if (shape) {\n            if (objectState.shapeType === 'mask') {\n                const { points } = objectState;\n                const colorRGB = [139, 0, 139];\n                const [left, top, right, bottom] = points.slice(-4);\n                const imageBitmap = expandChannels(colorRGB[0], colorRGB[1], colorRGB[2], points, 4);\n\n                const bbox = shape.bbox();\n                const image = this.canvas.image().attr({\n                    'color-rendering': 'optimizeQuality',\n                    'shape-rendering': 'geometricprecision',\n                    'data-z-order': Number.MAX_SAFE_INTEGER,\n                    'grouping-copy-for': clientID,\n                }).move(bbox.x, bbox.y);\n                this.groupingCopies[clientID] = image;\n\n                imageDataToDataURL(\n                    imageBitmap,\n                    right - left + 1,\n                    bottom - top + 1,\n                    (dataURL: string) => new Promise((resolve, reject) => {\n                        image.loaded(() => {\n                            resolve();\n                        });\n                        image.error(() => {\n                            reject();\n                        });\n                        image.load(dataURL);\n                    }),\n                );\n            }\n\n            this.statesToBeGroupped.push(objectState);\n            this.highlightedShapes[clientID] = shape;\n            shape.addClass('cvat_canvas_shape_grouping');\n        }\n    }\n\n    public select(objectState: any): void {\n        const stateIndexes = this.statesToBeGroupped.map((state): number => state.clientID);\n        const { clientID } = objectState;\n        const includes = stateIndexes.indexOf(clientID);\n        if (includes !== -1) {\n            const shape = this.highlightedShapes[clientID];\n            this.statesToBeGroupped.splice(includes, 1);\n            if (shape) {\n                if (this.groupingCopies[clientID]) {\n                    // remove clones for masks\n                    this.groupingCopies[clientID].remove();\n                    delete this.groupingCopies[clientID];\n                }\n\n                delete this.highlightedShapes[clientID];\n                shape.removeClass('cvat_canvas_shape_grouping');\n            }\n        } else {\n            this.appendToSelection(objectState);\n        }\n    }\n\n    public resetSelectedObjects(): void {\n        for (const state of this.statesToBeGroupped) {\n            const shape = this.highlightedShapes[state.clientID];\n            shape.removeClass('cvat_canvas_shape_grouping');\n        }\n\n        for (const shape of Object.values(this.groupingCopies)) {\n            shape.remove();\n        }\n\n        this.statesToBeGroupped = [];\n        this.highlightedShapes = {};\n        this.groupingCopies = {};\n        if (this.selectionRect) {\n            this.selectionRect.remove();\n            this.selectionRect = null;\n        }\n    }\n\n    public cancel(): void {\n        this.release();\n        this.onGroupDone();\n    }\n}\n","// Copyright (C) 2020-2022 Intel Corporation\n//\n// SPDX-License-Identifier: MIT\n\nimport * as SVG from 'svg.js';\n\nimport consts from './consts';\nimport { translateToSVG } from './shared';\nimport { Geometry } from './canvasModel';\n\nexport interface RegionSelector {\n    select(enabled: boolean): void;\n    cancel(): void;\n    transform(geometry: Geometry): void;\n}\n\nexport class RegionSelectorImpl implements RegionSelector {\n    private onRegionSelected: (points?: number[]) => void;\n    private geometry: Geometry;\n    private canvas: SVG.Container;\n    private selectionRect: SVG.Rect | null;\n    private startSelectionPoint: {\n        x: number;\n        y: number;\n    };\n\n    private getSelectionBox(event: MouseEvent): { xtl: number; ytl: number; xbr: number; ybr: number } {\n        const point = translateToSVG((this.canvas.node as any) as SVGSVGElement, [event.clientX, event.clientY]);\n        const stopSelectionPoint = {\n            x: point[0],\n            y: point[1],\n        };\n\n        return {\n            xtl: Math.min(this.startSelectionPoint.x, stopSelectionPoint.x),\n            ytl: Math.min(this.startSelectionPoint.y, stopSelectionPoint.y),\n            xbr: Math.max(this.startSelectionPoint.x, stopSelectionPoint.x),\n            ybr: Math.max(this.startSelectionPoint.y, stopSelectionPoint.y),\n        };\n    }\n\n    private onMouseMove = (event: MouseEvent): void => {\n        if (this.selectionRect) {\n            const box = this.getSelectionBox(event);\n\n            this.selectionRect.attr({\n                x: box.xtl,\n                y: box.ytl,\n                width: box.xbr - box.xtl,\n                height: box.ybr - box.ytl,\n            });\n        }\n    };\n\n    private onMouseDown = (event: MouseEvent): void => {\n        if (!this.selectionRect && !event.altKey) {\n            const point = translateToSVG((this.canvas.node as any) as SVGSVGElement, [event.clientX, event.clientY]);\n            this.startSelectionPoint = {\n                x: point[0],\n                y: point[1],\n            };\n\n            this.selectionRect = this.canvas\n                .rect()\n                .attr({\n                    'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                })\n                .addClass('cvat_canvas_shape_region_selection');\n            this.selectionRect.attr({ ...this.startSelectionPoint, width: 1, height: 1 });\n        }\n    };\n\n    private onMouseUp = (): void => {\n        const { offset } = this.geometry;\n        if (this.selectionRect) {\n            const {\n                w, h, x, y, x2, y2,\n            } = this.selectionRect.bbox();\n            this.selectionRect.remove();\n            this.selectionRect = null;\n            if (w <= 1 && h <= 1) {\n                this.onRegionSelected([x - offset, y - offset]);\n            } else {\n                this.onRegionSelected([x - offset, y - offset, x2 - offset, y2 - offset]);\n            }\n        }\n    };\n\n    private startSelection(): void {\n        this.canvas.node.addEventListener('mousemove', this.onMouseMove);\n        this.canvas.node.addEventListener('mousedown', this.onMouseDown);\n        this.canvas.node.addEventListener('mouseup', this.onMouseUp);\n    }\n\n    private stopSelection(): void {\n        this.canvas.node.removeEventListener('mousemove', this.onMouseMove);\n        this.canvas.node.removeEventListener('mousedown', this.onMouseDown);\n        this.canvas.node.removeEventListener('mouseup', this.onMouseUp);\n    }\n\n    private release(): void {\n        this.stopSelection();\n    }\n\n    public constructor(onRegionSelected: (points?: number[]) => void, canvas: SVG.Container, geometry: Geometry) {\n        this.onRegionSelected = onRegionSelected;\n        this.geometry = geometry;\n        this.canvas = canvas;\n        this.selectionRect = null;\n    }\n\n    public select(enabled: boolean): void {\n        if (enabled) {\n            this.startSelection();\n        } else {\n            this.release();\n        }\n    }\n\n    public cancel(): void {\n        this.release();\n        this.onRegionSelected();\n    }\n\n    public transform(geometry: Geometry): void {\n        this.geometry = geometry;\n        if (this.selectionRect) {\n            this.selectionRect.attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / geometry.scale,\n            });\n        }\n    }\n}\n","// Copyright (C) 2019-2022 Intel Corporation\n//\n// SPDX-License-Identifier: MIT\n\nimport * as SVG from 'svg.js';\nimport consts from './consts';\n\nimport { translateToSVG } from './shared';\n\nimport { Geometry } from './canvasModel';\n\nexport interface ZoomHandler {\n    zoom(): void;\n    cancel(): void;\n    transform(geometry: Geometry): void;\n}\n\nexport class ZoomHandlerImpl implements ZoomHandler {\n    private onZoomRegion: (x: number, y: number, width: number, height: number) => void;\n    private bindedOnSelectStart: (event: MouseEvent) => void;\n    private bindedOnSelectUpdate: (event: MouseEvent) => void;\n    private bindedOnSelectStop: (event: MouseEvent) => void;\n    private geometry: Geometry;\n    private canvas: SVG.Container;\n    private selectionRect: SVG.Rect | null;\n    private startSelectionPoint: {\n        x: number;\n        y: number;\n    };\n\n    private onSelectStart(event: MouseEvent): void {\n        if (!this.selectionRect && event.which === 1) {\n            const point = translateToSVG((this.canvas.node as any) as SVGSVGElement, [event.clientX, event.clientY]);\n            this.startSelectionPoint = {\n                x: point[0],\n                y: point[1],\n            };\n\n            this.selectionRect = this.canvas.rect().addClass('cvat_canvas_zoom_selection');\n            this.selectionRect.attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                ...this.startSelectionPoint,\n            });\n        }\n    }\n\n    private getSelectionBox(\n        event: MouseEvent,\n    ): {\n            x: number;\n            y: number;\n            width: number;\n            height: number;\n        } {\n        const point = translateToSVG((this.canvas.node as any) as SVGSVGElement, [event.clientX, event.clientY]);\n        const stopSelectionPoint = {\n            x: point[0],\n            y: point[1],\n        };\n\n        const xtl = Math.min(this.startSelectionPoint.x, stopSelectionPoint.x);\n        const ytl = Math.min(this.startSelectionPoint.y, stopSelectionPoint.y);\n        const xbr = Math.max(this.startSelectionPoint.x, stopSelectionPoint.x);\n        const ybr = Math.max(this.startSelectionPoint.y, stopSelectionPoint.y);\n\n        return {\n            x: xtl,\n            y: ytl,\n            width: xbr - xtl,\n            height: ybr - ytl,\n        };\n    }\n\n    private onSelectUpdate(event: MouseEvent): void {\n        if (this.selectionRect) {\n            this.selectionRect.attr({\n                ...this.getSelectionBox(event),\n            });\n        }\n    }\n\n    private onSelectStop(event: MouseEvent): void {\n        if (this.selectionRect) {\n            const box = this.getSelectionBox(event);\n            this.selectionRect.remove();\n            this.selectionRect = null;\n            this.startSelectionPoint = {\n                x: 0,\n                y: 0,\n            };\n            const threshold = 5;\n            if (box.width > threshold && box.height > threshold) {\n                this.onZoomRegion(box.x, box.y, box.width, box.height);\n            }\n        }\n    }\n\n    public constructor(\n        onZoomRegion: (x: number, y: number, width: number, height: number) => void,\n        canvas: SVG.Container,\n        geometry: Geometry,\n    ) {\n        this.onZoomRegion = onZoomRegion;\n        this.canvas = canvas;\n        this.geometry = geometry;\n        this.selectionRect = null;\n        this.startSelectionPoint = {\n            x: 0,\n            y: 0,\n        };\n        this.bindedOnSelectStart = this.onSelectStart.bind(this);\n        this.bindedOnSelectUpdate = this.onSelectUpdate.bind(this);\n        this.bindedOnSelectStop = this.onSelectStop.bind(this);\n    }\n\n    public zoom(): void {\n        this.canvas.node.addEventListener('mousedown', this.bindedOnSelectStart);\n        this.canvas.node.addEventListener('mousemove', this.bindedOnSelectUpdate);\n        this.canvas.node.addEventListener('mouseup', this.bindedOnSelectStop);\n    }\n\n    public cancel(): void {\n        this.canvas.node.removeEventListener('mousedown', this.bindedOnSelectStart);\n        this.canvas.node.removeEventListener('mousemove', this.bindedOnSelectUpdate);\n        this.canvas.node.removeEventListener('mouseup ', this.bindedOnSelectStop);\n    }\n\n    public transform(geometry: Geometry): void {\n        this.geometry = geometry;\n        if (this.selectionRect) {\n            this.selectionRect.style({\n                'stroke-width': consts.BASE_STROKE_WIDTH / geometry.scale,\n            });\n        }\n    }\n}\n","// Copyright (C) 2020-2022 Intel Corporation\n// Copyright (C) 2023 CVAT.ai Corporation\n//\n// SPDX-License-Identifier: MIT\n\nimport * as SVG from 'svg.js';\nimport consts from './consts';\nimport Crosshair from './crosshair';\nimport {\n    translateToSVG, PropType, stringifyPoints, translateToCanvas, expandChannels, imageDataToDataURL,\n} from './shared';\n\nimport {\n    InteractionData, InteractionResult, Geometry, Configuration,\n} from './canvasModel';\n\nexport interface InteractionHandler {\n    transform(geometry: Geometry): void;\n    interact(interactData: InteractionData): void;\n    configurate(config: Configuration): void;\n    destroy(): void;\n    cancel(): void;\n}\n\nexport class InteractionHandlerImpl implements InteractionHandler {\n    private onInteraction: (shapes: InteractionResult[] | null, shapesUpdated?: boolean, isDone?: boolean) => void;\n    private geometry: Geometry;\n    private canvas: SVG.Container;\n    private interactionData: InteractionData;\n    private cursorPosition: { x: number; y: number };\n    private shapesWereUpdated: boolean;\n    private interactionShapes: SVG.Shape[];\n    private currentInteractionShape: SVG.Shape | null;\n    private crosshair: Crosshair;\n    private threshold: SVG.Rect | null;\n    private thresholdRectSize: number;\n    private intermediateShape: PropType<InteractionData, 'intermediateShape'>;\n    private drawnIntermediateShape: SVG.Shape;\n    private thresholdWasModified: boolean;\n    private controlPointsSize: number;\n    private selectedShapeOpacity: number;\n\n    private prepareResult(): InteractionResult[] {\n        return this.interactionShapes.map(\n            (shape: SVG.Shape): InteractionResult => {\n                if (shape.type === 'circle') {\n                    const points = [(shape as SVG.Circle).cx(), (shape as SVG.Circle).cy()];\n                    return {\n                        points: points.map((coord: number): number => coord - this.geometry.offset),\n                        shapeType: 'points',\n                        button: shape.attr('stroke') === 'green' ? 0 : 2,\n                    };\n                }\n\n                const bbox = ((shape.node as any) as SVGRectElement).getBBox();\n                const points = [bbox.x, bbox.y, bbox.x + bbox.width, bbox.y + bbox.height];\n                return {\n                    points: points.map((coord: number): number => coord - this.geometry.offset),\n                    shapeType: 'rectangle',\n                    button: 0,\n                };\n            },\n        );\n    }\n\n    private shouldRaiseEvent(ctrlKey: boolean): boolean {\n        const { interactionData, interactionShapes, shapesWereUpdated } = this;\n        const { minPosVertices, minNegVertices, enabled } = interactionData;\n\n        const positiveShapes = interactionShapes.filter(\n            (shape: SVG.Shape): boolean => (shape as any).attr('stroke') === 'green',\n        );\n        const negativeShapes = interactionShapes.filter(\n            (shape: SVG.Shape): boolean => (shape as any).attr('stroke') !== 'green',\n        );\n\n        if (interactionData.shapeType === 'rectangle') {\n            return enabled && !ctrlKey && !!interactionShapes.length;\n        }\n\n        const minPosVerticesDefined = Number.isInteger(minPosVertices);\n        const minNegVerticesDefined = Number.isInteger(minNegVertices) && minNegVertices >= 0;\n        const minPosVerticesAchieved = !minPosVerticesDefined || minPosVertices <= positiveShapes.length;\n        const minNegVerticesAchieved = !minNegVerticesDefined || minNegVertices <= negativeShapes.length;\n        const minimumVerticesAchieved = minPosVerticesAchieved && minNegVerticesAchieved;\n        return enabled && !ctrlKey && minimumVerticesAchieved && shapesWereUpdated;\n    }\n\n    private addThreshold(): void {\n        const { x, y } = this.cursorPosition;\n        this.threshold = this.canvas\n            .rect(this.thresholdRectSize, this.thresholdRectSize)\n            .fill('none')\n            .addClass('cvat_canvas_threshold');\n        this.threshold.center(x, y);\n    }\n\n    private addCrosshair(): void {\n        const { x, y } = this.cursorPosition;\n        this.crosshair.show(this.canvas, x, y, this.geometry.scale);\n    }\n\n    private removeCrosshair(): void {\n        this.crosshair.hide();\n    }\n\n    private interactPoints(): void {\n        const eventListener = (e: MouseEvent): void => {\n            if ((e.button === 0 || (e.button === 2 && this.interactionData.minNegVertices >= 0)) && !e.altKey) {\n                e.preventDefault();\n                const [cx, cy] = translateToSVG((this.canvas.node as any) as SVGSVGElement, [e.clientX, e.clientY]);\n                if (!this.isWithinFrame(cx, cy)) return;\n                if (!this.isWithinThreshold(cx, cy)) return;\n\n                this.currentInteractionShape = this.canvas\n                    .circle((this.controlPointsSize * 2) / this.geometry.scale)\n                    .center(cx, cy)\n                    .fill('white')\n                    .stroke(e.button === 0 ? 'green' : 'red')\n                    .addClass('cvat_interaction_point')\n                    .attr({\n                        'stroke-width': consts.POINTS_STROKE_WIDTH / this.geometry.scale,\n                    });\n\n                this.interactionShapes.push(this.currentInteractionShape);\n                this.shapesWereUpdated = true;\n                if (this.shouldRaiseEvent(e.ctrlKey)) {\n                    this.onInteraction(this.prepareResult(), true, false);\n                }\n\n                const self = this.currentInteractionShape;\n                self.on('mouseenter', (): void => {\n                    if (this.interactionData.allowRemoveOnlyLast) {\n                        if (this.interactionShapes.indexOf(self) !== this.interactionShapes.length - 1) {\n                            return;\n                        }\n                    }\n\n                    self.addClass('cvat_canvas_removable_interaction_point');\n                    self.attr({\n                        'stroke-width': consts.POINTS_SELECTED_STROKE_WIDTH / this.geometry.scale,\n                        r: (this.controlPointsSize * 1.5) / this.geometry.scale,\n                    });\n\n                    self.on('mousedown', (_e: MouseEvent): void => {\n                        _e.preventDefault();\n                        _e.stopPropagation();\n                        self.remove();\n                        this.shapesWereUpdated = true;\n                        this.interactionShapes = this.interactionShapes.filter(\n                            (shape: SVG.Shape): boolean => shape !== self,\n                        );\n                        if (this.interactionData.startWithBox && this.interactionShapes.length === 1) {\n                            this.interactionShapes[0].style({ visibility: '' });\n                        }\n                        const shouldRaiseEvent = this.shouldRaiseEvent(_e.ctrlKey);\n                        if (shouldRaiseEvent) {\n                            this.onInteraction(this.prepareResult(), true, false);\n                        }\n                    });\n                });\n\n                self.on('mouseleave', (): void => {\n                    self.removeClass('cvat_canvas_removable_interaction_point');\n                    self.attr({\n                        'stroke-width': consts.POINTS_STROKE_WIDTH / this.geometry.scale,\n                        r: this.controlPointsSize / this.geometry.scale,\n                    });\n\n                    self.off('mousedown');\n                });\n            }\n        };\n\n        // clear this listener in release()\n        this.canvas.on('mousedown.interaction', eventListener);\n    }\n\n    private interactRectangle(shouldFinish: boolean, onContinue?: () => void): void {\n        let initialized = false;\n        const eventListener = (e: MouseEvent): void => {\n            if (e.button === 0 && !e.altKey) {\n                if (!initialized) {\n                    (this.currentInteractionShape as any).draw(e, { snapToGrid: 0.1 });\n                    initialized = true;\n                } else {\n                    (this.currentInteractionShape as any).draw(e);\n                }\n            }\n        };\n\n        this.currentInteractionShape = this.canvas.rect();\n        this.canvas.on('mousedown.interaction', eventListener);\n        this.currentInteractionShape\n            .on('drawstop', (): void => {\n                this.canvas.off('mousedown.interaction', eventListener);\n                this.interactionShapes.push(this.currentInteractionShape);\n                this.shapesWereUpdated = true;\n\n                if (shouldFinish) {\n                    this.interact({ enabled: false });\n                } else if (onContinue) {\n                    onContinue();\n                }\n            })\n            .addClass('cvat_canvas_shape_drawing')\n            .attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n            })\n            .fill({ opacity: this.selectedShapeOpacity, color: 'white' });\n    }\n\n    private initInteraction(): void {\n        if (this.interactionData.crosshair) {\n            this.addCrosshair();\n        } else if (this.crosshair) {\n            this.removeCrosshair();\n        }\n        if (this.interactionData.enableThreshold) {\n            this.addThreshold();\n        } else if (this.threshold) {\n            this.threshold.remove();\n            this.threshold = null;\n        }\n    }\n\n    private startInteraction(): void {\n        if (this.interactionData.shapeType === 'rectangle') {\n            this.interactRectangle(true);\n        } else if (this.interactionData.shapeType === 'points') {\n            if (this.interactionData.startWithBox) {\n                this.interactRectangle(false, (): void => this.interactPoints());\n            } else {\n                this.interactPoints();\n            }\n        } else {\n            throw new Error('Interactor implementation supports only rectangle and points');\n        }\n    }\n\n    private release(): void {\n        if (this.drawnIntermediateShape) {\n            this.selectize(false, this.drawnIntermediateShape);\n            this.drawnIntermediateShape.remove();\n            this.drawnIntermediateShape = null;\n        }\n\n        if (this.crosshair) {\n            this.removeCrosshair();\n        }\n\n        if (this.threshold) {\n            this.threshold.remove();\n            this.threshold = null;\n        }\n\n        this.canvas.off('mousedown.interaction');\n        this.interactionShapes.forEach((shape: SVG.Shape): SVG.Shape => shape.remove());\n        this.interactionShapes = [];\n        if (this.currentInteractionShape) {\n            this.currentInteractionShape.remove();\n            this.currentInteractionShape = null;\n        }\n    }\n\n    private isWithinThreshold(x: number, y: number): boolean {\n        const [prev] = this.interactionShapes.slice(-1);\n        if (!this.interactionData.enableThreshold || !prev) {\n            return true;\n        }\n\n        const [prevCx, prevCy] = [(prev as SVG.Circle).cx(), (prev as SVG.Circle).cy()];\n        const xDiff = Math.abs(prevCx - x);\n        const yDiff = Math.abs(prevCy - y);\n\n        return xDiff < this.thresholdRectSize / 2 && yDiff < this.thresholdRectSize / 2;\n    }\n\n    private isWithinFrame(x: number, y: number): boolean {\n        const { offset, image } = this.geometry;\n        const { width, height } = image;\n        const [imageX, imageY] = [Math.round(x - offset), Math.round(y - offset)];\n        return imageX >= 0 && imageX < width && imageY >= 0 && imageY < height;\n    }\n\n    private updateIntermediateShape(): void {\n        const { intermediateShape, geometry } = this;\n        if (this.drawnIntermediateShape) {\n            this.selectize(false, this.drawnIntermediateShape);\n            this.drawnIntermediateShape.remove();\n        }\n\n        if (!intermediateShape) return;\n        const { shapeType, points } = intermediateShape;\n        if (shapeType === 'polygon') {\n            const erroredShape = shapeType === 'polygon' && points.length < 3 * 2;\n            this.drawnIntermediateShape = this.canvas\n                .polygon(stringifyPoints(translateToCanvas(geometry.offset, points)))\n                .attr({\n                    'color-rendering': 'optimizeQuality',\n                    'shape-rendering': 'geometricprecision',\n                    'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                    stroke: erroredShape ? 'red' : 'black',\n                })\n                .fill({ opacity: this.selectedShapeOpacity, color: 'white' })\n                .addClass('cvat_canvas_interact_intermediate_shape');\n            this.selectize(true, this.drawnIntermediateShape, erroredShape);\n        } else if (shapeType === 'mask') {\n            const [left, top, right, bottom] = points.slice(-4);\n            const imageBitmap = expandChannels(255, 255, 255, points, 4);\n\n            const image = this.canvas.image().attr({\n                'color-rendering': 'optimizeQuality',\n                'shape-rendering': 'geometricprecision',\n                'pointer-events': 'none',\n                opacity: 0.5,\n            }).addClass('cvat_canvas_interact_intermediate_shape');\n            image.move(this.geometry.offset + left, this.geometry.offset + top);\n            this.drawnIntermediateShape = image;\n\n            imageDataToDataURL(\n                imageBitmap,\n                right - left + 1,\n                bottom - top + 1,\n                (dataURL: string) => new Promise((resolve, reject) => {\n                    image.loaded(() => {\n                        resolve();\n                    });\n                    image.error(() => {\n                        reject();\n                    });\n                    image.load(dataURL);\n                }),\n            );\n        } else {\n            throw new Error(\n                `Shape type \"${shapeType}\" was not implemented at interactionHandler::updateIntermediateShape`,\n            );\n        }\n    }\n\n    private selectize(value: boolean, shape: SVG.Element, erroredShape = false): void {\n        // eslint-disable-next-line @typescript-eslint/no-this-alias\n        const self = this;\n\n        if (value) {\n            (shape as any).selectize(value, {\n                deepSelect: true,\n                pointSize: this.controlPointsSize / self.geometry.scale,\n                rotationPoint: false,\n                classPoints: 'cvat_canvas_interact_intermediate_shape_point',\n                pointType(cx: number, cy: number): SVG.Circle {\n                    return this.nested\n                        .circle(this.options.pointSize)\n                        .stroke(erroredShape ? 'red' : 'black')\n                        .fill('black')\n                        .center(cx, cy)\n                        .attr({\n                            'fill-opacity': 1,\n                            'stroke-width': consts.POINTS_STROKE_WIDTH / self.geometry.scale,\n                        });\n                },\n            });\n        } else {\n            (shape as any).selectize(false, {\n                deepSelect: true,\n            });\n        }\n\n        const handler = shape.remember('_selectHandler');\n        if (handler && handler.nested) {\n            handler.nested.fill(shape.attr('fill'));\n            // move green circle group(anchors) and polygon(lastChild) to the top of svg to make anchors hoverable\n            handler.parent.node.prepend(handler.nested.node);\n            handler.parent.node.prepend(handler.parent.node.lastChild);\n        }\n    }\n\n    private visualComponentsChanged(interactionData: InteractionData): boolean {\n        const allowedKeys = ['enabled', 'crosshair', 'enableThreshold', 'onChangeToolsBlockerState'];\n        if (Object.keys(interactionData).every((key: string): boolean => allowedKeys.includes(key))) {\n            if (this.interactionData.enableThreshold !== undefined && interactionData.enableThreshold !== undefined &&\n                this.interactionData.enableThreshold !== interactionData.enableThreshold) {\n                return true;\n            }\n            if (this.interactionData.crosshair !== undefined && interactionData.crosshair !== undefined &&\n                this.interactionData.crosshair !== interactionData.crosshair) {\n                return true;\n            }\n        }\n        return false;\n    }\n\n    private onKeyUp = (e: KeyboardEvent): void => {\n        if (this.interactionData.enabled && e.keyCode === 17) {\n            if (this.interactionData.onChangeToolsBlockerState && !this.thresholdWasModified) {\n                this.interactionData.onChangeToolsBlockerState('keyup');\n            }\n            if (this.shouldRaiseEvent(false)) {\n                // 17 is ctrl\n                this.onInteraction(this.prepareResult(), true, false);\n            }\n        }\n    };\n\n    private onKeyDown = (e: KeyboardEvent): void => {\n        if (!e.repeat && this.interactionData.enabled && e.keyCode === 17) {\n            if (this.interactionData.onChangeToolsBlockerState && !this.thresholdWasModified) {\n                this.interactionData.onChangeToolsBlockerState('keydown');\n            }\n            this.thresholdWasModified = false;\n        }\n    };\n\n    public constructor(\n        onInteraction: (\n            shapes: InteractionResult[] | null,\n            shapesUpdated?: boolean,\n            isDone?: boolean,\n            threshold?: number,\n        ) => void,\n        canvas: SVG.Container,\n        geometry: Geometry,\n        configuration: Configuration,\n    ) {\n        this.onInteraction = (shapes: InteractionResult[] | null, shapesUpdated?: boolean, isDone?: boolean): void => {\n            this.shapesWereUpdated = false;\n            onInteraction(shapes, shapesUpdated, isDone, this.threshold ? this.thresholdRectSize / 2 : null);\n        };\n        this.canvas = canvas;\n        this.geometry = geometry;\n        this.shapesWereUpdated = false;\n        this.interactionShapes = [];\n        this.interactionData = { enabled: false };\n        this.currentInteractionShape = null;\n        this.crosshair = new Crosshair();\n        this.threshold = null;\n        this.thresholdRectSize = 300;\n        this.intermediateShape = null;\n        this.drawnIntermediateShape = null;\n        this.controlPointsSize = configuration.controlPointsSize;\n        this.selectedShapeOpacity = configuration.selectedShapeOpacity;\n        this.cursorPosition = {\n            x: 0,\n            y: 0,\n        };\n\n        this.canvas.on('mousemove.interaction', (e: MouseEvent): void => {\n            const [x, y] = translateToSVG((this.canvas.node as any) as SVGSVGElement, [e.clientX, e.clientY]);\n            this.cursorPosition = { x, y };\n            if (this.crosshair) {\n                this.crosshair.move(x, y);\n            }\n            if (this.threshold) {\n                this.threshold.center(x, y);\n            }\n            if (this.interactionData.enableSliding && this.interactionShapes.length) {\n                if (this.isWithinFrame(x, y)) {\n                    if (this.interactionData.enableThreshold && !this.isWithinThreshold(x, y)) return;\n                    this.onInteraction(\n                        [\n                            ...this.prepareResult(),\n                            {\n                                points: [x - this.geometry.offset, y - this.geometry.offset],\n                                shapeType: 'points',\n                                button: 0,\n                            },\n                        ],\n                        true,\n                        false,\n                    );\n                }\n            }\n        });\n\n        this.canvas.on('wheel.interaction', (e: WheelEvent): void => {\n            if (e.ctrlKey) {\n                if (this.threshold) {\n                    this.thresholdWasModified = true;\n                    const { x, y } = this.cursorPosition;\n                    e.preventDefault();\n                    if (e.deltaY > 0) {\n                        this.thresholdRectSize *= 6 / 5;\n                    } else {\n                        this.thresholdRectSize *= 5 / 6;\n                    }\n                    this.threshold.size(this.thresholdRectSize, this.thresholdRectSize);\n                    this.threshold.center(x, y);\n                }\n            }\n        });\n\n        window.document.addEventListener('keyup', this.onKeyUp);\n        window.document.addEventListener('keydown', this.onKeyDown);\n    }\n\n    public transform(geometry: Geometry): void {\n        this.geometry = geometry;\n\n        if (this.crosshair) {\n            this.crosshair.scale(this.geometry.scale);\n        }\n\n        const shapesToBeScaled = this.currentInteractionShape ?\n            [...this.interactionShapes, this.currentInteractionShape] :\n            [...this.interactionShapes];\n        for (const shape of shapesToBeScaled) {\n            if (shape.type === 'circle') {\n                if (shape.hasClass('cvat_canvas_removable_interaction_point')) {\n                    (shape as SVG.Circle).radius((this.controlPointsSize * 1.5) / this.geometry.scale);\n                    shape.attr('stroke-width', consts.POINTS_SELECTED_STROKE_WIDTH / this.geometry.scale);\n                } else {\n                    (shape as SVG.Circle).radius(this.controlPointsSize / this.geometry.scale);\n                    shape.attr('stroke-width', consts.POINTS_STROKE_WIDTH / this.geometry.scale);\n                }\n            } else {\n                shape.attr('stroke-width', consts.BASE_STROKE_WIDTH / this.geometry.scale);\n            }\n        }\n\n        for (const element of window.document.getElementsByClassName('cvat_canvas_interact_intermediate_shape_point')) {\n            element.setAttribute('stroke-width', `${consts.POINTS_STROKE_WIDTH / (2 * this.geometry.scale)}`);\n            element.setAttribute('r', `${this.controlPointsSize / this.geometry.scale}`);\n        }\n\n        if (this.drawnIntermediateShape) {\n            this.drawnIntermediateShape.stroke({ width: consts.BASE_STROKE_WIDTH / this.geometry.scale });\n        }\n    }\n\n    public interact(interactionData: InteractionData): void {\n        if (interactionData.intermediateShape) {\n            this.intermediateShape = interactionData.intermediateShape;\n            this.updateIntermediateShape();\n            if (this.interactionData.startWithBox) {\n                this.interactionShapes[0].style({ visibility: 'hidden' });\n            }\n        } else if (interactionData.enabled && this.visualComponentsChanged(interactionData)) {\n            this.interactionData = { ...this.interactionData, ...interactionData };\n            this.initInteraction();\n        } else if (interactionData.enabled) {\n            this.interactionData = interactionData;\n            this.initInteraction();\n            this.startInteraction();\n        } else {\n            this.onInteraction(this.prepareResult(), this.shouldRaiseEvent(false), true);\n            this.release();\n            this.interactionData = interactionData;\n        }\n    }\n\n    public configurate(configuration: Configuration): void {\n        this.controlPointsSize = configuration.controlPointsSize;\n        this.selectedShapeOpacity = configuration.selectedShapeOpacity;\n\n        if (this.drawnIntermediateShape) {\n            this.drawnIntermediateShape.fill({\n                opacity: configuration.selectedShapeOpacity,\n            });\n        }\n\n        // when interactRectangle\n        if (this.currentInteractionShape && this.currentInteractionShape.type === 'rect') {\n            this.currentInteractionShape.fill({ opacity: configuration.selectedShapeOpacity });\n        }\n\n        // when interactPoints with startwithbbox\n        if (this.interactionShapes[0] && this.interactionShapes[0].type === 'rect') {\n            this.interactionShapes[0].fill({ opacity: configuration.selectedShapeOpacity });\n        }\n    }\n\n    public cancel(): void {\n        this.release();\n        this.onInteraction(null);\n    }\n\n    public destroy(): void {\n        window.document.removeEventListener('keyup', this.onKeyUp);\n        window.document.removeEventListener('keydown', this.onKeyDown);\n    }\n}\n","// Copyright (C) 2020-2022 Intel Corporation\n//\n// SPDX-License-Identifier: MIT\n\nimport * as SVG from 'svg.js';\n\nimport consts from './consts';\nimport { Configuration, Geometry } from './canvasModel';\n\ninterface TransformedShape {\n    points: string;\n    color: string;\n}\n\nexport interface AutoborderHandler {\n    autoborder(enabled: boolean, currentShape?: SVG.Shape, currentID?: number): void;\n    configurate(configuration: Configuration): void;\n    transform(geometry: Geometry): void;\n    updateObjects(): void;\n}\n\nexport class AutoborderHandlerImpl implements AutoborderHandler {\n    private currentShape: SVG.Shape | null;\n    private currentID?: number;\n    private frameContent: SVGSVGElement;\n    private enabled: boolean;\n    private scale: number;\n    private controlPointsSize: number;\n    private groups: SVGGElement[];\n    private auxiliaryGroupID: number | null;\n    private auxiliaryClicks: number[];\n    private listeners: Record<number, Record<number, {\n        click: (event: MouseEvent) => void;\n        dblclick: (event: MouseEvent) => void;\n    }>>;\n\n    public constructor(frameContent: SVGSVGElement) {\n        this.frameContent = frameContent;\n        this.currentID = undefined;\n        this.currentShape = null;\n        this.enabled = false;\n        this.scale = 1;\n        this.groups = [];\n        this.controlPointsSize = consts.BASE_POINT_SIZE;\n        this.auxiliaryGroupID = null;\n        this.auxiliaryClicks = [];\n        this.listeners = {};\n    }\n\n    private removeMarkers(): void {\n        this.groups.forEach((group: SVGGElement): void => {\n            const groupID = group.dataset.groupId;\n            Array.from(group.children).forEach((circle: SVGCircleElement, pointID: number): void => {\n                circle.removeEventListener('click', this.listeners[+groupID][pointID].click);\n                circle.removeEventListener('dblclick', this.listeners[+groupID][pointID].click);\n                circle.remove();\n            });\n\n            group.remove();\n        });\n\n        this.groups = [];\n        this.auxiliaryGroupID = null;\n        this.auxiliaryClicks = [];\n        this.listeners = {};\n    }\n\n    private release(): void {\n        this.removeMarkers();\n        this.enabled = false;\n        this.currentShape = null;\n    }\n\n    private addPointToCurrentShape(x: number, y: number): void {\n        const array: number[][] = (this.currentShape as any).array().valueOf();\n        array.pop();\n\n        // need to append twice (specific of the library)\n        array.push([x, y]);\n        array.push([x, y]);\n\n        const paintHandler = this.currentShape.remember('_paintHandler');\n        paintHandler.drawCircles();\n        paintHandler.set.members.forEach((el: SVG.Circle): void => {\n            el.attr('stroke-width', 1 / this.scale).attr('r', 2.5 / this.scale);\n        });\n        (this.currentShape as any).plot(array);\n    }\n\n    private resetAuxiliaryShape(): void {\n        if (this.auxiliaryGroupID !== null) {\n            while (this.auxiliaryClicks.length > 0) {\n                const resetID = this.auxiliaryClicks.pop();\n                this.groups[this.auxiliaryGroupID].children[resetID].classList.remove(\n                    'cvat_canvas_autoborder_point_direction',\n                );\n            }\n        }\n\n        this.auxiliaryClicks = [];\n        this.auxiliaryGroupID = null;\n    }\n\n    // convert each shape to group of clicable points\n    // save all groups\n    private drawMarkers(transformedShapes: TransformedShape[]): void {\n        const svgNamespace = 'http://www.w3.org/2000/svg';\n\n        this.groups = transformedShapes.map(\n            (shape: TransformedShape, groupID: number): SVGGElement => {\n                const group = document.createElementNS(svgNamespace, 'g');\n                group.setAttribute('data-group-id', `${groupID}`);\n\n                this.listeners[groupID] = this.listeners[groupID] || {};\n                const circles = shape.points.split(/\\s/).map(\n                    (point: string, pointID: number, points: string[]): SVGCircleElement => {\n                        const [x, y] = point.split(',');\n\n                        const circle = document.createElementNS(svgNamespace, 'circle');\n                        circle.classList.add('cvat_canvas_autoborder_point');\n                        circle.setAttribute('fill', shape.color);\n                        circle.setAttribute('stroke', 'black');\n                        circle.setAttribute('stroke-width', `${consts.POINTS_STROKE_WIDTH / this.scale}`);\n                        circle.setAttribute('cx', x);\n                        circle.setAttribute('cy', y);\n                        circle.setAttribute('r', `${this.controlPointsSize / this.scale}`);\n\n                        const click = (event: MouseEvent): void => {\n                            event.stopPropagation();\n\n                            // another shape was clicked\n                            if (this.auxiliaryGroupID !== null && this.auxiliaryGroupID !== groupID) {\n                                this.resetAuxiliaryShape();\n                            }\n\n                            this.auxiliaryGroupID = groupID;\n                            // up clicked group for convenience\n                            this.frameContent.appendChild(group);\n\n                            if (this.auxiliaryClicks[1] === pointID) {\n                                // the second point was clicked twice\n                                this.addPointToCurrentShape(+x, +y);\n                                this.resetAuxiliaryShape();\n                                return;\n                            }\n\n                            // the first point can not be clicked twice\n                            // just ignore such a click if it is\n                            if (this.auxiliaryClicks[0] !== pointID) {\n                                this.auxiliaryClicks.push(pointID);\n                            } else {\n                                return;\n                            }\n\n                            // it is the first click\n                            if (this.auxiliaryClicks.length === 1) {\n                                const handler = this.currentShape.remember('_paintHandler');\n                                // draw and remove initial point just to initialize data structures\n                                if (!handler || !handler.startPoint) {\n                                    (this.currentShape as any).draw('point', event);\n                                    (this.currentShape as any).draw('undo');\n                                }\n\n                                this.addPointToCurrentShape(+x, +y);\n                                // is is the second click\n                            } else if (this.auxiliaryClicks.length === 2) {\n                                circle.classList.add('cvat_canvas_autoborder_point_direction');\n                                // it is the third click\n                            } else {\n                                // sign defines bypass direction\n                                const landmarks = this.auxiliaryClicks;\n                                const sign = Math.sign(landmarks[2] - landmarks[0]) *\n                                    Math.sign(landmarks[1] - landmarks[0]) *\n                                    Math.sign(landmarks[2] - landmarks[1]);\n\n                                // go via a polygon and get vertices\n                                // the first vertex has been already drawn\n                                const way = [];\n                                for (let i = landmarks[0] + sign; ; i += sign) {\n                                    if (i < 0) {\n                                        i = points.length - 1;\n                                    } else if (i === points.length) {\n                                        i = 0;\n                                    }\n\n                                    way.push(points[i]);\n\n                                    if (i === this.auxiliaryClicks[this.auxiliaryClicks.length - 1]) {\n                                        // put the last element twice\n                                        // specific of svg.draw.js\n                                        // way.push(points[i]);\n                                        break;\n                                    }\n                                }\n\n                                // remove the latest cursor position from drawing array\n                                for (const wayPoint of way) {\n                                    const [pX, pY] = wayPoint\n                                        .split(',')\n                                        .map((coordinate: string): number => +coordinate);\n                                    this.addPointToCurrentShape(pX, pY);\n                                }\n\n                                this.resetAuxiliaryShape();\n                            }\n                        };\n\n                        const dblclick = (event: MouseEvent): void => {\n                            event.stopPropagation();\n                        };\n\n                        this.listeners[groupID][pointID] = {\n                            click,\n                            dblclick,\n                        };\n\n                        circle.addEventListener('mousedown', this.listeners[groupID][pointID].click);\n                        circle.addEventListener('dblclick', this.listeners[groupID][pointID].click);\n                        return circle;\n                    },\n                );\n\n                group.append(...circles);\n                return group;\n            },\n        );\n\n        this.frameContent.append(...this.groups);\n    }\n\n    public updateObjects(): void {\n        if (!this.enabled) return;\n        this.removeMarkers();\n\n        const currentClientID = this.currentShape.node.dataset.originClientId;\n        const shapes = Array.from(this.frameContent.getElementsByClassName('cvat_canvas_shape')).filter(\n            (shape: HTMLElement): boolean => +shape.getAttribute('clientID') !== this.currentID &&\n                !shape.classList.contains('cvat_canvas_hidden'),\n        );\n        const transformedShapes = shapes\n            .map((shape: HTMLElement): TransformedShape | null => {\n                const color = shape.getAttribute('fill');\n                const clientID = shape.getAttribute('clientID');\n\n                if (color === null || clientID === null) return null;\n                if (+clientID === +currentClientID) {\n                    return null;\n                }\n\n                let points = '';\n                if (shape.tagName === 'polyline' || shape.tagName === 'polygon') {\n                    points = shape.getAttribute('points');\n                } else if (shape.tagName === 'ellipse') {\n                    const cx = +shape.getAttribute('cx');\n                    const cy = +shape.getAttribute('cy');\n                    points = `${cx},${cy}`;\n                } else if (shape.tagName === 'rect') {\n                    const x = +shape.getAttribute('x');\n                    const y = +shape.getAttribute('y');\n                    const width = +shape.getAttribute('width');\n                    const height = +shape.getAttribute('height');\n\n                    if (Number.isNaN(x) || Number.isNaN(y) || Number.isNaN(x) || Number.isNaN(x)) {\n                        return null;\n                    }\n\n                    points = `${x},${y} ${x + width},${y} ${x + width},${y + height} ${x},${y + height}`;\n                } else if (shape.tagName === 'g') {\n                    const polylineID = shape.dataset.polylineId;\n                    const polyline = this.frameContent.getElementById(polylineID);\n                    if (polyline && polyline.getAttribute('points')) {\n                        points = polyline.getAttribute('points');\n                    } else {\n                        return null;\n                    }\n                }\n\n                return {\n                    color,\n                    points: points.trim(),\n                };\n            })\n            .filter((state: TransformedShape | null): boolean => state !== null);\n\n        this.drawMarkers(transformedShapes);\n    }\n\n    public autoborder(enabled: boolean, currentShape?: SVG.Shape, currentID?: number): void {\n        if (enabled && !this.enabled && currentShape) {\n            this.enabled = true;\n            this.currentShape = currentShape;\n            this.currentID = currentID;\n            this.updateObjects();\n        } else {\n            this.release();\n        }\n    }\n\n    public transform(geometry: Geometry): void {\n        this.scale = geometry.scale;\n        this.groups.forEach((group: SVGGElement): void => {\n            Array.from(group.children).forEach((circle: SVGCircleElement): void => {\n                circle.setAttribute('r', `${this.controlPointsSize / this.scale}`);\n                circle.setAttribute('stroke-width', `${consts.BASE_STROKE_WIDTH / this.scale}`);\n            });\n        });\n    }\n\n    public configurate(configuration: Configuration): void {\n        this.controlPointsSize = configuration.controlPointsSize || consts.BASE_POINT_SIZE;\n    }\n}\n","// Copyright (C) 2019-2022 Intel Corporation\n// Copyright (C) 2022-2023 CVAT.ai Corporation\n//\n// SPDX-License-Identifier: MIT\n\nimport polylabel from 'polylabel';\nimport { fabric } from 'fabric';\nimport * as SVG from 'svg.js';\n\nimport 'svg.draggable.js';\nimport 'svg.resize.js';\nimport 'svg.select.js';\n\nimport { CanvasController } from './canvasController';\nimport { Listener, Master } from './master';\nimport { DrawHandler, DrawHandlerImpl } from './drawHandler';\nimport { MasksHandler, MasksHandlerImpl } from './masksHandler';\nimport { EditHandler, EditHandlerImpl } from './editHandler';\nimport { MergeHandler, MergeHandlerImpl } from './mergeHandler';\nimport { SplitHandler, SplitHandlerImpl } from './splitHandler';\nimport { GroupHandler, GroupHandlerImpl } from './groupHandler';\nimport { RegionSelector, RegionSelectorImpl } from './regionSelector';\nimport { ZoomHandler, ZoomHandlerImpl } from './zoomHandler';\nimport { InteractionHandler, InteractionHandlerImpl } from './interactionHandler';\nimport { AutoborderHandler, AutoborderHandlerImpl } from './autoborderHandler';\nimport consts from './consts';\nimport {\n    translateToSVG,\n    translateFromSVG,\n    translateToCanvas,\n    translateFromCanvas,\n    pointsToNumberArray,\n    parsePoints,\n    displayShapeSize,\n    scalarProduct,\n    vectorLength,\n    ShapeSizeElement,\n    DrawnState,\n    rotate2DPoints,\n    readPointsFromShape,\n    setupSkeletonEdges,\n    makeSVGFromTemplate,\n    imageDataToDataURL,\n    expandChannels,\n} from './shared';\nimport {\n    CanvasModel,\n    Geometry,\n    UpdateReasons,\n    FrameZoom,\n    ActiveElement,\n    DrawData,\n    MergeData,\n    SplitData,\n    GroupData,\n    Mode,\n    Size,\n    Configuration,\n    InteractionResult,\n    InteractionData,\n    ColorBy,\n    HighlightedElements,\n    HighlightSeverity,\n} from './canvasModel';\n\nexport interface CanvasView {\n    html(): HTMLDivElement;\n    setupConflictsRegions(clientID: number): number[];\n}\n\nexport class CanvasViewImpl implements CanvasView, Listener {\n    private text: SVGSVGElement;\n    private adoptedText: SVG.Container;\n    private background: HTMLCanvasElement;\n    private masksContent: HTMLCanvasElement;\n    private bitmap: HTMLCanvasElement;\n    private grid: SVGSVGElement;\n    private content: SVGSVGElement;\n    private attachmentBoard: HTMLDivElement;\n    private adoptedContent: SVG.Container;\n    private canvas: HTMLDivElement;\n    private gridPath: SVGPathElement;\n    private gridPattern: SVGPatternElement;\n    private controller: CanvasController;\n    private svgShapes: Record<number, SVG.Shape>;\n    private svgTexts: Record<number, SVG.Text>;\n    private issueRegionPattern_1: SVG.Pattern;\n    private issueRegionPattern_2: SVG.Pattern;\n    private drawnStates: Record<number, DrawnState>;\n    private drawnIssueRegions: Record<number, SVG.Shape>;\n    private geometry: Geometry;\n    private drawHandler: DrawHandler;\n    private masksHandler: MasksHandler;\n    private editHandler: EditHandler;\n    private mergeHandler: MergeHandler;\n    private splitHandler: SplitHandler;\n    private groupHandler: GroupHandler;\n    private regionSelector: RegionSelector;\n    private zoomHandler: ZoomHandler;\n    private autoborderHandler: AutoborderHandler;\n    private interactionHandler: InteractionHandler;\n    private activeElement: ActiveElement;\n    private highlightedElements: HighlightedElements;\n    private configuration: Configuration;\n    private snapToAngleResize: number;\n    private innerObjectsFlags: {\n        drawHidden: Record<number, boolean>;\n        editHidden: Record<number, boolean>;\n    };\n\n    private set mode(value: Mode) {\n        this.controller.mode = value;\n    }\n\n    private get mode(): Mode {\n        return this.controller.mode;\n    }\n\n    private stateIsLocked(state: any): boolean {\n        const { configuration } = this.controller;\n        return state.lock || configuration.forceDisableEditing;\n    }\n\n    private translateToCanvas(points: number[]): number[] {\n        const { offset } = this.controller.geometry;\n        return translateToCanvas(offset, points);\n    }\n\n    private translateFromCanvas(points: number[]): number[] {\n        const { offset } = this.controller.geometry;\n        return translateFromCanvas(offset, points);\n    }\n\n    private translatePointsFromRotatedShape(\n        shape: SVG.Shape, points: number[], cx: number = null, cy: number = null,\n    ): number[] {\n        const { rotation } = shape.transform();\n        // currently shape is rotated and SHIFTED somehow additionally (css transform property)\n        // let's remove rotation to get correct transformation matrix (element -> screen)\n        // correct means that we do not consider points to be rotated\n        // because rotation property is stored separately and already saved\n        if (cx !== null && cy !== null) {\n            shape.rotate(0, cx, cy);\n        } else {\n            shape.rotate(0);\n        }\n\n        const result = [];\n\n        try {\n            // get each point and apply a couple of matrix transformation to it\n            const point = this.content.createSVGPoint();\n            // matrix to convert from ELEMENT coordinate system to CLIENT coordinate system\n            const ctm = (\n                (shape.node as any) as SVGRectElement | SVGPolygonElement | SVGPolylineElement | SVGGElement\n            ).getScreenCTM();\n            // matrix to convert from CLIENT coordinate system to CANVAS coordinate system\n            const ctm1 = this.content.getScreenCTM().inverse();\n            // NOTE: I tried to use element.getCTM(), but this way does not work on firefox\n\n            for (let i = 0; i < points.length; i += 2) {\n                point.x = points[i];\n                point.y = points[i + 1];\n                let transformedPoint = point.matrixTransform(ctm);\n                transformedPoint = transformedPoint.matrixTransform(ctm1);\n\n                result.push(transformedPoint.x, transformedPoint.y);\n            }\n        } finally {\n            if (cx !== null && cy !== null) {\n                shape.rotate(rotation, cx, cy);\n            } else {\n                shape.rotate(rotation);\n            }\n        }\n\n        return result;\n    }\n\n    private stringifyToCanvas(points: number[]): string {\n        return points.reduce((acc: string, val: number, idx: number): string => {\n            if (idx % 2) {\n                return `${acc}${val} `;\n            }\n\n            return `${acc}${val},`;\n        }, '');\n    }\n\n    private isInnerHidden(clientID: number): boolean {\n        return this.innerObjectsFlags.drawHidden[clientID] || false;\n    }\n\n    private setupInnerFlags(clientID: number, path: 'drawHidden' | 'editHidden', value: boolean): void {\n        this.innerObjectsFlags[path][clientID] = value;\n        const shape = this.svgShapes[clientID];\n        const text = this.svgTexts[clientID];\n        const state = this.drawnStates[clientID];\n\n        if (value) {\n            if (shape) {\n                (state.shapeType === 'points' ? shape.remember('_selectHandler').nested : shape).addClass(\n                    'cvat_canvas_hidden',\n                );\n            }\n\n            if (text) {\n                text.addClass('cvat_canvas_hidden');\n            }\n        } else {\n            delete this.innerObjectsFlags[path][clientID];\n\n            if (state) {\n                if (!state.outside && !state.hidden) {\n                    if (shape) {\n                        (state.shapeType === 'points' ? shape.remember('_selectHandler').nested : shape).removeClass(\n                            'cvat_canvas_hidden',\n                        );\n                    }\n\n                    if (text) {\n                        text.removeClass('cvat_canvas_hidden');\n                        this.updateTextPosition(text);\n                    }\n                }\n            }\n        }\n    }\n\n    private onInteraction(\n        shapes: InteractionResult[] | null,\n        shapesUpdated = true,\n        isDone = false,\n        threshold: number | null = null,\n    ): void {\n        const { zLayer } = this.controller;\n        if (Array.isArray(shapes)) {\n            const event: CustomEvent = new CustomEvent('canvas.interacted', {\n                bubbles: false,\n                cancelable: true,\n                detail: {\n                    shapesUpdated,\n                    isDone,\n                    shapes,\n                    zOrder: zLayer || 0,\n                    threshold,\n                },\n            });\n\n            this.canvas.dispatchEvent(event);\n        }\n\n        if (shapes === null || isDone) {\n            const event: CustomEvent = new CustomEvent('canvas.canceled', {\n                bubbles: false,\n                cancelable: true,\n            });\n\n            this.canvas.dispatchEvent(event);\n            this.mode = Mode.IDLE;\n            this.controller.interact({\n                enabled: false,\n            });\n        }\n    }\n\n    private onDrawDone(data: any | null, duration: number, continueDraw?: boolean, prevDrawData?: DrawData): void {\n        const hiddenBecauseOfDraw = Object.keys(this.innerObjectsFlags.drawHidden)\n            .map((_clientID): number => +_clientID);\n        if (hiddenBecauseOfDraw.length) {\n            for (const hidden of hiddenBecauseOfDraw) {\n                this.setupInnerFlags(hidden, 'drawHidden', false);\n            }\n        }\n\n        if (data) {\n            const { clientID, elements } = data as any;\n            const points = data.points || elements.map((el: any) => el.points).flat();\n            if (typeof clientID === 'number') {\n                const [state] = this.controller.objects\n                    .filter((_state: any): boolean => _state.clientID === clientID);\n                this.onEditDone(state, points);\n\n                const event: CustomEvent = new CustomEvent('canvas.canceled', {\n                    bubbles: false,\n                    cancelable: true,\n                });\n\n                this.canvas.dispatchEvent(event);\n                return;\n            }\n\n            const { zLayer } = this.controller;\n            const event: CustomEvent = new CustomEvent('canvas.drawn', {\n                bubbles: false,\n                cancelable: true,\n                detail: {\n                    // eslint-disable-next-line new-cap\n                    state: {\n                        ...data,\n                        zOrder: zLayer || 0,\n                    },\n                    continue: continueDraw,\n                    duration,\n                },\n            });\n\n            this.canvas.dispatchEvent(event);\n        } else if (!continueDraw) {\n            this.canvas.dispatchEvent(new CustomEvent('canvas.canceled', {\n                bubbles: false,\n                cancelable: true,\n            }));\n        }\n\n        if (continueDraw) {\n            this.canvas.dispatchEvent(\n                new CustomEvent('canvas.drawstart', {\n                    bubbles: false,\n                    cancelable: true,\n                    detail: {\n                        drawData: prevDrawData,\n                    },\n                }),\n            );\n        } else {\n            // when draw stops from inside canvas (for example if use predefined number of points)\n            this.controller.draw({ enabled: false });\n        }\n    }\n\n    private onEditStart = (state?: any): void => {\n        this.canvas.style.cursor = 'crosshair';\n        this.deactivate();\n        this.canvas.dispatchEvent(\n            new CustomEvent('canvas.editstart', {\n                bubbles: false,\n                cancelable: true,\n                detail: {\n                    state,\n                },\n            }),\n        );\n\n        if (state && state.shapeType === 'mask') {\n            this.setupInnerFlags(state.clientID, 'editHidden', true);\n        }\n\n        this.mode = Mode.EDIT;\n    };\n\n    private onEditDone = (state: any, points: number[], rotation?: number): void => {\n        this.canvas.style.cursor = '';\n        if (state && points) {\n            const event: CustomEvent = new CustomEvent('canvas.edited', {\n                bubbles: false,\n                cancelable: true,\n                detail: {\n                    state,\n                    points,\n                    rotation: typeof rotation === 'number' ? rotation : state.rotation,\n                },\n            });\n\n            this.canvas.dispatchEvent(event);\n        } else {\n            const event: CustomEvent = new CustomEvent('canvas.canceled', {\n                bubbles: false,\n                cancelable: true,\n            });\n\n            this.canvas.dispatchEvent(event);\n        }\n\n        for (const clientID of Object.keys(this.innerObjectsFlags.editHidden)) {\n            this.setupInnerFlags(+clientID, 'editHidden', false);\n        }\n        this.mode = Mode.IDLE;\n    };\n\n    private onMergeDone(objects: any[] | null, duration?: number): void {\n        if (objects) {\n            const event: CustomEvent = new CustomEvent('canvas.merged', {\n                bubbles: false,\n                cancelable: true,\n                detail: {\n                    duration,\n                    states: objects,\n                },\n            });\n\n            this.canvas.dispatchEvent(event);\n        } else {\n            const event: CustomEvent = new CustomEvent('canvas.canceled', {\n                bubbles: false,\n                cancelable: true,\n            });\n\n            this.canvas.dispatchEvent(event);\n        }\n\n        this.controller.merge({ enabled: false });\n        this.mode = Mode.IDLE;\n    }\n\n    private onSplitDone(object: any): void {\n        if (object) {\n            const event: CustomEvent = new CustomEvent('canvas.splitted', {\n                bubbles: false,\n                cancelable: true,\n                detail: {\n                    state: object,\n                    frame: object.frame,\n                },\n            });\n\n            this.canvas.dispatchEvent(event);\n        } else {\n            const event: CustomEvent = new CustomEvent('canvas.canceled', {\n                bubbles: false,\n                cancelable: true,\n            });\n\n            this.canvas.dispatchEvent(event);\n        }\n\n        this.controller.split({ enabled: false });\n        this.mode = Mode.IDLE;\n    }\n\n    private onGroupDone(objects?: any[]): void {\n        if (objects) {\n            const event: CustomEvent = new CustomEvent('canvas.groupped', {\n                bubbles: false,\n                cancelable: true,\n                detail: {\n                    states: objects,\n                },\n            });\n\n            this.canvas.dispatchEvent(event);\n        } else {\n            const event: CustomEvent = new CustomEvent('canvas.canceled', {\n                bubbles: false,\n                cancelable: true,\n            });\n\n            this.canvas.dispatchEvent(event);\n        }\n\n        this.controller.group({ enabled: false });\n        this.mode = Mode.IDLE;\n    }\n\n    private onRegionSelected(points?: number[]): void {\n        if (points) {\n            const event: CustomEvent = new CustomEvent('canvas.regionselected', {\n                bubbles: false,\n                cancelable: true,\n                detail: {\n                    points,\n                },\n            });\n\n            this.canvas.dispatchEvent(event);\n        } else {\n            const event: CustomEvent = new CustomEvent('canvas.canceled', {\n                bubbles: false,\n                cancelable: true,\n            });\n\n            this.canvas.dispatchEvent(event);\n        }\n\n        this.controller.selectRegion(false);\n        this.mode = Mode.IDLE;\n    }\n\n    private onFindObject(e: MouseEvent): void {\n        if (e.button === 0) {\n            const { offset } = this.controller.geometry;\n            const [x, y] = translateToSVG(this.content, [e.clientX, e.clientY]);\n            const event: CustomEvent = new CustomEvent('canvas.find', {\n                bubbles: false,\n                cancelable: true,\n                detail: {\n                    x: x - offset,\n                    y: y - offset,\n                    states: this.controller.objects,\n                },\n            });\n\n            this.canvas.dispatchEvent(event);\n            e.preventDefault();\n        }\n    }\n\n    private onFocusRegion(x: number, y: number, width: number, height: number): void {\n        // First of all, compute and apply scale\n        let scale = null;\n\n        if ((this.geometry.angle / 90) % 2) {\n            // 90, 270, ..\n            scale = Math.min(\n                Math.max(\n                    Math.min(this.geometry.canvas.width / height, this.geometry.canvas.height / width),\n                    FrameZoom.MIN,\n                ),\n                FrameZoom.MAX,\n            );\n        } else {\n            scale = Math.min(\n                Math.max(\n                    Math.min(this.geometry.canvas.width / width, this.geometry.canvas.height / height),\n                    FrameZoom.MIN,\n                ),\n                FrameZoom.MAX,\n            );\n        }\n\n        this.geometry = { ...this.geometry, scale };\n        this.transformCanvas();\n\n        const [canvasX, canvasY] = translateFromSVG(this.content, [x + width / 2, y + height / 2]);\n\n        const canvasOffset = this.canvas.getBoundingClientRect();\n        const [cx, cy] = [\n            this.canvas.clientWidth / 2 + canvasOffset.left,\n            this.canvas.clientHeight / 2 + canvasOffset.top,\n        ];\n\n        const dragged = {\n            ...this.geometry,\n            top: this.geometry.top + cy - canvasY,\n            left: this.geometry.left + cx - canvasX,\n            scale,\n        };\n\n        this.controller.geometry = dragged;\n        this.geometry = dragged;\n        this.moveCanvas();\n    }\n\n    private moveCanvas(): void {\n        for (const obj of [this.background, this.grid, this.bitmap]) {\n            obj.style.top = `${this.geometry.top}px`;\n            obj.style.left = `${this.geometry.left}px`;\n        }\n\n        for (const obj of [this.content, this.text, this.attachmentBoard]) {\n            obj.style.top = `${this.geometry.top - this.geometry.offset}px`;\n            obj.style.left = `${this.geometry.left - this.geometry.offset}px`;\n        }\n\n        // Transform handlers\n        this.drawHandler.transform(this.geometry);\n        this.masksHandler.transform(this.geometry);\n        this.editHandler.transform(this.geometry);\n        this.zoomHandler.transform(this.geometry);\n        this.autoborderHandler.transform(this.geometry);\n        this.interactionHandler.transform(this.geometry);\n        this.regionSelector.transform(this.geometry);\n    }\n\n    private transformCanvas(): void {\n        // Transform canvas\n        for (const obj of [\n            this.background,\n            this.grid,\n            this.content,\n            this.bitmap,\n            this.attachmentBoard,\n        ]) {\n            obj.style.transform = `scale(${this.geometry.scale}) rotate(${this.geometry.angle}deg)`;\n        }\n\n        // Transform grid\n        this.gridPath.setAttribute('stroke-width', `${consts.BASE_GRID_WIDTH / this.geometry.scale}px`);\n\n        // Transform all shape points\n        for (const element of [\n            ...window.document.getElementsByClassName('svg_select_points'),\n            ...window.document.getElementsByClassName('svg_select_points_rot'),\n            ...window.document.getElementsByClassName('svg_select_boundingRect'),\n        ]) {\n            element.setAttribute('stroke-width', `${consts.POINTS_STROKE_WIDTH / this.geometry.scale}`);\n            element.setAttribute('r', `${this.configuration.controlPointsSize / this.geometry.scale}`);\n        }\n\n        for (const element of window.document.getElementsByClassName('cvat_canvas_poly_direction')) {\n            const angle = (element as any).instance.data('angle');\n\n            (element as any).instance.style({\n                transform: `scale(${1 / this.geometry.scale}) rotate(${angle}deg)`,\n            });\n        }\n\n        for (const element of window.document.getElementsByClassName('cvat_canvas_selected_point')) {\n            const previousWidth = element.getAttribute('stroke-width') as string;\n            element.setAttribute('stroke-width', `${+previousWidth * 2}`);\n        }\n\n        // Transform all drawn shapes and text\n        for (const key of Object.keys(this.svgShapes)) {\n            const clientID = +key;\n            const object = this.svgShapes[clientID];\n            object.attr({\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n            });\n            if (object.type === 'circle') {\n                object.attr('r', `${this.configuration.controlPointsSize / this.geometry.scale}`);\n            }\n            if (clientID in this.svgTexts) {\n                this.updateTextPosition(this.svgTexts[clientID]);\n            }\n        }\n\n        // Transform skeleton edges\n        for (const skeletonEdge of window.document.getElementsByClassName('cvat_canvas_skeleton_edge')) {\n            skeletonEdge.setAttribute('stroke-width', `${consts.BASE_STROKE_WIDTH / this.geometry.scale}`);\n        }\n\n        // Transform all drawn issues region\n        for (const issueRegion of Object.values(this.drawnIssueRegions)) {\n            ((issueRegion as any) as SVG.Shape).attr('r', `${(consts.BASE_POINT_SIZE * 3) / this.geometry.scale}`);\n            ((issueRegion as any) as SVG.Shape).attr(\n                'stroke-width',\n                `${consts.BASE_STROKE_WIDTH / this.geometry.scale}`,\n            );\n        }\n\n        // Transform patterns\n        for (const pattern of [this.issueRegionPattern_1, this.issueRegionPattern_2]) {\n            pattern.attr({\n                width: consts.BASE_PATTERN_SIZE / this.geometry.scale,\n                height: consts.BASE_PATTERN_SIZE / this.geometry.scale,\n            });\n\n            pattern.children().forEach((element: SVG.Element): void => {\n                element.attr('stroke-width', consts.BASE_STROKE_WIDTH / this.geometry.scale);\n            });\n        }\n\n        // Transform handlers\n        this.drawHandler.transform(this.geometry);\n        this.masksHandler.transform(this.geometry);\n        this.editHandler.transform(this.geometry);\n        this.zoomHandler.transform(this.geometry);\n        this.autoborderHandler.transform(this.geometry);\n        this.interactionHandler.transform(this.geometry);\n        this.regionSelector.transform(this.geometry);\n    }\n\n    private resizeCanvas(): void {\n        for (const obj of [this.background, this.masksContent, this.grid, this.bitmap]) {\n            obj.style.width = `${this.geometry.image.width}px`;\n            obj.style.height = `${this.geometry.image.height}px`;\n        }\n\n        for (const obj of [this.content, this.text, this.attachmentBoard]) {\n            obj.style.width = `${this.geometry.image.width + this.geometry.offset * 2}px`;\n            obj.style.height = `${this.geometry.image.height + this.geometry.offset * 2}px`;\n        }\n    }\n\n    private setupIssueRegions(issueRegions: Record<number, { hidden: boolean; points: number[] }>): void {\n        for (const issueRegion of Object.keys(this.drawnIssueRegions)) {\n            if (!(issueRegion in issueRegions) || !+issueRegion) {\n                this.drawnIssueRegions[+issueRegion].remove();\n                delete this.drawnIssueRegions[+issueRegion];\n            }\n        }\n\n        for (const issueRegion of Object.keys(issueRegions)) {\n            if (issueRegion in this.drawnIssueRegions) continue;\n            const points = this.translateToCanvas(issueRegions[+issueRegion].points);\n            if (points.length === 2) {\n                this.drawnIssueRegions[+issueRegion] = this.adoptedContent\n                    .circle((consts.BASE_POINT_SIZE * 3 * 2) / this.geometry.scale)\n                    .center(points[0], points[1])\n                    .addClass('cvat_canvas_issue_region')\n                    .attr({\n                        id: `cvat_canvas_issue_region_${issueRegion}`,\n                        fill: 'url(#cvat_issue_region_pattern_1)',\n                    });\n            } else if (points.length === 4) {\n                const stringified = this.stringifyToCanvas([\n                    points[0],\n                    points[1],\n                    points[2],\n                    points[1],\n                    points[2],\n                    points[3],\n                    points[0],\n                    points[3],\n                ]);\n                this.drawnIssueRegions[+issueRegion] = this.adoptedContent\n                    .polygon(stringified)\n                    .addClass('cvat_canvas_issue_region')\n                    .attr({\n                        id: `cvat_canvas_issue_region_${issueRegion}`,\n                        fill: 'url(#cvat_issue_region_pattern_1)',\n                        'stroke-width': `${consts.BASE_STROKE_WIDTH / this.geometry.scale}`,\n                    });\n            } else {\n                const stringified = this.stringifyToCanvas(points);\n                this.drawnIssueRegions[+issueRegion] = this.adoptedContent\n                    .polygon(stringified)\n                    .addClass('cvat_canvas_issue_region')\n                    .attr({\n                        id: `cvat_canvas_issue_region_${issueRegion}`,\n                        fill: 'url(#cvat_issue_region_pattern_1)',\n                        'stroke-width': `${consts.BASE_STROKE_WIDTH / this.geometry.scale}`,\n                    });\n            }\n\n            if (issueRegions[+issueRegion].hidden) {\n                this.drawnIssueRegions[+issueRegion].style({ display: 'none' });\n            }\n        }\n    }\n\n    private setupObjects(states: any[]): void {\n        const created = [];\n        const updated = [];\n\n        for (const state of states) {\n            if (!(state.clientID in this.drawnStates)) {\n                created.push(state);\n            } else {\n                const drawnState = this.drawnStates[state.clientID];\n                // object has been changed or changed frame for a track\n                if (drawnState.updated !== state.updated || drawnState.frame !== state.frame) {\n                    updated.push(state);\n                }\n            }\n        }\n        const newIDs = states.map((state: any): number => state.clientID);\n        const deleted = Object.keys(this.drawnStates)\n            .map((clientID: string): number => +clientID)\n            .filter((id: number): boolean => !newIDs.includes(id))\n            .map((id: number): any => this.drawnStates[id]);\n\n        if (deleted.length || updated.length || created.length) {\n            if (this.activeElement.clientID !== null) {\n                this.deactivate();\n            }\n\n            this.deleteObjects(deleted);\n            this.addObjects(created);\n\n            const updatedSkeletons = updated.filter((state: any): boolean => state.shapeType === 'skeleton');\n            const updatedNotSkeletons = updated.filter((state: any): boolean => state.shapeType !== 'skeleton');\n            // todo: implement updateObjects for skeletons, add group and color to updateObjects function\n            // change colors if necessary (for example when instance color is changed)\n            this.updateObjects(updatedNotSkeletons);\n\n            this.deleteObjects(updatedSkeletons);\n            this.addObjects(updatedSkeletons);\n\n            this.sortObjects();\n\n            if (this.controller.activeElement.clientID !== null) {\n                const { clientID } = this.controller.activeElement;\n                if (states.map((state: any): number => state.clientID).includes(clientID)) {\n                    this.activate(this.controller.activeElement);\n                }\n            }\n\n            this.autoborderHandler.updateObjects();\n        }\n    }\n\n    private hideDirection(shape: SVG.Polygon | SVG.PolyLine): void {\n        /* eslint class-methods-use-this: 0 */\n        const handler = shape.remember('_selectHandler');\n        if (!handler || !handler.nested) return;\n        const nested = handler.nested as SVG.Parent;\n        if (nested.children().length) {\n            nested.children()[0].removeClass('cvat_canvas_first_poly_point');\n        }\n\n        const node = nested.node as SVG.LinkedHTMLElement;\n        const directions = node.getElementsByClassName('cvat_canvas_poly_direction');\n        for (const direction of directions) {\n            const { instance } = direction as any;\n            instance.off('click');\n            instance.remove();\n        }\n    }\n\n    private showDirection(state: any, shape: SVG.Polygon | SVG.PolyLine): void {\n        const path = consts.ARROW_PATH;\n\n        const points = parsePoints(state.points);\n        const handler = shape.remember('_selectHandler');\n\n        if (!handler || !handler.nested) return;\n        const firstCircle = handler.nested.children()[0];\n        const secondCircle = handler.nested.children()[1];\n        firstCircle.addClass('cvat_canvas_first_poly_point');\n\n        const [cx, cy] = [(secondCircle.cx() + firstCircle.cx()) / 2, (secondCircle.cy() + firstCircle.cy()) / 2];\n        const [firstPoint, secondPoint] = points.slice(0, 2);\n        const xAxis = { i: 1, j: 0 };\n        const baseVector = { i: secondPoint.x - firstPoint.x, j: secondPoint.y - firstPoint.y };\n        const baseVectorLength = vectorLength(baseVector);\n        let cosinus = 0;\n\n        if (baseVectorLength !== 0) {\n            // two points have the same coordinates\n            cosinus = scalarProduct(xAxis, baseVector) / (vectorLength(xAxis) * baseVectorLength);\n        }\n        const angle = (Math.acos(cosinus) * (Math.sign(baseVector.j) || 1) * 180) / Math.PI;\n\n        const pathElement = handler.nested\n            .path(path)\n            .fill('white')\n            .stroke({\n                width: 1,\n                color: 'black',\n            })\n            .addClass('cvat_canvas_poly_direction')\n            .style({\n                'transform-origin': `${cx}px ${cy}px`,\n                transform: `scale(${1 / this.geometry.scale}) rotate(${angle}deg)`,\n            })\n            .move(cx, cy);\n\n        pathElement.on('click', (e: MouseEvent): void => {\n            if (e.button === 0) {\n                e.stopPropagation();\n                if (state.shapeType === 'polygon') {\n                    const reversedPoints = [points[0], ...points.slice(1).reverse()];\n                    this.onEditDone(state, pointsToNumberArray(reversedPoints));\n                } else {\n                    const reversedPoints = points.reverse();\n                    this.onEditDone(state, pointsToNumberArray(reversedPoints));\n                }\n            }\n        });\n\n        pathElement.data('angle', angle);\n        pathElement.dmove(-pathElement.width() / 2, -pathElement.height() / 2);\n    }\n\n    private selectize(value: boolean, shape: SVG.Element): void {\n        const mousedownHandler = (e: MouseEvent): void => {\n            if (e.button !== 0) return;\n            e.preventDefault();\n\n            if (this.activeElement.clientID !== null) {\n                const pointID = Array.prototype.indexOf.call(\n                    ((e.target as HTMLElement).parentElement as HTMLElement).children,\n                    e.target,\n                );\n                const [state] = this.controller.objects.filter(\n                    (_state: any): boolean => _state.clientID === this.activeElement.clientID,\n                );\n\n                if (['polygon', 'polyline', 'points'].includes(state.shapeType)) {\n                    if (state.shapeType === 'points' && (e.altKey || e.ctrlKey)) {\n                        const selectedClientID = +((e.target as HTMLElement).parentElement as HTMLElement).getAttribute('clientID');\n\n                        if (state.clientID !== selectedClientID) {\n                            return;\n                        }\n                    }\n                    if (e.altKey) {\n                        const { points } = state;\n                        this.onEditDone(state, points.slice(0, pointID * 2).concat(points.slice(pointID * 2 + 2)));\n                    } else if (e.shiftKey) {\n                        this.onEditStart(state);\n                        this.editHandler.edit({\n                            enabled: true,\n                            state,\n                            pointID,\n                        });\n                    }\n                }\n            }\n        };\n\n        const dblClickHandler = (e: MouseEvent): void => {\n            e.preventDefault();\n\n            if (this.activeElement.clientID !== null) {\n                const [state] = this.controller.objects.filter(\n                    (_state: any): boolean => _state.clientID === this.activeElement.clientID,\n                );\n\n                if (state.shapeType === 'cuboid') {\n                    if (e.shiftKey) {\n                        const points = this.translateFromCanvas(\n                            pointsToNumberArray((e.target as any).parentElement.parentElement.instance.attr('points')),\n                        );\n                        this.onEditDone(state, points);\n                    }\n                }\n            }\n        };\n\n        const contextMenuHandler = (e: MouseEvent): void => {\n            const pointID = Array.prototype.indexOf.call(\n                ((e.target as HTMLElement).parentElement as HTMLElement).children,\n                e.target,\n            );\n            if (this.activeElement.clientID !== null) {\n                const [state] = this.controller.objects.filter(\n                    (_state: any): boolean => _state.clientID === this.activeElement.clientID,\n                );\n                this.canvas.dispatchEvent(\n                    new CustomEvent('canvas.contextmenu', {\n                        bubbles: false,\n                        cancelable: true,\n                        detail: {\n                            mouseEvent: e,\n                            objectState: state,\n                            pointID,\n                        },\n                    }),\n                );\n            }\n            e.preventDefault();\n        };\n\n        if (value) {\n            const getGeometry = (): Geometry => this.geometry;\n            const getController = (): CanvasController => this.controller;\n            const getActiveElement = (): ActiveElement => this.activeElement;\n            (shape as any).selectize(value, {\n                deepSelect: true,\n                pointSize: (2 * this.configuration.controlPointsSize) / this.geometry.scale,\n                rotationPoint: shape.type === 'rect' || shape.type === 'ellipse',\n                pointsExclude: shape.type === 'image' ? ['lt', 'rt', 'rb', 'lb', 't', 'r', 'b', 'l'] : [],\n                pointType(cx: number, cy: number): SVG.Circle {\n                    const circle: SVG.Circle = this.nested\n                        .circle(this.options.pointSize)\n                        .stroke('black')\n                        .fill('inherit')\n                        .center(cx, cy)\n                        .attr({\n                            'fill-opacity': 1,\n                            'stroke-width': consts.POINTS_STROKE_WIDTH / getGeometry().scale,\n                        });\n\n                    circle.on('mouseenter', (e: MouseEvent): void => {\n                        const activeElement = getActiveElement();\n                        if (activeElement !== null && (e.altKey || e.ctrlKey)) {\n                            const [state] = getController().objects.filter(\n                                (_state: any): boolean => _state.clientID === activeElement.clientID,\n                            );\n                            if (state?.shapeType === 'points') {\n                                const selectedClientID = +((e.target as HTMLElement).parentElement as HTMLElement).getAttribute('clientID');\n                                if (state.clientID !== selectedClientID) {\n                                    return;\n                                }\n                            }\n                        }\n\n                        circle.attr({\n                            'stroke-width': consts.POINTS_SELECTED_STROKE_WIDTH / getGeometry().scale,\n                        });\n\n                        circle.on('dblclick', dblClickHandler);\n                        circle.on('mousedown', mousedownHandler);\n                        circle.on('contextmenu', contextMenuHandler);\n                        circle.addClass('cvat_canvas_selected_point');\n                    });\n\n                    circle.on('mouseleave', (): void => {\n                        circle.attr({\n                            'stroke-width': consts.POINTS_STROKE_WIDTH / getGeometry().scale,\n                        });\n\n                        circle.off('dblclick', dblClickHandler);\n                        circle.off('mousedown', mousedownHandler);\n                        circle.off('contextmenu', contextMenuHandler);\n                        circle.removeClass('cvat_canvas_selected_point');\n                    });\n\n                    return circle;\n                },\n            });\n        } else {\n            (shape as any).selectize(false, {\n                deepSelect: true,\n            });\n        }\n\n        const handler = shape.remember('_selectHandler');\n        if (handler && handler.nested) {\n            handler.nested.fill(shape.attr('fill'));\n        }\n\n        const [rotationPoint] = window.document.getElementsByClassName('svg_select_points_rot');\n        const [topPoint] = window.document.getElementsByClassName('svg_select_points_t');\n        if (rotationPoint && !rotationPoint.children.length) {\n            if (topPoint) {\n                const rotY = +(rotationPoint as SVGEllipseElement).getAttribute('cy');\n                const topY = +(topPoint as SVGEllipseElement).getAttribute('cy');\n                (rotationPoint as SVGCircleElement).style.transform = `translate(0px, -${rotY - topY + 20}px)`;\n            }\n\n            const title = document.createElementNS('http://www.w3.org/2000/svg', 'title');\n            title.textContent = 'Hold Shift to snap angle';\n            rotationPoint.appendChild(title);\n        }\n\n        if (value && shape.type === 'image') {\n            const [boundingRect] = window.document.getElementsByClassName('svg_select_boundingRect');\n            if (boundingRect) {\n                (boundingRect as SVGRectElement).style.opacity = '1';\n                boundingRect.setAttribute('fill', 'none');\n                boundingRect.setAttribute('stroke', shape.attr('stroke'));\n                boundingRect.setAttribute('stroke-width', `${consts.BASE_STROKE_WIDTH / this.geometry.scale}px`);\n                if (shape.hasClass('cvat_canvas_shape_occluded')) {\n                    boundingRect.setAttribute('stroke-dasharray', '5');\n                }\n            }\n        }\n    }\n\n    private onShiftKeyDown = (e: KeyboardEvent): void => {\n        if (!e.repeat && e.code.toLowerCase().includes('shift')) {\n            this.snapToAngleResize = consts.SNAP_TO_ANGLE_RESIZE_SHIFT;\n            if (this.activeElement) {\n                const shape = this.svgShapes[this.activeElement.clientID];\n                if (shape && shape?.remember('_selectHandler')?.options?.rotationPoint) {\n                    if (this.drawnStates[this.activeElement.clientID]?.shapeType === 'skeleton') {\n                        const wrappingRect = (shape as any).children().find((child: SVG.Element) => child.type === 'rect');\n                        if (wrappingRect) {\n                            (wrappingRect as any).resize({ snapToAngle: this.snapToAngleResize });\n                        }\n                    } else {\n                        (shape as any).resize({ snapToAngle: this.snapToAngleResize });\n                    }\n                }\n            }\n        }\n    };\n\n    private onShiftKeyUp = (e: KeyboardEvent): void => {\n        if (e.code.toLowerCase().includes('shift') && this.activeElement) {\n            this.snapToAngleResize = consts.SNAP_TO_ANGLE_RESIZE_DEFAULT;\n            if (this.activeElement) {\n                const shape = this.svgShapes[this.activeElement.clientID];\n                if (shape && shape?.remember('_selectHandler')?.options?.rotationPoint) {\n                    if (this.drawnStates[this.activeElement.clientID]?.shapeType === 'skeleton') {\n                        const wrappingRect = (shape as any).children().find((child: SVG.Element) => child.type === 'rect');\n                        if (wrappingRect) {\n                            (wrappingRect as any).resize({ snapToAngle: this.snapToAngleResize });\n                        }\n                    } else {\n                        (shape as any).resize({ snapToAngle: this.snapToAngleResize });\n                    }\n                }\n            }\n        }\n    };\n\n    private onMouseUp = (event: MouseEvent): void => {\n        if (event.button === 0 || event.button === 1) {\n            this.controller.disableDrag();\n        }\n    };\n\n    public constructor(model: CanvasModel & Master, controller: CanvasController) {\n        this.controller = controller;\n        this.geometry = controller.geometry;\n        this.svgShapes = {};\n        this.svgTexts = {};\n        this.drawnStates = {};\n        this.drawnIssueRegions = {};\n        this.activeElement = {\n            clientID: null,\n            attributeID: null,\n        };\n        this.highlightedElements = {\n            elementsIDs: [],\n            severity: null,\n        };\n        this.configuration = model.configuration;\n        this.mode = Mode.IDLE;\n        this.snapToAngleResize = consts.SNAP_TO_ANGLE_RESIZE_DEFAULT;\n        this.innerObjectsFlags = {\n            drawHidden: {},\n            editHidden: {},\n        };\n\n        // Create HTML elements\n        this.text = window.document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n        this.adoptedText = SVG.adopt((this.text as any) as HTMLElement) as SVG.Container;\n        this.background = window.document.createElement('canvas');\n        this.masksContent = window.document.createElement('canvas');\n        this.bitmap = window.document.createElement('canvas');\n        // window.document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n\n        this.grid = window.document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n        this.gridPath = window.document.createElementNS('http://www.w3.org/2000/svg', 'path');\n        this.gridPattern = window.document.createElementNS('http://www.w3.org/2000/svg', 'pattern');\n\n        this.content = window.document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n        this.adoptedContent = SVG.adopt((this.content as any) as HTMLElement) as SVG.Container;\n\n        this.attachmentBoard = window.document.createElement('div');\n\n        this.canvas = window.document.createElement('div');\n\n        const gridDefs: SVGDefsElement = window.document.createElementNS('http://www.w3.org/2000/svg', 'defs');\n        const gridRect: SVGRectElement = window.document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n\n        // Setup defs\n        const contentDefs = this.adoptedContent.defs();\n\n        this.issueRegionPattern_1 = contentDefs\n            .pattern(consts.BASE_PATTERN_SIZE, consts.BASE_PATTERN_SIZE, (add): void => {\n                add.line(0, 0, 0, 10).stroke('red');\n            })\n            .attr({\n                id: 'cvat_issue_region_pattern_1',\n                patternTransform: 'rotate(45)',\n                patternUnits: 'userSpaceOnUse',\n            });\n\n        this.issueRegionPattern_2 = contentDefs\n            .pattern(consts.BASE_PATTERN_SIZE, consts.BASE_PATTERN_SIZE, (add): void => {\n                add.line(0, 0, 0, 10).stroke('yellow');\n            })\n            .attr({\n                id: 'cvat_issue_region_pattern_2',\n                patternTransform: 'rotate(45)',\n                patternUnits: 'userSpaceOnUse',\n            });\n\n        // Setup grid\n        this.grid.setAttribute('id', 'cvat_canvas_grid');\n        this.grid.setAttribute('version', '2');\n        this.gridPath.setAttribute('d', 'M 1000 0 L 0 0 0 1000');\n        this.gridPath.setAttribute('fill', 'none');\n        this.gridPath.setAttribute('stroke-width', `${consts.BASE_GRID_WIDTH}`);\n        this.gridPath.setAttribute('opacity', 'inherit');\n        this.gridPattern.setAttribute('id', 'cvat_canvas_grid_pattern');\n        this.gridPattern.setAttribute('width', '100');\n        this.gridPattern.setAttribute('height', '100');\n        this.gridPattern.setAttribute('patternUnits', 'userSpaceOnUse');\n        gridRect.setAttribute('width', '100%');\n        gridRect.setAttribute('height', '100%');\n        gridRect.setAttribute('fill', 'url(#cvat_canvas_grid_pattern)');\n\n        // Setup content\n        this.text.setAttribute('id', 'cvat_canvas_text_content');\n        this.background.setAttribute('id', 'cvat_canvas_background');\n        this.masksContent.setAttribute('id', 'cvat_canvas_masks_content');\n        this.content.setAttribute('id', 'cvat_canvas_content');\n        this.bitmap.setAttribute('id', 'cvat_canvas_bitmap');\n        this.bitmap.style.display = 'none';\n\n        // Setup sticked div\n        this.attachmentBoard.setAttribute('id', 'cvat_canvas_attachment_board');\n\n        // Setup wrappers\n        this.canvas.setAttribute('id', 'cvat_canvas_wrapper');\n\n        // Unite created HTML elements together\n        this.grid.appendChild(gridDefs);\n        this.grid.appendChild(gridRect);\n\n        gridDefs.appendChild(this.gridPattern);\n        this.gridPattern.appendChild(this.gridPath);\n\n        this.canvas.appendChild(this.text);\n        this.canvas.appendChild(this.background);\n        this.canvas.appendChild(this.masksContent);\n        this.canvas.appendChild(this.bitmap);\n        this.canvas.appendChild(this.grid);\n        this.canvas.appendChild(this.content);\n        this.canvas.appendChild(this.attachmentBoard);\n\n        // Setup API handlers\n        this.autoborderHandler = new AutoborderHandlerImpl(this.content);\n        this.drawHandler = new DrawHandlerImpl(\n            this.onDrawDone.bind(this),\n            this.adoptedContent,\n            this.adoptedText,\n            this.autoborderHandler,\n            this.geometry,\n            this.configuration,\n        );\n        this.masksHandler = new MasksHandlerImpl(\n            this.onDrawDone.bind(this),\n            this.controller.draw.bind(this.controller),\n            this.onEditStart,\n            this.onEditDone,\n            this.drawHandler,\n            this.masksContent,\n        );\n        this.editHandler = new EditHandlerImpl(this.onEditDone, this.adoptedContent, this.autoborderHandler);\n        this.mergeHandler = new MergeHandlerImpl(\n            this.onMergeDone.bind(this),\n            this.onFindObject.bind(this),\n            this.adoptedContent,\n        );\n        this.splitHandler = new SplitHandlerImpl(\n            this.onSplitDone.bind(this),\n            this.onFindObject.bind(this),\n            this.adoptedContent,\n        );\n        this.groupHandler = new GroupHandlerImpl(\n            this.onGroupDone.bind(this),\n            (): any[] => this.controller.objects,\n            this.onFindObject.bind(this),\n            this.adoptedContent,\n        );\n        this.regionSelector = new RegionSelectorImpl(\n            this.onRegionSelected.bind(this),\n            this.adoptedContent,\n            this.geometry,\n        );\n        this.zoomHandler = new ZoomHandlerImpl(this.onFocusRegion.bind(this), this.adoptedContent, this.geometry);\n        this.interactionHandler = new InteractionHandlerImpl(\n            this.onInteraction.bind(this),\n            this.adoptedContent,\n            this.geometry,\n            this.configuration,\n        );\n\n        // Setup event handlers\n        this.canvas.addEventListener('dblclick', (e: MouseEvent): void => {\n            this.controller.fit();\n            this.canvas.dispatchEvent(\n                new CustomEvent('canvas.fit', {\n                    bubbles: false,\n                    cancelable: true,\n                }),\n            );\n            e.preventDefault();\n        });\n\n        this.canvas.addEventListener('mousedown', (event): void => {\n            if ([0, 1].includes(event.button)) {\n                if (\n                    [Mode.IDLE, Mode.DRAG_CANVAS, Mode.MERGE, Mode.SPLIT]\n                        .includes(this.mode) || event.button === 1 || event.altKey\n                ) {\n                    this.controller.enableDrag(event.clientX, event.clientY);\n                }\n            }\n        });\n\n        window.document.addEventListener('mouseup', this.onMouseUp);\n        window.document.addEventListener('keydown', this.onShiftKeyDown);\n        window.document.addEventListener('keyup', this.onShiftKeyUp);\n\n        this.attachmentBoard.addEventListener('wheel', (event) => {\n            event.stopPropagation();\n        });\n\n        this.attachmentBoard.addEventListener('mousemove', (event) => {\n            event.stopPropagation();\n        });\n\n        this.canvas.addEventListener('wheel', (event): void => {\n            if (event.ctrlKey) return;\n            const { offset } = this.controller.geometry;\n            const point = translateToSVG(this.content, [event.clientX, event.clientY]);\n            this.controller.zoom(point[0] - offset, point[1] - offset, event.deltaY > 0 ? -1 : 1);\n            this.canvas.dispatchEvent(\n                new CustomEvent('canvas.zoom', {\n                    bubbles: false,\n                    cancelable: true,\n                }),\n            );\n            event.preventDefault();\n        });\n\n        this.canvas.addEventListener('mousemove', (e): void => {\n            this.controller.drag(e.clientX, e.clientY);\n\n            if (this.mode !== Mode.IDLE) return;\n            if (e.ctrlKey || e.altKey) return;\n\n            const { offset } = this.controller.geometry;\n            const [x, y] = translateToSVG(this.content, [e.clientX, e.clientY]);\n            const event: CustomEvent = new CustomEvent('canvas.moved', {\n                bubbles: false,\n                cancelable: true,\n                detail: {\n                    x: x - offset,\n                    y: y - offset,\n                    states: this.controller.objects,\n                },\n            });\n\n            this.canvas.dispatchEvent(event);\n        });\n\n        this.content.oncontextmenu = (): boolean => false;\n        model.subscribe(this);\n    }\n\n    public notify(model: CanvasModel & Master, reason: UpdateReasons): void {\n        this.geometry = this.controller.geometry;\n        if (reason === UpdateReasons.CONFIG_UPDATED) {\n            const { activeElement } = this;\n            this.deactivate();\n            const { configuration } = model;\n\n            const updateShapeViews = (states: DrawnState[], parentState?: DrawnState): void => {\n                for (const drawnState of states) {\n                    const {\n                        fill, stroke, 'fill-opacity': fillOpacity,\n                    } = this.getShapeColorization(drawnState, { parentState });\n                    const shapeView = window.document.getElementById(`cvat_canvas_shape_${drawnState.clientID}`);\n                    const [objectState] = this.controller.objects\n                        .filter((_state: any) => _state.clientID === drawnState.clientID);\n                    if (shapeView) {\n                        const handler = (shapeView as any).instance.remember('_selectHandler');\n                        if (handler && handler.nested) {\n                            handler.nested.fill({ color: fill });\n                        }\n\n                        if (drawnState.shapeType === 'mask') {\n                            // if there are masks, we need to redraw them\n                            this.deleteObjects([drawnState]);\n                            this.addObjects([objectState]);\n                            continue;\n                        }\n\n                        (shapeView as any).instance\n                            .fill({ color: fill, opacity: fillOpacity })\n                            .stroke({ color: stroke });\n                    }\n\n                    if (drawnState.elements) {\n                        updateShapeViews(drawnState.elements, drawnState);\n                    }\n                }\n            };\n\n            const withUpdatingShapeViews = configuration.shapeOpacity !== this.configuration.shapeOpacity ||\n                configuration.selectedShapeOpacity !== this.configuration.selectedShapeOpacity ||\n                configuration.outlinedBorders !== this.configuration.outlinedBorders ||\n                configuration.colorBy !== this.configuration.colorBy ||\n                configuration.showConflicts !== this.configuration.showConflicts;\n\n            if (configuration.displayAllText && !this.configuration.displayAllText) {\n                for (const i in this.drawnStates) {\n                    if (!(i in this.svgTexts)) {\n                        this.svgTexts[i] = this.addText(this.drawnStates[i]);\n                    }\n                }\n            } else if (configuration.displayAllText === false && this.configuration.displayAllText) {\n                for (const clientID in this.drawnStates) {\n                    if (+clientID !== activeElement.clientID) {\n                        this.deleteText(+clientID);\n                    }\n                }\n            }\n\n            const recreateText = configuration.textContent !== this.configuration.textContent;\n            const updateTextPosition = configuration.displayAllText !== this.configuration.displayAllText ||\n                configuration.textFontSize !== this.configuration.textFontSize ||\n                configuration.textPosition !== this.configuration.textPosition ||\n                recreateText;\n\n            if (configuration.smoothImage === true) {\n                this.background.classList.remove('cvat_canvas_pixelized');\n            } else if (configuration.smoothImage === false) {\n                this.background.classList.add('cvat_canvas_pixelized');\n            }\n\n            this.configuration = configuration;\n            if (withUpdatingShapeViews) {\n                updateShapeViews(Object.values(this.drawnStates));\n            }\n\n            if (recreateText) {\n                const states = this.controller.objects;\n                for (const key of Object.keys(this.drawnStates)) {\n                    const clientID = +key;\n                    const [state] = states.filter((_state: any) => _state.clientID === clientID);\n                    if (clientID in this.svgTexts) {\n                        this.deleteText(+clientID);\n                        if (state) {\n                            this.svgTexts[clientID] = this.addText(state);\n                        }\n                    }\n                }\n            }\n\n            if (updateTextPosition) {\n                for (const i in this.drawnStates) {\n                    if (i in this.svgTexts) {\n                        this.updateTextPosition(this.svgTexts[i]);\n                    }\n                }\n            }\n\n            if (typeof configuration.CSSImageFilter === 'string') {\n                this.background.style.filter = configuration.CSSImageFilter;\n            }\n\n            this.activate(activeElement);\n            this.editHandler.configurate(this.configuration);\n            this.drawHandler.configurate(this.configuration);\n            this.masksHandler.configurate(this.configuration);\n            this.autoborderHandler.configurate(this.configuration);\n            this.interactionHandler.configurate(this.configuration);\n            this.transformCanvas();\n\n            // remove if exist and not enabled\n            // this.setupObjects([]);\n            // this.setupObjects(model.objects);\n        } else if (reason === UpdateReasons.BITMAP) {\n            const { imageBitmap } = model;\n            if (imageBitmap) {\n                this.bitmap.style.display = '';\n                this.redrawBitmap();\n            } else {\n                this.bitmap.style.display = 'none';\n            }\n        } else if (reason === UpdateReasons.IMAGE_CHANGED) {\n            const { image } = model;\n            if (image) {\n                const ctx = this.background.getContext('2d');\n                this.background.setAttribute('width', `${image.renderWidth}px`);\n                this.background.setAttribute('height', `${image.renderHeight}px`);\n\n                if (ctx) {\n                    ctx.drawImage(image.imageData, 0, 0, image.renderWidth, image.renderHeight);\n                }\n\n                if (model.imageIsDeleted) {\n                    let { width, height } = this.background;\n                    if (image.imageData instanceof ImageData) {\n                        width = image.imageData.width;\n                        height = image.imageData.height;\n                    }\n\n                    this.background.classList.add('cvat_canvas_removed_image');\n                    const canvasContext = this.background.getContext('2d');\n                    const fontSize = width / 10;\n                    canvasContext.font = `bold ${fontSize}px serif`;\n                    canvasContext.textAlign = 'center';\n                    canvasContext.lineWidth = fontSize / 20;\n                    canvasContext.strokeStyle = 'white';\n                    canvasContext.strokeText('IMAGE REMOVED', width / 2, height / 2);\n                    canvasContext.fillStyle = 'black';\n                    canvasContext.fillText('IMAGE REMOVED', width / 2, height / 2);\n                } else if (this.background.classList.contains('cvat_canvas_removed_image')) {\n                    this.background.classList.remove('cvat_canvas_removed_image');\n                }\n\n                this.moveCanvas();\n                this.resizeCanvas();\n                this.transformCanvas();\n            }\n        } else if (reason === UpdateReasons.FITTED_CANVAS) {\n            // Canvas geometry is going to be changed. Old object positions aren't valid any more\n            this.setupObjects([]);\n            this.setupIssueRegions({});\n            this.moveCanvas();\n            this.resizeCanvas();\n            this.canvas.dispatchEvent(\n                new CustomEvent('canvas.reshape', {\n                    bubbles: false,\n                    cancelable: true,\n                }),\n            );\n        } else if ([UpdateReasons.IMAGE_ZOOMED, UpdateReasons.IMAGE_FITTED].includes(reason)) {\n            this.moveCanvas();\n            this.transformCanvas();\n        } else if (reason === UpdateReasons.IMAGE_ROTATED) {\n            this.transformCanvas();\n        } else if (reason === UpdateReasons.IMAGE_MOVED) {\n            this.moveCanvas();\n        } else if (reason === UpdateReasons.OBJECTS_UPDATED) {\n            if (this.mode === Mode.GROUP) {\n                this.groupHandler.resetSelectedObjects();\n            }\n            this.setupObjects(this.controller.objects);\n            if (this.mode === Mode.MERGE) {\n                this.mergeHandler.repeatSelection();\n            }\n            const event: CustomEvent = new CustomEvent('canvas.setup');\n            this.canvas.dispatchEvent(event);\n        } else if (reason === UpdateReasons.ISSUE_REGIONS_UPDATED) {\n            this.setupIssueRegions(this.controller.issueRegions);\n        } else if (reason === UpdateReasons.GRID_UPDATED) {\n            const size: Size = this.geometry.grid;\n            this.gridPattern.setAttribute('width', `${size.width}`);\n            this.gridPattern.setAttribute('height', `${size.height}`);\n        } else if (reason === UpdateReasons.SHAPE_FOCUSED) {\n            const { padding, clientID } = this.controller.focusData;\n            const object = this.svgShapes[clientID];\n            if (object) {\n                const bbox: SVG.BBox = object.bbox();\n                this.onFocusRegion(\n                    bbox.x - padding,\n                    bbox.y - padding,\n                    bbox.width + padding * 2,\n                    bbox.height + padding * 2,\n                );\n            }\n        } else if (reason === UpdateReasons.SHAPE_ACTIVATED) {\n            this.activate(this.controller.activeElement);\n        } else if (reason === UpdateReasons.SHAPE_HIGHLIGHTED) {\n            this.highlight(this.controller.highlightedElements);\n        } else if (reason === UpdateReasons.SELECT_REGION) {\n            if (this.mode === Mode.SELECT_REGION) {\n                this.regionSelector.select(true);\n                this.canvas.style.cursor = 'pointer';\n            } else {\n                this.regionSelector.select(false);\n            }\n        } else if (reason === UpdateReasons.DRAG_CANVAS) {\n            if (this.mode === Mode.DRAG_CANVAS) {\n                this.canvas.dispatchEvent(\n                    new CustomEvent('canvas.dragstart', {\n                        bubbles: false,\n                        cancelable: true,\n                    }),\n                );\n                this.canvas.style.cursor = 'move';\n            } else {\n                this.canvas.dispatchEvent(\n                    new CustomEvent('canvas.dragstop', {\n                        bubbles: false,\n                        cancelable: true,\n                    }),\n                );\n                this.canvas.style.cursor = '';\n            }\n        } else if (reason === UpdateReasons.ZOOM_CANVAS) {\n            if (this.mode === Mode.ZOOM_CANVAS) {\n                this.canvas.dispatchEvent(\n                    new CustomEvent('canvas.zoomstart', {\n                        bubbles: false,\n                        cancelable: true,\n                    }),\n                );\n                this.canvas.style.cursor = 'zoom-in';\n                this.zoomHandler.zoom();\n            } else {\n                this.canvas.dispatchEvent(\n                    new CustomEvent('canvas.zoomstop', {\n                        bubbles: false,\n                        cancelable: true,\n                    }),\n                );\n                this.canvas.style.cursor = '';\n                this.zoomHandler.cancel();\n            }\n        } else if (reason === UpdateReasons.DRAW) {\n            const data: DrawData = this.controller.drawData;\n            if (data.enabled && [Mode.IDLE, Mode.DRAW].includes(this.mode)) {\n                if (data.shapeType !== 'mask') {\n                    this.drawHandler.draw(data, this.geometry);\n                } else {\n                    this.masksHandler.draw(data);\n                }\n\n                if (this.mode === Mode.IDLE) {\n                    this.canvas.style.cursor = 'crosshair';\n                    this.mode = Mode.DRAW;\n                    this.canvas.dispatchEvent(\n                        new CustomEvent('canvas.drawstart', {\n                            bubbles: false,\n                            cancelable: true,\n                            detail: {\n                                drawData: data,\n                            },\n                        }),\n                    );\n\n                    if (typeof data.redraw === 'number') {\n                        this.setupInnerFlags(data.redraw, 'drawHidden', true);\n                    }\n                }\n            } else if (this.mode !== Mode.IDLE) {\n                this.canvas.style.cursor = '';\n                this.mode = Mode.IDLE;\n                if (this.masksHandler.enabled) {\n                    this.masksHandler.draw(data);\n                } else {\n                    this.drawHandler.draw(data, this.geometry);\n                }\n            }\n        } else if (reason === UpdateReasons.EDIT) {\n            const data = this.controller.editData;\n            if (data.enabled && data.state.shapeType === 'mask') {\n                this.masksHandler.edit(data);\n            } else if (this.masksHandler.enabled) {\n                this.masksHandler.edit(data);\n            }\n        } else if (reason === UpdateReasons.INTERACT) {\n            const data: InteractionData = this.controller.interactionData;\n            if (data.enabled && (this.mode === Mode.IDLE || data.intermediateShape)) {\n                if (!data.intermediateShape) {\n                    this.canvas.style.cursor = 'crosshair';\n                    this.mode = Mode.INTERACT;\n                }\n                this.interactionHandler.interact(data);\n            } else {\n                if (!data.enabled) {\n                    this.canvas.style.cursor = '';\n                }\n                if (this.mode !== Mode.IDLE) {\n                    this.interactionHandler.interact(data);\n                }\n            }\n        } else if (reason === UpdateReasons.MERGE) {\n            const data: MergeData = this.controller.mergeData;\n            if (data.enabled) {\n                this.canvas.style.cursor = 'copy';\n                this.mode = Mode.MERGE;\n            } else {\n                this.canvas.style.cursor = '';\n            }\n            this.mergeHandler.merge(data);\n        } else if (reason === UpdateReasons.SPLIT) {\n            const data: SplitData = this.controller.splitData;\n            if (data.enabled) {\n                this.canvas.style.cursor = 'copy';\n                this.mode = Mode.SPLIT;\n            } else {\n                this.canvas.style.cursor = '';\n            }\n            this.splitHandler.split(data);\n        } else if (reason === UpdateReasons.GROUP) {\n            const data: GroupData = this.controller.groupData;\n            if (data.enabled) {\n                this.canvas.style.cursor = 'copy';\n                this.mode = Mode.GROUP;\n            } else {\n                this.canvas.style.cursor = '';\n            }\n            this.groupHandler.group(data);\n        } else if (reason === UpdateReasons.SELECT) {\n            if (this.mode === Mode.MERGE) {\n                this.mergeHandler.select(this.controller.selected);\n            } else if (this.mode === Mode.SPLIT) {\n                this.splitHandler.select(this.controller.selected);\n            } else if (this.mode === Mode.GROUP) {\n                this.groupHandler.select(this.controller.selected);\n            }\n        } else if (reason === UpdateReasons.CANCEL) {\n            if (this.mode === Mode.DRAW) {\n                if (this.masksHandler.enabled) {\n                    this.masksHandler.cancel();\n                } else {\n                    this.drawHandler.cancel();\n                }\n            } else if (this.mode === Mode.INTERACT) {\n                this.interactionHandler.cancel();\n            } else if (this.mode === Mode.MERGE) {\n                this.mergeHandler.cancel();\n            } else if (this.mode === Mode.SPLIT) {\n                this.splitHandler.cancel();\n            } else if (this.mode === Mode.GROUP) {\n                this.groupHandler.cancel();\n            } else if (this.mode === Mode.SELECT_REGION) {\n                this.regionSelector.cancel();\n            } else if (this.mode === Mode.EDIT) {\n                if (this.masksHandler.enabled) {\n                    this.masksHandler.cancel();\n                } else {\n                    this.editHandler.cancel();\n                }\n            } else if (this.mode === Mode.DRAG_CANVAS) {\n                this.canvas.dispatchEvent(\n                    new CustomEvent('canvas.dragstop', {\n                        bubbles: false,\n                        cancelable: true,\n                    }),\n                );\n            } else if (this.mode === Mode.ZOOM_CANVAS) {\n                this.zoomHandler.cancel();\n                this.canvas.dispatchEvent(\n                    new CustomEvent('canvas.zoomstop', {\n                        bubbles: false,\n                        cancelable: true,\n                    }),\n                );\n            }\n            this.mode = Mode.IDLE;\n            this.canvas.style.cursor = '';\n        } else if (reason === UpdateReasons.DATA_FAILED) {\n            const event: CustomEvent = new CustomEvent('canvas.error', {\n                detail: {\n                    exception: model.exception,\n                },\n            });\n            this.canvas.dispatchEvent(event);\n        } else if (reason === UpdateReasons.DESTROY) {\n            this.canvas.dispatchEvent(\n                new CustomEvent('canvas.destroy', {\n                    bubbles: false,\n                    cancelable: true,\n                }),\n            );\n\n            window.document.removeEventListener('keydown', this.onShiftKeyDown);\n            window.document.removeEventListener('keyup', this.onShiftKeyUp);\n            window.document.removeEventListener('mouseup', this.onMouseUp);\n            this.interactionHandler.destroy();\n        }\n\n        if (model.imageBitmap && [UpdateReasons.IMAGE_CHANGED, UpdateReasons.OBJECTS_UPDATED].includes(reason)) {\n            this.redrawBitmap();\n        }\n    }\n\n    public html(): HTMLDivElement {\n        return this.canvas;\n    }\n\n    public setupConflictsRegions(state: any): number[] {\n        let cx = 0;\n        let cy = 0;\n        const shape = this.svgShapes[state.clientID];\n        if (!shape) return [];\n        const box = (shape.node as any).getBBox();\n        cx = box.x + (box.width) / 2;\n        cy = box.y;\n        return [cx, cy];\n    }\n\n    private redrawBitmap(): void {\n        const width = +this.background.style.width.slice(0, -2);\n        const height = +this.background.style.height.slice(0, -2);\n        this.bitmap.setAttribute('width', `${width}px`);\n        this.bitmap.setAttribute('height', `${height}px`);\n        const states = this.controller.objects;\n\n        const ctx = this.bitmap.getContext('2d');\n        ctx.imageSmoothingEnabled = false;\n        if (ctx) {\n            ctx.fillStyle = 'black';\n            ctx.fillRect(0, 0, width, height);\n            for (const state of states) {\n                if (state.hidden || state.outside) continue;\n                ctx.fillStyle = 'white';\n                if (['rectangle', 'polygon', 'cuboid'].includes(state.shapeType)) {\n                    let points = [...state.points];\n                    if (state.shapeType === 'rectangle') {\n                        points = rotate2DPoints(\n                            points[0] + (points[2] - points[0]) / 2,\n                            points[1] + (points[3] - points[1]) / 2,\n                            state.rotation,\n                            [\n                                points[0], // xtl\n                                points[1], // ytl\n                                points[2], // xbr\n                                points[1], // ytl\n                                points[2], // xbr\n                                points[3], // ybr\n                                points[0], // xtl\n                                points[3], // ybr\n                            ],\n                        );\n                    } else if (state.shapeType === 'cuboid') {\n                        points = [\n                            points[0],\n                            points[1],\n                            points[4],\n                            points[5],\n                            points[8],\n                            points[9],\n                            points[12],\n                            points[13],\n                        ];\n                    }\n                    ctx.beginPath();\n                    ctx.moveTo(points[0], points[1]);\n                    for (let i = 0; i < points.length; i += 2) {\n                        ctx.lineTo(points[i], points[i + 1]);\n                    }\n                    ctx.closePath();\n                    ctx.fill();\n                }\n\n                if (state.shapeType === 'ellipse') {\n                    const [cx, cy, rightX, topY] = state.points;\n                    ctx.beginPath();\n                    ctx.ellipse(cx, cy, rightX - cx, cy - topY, (state.rotation * Math.PI) / 180.0, 0, 2 * Math.PI);\n                    ctx.closePath();\n                    ctx.fill();\n                }\n\n                if (state.shapeType === 'mask') {\n                    const { points } = state;\n                    const [left, top, right, bottom] = points.slice(-4);\n                    const imageBitmap = expandChannels(255, 255, 255, points, 4);\n                    imageDataToDataURL(imageBitmap, right - left + 1, bottom - top + 1,\n                        (dataURL: string) => new Promise((resolve) => {\n                            const img = document.createElement('img');\n                            img.addEventListener('load', () => {\n                                ctx.drawImage(img, left, top);\n                                URL.revokeObjectURL(dataURL);\n                                resolve();\n                            });\n                            img.src = dataURL;\n                        }));\n                }\n\n                if (state.shapeType === 'cuboid') {\n                    for (let i = 0; i < 5; i++) {\n                        const points = [\n                            state.points[(0 + i * 4) % 16],\n                            state.points[(1 + i * 4) % 16],\n                            state.points[(2 + i * 4) % 16],\n                            state.points[(3 + i * 4) % 16],\n                            state.points[(6 + i * 4) % 16],\n                            state.points[(7 + i * 4) % 16],\n                            state.points[(4 + i * 4) % 16],\n                            state.points[(5 + i * 4) % 16],\n                        ];\n                        ctx.beginPath();\n                        ctx.moveTo(points[0], points[1]);\n                        for (let j = 0; j < points.length; j += 2) {\n                            ctx.lineTo(points[j], points[j + 1]);\n                        }\n                        ctx.closePath();\n                        ctx.fill();\n                    }\n                }\n            }\n        }\n    }\n\n    private saveState(state: any): DrawnState {\n        const result = {\n            clientID: state.clientID,\n            outside: state.outside,\n            occluded: state.occluded,\n            source: state.source,\n            hidden: state.hidden,\n            lock: state.lock,\n            shapeType: state.shapeType,\n            points: [...state.points],\n            rotation: state.rotation,\n            attributes: { ...state.attributes },\n            descriptions: [...state.descriptions],\n            zOrder: state.zOrder,\n            pinned: state.pinned,\n            updated: state.updated,\n            frame: state.frame,\n            label: state.label,\n            group: { id: state.group.id, color: state.group.color },\n            color: state.color,\n            elements: state.shapeType === 'skeleton' ?\n                state.elements.map((element: any) => this.saveState(element)) : null,\n        };\n\n        return result;\n    }\n\n    private getShapeColorization(state: any, opts: {\n        parentState?: any,\n    } = {}): { fill: string; stroke: string, 'fill-opacity': number } {\n        const { shapeType } = state;\n        const parentShapeType = opts.parentState?.shapeType;\n        const { configuration } = this;\n        const { colorBy, shapeOpacity, outlinedBorders } = configuration;\n        let shapeColor = '';\n\n        if (colorBy === ColorBy.INSTANCE) {\n            shapeColor = state.color;\n        } else if (colorBy === ColorBy.GROUP) {\n            shapeColor = state.group.color;\n        } else if (colorBy === ColorBy.LABEL) {\n            shapeColor = state.label.color;\n        }\n        if (this.highlightedElements.elementsIDs.length) {\n            if (this.highlightedElements.elementsIDs.includes(state.clientID)) {\n                if (this.highlightedElements.severity === HighlightSeverity.ERROR) {\n                    shapeColor = consts.CONFLICT_COLOR;\n                } else if (this.highlightedElements.severity === HighlightSeverity.WARNING) {\n                    shapeColor = consts.WARNING_COLOR;\n                }\n            } else {\n                shapeColor = consts.SHADED_COLOR;\n            }\n        }\n        const outlinedColor = parentShapeType === 'skeleton' ? 'black' : outlinedBorders || shapeColor;\n\n        return {\n            fill: shapeColor,\n            stroke: outlinedColor,\n            'fill-opacity': !['polyline', 'points', 'skeleton'].includes(shapeType) || parentShapeType === 'skeleton' ? shapeOpacity : 0,\n        };\n    }\n\n    private getHighlightClassname(): string {\n        const { severity } = this.highlightedElements;\n        if (severity === HighlightSeverity.ERROR) {\n            return 'cvat_canvas_conflicted';\n        }\n        if (severity === HighlightSeverity.WARNING) {\n            return 'cvat_canvas_warned';\n        }\n        return '';\n    }\n\n    private updateObjects(states: any[]): void {\n        for (const state of states) {\n            const { clientID } = state;\n            const drawnState = this.drawnStates[clientID];\n            const shape = this.svgShapes[state.clientID];\n            const text = this.svgTexts[state.clientID];\n            const isInvisible = state.hidden || state.outside || this.isInnerHidden(state.clientID);\n\n            if (drawnState.hidden !== state.hidden || drawnState.outside !== state.outside) {\n                if (isInvisible) {\n                    (state.shapeType === 'points' ? shape.remember('_selectHandler').nested : shape).addClass(\n                        'cvat_canvas_hidden',\n                    );\n                    if (text) {\n                        text.addClass('cvat_canvas_hidden');\n                    }\n                } else {\n                    (state.shapeType === 'points' ? shape.remember('_selectHandler').nested : shape).removeClass(\n                        'cvat_canvas_hidden',\n                    );\n                    if (text) {\n                        text.removeClass('cvat_canvas_hidden');\n                        this.updateTextPosition(text);\n                    }\n                }\n            }\n\n            if (drawnState.zOrder !== state.zOrder) {\n                if (state.shapeType === 'points') {\n                    shape.remember('_selectHandler').nested.attr('data-z-order', state.zOrder);\n                } else {\n                    shape.attr('data-z-order', state.zOrder);\n                }\n            }\n\n            if (drawnState.occluded !== state.occluded) {\n                const instance = state.shapeType === 'points' ? this.svgShapes[clientID].remember('_selectHandler').nested : shape;\n                if (state.occluded) {\n                    instance.addClass('cvat_canvas_shape_occluded');\n                } else {\n                    instance.removeClass('cvat_canvas_shape_occluded');\n                }\n            }\n\n            if (drawnState.pinned !== state.pinned && this.activeElement.clientID !== null) {\n                const activeElement = { ...this.activeElement };\n                this.deactivate();\n                this.activate(activeElement);\n            }\n\n            if (drawnState.rotation) {\n                // need to rotate it back before changing points\n                shape.untransform();\n            }\n\n            if (\n                state.points.length !== drawnState.points.length ||\n                state.points.some((p: number, id: number): boolean => p !== drawnState.points[id])\n            ) {\n                if (state.shapeType === 'mask') {\n                    // if masks points were updated, draw from scratch\n                    this.deleteObjects([this.drawnStates[+clientID]]);\n                    this.addObjects([state]);\n                    continue;\n                }\n\n                const translatedPoints: number[] = this.translateToCanvas(state.points);\n\n                if (state.shapeType === 'rectangle') {\n                    const [xtl, ytl, xbr, ybr] = translatedPoints;\n\n                    shape.attr({\n                        x: xtl,\n                        y: ytl,\n                        width: xbr - xtl,\n                        height: ybr - ytl,\n                    });\n                } else if (state.shapeType === 'ellipse') {\n                    const [cx, cy] = translatedPoints;\n                    const [rx, ry] = [translatedPoints[2] - cx, cy - translatedPoints[3]];\n                    shape.attr({\n                        cx, cy, rx, ry,\n                    });\n                } else {\n                    const stringified = this.stringifyToCanvas(translatedPoints);\n                    if (state.shapeType !== 'cuboid') {\n                        (shape as any).clear();\n                    }\n                    shape.attr('points', stringified);\n\n                    if (state.shapeType === 'points' && !isInvisible) {\n                        this.selectize(false, shape);\n                        this.setupPoints(shape as SVG.PolyLine, state);\n                    }\n                }\n            }\n\n            if (state.rotation) {\n                // now, when points changed, need to rotate it to new angle\n                shape.rotate(state.rotation);\n            }\n\n            const stateDescriptions = state.descriptions;\n            const drawnStateDescriptions = drawnState.descriptions;\n\n            if (\n                drawnState.label.id !== state.label.id ||\n                drawnStateDescriptions.length !== stateDescriptions.length ||\n                drawnStateDescriptions.some((desc: string, id: number): boolean => desc !== stateDescriptions[id])\n            ) {\n                // remove created text and create it again\n                if (text) {\n                    text.remove();\n                    this.svgTexts[state.clientID] = this.addText(state);\n                }\n            } else {\n                // check if there are updates in attributes\n                for (const attrID of Object.keys(state.attributes)) {\n                    if (state.attributes[attrID] !== drawnState.attributes[+attrID]) {\n                        if (text) {\n                            const [span] = text.node.querySelectorAll<SVGTSpanElement>(`[attrID=\"${attrID}\"]`);\n                            if (span && span.textContent) {\n                                const prefix = span.textContent.split(':').slice(0, -1).join(':');\n                                span.textContent = `${prefix}: ${state.attributes[attrID]}`;\n                            }\n                        }\n                    }\n                }\n            }\n\n            if (\n                drawnState.label.id !== state.label.id ||\n                drawnState.group.id !== state.group.id ||\n                drawnState.group.color !== state.group.color ||\n                drawnState.color !== state.color\n            ) {\n                // update shape color if necessary\n                if (shape) {\n                    if (state.shapeType === 'mask') {\n                        // if masks points were updated, draw from scratch\n                        this.deleteObjects([this.drawnStates[+clientID]]);\n                        this.addObjects([state]);\n                        continue;\n                    } else {\n                        shape.attr({ ...this.getShapeColorization(state) });\n                    }\n                }\n            }\n\n            this.drawnStates[state.clientID] = this.saveState(state);\n        }\n    }\n\n    private deleteObjects(states: any[]): void {\n        for (const state of states) {\n            if (state.clientID in this.svgTexts) {\n                this.deleteText(state.clientID);\n            }\n\n            if (state.shapeType === 'skeleton') {\n                this.deleteObjects(state.elements);\n            }\n\n            if (state.clientID in this.svgShapes) {\n                this.svgShapes[state.clientID].fire('remove');\n                this.svgShapes[state.clientID].off('click');\n                this.svgShapes[state.clientID].off('remove');\n                this.svgShapes[state.clientID].remove();\n                delete this.svgShapes[state.clientID];\n            }\n\n            if (state.clientID in this.drawnStates) {\n                delete this.drawnStates[state.clientID];\n            }\n        }\n    }\n\n    private addObjects(states: any[]): void {\n        const { displayAllText } = this.configuration;\n        for (const state of states) {\n            const points: number[] = state.points as number[];\n\n            // TODO: Use enums after typification cvat-core\n            if (state.shapeType === 'mask') {\n                this.svgShapes[state.clientID] = this.addMask(points, state);\n            } else if (state.shapeType === 'skeleton') {\n                this.svgShapes[state.clientID] = this.addSkeleton(state);\n            } else {\n                const translatedPoints: number[] = this.translateToCanvas(points);\n                if (state.shapeType === 'rectangle') {\n                    this.svgShapes[state.clientID] = this.addRect(translatedPoints, state);\n                } else {\n                    const stringified = this.stringifyToCanvas(translatedPoints);\n\n                    if (state.shapeType === 'polygon') {\n                        this.svgShapes[state.clientID] = this.addPolygon(stringified, state);\n                    } else if (state.shapeType === 'polyline') {\n                        this.svgShapes[state.clientID] = this.addPolyline(stringified, state);\n                    } else if (state.shapeType === 'points') {\n                        this.svgShapes[state.clientID] = this.addPoints(stringified, state);\n                    } else if (state.shapeType === 'ellipse') {\n                        this.svgShapes[state.clientID] = this.addEllipse(stringified, state);\n                    } else if (state.shapeType === 'cuboid') {\n                        this.svgShapes[state.clientID] = this.addCuboid(stringified, state);\n                    } else {\n                        continue;\n                    }\n                }\n            }\n\n            this.svgShapes[state.clientID].on('click.canvas', (): void => {\n                this.canvas.dispatchEvent(\n                    new CustomEvent('canvas.clicked', {\n                        bubbles: false,\n                        cancelable: true,\n                        detail: {\n                            state,\n                        },\n                    }),\n                );\n            });\n\n            if (displayAllText) {\n                this.svgTexts[state.clientID] = this.addText(state);\n                this.updateTextPosition(this.svgTexts[state.clientID]);\n            }\n\n            this.drawnStates[state.clientID] = this.saveState(state);\n        }\n    }\n\n    private sortObjects(): void {\n        // TODO: Can be significantly optimized\n        const states = Array.from(this.content.getElementsByClassName('cvat_canvas_shape')).map((state: SVGElement): [\n            SVGElement,\n            number,\n        ] => [state, +state.getAttribute('data-z-order')]);\n\n        const crosshair = Array.from(this.content.getElementsByClassName('cvat_canvas_crosshair'));\n        crosshair.forEach((line: SVGLineElement): void => this.content.append(line));\n        const interaction = Array.from(this.content.getElementsByClassName('cvat_interaction_point'));\n        interaction.forEach((circle: SVGCircleElement): void => this.content.append(circle));\n\n        const needSort = states.some((pair): boolean => pair[1] !== states[0][1]);\n        if (!states.length || !needSort) {\n            return;\n        }\n\n        const sorted = states.sort((a, b): number => a[1] - b[1]);\n        sorted.forEach((pair): void => {\n            this.content.appendChild(pair[0]);\n        });\n\n        this.content.prepend(...sorted.map((pair): SVGElement => pair[0]));\n    }\n\n    private deactivateAttribute(): void {\n        const { clientID, attributeID } = this.activeElement;\n        if (clientID !== null && attributeID !== null) {\n            const text = this.svgTexts[clientID];\n            if (text) {\n                const [span] = (text.node.querySelectorAll(`[attrID=\"${attributeID}\"]`) as any) as SVGTSpanElement[];\n                if (span) {\n                    span.style.fill = '';\n                }\n            }\n\n            this.activeElement = {\n                ...this.activeElement,\n                attributeID: null,\n            };\n        }\n    }\n\n    private deactivateShape(): void {\n        if (this.activeElement.clientID) {\n            const { displayAllText } = this.configuration;\n            const { clientID } = this.activeElement;\n            const drawnState = this.drawnStates[clientID];\n            const shape = this.svgShapes[clientID];\n\n            if (drawnState.shapeType === 'points') {\n                this.svgShapes[clientID]\n                    .remember('_selectHandler').nested\n                    .removeClass('cvat_canvas_shape_activated');\n            } else {\n                shape.removeClass('cvat_canvas_shape_activated');\n            }\n            shape.removeClass('cvat_canvas_shape_draggable');\n            if (drawnState.shapeType === 'mask') {\n                shape.attr('opacity', `${this.configuration.shapeOpacity}`);\n            } else {\n                shape.attr('fill-opacity', `${this.configuration.shapeOpacity}`);\n            }\n\n            if (!drawnState.pinned) {\n                (shape as any).off('dragstart');\n                (shape as any).off('dragend');\n                (shape as any).draggable(false);\n            }\n\n            if (drawnState.shapeType !== 'points') {\n                this.selectize(false, shape);\n            }\n\n            if (drawnState.shapeType === 'cuboid') {\n                (shape as any).attr('projections', false);\n            }\n\n            if (drawnState.shapeType === 'mask') {\n                (shape as any).off('mousedown');\n            }\n\n            (shape as any).off('resizestart');\n            (shape as any).off('resizing');\n            (shape as any).off('resizedone');\n            (shape as any).resize('stop');\n\n            // TODO: Hide text only if it is hidden by settings\n            const text = this.svgTexts[clientID];\n            if (text && !displayAllText) {\n                this.deleteText(clientID);\n            }\n\n            this.sortObjects();\n\n            this.activeElement = {\n                ...this.activeElement,\n                clientID: null,\n            };\n        }\n    }\n\n    private deactivate(): void {\n        this.deactivateAttribute();\n        this.deactivateShape();\n    }\n\n    private activateAttribute(clientID: number, attributeID: number): void {\n        const text = this.svgTexts[clientID];\n        if (text) {\n            const [span] = (text.node.querySelectorAll(`[attrID=\"${attributeID}\"]`) as any) as SVGTSpanElement[];\n            if (span) {\n                span.style.fill = 'red';\n            }\n\n            this.activeElement = {\n                ...this.activeElement,\n                attributeID,\n            };\n        }\n    }\n\n    private activateShape(clientID: number): void {\n        const [state] = this.controller.objects.filter((_state: any): boolean => _state.clientID === clientID);\n        if (state && state.shapeType === 'points') {\n            this.svgShapes[clientID]\n                .remember('_selectHandler')\n                .nested.style('pointer-events', this.stateIsLocked(state) ? 'none' : '');\n        }\n\n        if (!state || state.hidden || state.outside) {\n            return;\n        }\n\n        const shape = this.svgShapes[clientID];\n\n        let text = this.svgTexts[clientID];\n        if (!text) {\n            text = this.addText(state);\n            this.svgTexts[state.clientID] = text;\n        }\n        this.updateTextPosition(text);\n\n        if (this.stateIsLocked(state)) {\n            return;\n        }\n\n        if (state.shapeType === 'points') {\n            this.svgShapes[clientID]\n                .remember('_selectHandler').nested\n                .addClass('cvat_canvas_shape_activated');\n        } else {\n            shape.addClass('cvat_canvas_shape_activated');\n        }\n\n        if (state.shapeType === 'mask') {\n            shape.attr('opacity', `${this.configuration.selectedShapeOpacity}`);\n        } else {\n            shape.attr('fill-opacity', `${this.configuration.selectedShapeOpacity}`);\n        }\n\n        if (state.shapeType === 'points') {\n            this.content.append(this.svgShapes[clientID].remember('_selectHandler').nested.node);\n        } else {\n            this.content.append(shape.node);\n        }\n\n        const { showProjections } = this.configuration;\n        if (state.shapeType === 'cuboid' && showProjections) {\n            (shape as any).attr('projections', true);\n        }\n\n        const hideText = (): void => {\n            if (text) {\n                text.addClass('cvat_canvas_hidden');\n            }\n        };\n\n        const showText = (): void => {\n            if (text) {\n                text.removeClass('cvat_canvas_hidden');\n                this.updateTextPosition(text);\n            }\n        };\n\n        if (!state.pinned) {\n            shape.addClass('cvat_canvas_shape_draggable');\n            (shape as any)\n                .draggable({\n                    ...(state.shapeType === 'mask' ? { snapToGrid: 1 } : {}),\n                })\n                .on('dragstart', (): void => {\n                    this.mode = Mode.DRAG;\n                    hideText();\n                    (shape as any).on('remove.drag', (): void => {\n                        this.mode = Mode.IDLE;\n                        // disable internal drag events of SVG.js\n                        window.dispatchEvent(new MouseEvent('mouseup'));\n                    });\n                })\n                .on('dragend', (e: CustomEvent): void => {\n                    (shape as any).off('remove.drag');\n                    this.mode = Mode.IDLE;\n                    showText();\n                    const p1 = e.detail.handler.startPoints.point;\n                    const p2 = e.detail.p;\n                    const dx2 = (p1.x - p2.x) ** 2;\n                    const dy2 = (p1.y - p2.y) ** 2;\n                    if (Math.sqrt(dx2 + dy2) > 0) {\n                        if (shape.type === 'image') {\n                            const { points } = state;\n                            const x = Math.trunc(shape.x()) - this.geometry.offset;\n                            const y = Math.trunc(shape.y()) - this.geometry.offset;\n                            points.splice(-4);\n                            points.push(x, y, x + shape.width() - 1, y + shape.height() - 1);\n                            this.drawnStates[state.clientID].points = points;\n                            this.onEditDone(state, points);\n                            this.canvas.dispatchEvent(\n                                new CustomEvent('canvas.dragshape', {\n                                    bubbles: false,\n                                    cancelable: true,\n                                    detail: {\n                                        id: state.clientID,\n                                    },\n                                }),\n                            );\n\n                            return;\n                        }\n                        // these points does not take into account possible transformations, applied on the element\n                        // so, if any (like rotation) we need to map them to canvas coordinate space\n                        let points = readPointsFromShape(shape);\n\n                        // let's keep current points, but they could be rewritten in updateObjects\n                        this.drawnStates[clientID].points = this.translateFromCanvas(points);\n\n                        const { rotation } = shape.transform();\n                        if (rotation) {\n                            points = this.translatePointsFromRotatedShape(shape, points);\n                        }\n\n                        points = this.translateFromCanvas(points);\n                        this.onEditDone(state, points);\n                        this.canvas.dispatchEvent(\n                            new CustomEvent('canvas.dragshape', {\n                                bubbles: false,\n                                cancelable: true,\n                                detail: {\n                                    id: state.clientID,\n                                },\n                            }),\n                        );\n                    }\n                });\n        }\n\n        if (state.shapeType !== 'points') {\n            this.selectize(true, shape);\n        }\n\n        const showDirection = (): void => {\n            if (['polygon', 'polyline'].includes(state.shapeType)) {\n                this.showDirection(state, shape as SVG.Polygon | SVG.PolyLine);\n            }\n        };\n\n        const hideDirection = (): void => {\n            if (['polygon', 'polyline'].includes(state.shapeType)) {\n                this.hideDirection(shape as SVG.Polygon | SVG.PolyLine);\n            }\n        };\n\n        showDirection();\n\n        let shapeSizeElement: ShapeSizeElement | null = null;\n        let resized = false;\n\n        const resizeFinally = (): void => {\n            if (shapeSizeElement) {\n                shapeSizeElement.rm();\n                shapeSizeElement = null;\n            }\n            this.mode = Mode.IDLE;\n        };\n\n        if (state.shapeType !== 'mask') {\n            (shape as any)\n                .resize({\n                    snapToGrid: 0.1,\n                    snapToAngle: this.snapToAngleResize,\n                })\n                .on('resizestart', (): void => {\n                    this.mode = Mode.RESIZE;\n                    resized = false;\n                    hideDirection();\n                    hideText();\n                    if (state.shapeType === 'rectangle' || state.shapeType === 'ellipse') {\n                        shapeSizeElement = displayShapeSize(this.adoptedContent, this.adoptedText);\n                    }\n                    (shape as any).on('remove.resize', () => {\n                        // disable internal resize events of SVG.js\n                        window.dispatchEvent(new MouseEvent('mouseup'));\n                        resizeFinally();\n                    });\n                })\n                .on('resizing', (): void => {\n                    resized = true;\n                    if (shapeSizeElement) {\n                        shapeSizeElement.update(shape);\n                    }\n                })\n                .on('resizedone', (): void => {\n                    (shape as any).off('remove.resize');\n                    resizeFinally();\n                    showDirection();\n                    showText();\n                    if (resized) {\n                        let rotation = shape.transform().rotation || 0;\n\n                        // be sure, that rotation in range [0; 360]\n                        while (rotation < 0) rotation += 360;\n                        rotation %= 360;\n\n                        // these points does not take into account possible transformations, applied on the element\n                        // so, if any (like rotation) we need to map them to canvas coordinate space\n                        let points = readPointsFromShape(shape);\n\n                        // let's keep current points, but they could be rewritten in updateObjects\n                        this.drawnStates[clientID].points = this.translateFromCanvas(points);\n                        this.drawnStates[clientID].rotation = rotation;\n                        if (rotation) {\n                            points = this.translatePointsFromRotatedShape(shape, points);\n                        }\n\n                        this.onEditDone(state, this.translateFromCanvas(points), rotation);\n                        this.canvas.dispatchEvent(\n                            new CustomEvent('canvas.resizeshape', {\n                                bubbles: false,\n                                cancelable: true,\n                                detail: {\n                                    id: state.clientID,\n                                },\n                            }),\n                        );\n                    }\n                });\n        } else {\n            (shape as any).on('dblclick', (e: MouseEvent) => {\n                if (e.shiftKey) {\n                    this.controller.edit({ enabled: true, state });\n                    e.stopPropagation();\n                }\n            });\n        }\n\n        this.canvas.dispatchEvent(\n            new CustomEvent('canvas.activated', {\n                bubbles: false,\n                cancelable: true,\n                detail: {\n                    state,\n                },\n            }),\n        );\n    }\n\n    private activate(activeElement: ActiveElement): void {\n        // Check if another element have been already activated\n        if (this.activeElement.clientID !== null) {\n            if (this.activeElement.clientID !== activeElement.clientID) {\n                // Deactivate previous shape and attribute\n                this.deactivate();\n            } else if (this.activeElement.attributeID !== activeElement.attributeID) {\n                this.deactivateAttribute();\n            }\n        }\n\n        const { clientID, attributeID } = activeElement;\n        if (clientID !== null && this.activeElement.clientID !== clientID) {\n            this.activateShape(clientID);\n            this.activeElement = {\n                ...this.activeElement,\n                clientID,\n            };\n        }\n\n        if (clientID !== null && attributeID !== null && this.activeElement.attributeID !== attributeID) {\n            this.activateAttribute(clientID, attributeID);\n        }\n    }\n\n    private highlight(highlightedElements: HighlightedElements): void {\n        this.highlightedElements.elementsIDs.forEach((clientID) => {\n            const shapeView = window.document.getElementById(`cvat_canvas_shape_${clientID}`);\n            if (shapeView) shapeView.classList.remove(this.getHighlightClassname());\n        });\n        if (highlightedElements.elementsIDs.length) {\n            this.highlightedElements = { ...highlightedElements };\n            this.canvas.classList.add('cvat-canvas-highlight-enabled');\n            this.highlightedElements.elementsIDs.forEach((clientID) => {\n                const shapeView = window.document.getElementById(`cvat_canvas_shape_${clientID}`);\n                if (shapeView) shapeView.classList.add(this.getHighlightClassname());\n            });\n        } else {\n            this.highlightedElements = {\n                elementsIDs: [],\n                severity: null,\n            };\n            this.canvas.classList.remove('cvat-canvas-highlight-enabled');\n        }\n        const masks = Object.values(this.drawnStates).filter((state) => state.shapeType === 'mask');\n        this.deleteObjects(masks);\n        this.addObjects(masks);\n        if (this.highlightedElements.elementsIDs.length) {\n            this.deactivate();\n            const clientID = this.highlightedElements.elementsIDs[0];\n            this.activate({ clientID, attributeID: null });\n        }\n    }\n\n    // Update text position after corresponding box has been moved, resized, etc.\n    private updateTextPosition(\n        text: SVG.Text,\n        options: { rotation?: { angle: number, cx: number, cy: number } } = {},\n    ): void {\n        const clientID = text.attr('data-client-id');\n        if (!Number.isInteger(clientID)) return;\n        const shape = this.svgShapes[clientID];\n        if (!shape) return;\n\n        if (text.node.style.display === 'none') return; // wrong transformation matrix\n        const { textFontSize } = this.configuration;\n        let { textPosition } = this.configuration;\n        if (shape.type === 'circle') {\n            // force auto for skeleton elements\n            textPosition = 'auto';\n        }\n\n        text.untransform();\n        text.style({ 'font-size': `${textFontSize}px` });\n        const rotation = options.rotation?.angle || shape.transform().rotation;\n\n        // Find the best place for a text\n        let [clientX, clientY, clientCX, clientCY]: number[] = [0, 0, 0, 0];\n        if (textPosition === 'center') {\n            let cx = 0;\n            let cy = 0;\n            if (['rect', 'image'].includes(shape.type)) {\n                // for rectangle/mask finding a center is simple\n                cx = +shape.attr('x') + +shape.attr('width') / 2;\n                cy = +shape.attr('y') + +shape.attr('height') / 2;\n            } else if (shape.type === 'g') {\n                ({ cx, cy } = shape.bbox());\n            } else if (shape.type === 'ellipse') {\n                // even simpler for ellipses\n                cx = +shape.attr('cx');\n                cy = +shape.attr('cy');\n            } else {\n                // for polyshapes we use special algorithm\n                const points = parsePoints(pointsToNumberArray(shape.attr('points')));\n                [cx, cy] = polylabel([points.map((point) => [point.x, point.y])]);\n            }\n\n            [clientX, clientY] = translateFromSVG(this.content, [cx, cy]);\n            // center is exactly clientX, clientY\n            clientCX = clientX;\n            clientCY = clientY;\n        } else {\n            let box = (shape.node as any).getBBox();\n\n            // Translate the whole box to the client coordinate system\n            const [x1, y1, x2, y2]: number[] = translateFromSVG(this.content, [\n                box.x,\n                box.y,\n                box.x + box.width,\n                box.y + box.height,\n            ]);\n\n            clientCX = x1 + (x2 - x1) / 2;\n            clientCY = y1 + (y2 - y1) / 2;\n\n            box = {\n                x: Math.min(x1, x2),\n                y: Math.min(y1, y2),\n                width: Math.max(x1, x2) - Math.min(x1, x2),\n                height: Math.max(y1, y2) - Math.min(y1, y2),\n            };\n\n            // first try to put to the top right corner\n            [clientX, clientY] = [box.x + box.width, box.y];\n            if (\n                clientX + ((text.node as any) as SVGTextElement)\n                    .getBBox().width + consts.TEXT_MARGIN > this.canvas.offsetWidth\n            ) {\n                // if out of visible area, try to put text to top left corner\n                [clientX, clientY] = [box.x, box.y];\n            }\n        }\n\n        // Translate found coordinates to text SVG\n        const [x, y, rotX, rotY]: number[] = translateToSVG(this.text, [\n            clientX + (textPosition === 'auto' ? consts.TEXT_MARGIN : 0),\n            clientY + (textPosition === 'auto' ? consts.TEXT_MARGIN : 0),\n            options.rotation?.cx || clientCX,\n            options.rotation?.cy || clientCY,\n        ]);\n\n        const textBBox = ((text.node as any) as SVGTextElement).getBBox();\n        // Finally draw a text\n        if (textPosition === 'center') {\n            text.move(x - textBBox.width / 2, y - textBBox.height / 2);\n        } else {\n            text.move(x, y);\n        }\n\n        let childOptions = {};\n        if (rotation) {\n            text.rotate(rotation, rotX, rotY);\n            childOptions = {\n                rotation: {\n                    angle: rotation,\n                    cx: clientCX,\n                    cy: clientCY,\n                },\n            };\n        }\n\n        if (clientID in this.drawnStates && this.drawnStates[clientID].shapeType === 'skeleton') {\n            this.drawnStates[clientID].elements.forEach((element: DrawnState) => {\n                if (element.clientID in this.svgTexts) {\n                    this.updateTextPosition(this.svgTexts[element.clientID], childOptions);\n                }\n            });\n        }\n\n        function applyParentX(parentText: SVGTSpanElement | SVGTextElement): void {\n            for (let i = 0; i < parentText.children.length; i++) {\n                if (i === 0) {\n                    // do not align the first child\n                    continue;\n                }\n\n                const tspan = parentText.children[i];\n                tspan.setAttribute('x', parentText.getAttribute('x'));\n                applyParentX(tspan as SVGTSpanElement);\n            }\n        }\n\n        applyParentX(text.node as any as SVGTextElement);\n    }\n\n    private deleteText(clientID: number): void {\n        if (clientID in this.svgTexts) {\n            this.svgTexts[clientID].remove();\n            delete this.svgTexts[clientID];\n        }\n\n        if (clientID in this.drawnStates && this.drawnStates[clientID].shapeType === 'skeleton') {\n            this.drawnStates[clientID].elements.forEach((element) => {\n                this.deleteText(element.clientID);\n            });\n        }\n    }\n\n    private addText(state: any, options: { textContent?: string } = {}): SVG.Text {\n        const { undefinedAttrValue } = this.configuration;\n        const content = options.textContent || this.configuration.textContent;\n        const withID = content.includes('id');\n        const withAttr = content.includes('attributes');\n        const withLabel = content.includes('label');\n        const withSource = content.includes('source');\n        const withDescriptions = content.includes('descriptions');\n        const textFontSize = this.configuration.textFontSize || 12;\n        const {\n            label, clientID, attributes, source, descriptions,\n        } = state;\n        const attrNames = label.attributes.reduce((acc: any, val: any): void => {\n            acc[val.id] = val.name;\n            return acc;\n        }, {});\n\n        if (state.shapeType === 'skeleton') {\n            state.elements.forEach((element: any) => {\n                if (!(element.clientID in this.svgTexts)) {\n                    this.svgTexts[element.clientID] = this.addText(element, {\n                        textContent: [\n                            ...(withLabel ? ['label'] : []),\n                            ...(withAttr ? ['attributes'] : []),\n                        ].join(',') || ' ',\n                    });\n                }\n            });\n        }\n\n        return this.adoptedText\n            .text((block): void => {\n                block.tspan(`${withLabel ? label.name : ''} ${withID ? clientID : ''} ${withSource ? `(${source})` : ''}`).style({\n                    'text-transform': 'uppercase',\n                });\n                if (withDescriptions) {\n                    for (const desc of descriptions) {\n                        block\n                            .tspan(`${desc}`)\n                            .attr({\n                                dy: '1em',\n                                x: 0,\n                            })\n                            .addClass('cvat_canvas_text_description');\n                    }\n                }\n                if (withAttr) {\n                    for (const attrID of Object.keys(attributes)) {\n                        const values = `${attributes[attrID] === undefinedAttrValue ? '' : attributes[attrID]}`.split('\\n');\n                        const parent = block.tspan(`${attrNames[attrID]}: `)\n                            .attr({ attrID, dy: '1em', x: 0 }).addClass('cvat_canvas_text_attribute');\n                        values.forEach((attrLine: string, index: number) => {\n                            parent\n                                .tspan(attrLine)\n                                .attr({\n                                    dy: index === 0 ? 0 : '1em',\n                                });\n                        });\n                    }\n                }\n            })\n            .move(0, 0)\n            .attr({ 'data-client-id': state.clientID })\n            .style({ 'font-size': textFontSize })\n            .addClass('cvat_canvas_text');\n    }\n\n    private addRect(points: number[], state: any): SVG.Rect {\n        const [xtl, ytl, xbr, ybr] = points;\n        const rect = this.adoptedContent\n            .rect()\n            .size(xbr - xtl, ybr - ytl)\n            .attr({\n                clientID: state.clientID,\n                'color-rendering': 'optimizeQuality',\n                id: `cvat_canvas_shape_${state.clientID}`,\n                'shape-rendering': 'geometricprecision',\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                'data-z-order': state.zOrder,\n                ...this.getShapeColorization(state),\n            }).move(xtl, ytl).addClass('cvat_canvas_shape');\n\n        if (state.rotation) {\n            rect.rotate(state.rotation);\n        }\n\n        if (state.occluded) {\n            rect.addClass('cvat_canvas_shape_occluded');\n        }\n\n        if (state.hidden || state.outside || this.isInnerHidden(state.clientID)) {\n            rect.addClass('cvat_canvas_hidden');\n        }\n\n        if (state.isGroundTruth) {\n            rect.addClass('cvat_canvas_ground_truth');\n        }\n\n        return rect;\n    }\n\n    private addPolygon(points: string, state: any): SVG.Polygon {\n        const polygon = this.adoptedContent\n            .polygon(points)\n            .attr({\n                clientID: state.clientID,\n                'color-rendering': 'optimizeQuality',\n                id: `cvat_canvas_shape_${state.clientID}`,\n                'shape-rendering': 'geometricprecision',\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                'data-z-order': state.zOrder,\n                ...this.getShapeColorization(state),\n            }).addClass('cvat_canvas_shape');\n\n        if (state.occluded) {\n            polygon.addClass('cvat_canvas_shape_occluded');\n        }\n\n        if (state.hidden || state.outside || this.isInnerHidden(state.clientID)) {\n            polygon.addClass('cvat_canvas_hidden');\n        }\n\n        if (state.isGroundTruth) {\n            polygon.addClass('cvat_canvas_ground_truth');\n        }\n\n        return polygon;\n    }\n\n    private addPolyline(points: string, state: any): SVG.PolyLine {\n        const polyline = this.adoptedContent\n            .polyline(points)\n            .attr({\n                clientID: state.clientID,\n                'color-rendering': 'optimizeQuality',\n                id: `cvat_canvas_shape_${state.clientID}`,\n                'shape-rendering': 'geometricprecision',\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                'data-z-order': state.zOrder,\n                ...this.getShapeColorization(state),\n            }).addClass('cvat_canvas_shape');\n\n        if (state.occluded) {\n            polyline.addClass('cvat_canvas_shape_occluded');\n        }\n\n        if (state.hidden || state.outside || this.isInnerHidden(state.clientID)) {\n            polyline.addClass('cvat_canvas_hidden');\n        }\n\n        if (state.isGroundTruth) {\n            polyline.addClass('cvat_canvas_ground_truth');\n        }\n\n        return polyline;\n    }\n\n    private addCuboid(points: string, state: any): any {\n        const cube = (this.adoptedContent as any)\n            .cube(points)\n            .fill(state.color)\n            .attr({\n                clientID: state.clientID,\n                'color-rendering': 'optimizeQuality',\n                id: `cvat_canvas_shape_${state.clientID}`,\n                'shape-rendering': 'geometricprecision',\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                'data-z-order': state.zOrder,\n                ...this.getShapeColorization(state),\n            }).addClass('cvat_canvas_shape');\n\n        if (state.occluded) {\n            cube.addClass('cvat_canvas_shape_occluded');\n        }\n\n        if (state.hidden || state.outside || this.isInnerHidden(state.clientID)) {\n            cube.addClass('cvat_canvas_hidden');\n        }\n\n        if (state.isGroundTruth) {\n            cube.addClass('cvat_canvas_ground_truth');\n        }\n\n        return cube;\n    }\n\n    private addMask(points: number[], state: any): SVG.Image {\n        const colorization = this.getShapeColorization(state);\n        const color = fabric.Color.fromHex(colorization.fill).getSource();\n        const [left, top, right, bottom] = points.slice(-4);\n        const imageBitmap = expandChannels(color[0], color[1], color[2], points, 4);\n\n        const image = this.adoptedContent.image().attr({\n            clientID: state.clientID,\n            'color-rendering': 'optimizeQuality',\n            id: `cvat_canvas_shape_${state.clientID}`,\n            'shape-rendering': 'geometricprecision',\n            'data-z-order': state.zOrder,\n            opacity: colorization['fill-opacity'],\n            stroke: colorization.stroke,\n        }).addClass('cvat_canvas_shape');\n        image.move(this.geometry.offset + left, this.geometry.offset + top);\n\n        imageDataToDataURL(\n            imageBitmap,\n            right - left + 1,\n            bottom - top + 1,\n            (dataURL: string) => new Promise((resolve, reject) => {\n                image.loaded(() => {\n                    resolve();\n                });\n                image.error(() => {\n                    reject();\n                });\n                image.load(dataURL);\n            }),\n        );\n\n        return image;\n    }\n\n    private addSkeleton(state: any): any {\n        const skeleton = (this.adoptedContent as any)\n            .group()\n            .attr({\n                clientID: state.clientID,\n                'color-rendering': 'optimizeQuality',\n                id: `cvat_canvas_shape_${state.clientID}`,\n                'shape-rendering': 'geometricprecision',\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                'data-z-order': state.zOrder,\n                'pointer-events': 'all',\n                ...this.getShapeColorization(state),\n            }).addClass('cvat_canvas_shape') as SVG.G;\n\n        const SVGElement = makeSVGFromTemplate(state.label.structure.svg);\n\n        let xtl = Number.MAX_SAFE_INTEGER;\n        let ytl = Number.MAX_SAFE_INTEGER;\n        let xbr = Number.MIN_SAFE_INTEGER;\n        let ybr = Number.MIN_SAFE_INTEGER;\n\n        const svgElements: Record<number, SVG.Element> = {};\n        const templateElements = Array.from(SVGElement.children()).filter((el: SVG.Element) => el.type === 'circle');\n        for (let i = 0; i < state.elements.length; i++) {\n            const element = state.elements[i];\n            if (element.shapeType === 'points') {\n                const points: number[] = element.points as number[];\n                const [cx, cy] = this.translateToCanvas(points);\n\n                if (!element.outside) {\n                    xtl = Math.min(xtl, cx);\n                    ytl = Math.min(ytl, cy);\n                    xbr = Math.max(xbr, cx);\n                    ybr = Math.max(ybr, cy);\n                }\n\n                const templateElement = templateElements.find((el: SVG.Circle) => el.attr('data-label-id') === element.label.id);\n                const circle = skeleton.circle()\n                    .center(cx, cy)\n                    .attr({\n                        id: `cvat_canvas_shape_${element.clientID}`,\n                        r: this.configuration.controlPointsSize / this.geometry.scale,\n                        'color-rendering': 'optimizeQuality',\n                        'shape-rendering': 'geometricprecision',\n                        'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                        'data-node-id': templateElement.attr('data-node-id'),\n                        'data-element-id': templateElement.attr('data-element-id'),\n                        'data-label-id': templateElement.attr('data-label-id'),\n                        'data-client-id': element.clientID,\n                        ...this.getShapeColorization(element, { parentState: state }),\n                    }).style({\n                        cursor: 'default',\n                    });\n                this.svgShapes[element.clientID] = circle;\n                if (element.occluded) {\n                    circle.addClass('cvat_canvas_shape_occluded');\n                }\n\n                if (element.hidden || element.outside || this.isInnerHidden(element.clientID)) {\n                    circle.addClass('cvat_canvas_hidden');\n                }\n\n                const mouseover = (e: MouseEvent): void => {\n                    const locked = this.drawnStates[state.clientID].lock;\n                    if (!locked && !e.ctrlKey && this.mode === Mode.IDLE) {\n                        circle.attr({\n                            'stroke-width': consts.POINTS_SELECTED_STROKE_WIDTH / this.geometry.scale,\n                        });\n\n                        const [x, y] = translateToSVG(this.content, [e.clientX, e.clientY]);\n                        const event: CustomEvent = new CustomEvent('canvas.moved', {\n                            bubbles: false,\n                            cancelable: true,\n                            detail: {\n                                x: x - this.geometry.offset,\n                                y: y - this.geometry.offset,\n                                activatedElementID: element.clientID,\n                                states: this.controller.objects,\n                            },\n                        });\n\n                        this.canvas.dispatchEvent(event);\n                    }\n                };\n\n                const mousemove = (e: MouseEvent): void => {\n                    if (this.mode === Mode.IDLE) {\n                        // stop propagation to canvas where it calls another canvas.moved\n                        // and does not allow to activate an element\n                        e.stopPropagation();\n                    }\n                };\n\n                const mouseleave = (): void => {\n                    circle.attr({\n                        'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                    });\n                };\n\n                const click = (e: MouseEvent): void => {\n                    e.stopPropagation();\n                    this.canvas.dispatchEvent(\n                        new CustomEvent('canvas.clicked', {\n                            bubbles: false,\n                            cancelable: true,\n                            detail: {\n                                state: element,\n                            },\n                        }),\n                    );\n                };\n\n                circle.on('mouseover', mouseover);\n                circle.on('mouseleave', mouseleave);\n                circle.on('mousemove', mousemove);\n                circle.on('click', click);\n                circle.on('remove', () => {\n                    circle.off('remove');\n                    circle.off('mouseover', mouseover);\n                    circle.off('mouseleave', mouseleave);\n                    circle.off('mousemove', mousemove);\n                    circle.off('click', click);\n                });\n\n                svgElements[element.clientID] = circle;\n            }\n        }\n\n        xtl -= consts.SKELETON_RECT_MARGIN;\n        ytl -= consts.SKELETON_RECT_MARGIN;\n        xbr += consts.SKELETON_RECT_MARGIN;\n        ybr += consts.SKELETON_RECT_MARGIN;\n\n        skeleton.on('remove', () => {\n            Object.values(svgElements).forEach((element) => element.fire('remove'));\n            skeleton.off('remove');\n        });\n\n        const wrappingRect = skeleton.rect(xbr - xtl, ybr - ytl).move(xtl, ytl).attr({\n            fill: 'inherit',\n            'fill-opacity': 0,\n            'color-rendering': 'optimizeQuality',\n            'shape-rendering': 'geometricprecision',\n            stroke: 'inherit',\n            'stroke-width': 'inherit',\n            'data-xtl': xtl,\n            'data-ytl': ytl,\n            'data-xbr': xbr,\n            'data-ybr': ybr,\n        }).addClass('cvat_canvas_skeleton_wrapping_rect');\n\n        skeleton.node.prepend(wrappingRect.node);\n        setupSkeletonEdges(skeleton, SVGElement);\n\n        if (state.occluded) {\n            skeleton.addClass('cvat_canvas_shape_occluded');\n        }\n\n        if (state.isGroundTruth) {\n            skeleton.addClass('cvat_canvas_ground_truth');\n        }\n\n        if (state.hidden || state.outside || this.isInnerHidden(state.clientID)) {\n            skeleton.addClass('cvat_canvas_hidden');\n        }\n\n        (skeleton as any).selectize = (enabled: boolean) => {\n            this.selectize(enabled, wrappingRect);\n            const handler = wrappingRect.remember('_selectHandler');\n            if (enabled && handler) {\n                this.adoptedContent.node.append(handler.nested.node);\n                handler.nested.attr('fill', skeleton.attr('fill'));\n            }\n\n            return skeleton;\n        };\n\n        (skeleton as any).draggable = (enabled = true) => {\n            const textList = [\n                state.clientID, ...state.elements.map((element: any): number => element.clientID),\n            ].map((clientID: number) => this.svgTexts[clientID]).filter((text: SVG.Text | undefined) => (\n                typeof text !== 'undefined'\n            ));\n\n            const hideText = (): void => {\n                textList.forEach((text: SVG.Text) => {\n                    text.addClass('cvat_canvas_hidden');\n                });\n            };\n\n            const showText = (): void => {\n                textList.forEach((text: SVG.Text) => {\n                    text.removeClass('cvat_canvas_hidden');\n                    this.updateTextPosition(text);\n                });\n            };\n\n            if (enabled) {\n                (wrappingRect as any).draggable()\n                    .on('dragstart', (): void => {\n                        this.mode = Mode.DRAG;\n                        hideText();\n                        skeleton.on('remove.drag', (): void => {\n                            this.mode = Mode.IDLE;\n                            showText();\n                            // disable internal drag events of SVG.js\n                            window.dispatchEvent(new MouseEvent('mouseup'));\n                            skeleton.off('remove.drag');\n                        });\n                    })\n                    .on('dragmove', (e: CustomEvent): void => {\n                        // skeleton elements itself are not updated yet, need to run as macrotask\n                        setTimeout(() => {\n                            const { instance } = e.target as any;\n                            const [x, y] = [instance.x(), instance.y()];\n                            const prevXtl = +wrappingRect.attr('data-xtl');\n                            const prevYtl = +wrappingRect.attr('data-ytl');\n\n                            for (const child of skeleton.children()) {\n                                if (child.type === 'circle') {\n                                    const childClientID = child.attr('data-client-id');\n                                    if (state.elements.find((el: any) => el.clientID === childClientID).lock || false) {\n                                        continue;\n                                    }\n                                    child.center(\n                                        child.cx() - prevXtl + x,\n                                        child.cy() - prevYtl + y,\n                                    );\n                                }\n                            }\n\n                            wrappingRect.attr('data-xtl', x);\n                            wrappingRect.attr('data-ytl', y);\n                            wrappingRect.attr('data-xbr', x + instance.width());\n                            wrappingRect.attr('data-ybr', y + instance.height());\n\n                            setupSkeletonEdges(skeleton, SVGElement);\n                        });\n                    })\n                    .on('dragend', (e: CustomEvent): void => {\n                        setTimeout(() => {\n                            skeleton.off('remove.drag');\n                            this.mode = Mode.IDLE;\n                            showText();\n                            const p1 = e.detail.handler.startPoints.point;\n                            const p2 = e.detail.p;\n                            const delta = 1;\n                            const dx2 = (p1.x - p2.x) ** 2;\n                            const dy2 = (p1.y - p2.y) ** 2;\n                            if (Math.sqrt(dx2 + dy2) >= delta) {\n                                state.elements.forEach((element: any) => {\n                                    const elementShape = skeleton.children()\n                                        .find((child: SVG.Shape) => (\n                                            child.id() === `cvat_canvas_shape_${element.clientID}`\n                                        ));\n\n                                    if (elementShape) {\n                                        const points = readPointsFromShape(elementShape);\n                                        element.points = this.translateFromCanvas(points);\n                                    }\n                                });\n\n                                this.canvas.dispatchEvent(\n                                    new CustomEvent('canvas.dragshape', {\n                                        bubbles: false,\n                                        cancelable: true,\n                                        detail: {\n                                            id: state.clientID,\n                                        },\n                                    }),\n                                );\n                                this.onEditDone(state, state.points);\n                            }\n                        });\n                    });\n            } else {\n                (wrappingRect as any).off('dragstart');\n                (wrappingRect as any).off('dragend');\n                (wrappingRect as any).draggable(false);\n            }\n\n            return skeleton;\n        };\n\n        (skeleton as any).resize = (action: any) => {\n            const textList = [\n                state.clientID, ...state.elements.map((element: any): number => element.clientID),\n            ].map((clientID: number) => this.svgTexts[clientID]).filter((text: SVG.Text | undefined) => (\n                typeof text !== 'undefined'\n            ));\n\n            const hideText = (): void => {\n                textList.forEach((text: SVG.Text) => {\n                    text.addClass('cvat_canvas_hidden');\n                });\n            };\n\n            const showText = (): void => {\n                textList.forEach((text: SVG.Text) => {\n                    text.removeClass('cvat_canvas_hidden');\n                    this.updateTextPosition(text);\n                });\n            };\n\n            Object.entries(svgElements).forEach(([key, element]) => {\n                const clientID = +key;\n                const elementState = state.elements\n                    .find((_element: any) => _element.clientID === clientID);\n                const text = this.svgTexts[clientID];\n                const hideElementText = (): void => {\n                    if (text) {\n                        text.addClass('cvat_canvas_hidden');\n                    }\n                };\n\n                const showElementText = (): void => {\n                    if (text) {\n                        text.removeClass('cvat_canvas_hidden');\n                        this.updateTextPosition(text);\n                    }\n                };\n\n                if (action !== 'stop' && !elementState.lock) {\n                    (element as any).draggable()\n                        .on('dragstart', (): void => {\n                            this.mode = Mode.RESIZE;\n                            hideElementText();\n                            element.on('remove.drag', (): void => {\n                                this.mode = Mode.IDLE;\n                                // disable internal drag events of SVG.js\n                                window.dispatchEvent(new MouseEvent('mouseup'));\n                                element.off('remove.drag');\n                            });\n                        })\n                        .on('dragmove', (): void => {\n                            // element itself is not updated yet, need to run as macrotask\n                            setTimeout(() => {\n                                setupSkeletonEdges(skeleton, SVGElement);\n                            });\n                        })\n                        .on('dragend', (e: CustomEvent): void => {\n                            setTimeout(() => {\n                                element.off('remove.drag');\n                                this.mode = Mode.IDLE;\n                                const p1 = e.detail.handler.startPoints.point;\n                                const p2 = e.detail.p;\n                                const delta = 1;\n                                const dx2 = (p1.x - p2.x) ** 2;\n                                const dy2 = (p1.y - p2.y) ** 2;\n                                if (Math.sqrt(dx2 + dy2) >= delta) {\n                                    const elementShape = skeleton.children()\n                                        .find((child: SVG.Shape) => child.id() === `cvat_canvas_shape_${clientID}`);\n\n                                    if (elementShape) {\n                                        const points = readPointsFromShape(elementShape);\n                                        this.canvas.dispatchEvent(\n                                            new CustomEvent('canvas.resizeshape', {\n                                                bubbles: false,\n                                                cancelable: true,\n                                                detail: {\n                                                    id: elementState.clientID,\n                                                },\n                                            }),\n                                        );\n                                        this.onEditDone(elementState, this.translateFromCanvas(points));\n                                    }\n                                }\n\n                                showElementText();\n                            });\n                        });\n                } else {\n                    (element as any).off('dragstart');\n                    (element as any).off('dragend');\n                    (element as any).draggable(false);\n                }\n            });\n\n            let resized = false;\n            if (action !== 'stop') {\n                (wrappingRect as any).resize(action).on('resizestart', (): void => {\n                    this.mode = Mode.RESIZE;\n                    resized = false;\n                    hideText();\n                    (wrappingRect as any).on('remove.resize', () => {\n                        this.mode = Mode.IDLE;\n                        showText();\n\n                        // disable internal resize events of SVG.js\n                        window.dispatchEvent(new MouseEvent('mouseup'));\n                        this.mode = Mode.IDLE;\n                    });\n                }).on('resizing', (e: CustomEvent): void => {\n                    setTimeout(() => {\n                        const { instance } = e.target as any;\n\n                        // rotate skeleton instead of wrapping bounding box\n                        const { rotation } = wrappingRect.transform();\n                        skeleton.rotate(rotation);\n\n                        const [x, y] = [instance.x(), instance.y()];\n                        const prevXtl = +wrappingRect.attr('data-xtl');\n                        const prevYtl = +wrappingRect.attr('data-ytl');\n                        const prevXbr = +wrappingRect.attr('data-xbr');\n                        const prevYbr = +wrappingRect.attr('data-ybr');\n\n                        if (prevXbr - prevXtl < 0.1) return;\n                        if (prevYbr - prevYtl < 0.1) return;\n\n                        for (const child of skeleton.children()) {\n                            if (child.type === 'circle') {\n                                const childClientID = child.attr('data-client-id');\n                                if (state.elements.find((el: any) => el.clientID === childClientID).lock || false) {\n                                    continue;\n                                }\n                                const offsetX = (child.cx() - prevXtl) / (prevXbr - prevXtl);\n                                const offsetY = (child.cy() - prevYtl) / (prevYbr - prevYtl);\n                                child.center(offsetX * instance.width() + x, offsetY * instance.height() + y);\n                            }\n                        }\n\n                        wrappingRect.attr('data-xtl', x);\n                        wrappingRect.attr('data-ytl', y);\n                        wrappingRect.attr('data-xbr', x + instance.width());\n                        wrappingRect.attr('data-ybr', y + instance.height());\n\n                        resized = true;\n                        setupSkeletonEdges(skeleton, SVGElement);\n                    });\n                }).on('resizedone', (): void => {\n                    setTimeout(() => {\n                        let { rotation } = skeleton.transform();\n                        // be sure, that rotation in range [0; 360]\n                        while (rotation < 0) rotation += 360;\n                        rotation %= 360;\n                        showText();\n                        this.mode = Mode.IDLE;\n                        (wrappingRect as any).off('remove.resize');\n                        if (resized) {\n                            if (rotation) {\n                                this.onEditDone(state, state.points, rotation);\n                            } else {\n                                const points: number[] = [];\n\n                                state.elements.forEach((element: any) => {\n                                    const elementShape = skeleton.children()\n                                        .find((child: SVG.Shape) => (\n                                            child.id() === `cvat_canvas_shape_${element.clientID}`\n                                        ));\n\n                                    if (elementShape) {\n                                        points.push(...this.translateFromCanvas(\n                                            readPointsFromShape(elementShape),\n                                        ));\n                                    }\n                                });\n\n                                this.onEditDone(state, points, rotation);\n                            }\n\n                            this.canvas.dispatchEvent(\n                                new CustomEvent('canvas.resizeshape', {\n                                    bubbles: false,\n                                    cancelable: true,\n                                    detail: {\n                                        id: state.clientID,\n                                    },\n                                }),\n                            );\n                        }\n                    });\n                });\n            } else if (action === 'stop') {\n                (wrappingRect as any).off('resizestart');\n                (wrappingRect as any).off('resizing');\n                (wrappingRect as any).off('resizedone');\n                (wrappingRect as any).resize('stop');\n            }\n\n            return skeleton;\n        };\n\n        return skeleton;\n    }\n\n    private setupPoints(basicPolyline: SVG.PolyLine, state: any): any {\n        this.selectize(true, basicPolyline);\n\n        const group: SVG.G = basicPolyline\n            .remember('_selectHandler')\n            .nested.addClass('cvat_canvas_shape')\n            .attr({\n                clientID: state.clientID,\n                id: `cvat_canvas_shape_${state.clientID}`,\n                'data-polyline-id': basicPolyline.attr('id'),\n                'data-z-order': state.zOrder,\n            });\n\n        group.on('click.canvas', (event: MouseEvent): void => {\n            // Need to redispatch the event on another element\n            basicPolyline.fire(new MouseEvent('click', event));\n            // redispatch event to canvas to be able merge points clicking them\n            this.content.dispatchEvent(new MouseEvent('click', event));\n        });\n\n        group.bbox = basicPolyline.bbox.bind(basicPolyline);\n        group.clone = basicPolyline.clone.bind(basicPolyline);\n\n        return group;\n    }\n\n    private addEllipse(points: string, state: any): SVG.Rect {\n        const [cx, cy, rightX, topY] = points.split(/[/,\\s]/g).map((coord) => +coord);\n        const [rx, ry] = [rightX - cx, cy - topY];\n        const rect = this.adoptedContent\n            .ellipse(rx * 2, ry * 2)\n            .attr({\n                clientID: state.clientID,\n                'color-rendering': 'optimizeQuality',\n                id: `cvat_canvas_shape_${state.clientID}`,\n                'shape-rendering': 'geometricprecision',\n                'stroke-width': consts.BASE_STROKE_WIDTH / this.geometry.scale,\n                'data-z-order': state.zOrder,\n                ...this.getShapeColorization(state),\n            })\n            .center(cx, cy)\n            .addClass('cvat_canvas_shape');\n\n        if (state.rotation) {\n            rect.rotate(state.rotation);\n        }\n\n        if (state.occluded) {\n            rect.addClass('cvat_canvas_shape_occluded');\n        }\n\n        if (state.hidden || state.outside || this.isInnerHidden(state.clientID)) {\n            rect.addClass('cvat_canvas_hidden');\n        }\n\n        if (state.isGroundTruth) {\n            rect.addClass('cvat_canvas_ground_truth');\n        }\n\n        return rect;\n    }\n\n    private addPoints(points: string, state: any): SVG.PolyLine {\n        const shape = this.adoptedContent\n            .polyline(points)\n            .attr({\n                'color-rendering': 'optimizeQuality',\n                'pointer-events': 'none',\n                'shape-rendering': 'geometricprecision',\n                'stroke-width': 0,\n                ...this.getShapeColorization(state),\n            }).style({\n                opacity: 0,\n            });\n\n        const group = this.setupPoints(shape, state);\n\n        if (state.hidden || state.outside || this.isInnerHidden(state.clientID)) {\n            group.addClass('cvat_canvas_hidden');\n        }\n\n        if (state.occluded) {\n            group.addClass('cvat_canvas_shape_occluded');\n        }\n\n        if (state.isGroundTruth) {\n            group.addClass('cvat_canvas_ground_truth');\n        }\n\n        shape.remove = (): SVG.PolyLine => {\n            this.selectize(false, shape);\n            shape.constructor.prototype.remove.call(shape);\n            return shape;\n        };\n\n        return shape;\n    }\n}\n","// Copyright (C) 2019-2022 Intel Corporation\n// Copyright (C) 2022 CVAT.ai Corporation\n//\n// SPDX-License-Identifier: MIT\n\nimport {\n    Mode,\n    DrawData,\n    MergeData,\n    SplitData,\n    GroupData,\n    MasksEditData,\n    InteractionData as _InteractionData,\n    InteractionResult as _InteractionResult,\n    CanvasModel,\n    CanvasModelImpl,\n    RectDrawingMethod,\n    CuboidDrawingMethod,\n    Configuration,\n    Geometry,\n    HighlightSeverity as _HighlightSeverity,\n} from './canvasModel';\nimport { Master } from './master';\nimport { CanvasController, CanvasControllerImpl } from './canvasController';\nimport { CanvasView, CanvasViewImpl } from './canvasView';\n\nimport '../scss/canvas.scss';\nimport pjson from '../../package.json';\n\nconst CanvasVersion = pjson.version;\n\ninterface Canvas {\n    html(): HTMLDivElement;\n    setup(frameData: any, objectStates: any[], zLayer?: number): void;\n    setupIssueRegions(issueRegions: Record<number, { hidden: boolean; points: number[] }>): void;\n    setupConflictRegions(clientID: number): number[];\n    activate(clientID: number | null, attributeID?: number): number[];\n    highlight(clientIDs: number[] | null, severity: HighlightSeverity | null): void;\n    rotate(rotationAngle: number): void;\n    focus(clientID: number, padding?: number): void;\n    fit(): void;\n    grid(stepX: number, stepY: number): void;\n\n    interact(interactionData: InteractionData): void;\n    draw(drawData: DrawData): void;\n    edit(editData: MasksEditData): void;\n    group(groupData: GroupData): void;\n    split(splitData: SplitData): void;\n    merge(mergeData: MergeData): void;\n    select(objectState: any): void;\n\n    fitCanvas(): void;\n    bitmap(enable: boolean): void;\n    selectRegion(enable: boolean): void;\n    dragCanvas(enable: boolean): void;\n    zoomCanvas(enable: boolean): void;\n\n    mode(): Mode;\n    cancel(): void;\n    configure(configuration: Configuration): void;\n    isAbleToChangeFrame(): boolean;\n    destroy(): void;\n\n    readonly geometry: Geometry;\n}\n\nclass CanvasImpl implements Canvas {\n    private model: CanvasModel & Master;\n    private controller: CanvasController;\n    private view: CanvasView;\n\n    public constructor() {\n        this.model = new CanvasModelImpl();\n        this.controller = new CanvasControllerImpl(this.model);\n        this.view = new CanvasViewImpl(this.model, this.controller);\n    }\n\n    public html(): HTMLDivElement {\n        return this.view.html();\n    }\n\n    public setup(frameData: any, objectStates: any[], zLayer = 0): void {\n        this.model.setup(frameData, objectStates, zLayer);\n    }\n\n    public setupIssueRegions(issueRegions: Record<number, { hidden: boolean; points: number[] }>): void {\n        this.model.setupIssueRegions(issueRegions);\n    }\n\n    public setupConflictsRegions(clientID: number): number[] {\n        return this.view.setupConflictsRegions(clientID);\n    }\n\n    public fitCanvas(): void {\n        this.model.fitCanvas(this.view.html().clientWidth, this.view.html().clientHeight);\n    }\n\n    public bitmap(enable: boolean): void {\n        this.model.bitmap(enable);\n    }\n\n    public selectRegion(enable: boolean): void {\n        this.model.selectRegion(enable);\n    }\n\n    public dragCanvas(enable: boolean): void {\n        this.model.dragCanvas(enable);\n    }\n\n    public zoomCanvas(enable: boolean): void {\n        this.model.zoomCanvas(enable);\n    }\n\n    // @ts-ignore\n    public activate(clientID: number | null, attributeID: number | null = null): void {\n        this.model.activate(clientID, attributeID);\n    }\n\n    public highlight(clientIDs: number[] | null, severity: HighlightSeverity | null = null): void {\n        this.model.highlight(clientIDs, severity);\n    }\n\n    public rotate(rotationAngle: number): void {\n        this.model.rotate(rotationAngle);\n    }\n\n    public focus(clientID: number, padding = 0): void {\n        this.model.focus(clientID, padding);\n    }\n\n    public fit(): void {\n        this.model.fit();\n    }\n\n    public grid(stepX: number, stepY: number): void {\n        this.model.grid(stepX, stepY);\n    }\n\n    public interact(interactionData: InteractionData): void {\n        this.model.interact(interactionData);\n    }\n\n    public draw(drawData: DrawData): void {\n        this.model.draw(drawData);\n    }\n\n    public edit(editData: MasksEditData): void {\n        this.model.edit(editData);\n    }\n\n    public split(splitData: SplitData): void {\n        this.model.split(splitData);\n    }\n\n    public group(groupData: GroupData): void {\n        this.model.group(groupData);\n    }\n\n    public merge(mergeData: MergeData): void {\n        this.model.merge(mergeData);\n    }\n\n    public select(objectState: any): void {\n        this.model.select(objectState);\n    }\n\n    public mode(): Mode {\n        return this.model.mode;\n    }\n\n    public cancel(): void {\n        this.model.cancel();\n    }\n\n    public configure(configuration: Configuration): void {\n        this.model.configure(configuration);\n    }\n\n    public isAbleToChangeFrame(): boolean {\n        return this.model.isAbleToChangeFrame();\n    }\n\n    public get geometry(): Geometry {\n        return this.model.geometry;\n    }\n\n    public destroy(): void {\n        this.model.destroy();\n    }\n}\n\nexport type InteractionData = _InteractionData;\nexport type InteractionResult = _InteractionResult;\nexport type HighlightSeverity = _HighlightSeverity;\n\nexport {\n    CanvasImpl as Canvas, CanvasVersion, RectDrawingMethod, CuboidDrawingMethod, Mode as CanvasMode,\n};\n"],"names":["___CSS_LOADER_URL_IMPORT_0___","URL","___CSS_LOADER_EXPORT___","___CSS_LOADER_URL_REPLACEMENT_0___","push","module","id","exports","cssWithMappingToString","list","toString","this","map","item","content","needLayer","concat","length","join","i","modules","media","dedupe","supports","layer","undefined","alreadyImportedModules","k","_k","url","options","String","__esModule","default","test","slice","hash","needQuotes","replace","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","data","sourceMapping","global","sqrt","atan2","pow","PiBy180","PiBy2","couldUseAttachEvent","touchEvents","parseEl","supportsOpacity","supportsFilters","reOpacity","setOpacity","proto","min","max","degreesToRadians","originXOffset","originYOffset","clone","toFixed","multipleSpacesRegex","fabric","version","document","window","HTMLDocument","Document","implementation","createHTMLDocument","virtualWindow","JSDOM","decodeURIComponent","features","FetchExternalResources","resources","jsdomImplForWrapper","nodeCanvas","DOMParser","copyGLTo2DDrawImage","gl","pipelineState","glCanvas","canvas","targetCanvas","ctx","getContext","translate","height","scale","sourceY","drawImage","width","copyGLTo2DPutImageData","dWidth","destinationWidth","dHeight","destinationHeight","numBytes","u8","Uint8Array","imageBuffer","u8Clamped","Uint8ClampedArray","readPixels","RGBA","UNSIGNED_BYTE","imgData","ImageData","putImageData","isTouchSupported","navigator","maxTouchPoints","isLikelyNode","Buffer","SHARED_ATTRIBUTES","DPI","reNum","commaWsp","rePathCommand","reNonWord","fontPaths","iMatrix","svgNS","perfLimitSizeTotal","maxCacheSideLimit","minCacheSideLimit","charWidthsCache","textureSize","disableStyleCopyPaste","enableGLFiltering","devicePixelRatio","webkitDevicePixelRatio","mozDevicePixelRatio","browserShadowBlurConstant","arcToSegmentsCache","boundsOfCurveCache","cachesBoundsOfCurve","forceGLPutImageData","initFilterBackend","isWebglSupported","console","log","maxTextureSize","WebglFilterBackend","tileSize","Canvas2dFilterBackend","_removeEventListener","eventName","handler","__eventListeners","eventListener","indexOf","util","array","fill","_once","_handler","apply","arguments","off","bind","on","Observable","fire","listenersForEvent","len","call","filter","value","prop","once","Collection","_objects","add","_onObjectAdded","renderOnAddRemove","requestRenderAll","insertAt","object","index","nonSplicing","objects","splice","remove","somethingRemoved","_onObjectRemoved","forEachObject","callback","context","getObjects","type","o","isEmpty","size","contains","deep","some","obj","complexity","reduce","memo","current","CommonMethods","_setOptions","set","_initGradient","filler","property","colorStops","Gradient","_initPattern","source","Pattern","_setObject","_set","key","toggle","get","Math","PI","cos","angle","sin","sign","removeFromArray","idx","getRandomInt","floor","random","degrees","radiansToDegrees","radians","rotatePoint","point","origin","newPoint","Point","x","y","v","rotateVector","addEquals","vector","createVector","from","to","calcAngleBetweenVectors","a","b","acos","hypot","getHatVector","multiply","getBisector","A","B","C","AB","AC","alpha","phi","projectStrokeOnPoints","points","openPath","coords","s","strokeWidth","strokeUniformScalar","strokeUniform","scaleX","scaleY","getStrokeHatVector","scalar","forEach","p","miterVector","bisector","bisectorVector","strokeLineJoin","strokeMiterLimit","subtract","SQRT2","transformPoint","t","ignoreOffset","makeBoundingBoxFromPoints","transform","xPoints","minX","yPoints","minY","left","top","invertTransform","r","number","fractionDigits","parseFloat","Number","parseUnit","fontSize","unit","exec","Text","DEFAULT_SVG_FONT_SIZE","falseFunction","getKlass","namespace","string","camelize","charAt","toUpperCase","resolveNamespace","getSvgAttributes","attributes","parts","split","loadImage","crossOrigin","img","createImage","onLoadCallback","onload","onerror","src","substring","loadImageInDom","div","createElement","style","position","appendChild","querySelector","parentNode","removeChild","enlivenObjects","reviver","enlivenedObjects","numLoadedObjects","numTotalObjects","onLoaded","fromObject","error","enlivenObjectEnlivables","enlivenProps","Object","ENLIVEN_PROPS","enlivedProps","enlivenPatterns","patterns","numLoadedPatterns","numPatterns","enlivenedPatterns","pattern","groupSVGElements","elements","path","sourcePath","centerPoint","Group","populateWithProperties","destination","properties","Array","isArray","createCanvasElement","copyCanvasElement","newCanvas","toDataURL","canvasEl","format","quality","multiplyTransformMatrices","is2x2","qrDecompose","denom","skewX","skewY","translateX","translateY","calcRotateMatrix","theta","calcDimensionsMatrix","scaleMatrix","flipX","flipY","tan","composeMatrix","matrix","resetObjectTransform","target","rotate","saveObjectTransform","isTransparent","tolerance","_isTransparent","imageData","getImageData","l","parsePreserveAspectRatioAttribute","attribute","align","meetOrSlice","aspectRatioAttrs","pop","alignX","alignY","clearFabricFontCache","fontFamily","toLowerCase","limitDimsByArea","ar","maximumArea","roughWidth","perfLimitSizeY","capValue","findScaleToFit","findScaleToCover","matrixToSVG","NUM_FRACTION_DIGITS","removeTransformFromObject","inverted","finalTransform","calcOwnMatrix","applyTransformToObject","addTransformToObject","center","setPositionByOrigin","sizeAfterTransform","dimX","dimY","transformMatrix","bbox","mergeClipPaths","c1","c2","calcTransformMatrix","clipPath","hasStyleChanged","prevStyle","thisStyle","forTextSpans","stroke","fontWeight","fontStyle","textBackgroundColor","deltaY","overline","underline","linethrough","stylesToArray","styles","text","textLines","charIndex","stylesArray","c","keys","start","end","stylesFromArray","styleIndex","stylesObject","assign","_join","prototype","commandLengths","m","h","q","repeatedCommands","M","segmentToBezier","th2","th3","cosTh","sinTh","rx","ry","cx1","cy1","mT","fromX","fromY","costh2","sinth2","costh3","sinth3","toX","toY","calcVectorAngle","ux","uy","vx","vy","ta","tb","fromArcToBeziers","fx","fy","rot","large","sweep","segsNorm","rotateX","th","px","py","rx2","abs","ry2","py2","px2","pl","root","cx","cy","mTheta","dtheta","segments","ceil","result","mDelta","arcToSegments","calcLineLength","x1","y1","x2","y2","getPointOnCubicBezierIterator","p1x","p1y","p2x","p2y","p3x","p3y","p4x","p4y","pct","CB2","c3","CB3","c4","CB4","getTangentCubicIterator","invT","tangentX","tangentY","getPointOnQuadraticBezierIterator","QB2","QB3","getTangentQuadraticIterator","pathIterator","iterator","perc","tempP","tmpLen","getPathSegmentsInfo","tempInfo","angleFinder","totalLength","info","command","destX","destY","joinPath","pathData","segment","parsePath","pathString","currentPath","parsed","match","coordsStr","re","rNumber","rNumberCommaWsp","rFlagCommaWsp","regArcArgumentSequence","RegExp","coordsParsed","trim","args","j","jlen","isNaN","commandLength","repeatedCommand","klen","makePathSimpler","converted","previous","controlX","controlY","destinationPath","getSmoothPathFromPoints","correction","p1","p2","multSignX","multSignY","manyPoints","eq","midPoint","midPointFrom","getBoundsOfCurve","x0","y0","x3","y3","argsString","t1","t2","b2ac","sqrtb2ac","tvalues","bounds","mt","getPointOnPath","distance","infos","segInfo","segPercent","lerp","nextLen","lastPerc","nextStep","findPercentageForDistance","transformPath","pathOffset","pathSegment","newSegment","find","byProperty","condition","invoke","method","value1","value2","extend","Element","hasOwnProperty","getWholeChar","str","code","charCodeAt","next","prev","character","capitalize","firstLetterOnly","escapeXml","graphemeSplit","textstring","chr","graphemes","emptyFunction","IS_DONTENUM_BUGGY","addMethods","klass","parent","superclass","constructor","returnValue","valueOf","Subclass","callSuper","methodName","parentMethod","_this","superClassMethod","createClass","initialize","shift","subclasses","attachEvent","addListener","element","addEventListener","removeListener","removeEventListener","getPointer","event","scroll","getScrollLeftTop","_evt","touchProp","changedTouches","getTouchInfo","clientX","clientY","isTouchEvent","pointerType","opacity","es","currentStyle","hasLayout","zoom","setStyle","elementStyle","cssText","normalizedProperty","styleFloat","setProperty","sliceCanConvertNodelists","getElementStyle","selectProp","_slice","toArray","arrayLike","childNodes","err","makeElement","tagName","el","className","htmlFor","setAttribute","docElement","documentElement","body","scrollLeft","scrollTop","host","nodeType","arr","defaultView","getComputedStyle","attr","makeElementUnselectable","onselectstart","unselectable","makeElementSelectable","setImageSmoothing","imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled","oImageSmoothingEnabled","getById","getElementById","addClass","wrapElement","wrapper","replaceChild","getElementOffset","docElem","scrollLeftTop","doc","ownerDocument","box","offset","offsetAttributes","borderLeftWidth","borderTopWidth","paddingLeft","paddingTop","parseInt","getBoundingClientRect","clientLeft","clientTop","getNodeCanvas","impl","_canvas","_image","cleanUpJsdomNode","_currentSrc","_attributes","_classList","emptyFn","request","onComplete","xhr","XMLHttpRequest","parameters","onreadystatechange","readyState","param","addParamToUrl","open","setRequestHeader","send","warn","RUNNING_ANIMATIONS","noop","defaultEasing","d","cancelAll","animations","animation","cancel","cancelByCanvas","cancelled","cancelByTarget","findAnimationsByTarget","findAnimationIndex","cancelFunc","findAnimation","_requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","setTimeout","_cancelAnimFrame","cancelAnimationFrame","clearTimeout","requestAnimFrame","animate","removeFromRegistry","runningAnimations","currentValue","startValue","completionRate","durationRate","timestamp","time","Date","duration","finish","onChange","abort","easing","isMany","endValue","byValue","onStart","tick","ticktime","currentTime","timePerc","_value","valuePerc","cancelAnimFrame","calculateColor","begin","pos","color","animateColor","fromColor","toColor","startColor","Color","getSource","endColor","originalOnComplete","originalOnChange","colorEasing","normalize","asin","elastic","opts","easeInBounce","easeOutBounce","ease","easeInQuad","easeOutQuad","easeInOutQuad","easeInCubic","easeOutCubic","easeInOutCubic","easeInQuart","easeOutQuart","easeInOutQuart","easeInQuint","easeOutQuint","easeInOutQuint","easeInSine","easeOutSine","easeInOutSine","easeInExpo","easeOutExpo","easeInOutExpo","easeInCirc","easeOutCirc","easeInOutCirc","easeInElastic","easeOutElastic","easeInOutElastic","easeInBack","easeOutBack","easeInOutBack","easeInOutBounce","attributesMap","display","visibility","colorAttributes","fSize","cPath","normalizeAttr","normalizeValue","parentAttributes","parseTransformAttribute","visible","fillIndex","strokeIndex","getSvgRegex","_getMultipleNodes","nodeNames","nodeName","nodeList","nodeArray","getElementsByTagName","elementMatchesRule","selectors","firstMatching","parentMatching","selectorMatches","selector","doesSomeParentMatch","matcher","classNames","getAttribute","elementById","node","nodelist","svgValidTagNamesRegEx","svgViewBoxElementsRegEx","svgInvalidAncestorsRegEx","svgValidParentsRegEx","cssRules","gradientDefs","clipPaths","skewMatrix","reTransformList","reTransform","attributeValue","matrices","operation","translateMatrix","rotateMatrix","multiplierX","multiplierY","combinedMatrix","reViewBoxAttrValue","applyViewboxTransform","viewBoxWidth","viewBoxHeight","viewBoxAttr","widthAttr","heightAttr","preserveAspectRatio","missingViewBox","missingDimAttr","toBeParsed","parsedDim","widthDiff","heightDiff","removeAttribute","createElementNS","firstChild","recursivelyParseGradientsXlink","gradient","xlinkAttr","referencedGradient","hasAttribute","children","referenceClone","cloneNode","parseSVGDocument","parsingOptions","xlinkAttribute","attrs","xlink","el2","currentTrans","oldLength","el3","setAttributeNS","nodeValue","parseUseDirectives","svgUid","__uid","descendants","selectNodes","hasAncestorWithNodeName","getGradientDefs","getCSSRules","parseElements","instances","reFontDeclaration","parseFontDeclaration","oStyle","lineHeight","elList","parseAttributes","parentFontSize","ownAttributes","cssAttrs","rule","getGlobalStylesForElement","parseStyleAttribute","normalizedAttr","normalizedValue","normalizedStyle","font","mergedAttrs","setAlpha","getAlpha","toRgba","_setStrokeFillOpacity","ElementsParser","parse","chunk","pair","parseStyleString","parseStyleObject","parsePointsAttribute","parsedPoints","allRules","styleContents","textContent","ruleObj","propertyValuePairs","_rule","loadSVGFromURL","xml","responseXML","results","_options","allElements","loadSVGFromString","parseFromString","regexUrl","numElements","createObjects","createObject","findTag","fromElement","createCallback","checkIfDone","resolveGradient","Image","_originalElement","_removeTransformMatrix","resolveClipPath","extractPropertyDefinition","storage","regex","lastIndex","gradientDef","opacityAttr","createClipPathCallback","container","_newObj","fillRule","clipRule","usingElement","objTransformInv","gTransform","clipPathTag","clipPathOwner","that","scalarAdd","scalarAddEquals","subtractEquals","scalarSubtract","scalarSubtractEquals","multiplyEquals","divide","divideEquals","lt","lte","gt","gte","distanceFrom","dx","dy","setXY","setX","setY","setFromPoint","swap","Intersection","status","appendPoint","appendPoints","intersectLineLine","a1","a2","b1","b2","uaT","ubT","uB","ua","ub","intersectLinePolygon","inter","intersectPolygonPolygon","points1","points2","intersectPolygonRectangle","r1","r2","topRight","bottomLeft","inter1","inter2","inter3","inter4","_tryParsingColor","setSource","hue2rgb","colorNameMap","sourceFromHex","sourceFromRgb","sourceFromHsl","_rgbToHsl","g","round","_source","toRgb","toHsl","hsl","toHsla","toHex","toHexa","toGrayscale","average","currentAlpha","toBlackWhite","threshold","overlayWith","otherColor","otherSource","reRGBa","reHSLa","reHex","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgrey","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgrey","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","fromRgb","fromSource","fromRgba","fromHsl","fromHsla","fromHex","isShortNotation","isRGBa","oColor","scaleMap","skewMap","controls","LEFT","TOP","RIGHT","BOTTOM","CENTER","opposite","bottom","right","findCornerQuadrant","fabricObject","control","cornerAngle","fireEvent","canvasOptions","scaleIsProportional","eventData","uniformIsToggled","uniScaleKey","uniformScaling","isTransformCentered","originX","originY","scalingIsForbidden","by","scaleProportionally","lockX","lockScalingX","lockY","lockScalingY","commonEventInfo","e","pointer","wrapWithFixedAnchor","actionHandler","getCenterPoint","constraint","translateToOriginPoint","actionPerformed","wrapWithFireEvent","getLocalPoint","corner","getZoom","padding","localPoint","toLocalPoint","offsetX","offsetY","targetHasOneFlip","compensateScaleForSkew","oppositeSkew","scaleToCompensate","axis","reference","newValue","_getTransformedDimensions","skewObjectX","newSkew","dimNoSkew","totalSkewSize","currentSkew","hasSkewed","dimBeforeSkewing","skewObjectY","scaleObject","dim","signX","signY","forbidScaling","gestureScale","lockScalingFlip","original","oldScaleX","oldScaleY","scaleCursorStyleHandler","n","skewCursorStyleHandler","notAllowed","lockSkewingY","lockSkewingX","scaleSkewCursorStyleHandler","altActionKey","rotationWithSnapping","pivotPoint","lockRotation","hasRotated","lastAngle","ey","ex","curAngle","snapAngle","snapThreshold","rightAngleLocked","leftAngleLocked","scalingEqually","scalingX","scalingY","scalingYOrSkewingX","skewHandlerX","scalingXOrSkewingY","skewHandlerY","changeWidth","strokePadding","multiplier","oldWidth","newWidth","finalHandler","dragHandler","newLeft","newTop","moveX","moveY","scaleOrSkewActionName","isAlternative","rotationStyleHandler","cursorStyle","controlsUtils","renderCircleControl","styleOverride","xSize","sizeX","cornerSize","ySize","sizeY","transparentCorners","cornerStrokeColor","myLeft","myTop","save","fillStyle","cornerColor","strokeStyle","lineWidth","beginPath","arc","restore","renderSquareControl","xSizeBy2","ySizeBy2","strokeRect","Control","actionName","touchSizeX","touchSizeY","withConnection","mouseDownHandler","mouseUpHandler","getActionHandler","getMouseDownHandler","getMouseUpHandler","cursorStyleHandler","getActionName","getVisibility","controlKey","objectVisibility","_controlsVisibility","setVisibility","positionHandler","finalMatrix","calcCornerCoords","objectAngle","objectCornerSize","centerX","centerY","isTouch","cosHalfOffset","sinHalfOffset","cosHalfOffsetComp","sinHalfOffsetComp","controlTriangleAngle","cornerHypotenuse","newTheta","newThetaComp","tl","tr","bl","br","render","cornerStyle","getColorStop","colorAlpha","keyValuePairs","gradientTransform","gradientUnits","option","addColorStop","toObject","propertiesToInclude","toSVG","markup","commonAttributes","needsSwap","withViewport","additionalTransform","sort","reverse","minRadius","percentageShift","colorStop","toLive","createLinearGradient","createRadialGradient","instance","svgOptions","colorStopEls","getLinearCoords","getRadialCoords","propValue","finalValue","__convertPercentUnitsToValues","repeat","patternTransform","setOptions","isError","patternSource","patternWidth","patternHeight","patternOffsetX","patternOffsetY","patternImgSrc","complete","naturalWidth","naturalHeight","createPattern","Shadow","blur","affectStroke","includeDefaultValues","nonScaling","_parseShadow","shadow","shadowStr","offsetsAndBlur","reOffsetsAndBlur","fBoxX","fBoxY","StaticCanvas","CANVAS_INIT_ERROR","Error","renderAndResetBound","renderAndReset","requestRenderAllBound","_initStatic","backgroundColor","backgroundImage","overlayColor","overlayImage","stateful","controlsAboveOverlay","allowTouchScrolling","viewportTransform","backgroundVpt","overlayVpt","enableRetinaScaling","vptCoords","skipOffscreen","cb","_createLowerCanvas","_initOptions","interactive","_initRetinaScaling","setOverlayImage","setBackgroundImage","setBackgroundColor","setOverlayColor","calcOffset","_isRetinaScaling","getRetinaScaling","scaleRatio","__initRetinaScaling","lowerCanvasEl","contextContainer","upperCanvasEl","contextTop","_offset","image","__setBgOverlayImage","__setBgOverlayColor","_createCanvasElement","_originalCanvasStyle","_applyCanvasStyle","getWidth","getHeight","setWidth","setDimensions","setHeight","dimensions","cssValue","cssOnly","_setBackstoreDimension","hasLostContext","backstoreOnly","_setCssDimension","_isCurrentlyDrawing","freeDrawingBrush","_setBrushStyles","cacheCanvasEl","wrapperEl","setViewportTransform","vpt","activeObject","_activeObject","backgroundObject","overlayObject","group","setCoords","calcViewportBoundaries","zoomToPoint","before","after","setZoom","absolutePan","relativePan","getElement","setupState","clearContext","clearRect","clear","_hasITextHandlers","_mouseUpITextHandler","_iTextInstances","renderAll","canvasToDrawOn","renderCanvas","isRendering","iVpt","cancelRequestedRender","_renderBackground","_renderObjects","drawControls","shouldCache","_transformDone","renderCache","forClipping","drawClipPathOnCanvas","_renderOverlay","globalCompositeOperation","zoomX","zoomY","_cacheCanvas","cacheTranslationX","cacheTranslationY","_renderBackgroundOrOverlay","needsVpt","moveTo","lineTo","closePath","getCenter","centerObjectH","_centerObject","centerObjectV","centerObject","viewportCenterObject","vpCenter","getVpCenter","viewportCenterObjectH","viewportCenterObjectV","toDatalessJSON","toDatalessObject","_toObjectMethod","_toObjects","excludeFromExport","_toObject","__serializeBgOverlay","originalValue","bgImage","bgColor","background","overlay","svgViewportTransformation","_setSVGPreamble","_setSVGHeader","clipPathId","_setSVGBgOverlayColor","_setSVGBgOverlayImage","_setSVGObjects","suppressPreamble","encoding","viewBox","createSVGFontFacesMarkup","createSVGRefElementsMarkup","createSVGClipPathMarkup","toClipPathSVG","shouldTransform","row","rowIndex","fontList","_setSVGObject","finalWidth","finalHeight","sendToBack","objs","activeSelection","unshift","bringToFront","sendBackwards","intersecting","newIdx","objsMoved","_findNewLowerIndex","intersectsWithObject","isContainedWithinObject","bringForward","_findNewUpperIndex","dispose","classList","DataURLExporter","EMPTY_JSON","setLineDash","toJSON","createPNGStream","createJPEGStream","BaseBrush","strokeLineCap","strokeDashArray","limitedToCanvasSize","lineCap","miterLimit","lineJoin","_saveAndTransform","_setShadow","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","needsFullRender","_resetShadow","_isOutSideCanvas","PencilBrush","decimate","drawStraightLine","straightLineKey","_points","_hasStraightLine","_drawSegment","quadraticCurveTo","onMouseDown","_isMainEvent","_prepareForDrawing","_captureDrawingPath","_render","onMouseMove","oldEnd","onMouseUp","_finalizeAndAddPath","_reset","_addPoint","pointerPoint","convertPointsToSVGPath","_isEmptySVGPath","createPath","Path","decimatePoints","adjustedDistance","lastPoint","newPoints","CircleBrush","drawDot","addPoint","dot","radius","originalRenderOnAddRemove","circles","circle","Circle","circleRadius","circleColor","SprayBrush","density","dotWidth","dotWidthVariance","randomOpacity","optimizeOverlapping","sprayChunks","addSprayChunk","sprayChunkPoints","rects","ilen","sprayChunk","rect","Rect","_getOptimizedRects","uniqueRects","uniqueRectsArray","globalAlpha","fillRect","PatternBrush","getPatternSrc","patternCanvas","patternCtx","getPatternSrcFunction","getPattern","topLeft","_getLeftTopCoords","Canvas","_initInteractive","_createCacheCanvas","centeredScaling","centeredRotation","centeredKey","selection","selectionKey","altSelectionKey","selectionColor","selectionDashArray","selectionBorderColor","selectionLineWidth","selectionFullyContained","hoverCursor","moveCursor","defaultCursor","freeDrawingCursor","notAllowedCursor","containerClass","perPixelTargetFind","targetFindTolerance","skipTargetFind","isDrawingMode","preserveObjectStacking","stopContextMenu","fireRightClick","fireMiddleClick","targets","enablePointerEvents","_hoveredTarget","_hoveredTargets","_currentTransform","_groupSelector","_initWrapperElement","_createUpperCanvas","_initEventListeners","_chooseObjectsToRender","objsToRender","activeGroupObjects","activeObjects","getActiveObjects","contextTopDirty","renderTopLayer","_drawSelection","renderTop","_normalizePointer","invertedM","vptPointer","restorePointerVpt","isTargetTransparent","normalizedPointer","targetRelativeX","targetRelativeY","_cacheContext","contextCache","originalColor","selectionBackgroundColor","_isSelectionKeyPressed","_shouldClearSelection","evented","selectable","_shouldCenterTransform","action","altKey","centerTransform","_getOriginFromCorner","_getActionFromCorner","alreadySelected","_setupCurrentTransform","__corner","lastX","lastY","shiftKey","_beforeTransform","setCursor","cursor","viewportStart","viewportExtent","extent","maxX","maxY","strokeOffset","_setLineDash","findTarget","skipGroup","activeTarget","activeTargetSubs","aObjects","shouldLookForActive","_findTargetCorner","_searchPossibleTargets","_checkTarget","globalPointer","containsPoint","isEditing","subTarget","objToCheck","pointerToUse","subTargetCheck","ignoreZoom","_absolutePointer","_pointer","cssScale","boundsWidth","boundsHeight","retinaScaling","lowerCanvasClass","_copyCanvasStyle","getTopContext","fromEl","toEl","getSelectionContext","getSelectionElement","getActiveObject","active","_discardActiveObject","_fireSelectionEvents","oldObjects","somethingChanged","added","removed","oldObject","selected","deselected","setActiveObject","currentActives","_setActiveObject","onSelect","onDeselect","discardActiveObject","removeListeners","_renderControls","originalProperties","_realizeGroupTransformOnObject","_unwindGroupTransformOnObject","originalValues","clearContextTop","addEventOptions","passive","checkClick","button","mainTouchId","_bindEvents","addOrRemove","_getEventPrefix","functor","eventjsFunctor","canvasElement","eventTypePrefix","_onResize","_onMouseDown","_onMouseMove","_onMouseOut","_onMouseEnter","_onMouseWheel","_onContextMenu","_onDoubleClick","_onDragOver","_onDragEnter","_onDragLeave","_onDrop","_onTouchStart","eventjs","_onGesture","_onDrag","_onOrientationChange","_onShake","_onLongPress","_onMouseUp","_onTouchEnd","eventsBound","_simpleEventHandler","self","__onTransformGesture","__onDrag","__onMouseWheel","_target","__onOrientationChange","__onShake","__onLongPress","preventDefault","_fireEnterLeaveEvents","stopPropagation","_cacheTransformEventData","_handleEvent","_resetTransformEventData","getPointerId","evt","identifier","pointerId","isPrimary","touches","__onMouseDown","__onMouseUp","_willAddMouseDown","__onMouseMove","_shouldRender","groupSelector","shouldRender","isClick","_onMouseUpInDrawingMode","_finalizeCurrentTransform","targetWasActive","_maybeGroupObjects","activeOn","isMoving","originalControl","originalMouseUpHandler","_setCursorFromEvent","eventType","subTargets","absolutePointer","currentTarget","currentSubTargets","_scaling","hasStateChanged","_fire","_onMouseDownInDrawingMode","_onMouseMoveInDrawingMode","_previousPointer","shouldGroup","_shouldGroup","_handleGrouping","saveState","_transformObject","_fireOverOutEvents","fireSyntheticInOutEvents","oldTarget","evtOut","canvasEvtOut","evtIn","canvasEvtIn","_draggedoverTarget","config","inOpt","outOpt","inFires","targetChanged","previousTarget","nextTarget","reset","_performTransformAction","getCornerCursor","_updateActiveSelection","_createActiveSelection","currentActiveObjects","removeWithUpdate","addWithUpdate","_createGroup","groupObjects","exitEditing","ActiveSelection","_groupSelectedObjects","aGroup","_collectObjects","currentObject","selectionX1Y1","selectionX2Y2","allowIntersect","intersectsWithRect","isContainedWithinRect","toCanvasElement","cropping","scaledWidth","scaledHeight","originalWidth","originalHeight","newZoom","vp","originalInteractive","newVp","originalRetina","originalContextTop","loadFromJSON","json","serialized","_enlivenObjects","_setBgOverlay","enlivenedCanvasClip","__setupCanvas","loaded","cbIfLoaded","__setBgOverlay","enlivedObject","_toDataURL","_toDataURLWithMultiplier","toDataURLWithMultiplier","cloneWithoutData","backgroundImageOpacity","backgroundImageStretch","objectCaching","touchCornerSize","borderColor","borderDashArray","cornerDashArray","strokeDashOffset","borderOpacityWhenMoving","borderScaleFactor","minScaleLimit","hasControls","hasBorders","lockMovementX","lockMovementY","statefullCache","noScaleCache","dirty","paintFirst","stateProperties","cacheProperties","colorProperties","absolutePositioned","_cacheProperties","_updateCacheCanvas","_limitCacheSize","dims","limitedDims","capped","_getCacheCanvasDimensions","objectScale","getTotalObjectScaling","neededX","neededY","drawingWidth","drawingHeight","minCacheSize","dimensionsChanged","cacheWidth","cacheHeight","zoomChanged","shouldRedraw","additionalWidth","additionalHeight","shouldResizeCanvas","canvasWidth","canvasHeight","sizeGrowing","getHeightOfLine","setTransform","needFullTransform","_removeDefaultValues","getObjectScaling","retina","getObjectOpacity","shouldConstrainValue","isChanged","groupNeedsUpdate","_constrainScale","isOnACache","setOnGroup","getViewportTransform","isNotVisible","isOnScreen","_setupCompositeOperation","drawSelectionBackground","_setOpacity","drawCacheOnCanvas","_removeCacheCanvas","drawObject","propertySet","isCacheDirty","hasStroke","hasFill","needsItsOwnCache","ownCaching","willDrawShadow","drawClipPathOnCache","originalFill","originalStroke","_setClippingProperties","_drawClipPath","skipCanvas","_getNonTransformedDimensions","_removeShadow","_setStrokeStyles","decl","lineDashOffset","_applyPatternForTransformedGradient","_applyPatternGradientTransform","_setFillStyles","dashArray","drawBorders","forActiveSelection","drawBordersInGroup","scaling","multX","multY","_renderPaintInOrder","_renderStroke","_renderFill","pCtx","pCanvas","_findCenterFromElement","_assignTransformMatrixProps","preserveAspectRatioOptions","cropX","cropY","offsetLeft","offsetTop","objectForm","_fromObject","cloneAsImage","utils","origParams","originalGroup","originalShadow","withoutTransform","withoutShadow","boundingRect","getBoundingRect","shadowOffset","originalCanvas","isType","includes","shouldCenterOrigin","_setOriginToCenter","_resetOrigin","centerH","viewportCenterH","centerV","viewportCenterV","viewportCenter","getLocalPointer","pClicked","objectLeftTop","createAccessors","extraParam","translateToGivenOrigin","fromOriginX","fromOriginY","toOriginX","toOriginY","translateToCenterPoint","leftTop","getPointByOrigin","adjustPosition","offsetFrom","offsetTo","hypotFull","getScaledWidth","xFull","yFull","_originalOriginX","_originalOriginY","originPoint","multiplyMatrices","oCoords","aCoords","lineCoords","ownMatrixCache","matrixCache","_getCoords","absolute","calculate","calcACoords","calcLineCoords","getCoords","pointTL","pointBR","other","otherCoords","lines","_getImageLines","_findCrossPoints","_containsCenterOfCanvas","isPartiallyOnScreen","every","topline","rightline","bottomline","leftline","xi","iLine","xcount","lineKey","getScaledHeight","scaleToWidth","boundingRectFactor","scaleToHeight","cosP","sinP","cosPSinP","cosPMinusSinP","calcOCoords","_calcRotateMatrix","_calcTranslateMatrix","startMatrix","_calculateCurrentDimensions","forEachControl","w","skipCorners","_setCornerCoords","transformMatrixKey","sep","prefix","cache","tMatrix","noSkew","_finalizeDimensions","getSvgColorString","getSvgStyles","skipShadow","getSvgFilter","getSvgSpanStyles","useWhiteSpace","term","textDecoration","getSvgTextDecoration","decoration","getSvgCommons","getSvgTransform","full","_setSVGBg","textBgRects","_getFillAttributes","_createBaseSVGMarkup","_toSVG","_createBaseClipPathSVGMarkup","objectMarkup","commonPieces","clipPathMarkup","noStyle","styleInfo","shadowInfo","withShadow","vectorEffect","absoluteClipPath","addPaintOrder","originalSet","saveProps","props","tmpObj","_isEqual","origValue","firstPass","dashedPropertySet","forTouch","isControlVisible","touchCorner","fn","controlObject","wh","shouldStroke","setControlVisible","setControlsVisibility","FX_DURATION","fxCenterObjectH","callbacks","empty","fxCenterObjectV","fxRemove","skipCallbacks","propsToAnimate","out","_animate","propPair","propIsColor","valueProgress","timeProgress","coordProps","makeEdgeToOriginGetter","propertyNames","originValues","axis1","axis2","dimension","nearest","farthest","Line","_setWidthHeight","_getLeftToOriginX","_getTopToOriginY","calcLinePoints","origStrokeStyle","xMult","yMult","ATTRIBUTE_NAMES","parsedAttributes","startAngle","endAngle","setRadius","svgString","getRadiusX","getRadiusY","Triangle","widthBy2","heightBy2","piBy2","Ellipse","getRx","getRy","_initRxRy","isRounded","bezierCurveTo","Polyline","exactBoundingBox","_setPositionDimensions","_projectStrokeOnPoints","correctLeftTop","calcDim","_calcDimensions","correctSize","fromSVG","diffX","diffY","commonRender","fromElementGenerator","_class","Polygon","_setPath","_renderPathCommands","subpathStartX","subpathStartY","_getOffsetTransform","digits","aX","aY","pathUrl","elivenedObjects","useSetOnGroup","isAlreadyGrouped","_updateObjectsACoords","_calcBounds","_updateObjectsCoords","_updateObjectCoords","objectLeft","objectTop","nested","_restoreObjectsState","_includeDefaultValues","objsToObject","originalDefaults","_obj","ownCache","groupMatrix","destroy","toActiveSelection","ungroupOnCanvas","setObjectsCoords","onlyWidthHeight","iLen","jLen","_getBounds","minXY","maxXY","toGroup","newGroup","childrenOverride","srcFromAttribute","_lastScaleX","_lastScaleY","_filterScalingX","_filterScalingY","minimumScaleTrigger","cacheKey","imageSmoothing","filters","_initElement","_element","setElement","removeTexture","_initConfig","applyFilters","resizeFilter","applyResizeFilters","backend","filterBackend","evictCachesForKey","getCrossOrigin","getOriginalSize","_stroke","filterObj","getSrc","hasCrop","strokeSvg","imageMarkup","imageRendering","getSvgSrc","origFill","filtered","setSrc","minimumScale","elementToFilter","_filteredEl","sourceWidth","sourceHeight","isNeutralState","imgElement","_needsResize","elementToDraw","elWidth","elHeight","sX","sY","sW","sH","maxDestW","maxDestH","_resetWidthHeight","CSS_CANVAS","_initFilters","pAR","rWidth","rHeight","pWidth","pHeight","_object","resizeFilters","fromURL","imgOptions","_getAngleValueForStraighten","straighten","fxStraighten","straightenObject","fxStraightenObject","testPrecision","precision","fragmentSource","fragmentShader","createShader","FRAGMENT_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","setupGLContext","captureGPUInfo","isSupported","getParameter","MAX_TEXTURE_SIZE","precisions","webGlPrecision","createWebGLCanvas","aPosition","Float32Array","chooseFastestCopyGLTo2DMethod","canUseImageData","canMeasurePerf","performance","canUseArrayBuffer","ArrayBuffer","canUseUint8Clamped","copyGLTo2D","startTime","drawImageTime","testContext","now","glOptions","premultipliedAlpha","depth","stencil","antialias","clearColor","cachedTexture","getCachedTexture","sourceTexture","createTexture","targetTexture","originalTexture","passes","webgl","programCache","pass","tempFbo","createFramebuffer","bindFramebuffer","FRAMEBUFFER","applyTo","resizeCanvasIfNeeded","bindTexture","TEXTURE_2D","deleteTexture","deleteFramebuffer","clearWebGLCaches","textureCache","textureImageSource","filterType","texture","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","texImage2D","uniqueId","gpuInfo","renderer","vendor","ext","getExtension","UNMASKED_RENDERER_WEBGL","UNMASKED_VENDOR_WEBGL","sourceElement","originalEl","originalImageData","BaseFilter","vertexSource","createProgram","vertexShader","VERTEX_SHADER","getShaderInfoLog","program","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","attributeLocations","getAttributeLocations","uniformLocations","getUniformLocations","uStepW","getUniformLocation","uStepH","getAttribLocation","sendAttributeData","aPositionData","attributeLocation","buffer","createBuffer","bindBuffer","ARRAY_BUFFER","enableVertexAttribArray","vertexAttribPointer","FLOAT","bufferData","STATIC_DRAW","_setupFrameBuffer","framebufferTexture2D","COLOR_ATTACHMENT0","_swapTextures","temp","main","mainParameter","applyToWebGL","applyTo2d","retrieveShader","shader","useProgram","uniform1f","sendUniformData","viewport","drawArrays","TRIANGLE_STRIP","bindAdditionalTexture","textureUnit","activeTexture","TEXTURE0","unbindAdditionalTexture","getMainParameter","setMainParameter","createHelpLayer","helpLayer","mainP","ColorMatrix","colorsOnly","uColorMatrix","uConstants","constants","uniformMatrix4fv","uniform4fv","Brightness","brightness","uBrightness","Convolute","opaque","Convolute_3_1","Convolute_3_0","Convolute_5_1","Convolute_5_0","Convolute_7_1","Convolute_7_0","Convolute_9_1","Convolute_9_0","dstOff","scx","scy","srcOff","wt","weights","side","halfSide","sw","sh","output","createImageData","dst","alphaFac","uMatrix","uOpaque","uHalfSize","uSize","uniform1fv","Grayscale","lightness","luminosity","mode","uMode","uniform1i","Invert","invert","uInvert","Noise","noise","rand","uNoise","uSeed","Pixelate","blocksize","_i","_j","_iLen","_jLen","uBlocksize","RemoveColor","useAlpha","lowC","highC","uLow","uHigh","Brownie","Vintage","Kodachrome","Technicolor","Polaroid","Sepia","BlackWhite","BlendColor","screen","diff","lighten","darken","exclusion","tint","buildSource","tg","alpha1","uColor","BlendImage","mask","TEXTURE1","calculateMatrix","canvas1","blendData","blendImage","uTransformMatrix","uImage","uniformMatrix3fv","Resize","resizeType","lanczosLobes","uDelta","uTaps","uniform2fv","horizontal","taps","filterWindow","getFilterWindow","generateShader","tempScale","getTaps","lobeFunction","lanczosCreate","offsets","fragmentSourceTOP","dW","dH","lobes","xx","rcpScaleX","rcpScaleY","newData","oW","oH","sliceByTwo","hermiteFastResize","bilinearFiltering","lanczosResize","tmpCanvas","mult","doneW","doneH","stepW","stepH","dX","dY","srcData","destImg","destData","lanczos","ratioX","ratioY","rcpRatioX","rcpRatioY","range2X","range2Y","cacheLanc","icenter","process","u","weight","fX","fY","xDiff","yDiff","chnl","origPix","w4","pixels","destImage","destPixels","ratioW","ratioH","ratioWHalf","ratioHHalf","img2","data2","weightsAlpha","gxR","gxG","gxB","gxA","yy","w0","Contrast","contrast","contrastF","uContrast","Saturation","saturation","adjust","uSaturation","Vibrance","vibrance","avg","amt","uVibrance","Blur","aspectRatio","simpleBlur","canvas2","blurLayer1","blurLayer2","percent","ctx1","ctx2","newImageData","delta","chooseRightDelta","blurScale","Gamma","gamma","rInv","gInv","bInv","rVals","gVals","bVals","uGamma","uniform3fv","Composed","subFilters","HueRotation","rotation","rad","aThird","aThirdSqtSin","OneMinusCos","additionalProps","_dimensionAffectingProps","_reNewline","_reSpacesAndTabs","_reSpaceAndTab","_reWords","textAlign","superscript","baseline","subscript","pathStartOffset","pathSide","pathAlign","_fontSizeFraction","_fontSizeMult","charSpacing","_measuringContext","direction","_styleProperties","__charBounds","CACHE_FONT_SIZE","MIN_TEXT_WIDTH","__skipDimension","setPathInfo","initDimensions","segmentsInfo","getMeasuringContext","_splitText","newLines","_splitTextIntoLines","_textLines","graphemeLines","_unwrappedTextLines","_unwrappedLines","_text","graphemeText","_clearCache","calcTextWidth","cursorWidth","calcTextHeight","enlargeSpaces","diffSpace","currentLineWidth","numberOfSpaces","accumulatedSpace","line","charBound","spaces","isEndOfWrapping","getLineWidth","kernedWidth","lineIndex","missingNewlineOffset","_setTextStyles","_renderTextLinesBackground","_renderTextDecoration","_renderText","_renderTextStroke","_renderTextFill","charStyle","forMeasuring","textBaseline","_getFontDeclaration","maxWidth","_renderTextLine","_renderChars","styleHas","heightOfLine","lineLeftOffset","lastColor","charBox","currentColor","drawStart","leftOffset","_getLeftOffset","lineTopOffset","_getTopOffset","boxStart","boxWidth","_getLineLeftOffset","getValueOfPropertyAt","renderLeft","getFontCache","cacheProp","_measureChar","_char","previousChar","prevCharStyle","coupleWidth","previousWidth","fontCache","couple","stylesAreEqual","fontMultiplier","measureText","getHeightOfChar","measureLine","lineInfo","_measureLine","_getWidthOfCharSpacing","grapheme","prevGrapheme","graphemeInfo","startingPoint","totalPathLength","lineBounds","positionInPath","_getGraphemeBox","_setGraphemeOnPath","numOfSpaces","centerPosition","skipLeft","getCompleteStyleDeclaration","previousBox","__lineHeights","maxHeight","_renderTextCommon","lineHeights","isEmptyStyles","actualStyle","nextStyle","timeToRender","drawingLeft","isJustify","charsToRender","shortCut","isLtr","currentDirection","_renderChar","_applyPatternGradientTransformText","handleFiller","fillOffsets","strokeOffsets","_getStyleDeclaration","fullDecl","shouldFill","fillText","strokeText","setSuperscript","_setScript","setSubscript","schema","loc","get2DCursorLocation","setSelectionStyles","lineDiff","__lineWidths","_shouldClearDimensionCache","shouldClear","_forceClearCache","_size","_dy","lastDecoration","currentDecoration","currentFill","lastFill","topOffset","styleObject","family","fontIsGeneric","genericFonts","newLine","newText","allProperties","needsDims","isAddingPath","_key","parsedAnchor","textAnchor","originalStrokeWidth","textHeightScaleFactor","scaledDiff","textHeight","offX","objectCopy","textInstance","pathInstance","p3","cleanStyle","letterCount","stylePropertyValue","stylesCount","allStyleObjectPropertiesMatch","graphemeCount","removeStyle","lineNum","charNum","_extendStyles","_getLineStyle","_setLineStyle","_setStyleDeclaration","selectionStart","skipWrapping","getSelectionStyles","startIndex","endIndex","selectionEnd","getStyleAtPosition","lineStyle","_deleteStyleDeclaration","_deleteLineStyle","parseDecoration","IText","editable","editingBorderColor","cursorColor","cursorDelay","cursorDuration","caching","hiddenTextareaContainer","_reSpace","_currentCursorOpacity","_selectionDirection","_abortCursorAnimation","__widthOfSpace","inCompositionMode","initBehavior","setSelectionStart","_updateAndFire","setSelectionEnd","_fireSelectionChanged","_updateTextarea","initDelayedCursor","cursorOffsetCache","renderCursorOrSelection","skipRestore","_clearTextArea","boundaries","_getCursorBoundaries","renderCursor","renderSelection","_getCursorBoundariesOffsets","cursorPosition","bound","cursorLocation","charHeight","__isMousedown","hiddenTextarea","startLine","endLine","startChar","endChar","realLineHeight","lineOffset","boxEnd","drawWidth","drawHeight","extraTop","compositionColor","getCurrentCharFontSize","cp","_getCurrentCharIndex","getCurrentCharColor","objCopy","initAddedHandler","initRemovedHandler","initCursorSelectionHandlers","initDoubleClickSimulation","mouseMoveHandler","_initCanvasHandlers","_removeCanvasHandlers","_tick","_currentTickState","_animateCursor","targetOpacity","completeMethod","tickState","isAborted","_onTickComplete","_cursorTimeout1","_currentTickCompleteState","restart","delay","abortCursorAnimation","_cursorTimeout2","selectAll","getSelectedText","findWordBoundaryLeft","startFrom","findWordBoundaryRight","findLineBoundaryLeft","findLineBoundaryRight","searchWordBoundary","selectWord","newSelectionStart","newSelectionEnd","selectLine","enterEditing","exitEditingOnOthers","initHiddenTextarea","focus","_saveEditingProps","_setEditingProps","_textBeforeEdit","initMouseMoveHandler","activeElement","getSelectionStartFromPointer","currentStart","currentEnd","__selectionStartOnMouseDown","restartCursorIfNeeded","fromStringToGraphemeSelection","smallerTextStart","graphemeStart","smallerTextEnd","fromGraphemeToStringSelection","newSelection","updateTextareaPosition","updateFromTextArea","_calcTextareaPosition","desiredPosition","compositionStart","upperCanvas","upperCanvasWidth","upperCanvasHeight","clientWidth","clientHeight","_savedProps","_restoreEditingProps","isTextChanged","_removeExtraneousStyles","removeStyleFromTo","styleObj","cursorStart","cursorEnd","lineStart","charStart","lineEnd","charEnd","shiftLineStyles","numericChar","clonedStyles","numericLine","insertNewlineStyleObject","qty","copiedStyle","currentCharStyle","newLineStyles","somethingAdded","isEndOfLine","numIndex","styleCarriedOver","insertCharStyleObject","quantity","currentLineStyles","currentLineStylesCloned","numericIndex","newStyle","insertNewStyleBlock","insertedText","cursorLoc","addedLines","linesLength","setSelectionStartEndWithShift","setSelectionInBoundaries","__lastClickTime","__lastLastClickTime","__lastPointer","__newClickTime","newPointer","isTripleClick","_stopEvent","__lastIsEditing","__lastSelected","initMousedownHandler","initMouseupHandler","initClicks","doubleClickHandler","tripleClickHandler","_mouseDownHandler","setCursorByClick","_mouseDownHandlerBefore","currentActive","mouseOffset","prevWidth","_getNewSelectionStartFromOffset","distanceBtwLastCharAndCursor","distanceBtwNextCharAndCursor","onKeyDown","onKeyUp","onInput","copy","paste","onCompositionStart","onCompositionUpdate","onCompositionEnd","_clickHandlerInitialized","onClick","keysMap","keysMapRtl","ctrlKeysMapUp","ctrlKeysMapDown","keyMap","keyCode","ctrlKey","metaKey","stopImmediatePropagation","_copyDone","fromPaste","removedText","removeFrom","removeTo","nextText","charCount","nextCharCount","charDiff","textareaSelection","backDelete","copiedText","copiedTextStyle","compositionEnd","_getClipboardData","clipboardData","_getWidthBeforeCursor","widthBeforeCursor","getDownCursorOffset","isRight","selectionProp","_getSelectionForOffset","indexOnOtherLine","_getIndexOnLine","getUpCursorOffset","textBeforeCursor","charWidth","foundMatch","widthOfCharsOnLine","indexOnLine","leftEdge","rightEdge","offsetFromLeftEdge","moveCursorDown","_moveCursorUpOrDown","moveCursorUp","moveCursorWithShift","moveCursorWithoutShift","moveCursorLeft","_moveCursorLeftOrRight","_move","_moveLeft","_moveRight","moveCursorLeftWithoutShift","change","moveCursorLeftWithShift","moveCursorRight","moveCursorRightWithShift","moveCursorRightWithoutShift","changed","removeChars","insertChars","_getSVGLeftTopOffsets","textAndBg","_getSVGTextAndBg","textTop","textLeft","_wrapSVGTextAndBg","lineTop","textSpans","textTopOffset","textLeftOffset","_setSVGTextLineBg","_setSVGTextLineText","_createTextCharSpan","styleDecl","shouldUseWhitespace","styleProps","fillStyles","dySpan","_pushTextBgRect","fillColor","_getSVGLineTopOffset","lastHeight","Textbox","minWidth","dynamicMinWidth","__cachedLines","_wordJoiners","splitByGrapheme","_styleMap","_generateStyleMap","textInfo","realLineCount","realLineCharCount","isWrapping","nextOffset","shouldLimit","mapNextLine","_wrapText","desiredWidth","wrapped","_wrapLine","_measureWord","word","charOffset","_line","reservedSpace","words","infix","wordWidth","infixWidth","largestWordWidth","lineJustStarted","additionalSpace","getMinWidth","linesToKeep","scaleSkewStyleHandler","scaleStyleHandler","objectControls","ml","mr","mb","mtr","textBoxControls","Queue","polylabel","polygon","debug","cellSize","degeneratePoleOfInaccessibility","cellQueue","compareMax","Cell","bestCell","area","f","getCentroidCell","bboxCell","numProbes","cell","poleOfInaccessibility","inside","minDistSq","Infinity","ring","getSegDistSq","pointToPolygonDist","api","locals","getTarget","styleTarget","HTMLIFrameElement","contentDocument","head","stylesInDom","getIndexByIdentifier","modulesToDom","idCountMap","identifiers","base","count","css","sourceMap","references","updater","addStyle","insertStyleElement","nonce","insert","textStore","replaceText","replacement","Boolean","applyToSingletonTag","styleSheet","cssNode","createTextNode","insertBefore","applyToTag","singleton","singletonCounter","update","removeStyleElement","newObj","all","atob","lastIdentifiers","newList","newLastIdentifiers","_index","DragHandler","remember","init","val","matrixTransform","getBBox","SVG","Nested","rbox","G","Use","which","buttons","defaultPrevented","Doc","createSVGPoint","getScreenCTM","inverse","anchorOffset","getComputedTextLength","startPoints","drag","gx","gy","coord","snapToGrid","move","draggable","PaintHandler","plugin","getPlugin","startPoint","lastUpdateCall","Set","draw","defaults","pageXOffset","pageYOffset","pointPlugin","stop","clean","forget","calc","done","plugins","Event","paintHandler","name","shapes","shapesArr","plot","drawCircles","each","undo","members","ellipse","supported","parser","prepare","ns","xmlns","svgjs","createSVGRect","did","eid","create","methods","inherit","invent","initializer","construct","Container","adopt","SVGElement","defs","setData","poly","polyline","native","numberAndUnit","hex","rgb","transforms","whitespace","isHex","isRgb","isCss","isBlank","isNumber","isPercent","isImage","delimiter","hyphen","pathLetters","isPathLetter","numbersWithDots","dots","block","il","filterSVGElements","nodes","compToHex","morph","at","isColor","fallback","lastValue","lastDestination","settle","seen","array_clone","PointArray","toLine","pathHandlers","p0","L","H","V","S","Q","T","Z","mlhvqtcsa","jl","PathArray","arrayToString","equalCommands","pathArray","sourceArray","destinationArray","paramCnt","pathRegReplace","curr","isFinite","plus","minus","times","relative","_event","_events","dom","proportionalSize","writeDataToDom","assignNewId","removeElement","addTo","put","putIn","show","hide","classes","hasClass","removeClass","toggleClass","matches","parents","matchesSelector","msMatchesSelector","mozMatchesSelector","webkitMatchesSelector","oMatchesSelector","svg","well","Parent","innerHTML","is","MorphObj","Situation","reversed","reversing","loop","loops","FX","situations","situation","paused","lastPos","absPos","_speed","queue","timeToAbsPos","absPosToTime","startAnimFrame","stopAnimFrame","animationFrame","step","startCurrent","initAnimations","dequeue","initialTransformation","matrixify","clearQueue","clearCurrent","jumpToEnd","atEnd","atStart","isAbsPos","durDivSpd","speed","pause","last","play","progress","easeIt","detail","_callStart","during","eased","afterAll","duringAll","ignoreTime","absPosInt","lastLoop","eachAt","Matrix","extract","isEased","real","num","leading","viewbox","ViewBox","Stop","Box","fullBox","merge","xMin","xMax","yMin","yMax","BBox","Exception","topParent","Shape","tbox","RBox","addOffset","screenCTM","arrayToMatrix","abcdef","deltaTransformPoint","transformedX","transformedY","parseMatrix","around","flip","skew","createSVGMatrix","float32String","ctm","getCTM","rebuild","ensureCentre","Rotate","Scale","Skew","Translate","untransform","kv","toParent","pCtm","toDoc","Transformation","inversed","params","_undo","camelCase","has","first","hasChildNodes","lastChild","_defs","ungroup","Defs","flatten","view","we","he","wm","hm","reg","offsetWidth","offsetHeight","listenerId","events","listener","binding","bag","_svgjsListenerId","ev","dispatchEvent","CustomEvent","cancelable","gbox","trans","spof","nextSibling","siblings","forward","backward","front","back","Mask","unmask","maskWith","masker","ClipPath","unclip","clip","clipWith","clipper","patternUnits","Bare","Symbol","symbol","file","use","_array","morphArray","load","_loaded","ratio","_error","_rebuild","_build","oy","newLined","build","tspan","textPath","blankLineOffset","plain","Tspan","TextPath","track","link","linkTo","Marker","ref","marker","sugar","comp","extension","dmove","getTotalLength","pointAt","getPointAtLength","memory","_memory","idFromReference","select","query","querySelectorAll","CustomEventPoly","bubbles","createEvent","initCustomEvent","lastTime","vendors","currTime","getTime","timeToCall","factory","ResizeHandler","_extractPosition","resize","txPt","pointCoords","snap","checkAspectRatio","sAngle","pAngle","snapToAngle","flag","pointCoordsY","constraintToBox","orgX","orgY","isReverse","saveAspectRatio","updatedSnap","newW","newH","newAspectRatio","SelectHandler","pointSelection","isSelected","rectSelection","pointsList","rt","rb","lb","pointCoord","setting","isPointCentered","settings","selectize","pointsLists","pointsExclude","deepSelect","selectPoints","selectRect","observe","cleanup","drawPoints","getPointArray","curriedEvent","pageX","pageY","drawPoint","classPoints","pointType","drawCircle","drawRect","pointSize","updatePointSelection","updateRectSelection","rotationPoint","getMoseDownFunc","classRect","pointElement","MutationObserver","observerInst","disconnect","TinyQueue","compare","defaultCompare","_down","_up","peek","halfLength","best","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","getter","definition","defineProperty","enumerable","toStringTag","baseURI","location","href","nc","MasterImpl","listeners","subscribe","notify","reason","HighlightSeverity","RectDrawingMethod","CuboidDrawingMethod","ColorBy","FrameZoom","UpdateReasons","Mode","defaultData","drawData","enabled","editData","interactionData","mergeData","groupData","splitData","disableInternalSVGDrawing","currentData","shapeType","state","brushTool","startsWith","getElementsByClassName","hasShapeIsBeingDrawn","CanvasModelImpl","super","clientID","attributeID","highlightedElements","elementsIDs","severity","canvasSize","configuration","smoothImage","autoborders","displayAllText","showProjections","showConflicts","forceDisableEditing","intelligentPolygonCrop","forceFrameUpdate","CSSImageFilter","colorBy","LABEL","selectedShapeOpacity","shapeOpacity","outlinedBorders","resetZoom","textFontSize","controlPointsSize","textPosition","undefinedAttrValue","imageBitmap","imageID","imageOffset","imageSize","imageIsDeleted","focusData","gridSize","issueRegions","fittedScale","zLayer","IDLE","exception","oldScale","newScale","MIN","MAX","mutiplier","topMultiplier","leftMultiplier","IMAGE_ZOOMED","IMAGE_MOVED","fitCanvas","FITTED_CANVAS","OBJECTS_UPDATED","ISSUE_REGIONS_UPDATED","bitmap","BITMAP","selectRegion","enable","SELECT_REGION","dragCanvas","DRAG_CANVAS","zoomCanvas","ZOOM_CANVAS","setup","frameData","objectStates","EDIT","DRAG","RESIZE","deleted","IMAGE_CHANGED","then","relativeScaling","prevImageLeft","prevImageTop","prevImageWidth","prevImageHeight","fit","catch","DATA_FAILED","setupIssueRegions","activate","_state","objectType","SHAPE_ACTIVATED","highlight","clientIDs","SHAPE_HIGHLIGHTED","rotationAngle","IMAGE_ROTATED","SHAPE_FOCUSED","IMAGE_FITTED","grid","stepX","stepY","GRID_UPDATED","DRAW","skeletonSVG","initialState","numberOfPoints","redraw","rectDrawingMethod","CLASSIC","cuboidDrawingMethod","edit","interact","INTERACT","thresholdChanged","enableThreshold","intermediateShape","crosshair","SPLIT","GROUP","MERGE","objectState","SELECT","configure","entry","values","CONFIG_UPDATED","isAbleToChangeFrame","CANCEL","DESTROY","geometry","zOrder","CanvasControllerImpl","model","enableDrag","lastDragPosition","isDragging","disableDrag","Orientation","intersection","p4","x4","y4","denominator","EPSILON","Equation","getY","Figure","indices","allPoints","oldPoints","Edge","getEquation","CuboidModel","initEdges","initFaces","updateVanishingPoints","buildBackEdge","updatePoints","updateOrientation","getPoints","setPoints","dl","fl","orientation","fr","dr","computeSideEdgeConstraints","edge","midLength","y1Range","y2Range","buildright","midEdge","vpl","vpr","ft","dt","fb","db","edgeList","dorsal","bot","facesList","leftPoints","rightPoints","topIndex","botIndex","vpLeft","vpRight","cuboidFrom4Points","flattenedPoints","unsortedPlanePoints","plane2","sortedPlanePoints","startAng","ang","sortPointsClockwise","leftIndex","plane1","vec","cuboidPoints","left2","right2","p5","p6","p7","p8","setupCuboidPoints","translateFromSVG","transformationMatrix","pt","translateToSVG","displayShapeSize","shapesContainer","textContainer","sizeElement","shape","rm","rotate2DPoints","pointsToNumberArray","acc","parsePoints","_","readPointsFromShape","stringifyPoints","clamp","vectorLength","sqrI","sqrJ","translateToCanvas","translateFromCanvas","computeWrappingBox","margin","xtl","MAX_SAFE_INTEGER","ytl","xbr","MIN_SAFE_INTEGER","ybr","getSkeletonEdgeCoordinates","dataNodeFrom","dataNodeTo","nodeFrom","nodeTo","makeSVGFromTemplate","template","setupSkeletonEdges","skeleton","referenceSVG","child","dataType","isInteger","_child","prepend","imageDataToDataURL","handleResult","toBlob","blob","dataURL","createObjectURL","finally","revokeObjectURL","alphaChannelOnly","expandChannels","endOffset","originalDraw","originalDraggable","originalResize","rotationPointPressed","EdgeIndex","getEdgeIndex","cuboidPoint","FL","FR","DR","DL","getTopDown","edgeIndex","constructorMethod","cuboidModel","setupFaces","setupEdges","setupProjections","hideProjections","_attr","face","ftProj","updateProjectionLine","fbProj","rtProj","rbProj","frontLeftEdge","frontRightEdge","dorsalRightEdge","dorsalLeftEdge","frontTopEdge","rightTopEdge","frontBotEdge","rightBotEdge","setupGrabPoints","circleType","viewModel","flCenter","frCenter","ftCenter","fbCenter","drCenter","dlCenter","grabPoints","getGrabPoints","edges","getEdges","projectionLineEnable","equation","ondblclick","resetPerspective","getResizedPointIndex","parentElement","resizedCubePoint","accumulatedOffset","setupDorsalEdge","dyPortion","edgeTopIndex","edgeBottomIndex","midPointUp","midPointDown","dorselEdge","constraints","updateViewAndVM","topPoints","computeHeightFace","bottomPoints","horizontalEdgeControl","updatingFace","midX","midY","updatedEdge","resizedFacePoint","dxPortion","topPoint","botPoint","xStatus","vpX","faces","updateThickness","paintOrientationLines","consts","computedStyles","strokeColor","selectedColor","xInitial","yInitial","edgePoints","updateView","pivot","targetX","updateFaces","updateEdges","updateProjections","updateGrabPoints","centers","cube","Crosshair","checkConstraint","DrawHandlerImpl","getFinalEllipseCoordinates","fitIntoFrame","rightX","topY","frameWidth","frameHeight","fitCX","fitCY","fitRX","fitRY","getFinalRectCoordinates","getFinalPolyshapeCoordinates","targetPoints","Direction","isBetween","isInsideFrame","Horizontal","findInersection","intersectionPoint","findIntersectionsWithFrameBorders","resultPoints","leftLine","topLine","rightLine","bottomLine","crop","shapePoints","isPolyline","isPolygon","curPoint","isLastPoint","nextPoint","intersectionPoints","Vertical","getFinalCuboidCoordinates","cuboidOffsets","minCuboidOffset","xOffset","yOffset","offsetCoords","addCrosshair","removeCrosshair","onDrawDone","onDrawDoneDefault","release","initialized","autoborderHandler","autoborder","drawInstance","CORNER_POINTS","pointsGroup","shapeSizeElement","initDrawing","drawBox","canceled","startTimestamp","drawEllipse","initialPoint","translated","drawBoxBy4Points","drawPolyshape","sizeDecrement","lastDrawnPoint","deltaThreshold","drawPolygon","autobordersEnabled","drawPolyline","drawCuboidBy4Points","drawCuboid","drawSkeleton","label","labelID","cxOffset","cyOffset","pastePolyshape","occluded","originalEvent","pasteShape","moveShape","initialX","initialY","pasteBox","pasteEllipse","pastePolygon","pastePolyline","pasteCuboid","pasteSkeleton","outside","newXtl","newYtl","pastePoints","initialPoints","numOfPoints","setupPasteEvents","setupDrawEvents","startDraw","stringifiedPoints","EXTREME_POINTS","configurate","isFillableRect","isFillableCuboid","isFilalblePolygon","MasksHandlerImpl","keepDrawnPolygon","canvasWrapper","pointerEvents","zIndex","isPolygonDrawing","vectorDrawHandler","removeBrushMarker","brushMarker","setupBrushMarker","tool","common","latestMousePos","form","releaseCanvasWrapperCSS","releasePaste","isInsertion","drawnObjects","releaseDraw","isDrawing","releaseEdit","onEditDone","getStateColor","INSTANCE","getDrawnObjectsWrappingBox","imageDataFromCanvas","wrappingBBox","updateBrushTools","drawingOpacity","onDrawRepeat","onEditStart","isMouseDown","isBrushSizeChanging","continueInserting","wrappingBbox","imageWidth","imageHeight","resizeBrushToolLatestX","onUpdateConfiguration","trunc","commonProperties","shapeProperties","drawablePolygon","topCanvas","Promise","resolve","continue","newDrawData","EditHandlerImpl","setupTrailingPoint","editedShape","pointID","editLine","minimumPoints","startEdit","dummyEvent","MouseEvent","dxsqr","dysqr","setupEditEvents","selectPolygon","stopEdit","stopPointID","linePoints","cutIndexes1","cutIndexes2","curveLength","indexes","pointsCriteria","lengthCriteria","firstPart","secondPart","intelligentCutEnabled","clones","setupPoints","getGeometry","initEditing","closeEditing","MergeHandlerImpl","addConstraints","statesToBeMerged","removeConstraints","checkConstraints","onFindObject","highlightedShapes","initMerging","closeMerging","onMergeDone","stateIndexes","stateFrames","frame","repeatSelection","SplitHandlerImpl","resetShape","highlightedShape","findObject","initSplitting","splitDone","closeSplitting","onSplitDone","append","GroupHandlerImpl","getSelectionBox","stopSelectionPoint","startSelectionPoint","onSelectStart","selectionRect","onSelectUpdate","onSelectStop","getStates","appendToSelection","bindedOnSelectStart","bindedOnSelectUpdate","bindedOnSelectStop","resetSelectedObjects","initGrouping","closeGrouping","statesToBeGroupped","onGroupDone","groupingCopies","colorRGB","reject","RegionSelectorImpl","startSelection","stopSelection","onRegionSelected","ZoomHandlerImpl","onZoomRegion","InteractionHandlerImpl","prepareResult","interactionShapes","shouldRaiseEvent","shapesWereUpdated","minPosVertices","minNegVertices","positiveShapes","negativeShapes","minPosVerticesDefined","minNegVerticesDefined","minPosVerticesAchieved","minNegVerticesAchieved","addThreshold","thresholdRectSize","interactPoints","isWithinFrame","isWithinThreshold","currentInteractionShape","onInteraction","allowRemoveOnlyLast","_e","startWithBox","interactRectangle","shouldFinish","onContinue","initInteraction","startInteraction","drawnIntermediateShape","prevCx","prevCy","imageX","imageY","updateIntermediateShape","erroredShape","visualComponentsChanged","allowedKeys","onChangeToolsBlockerState","thresholdWasModified","shapesUpdated","isDone","enableSliding","shapesToBeScaled","AutoborderHandlerImpl","frameContent","currentID","currentShape","groups","auxiliaryGroupID","auxiliaryClicks","removeMarkers","groupID","dataset","groupId","click","addPointToCurrentShape","resetAuxiliaryShape","resetID","drawMarkers","transformedShapes","svgNamespace","landmarks","way","wayPoint","pX","pY","coordinate","dblclick","updateObjects","currentClientID","originClientId","polylineID","polylineId","CanvasViewImpl","controller","stateIsLocked","lock","translatePointsFromRotatedShape","ctm1","transformedPoint","stringifyToCanvas","isInnerHidden","innerObjectsFlags","drawHidden","setupInnerFlags","svgShapes","svgTexts","drawnStates","hidden","updateTextPosition","continueDraw","prevDrawData","hiddenBecauseOfDraw","_clientID","flat","states","onFocusRegion","transformCanvas","canvasX","canvasY","canvasOffset","dragged","moveCanvas","attachmentBoard","drawHandler","masksHandler","editHandler","zoomHandler","interactionHandler","regionSelector","gridPath","skeletonEdge","issueRegion","drawnIssueRegions","issueRegionPattern_1","issueRegionPattern_2","resizeCanvas","masksContent","adoptedContent","stringified","setupObjects","created","updated","drawnState","newIDs","deactivate","deleteObjects","addObjects","updatedSkeletons","updatedNotSkeletons","sortObjects","hideDirection","directions","showDirection","firstCircle","secondCircle","firstPoint","secondPoint","xAxis","baseVector","baseVectorLength","cosinus","pathElement","reversedPoints","mousedownHandler","selectedClientID","dblClickHandler","contextMenuHandler","mouseEvent","getController","getActiveElement","rotY","title","editHidden","snapToAngleResize","wrappingRect","adoptedText","gridPattern","gridDefs","gridRect","contentDefs","mergeHandler","splitHandler","groupHandler","onShiftKeyDown","onShiftKeyUp","oncontextmenu","updateShapeViews","parentState","fillOpacity","getShapeColorization","shapeView","withUpdatingShapeViews","addText","deleteText","recreateText","redrawBitmap","renderWidth","renderHeight","canvasContext","html","setupConflictsRegions","descriptions","pinned","parentShapeType","shapeColor","ERROR","WARNING","getHighlightClassname","isInvisible","translatedPoints","stateDescriptions","drawnStateDescriptions","desc","attrID","span","addMask","addSkeleton","addRect","addPolygon","addPolyline","addPoints","addEllipse","addCuboid","needSort","sorted","deactivateAttribute","deactivateShape","activateAttribute","activateShape","hideText","showText","dx2","dy2","resized","resizeFinally","masks","clientCX","clientCY","rotX","textBBox","childOptions","applyParentX","parentText","withID","withAttr","withLabel","withSource","withDescriptions","attrNames","attrLine","isGroundTruth","colorization","structure","svgElements","templateElements","templateElement","mouseover","activatedElementID","mousemove","mouseleave","textList","prevXtl","prevYtl","childClientID","elementShape","entries","elementState","showElementText","prevXbr","prevYbr","basicPolyline","CanvasVersion","CanvasImpl"],"sourceRoot":""}